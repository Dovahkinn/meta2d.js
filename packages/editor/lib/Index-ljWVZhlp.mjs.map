{"version":3,"file":"Index-ljWVZhlp.mjs","sources":["../src/assets/logo.png","../../../node_modules/.pnpm/file-saver@2.0.5/node_modules/file-saver/dist/FileSaver.min.js","../src/components/Header.vue","../../utils/src/lineCross.ts","../src/components/PropsTab.vue","../src/components/CodeEditor.vue","../src/components/MessageHandlers.vue","../src/components/ScriptHandlers.vue","../src/components/ScriptsEditor.vue","../src/components/FileProps.vue","../src/utils/penFrames.ts","../src/components/PropEditor.vue","../src/components/EventEditor.vue","../src/components/PenProps.vue","../src/components/PensProps.vue","../src/components/Structure.vue","../src/components/Props.vue","../src/utils/graphicConfig.ts","../src/components/Graphics.vue","../src/components/GraphicsManager.vue","../src/views/Index.vue"],"sourcesContent":["export default \"data:image/png;base64,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\"","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","<template>\r\n  <div class=\"app-header header__top\">\r\n    <a class=\"logo\" href=\"\" target=\"_blank\">\r\n      <img src=\"../assets/logo.png\" alt=\"logo\" />\r\n      <span>图形编辑器</span>\r\n    </a>\r\n    <t-dropdown :minColumnWidth=\"200\" :maxHeight=\"560\" overlayClassName=\"header-dropdown\">\r\n      <a> 文件 </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item @click=\"newFile\">\r\n          <a>新建文件</a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item @click=\"openFile\" divider=\"true\">\r\n          <a>打开文件</a>\r\n        </t-dropdown-item>\r\n\r\n        <t-dropdown-item divider=\"true\">\r\n          <a @click=\"downloadJson\">下载JSON文件</a>\r\n        </t-dropdown-item>\r\n\r\n        <t-dropdown-item>\r\n          <a @click=\"downloadPng\">下载为PNG</a>\r\n        </t-dropdown-item>\r\n        <!-- <t-dropdown-item> -->\r\n        <!--   <a @click=\"downloadSvg\">下载为SVG</a> -->\r\n        <!-- </t-dropdown-item> -->\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n    <t-dropdown :minColumnWidth=\"180\" :maxHeight=\"500\" overlayClassName=\"header-dropdown\">\r\n      <a> 编辑 </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item>\r\n          <a @click=\"onUndo\">\r\n            <div class=\"flex\">\r\n              撤销 <span class=\"flex-grow\"></span> Ctrl + Z\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item divider=\"true\">\r\n          <a @click=\"onRedo\">\r\n            <div class=\"flex\">\r\n              恢复 <span class=\"flex-grow\"></span> Ctrl + Y\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item>\r\n          <a @click=\"onCut\">\r\n            <div class=\"flex\">\r\n              剪切 <span class=\"flex-grow\"></span> Ctrl + X\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item>\r\n          <a @click=\"onCopy\">\r\n            <div class=\"flex\">\r\n              复制 <span class=\"flex-grow\"></span> Ctrl + C\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item divider=\"true\">\r\n          <a @click=\"onPaste\">\r\n            <div class=\"flex\">\r\n              粘贴 <span class=\"flex-grow\"></span> Ctrl + V\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item>\r\n          <a @click=\"onAll\">\r\n            <div class=\"flex\">\r\n              全选 <span class=\"flex-grow\"></span> Ctrl + A\r\n            </div>\r\n          </a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item>\r\n          <a @click=\"onDelete\">\r\n            <div class=\"flex\">删除 <span class=\"flex-grow\"></span> DELETE</div>\r\n          </a>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n\r\n\r\n    <a class=\"logo\">\r\n      <span @click=\"customToolbarClick()\">添加/删除锚点</span>\r\n    </a>\r\n\r\n    <t-dropdown :minColumnWidth=\"200\" :maxHeight=\"560\" overlayClassName=\"header-dropdown\">\r\n      <a> 批量选择图元 </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item @click=\"selectPens()\">\r\n          <a>节点</a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item @click=\"selectPens(1)\" divider=\"true\">\r\n          <a>连线</a>\r\n        </t-dropdown-item>\r\n        <t-dropdown-item @click=\"selectPens('none')\">\r\n          <a>取消</a>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n\r\n    <a class=\"logo\">\r\n      <t-tooltip content=\"选择 .svg 文件导入，单击画布摆放到鼠标指针位置\">\r\n        <span @click=\"customToolbarClick('svg')\">导入 SVG</span>\r\n      </t-tooltip>\r\n    </a>\r\n    <t-popconfirm :visible=\"visible\" theme=\"default\" content=\"是否导入 ElectricEditor 生成的 JSON 文件?\"\r\n      @visible-change=\"onVisibleChange\">\r\n      <a class=\"logo\">\r\n        <span>导入</span>\r\n      </a>\r\n    </t-popconfirm>\r\n\r\n\r\n    <a class=\"logo\">\r\n      <span @click=\"customToolbarClick('save')\">保存图纸</span>\r\n    </a>\r\n\r\n    <t-dropdown :minColumnWidth=\"180\" :maxHeight=\"500\" :delay2=\"[10, 150]\" overlayClassName=\"header-dropdown\">\r\n      <a> 帮助 </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item v-for=\"item in assets.helps\" :divider=\"item.divider\">\r\n          <a v-if=\"item.url\" :href=\"item.url\" target=\"_blank\">{{\r\n            item.name\r\n          }}</a>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n  </div>\r\n\r\n  <div class=\"app-header header__bottom\">\r\n    <t-tooltip content=\"撤销\">\r\n      <svg class=\"l-icon\" aria-hidden=\"true\" @click=\"onUndo\">\r\n        <use xlink:href=\"#l-undo\"></use>\r\n      </svg>\r\n    </t-tooltip>\r\n    <t-tooltip content=\"重做\">\r\n      <svg class=\"l-icon\" aria-hidden=\"true\" @click=\"onRedo\">\r\n        <use xlink:href=\"#l-redo\"></use>\r\n      </svg>\r\n    </t-tooltip>\r\n    <t-tooltip content=\"直线\">\r\n      <span :draggable=\"true\" @dragstart=\"onAddShape($event, 'line')\" @click=\"onAddShape($event, 'line')\">\r\n        <span style=\"margin-right: -8px;\">直线</span>\r\n        <t-icon name=\"slash\" />\r\n      </span>\r\n    </t-tooltip>\r\n    <t-tooltip content=\"文字\">\r\n      <span :draggable=\"true\" @dragstart=\"onAddShape($event, 'text')\" @click=\"onAddShape($event, 'text')\">\r\n        <!-- <span>          \r\n          文字\r\n        </span> -->\r\n        <svg class=\"l-icon\" aria-hidden=\"true\">\r\n          <use xlink:href=\"#l-text\"></use>\r\n        </svg>\r\n      </span>\r\n    </t-tooltip>\r\n\r\n    <t-tooltip content=\"钢笔\" placement=\"bottom\">\r\n      <a :style=\"{\r\n        color: isDrawLine ? ' #1677ff' : '',\r\n      }\" @click=\"drawLine\">\r\n        钢笔\r\n        <t-icon name=\"pen\" />\r\n      </a>\r\n    </t-tooltip>\r\n\r\n    <t-dropdown :minColumnWidth=\"160\" :maxHeight=\"560\" overlayClassName=\"header-dropdown\">\r\n      <a>\r\n        <span class=\"button__text\">\r\n          连线\r\n        </span>\r\n        <svg class=\"l-icon\" aria-hidden=\"true\">\r\n          <use :xlink:href=\"lineTypes.find((item) => item.value === currentLineType)?.icon\r\n            \"></use>\r\n        </svg>\r\n      </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item v-for=\"item in lineTypes\">\r\n          <div class=\"flex middle\" @click=\"changeLineType(item.value)\">\r\n            {{ item.name }} <span class=\"flex-grow\"></span>\r\n            <svg class=\"l-icon\" aria-hidden=\"true\">\r\n              <use :xlink:href=\"item.icon\"></use>\r\n            </svg>\r\n          </div>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n    <t-dropdown :minColumnWidth=\"160\" :maxHeight=\"560\" :delay2=\"[10, 150]\" overlayClassName=\"header-dropdown\">\r\n      <a>\r\n        <span class=\"button__text\">\r\n          起点\r\n        </span>\r\n\r\n        <svg class=\"l-icon\" aria-hidden=\"true\">\r\n          <use :xlink:href=\"fromArrows.find((item) => item.value === fromArrow)?.icon\r\n            \"></use>\r\n        </svg>\r\n      </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item v-for=\"item in fromArrows\">\r\n          <div class=\"flex middle\" style=\"height: 30px\" @click=\"changeFromArrow(item.value)\">\r\n            <svg class=\"l-icon\" aria-hidden=\"true\">\r\n              <use :xlink:href=\"item.icon\"></use>\r\n            </svg>\r\n          </div>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n    <t-dropdown :minColumnWidth=\"160\" :maxHeight=\"560\" :delay2=\"[10, 150]\" overlayClassName=\"header-dropdown\">\r\n      <a>\r\n        <span class=\"button__text\">\r\n          终点\r\n        </span>\r\n\r\n        <svg class=\"l-icon\" aria-hidden=\"true\">\r\n          <use :xlink:href=\"toArrows.find((item) => item.value === toArrow)?.icon\"></use>\r\n        </svg>\r\n      </a>\r\n      <t-dropdown-menu>\r\n        <t-dropdown-item v-for=\"item in toArrows\">\r\n          <div class=\"flex middle\" style=\"height: 30px\" @click=\"changeToArrow(item.value)\">\r\n            <svg class=\"l-icon\" aria-hidden=\"true\">\r\n              <use :xlink:href=\"item.icon\"></use>\r\n            </svg>\r\n          </div>\r\n        </t-dropdown-item>\r\n      </t-dropdown-menu>\r\n    </t-dropdown>\r\n    <t-tooltip content=\"自动锚点\" placement=\"bottom\">\r\n      <a><t-switch v-model=\"autoAnchor\" @change=\"onAutoAnchor\" size=\"small\" /></a>\r\n    </t-tooltip>\r\n\r\n    <div style=\"width: 64px\"></div>\r\n    <div v-show=\"scale > 0\" style=\"line-height: 40px\">{{ scale }}%</div>\r\n    <t-tooltip content=\"100%视图\" placement=\"bottom\">\r\n      <a @click=\"onScaleDefault\"><t-icon name=\"refresh\" /></a>\r\n    </t-tooltip>\r\n    <t-tooltip content=\"窗口大小\" placement=\"bottom\">\r\n      <a @click=\"onScaleWindow\" style=\"margin-left: -16px\">\r\n        窗口大小\r\n        <t-icon name=\"fullscreen-exit\" /></a>\r\n    </t-tooltip>\r\n    <div style=\"width: 36px\"></div>\r\n    <t-tooltip content=\"运行\">\r\n      <a @click=\"onView\">\r\n        运行查看\r\n        <t-icon name=\"play-circle-stroke\" />\r\n      </a>\r\n    </t-tooltip>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, reactive, ref, defineEmits } from \"vue\";\r\nimport { useRouter } from \"vue-router\";\r\nimport { Pen, PenType, deepClone } from \"@meta2d/core\";\r\n// @ts-ignore\r\nimport FileSaver from \"file-saver\";\r\nimport { MessagePlugin } from \"tdesign-vue-next\";\r\nimport { loadElectricJson, readSVGFile } from \"../utils\";\r\nimport { parseSvgStr } from \"../utils/svgParser\";\r\nimport { useData } from \"../services/useGraphics.ts\";\r\n\r\nconst emit = defineEmits([\"view\"]);\r\n\r\nconst router = useRouter();\r\n\r\nconst assets = reactive({\r\n  home: \"https://le5le.com\",\r\n  helps: [\r\n    {\r\n      name: \"产品介绍\",\r\n      url: \"https://doc.le5le.com/document/118756411\",\r\n    },\r\n    {\r\n      name: \"快速上手\",\r\n      url: \"https://doc.le5le.com/document/119363000\",\r\n    },\r\n    {\r\n      name: \"使用手册\",\r\n      url: \"https://doc.le5le.com/document/118764244\",\r\n    },\r\n    {\r\n      name: \"快捷键\",\r\n      url: \"https://doc.le5le.com/document/119620214\",\r\n      divider: true,\r\n    },\r\n  ],\r\n});\r\n\r\nconst visible = ref(false);\r\nconst onVisibleChange = (val: boolean, context: any = {}) => {\r\n  // trigger 表示触发来源，可以根据触发来源自由控制 visible\r\n  if (context && context.trigger === \"confirm\") {\r\n    assetClick();\r\n    visible.value = false;\r\n  } else {\r\n    visible.value = val;\r\n  }\r\n};\r\nconst assetClick = (item?: any) => {\r\n  loadElectricJson(item);\r\n};\r\n\r\nconst isDrawLine = ref<boolean>(false);\r\n\r\nconst scale = ref(0);\r\n\r\nonMounted(() => {\r\n  const timer = setInterval(() => {\r\n    if (meta2d) {\r\n      clearInterval(timer);\r\n      // 获取初始缩放比例\r\n      scaleSubscriber(meta2d.store.data.scale);\r\n\r\n      // 监听缩放\r\n      // @ts-ignore\r\n      meta2d.on(\"scale\", scaleSubscriber);\r\n    }\r\n  }, 200);\r\n});\r\n\r\nconst scaleSubscriber = (val: number) => {\r\n  scale.value = Math.round(val * 100);\r\n};\r\n\r\nconst drawLine = () => {\r\n  if (isDrawLine.value) {\r\n    isDrawLine.value = false;\r\n    meta2d.finishDrawLine();\r\n    meta2d.drawLine();\r\n    meta2d.store.options.disableAnchor = true;\r\n  } else {\r\n    isDrawLine.value = true;\r\n    meta2d.drawLine(meta2d.store.options.drawingLineName);\r\n    meta2d.store.options.disableAnchor = false;\r\n  }\r\n};\r\n\r\nconst lineTypes = reactive([\r\n  { name: \"曲线\", icon: \"#l-curve2\", value: \"curve\" },\r\n  { name: \"线段\", icon: \"#l-polyline\", value: \"polyline\" },\r\n  { name: \"直线\", icon: \"#l-line\", value: \"line\" },\r\n  { name: \"脑图曲线\", icon: \"#l-mind\", value: \"mind\" },\r\n]);\r\nconst currentLineType = ref(\"line\");\r\n\r\nconst changeLineType = (value: string) => {\r\n  currentLineType.value = value;\r\n  if (meta2d) {\r\n    meta2d.store.options.drawingLineName = value;\r\n    meta2d.canvas.drawingLineName && (meta2d.canvas.drawingLineName = value);\r\n    meta2d.store.active?.forEach((pen) => {\r\n      meta2d.updateLineType(pen, value);\r\n    });\r\n  }\r\n};\r\n\r\nconst fromArrow = ref(\"\");\r\nconst fromArrows = [\r\n  { icon: \"#l-line\", value: \"\" },\r\n  { icon: \"#l-from-triangle\", value: \"triangle\" },\r\n  { icon: \"#l-from-diamond\", value: \"diamond\" },\r\n  { icon: \"#l-from-circle\", value: \"circle\" },\r\n  { icon: \"#l-from-lineDown\", value: \"lineDown\" },\r\n  { icon: \"#l-from-lineUp\", value: \"lineUp\" },\r\n  { icon: \"#l-from-triangleSolid\", value: \"triangleSolid\" },\r\n  { icon: \"#l-from-diamondSolid\", value: \"diamondSolid\" },\r\n  { icon: \"#l-from-circleSolid\", value: \"circleSolid\" },\r\n  { icon: \"#l-from-line\", value: \"line\" },\r\n];\r\nconst toArrow = ref(\"\");\r\nconst toArrows = [\r\n  { icon: \"#l-line\", value: \"\" },\r\n  { icon: \"#l-to-triangle\", value: \"triangle\" },\r\n  { icon: \"#l-to-diamond\", value: \"diamond\" },\r\n  { icon: \"#l-to-circle\", value: \"circle\" },\r\n  { icon: \"#l-to-lineDown\", value: \"lineDown\" },\r\n  { icon: \"#l-to-lineUp\", value: \"lineUp\" },\r\n  { icon: \"#l-to-triangleSolid\", value: \"triangleSolid\" },\r\n  { icon: \"#l-to-diamondSolid\", value: \"diamondSolid\" },\r\n  { icon: \"#l-to-circleSolid\", value: \"circleSolid\" },\r\n  { icon: \"#l-to-line\", value: \"line\" },\r\n];\r\n\r\nconst changeFromArrow = (value: string) => {\r\n  fromArrow.value = value;\r\n  // 画布默认值\r\n  meta2d.store.data.fromArrow = value;\r\n  // 活动层的箭头都变化\r\n  if (meta2d.store.active) {\r\n    meta2d.store.active.forEach((pen: Pen) => {\r\n      if (pen.type === PenType.Line) {\r\n        pen.fromArrow = value;\r\n        meta2d.setValue(\r\n          {\r\n            id: pen.id,\r\n            fromArrow: pen.fromArrow,\r\n          },\r\n          {\r\n            render: false,\r\n          },\r\n        );\r\n      }\r\n    });\r\n    meta2d.render();\r\n  }\r\n};\r\n\r\nconst changeToArrow = (value: string) => {\r\n  toArrow.value = value;\r\n  // 画布默认值\r\n  meta2d.store.data.toArrow = value;\r\n  // 活动层的箭头都变化\r\n  if (meta2d.store.active) {\r\n    meta2d.store.active.forEach((pen: Pen) => {\r\n      if (pen.type === PenType.Line) {\r\n        pen.toArrow = value;\r\n        meta2d.setValue(\r\n          {\r\n            id: pen.id,\r\n            toArrow: pen.toArrow,\r\n          },\r\n          {\r\n            render: false,\r\n          },\r\n        );\r\n      }\r\n    });\r\n    meta2d.render();\r\n  }\r\n};\r\n\r\n// 自动锚点\r\nconst autoAnchor = ref(meta2d?.store?.options?.autoAnchor || true);\r\nconst onAutoAnchor = (value: boolean) => {\r\n  meta2d.store.options.autoAnchor = value;\r\n}\r\n\r\nconst newFile = () => {\r\n  meta2d.open({ name: \"新建项目\", pens: [] } as any);\r\n};\r\n\r\nfunction readFile(file: Blob) {\r\n  return new Promise<string>((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      resolve(reader.result as string);\r\n    };\r\n    reader.onerror = reject;\r\n    reader.readAsText(file);\r\n  });\r\n}\r\n\r\nconst openFile = () => {\r\n  // 1. 显示选择文件对话框\r\n  const input = document.createElement(\"input\");\r\n  input.type = \"file\";\r\n  input.onchange = async (event) => {\r\n    const elem = event.target as HTMLInputElement;\r\n    if (elem.files && elem.files[0]) {\r\n      // 2. 读取文件字符串内容\r\n      const text = await readFile(elem.files[0]);\r\n      try {\r\n        // 3. 打开文件内容\r\n        meta2d.open(JSON.parse(text));\r\n\r\n        // 可选：缩放到窗口大小展示\r\n        meta2d.fitView();\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    }\r\n  };\r\n  input.click();\r\n};\r\n\r\nconst downloadJson = () => {\r\n  const data: any = meta2d.data();\r\n  FileSaver.saveAs(\r\n    new Blob([JSON.stringify(data)], {\r\n      type: \"text/plain;charset=utf-8\",\r\n    }),\r\n    `${data.name || \"le5le.meta2d\"}.json`,\r\n  );\r\n};\r\n\r\nconst downloadPng = () => {\r\n  let name = (meta2d.store.data as any).name;\r\n  if (name) {\r\n    name += \".png\";\r\n  }\r\n  meta2d.downloadPng(name);\r\n};\r\n\r\n// 判断该画笔 是否是组合为状态中 展示的画笔\r\nfunction isShowChild(pen: any, store: any) {\r\n  let selfPen = pen;\r\n  while (selfPen && selfPen.parentId) {\r\n    const oldPen = selfPen;\r\n    selfPen = store.pens[selfPen.parentId];\r\n    const showChildIndex = selfPen?.calculative?.showChild;\r\n    if (showChildIndex != undefined) {\r\n      const showChildId = selfPen.children[showChildIndex];\r\n      if (showChildId !== oldPen.id) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n// 有 bug, 先不用\r\nconst downloadSvg = () => {\r\n  if (!C2S) {\r\n    MessagePlugin.error(\"请先加载乐吾乐官网下的canvas2svg.js\");\r\n    return;\r\n  }\r\n\r\n  const rect: any = meta2d.getRect();\r\n  rect.x -= 10;\r\n  rect.y -= 10;\r\n  const ctx = new C2S(rect.width + 20, rect.height + 20);\r\n  ctx.textBaseline = \"middle\";\r\n  for (const pen of meta2d.store.data.pens) {\r\n    if (pen.visible == false || !isShowChild(pen, meta2d.store)) {\r\n      continue;\r\n    }\r\n    meta2d.renderPenRaw(ctx, pen, rect);\r\n  }\r\n\r\n  let mySerializedSVG = ctx.getSerializedSvg();\r\n  if (meta2d.store.data.background) {\r\n    mySerializedSVG = mySerializedSVG.replace(\"{{bk}}\", \"\");\r\n    mySerializedSVG = mySerializedSVG.replace(\r\n      \"{{bkRect}}\",\r\n      `<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"${meta2d.store.data.background}\"></rect>`,\r\n    );\r\n  } else {\r\n    mySerializedSVG = mySerializedSVG.replace(\"{{bk}}\", \"\");\r\n    mySerializedSVG = mySerializedSVG.replace(\"{{bkRect}}\", \"\");\r\n  }\r\n\r\n  mySerializedSVG = mySerializedSVG.replace(/--le5le--/g, \"&#x\");\r\n\r\n  const urlObject: any = (window as any).URL || window;\r\n  const export_blob = new Blob([mySerializedSVG]);\r\n  const url = urlObject.createObjectURL(export_blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.setAttribute(\r\n    \"download\",\r\n    `${(meta2d.store.data as any).name || \"le5le.meta2d\"}.svg`,\r\n  );\r\n  a.setAttribute(\"href\", url);\r\n  const evt = document.createEvent(\"MouseEvents\");\r\n  evt.initEvent(\"click\", true, true);\r\n  a.dispatchEvent(evt);\r\n};\r\n\r\nconst onUndo = () => {\r\n  meta2d.undo();\r\n};\r\n\r\nconst onRedo = () => {\r\n  meta2d.redo();\r\n};\r\n\r\nconst onCut = () => {\r\n  meta2d.cut();\r\n};\r\n\r\nconst onCopy = () => {\r\n  meta2d.copy();\r\n};\r\n\r\nconst onPaste = () => {\r\n  meta2d.paste();\r\n};\r\n\r\nconst onAll = () => {\r\n  meta2d.activeAll();\r\n};\r\n\r\nconst onDelete = () => {\r\n  meta2d.delete();\r\n};\r\n\r\nconst { saveBlueprintShow } = useData(true);\r\nconst customToolbarClick = (code?: string) => {\r\n  if (code == \"svg\") {\r\n    readSVGFile((res: { data: string }) => {\r\n      parseSvgStr(res.data);\r\n    });\r\n    return;\r\n  }\r\n  if (code == \"save\") {\r\n    // 保存图纸\r\n    saveBlueprintShow();\r\n    return;\r\n  }\r\n\r\n  meta2d.toggleAnchorMode();\r\n  // TODO: 其他操作\r\n};\r\n\r\nconst onAddShape = (event: DragEvent | MouseEvent, name: string) => {\r\n  event.stopPropagation();\r\n  let data: any;\r\n  if (name === \"text\") {\r\n    // 构建一个文本图元\r\n    data = {\r\n      text: \"text\",\r\n      width: 100,\r\n      height: 20,\r\n      name: \"text\",\r\n    };\r\n  } else if (name === \"line\") {\r\n    // 构建一个直线图元\r\n    data = {\r\n      anchors: [\r\n        { id: \"0\", x: 1, y: 0 },\r\n        { id: \"1\", x: 0, y: 1 },\r\n      ],\r\n      width: 100,\r\n      height: 100,\r\n      name: \"line\",\r\n      lineName: \"line\",\r\n      type: 1,\r\n    };\r\n  }\r\n  if (!(event as DragEvent).dataTransfer) {\r\n    // 支持点击画布添加\r\n    meta2d.canvas.addCaches = deepClone([data]);\r\n  } else {\r\n    // 支持拖拽添加\r\n    (event as DragEvent).dataTransfer?.setData(\"Meta2d\", JSON.stringify(data));\r\n  }\r\n};\r\n\r\nconst onScaleDefault = () => {\r\n  meta2d.scale(1);\r\n  meta2d.centerView();\r\n};\r\n\r\nconst onScaleWindow = () => {\r\n  meta2d.fitView();\r\n};\r\n\r\nconst onView = () => {\r\n  // 先停止动画，避免数据波动\r\n  meta2d.stopAnimate();\r\n  // 本地存储\r\n  const data: any = meta2d.data();\r\n  localStorage.setItem(\"meta2d\", JSON.stringify(data));\r\n  emit(\"view\", data);\r\n\r\n  if (globalThis.$_meta2d_singleton) {\r\n    // 新窗口打开预览页面\r\n    if (location.hash) {\r\n      window.open(`#/preview?r=${Date.now()}&id=${data._id || ''}`, \"_blank\");\r\n    } else {\r\n      window.open(`/preview?r=${Date.now()}&id=${data._id || ''}`, \"_blank\");\r\n    }\r\n  }\r\n};\r\n\r\nconst selectPens = (type?: number | string) => {\r\n  if (type == \"none\") {\r\n    meta2d.inactive();\r\n    return;\r\n  }\r\n  const data = meta2d.data();\r\n  const pens = data.pens.filter((pen: Pen) => {\r\n    if (type) {\r\n      return pen.type === type;\r\n    } else {\r\n      return pen.type != 1;\r\n    }\r\n  });\r\n\r\n  // * 数据量大时，频繁查找会导致卡顿，但官方没有批量查询的 api，暂时无法解决\r\n  const penList: Pen[] = [];\r\n  pens.forEach((pen: Pen) => {\r\n    if (meta2d.findOne(pen.id as string)) {\r\n      penList.push(meta2d.findOne(pen.id as string) as Pen);\r\n    }\r\n  });\r\n\r\n  meta2d.active(penList);\r\n};\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.app-header {\r\n  display: flex;\r\n  height: 40px;\r\n  padding: 0 12px;\r\n  position: relative;\r\n  border-bottom: 1px solid var(--color-border);\r\n  z-index: 2;\r\n\r\n  .logo {\r\n    display: flex;\r\n    align-items: center;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    padding-left: 0;\r\n    cursor: pointer;\r\n\r\n    img {\r\n      height: 20px;\r\n      margin-right: 6px;\r\n    }\r\n  }\r\n\r\n  a {\r\n    display: flex;\r\n    padding: 0 8px;\r\n    margin: 0 8px;\r\n    align-items: center;\r\n    color: var(--color);\r\n    text-decoration: none;\r\n    white-space: nowrap;\r\n\r\n    &:hover {\r\n      color: var(--color-primary);\r\n    }\r\n\r\n    svg {\r\n      font-size: 15px;\r\n      margin: 2px 4px 0 0;\r\n    }\r\n\r\n    &.active {\r\n      background-color: var(--color-primary-hover);\r\n      color: #ffffff;\r\n    }\r\n\r\n    .button__text {\r\n      margin-right: 5px;\r\n    }\r\n\r\n  }\r\n\r\n  svg {\r\n    height: 40px;\r\n    margin: 0 8px;\r\n\r\n    &:hover {\r\n      color: var(--color-primary);\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n</style>\r\n\r\n<style>\r\n.t-dropdown__item-text {\r\n  a {\r\n    color: var(--color);\r\n    text-decoration: none;\r\n    white-space: nowrap;\r\n\r\n    &:hover {\r\n      color: var(--color-primary);\r\n    }\r\n  }\r\n}\r\n</style>\r\n","/*\r\n * 直线连线交叉问题,在画布上，当2条或多条线交叉时，\r\n * 其中一条线会弯曲显示，表明这2条或多条线之间，不存在交叉。\r\n * author: Joseph Ho\r\n * email: hejin@le5le.com\r\n * date: 2022.09.09\r\n*/\r\nimport { s8 } from '@meta2d/core';\r\nenum PenType {\r\n  Node,\r\n  Line,\r\n}\r\nenum PrevNextType {\r\n  Mirror,\r\n  Bilateral,\r\n  Free,\r\n}\r\ninterface PurePoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n// 相交点的半径\r\nlet radius = 1;\r\n// 判断点在线上的偏移值\r\nconst dotHitOffset = 2;\r\n// 锚点坐标误差偏移值,用于去掉重复锚点\r\nconst anchorOffsetXY = 0.000001;\r\n// 锚点数组\r\nlet anchors = [];\r\n// mousedown到up的标志位,标识一整个鼠标down到up的动作\r\nlet downToUpFlag = false;\r\n// 图纸渲染完成是否默认相交弯曲\r\nlet isDefaultCross = false;\r\nconst crossLines = ['line', 'polyline'];\r\nexport function lineCross(defaultCross: any) {\r\n  (window as any).meta2d.on('mouseup', mouseUp);\r\n  (window as any).meta2d.on('mousedown', mouseDown);\r\n  (window as any).meta2d.on('add', add);\r\n  (window as any).meta2d.on('active', active);\r\n  isDefaultCross = defaultCross;\r\n  (window as any).meta2d.on('opened', opened);\r\n}\r\nexport function handleLineCross(flag: any) {\r\n  mouseDown();\r\n  mouseUp(flag);\r\n}\r\nfunction opened() {\r\n  // 如果需要默认相交弯曲，则走以下逻辑\r\n  if (isDefaultCross) {\r\n    handleLineCross(undefined);\r\n  }\r\n}\r\nfunction active() {\r\n  downToUpFlag = true;\r\n}\r\nfunction add() {\r\n  downToUpFlag = true;\r\n}\r\nfunction mouseDown() {\r\n  downToUpFlag = true;\r\n}\r\nfunction clearIntersect(e) {\r\n  let worldAnchors = [], ls = [];\r\n  // 画布活动节点\r\n  const pens = e ? (window as any).meta2d.store.active : (window as any).meta2d.store.data.pens;\r\n  const actives = pens.filter(el => el);\r\n  // 活动的连线，包括直线和线段\r\n  // ls = actives.filter(pen => pen.type === PenType.Line && crossLines.indexOf(pen.lineName) !== -1);\r\n  for (let i = 0; i < actives.length; i++) {\r\n    const pen = actives[i];\r\n    if (pen.type === PenType.Line && crossLines.indexOf(pen.lineName) !== -1) {\r\n      // 添加直线和线段节点\r\n      ls.push(pen);\r\n    } else if (pen.connectedLines && pen.connectedLines.length > 0) {\r\n      // 添加连接节点的连线\r\n      for (let j = 0; j < pen.connectedLines.length; j++) {\r\n        const item = pen.connectedLines[j];\r\n        ls.push((window as any).meta2d.find(item.lineId)[0]);\r\n      }\r\n    }\r\n    // 找出被压线的连线\r\n    const ll = (window as any).meta2d.store.data.pens.filter(el => el.intersectLines\r\n      && el.intersectLines.findIndex(item => item.id === pen.id) !== -1);\r\n    ls.push(...ll);\r\n  }\r\n  ls = ls.filter(el => el);\r\n  // mouseDown的事件回调中去删除intersect=true的锚点\r\n  for (let i = 0; i < ls.length; i++) {\r\n    const l = ls[i];\r\n    l.intersectLines = [];\r\n    if (ls[i] && ls[i].calculative) {\r\n      worldAnchors = ls[i].calculative.worldAnchors;\r\n      if (worldAnchors.length > 2) {\r\n        for (let j = 0; j < worldAnchors.length; j++) {\r\n          const an = worldAnchors[j];\r\n          if (an.next || an.prev) {\r\n            worldAnchors.splice(j, 1);\r\n            j--;\r\n          }\r\n        }\r\n        (window as any).meta2d.canvas.initLineRect(l);\r\n      }\r\n    }\r\n  }\r\n}\r\nfunction mouseUp(e: any) {\r\n  if (downToUpFlag) {\r\n    downToUpFlag = false;\r\n    setTimeout(() => {\r\n      // 画布活动节点\r\n      const pens = e ? (window as any).meta2d.store.active : (window as any).meta2d.store.data.pens;\r\n      // 弯曲的情况与pen的顺序有关，所以需要倒序\r\n      const actives = pens.filter(el => el).reverse();\r\n      // 活动的连线，包括直线和线段\r\n      let ls = [], passiveL = [];\r\n      // const ls = actives.filter(pen => pen.type === PenType.Line && crossLines.indexOf(pen.lineName) !== -1);\r\n      for (let i = 0; i < actives.length; i++) {\r\n        const pen = actives[i];\r\n        if (pen.type === PenType.Line && crossLines.indexOf(pen.lineName) !== -1) {\r\n          // 添加直线和线段节点\r\n          if (pen.connectedLines) {\r\n            // 删除连线的错误connectedLines连接关系\r\n            for (let v = 0; v < pen.connectedLines.length; v++) {\r\n              const element = pen.connectedLines[v];\r\n              let anchor = pen.anchors.find(anchor => anchor.id === element.anchor);\r\n              if (anchor && anchor.penId) {\r\n                let line = (window as any).meta2d.findOne(element.lineId);\r\n                if (!line) {\r\n                  continue;\r\n                }\r\n                if (line.connectedLines && line.connectedLines.length > 0) {\r\n                  let otherIndex = line.connectedLines.findIndex((connect) => connect.anchor === element.lineAnchor);\r\n                  line.connectedLines.splice(otherIndex, 1);\r\n                }\r\n                pen.connectedLines.splice(v, 1);\r\n                v--;\r\n              }\r\n            }\r\n          }\r\n\r\n          ls.push(pen);\r\n        } else if (pen.type !== PenType.Line && pen.connectedLines && pen.connectedLines.length > 0) {\r\n          // 添加连接节点的连线\r\n          for (let j = 0; j < pen.connectedLines.length; j++) {\r\n            const item = pen.connectedLines[j];\r\n            ls.push((window as any).meta2d.find(item.lineId)[0]);\r\n          }\r\n        }\r\n        // 找出被压线的连线\r\n        passiveL = (window as any).meta2d.store.data.pens.filter(el => el.intersectLines && el.intersectLines.findIndex(item => item.id === pen.id) !== -1);\r\n        ls.unshift(...passiveL);\r\n      }\r\n      // 过滤出所有的连线，包括直线和线段，不包括acitve里面的连线\r\n      const lines = (window as any).meta2d.store.data.pens.filter(pen => pen.type === PenType.Line\r\n        && crossLines.indexOf(pen.lineName) !== -1);\r\n      // 判断压线之前先清空相交情况\r\n      clearIntersect(e);\r\n      ls = ls.filter(el => el);\r\n      for (let i = 0; i < ls.length; i++) {\r\n        const initiativeAnchors = ls[i].calculative.worldAnchors.filter(el => !el.next && !el.prev);\r\n        // 重置锚点数组\r\n        anchors = [];\r\n        for (let m = 0; m < initiativeAnchors.length; m++) {\r\n          if (m !== initiativeAnchors.length - 1) {\r\n            // 连接线的两个锚点\r\n            const l1 = initiativeAnchors[m];\r\n            const l11 = initiativeAnchors[m + 1];\r\n            for (let j = 0; j < lines.length; j++) {\r\n              // 重置半径\r\n              radius = 3;\r\n              // 根据线宽计算新的相交圆的半径\r\n              radius += (lines[j].lineWidth / ls[i].lineWidth) * ls[i].lineWidth;\r\n              // 乘以当前画布缩放比\r\n              radius *= (window as any).meta2d.store.data.scale;\r\n              const passiveAnchors = lines[j].calculative.worldAnchors.filter(el => !el.next && !el.prev);\r\n              for (let n = 0; n < passiveAnchors.length; n++) {\r\n                if (n !== passiveAnchors.length - 1) {\r\n                  // 被相交线的两个锚点\r\n                  const l2 = passiveAnchors[n];\r\n                  const l22 = passiveAnchors[n + 1];\r\n                  // 判断两条直线是否相交，当onLine1和onLine2都为true时，则相交\r\n                  const { onLine1, onLine2, x, y } = checkLineIntersection(l1.x, l1.y, l11.x, l11.y, l2.x, l2.y, l22.x, l22.y);\r\n                  // 如果两条线段相交\r\n                  if (onLine1 && onLine2) {\r\n                    // 去被连接线的相交线数组查找是否已经与连接线相交，是则跳过本次循环，否则继续\r\n                    if (lines[j].intersectLines) {\r\n                      const tIndex = lines[j].intersectLines.findIndex(el => el.id === ls[i].id\r\n                        && el.fromAnchorIndex === n && el.toAnchorIndex === m);\r\n                      if (tIndex !== -1) {\r\n                        continue;\r\n                      }\r\n                    }\r\n                    // 更新连接线的相交线数组\r\n                    if (!ls[i].intersectLines) {\r\n                      // 如果相交，则把被相交的线id放到连接线的intersectLines数组\r\n                      ls[i].intersectLines = [];\r\n                      ls[i].intersectLines.push({ fromAnchorIndex: m, toAnchorIndex: n, id: lines[j].id });\r\n                    } else {\r\n                      const index = ls[i].intersectLines.findIndex(el => el.id === lines[j].id && el.fromAnchorIndex === m && el.toAnchorIndex === n);\r\n                      if (index === -1) {\r\n                        ls[i].intersectLines.push({ fromAnchorIndex: m, toAnchorIndex: n, id: lines[j].id });\r\n                      }\r\n                    }\r\n                    // 算出拖动线条的直线方程式\r\n                    const { a, b, c } = lineFromPoints(l1, l11);\r\n                    const k = - (a / b);\r\n                    // 以相交点为圆心，找到圆与线相交的两个点，作为锚点\r\n                    let p1: PurePoint = { x: 0, y: 0 }, p2: PurePoint = { x: 0, y: 0 };\r\n                    const deltaX = Math.sqrt((radius * radius) / (k * k + 1));\r\n                    p1.x = x - deltaX;\r\n                    p1.y = k * p1.x;\r\n                    p2.x = x + deltaX;\r\n                    p2.y = k * p2.x;\r\n                    // 求出经过圆心的直线与圆的两个交点\r\n                    const ret = inteceptCircleLineSeg({ radius, x, y }, { p1: l1, p2: l11 });\r\n                    // 只有圆与线有2个端点才弯曲显示\r\n                    if (ret.length === 2) {\r\n                      let k1 = 1;\r\n                      if (a !== 0) {\r\n                        // 垂直相交线的斜率\r\n                        k1 = b / a;\r\n                      } else {\r\n                        // a=0,则为平行于x轴的线\r\n                        k1 = y;\r\n                      }\r\n\r\n                      const deltaX1 = Math.sqrt((radius * radius) / (k1 * k1 + 1));\r\n                      const deltaY1 = k1 * deltaX1;\r\n                      // 锚点的两个控制点\r\n                      let p4: PurePoint = { x: 0, y: 0 }, p5: PurePoint = { x: 0, y: 0 };\r\n                      // 判断垂直相交线的斜率是否大于0\r\n                      if (-k1 < 0) {\r\n                        p4.x = ret[0].x - deltaX1;\r\n                        p4.y = ret[0].y - deltaY1;\r\n                        p5.x = ret[1].x - deltaX1;\r\n                        p5.y = ret[1].y - deltaY1;\r\n                      } else {\r\n                        p4.x = ret[0].x + deltaX1;\r\n                        p4.y = ret[0].y + deltaY1;\r\n                        p5.x = ret[1].x + deltaX1;\r\n                        p5.y = ret[1].y + deltaY1;\r\n                      }\r\n                      // 找到相交点所在正确的线段l3\r\n                      let l3 = { x: 0, y: 0, id: '' };\r\n                      for (let u = 0; u < initiativeAnchors.length; u++) {\r\n                        if (u !== initiativeAnchors.length - 1) {\r\n                          const u1 = initiativeAnchors[u];\r\n                          const u11 = initiativeAnchors[u + 1];\r\n                          const cross = calcIsInsideThickLineSegment(u1, u11, { x, y }, dotHitOffset);\r\n                          if (cross) {\r\n                            l3.x = u1.x;\r\n                            l3.y = u1.y;\r\n                            l3.id = u1.id;\r\n                            break;\r\n                          }\r\n                        }\r\n                      }\r\n                      const an1 = {\r\n                        id: s8(),\r\n                        penId: ls[i].id,\r\n                        x: ret[0].x,\r\n                        y: ret[0].y,\r\n                        intersect: true,\r\n                        hidden: true,\r\n                        locked: 2,\r\n                        lastAnchorIndex: l3.id,\r\n                        brotherId: \"\",\r\n                        next: {\r\n                          penId: ls[i].id,\r\n                          x: p4.x,\r\n                          y: p4.y,\r\n                        },\r\n                        prev: {\r\n                          penId: ls[i].id,\r\n                          x: ret[0].x,\r\n                          y: ret[0].y,\r\n                        },\r\n                        prevNextType: PrevNextType.Bilateral\r\n                      };\r\n                      const an2 = {\r\n                        id: s8(),\r\n                        penId: ls[i].id,\r\n                        x: ret[1].x,\r\n                        y: ret[1].y,\r\n                        intersect: true,\r\n                        hidden: true,\r\n                        locked: 2,\r\n                        brotherId: \"\",\r\n                        lastAnchorIndex: l3.id,\r\n                        next: {\r\n                          penId: ls[i].id,\r\n                          x: ret[1].x,\r\n                          y: ret[1].y,\r\n                        },\r\n                        prev: {\r\n                          penId: ls[i].id,\r\n                          x: p5.x,\r\n                          y: p5.y,\r\n                        },\r\n                        prevNextType: PrevNextType.Bilateral\r\n                      };\r\n                      an1.brotherId = an2.id;\r\n                      an2.brotherId = an1.id;\r\n                      anchors.push(...[an1, an2]);\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n\r\n            }\r\n          }\r\n        }\r\n        if (anchors.length > 0) {\r\n          // 对所有的相交锚点按照lastAnchorIndex进行分组排序\r\n          // anchors.sort((a, b) => a.lastAnchorIndex - b.lastAnchorIndex);\r\n          // 对所有的相交锚点按照相对参考锚点的距离大小排序\r\n          anchors.sort((a, b) => {\r\n            if (a.lastAnchorIndex === b.lastAnchorIndex) {\r\n              const l3 = initiativeAnchors.find(item => item.id === a.lastAnchorIndex);\r\n              if (l3) {\r\n                return getDistance(a.x, a.y, l3.x, l3.y) - getDistance(b.x, b.y, l3.x, l3.y);\r\n              } else {\r\n                return -1;\r\n              }\r\n            } else {\r\n              return -1;\r\n            }\r\n          });\r\n          // 处理圆弧相交的情况,超过2对及以上才需要比较\r\n          let comparedIds = []; // 记录已经比较过距离的锚点对\r\n          let neighbourIds = [];\r\n          let gapOverFlag = -1; // 间距起始与结束标志位\r\n          for (let m = 0, len = anchors.length; m < len; m++) {\r\n            const an1 = anchors[m];\r\n            if (comparedIds.indexOf(an1.id) !== -1) {\r\n              continue;\r\n            }\r\n            const brother = anchors.find(el => el.id === an1.brotherId);\r\n            comparedIds.push(...[an1.id, brother.id]);\r\n            for (let n = m + 1; n < len; n++) {\r\n              const an2 = anchors[n];\r\n              const otherBrother = anchors.find(el => el.id === an2.brotherId);\r\n              comparedIds.push(...[an2.id, otherBrother.id]);\r\n              if (an1.brotherId !== an2.id) {\r\n                if ((getDistance(an1.x, an1.y, an2.x, an2.y) < radius * 2) &&\r\n                  (getDistance(an1.x, an1.y, an2.x, an2.y) > anchorOffsetXY)) {\r\n                  gapOverFlag = 1;\r\n                  if (neighbourIds.indexOf(an1.id) === -1) {\r\n                    neighbourIds.push(...[an1.id, brother.id]);\r\n                  }\r\n                  const otherBrother = anchors.find(el => el.id === an2.brotherId);\r\n                  if (neighbourIds.indexOf(an2.id) === -1) {\r\n                    neighbourIds.push(...[an2.id, otherBrother.id]);\r\n                  }\r\n                } else {\r\n                  if (gapOverFlag === 1) {\r\n                    gapOverFlag = -1;\r\n                    const index = comparedIds.findIndex(el => el === an2.id);\r\n                    comparedIds.splice(index, 1);\r\n                    const brotherIndex = comparedIds.findIndex(el => el === an2.brotherId);\r\n                    comparedIds.splice(brotherIndex, 1);\r\n                    break;\r\n                  }\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n          }\r\n          for (let k = 0; k < anchors.length; k++) {\r\n            const an = anchors[k];\r\n            if (\r\n              neighbourIds.indexOf(an.id) !== -1\r\n            ) {\r\n              anchors.splice(k, 1);\r\n              k--;\r\n            }\r\n          }\r\n          // X,Y坐标相近的锚点成对去重\r\n          for (let p = 0, len = anchors.length; p < len; p++) {\r\n            const an1 = anchors[p];\r\n            for (let o = p + 1; o < len; o++) {\r\n              const an2 = anchors[o];\r\n              if (getDistance(an1.x, an1.y, an2.x, an2.y) <= anchorOffsetXY) {\r\n                anchors.splice(o, 1);\r\n                let brotherIndex = anchors.findIndex(el => el.id === an2.brotherId);\r\n                if (brotherIndex !== -1) {\r\n                  anchors.splice(brotherIndex, 1);\r\n                }\r\n                o--;\r\n                len = anchors.length;\r\n              }\r\n            }\r\n          }\r\n          // 对每个新增锚点按照正确的顺序插入到worldAnchors数组中\r\n          let lastIndex = -1, index = -1, count = 0;\r\n          for (let k = 0; k < anchors.length; k++) {\r\n            const an = anchors[k];\r\n            if (lastIndex === -1 || (lastIndex !== -1 && lastIndex !== an.lastAnchorIndex)) {\r\n              // 找到相对锚点的索引\r\n              index = ls[i].calculative.worldAnchors.findIndex(el => el.id === an.lastAnchorIndex);\r\n              count = 0;\r\n            } else if (lastIndex === an.lastAnchorIndex) {\r\n              count++;\r\n            }\r\n            const tIndex = ls[i].calculative.worldAnchors.findIndex(el => {\r\n              return el.x === an.x && el.y === an.y && el.penId === an.penId;\r\n            });\r\n            // 避免重复添加相交锚点\r\n            if (tIndex === -1) {\r\n              ls[i].calculative.worldAnchors.splice(index + count + 1, 0, an);\r\n              lastIndex = an.lastAnchorIndex;\r\n            }\r\n          }\r\n          (window as any).meta2d.canvas.updateLines(ls[i]);\r\n          (window as any).meta2d.canvas.initLineRect(ls[i]);\r\n        }\r\n      }\r\n      (window as any).meta2d.render();\r\n    }, 0);\r\n  }\r\n\r\n}\r\n// 销毁订阅\r\nexport function clearLineCross() {\r\n  (window as any).meta2d.off('mouseup', mouseUp);\r\n  (window as any).meta2d.off('mousedown', mouseDown);\r\n  (window as any).meta2d.off('add', add);\r\n  (window as any).meta2d.off('active', active);\r\n  (window as any).meta2d.off('opened', opened);\r\n  anchors = [];\r\n}\r\n// 判断一个点是否在一条线上\r\nfunction calcIsInsideThickLineSegment(line1: any, line2: any, pnt: any, lineThickness: number) {\r\n  const L2 = (((line2.x - line1.x) * (line2.x - line1.x)) + ((line2.y - line1.y) * (line2.y - line1.y)));\r\n  if (L2 == 0) return false;\r\n  const r = (((pnt.x - line1.x) * (line2.x - line1.x)) + ((pnt.y - line1.y) * (line2.y - line1.y))) / L2;\r\n\r\n  //Assume line thickness is circular\r\n  if (r < 0) {\r\n    //Outside line1\r\n    return (Math.sqrt(((line1.x - pnt.x) * (line1.x - pnt.x)) + ((line1.y - pnt.y) * (line1.y - pnt.y))) <= lineThickness);\r\n  } else if ((0 <= r) && (r <= 1)) {\r\n    //On the line segment\r\n    const s = (((line1.y - pnt.y) * (line2.x - line1.x)) - ((line1.x - pnt.x) * (line2.y - line1.y))) / L2;\r\n    return (Math.abs(s) * Math.sqrt(L2) <= lineThickness);\r\n  } else {\r\n    //Outside line2\r\n    return (Math.sqrt(((line2.x - pnt.x) * (line2.x - pnt.x)) + ((line2.y - pnt.y) * (line2.y - pnt.y))) <= lineThickness);\r\n  }\r\n}\r\n// 求出一条经过圆心的直线与圆的两个交点\r\nfunction inteceptCircleLineSeg(circle: any, line: any) {\r\n  let a, b, c, d, u1, u2, ret, retP1, retP2, v1, v2;\r\n  v1 = {};\r\n  v2 = {};\r\n  v1.x = line.p2.x - line.p1.x;\r\n  v1.y = line.p2.y - line.p1.y;\r\n  v2.x = line.p1.x - circle.x;\r\n  v2.y = line.p1.y - circle.y;\r\n  b = (v1.x * v2.x + v1.y * v2.y);\r\n  c = 2 * (v1.x * v1.x + v1.y * v1.y);\r\n  b *= -2;\r\n  d = Math.sqrt(b * b - 2 * c * (v2.x * v2.x + v2.y * v2.y - circle.radius * circle.radius));\r\n  if (isNaN(d)) { // no intercept\r\n    return [];\r\n  }\r\n  u1 = (b - d) / c;  // these represent the unit distance of point one and two on the line\r\n  u2 = (b + d) / c;\r\n  retP1 = {};   // return points\r\n  retP2 = {};\r\n  ret = []; // return array\r\n  if (u1 <= 1 && u1 >= 0) {  // add point if on the line segment\r\n    retP1.x = line.p1.x + v1.x * u1;\r\n    retP1.y = line.p1.y + v1.y * u1;\r\n    ret[0] = retP1;\r\n  }\r\n  if (u2 <= 1 && u2 >= 0) {  // second add point if on the line segment\r\n    retP2.x = line.p1.x + v1.x * u2;\r\n    retP2.y = line.p1.y + v1.y * u2;\r\n    ret[ret.length] = retP2;\r\n  }\r\n  return ret;\r\n}\r\n\r\n// Function to find the line given two points 根据两个点返回一条直线的表达式\r\nfunction lineFromPoints(p1: PurePoint, p2: PurePoint) {\r\n  const a = p2.y - p1.y;\r\n  const b = p1.x - p2.x;\r\n  const c = a * (p1.x) + b * (p1.y);\r\n  return { a, b, c };\r\n}\r\n// 获取两个点之间的距离\r\nfunction getDistance(x1: number, y1: number, x2: number, y2: number) {\r\n  let y = x2 - x1;\r\n  let x = y2 - y1;\r\n\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n// 检测两条线段是否相交，并返回结果\r\nfunction checkLineIntersection(line1StartX: number, line1StartY: number, line1EndX: number, line1EndY: number, line2StartX: number, line2StartY: number, line2EndX, line2EndY: number) {\r\n  // if the lines intersect, the result contains the x and y of the intersection (treating the lines as infinite) and booleans for whether line segment 1 or line segment 2 contain the point\r\n  let denominator, a, b, numerator1, numerator2, result = {\r\n    x: null,\r\n    y: null,\r\n    onLine1: false,\r\n    onLine2: false\r\n  };\r\n  denominator = ((line2EndY - line2StartY) * (line1EndX - line1StartX)) - ((line2EndX - line2StartX) * (line1EndY - line1StartY));\r\n  if (denominator == 0) {\r\n    return result;\r\n  }\r\n  a = line1StartY - line2StartY;\r\n  b = line1StartX - line2StartX;\r\n  numerator1 = ((line2EndX - line2StartX) * a) - ((line2EndY - line2StartY) * b);\r\n  numerator2 = ((line1EndX - line1StartX) * a) - ((line1EndY - line1StartY) * b);\r\n  a = numerator1 / denominator;\r\n  b = numerator2 / denominator;\r\n\r\n  // if we cast these lines infinitely in both directions, they intersect here:\r\n  result.x = line1StartX + (a * (line1EndX - line1StartX));\r\n  result.y = line1StartY + (a * (line1EndY - line1StartY));\r\n  /*\r\n        // it is worth noting that this should be the same as:\r\n        x = line2StartX + (b * (line2EndX - line2StartX));\r\n        y = line2StartX + (b * (line2EndY - line2StartY));\r\n        */\r\n  // if line1 is a segment and line2 is infinite, they intersect if:\r\n  if (a > 0 && a < 1) {\r\n    result.onLine1 = true;\r\n  }\r\n  // if line2 is a segment and line1 is infinite, they intersect if:\r\n  if (b > 0 && b < 1) {\r\n    result.onLine2 = true;\r\n  }\r\n  // if line1 and line2 are segments, they intersect if both of the above are true\r\n  return result;\r\n}\r\n","<template>\r\n    <t-tabs v-model:value=\"activePanel\" @change=\"changeValue\">\r\n        <t-tab-panel v-for=\"(item, index) in tabs\" :key=\"index\" :value=\"item.value\" :label=\"item.label\">\r\n            <slot :name=\"item.slot\"></slot>\r\n        </t-tab-panel>\r\n    </t-tabs>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, ref, watch, } from 'vue'\r\n\r\ntype Tab = {\r\n    label: string,\r\n    value: number,\r\n    slot: string\r\n}\r\n\r\nconst props = defineProps({\r\n    tabs: {\r\n        type: Array as () => Tab[],\r\n        default: () => ([]),\r\n    },\r\n    defaultValue: {\r\n        type: Number,\r\n        default: 1,\r\n    }\r\n})\r\n\r\nconst activePanel = ref(props.defaultValue)\r\n\r\nwatch(() => props.defaultValue, (value) => {\r\n  activePanel.value = value\r\n})\r\n\r\nconst emit = defineEmits(['change'])\r\nconst changeValue = (value: number) => {\r\n    emit('change', value)\r\n}\r\n\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n\r\n</style>\r\n","<template>\r\n  <t-dialog\r\n    v-model:visible=\"visible\"\r\n    header=\"JavaScript\"\r\n    width=\"50%\"\r\n    :on-cancel=\"onCancel\"\r\n    :on-close=\"close\"\r\n    :on-confirm=\"onConfirmAnother\"\r\n  >\r\n    <t-space direction=\"vertical\" style=\"width: 100%\">\r\n      <code>function(data: any) { // data 为 MessageBus 消息里的 data 对象</code>\r\n      <vue-monaco-editor\r\n        v-model:value=\"code\"\r\n        theme=\"vs-dark\"\r\n        :options=\"MONACO_EDITOR_OPTIONS\"\r\n        style=\"height: 50vh\"\r\n        @mount=\"handleMount\"\r\n      />\r\n      <code>}</code>\r\n    </t-space>\r\n  </t-dialog>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, ref, defineExpose, shallowRef, defineEmits } from \"vue\";\r\nimport { VueMonacoEditor } from \"@guolao/vue-monaco-editor\";\r\nconst props = defineProps({});\r\n\r\nconst emit = defineEmits([\"confirm\"]);\r\nconst visible = ref(false);\r\n\r\nconst onConfirmAnother = (context: any) => {\r\n  visible.value = false;\r\n  emit(\"confirm\", code.value);\r\n};\r\nconst close = (context: any) => {\r\n  console.log(\"关闭弹窗，点击关闭按钮、按下ESC、点击蒙层等触发\", context);\r\n};\r\nconst onCancel = (context: any) => {\r\n  console.log(\"点击了取消按钮\", context);\r\n};\r\n\r\nconst open = (jsStr: string) => {\r\n  visible.value = true;\r\n  code.value = jsStr;\r\n};\r\n\r\ndefineExpose({\r\n  open,\r\n});\r\n\r\nconst MONACO_EDITOR_OPTIONS = {\r\n  automaticLayout: true,\r\n  formatOnType: true,\r\n  formatOnPaste: true,\r\n};\r\n\r\nconst code = ref(\"// some code...\");\r\nconst editorRef = shallowRef();\r\nconst handleMount = (editor: typeof VueMonacoEditor) =>\r\n  (editorRef.value = editor);\r\n\r\n// your action\r\nfunction formatCode() {\r\n  editorRef.value?.getAction(\"editor.action.formatDocument\").run();\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n:global(code) {\r\n    color: blue;\r\n    font-weight: bold;\r\n}\r\n</style>\r\n","<template>\r\n  <t-button block theme=\"primary\" @click=\"insert\">添加处理器</t-button>\r\n  <t-collapse class=\"meta-collapse\" expand-mutex @change=\"changeHandler\">\r\n    <t-collapse-panel\r\n      v-for=\"(item, index) in handlers\"\r\n      :key=\"index\"\r\n      header=\"处理器\"\r\n    >\r\n      <t-form labelAlign=\"left\">\r\n        <t-form-item label=\"行为\">\r\n          <t-select\r\n            v-model=\"item.action\"\r\n            :options=\"eventActionOptions\"\r\n            @change=\"eventChange\"\r\n          ></t-select>\r\n        </t-form-item>\r\n        <t-form-item label=\"目标\">\r\n          <t-button variant=\"text\" theme=\"primary\" @click=\"showSelect(index)\"\r\n            >选择目标图元</t-button\r\n          >\r\n        </t-form-item>\r\n        <template v-if=\"item.action === EventAction.SetProps\">\r\n          <t-row justify=\"start\">\r\n            <t-col :span=\"5\">\r\n              <div>属性</div>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <div>值</div>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"addProp\">\r\n                <t-icon name=\"add\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n          <t-row\r\n            v-for=\"(propItem, index) in propList\"\r\n            :key=\"index\"\r\n            justify=\"start\"\r\n            :gutter=\"4\"\r\n            style=\"margin-bottom: 4px\"\r\n          >\r\n            <t-col :span=\"5\">\r\n              <t-select\r\n                v-model=\"propItem.prop\"\r\n                :options=\"propOptions\"\r\n                @change=\"propChange(item)\"\r\n              ></t-select>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <t-input\r\n                v-model=\"propItem.value\"\r\n                @change=\"propChange(item)\"\r\n              ></t-input>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"deleteProp(propItem, item)\">\r\n                <t-icon name=\"delete\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n        </template>\r\n        <t-form-item label=\"字段名\">\r\n          <t-select\r\n            v-model=\"item.where.key\"\r\n            :options=\"wsMsgFields\"\r\n            @change=\"eventChange\"\r\n          ></t-select>\r\n        </t-form-item>\r\n\r\n        <t-form-item label=\"条件\">\r\n          <t-select\r\n            v-model=\"item.where.comparison\"\r\n            :options=\"comparisonOptions\"\r\n            @change=\"eventChange\"\r\n          ></t-select>\r\n        </t-form-item>\r\n\r\n        <t-form-item label=\"值\">\r\n          <t-input v-model=\"item.where.value\" @change=\"eventChange\"></t-input>\r\n        </t-form-item>\r\n      </t-form>\r\n      <template #headerRightContent>\r\n        <t-button\r\n          size=\"small\"\r\n          variant=\"outline\"\r\n          theme=\"danger\"\r\n          :style=\"{ marginLeft: '8px' }\"\r\n          @click=\"deleteEvent(item)\"\r\n        >\r\n          <t-icon name=\"delete\"></t-icon>\r\n        </t-button>\r\n      </template>\r\n    </t-collapse-panel>\r\n  </t-collapse>\r\n  <t-drawer\r\n    v-model:visible=\"drawerVisible\"\r\n    header=\"选择图元\"\r\n    size=\"40%\"\r\n    :on-confirm=\"onClickConfirm\"\r\n    :close-btn=\"true\"\r\n  >\r\n    <t-row v-if=\"currentHandler\" :gutter=\"10\" style=\"height: 100%\">\r\n      <t-col :span=\"4\" style=\"height: 100%\">\r\n        <t-form label-align=\"top\">\r\n          <t-form-item label=\"电路元件\" name=\"name\">\r\n            <t-select\r\n              v-model=\"currentHandler.tags\"\r\n              :options=\"tagOptions\"\r\n              placeholder=\"按标签选择\"\r\n              multiple\r\n              :minCollapsedNum=\"10\"\r\n              clearable\r\n            ></t-select>\r\n          </t-form-item>\r\n          <t-form-item label=\"图元标签\" name=\"tag\">\r\n            <t-input\r\n              v-model=\"currentHandler._tag\"\r\n              placeholder=\"输入自定义的标签进行查询，不做保存\"\r\n              clearable\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item>\r\n            <t-button block @click=\"findPens\">查询</t-button>\r\n          </t-form-item>\r\n          <t-form-item>\r\n            <t-tooltip content=\"符合条件的图元数量大时，会出现卡顿\">\r\n              <t-button block theme=\"warning\" @click=\"activePens\"\r\n                >选中图元</t-button\r\n              >\r\n            </t-tooltip>\r\n          </t-form-item>\r\n        </t-form>\r\n      </t-col>\r\n      <t-col :span=\"7\" style=\"height: 100%\">\r\n        <t-table\r\n          v-if=\"currentHandler\"\r\n          class=\"meta-table\"\r\n          row-key=\"id\"\r\n          :columns=\"columns\"\r\n          :data=\"penList.value\"\r\n          :selected-row-keys=\"currentHandler.ids\"\r\n          :scroll=\"{ type: 'virtual', rowHeight: 48, bufferSize: 30 }\"\r\n          style=\"height: 100%\"\r\n          @select-change=\"rehandleSelectChange\"\r\n        >\r\n        </t-table>\r\n      </t-col>\r\n    </t-row>\r\n  </t-drawer>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, ref, shallowReactive } from \"vue\";\r\nimport { EventAction, EventConfig } from \"../types/Event\";\r\nimport { MessagePlugin } from \"tdesign-vue-next\";\r\nimport ConfigList from \"../utils/electric-config.json\";\r\nimport { s12 } from \"@meta2d/core\";\r\n\r\nconst props = defineProps({\r\n  wsMsgFields: {\r\n    type: Array<any>,\r\n    default: () => [],\r\n  },\r\n  wsMsgHandlers: {\r\n    type: Array<any>,\r\n    default: () => [],\r\n  },\r\n});\r\n\r\nconst handlers = ref<any>(props.wsMsgHandlers);\r\n\r\nconst insert = () => {\r\n  handlers.value.push({\r\n    id: s12(),\r\n    action: EventAction.SetProps,\r\n    params: {\r\n      tags: [],\r\n      ids: [],\r\n    },\r\n    value: {},\r\n    where: {\r\n      key: \"\",\r\n      value: \"\",\r\n      comparison: \"\",\r\n    },\r\n  });\r\n};\r\n\r\nconst deleteEvent = (item: any) => {\r\n  handlers.value.splice(handlers.value.indexOf(item), 1);\r\n  eventChange();\r\n};\r\nconst emit = defineEmits([\"change\"]);\r\nconst eventChange = () => {\r\n  emit(\"change\", handlers.value);\r\n};\r\n\r\nconst eventActionOptions = [\r\n  {\r\n    label: \"更改属性\",\r\n    value: EventAction.SetProps,\r\n  },\r\n  {\r\n    label: \"执行动画\",\r\n    value: EventAction.StartAnimate,\r\n  },\r\n  {\r\n    label: \"暂停动画\",\r\n    value: EventAction.PauseAnimate,\r\n  },\r\n  {\r\n    label: \"停止动画\",\r\n    value: EventAction.StopAnimate,\r\n  },\r\n];\r\n\r\nconst propOptions = [\r\n  {\r\n    label: \"背景颜色\",\r\n    value: \"background\",\r\n  },\r\n  {\r\n    label: \"颜色\",\r\n    value: \"color\",\r\n  },\r\n  {\r\n    label: \"文字\",\r\n    value: \"text\",\r\n  },\r\n  {\r\n    label: \"进度\",\r\n    value: \"progress\",\r\n  },\r\n  {\r\n    label: \"显示\",\r\n    value: \"visible\",\r\n  },\r\n  {\r\n    label: \"状态\",\r\n    value: \"showChild\",\r\n  },\r\n];\r\nconst propList = ref<any>([]);\r\nconst addProp = () => {\r\n  if (propList.value.length >= 6) {\r\n    MessagePlugin.warning(\"最多只能添加6个属性\");\r\n    return;\r\n  }\r\n  propList.value.push({\r\n    prop: \"\",\r\n    value: \"\",\r\n  });\r\n};\r\n\r\nconst deleteProp = (item: any, event: EventConfig) => {\r\n  const index = propList.value.indexOf(item);\r\n  propList.value.splice(index, 1);\r\n  propChange(event)\r\n};\r\n\r\nconst propChange = (event: EventConfig) => {\r\n  const value: any = {};\r\n  propList.value.forEach((item: any) => {\r\n    value[item.prop] = item.value;\r\n  });\r\n  event.value = value;\r\n  emit(\"change\", handlers.value);\r\n};\r\n\r\nconst updatePropList = (index: number[]) => {\r\n  const event = handlers.value[Number(index)];\r\n  if (event.value && typeof event.value === \"object\") {\r\n    propList.value = Object.keys(event.value).map((key: string) => {\r\n      return {\r\n        prop: key,\r\n        value: event.value[key],\r\n      };\r\n    });\r\n  }\r\n};\r\n\r\nconst comparisonOptions = [\r\n  {\r\n    label: \"大于\",\r\n    value: \">\",\r\n  },\r\n  {\r\n    label: \"大于等于\",\r\n    value: \">=\",\r\n  },\r\n  {\r\n    label: \"小于\",\r\n    value: \"<\",\r\n  },\r\n  {\r\n    label: \"小于等于\",\r\n    value: \"<=\",\r\n  },\r\n  {\r\n    label: \"等于\",\r\n    value: \"=\",\r\n  },\r\n  {\r\n    label: \"不等于\",\r\n    value: \"!=\",\r\n  },\r\n];\r\n\r\nconst drawerVisible = ref(false);\r\n\r\nconst showSelect = (index: number) => {\r\n  changeHandler([index]);\r\n  drawerVisible.value = true;\r\n};\r\n\r\nconst currentHandler = shallowReactive<any>({\r\n  tags: [],\r\n  ids: [],\r\n  id: \"\",\r\n});\r\n\r\n/**\r\n * @description 点击折叠面板\r\n * @param value\r\n */\r\nconst changeHandler = (value: number[]) => {\r\n  if (!value.length) return;\r\n  // 拷贝\r\n  const item = JSON.parse(JSON.stringify(handlers.value[value[0]]));\r\n  if (item) {\r\n    currentHandler.tags = item.params.tags;\r\n    currentHandler.ids = filterIds(item.params.ids);\r\n    currentHandler.id = item.id;\r\n    updatePropList(value);\r\n    findPens();\r\n  }\r\n};\r\n\r\nconst tagOptions = ConfigList.map((item) => {\r\n  return {\r\n    label: item.释义,\r\n    value: item.元件类型,\r\n  };\r\n});\r\n\r\n// 清空不存在的图元ID\r\nfunction filterIds(ids: string[]) {\r\n  return ids.filter((id: string) => {\r\n    return !!meta2d.findOne(id);\r\n  });\r\n}\r\n\r\nconst onClickConfirm = () => {\r\n  drawerVisible.value = false;\r\n  // 更新 handlers\r\n  const item = handlers.value.find(\r\n    (item: any) => item.id === currentHandler.id,\r\n  );\r\n  if (item) {\r\n    item.params.tags = currentHandler.tags;\r\n    item.params.ids = filterIds(currentHandler.ids);\r\n    eventChange();\r\n  }\r\n};\r\n\r\nconst penList = shallowReactive<any>({\r\n  value: [],\r\n});\r\nconst columns = [\r\n  {\r\n    title: \"ID\",\r\n    colKey: \"id\",\r\n    type: \"multiple\",\r\n  },\r\n  {\r\n    title: \"图元名称\",\r\n    colKey: \"name\",\r\n  },\r\n  {\r\n    title: \"标签\",\r\n    colKey: \"tags\",\r\n  },\r\n  {\r\n    title: \"文字\",\r\n    colKey: \"text\",\r\n  },\r\n  {\r\n    title: \"描述\",\r\n    colKey: \"description\",\r\n  },\r\n];\r\nconst findPens = () => {\r\n  const data = meta2d.data();\r\n  if (currentHandler) {\r\n    if (currentHandler._tag) {\r\n      penList.value = meta2d.find(currentHandler._tag);\r\n      return;\r\n    } else if (currentHandler.tags.length) {\r\n      const pens: any[] = [];\r\n      currentHandler.tags.forEach((tag: string) => {\r\n        const list = meta2d.find(tag);\r\n        pens.push(...list);\r\n      });\r\n      // pens 去重\r\n      const sets = [...new Set(pens)];\r\n      // console.log(\"sets\", sets, pens);\r\n      setTimeout(() => {\r\n        penList.value = sets;\r\n      }, 1000);\r\n      return;\r\n    }\r\n  }\r\n  setTimeout(() => {\r\n    penList.value = data.pens;\r\n  }, 1000);\r\n};\r\n\r\nconst rehandleSelectChange = (value: string[], ctx: any) => {\r\n  currentHandler.ids = value;\r\n};\r\n\r\nconst activePens = () => {\r\n  if (currentHandler.ids.length) {\r\n    // 根据ID设置选中\r\n    const pens = currentHandler.ids\r\n      .map((id) => {\r\n        return meta2d.findOne(id);\r\n      })\r\n      .filter((pen) => !!pen);\r\n    meta2d.active(pens);\r\n  } else {\r\n    // 按标签查询图元\r\n    meta2d.active(penList.value);\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","<template>\r\n  <div>\r\n  <t-form labelAlign=\"left\">\r\n    <t-form-item label=\"时长\" name=\"name\">\r\n      <t-input-number\r\n        v-model=\"defaultScript.duration\"\r\n        placeholder=\"单位: ms\"\r\n        @change=\"eventChange\"\r\n      />\r\n    </t-form-item>\r\n  </t-form>\r\n  <t-button block theme=\"primary\" @click=\"insert\">添加脚本</t-button>\r\n  <t-collapse class=\"meta-collapse\" expand-mutex @change=\"changeHandler\">\r\n    <t-collapse-panel v-if=\"fields.length\" header=\"数据\">\r\n      <t-row justify=\"start\">\r\n        <t-col :span=\"5\">\r\n          <div>字段</div>\r\n        </t-col>\r\n        <t-col :span=\"5\">\r\n          <div>值</div>\r\n        </t-col>\r\n        <t-col :span=\"2\">\r\n          <t-button variant=\"text\" @click=\"addRowProp\">\r\n            <t-icon name=\"add\"></t-icon>\r\n          </t-button>\r\n        </t-col>\r\n      </t-row>\r\n      <t-row\r\n        v-for=\"(propItem, index) in rowPropList\"\r\n        :key=\"index\"\r\n        justify=\"start\"\r\n        :gutter=\"4\"\r\n        style=\"margin-bottom: 4px\"\r\n      >\r\n        <t-col :span=\"5\">\r\n          <t-select\r\n            v-model=\"propItem.prop\"\r\n            :options=\"fields\"\r\n            :keys=\"{ label: 'title', value: 'colKey' }\"\r\n            @change=\"rowPropChange\"\r\n          ></t-select>\r\n        </t-col>\r\n        <t-col :span=\"5\">\r\n          <t-input v-model=\"propItem.value\" @change=\"rowPropChange\"></t-input>\r\n        </t-col>\r\n        <t-col :span=\"2\">\r\n          <t-button variant=\"text\" @click=\"deleteRowProp(propItem)\">\r\n            <t-icon name=\"delete\"></t-icon>\r\n          </t-button>\r\n        </t-col>\r\n      </t-row>\r\n    </t-collapse-panel>\r\n    <t-collapse-panel\r\n      v-for=\"(item, index) in handlers\"\r\n      :key=\"index\"\r\n      :header=\"`脚本-${item.id}`\"\r\n    >\r\n      <t-form labelAlign=\"left\">\r\n        <t-form-item label=\"行为\">\r\n          <t-select\r\n            v-model=\"item.action\"\r\n            :options=\"eventActionOptions\"\r\n            @change=\"eventChange\"\r\n          ></t-select>\r\n        </t-form-item>\r\n        <t-form-item\r\n          v-if=\"\r\n            [\r\n              EventAction.SetProps,\r\n              EventAction.StartAnimate,\r\n              EventAction.StopAnimate,\r\n              EventAction.PauseAnimate,\r\n              ExtendAction.AnimateReverse,\r\n            ].includes(item.action)\r\n          \"\r\n          label=\"目标\"\r\n        >\r\n          <t-tag-input\r\n            v-model=\"item.target\"\r\n            placeholder=\"标签或ID\"\r\n            @change=\"eventChange\"\r\n          ></t-tag-input>\r\n        </t-form-item>\r\n        <template v-if=\"item.action === EventAction.SetProps\">\r\n          <t-row justify=\"start\">\r\n            <t-col :span=\"5\">\r\n              <div>属性</div>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <div>值</div>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"addProp\">\r\n                <t-icon name=\"add\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n          <t-row\r\n            v-for=\"(propItem, index) in propList\"\r\n            :key=\"index\"\r\n            justify=\"start\"\r\n            :gutter=\"4\"\r\n            style=\"margin-bottom: 4px\"\r\n          >\r\n            <t-col :span=\"5\">\r\n              <t-select\r\n                v-model=\"propItem.prop\"\r\n                :options=\"propOptions\"\r\n                @change=\"propChange(item)\"\r\n              ></t-select>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <t-input\r\n                v-model=\"propItem.value\"\r\n                @change=\"propChange(item)\"\r\n              ></t-input>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"deleteProp(propItem, item)\">\r\n                <t-icon name=\"delete\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n        </template>\r\n        <template v-else-if=\"item.action === EventAction.Dialog\">\r\n          <t-form-item label=\"窗口标题\">\r\n            <t-input\r\n              v-model=\"item.value\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item label=\"URL\">\r\n            <t-input\r\n              v-model=\"item.params\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"窗口宽度\">\r\n            <t-input-number\r\n              v-model=\"item.extend.width\"\r\n              @change=\"eventChange\"\r\n            ></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"窗口高度\">\r\n            <t-input-number\r\n              v-model=\"item.extend.height\"\r\n              @change=\"eventChange\"\r\n            ></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"X偏移\">\r\n            <t-input-number\r\n              v-model=\"item.extend.x\"\r\n              @change=\"eventChange\"\r\n            ></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"Y偏移\">\r\n            <t-input-number\r\n              v-model=\"item.extend.y\"\r\n              @change=\"eventChange\"\r\n            ></t-input-number>\r\n          </t-form-item>\r\n        </template>\r\n\r\n        <template v-else-if=\"[ExtendAction.Video, ExtendAction.ShowMeta2D].includes(item.action)\">\r\n          <t-form-item label=\"窗口标题\">\r\n            <t-input\r\n              v-model=\"item.params.title\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item :label=\"item.action == ExtendAction.Video ? '视频URL' : '图纸URL'\">\r\n            <t-input\r\n              v-model=\"item.params.url\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.params\" label=\"窗口宽度\">\r\n            <t-input\r\n              v-model=\"item.params.width\"\r\n              placeholder=\"示例：320, '500px', '80%'\"\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.params\" label=\"对话框类型\">\r\n            <t-select\r\n              v-model=\"item.params.mode\"\r\n              clearable\r\n              :options=\"dialogModeOptions\"\r\n              @change=\"eventChange\"\r\n            ></t-select>\r\n          </t-form-item>\r\n          <template v-if=\"item.params\">\r\n            <t-form-item label=\"标题栏上间距\">\r\n              <t-input\r\n                v-model=\"item.params.headerMarginTop\"\r\n                placeholder=\"示例：'10px'\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              ></t-input>\r\n            </t-form-item>\r\n            <t-form-item label=\"背景颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.backgroundColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item> \r\n            <t-form-item label=\"背景图片\">\r\n              <t-input v-model=\"item.params.backgroundImageUrl\" clearable @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n            <t-form-item label=\"标题颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.textColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"控制栏背景颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.controlBarBackgroundColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"控制栏按钮颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.controlColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"已播放进度颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.controlPlayProgressBarColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"已加载进度颜色\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"item.params.controlLoadProgressBarColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"eventChange\"\r\n              />\r\n            </t-form-item>\r\n          </template>\r\n        </template>\r\n        <template v-else-if=\"item.action === ExtendAction.ScriptEnd\">\r\n          <t-form-item label=\"业务名称\">\r\n            <t-input\r\n              v-model=\"item.name\"\r\n              placeholder=\"唯一标识，用于和其他业务联动\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-input>\r\n          </t-form-item>\r\n        </template>\r\n        <t-form-item\r\n          v-else-if=\"\r\n            item.action === ExtendAction.GoToView\r\n          \"\r\n          label=\"聚焦图元\"\r\n        >\r\n          <t-input\r\n            v-model=\"item.value\"\r\n            placeholder=\"要聚焦的目标图元标签或ID\"\r\n            clearable\r\n            @change=\"eventChange\"\r\n          ></t-input>\r\n        </t-form-item>\r\n\r\n        <t-form-item v-if=\"item.where\" label=\"触发条件\">\r\n          <t-select\r\n            v-model=\"item.where.type\"\r\n            :options=\"extendWhereTypeOptions\"\r\n            clearable\r\n            @change=\"eventChange\"\r\n          ></t-select>\r\n        </t-form-item>\r\n        <template\r\n          v-if=\"\r\n            item.where &&\r\n            item.where.type === ExtendActionEventNameMap.CustomMessage\r\n          \"\r\n        >\r\n          <t-form-item label=\"事件\">\r\n            <t-select\r\n              v-model=\"item.where.value\"\r\n              :options=\"extendWhereMessageTypeOptions\"\r\n              clearable\r\n              @change=\"whereValueChange\"\r\n            ></t-select>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.where.value === ExtendActionMessageTypeMap.VideoEnded\" label=\"事件来源\">\r\n            <t-select\r\n              v-model=\"item.where.key\"\r\n              :options=\"videoSourceOptions\"\r\n              clearable\r\n              @change=\"eventChange\"\r\n            ></t-select>\r\n          </t-form-item>\r\n          <t-form-item v-else-if=\"item.where.value === ExtendActionMessageTypeMap.ScriptEnded\" label=\"业务名称\">\r\n            <t-input v-model=\"item.where.key\" placeholder=\"其他联动业务中定义的唯一标识\" clearable @change=\"eventChange\"></t-input>\r\n          </t-form-item>\r\n        </template>\r\n      </t-form>\r\n      <template #headerRightContent>\r\n        <t-button\r\n          size=\"small\"\r\n          variant=\"outline\"\r\n          theme=\"danger\"\r\n          :style=\"{ marginLeft: '8px' }\"\r\n          @click=\"deleteEvent(item)\"\r\n        >\r\n          <t-icon name=\"delete\"></t-icon>\r\n        </t-button>\r\n      </template>\r\n    </t-collapse-panel>\r\n  </t-collapse>\r\n  </div>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, ref, computed, watch, } from \"vue\";\r\nimport {\r\n  EventAction,\r\n  ExtendAction,\r\n  EventConfig,\r\n  ExtendActionEventNameMap,\r\n  ExtendActionMessageTypeMap,\r\n} from \"../types/Event\";\r\nimport { MessagePlugin } from \"tdesign-vue-next\";\r\nimport { s12 } from \"@meta2d/core\";\r\n\r\ntype HandlerType = {\r\n  id: string;\r\n  name?: string;\r\n  action: EventAction | ExtendAction;\r\n  value: any;\r\n  target: any[];\r\n  params: any;\r\n  where: {\r\n    type: ExtendActionEventNameMap;\r\n    value: any;\r\n    key: string | null;\r\n  };\r\n}\r\n\r\nconst props = defineProps({\r\n  fields: {\r\n    type: Array<any>,\r\n    default: () => [],\r\n  },\r\n\r\n  defaultScript: {\r\n    type: Object,\r\n    default: () => ({}),\r\n  },\r\n\r\n  scripts: {\r\n    type: Array,\r\n  }\r\n});\r\n\r\nconst handlers = ref<Array<HandlerType>>(props.defaultScript?.handlers || []);\r\n\r\nconst insert = () => {\r\n  handlers.value.push({\r\n    id: s12(),\r\n    action: EventAction.SetProps,\r\n    value: {},\r\n    target: [],\r\n    params: {},\r\n    where: {\r\n      type: ExtendActionEventNameMap.CustomMessage,\r\n      value: null,\r\n      key: null,\r\n    },\r\n  });\r\n};\r\n\r\nconst deleteEvent = (item: any) => {\r\n  handlers.value.splice(handlers.value.indexOf(item), 1);\r\n  eventChange();\r\n};\r\nconst emit = defineEmits([\"change\"]);\r\nconst eventChange = () => {\r\n  emit(\"change\", {\r\n    sid: props.defaultScript?.sid || s12(),\r\n    duration: props.defaultScript?.duration || 3000,\r\n    rowPropList: rowPropList.value,\r\n    handlers: handlers.value,\r\n  });\r\n};\r\n\r\nconst eventActionOptions = [\r\n  {\r\n    label: \"更改属性\",\r\n    value: EventAction.SetProps,\r\n  },\r\n  {\r\n    label: \"执行动画\",\r\n    value: EventAction.StartAnimate,\r\n  },\r\n  {\r\n    label: \"暂停动画\",\r\n    value: EventAction.PauseAnimate,\r\n  },\r\n  {\r\n    label: \"停止动画\",\r\n    value: EventAction.StopAnimate,\r\n  },\r\n  {\r\n    label: \"弹窗\",\r\n    value: EventAction.Dialog,\r\n  },\r\n\r\n  // ! 官方没有定义的扩展类型\r\n  {\r\n    label: \"关闭弹窗\",\r\n    value: ExtendAction.DialogClose,\r\n  },\r\n  {\r\n    label: \"连线动画反向\",\r\n    value: ExtendAction.AnimateReverse,\r\n  },\r\n  {\r\n    label: \"视频\",\r\n    value: ExtendAction.Video,\r\n  },\r\n  {\r\n    label: '执行结束',\r\n    value: ExtendAction.ScriptEnd,\r\n  },\r\n  {\r\n    label: '打开图纸',\r\n    value: ExtendAction.ShowMeta2D,\r\n  },\r\n  {\r\n    label: '聚焦',\r\n    value: ExtendAction.GoToView,\r\n  },\r\n];\r\n\r\nconst dialogModeOptions = [\r\n  {\r\n    label: \"模态\",\r\n    value: \"modal\",\r\n  },\r\n  {\r\n    label: \"全屏\",\r\n    value: \"full-screen\",\r\n  },\r\n  {\r\n    label: '非模态',\r\n    value: 'modeless'\r\n  }\r\n];\r\n\r\nconst extendWhereTypeOptions = [\r\n  {\r\n    label: \"扩展事件\",\r\n    value: ExtendActionEventNameMap.CustomMessage,\r\n  },\r\n];\r\n\r\nconst extendWhereMessageTypeOptions = [\r\n  {\r\n    label: \"视频播放结束\",\r\n    value: ExtendActionMessageTypeMap.VideoEnded,\r\n  },\r\n  {\r\n    label: '脚本结束',\r\n    value: ExtendActionMessageTypeMap.ScriptEnded,\r\n  },\r\n];\r\n\r\nconst videoSourceOptions = ref<Array<any>>([])\r\n\r\nconst whereValueChange = (whereMessageType?: any) => {\r\n  if (Array.isArray(props.scripts)) {\r\n    const res: any[] = []\r\n    props.scripts.forEach((script: any) => {\r\n      if (Array.isArray(script.handlers)) {\r\n        script.handlers.forEach((handler: any) => {\r\n          if (handler.action === ExtendAction.Video) {\r\n            res.push({\r\n              label: handler.params?.title || handler.params?.url,\r\n              value: handler.id,\r\n            })\r\n          }\r\n        })\r\n      }\r\n    })\r\n    videoSourceOptions.value = res\r\n  }\r\n\r\n  eventChange();\r\n\r\n}\r\n\r\n\r\nconst propOptions = [\r\n  {\r\n    label: \"背景颜色\",\r\n    value: \"background\",\r\n  },\r\n  {\r\n    label: \"颜色\",\r\n    value: \"color\",\r\n  },\r\n  {\r\n    label: \"文字\",\r\n    value: \"text\",\r\n  },\r\n  {\r\n    label: \"进度\",\r\n    value: \"progress\",\r\n  },\r\n  {\r\n    label: \"显示\",\r\n    value: \"visible\",\r\n  },\r\n  {\r\n    label: \"状态\",\r\n    value: \"showChild\",\r\n  },\r\n];\r\nconst propList = ref<any>([]);\r\nconst addProp = () => {\r\n  if (propList.value.length >= 6) {\r\n    MessagePlugin.warning(\"最多只能添加6个属性\");\r\n    return;\r\n  }\r\n  propList.value.push({\r\n    prop: \"\",\r\n    value: \"\",\r\n  });\r\n};\r\n\r\nconst deleteProp = (item: any, event: EventConfig) => {\r\n  const index = propList.value.indexOf(item);\r\n  propList.value.splice(index, 1);\r\n  propChange(event);\r\n};\r\n\r\nconst propChange = (event: EventConfig) => {\r\n  const value: any = {};\r\n  propList.value.forEach((item: any) => {\r\n    value[item.prop] = item.value;\r\n  });\r\n  event.value = value;\r\n  eventChange();\r\n};\r\n\r\nconst updatePropList = (event: any) => {\r\n  if (event.value && typeof event.value === \"object\") {\r\n    propList.value = Object.keys(event.value).map((key: string) => {\r\n      return {\r\n        prop: key,\r\n        value: event.value[key],\r\n      };\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * @description 点击折叠面板\r\n * @param value\r\n */\r\nconst changeHandler = (value: number[]) => {\r\n  if (!value.length) return;\r\n  if (!handlers.value.length) return;\r\n  let index = value[0];\r\n  if (props.fields.length) {\r\n    index -= 1;\r\n  }\r\n  if (!handlers.value[index]) return;\r\n  // 拷贝\r\n  const item = JSON.parse(JSON.stringify(handlers.value[index]));\r\n  if (item) {\r\n    updatePropList(item);\r\n    // 初始化自定义事件源选项\r\n    if (item.where?.type == ExtendActionEventNameMap.CustomMessage) {\r\n      whereValueChange()\r\n    }\r\n  }\r\n};\r\n\r\n// 步骤信息\r\nconst rowPropList = ref<any>(props.defaultScript?.rowPropList || []);\r\nconst addRowProp = () => {\r\n  if (rowPropList.value.length >= props.fields.length) {\r\n    MessagePlugin.warning(`最多只能添加${props.fields.length}个属性`);\r\n    return;\r\n  }\r\n  rowPropList.value.push({\r\n    prop: \"\",\r\n    value: \"\",\r\n  });\r\n};\r\n\r\nconst rowPropChange = () => {\r\n  // console.log(\"rowPropChange\", rowPropList.value);\r\n  eventChange();\r\n};\r\n\r\nconst deleteRowProp = (item: any) => {\r\n  const index = rowPropList.value.indexOf(item);\r\n  rowPropList.value.splice(index, 1);\r\n  rowPropChange();\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","<template>\r\n  <t-collapse defaultExpandAll class=\"meta-collapse\">\r\n    <t-collapse-panel header=\"表格列\">\r\n      <template #headerRightContent>\r\n        <t-space size=\"small\">\r\n          <t-checkbox v-model=\"tableProps.show\" @change=\"change\">显示</t-checkbox>\r\n        </t-space>\r\n      </template>\r\n\r\n      <t-row justify=\"start\">\r\n        <t-col :span=\"5\">\r\n          <div>名称</div>\r\n        </t-col>\r\n        <t-col :span=\"5\">\r\n          <div>字段</div>\r\n        </t-col>\r\n        <t-col :span=\"2\">\r\n          <t-button variant=\"text\" @click=\"addColumn\">\r\n            <t-icon name=\"add\"></t-icon>\r\n          </t-button>\r\n        </t-col>\r\n      </t-row>\r\n      <t-row\r\n        v-for=\"(item, index) in columns\"\r\n        :key=\"index\"\r\n        justify=\"start\"\r\n        :gutter=\"4\"\r\n        style=\"margin-bottom: 4px\"\r\n      >\r\n        <t-col :span=\"5\">\r\n          <t-input v-model=\"item.title\" @change=\"change\"></t-input>\r\n        </t-col>\r\n        <t-col :span=\"5\">\r\n          <t-input v-model=\"item.colKey\" @change=\"change\"></t-input>\r\n        </t-col>\r\n        <t-col :span=\"2\">\r\n          <t-button variant=\"text\" @click=\"deleteColumn(index)\">\r\n            <t-icon name=\"delete\"></t-icon>\r\n          </t-button>\r\n        </t-col>\r\n      </t-row>\r\n    </t-collapse-panel>\r\n    <t-collapse-panel header=\"样式\">\r\n      <t-form labelAlign=\"left\">\r\n        <t-form-item label=\"边框\">\r\n          <t-switch v-model=\"tableProps.bordered\" @change=\"change\"></t-switch>\r\n        </t-form-item>\r\n        <t-form-item label=\"悬停\">\r\n          <t-switch v-model=\"tableProps.hover\" @change=\"change\"></t-switch>\r\n        </t-form-item>\r\n        <t-form-item label=\"显示表头\">\r\n          <t-switch v-model=\"tableProps.showHeader\" @change=\"change\"></t-switch>\r\n        </t-form-item>\r\n        <t-form-item label=\"斑马纹\">\r\n          <t-switch v-model=\"tableProps.stripe\" @change=\"change\"></t-switch>\r\n        </t-form-item>\r\n        <t-form-item label=\"行默认背景\">\r\n          <t-color-picker\r\n            v-model=\"tableProps.style.evenRowBackgroundColor\"\r\n            class=\"w-full\"\r\n            :show-primary-color-preview=\"false\"\r\n            format=\"CSS\"\r\n            :color-modes=\"['monochrome']\"\r\n            clearable\r\n            @change=\"change\"\r\n          ></t-color-picker>\r\n        </t-form-item>\r\n        <t-form-item v-if=\"tableProps.stripe\" label=\"奇数行背景\">\r\n          <t-color-picker\r\n            v-model=\"tableProps.style.oddRowBackgroundColor\"\r\n            class=\"w-full\"\r\n            :show-primary-color-preview=\"false\"\r\n            format=\"CSS\"\r\n            :color-modes=\"['monochrome']\"\r\n            clearable\r\n            @change=\"change\"\r\n          ></t-color-picker>\r\n        </t-form-item>\r\n\r\n        <t-form-item label=\"字体颜色\">\r\n          <t-color-picker\r\n            v-model=\"tableProps.style.textColor\"\r\n            class=\"w-full\"\r\n            :show-primary-color-preview=\"false\"\r\n            format=\"CSS\"\r\n            :color-modes=\"['monochrome']\"\r\n            clearable\r\n            @change=\"change\"\r\n          ></t-color-picker>\r\n        </t-form-item>\r\n\r\n        <t-form-item label=\"背景图片\">\r\n          <t-input\r\n            v-model=\"tableProps.style.backgroundImageUrl\"\r\n            class=\"w-full\"\r\n            clearable\r\n            @change=\"change\"\r\n          ></t-input>\r\n        </t-form-item>\r\n      </t-form>\r\n    </t-collapse-panel>\r\n\r\n    <t-collapse-panel\r\n      v-for=\"(script, index) in scripts\"\r\n      :key=\"script.sid\"\r\n      :header=\"`指令-${index+1}-${script.sid}`\"\r\n    >\r\n      <template #headerRightContent>\r\n        <t-space size=\"small\">\r\n          <t-button\r\n            v-if=\"index == scripts.length - 1\"\r\n            theme=\"primary\"\r\n            size=\"small\"\r\n            @click=\"addScript\"\r\n            >追加</t-button\r\n          >\r\n          <t-button\r\n            v-else\r\n            theme=\"warning\"\r\n            size=\"small\"\r\n            @click=\"insertScript(index)\"\r\n            >插入</t-button\r\n          >\r\n          <t-button\r\n            v-if=\"index > 0\"\r\n            theme=\"danger\"\r\n            size=\"small\"\r\n            @click=\"deleteScript(index)\"\r\n            >删除</t-button\r\n          >\r\n        </t-space>\r\n      </template>\r\n      <script-handlers\r\n        :key=\"script.sid\"\r\n        :fields=\"scriptFields\"\r\n        :defaultScript=\"script\"\r\n        :scripts=\"scripts\"\r\n        @change=\"scriptChange($event, index)\"\r\n      ></script-handlers>\r\n    </t-collapse-panel>\r\n  </t-collapse>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, reactive, computed, defineEmits } from \"vue\";\r\nimport { s8 } from \"@meta2d/core\";\r\nimport ScriptHandlers from \"./ScriptHandlers.vue\";\r\n\r\nconst props = defineProps({});\r\n\r\nconst emit = defineEmits([\"change\"]);\r\n\r\nconst { presetScriptsConfig } = meta2d.data();\r\n\r\ntype ColumnType = {\r\n  title: string;\r\n  colKey: string;\r\n  sid?: string;\r\n  width?: string;\r\n};\r\n\r\nconst defaultColumns = [\r\n  { colKey: \"serial-number\", title: \"序号\", width: \"100\" },\r\n  {\r\n    title: \"名称\",\r\n    colKey: \"name\",\r\n    sid: s8(),\r\n  },\r\n  {\r\n    title: \"描述\",\r\n    colKey: \"description\",\r\n    sid: s8(),\r\n  },\r\n];\r\n\r\nconst columns = reactive<Array<ColumnType>>(\r\n  presetScriptsConfig?.columns || defaultColumns\r\n);\r\n\r\nconst addColumn = () => {\r\n  columns.push({\r\n    title: \"\",\r\n    colKey: \"\",\r\n    sid: s8(),\r\n  });\r\n  change();\r\n};\r\nconst change = (column?: any) => {\r\n  emit(\"change\", {\r\n    columns,\r\n    scripts,\r\n    ...tableProps,\r\n  });\r\n};\r\n\r\nconst deleteColumn = (index: number) => {\r\n  columns.splice(index, 1);\r\n  change();\r\n};\r\n\r\nconst tableProps = reactive({\r\n  show: false,\r\n  bordered: false,\r\n  height: null,\r\n  hover: false,\r\n  showHeader: true,\r\n  stripe: false,\r\n  style: {\r\n    evenRowBackgroundColor: \"#f8f8f8\",\r\n    oddRowBackgroundColor: \"#ffffff\",\r\n    textColor: \"#000000\",\r\n    backgroundImageUrl: \"\",\r\n  },\r\n});\r\n\r\nif (presetScriptsConfig) {\r\n  tableProps.bordered = presetScriptsConfig.bordered;\r\n  tableProps.height = presetScriptsConfig.height;\r\n  tableProps.hover = presetScriptsConfig.hover;\r\n  tableProps.showHeader = presetScriptsConfig.showHeader;\r\n  tableProps.stripe = presetScriptsConfig.stripe;\r\n  tableProps.style = presetScriptsConfig.style;\r\n  tableProps.show = presetScriptsConfig.show;\r\n}\r\n\r\nconst scripts = reactive(\r\n  presetScriptsConfig?.scripts || [\r\n    {\r\n      sid: s8(),\r\n    },\r\n  ]\r\n);\r\nconst scriptFields = computed(() => {\r\n  return columns.filter((item) => item.colKey != \"serial-number\");\r\n});\r\n\r\nconst scriptChange = (data: any, index: number) => {\r\n  scripts[index] = data;\r\n  change();\r\n};\r\n\r\nconst addScript = () => {\r\n  scripts.push({\r\n    sid: s8(),\r\n  });\r\n};\r\n\r\nconst insertScript = (index: number) => {\r\n  scripts.splice(index, 0, {\r\n    sid: s8(),\r\n  });\r\n};\r\n\r\nconst deleteScript = (index: number) => {\r\n  scripts.splice(index, 1);\r\n  change();\r\n};\r\n\r\nmeta2d.on(\"opened\", () => {\r\n  // 打开新图纸，数据更新\r\n  const { presetScriptsConfig } = meta2d.data();\r\n  if (presetScriptsConfig) {\r\n    if (Array.isArray(presetScriptsConfig.columns)) {\r\n      columns.splice(0, columns.length, ...presetScriptsConfig.columns);\r\n    }\r\n    if (Array.isArray(presetScriptsConfig.scripts)) {\r\n      scripts.splice(0, scripts.length, ...presetScriptsConfig.scripts);\r\n    }\r\n\r\n    tableProps.bordered = presetScriptsConfig.bordered;\r\n    tableProps.height = presetScriptsConfig.height;\r\n    tableProps.hover = presetScriptsConfig.hover;\r\n    tableProps.showHeader = presetScriptsConfig.showHeader;\r\n    tableProps.stripe = presetScriptsConfig.stripe;\r\n    tableProps.style = presetScriptsConfig.style;\r\n  } else {\r\n    columns.splice(0, columns.length, ...defaultColumns);\r\n    scripts.splice(0, scripts.length, {\r\n      sid: s8(),\r\n    });\r\n\r\n    tableProps.bordered = false;\r\n    tableProps.height = null;\r\n    tableProps.hover = false;\r\n    tableProps.showHeader = true;\r\n    tableProps.stripe = false;\r\n    tableProps.style = {\r\n      evenRowBackgroundColor: \"\",\r\n      oddRowBackgroundColor: \"\",\r\n      textColor: \"\",\r\n      backgroundImageUrl: \"\",\r\n    };\r\n    \r\n  }\r\n});\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","<template>\r\n  <div>\r\n    <PropsTab :tabs=\"tabs\">\r\n      <template #pen-props>\r\n        <div class=\"props-panel\">\r\n          <t-form label-align=\"left\">\r\n            <t-form-item label=\"名称\" name=\"name\">\r\n              <t-input v-model=\"data.name\" @change=\"onChangeData\" />\r\n            </t-form-item>\r\n            <t-divider />\r\n            <t-form-item label=\"网格\" name=\"grid\">\r\n              <t-switch v-model=\"data.grid\" @change=\"onChangeData\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"网格大小\" name=\"gridSize\">\r\n              <t-input-number\r\n                v-model=\"data.gridSize\"\r\n                :min=\"0\"\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"网格角度\" name=\"gridRotate\">\r\n              <t-input-number\r\n                v-model.number=\"data.gridRotate\"\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"网格颜色\" name=\"gridColor\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"data.gridColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n\r\n            <t-divider />\r\n\r\n            <t-form-item label=\"标尺\" name=\"rule\">\r\n              <t-switch v-model=\"data.rule\" @change=\"onChangeData\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"标尺颜色\" name=\"ruleColor\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"data.ruleColor\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n            <t-divider />\r\n\r\n            <t-form-item label=\"背景颜色\" name=\"background\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"data.background\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                :color-modes=\"['monochrome']\"\r\n                clearable\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"图元默认颜色\" name=\"color\">\r\n              <t-color-picker\r\n                class=\"w-full\"\r\n                v-model=\"data.color\"\r\n                :show-primary-color-preview=\"false\"\r\n                format=\"CSS\"\r\n                clearable\r\n                :color-modes=\"['monochrome']\"\r\n                @change=\"onChangeData\"\r\n              />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"背景图片\">\r\n              <t-upload\r\n                ref=\"uploadRef\"\r\n                v-model=\"uploadValue\"\r\n                :action=\"\r\n                  $attrs.uploadUrl ||\r\n                  'https://service-bv448zsw-1257786608.gz.apigw.tencentcs.com/api/upload-demo'\r\n                \"\r\n                :headers=\"headers\"\r\n                name=\"object\"\r\n                :sizeLimit=\"sizeLimit\"\r\n                theme=\"image\"\r\n                tips=\"请选择单张小于1MB的图片上传\"\r\n                accept=\"image/*\"\r\n                @fail=\"handleFail\"\r\n                @success=\"handleSuccess\"\r\n              />\r\n            </t-form-item>\r\n            <t-form-item label=\"背景图片地址\" name=\"bkImage\">\r\n              <t-input\r\n                v-model=\"data.bkImage\"\r\n                clearable\r\n                @change=\"onChangeData('bkImage')\"\r\n              />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"连线相交弯曲\" name=\"lineCross\">\r\n              <t-tooltip\r\n                content=\"当直线或折线两两相交时，其中相交的交点会自动弯曲显示\"\r\n              >\r\n                <t-switch v-model=\"data.lineCross\" @change=\"onChangeData\" />\r\n              </t-tooltip>\r\n            </t-form-item>\r\n            <t-divider />\r\n            <t-form-item label=\"预览时锁定\" name=\"lockState\">\r\n              <t-tooltip content=\"仅预览时有效\">\r\n                <t-select\r\n                  v-model=\"data.lockState\"\r\n                  :options=\"lockStateOptions\"\r\n                  clearable\r\n                  @change=\"onChangeData\"\r\n                />\r\n              </t-tooltip>\r\n            </t-form-item>\r\n          </t-form>\r\n        </div>\r\n      </template>\r\n\r\n      <template #struct-props>\r\n        <slot name=\"struct\"></slot>\r\n      </template>\r\n\r\n      <template #comm-props>\r\n        <div class=\"props-panel\">\r\n          <t-collapse defaultExpandAll class=\"meta-collapse\">\r\n            <t-collapse-panel value=\"0\" header=\"WebSocket\">\r\n              <t-form\r\n                :data=\"data\"\r\n                label-align=\"left\"\r\n                size=\"small\"\r\n                labelWidth=\"80px\"\r\n              >\r\n                <t-form-item label=\"地址\" name=\"wsUrl\">\r\n                  <t-input\r\n                    v-model=\"data.wsUrl\"\r\n                    clearable\r\n                    placeholder=\"ws:// 开头，不符合则不保存\"\r\n                    @blur=\"changeConnectProp('wsUrl')\"\r\n                  />\r\n                </t-form-item>\r\n                <t-form-item label=\"消息名称\" name=\"busName\">\r\n                  <t-input\r\n                    v-model=\"data.busName\"\r\n                    clearable\r\n                    @change=\"changeConnectProp('busName')\"\r\n                  />\r\n                </t-form-item>\r\n\r\n                <t-form-item label=\"消息类型\" name=\"msgTypes\">\r\n                  <t-tag-input\r\n                    v-model=\"data.msgTypes\"\r\n                    clearable\r\n                    placeholder=\"消息类型, 数字, 回车添加\"\r\n                    @change=\"changeConnectProp('msgTypes')\"\r\n                  />\r\n                </t-form-item>\r\n\r\n                <t-divider />\r\n                <t-space>\r\n                  <t-button @click=\"testConnect\">测试连接</t-button>\r\n                </t-space>\r\n              </t-form>\r\n            </t-collapse-panel>\r\n            <t-collapse-panel header=\"消息处理代码\">\r\n              <t-button block @click=\"showCodeEditor\">编辑代码</t-button>\r\n            </t-collapse-panel>\r\n            <t-collapse-panel header=\"消息状态字段\">\r\n              <t-button block @click=\"addWsMsgField\">新增</t-button>\r\n              <template #headerRightContent>\r\n                <t-tooltip\r\n                  content=\"用于消息处理器的触发条件\"\r\n                  placement=\"top-right\"\r\n                >\r\n                  <t-button variant=\"text\">\r\n                    <t-icon name=\"help\"></t-icon>\r\n                  </t-button>\r\n                </t-tooltip>\r\n              </template>\r\n              <br />\r\n              <t-row\r\n                v-for=\"(item, index) in data.wsMsgFields\"\r\n                :key=\"index\"\r\n                justify=\"start\"\r\n                style=\"margin-bottom: 4px\"\r\n              >\r\n                <t-col :span=\"10\">\r\n                  <t-input\r\n                    v-model=\"item.value\"\r\n                    @change=\"wsMsgFieldsChange\"\r\n                  ></t-input>\r\n                </t-col>\r\n                <t-col :span=\"2\">\r\n                  <t-button variant=\"text\" @click=\"deleteWsMsgField(index)\">\r\n                    <t-icon name=\"delete\"></t-icon>\r\n                  </t-button>\r\n                </t-col>\r\n              </t-row>\r\n            </t-collapse-panel>\r\n            <t-collapse-panel header=\"消息处理队列\">\r\n              <MessageHandlers\r\n                :wsMsgFields=\"data.wsMsgFields\"\r\n                :wsMsgHandlers=\"data.wsMsgHandlers\"\r\n                @change=\"wsHandlersChange\"\r\n              />\r\n              <template #headerRightContent>\r\n                <t-tooltip\r\n                  content=\"【消息处理代码】存在时，此处的设置无效\"\r\n                  placement=\"top-right\"\r\n                >\r\n                  <t-button variant=\"text\">\r\n                    <t-icon name=\"help\"></t-icon>\r\n                  </t-button>\r\n                </t-tooltip>\r\n              </template>\r\n            </t-collapse-panel>\r\n          </t-collapse>\r\n        </div>\r\n      </template>\r\n\r\n      <template #preset-script>\r\n        <div class=\"props-panel\">\r\n          <ScriptsEditor @change=\"changePresetScript\"></ScriptsEditor>\r\n        </div>\r\n      </template>\r\n\r\n    </PropsTab>\r\n    <CodeEditor ref=\"codeEditor\" @confirm=\"saveJsStr\" />\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, reactive, ref, useAttrs } from \"vue\";\r\nimport { lineCross, clearLineCross } from \"@meta2d/utils\";\r\nimport PropsTab from \"./PropsTab.vue\";\r\nimport { useUpload } from \"../services/useUpload\";\r\nimport { WebSocketClient } from \"@qs/websocket-client\";\r\nimport { NotifyPlugin } from \"tdesign-vue-next\";\r\nimport CodeEditor from \"./CodeEditor.vue\";\r\nimport MessageHandlers from \"./MessageHandlers.vue\";\r\nimport { useWsHandlers } from \"../services/useHandlers\";\r\nimport ScriptsEditor from \"./ScriptsEditor.vue\";\r\n\r\nenum LockState {\r\n  // 0 -未锁定\r\n  None,\r\n  // 1 - 禁止拖拽/编辑图元；图元可选中、高亮、触发事件等\r\n  DisableEdit,\r\n  // 2 - 禁止编辑图元、禁止左键移动画布；图元可选中、高亮、触发事件等\r\n  DisableMove,\r\n  // 3 - 禁止缩放画布\r\n  DisableScale,\r\n  // 4 - 禁止左键移动和缩放画布\r\n  DisableMoveScale,\r\n  // 10 -画布不能移动和缩放，图元不能触发任何事件\r\n  Disable = 10,\r\n}\r\n\r\n// 图纸数据\r\nconst data = reactive<any>({\r\n  name: \"\",\r\n  background: undefined,\r\n  color: undefined,\r\n  lineCross: false,\r\n  wsUrl: \"\",\r\n  busName: \"\",\r\n  msgTypes: [],\r\n  backgroundImage: \"\",\r\n  grid: false,\r\n  gridSize: 10,\r\n  gridRotate: undefined,\r\n  gridColor: undefined,\r\n  rule: true,\r\n  ruleColor: undefined,\r\n  wsMsgFields: [],\r\n  wsMsgHandlers: [],\r\n  lockState: LockState.None,\r\n});\r\n\r\n// 画布选项\r\nconst options = reactive<any>({\r\n  grid: false,\r\n  gridSize: 10,\r\n  gridRotate: undefined,\r\n  gridColor: undefined,\r\n  rule: true,\r\n});\r\n\r\nconst tabs = [\r\n  {\r\n    label: \"图纸\",\r\n    value: 1,\r\n    slot: \"pen-props\",\r\n  },\r\n  {\r\n    label: \"结构\",\r\n    value: 2,\r\n    slot: \"struct-props\",\r\n  },\r\n  {\r\n    label: \"通信\",\r\n    value: 3,\r\n    slot: \"comm-props\",\r\n  },\r\n  {\r\n    label: \"预设脚本\",\r\n    value: 4,\r\n    slot: \"preset-script\",\r\n  },\r\n];\r\n\r\nconst lockStateOptions = [\r\n  { label: \"未锁定\", value: LockState.None },\r\n  {\r\n    label: \"禁止拖拽/编辑图元；图元可选中、高亮、触发事件等\",\r\n    value: LockState.DisableEdit,\r\n  },\r\n  {\r\n    label: \"禁止编辑图元、禁止左键移动画布；图元可选中、高亮、触发事件等\",\r\n    value: LockState.DisableMove,\r\n  },\r\n  { label: \"禁止缩放画布\", value: LockState.DisableScale },\r\n  { label: \"禁止左键移动和缩放画布\", value: LockState.DisableMoveScale },\r\n  {\r\n    label: \"画布不能移动和缩放，图元不能触发任何事件\",\r\n    value: LockState.Disable,\r\n  },\r\n];\r\n\r\nonMounted(() => {\r\n  const d: any = meta2d.data();\r\n  data.name = d.name || \"\";\r\n  data.background = d.background;\r\n  data.color = d.color;\r\n  data.lineCross = d.lineCross;\r\n  data.backgroundImage = d.backgroundImage;\r\n  data.grid = d.grid;\r\n  data.gridSize = d.gridSize;\r\n  data.gridRotate = d.gridRotate;\r\n  data.gridColor = d.gridColor;\r\n  data.rule = d.rule;\r\n  data.ruleColor = d.ruleColor;\r\n  data.bkImage = d.bkImage;\r\n  data.wsUrl = d.wsUrl;\r\n  data.busName = d.busName;\r\n  data.msgTypes = d.msgTypes || [];\r\n  data.onMessageJsCode = d.onMessageJsCode;\r\n  data.wsMsgFields = d.wsMsgFields || [];\r\n  data.wsMsgHandlers = d.wsMsgHandlers || [];\r\n  data.lockState = d.lockState || LockState.None;\r\n  Object.assign(options, meta2d.getOptions());\r\n});\r\n\r\n/**\r\n * @description 针对单个图纸修改\r\n */\r\nconst onChangeData = (prop?: string) => {\r\n  if (data.lineCross) {\r\n    lineCross(true);\r\n  } else {\r\n    clearLineCross();\r\n  }\r\n\r\n  Object.assign(meta2d.store.data, data);\r\n  meta2d.store.patchFlagsBackground = true;\r\n\r\n  meta2d.setGrid({\r\n    grid: data.grid,\r\n    gridSize: data.gridSize,\r\n    gridRotate: data.gridRotate,\r\n    gridColor: data.gridColor,\r\n  });\r\n  meta2d.setRule({\r\n    rule: data.rule,\r\n    ruleColor: data.ruleColor,\r\n  });\r\n\r\n  if (prop == \"bkImage\") {\r\n    meta2d.setBackgroundImage(data.bkImage);\r\n  }\r\n\r\n  meta2d.render();\r\n};\r\n\r\nconst uploadRef = ref();\r\nconst { uploadValue, sizeLimit, headers } = useUpload();\r\n\r\nconst handleSuccess = (context: any) => {\r\n  console.log(\"upload success: \", context);\r\n  if (context.response) {\r\n    data.bkImage = context.response.url || context.response.data?.fileurl;\r\n    onChangeData(\"bkImage\");\r\n  }\r\n};\r\n\r\nconst handleFail = (e: any) => {\r\n  console.log(\"upload fail: \", e);\r\n};\r\n\r\nconst changeConnectProp = (prop: string) => {\r\n  const value = data[prop];\r\n  if (prop == \"wsUrl\") {\r\n    if (!value?.startsWith(\"ws://\")) {\r\n      data[prop] = \"\";\r\n      return;\r\n    }\r\n  }\r\n  Object.assign(meta2d.store.data, data);\r\n};\r\n\r\nconst { resolver } = useWsHandlers(data);\r\nconst testConnect = () => {\r\n  const msgTypes = data.msgTypes\r\n    .map((item: string) => {\r\n      return Number(item);\r\n    })\r\n    .filter((item: number) => {\r\n      return !isNaN(item);\r\n    });\r\n\r\n  const wsClient = WebSocketClient.getInstance(data.wsUrl, {\r\n    busName: data.busName,\r\n    msgTypes,\r\n    enableLog: false,\r\n    onReady: () => {\r\n      // 绿色文字提示\r\n      console.log(\"%c连接成功！\", \"color: green; font-weight: bold;\");\r\n      NotifyPlugin.success({\r\n        title: \"连接成功！\",\r\n      });\r\n    },\r\n  });\r\n  wsClient.connect();\r\n  // console.log(\"ws client: \", wsClient);\r\n  const jsStr = data.onMessageJsCode;\r\n  wsClient.subscribe(data.busName, msgTypes, (response) => {\r\n    try {\r\n      if (jsStr) {\r\n        const fn = new Function(\"data\", jsStr);\r\n        fn(response);\r\n      } else {\r\n        // 消息处理器的封装\r\n        resolver(response);\r\n      }\r\n    } catch (error) {\r\n      console.log(\"error: \", error);\r\n    }\r\n  });\r\n};\r\n\r\nconst codeEditor = ref();\r\nconst showCodeEditor = () => {\r\n  if (codeEditor.value) {\r\n    codeEditor.value.open(data.onMessageJsCode);\r\n  }\r\n};\r\n\r\nconst saveJsStr = (jsStr: string) => {\r\n  data.onMessageJsCode = jsStr;\r\n  changeConnectProp(\"onMessageJsCode\");\r\n};\r\n\r\n// * 自定义消息字段\r\nconst addWsMsgField = () => {\r\n  data.wsMsgFields.push({\r\n    label: \"\",\r\n    value: \"\",\r\n  });\r\n};\r\nconst deleteWsMsgField = (index: number) => {\r\n  data.wsMsgFields.splice(index, 1);\r\n};\r\nconst wsMsgFieldsChange = () => {\r\n  changeConnectProp(\"wsMsgFields\");\r\n};\r\n\r\nconst wsHandlersChange = (handlers: any) => {\r\n  console.log(\"handlers: \", handlers);\r\n  data.wsMsgHandlers = handlers;\r\n  changeConnectProp(\"wsMsgHandlers\");\r\n};\r\n\r\n\r\nconst changePresetScript = (scriptConfig: any) => {\r\n  console.log(\"preset script config: \", scriptConfig);\r\n  data.presetScriptsConfig = scriptConfig;\r\n  Object.assign(meta2d.store.data, data);\r\n}\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.props-panel {\r\n  padding: 10px;\r\n\r\n  :deep(.t-form) {\r\n    .t-form__item {\r\n      margin-bottom: 8px;\r\n    }\r\n    .t-form__label {\r\n      padding-right: 8px;\r\n    }\r\n\r\n    .t-divider {\r\n      margin: 12px 0;\r\n    }\r\n\r\n    .t-input--auto-width {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","// 左右偏移20移动\r\nconst moveXFrames = [\r\n  { x: -10, duration: 100 },\r\n  { x: 10, duration: 80 },\r\n  { x: -10, duration: 50 },\r\n  { x: 10, duration: 30 },\r\n  { x: 0, duration: 300 },\r\n];\r\n\r\n// 上下跳动\r\nconst moveYFrames = [\r\n  { y: -10, duration: 100 },\r\n  { y: 10, duration: 80 },\r\n  { y: -10, duration: 50 },\r\n  { y: 10, duration: 30 },\r\n  { y: 0, duration: 300 },\r\n];\r\n\r\n// 左右摇摆\r\nconst rotateXFrames = [\r\n  {\r\n    duration: 100,\r\n    rotate: -10,\r\n  },\r\n  {\r\n    duration: 100,\r\n    rotate: 10,\r\n  },\r\n  {\r\n    duration: 100,\r\n    rotate: 0,\r\n  },\r\n];\r\n\r\n// 缩放\r\nconst scaleFrames = [\r\n  {\r\n    duration: 100,\r\n    scale: 0.8,\r\n  },\r\n  {\r\n    duration: 400,\r\n    scale: 1,\r\n  },\r\n  {\r\n    duration: 100,\r\n    scale: 1.2,\r\n  },\r\n];\r\n\r\nconst rotateFrames = [\r\n  {\r\n    duration: 1000,\r\n    rotate: 360,\r\n  }\r\n]\r\n\r\nconst rotateFrames2 = [\r\n    {\r\n        duration: 1000,\r\n        rotate: -360,\r\n    }\r\n]\r\n\r\n\r\n// 上述动画所列属性是相对变化\r\n\r\n// 其他数字属性匀速渐变\r\n// 进度变化\r\nconst processFrames = [\r\n//   {\r\n//     duration: 1000,\r\n//     progress: 0.5,\r\n//   },\r\n  {\r\n    duration: 2000,\r\n    progress: 1,\r\n  },\r\n];\r\n// 非数字类型，直接变化\r\nconst colorFrames = [\r\n  {\r\n    duration: 1000,\r\n    color: 'green',\r\n  },\r\n  {\r\n    duration: 2000,\r\n    color: 'red',\r\n  },\r\n];\r\n\r\nexport const PenFrameOptions = [\r\n  {\r\n    label: '上下跳动',\r\n    value: 'moveYFrames',\r\n  },\r\n  {\r\n    label: '左右跳动',\r\n    value: 'moveXFrames',\r\n  },\r\n\r\n  {\r\n    label: '心跳',\r\n    value: 'scaleFrames',\r\n  },\r\n  {\r\n    label: '摇摆',\r\n    value: 'rotateXFrames',\r\n  },\r\n\r\n  {\r\n    label: '旋转',\r\n    value: 'rotateFrames',\r\n  },\r\n  {\r\n    label: '反向旋转',\r\n    value: 'rotateFrames2',\r\n  },\r\n\r\n  {\r\n    label: '进度',\r\n    value: 'processFrames',\r\n  },\r\n\r\n  {\r\n    label: '自定义',\r\n    value: 'x-custom',\r\n  },\r\n\r\n  \r\n\r\n];\r\n\r\nexport const LineAnimateOption = [\r\n  {\r\n    label: \"水流\",\r\n    value: 0,\r\n  },\r\n  {\r\n    label: \"水珠滚动\",\r\n    value: 1,\r\n  },\r\n  {\r\n    label: \"圆点\",\r\n    value: 2,\r\n  },\r\n  {\r\n    label: \"箭头\",\r\n    value: 3,\r\n  },\r\n  {\r\n    label: \"水滴\",\r\n    value: 4,\r\n  },\r\n];\r\n\r\nexport const PenFrames = {\r\n  moveXFrames,\r\n  moveYFrames,\r\n  rotateXFrames,\r\n  scaleFrames,\r\n  processFrames,\r\n  colorFrames,\r\n  rotateFrames,\r\n  rotateFrames2,\r\n};\r\n","<template>\r\n  <div class=\"props-panel__editor\">\r\n    <t-form label-align=\"left\">\r\n      <t-form-item label=\"时长(ms)\" name=\"duration\">\r\n        <t-input-number\r\n          v-model=\"data.duration\"\r\n          :min=\"0\"\r\n          @change=\"changeValue('duration')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"偏移X\" name=\"x\">\r\n        <t-input-number\r\n          v-model=\"data.x\"\r\n          placeholder=\"px\"\r\n          @change=\"changeValue('x')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"偏移Y\" name=\"y\">\r\n        <t-input-number\r\n          v-model=\"data.y\"\r\n          placeholder=\"px\"\r\n          @change=\"changeValue('y')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"颜色\" name=\"color\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.color\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('color')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"浮动颜色\" name=\"hoverColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.hoverColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('hoverColor')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"选中颜色\" name=\"activeColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.activeColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('activeColor')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"背景\" name=\"background\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.background\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('background')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"线条\" name=\"dash\">\r\n        <t-select v-model=\"data.dash\" @change=\"changeValue('dash')\">\r\n          <t-option :key=\"0\" :value=\"0\" label=\"实线\"></t-option>\r\n          <t-option :key=\"1\" :value=\"1\" label=\"虚线\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n      <t-form-item label=\"线条宽度\" name=\"lineWidth\">\r\n        <t-input-number\r\n          v-model=\"data.lineWidth\"\r\n          @change=\"changeValue('lineWidth')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"圆角\" name=\"borderRadius\">\r\n        <t-input-number\r\n          :min=\"0\"\r\n          :max=\"1\"\r\n          :step=\"0.01\"\r\n          v-model=\"data.borderRadius\"\r\n          @change=\"changeValue('borderRadius')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"不透明度\" name=\"globalAlpha\">\r\n        <t-slider\r\n          v-model=\"data.globalAlpha\"\r\n          :min=\"0\"\r\n          :max=\"1\"\r\n          :step=\"0.01\"\r\n          @change=\"changeValue('globalAlpha')\"\r\n        />\r\n        <span class=\"ml-16\" style=\"width: 50px; line-height: 30px\">\r\n          {{ data.globalAlpha }}\r\n        </span>\r\n      </t-form-item>\r\n      <t-form-item label=\"阴影颜色\" name=\"shadowColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.shadowColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('shadowColor')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"阴影模糊\" name=\"shadowBlur\">\r\n        <t-input-number\r\n          v-model=\"data.shadowBlur\"\r\n          :min=\"0\"\r\n          @change=\"changeValue('shadowBlur')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"阴影X偏移\" name=\"shadowOffsetX\">\r\n        <t-input-number\r\n          v-model=\"data.shadowOffsetX\"\r\n          @change=\"changeValue('shadowOffsetX')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"阴影Y偏移\" name=\"shadowOffsetY\">\r\n        <t-input-number\r\n          v-model=\"data.shadowOffsetY\"\r\n          @change=\"changeValue('shadowOffsetY')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-divider />\r\n      <t-form-item label=\"文字阴影\" name=\"textHasShadow\">\r\n        <t-switch\r\n          v-model=\"data.textHasShadow\"\r\n          @change=\"changeValue('textHasShadow')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"文本\" name=\"text\">\r\n        <t-input v-model=\"data.text\" clearable @change=\"changeValue('text')\" />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"字体\" name=\"fontSize\">\r\n        <t-input-number\r\n          v-model=\"data.fontSize\"\r\n          @change=\"changeValue('fontSize')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"文字颜色类型\" name=\"textType\">\r\n        <t-select v-model=\"data.textType\" @change=\"changeValue('textType')\">\r\n          <t-option key=\"hex\" :value=\"0\" label=\"纯色\"></t-option>\r\n          <t-option key=\"rgb\" :value=\"1\" label=\"线性渐变\"></t-option>\r\n          <t-option key=\"rgba\" :value=\"2\" label=\"径向渐变\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n\r\n      <t-form-item\r\n        v-if=\"[1, 2].includes(data.textType)\"\r\n        label=\"文字渐变\"\r\n        name=\"textGradientColors\"\r\n      >\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.textGradientColors\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['linear-gradient']\"\r\n          clearable\r\n          @change=\"changeValue('textGradientColors')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item v-else label=\"文字颜色\" name=\"textColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.textColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('textColor')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"文本风格\" name=\"fontStyle\">\r\n        <t-select v-model=\"data.fontStyle\" @change=\"changeValue('fontStyle')\">\r\n          <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n          <t-option key=\"italic\" value=\"italic\" label=\"斜体\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n\r\n      <!-- 加粗 -->\r\n      <t-form-item label=\"文本粗细\" name=\"fontWeight\">\r\n        <t-select v-model=\"data.fontWeight\" @change=\"changeValue('fontWeight')\">\r\n          <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n          <t-option key=\"bold\" value=\"bold\" label=\"加粗\"></t-option>\r\n          <t-option key=\"lighter\" value=\"lighter\" label=\"更细\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"换行\" name=\"whiteSpace\">\r\n        <t-select v-model=\"data.whiteSpace\" @change=\"changeValue('whiteSpace')\">\r\n          <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n          <t-option key=\"nowrap\" value=\"nowrap\" label=\"不换行\"></t-option>\r\n          <t-option\r\n            key=\"pre-line\"\r\n            value=\"pre-line\"\r\n            label=\"换行符换行\"\r\n          ></t-option>\r\n          <t-option\r\n            key=\"break-all\"\r\n            value=\"break-all\"\r\n            label=\"永远换行\"\r\n          ></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"超出省略\" name=\"ellipsis\">\r\n        <t-switch v-model=\"data.ellipsis\" @change=\"changeValue('ellipsis')\">\r\n        </t-switch>\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"下划线\" name=\"textDecoration\">\r\n        <t-switch\r\n          v-model=\"data.textDecoration\"\r\n          @change=\"changeValue('textDecoration')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"下划线颜色\" name=\"textDecorationColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.textDecorationColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('textDecorationColor')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"删除线\" name=\"textStrickout\">\r\n        <t-switch\r\n          v-model=\"data.textStrickout\"\r\n          @change=\"changeValue('textStrickout')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"删除线颜色\" name=\"textStrickoutColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.textStrickoutColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('textStrickoutColor')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"文字水平对齐\" name=\"textAlign\">\r\n        <t-select v-model=\"data.textAlign\" @change=\"changeValue('textAlign')\">\r\n          <t-option key=\"left\" value=\"left\" label=\"左对齐\"></t-option>\r\n          <t-option key=\"center\" value=\"center\" label=\"居中\"></t-option>\r\n          <t-option key=\"right\" value=\"right\" label=\"右对齐\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n      <t-form-item label=\"文字垂直对齐\" name=\"textBaseline\">\r\n        <t-select\r\n          v-model=\"data.textBaseline\"\r\n          @change=\"changeValue('textBaseline')\"\r\n        >\r\n          <t-option key=\"top\" value=\"top\" label=\"顶部对齐\"></t-option>\r\n          <t-option key=\"middle\" value=\"middle\" label=\"居中\"></t-option>\r\n          <t-option key=\"bottom\" value=\"bottom\" label=\"底部对齐\"></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n\r\n      <t-divider />\r\n\r\n      <t-form-item label=\"宽\" name=\"width\">\r\n        <t-input-number v-model=\"data.width\" @change=\"changeRect('width')\" />\r\n      </t-form-item>\r\n      <t-form-item label=\"高\" name=\"height\">\r\n        <t-input-number v-model=\"data.height\" @change=\"changeRect('height')\" />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"旋转角度\" name=\"rotate\">\r\n        <t-input-number v-model=\"data.rotate\" @change=\"changeValue('rotate')\" />\r\n      </t-form-item>\r\n\r\n      <t-divider />\r\n      <t-form-item label=\"进度\" name=\"progress\">\r\n        <t-input-number\r\n          v-model=\"data.progress\"\r\n          :step=\"0.1\"\r\n          :min=\"0\"\r\n          :max=\"1\"\r\n          @change=\"changeValue('progress')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"进度颜色\" name=\"progressColor\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.progressColor\"\r\n          :show-primary-color-preview=\"false\"\r\n          format=\"CSS\"\r\n          :color-modes=\"['monochrome']\"\r\n          clearable\r\n          @change=\"changeValue('progressColor')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"渐变颜色\" name=\"progressGradientColors\">\r\n        <t-color-picker\r\n          class=\"w-full\"\r\n          v-model=\"data.progressGradientColors\"\r\n          :show-primary-color-preview=\"false\"\r\n          clearable\r\n          format=\"CSS\"\r\n          :color-modes=\"['linear-gradient']\"\r\n          @change=\"changeValue('progressGradientColors')\"\r\n        />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"垂直进度\" name=\"verticalProgress\">\r\n        <t-switch\r\n          v-model=\"data.verticalProgress\"\r\n          @change=\"changeValue('verticalProgress')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"反向进度\" name=\"reverseProgress\">\r\n        <t-switch\r\n          v-model=\"data.reverseProgress\"\r\n          @change=\"changeValue('reverseProgress')\"\r\n        />\r\n      </t-form-item>\r\n      <t-form-item label=\"水平翻转\" name=\"flipX\">\r\n        <t-switch v-model=\"data.flipX\" @change=\"changeValue('flipX')\" />\r\n      </t-form-item>\r\n\r\n      <t-form-item label=\"垂直翻转\" name=\"flipY\">\r\n        <t-switch v-model=\"data.flipY\" @change=\"changeValue('flipY')\" />\r\n      </t-form-item>\r\n\r\n      <t-divider />\r\n\r\n      <t-form-item v-if=\"data.penName == 'combine'\" label=\"状态\" name=\"status\">\r\n        <t-select v-model=\"data.showChild\" @change=\"changeValue('showChild')\">\r\n          <t-option\r\n            v-for=\"(item, index) in statusList\"\r\n            :key=\"item.value\"\r\n            :value=\"index\"\r\n            :label=\"item.label\"\r\n          ></t-option>\r\n        </t-select>\r\n      </t-form-item>\r\n    </t-form>\r\n  </div>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps } from \"vue\";\r\nconst props = defineProps({\r\n  data: {\r\n    type: Object,\r\n    default: () => ({}),\r\n  },\r\n  statusList: {\r\n    type: Array,\r\n    default: () => [],\r\n  }\r\n});\r\n\r\nconst emit = defineEmits([\"propChange\"]);\r\n\r\nconst changeValue = (key: string) => {\r\n  // * 不需要即时响应\r\n  emit(\"propChange\", key);\r\n};\r\n\r\nconst changeRect = (key: string) => {\r\n  // * 不需要即时响应\r\n  emit(\"propChange\", key);\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.props-panel__editor {\r\n  padding: 10px;\r\n  background-color: white;\r\n  // --td-comp-margin-xxl: 10px;\r\n}\r\n</style>\r\n","<template>\r\n  <br />\r\n  <t-button block theme=\"primary\" @click=\"insert\">添加事件</t-button>\r\n  <t-collapse class=\"meta-collapse\" expand-mutex @change=\"updatePropList\">\r\n    <t-collapse-panel v-for=\"item in events\" header=\"事件\">\r\n      <t-form labelAlign=\"left\">\r\n        <t-form-item label=\"事件类型\">\r\n          <t-select v-model=\"item.name\" :options=\"eventTypeOptions\" @change=\"eventChange\"></t-select>\r\n        </t-form-item>\r\n        <t-form-item label=\"事件行为\">\r\n          <t-select v-model=\"item.action\" :options=\"eventActionOptions\" @change=\"actionChange(item)\"></t-select>\r\n        </t-form-item>\r\n        <t-form-item v-if=\"item.action === EventAction.Link\" label=\"链接地址\">\r\n          <t-input v-model=\"item.value\" clearable @change=\"eventChange\"></t-input>\r\n        </t-form-item>\r\n        <template v-if=\"item.action === EventAction.SetProps\">\r\n          <t-form-item label=\"目标\">\r\n            <t-input v-model=\"item.params\" placeholder=\"可输入目标图元的ID/Tag\" clearable @change=\"eventChange\"></t-input>\r\n          </t-form-item>\r\n          <!-- 属性列表修改 -->\r\n          <t-row justify=\"start\">\r\n            <t-col :span=\"5\">\r\n              <div>属性</div>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <div>值</div>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"addProp\">\r\n                <t-icon name=\"add\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n          <t-row v-for=\"(propItem, index) in propList\" :key=\"index\" justify=\"start\" :gutter=\"4\"\r\n            style=\"margin-bottom: 4px\">\r\n            <t-col :span=\"5\">\r\n              <t-select v-model=\"propItem.prop\" :options=\"propOptions\" @change=\"propChange(item)\"></t-select>\r\n            </t-col>\r\n            <t-col :span=\"5\">\r\n              <t-input v-model=\"propItem.value\" @change=\"propChange(item)\"></t-input>\r\n            </t-col>\r\n            <t-col :span=\"2\">\r\n              <t-button variant=\"text\" @click=\"deleteProp(propItem)\">\r\n                <t-icon name=\"delete\"></t-icon>\r\n              </t-button>\r\n            </t-col>\r\n          </t-row>\r\n        </template>\r\n        <t-form-item v-if=\"\r\n          [\r\n            EventAction.PauseAnimate,\r\n            EventAction.StopAnimate,\r\n            EventAction.StartAnimate,\r\n          ].includes(item.action)\r\n        \" label=\"目标\">\r\n          <t-input v-model=\"item.value\" placeholder=\"可输入目标图元的ID/Tag\" clearable @change=\"eventChange\"></t-input>\r\n        </t-form-item>\r\n\r\n        <template v-if=\"item.action === EventAction.Dialog\">\r\n          <t-form-item label=\"窗口标题\">\r\n            <t-input v-model=\"item.value\" clearable @change=\"eventChange\"></t-input>\r\n          </t-form-item>\r\n          <t-form-item label=\"URL\">\r\n            <t-input v-model=\"item.params\" clearable @change=\"eventChange\"></t-input>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"窗口宽度\">\r\n            <t-input-number v-model=\"item.extend.width\" @change=\"eventChange\"></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"窗口高度\">\r\n            <t-input-number v-model=\"item.extend.height\" @change=\"eventChange\"></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"X偏移\">\r\n            <t-input-number v-model=\"item.extend.x\" @change=\"eventChange\"></t-input-number>\r\n          </t-form-item>\r\n          <t-form-item v-if=\"item.extend\" label=\"Y偏移\">\r\n            <t-input-number v-model=\"item.extend.y\" @change=\"eventChange\"></t-input-number>\r\n          </t-form-item>\r\n        </template>\r\n\r\n        <template v-else-if=\"item.action === EventAction.JS\">\r\n          <t-form-item label=\"扩展行为\">\r\n            <t-select v-model=\"item.params.action\" :options=\"templateCodeStringOptions\"\r\n              @change=\"codeJsChange($event, item)\"></t-select>\r\n          </t-form-item>\r\n          <template v-if=\"[ExtendAction.Video, ExtendAction.ShowText].includes(item.params.action)\">\r\n            <t-form-item label=\"窗口标题\">\r\n              <t-input v-model=\"item.params.title\" clearable @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n            <t-form-item v-if=\"item.params.action === ExtendAction.Video\" label=\"视频URL\">\r\n              <t-input v-model=\"item.params.url\" clearable @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params.action === ExtendAction.ShowText\" label=\"文本\">\r\n              <t-textarea v-model=\"item.params.text\"></t-textarea>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params\" label=\"窗口宽度\">\r\n              <t-input v-model=\"item.params.width\" placeholder=\"示例：320, '500px', '80%'\" @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params && item.params.action == ExtendAction.ShowText\" label=\"文本高度\">\r\n              <t-input v-model=\"item.params.height\" placeholder=\"示例：320, '500px', '80%'\" @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params\" label=\"对话框类型\">\r\n              <t-select v-model=\"item.params.mode\" clearable :options=\"dialogModeOptions\"></t-select>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params\" label=\"标题栏上间距\">\r\n              <t-input v-model=\"item.params.headerMarginTop\" placeholder=\"示例：'10px'\" clearable\r\n                @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"item.params\" label=\"内容下间距\">\r\n              <t-input v-model=\"item.params.contentPaddingBottom\" placeholder=\"示例：'10px'\" clearable\r\n                @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"背景颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.backgroundColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"背景图片\">\r\n              <t-input v-model=\"item.params.backgroundImageUrl\" clearable @change=\"eventChange\"></t-input>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"标题颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.titleColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item v-if=\"item.params.action === ExtendAction.ShowText\" label=\"文本颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.textColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"控制栏背景颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.controlBarBackgroundColor\"\r\n                :show-primary-color-preview=\"false\" format=\"CSS\" :color-modes=\"['monochrome']\" clearable\r\n                @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"控制栏按钮颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.controlColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"已播放进度颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.controlPlayProgressBarColor\"\r\n                :show-primary-color-preview=\"false\" format=\"CSS\" :color-modes=\"['monochrome']\" clearable\r\n                @change=\"eventChange\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"已加载进度颜色\">\r\n              <t-color-picker class=\"w-full\" v-model=\"item.params.controlLoadProgressBarColor\"\r\n                :show-primary-color-preview=\"false\" format=\"CSS\" :color-modes=\"['monochrome']\" clearable\r\n                @change=\"eventChange\" />\r\n            </t-form-item>\r\n          </template>\r\n        </template>\r\n      </t-form>\r\n      <template #headerRightContent>\r\n        <t-button size=\"small\" variant=\"outline\" theme=\"danger\" :style=\"{ marginLeft: '8px' }\"\r\n          @click=\"deleteEvent(item)\">\r\n          <t-icon name=\"delete\"></t-icon>\r\n        </t-button>\r\n      </template>\r\n    </t-collapse-panel>\r\n  </t-collapse>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, ref, watch } from \"vue\";\r\nimport { MessagePlugin } from \"tdesign-vue-next\";\r\nimport {\r\n  EventAction,\r\n  ExtendAction,\r\n  EventConfig,\r\n  ExtendActionJsCodeMap,\r\n} from \"../types/Event\";\r\nconst props = defineProps({\r\n  defaultEventsValue: {\r\n    type: Array,\r\n    default: () => [],\r\n  },\r\n});\r\n\r\nconst events = ref<Array<EventConfig>>(\r\n  props.defaultEventsValue as EventConfig[]\r\n);\r\n\r\nwatch(\r\n  () => props.defaultEventsValue,\r\n  (val) => {\r\n    if (val) {\r\n      events.value = val as EventConfig[];\r\n    } else {\r\n      events.value = [];\r\n    }\r\n  }\r\n);\r\n\r\nconst eventTypeOptions = [\r\n  {\r\n    label: \"单击\",\r\n    value: \"click\",\r\n  },\r\n  {\r\n    label: \"双击\",\r\n    value: \"dblclick\",\r\n  },\r\n  {\r\n    label: \"鼠标按下\",\r\n    value: \"mousedown\",\r\n  },\r\n  {\r\n    label: \"鼠标抬起\",\r\n    value: \"mouseup\",\r\n  },\r\n  {\r\n    label: \"鼠标进入\",\r\n    value: \"enter\",\r\n  },\r\n  {\r\n    label: \"鼠标离开\",\r\n    value: \"leave\",\r\n  },\r\n  //   {\r\n  //     label: \"选中\",\r\n  //     value: \"active\",\r\n  //   },\r\n  //   {\r\n  //     label: \"取消选中\",\r\n  //     value: \"inactive\",\r\n  //   },\r\n];\r\n\r\nconst eventActionOptions = [\r\n  {\r\n    label: \"打开链接\",\r\n    value: EventAction.Link,\r\n  },\r\n  {\r\n    label: \"更改属性\",\r\n    value: EventAction.SetProps,\r\n  },\r\n  {\r\n    label: \"执行动画\",\r\n    value: EventAction.StartAnimate,\r\n  },\r\n  {\r\n    label: \"暂停动画\",\r\n    value: EventAction.PauseAnimate,\r\n  },\r\n  {\r\n    label: \"停止动画\",\r\n    value: EventAction.StopAnimate,\r\n  },\r\n  {\r\n    label: \"执行JS代码\",\r\n    value: EventAction.JS,\r\n  },\r\n  //   {\r\n  //     label: \"执行全局函数\",\r\n  //     value: EventAction.GlobalFn,\r\n  //   },\r\n  //   {\r\n  //     label: \"发送消息\",\r\n  //     value: EventAction.Emit,\r\n  //   },\r\n  //   {\r\n  //     label: \"播放视频\",\r\n  //     value: EventAction.StartVideo,\r\n  //   },\r\n  //   {\r\n  //     label: \"暂停视频\",\r\n  //     value: EventAction.PauseVideo,\r\n  //   },\r\n  //   {\r\n  //     label: \"停止视频\",\r\n  //     value: EventAction.StopVideo,\r\n  //   },\r\n  //   {\r\n  //     label: \"发送图元数据\",\r\n  //     value: EventAction.SendPropData,\r\n  //   },\r\n  //   {\r\n  //     label: \"发送绑定变量\",\r\n  //     value: EventAction.SendVarData,\r\n  //   },\r\n  {\r\n    label: \"对话框\",\r\n    value: EventAction.Dialog,\r\n  },\r\n];\r\n\r\nconst templateCodeStringOptions = [\r\n  {\r\n    label: \"视频\",\r\n    value: ExtendAction.Video,\r\n  },\r\n  {\r\n    label: '弹窗文字',\r\n    value: ExtendAction.ShowText,\r\n  },\r\n  // {\r\n  //   label: '',\r\n  //   value: '',\r\n  // }\r\n];\r\n\r\nconst dialogModeOptions = [\r\n  {\r\n    label: \"模态\",\r\n    value: \"modal\",\r\n  },\r\n  {\r\n    label: \"全屏\",\r\n    value: \"full-screen\",\r\n  },\r\n];\r\n\r\nconst insert = () => {\r\n  events.value.push({\r\n    name: \"\",\r\n    action: 0,\r\n    value: \"\",\r\n    params: \"\",\r\n    where: {},\r\n    extend: {},\r\n  });\r\n};\r\nconst deleteEvent = (event: any) => {\r\n  events.value = events.value.filter((item: any) => item !== event);\r\n  eventChange();\r\n};\r\n\r\nconst emit = defineEmits([\"change\"]);\r\nconst eventChange = () => {\r\n  emit(\"change\", events.value);\r\n};\r\n\r\nconst actionChange = (event: any) => {\r\n  console.log(\"action change: \", event);\r\n  if (event.action == EventAction.JS) {\r\n    event.params = {\r\n      url: \"\",\r\n      action: \"\", // ExtendAction.Video,\r\n    };\r\n    event.value = ``; // 代码字符串，通过选择预定义的模板更新\r\n  }\r\n  eventChange();\r\n};\r\n\r\nconst codeJsChange = (action: ExtendAction, event: any) => {\r\n  const code = ExtendActionJsCodeMap[action] as string;\r\n  if (code) {\r\n    event.value = code;\r\n  }\r\n  eventChange();\r\n};\r\n\r\nconst propOptions = [\r\n  {\r\n    label: \"背景颜色\",\r\n    value: \"background\",\r\n  },\r\n  {\r\n    label: \"颜色\",\r\n    value: \"color\",\r\n  },\r\n  {\r\n    label: \"文字\",\r\n    value: \"text\",\r\n  },\r\n  {\r\n    label: \"进度\",\r\n    value: \"progress\",\r\n  },\r\n  {\r\n    label: \"显示\",\r\n    value: \"visible\",\r\n  },\r\n  {\r\n    label: \"状态\",\r\n    value: \"showChild\",\r\n  },\r\n];\r\nconst propList = ref<any>([]);\r\nconst addProp = () => {\r\n  if (propList.value.length >= 6) {\r\n    MessagePlugin.warning(\"最多只能添加6个属性\");\r\n    return;\r\n  }\r\n  propList.value.push({\r\n    prop: \"\",\r\n    value: \"\",\r\n  });\r\n};\r\n\r\nconst deleteProp = (item: any) => {\r\n  const index = propList.value.indexOf(item);\r\n  propList.value.splice(index, 1);\r\n};\r\n\r\nconst propChange = (event: EventConfig) => {\r\n  const value: any = {};\r\n  propList.value.forEach((item: any) => {\r\n    value[item.prop] = item.value;\r\n  });\r\n  event.value = value;\r\n  emit(\"change\", events.value);\r\n};\r\n\r\nconst updatePropList = (index: number[]) => {\r\n  const event = events.value[Number(index)];\r\n  if (!event) return;\r\n  if (event.value && typeof event.value === \"object\") {\r\n    propList.value = Object.keys(event.value).map((key: string) => {\r\n      return {\r\n        prop: key,\r\n        value: event.value[key],\r\n      };\r\n    });\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n:deep(.t-form) .t-input--auto-width {\r\n  width: 100%;\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"\">\r\n    <PropsTab v-if=\"pen\" :tabs=\"tabs\" :defaultValue=\"activePanel\" @change=\"(v) => (activePanel = v)\">\r\n      <template #pen>\r\n        <div class=\"props-panel\">\r\n          <t-form label-align=\"left\">\r\n            <t-form-item label=\"颜色\" name=\"color\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.color\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('color')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"浮动颜色\" name=\"hoverColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.hoverColor\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('hoverColor')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"选中颜色\" name=\"activeColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.activeColor\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('activeColor')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"背景\" name=\"background\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.background\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('background')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"线条\" name=\"dash\">\r\n              <t-select v-model=\"pen.dash\" @change=\"changeValue('dash')\">\r\n                <t-option :key=\"0\" :value=\"0\" label=\"实线\"></t-option>\r\n                <t-option :key=\"1\" :value=\"1\" label=\"虚线\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n            <t-form-item label=\"线条宽度\" name=\"lineWidth\">\r\n              <t-input-number v-model=\"pen.lineWidth\" @change=\"changeValue('lineWidth')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"圆角\" name=\"borderRadius\">\r\n              <t-input-number :min=\"0\" :max=\"1\" :step=\"0.01\" v-model=\"pen.borderRadius\"\r\n                @change=\"changeValue('borderRadius')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"不透明度\" name=\"globalAlpha\">\r\n              <t-slider v-model=\"pen.globalAlpha\" :min=\"0\" :max=\"1\" :step=\"0.01\" @change=\"changeValue('globalAlpha')\" />\r\n              <span class=\"ml-16\" style=\"width: 50px; line-height: 30px\">\r\n                {{ pen.globalAlpha }}\r\n              </span>\r\n            </t-form-item>\r\n            <t-form-item label=\"阴影颜色\" name=\"shadowColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.shadowColor\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('shadowColor')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"阴影模糊\" name=\"shadowBlur\">\r\n              <t-input-number v-model=\"pen.shadowBlur\" :min=\"0\" @change=\"changeValue('shadowBlur')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"阴影X偏移\" name=\"shadowOffsetX\">\r\n              <t-input-number v-model=\"pen.shadowOffsetX\" @change=\"changeValue('shadowOffsetX')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"阴影Y偏移\" name=\"shadowOffsetY\">\r\n              <t-input-number v-model=\"pen.shadowOffsetY\" @change=\"changeValue('shadowOffsetY')\" />\r\n            </t-form-item>\r\n\r\n            <t-divider />\r\n            <t-form-item label=\"文字阴影\" name=\"textHasShadow\">\r\n              <t-switch v-model=\"pen.textHasShadow\" @change=\"changeValue('textHasShadow')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"文本\" name=\"text\">\r\n              <t-input v-model=\"pen.text\" clearable @change=\"changeValue('text')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"字体\" name=\"fontSize\">\r\n              <t-input-number v-model=\"pen.fontSize\" @change=\"changeValue('fontSize')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"文字颜色类型\" name=\"textType\">\r\n              <t-select v-model=\"pen.textType\" @change=\"changeValue('textType')\">\r\n                <t-option key=\"hex\" :value=\"0\" label=\"纯色\"></t-option>\r\n                <t-option key=\"rgb\" :value=\"1\" label=\"线性渐变\"></t-option>\r\n                <t-option key=\"rgba\" :value=\"2\" label=\"径向渐变\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n\r\n            <t-form-item v-if=\"[1, 2].includes(pen.textType)\" label=\"文字渐变\" name=\"textGradientColors\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.textGradientColors\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['linear-gradient']\" clearable @change=\"changeValue('textGradientColors')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item v-else label=\"文字颜色\" name=\"textColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.textColor\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" clearable @change=\"changeValue('textColor')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"文本风格\" name=\"fontStyle\">\r\n              <t-select v-model=\"pen.fontStyle\" @change=\"changeValue('fontStyle')\">\r\n                <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n                <t-option key=\"italic\" value=\"italic\" label=\"斜体\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n\r\n            <!-- 加粗 -->\r\n            <t-form-item label=\"文本粗细\" name=\"fontWeight\">\r\n              <t-select v-model=\"pen.fontWeight\" @change=\"changeValue('fontWeight')\">\r\n                <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n                <t-option key=\"bold\" value=\"bold\" label=\"加粗\"></t-option>\r\n                <t-option key=\"lighter\" value=\"lighter\" label=\"更细\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"换行\" name=\"whiteSpace\">\r\n              <t-select v-model=\"pen.whiteSpace\" @change=\"changeValue('whiteSpace')\">\r\n                <t-option key=\"normal\" value=\"normal\" label=\"常规\"></t-option>\r\n                <t-option key=\"nowrap\" value=\"nowrap\" label=\"不换行\"></t-option>\r\n                <t-option key=\"pre-line\" value=\"pre-line\" label=\"换行符换行\"></t-option>\r\n                <t-option key=\"break-all\" value=\"break-all\" label=\"永远换行\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"超出省略\" name=\"ellipsis\">\r\n              <t-switch v-model=\"pen.ellipsis\" @change=\"changeValue('ellipsis')\">\r\n              </t-switch>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"下划线\" name=\"textDecoration\">\r\n              <t-switch v-model=\"pen.textDecoration\" @change=\"changeValue('textDecoration')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"下划线颜色\" name=\"textDecorationColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.textDecorationColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"changeValue('textDecorationColor')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"删除线\" name=\"textStrickout\">\r\n              <t-switch v-model=\"pen.textStrickout\" @change=\"changeValue('textStrickout')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"删除线颜色\" name=\"textStrickoutColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.textStrickoutColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"changeValue('textStrickoutColor')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"文字水平对齐\" name=\"textAlign\">\r\n              <t-select v-model=\"pen.textAlign\" @change=\"changeValue('textAlign')\">\r\n                <t-option key=\"left\" value=\"left\" label=\"左对齐\"></t-option>\r\n                <t-option key=\"center\" value=\"center\" label=\"居中\"></t-option>\r\n                <t-option key=\"right\" value=\"right\" label=\"右对齐\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n            <t-form-item label=\"文字垂直对齐\" name=\"textBaseline\">\r\n              <t-select v-model=\"pen.textBaseline\" @change=\"changeValue('textBaseline')\">\r\n                <t-option key=\"top\" value=\"top\" label=\"顶部对齐\"></t-option>\r\n                <t-option key=\"middle\" value=\"middle\" label=\"居中\"></t-option>\r\n                <t-option key=\"bottom\" value=\"bottom\" label=\"底部对齐\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n\r\n            <t-divider />\r\n\r\n            <t-form-item label=\"X\" name=\"x\">\r\n              <t-input-number v-model=\"rect.x\" @change=\"changeRect('x')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"Y\" name=\"y\">\r\n              <t-input-number v-model=\"rect.y\" @change=\"changeRect('y')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"宽\" name=\"width\">\r\n              <t-input-number v-model=\"rect.width\" @change=\"changeRect('width')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"高\" name=\"height\">\r\n              <t-input-number v-model=\"rect.height\" @change=\"changeRect('height')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"锁定宽高比\" name=\"ratio\">\r\n              <t-switch v-model=\"pen.ratio\" @change=\"changeValue('ratio')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"旋转角度\" name=\"rotate\">\r\n              <t-input-number v-model=\"pen.rotate\" @change=\"changeValue('rotate')\" />\r\n            </t-form-item>\r\n\r\n            <t-divider />\r\n            <t-form-item label=\"进度\" name=\"progress\">\r\n              <t-input-number v-model=\"pen.progress\" :step=\"0.1\" :min=\"0\" :max=\"1\" @change=\"changeValue('progress')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"进度颜色\" name=\"progressColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.progressColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" clearable @change=\"changeValue('progressColor')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"渐变颜色\" name=\"progressGradientColors\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.progressGradientColors\" :show-primary-color-preview=\"false\"\r\n                clearable format=\"CSS\" :color-modes=\"['linear-gradient']\"\r\n                @change=\"changeValue('progressGradientColors')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"垂直进度\" name=\"verticalProgress\">\r\n              <t-switch v-model=\"pen.verticalProgress\" @change=\"changeValue('verticalProgress')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"反向进度\" name=\"reverseProgress\">\r\n              <t-switch v-model=\"pen.reverseProgress\" @change=\"changeValue('reverseProgress')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"水平翻转\" name=\"flipX\">\r\n              <t-switch v-model=\"pen.flipX\" @change=\"changeValue('flipX')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"垂直翻转\" name=\"flipY\">\r\n              <t-switch v-model=\"pen.flipY\" @change=\"changeValue('flipY')\" />\r\n            </t-form-item>\r\n            <t-divider>图片</t-divider>\r\n            <t-form-item label=\"背景图片\">\r\n              <t-upload ref=\"uploadRef\" v-model=\"uploadValue\" :action=\"$attrs.uploadUrl ||\r\n                'https://service-bv448zsw-1257786608.gz.apigw.tencentcs.com/api/upload-demo'\r\n                \" :headers=\"headers\" name=\"object\" :sizeLimit=\"sizeLimit\" theme=\"image\" tips=\"请选择单张小于1MB的图片上传\"\r\n                accept=\"image/*\" @fail=\"handleFail\" @success=\"handleSuccess\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"背景图片地址\" name=\"backgroundImage\">\r\n              <t-input v-model=\"pen.image\" clearable @change=\"changeValue('image')\" />\r\n            </t-form-item>\r\n            <t-divider />\r\n\r\n            <template v-if=\"pen.name == 'combine' && pen.showChild != undefined\">\r\n              <t-form-item label=\"\" name=\"status\">\r\n                <t-select v-model=\"pen.showChild\" @change=\"changeValue('showChild')\">\r\n                  <t-option v-for=\"(item, index) in statusList\" :key=\"item.value\" :value=\"index\"\r\n                    :label=\"item.label\"></t-option>\r\n                </t-select>\r\n              </t-form-item>\r\n              <t-divider />\r\n            </template>\r\n\r\n            <t-space size=\"4px\">\r\n              <t-button @click=\"top\">置顶</t-button>\r\n              <t-button @click=\"bottom\">置底</t-button>\r\n              <t-button @click=\"up\">上一层</t-button>\r\n              <t-button @click=\"down\">下一层</t-button>\r\n            </t-space>\r\n          </t-form>\r\n        </div>\r\n      </template>\r\n      <template v-if=\"['image'].includes(pen.name)\" #image>\r\n        <div class=\"props-panel\">\r\n          <t-form label-align=\"left\">\r\n            <t-form-item label=\"图片上传\" name=\"image\">\r\n              <t-upload ref=\"uploadRef\" v-model=\"uploadValue\" :action=\"$attrs.uploadUrl ||\r\n                'https://service-bv448zsw-1257786608.gz.apigw.tencentcs.com/api/upload-demo'\r\n                \" :headers=\"headers\" name=\"object\" :sizeLimit=\"sizeLimit\" theme=\"image\" tips=\"请选择单张小于1MB的图片上传\"\r\n                accept=\"image/*\" @fail=\"handleFail\" @success=\"handleSuccess\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"图片地址\" name=\"image\">\r\n              <t-input v-model=\"pen.image\" clearable @change=\"changeValue('image')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"保持比例\" name=\"imageRatio\">\r\n              <t-switch v-model=\"pen.imageRatio\" @change=\"changeValue('imageRatio')\" />\r\n            </t-form-item>\r\n          </t-form>\r\n        </div>\r\n      </template>\r\n      <template #animate>\r\n        <div class=\"props-panel\">\r\n          <t-collapse :default-value=\"[0]\">\r\n            <t-collapse-panel header=\"动画\" name=\"animate\">\r\n              <t-form label-align=\"left\">\r\n                <template v-if=\"isLine\">\r\n                  <t-form-item label=\"动画效果\" name=\"lineAnimateType\">\r\n                    <t-select v-model=\"pen.lineAnimateType\" clearable @change=\"changeValue('lineAnimateType')\">\r\n                      <t-option v-for=\"item in LineAnimateOption\" :key=\"item.value\" :value=\"item.value\"\r\n                        :label=\"item.label\"></t-option>\r\n                    </t-select>\r\n                  </t-form-item>\r\n                  <t-form-item label=\"反向流动\" name=\"reverse\">\r\n                    <t-switch v-model=\"pen.animateReverse\" @change=\"changeValue('animateReverse')\" />\r\n                  </t-form-item>\r\n                  <t-form-item label=\"线宽\" name=\"animateLineWidth\">\r\n                    <t-input-number v-model=\"pen.animateLineWidth\" @change=\"changeValue('animateLineWidth')\" />\r\n                  </t-form-item>\r\n\r\n                  <t-form-item label=\"速度\" name=\"animateSpan\">\r\n                    <t-input-number v-model=\"pen.animateSpan\" :min=\"1\" :max=\"5\" @change=\"changeValue('animateSpan')\" />\r\n                  </t-form-item>\r\n                  <t-form-item label=\"颜色\" name=\"color\">\r\n                    <t-color-picker class=\"w-full\" v-model=\"pen.animateColor\" :show-primary-color-preview=\"false\"\r\n                      format=\"CSS\" :color-modes=\"['monochrome']\" @change=\"changeValue('animateColor')\" />\r\n                  </t-form-item>\r\n                  <t-form-item label=\"动画发光\" name=\"animateShadow\">\r\n                    <t-switch v-model=\"pen.animateShadow\" @change=\"changeValue('animateShadow')\" />\r\n                  </t-form-item>\r\n                  <t-form-item label=\"发光颜色\" name=\"animateShadowColor\">\r\n                    <t-color-picker class=\"w-full\" v-model=\"pen.animateShadowColor\" :show-primary-color-preview=\"false\"\r\n                      format=\"CSS\" :color-modes=\"['monochrome']\" @change=\"changeValue('animateShadowColor')\" />\r\n                  </t-form-item>\r\n                </template>\r\n                <template v-else>\r\n                  <t-form-item label=\"动画效果\" name=\"animateType\">\r\n                    <t-select v-model=\"pen.animateType\" clearable @change=\"changeValue('animateType')\">\r\n                      <t-option v-for=\"item in PenFrameOptions\" :key=\"item.value\" :value=\"item.value\"\r\n                        :label=\"item.label\"></t-option>\r\n                    </t-select>\r\n                  </t-form-item>\r\n\r\n                  <t-form-item v-if=\"pen.animateType == 'x-custom'\" label=\"自定义动画帧\">\r\n                    <div class=\"button__wrapper\">\r\n                      <t-button variant=\"text\" theme=\"primary\" @click=\"showFramesDrawer\">编辑\r\n                      </t-button>\r\n                      <br />\r\n                      <t-tag theme=\"danger\" style=\"margin-left: 20px\">或者</t-tag>\r\n                      <t-tooltip content=\"选中线条提取路径后复制，会覆盖已设置的动画\">\r\n                        <t-button variant=\"text\" theme=\"primary\" @click=\"createPathFrames\">\r\n                          从剪切板生成路径动画\r\n                        </t-button>\r\n                      </t-tooltip>\r\n                      <t-button v-if=\"pen.pathFrames?.length\" variant=\"text\" theme=\"primary\"\r\n                        @click=\"showPathDrawer\">编辑路径\r\n                      </t-button>\r\n                    </div>\r\n                  </t-form-item>\r\n                </template>\r\n\r\n                <t-form-item label=\"自动播放\" name=\"autoPlay\">\r\n                  <t-switch v-model=\"pen.autoPlay\" @change=\"changeValue('autoPlay')\" />\r\n                </t-form-item>\r\n                <t-form-item label=\"循环次数\" name=\"animateCycle\">\r\n                  <t-input-number v-model=\"pen.animateCycle\" :min=\"0\" @change=\"changeValue('animateCycle')\" />\r\n                </t-form-item>\r\n\r\n                <t-form-item label=\"保持动画状态\" name=\"keepAnimateState\">\r\n                  <t-switch v-model=\"pen.keepAnimateState\" @change=\"changeValue('keepAnimateState')\" />\r\n                </t-form-item>\r\n\r\n                <t-divider />\r\n                <t-space>\r\n                  <t-button @click=\"animate(true)\">播放</t-button>\r\n                  <t-button @click=\"animate()\">停止</t-button>\r\n                </t-space>\r\n              </t-form>\r\n            </t-collapse-panel>\r\n\r\n            <t-collapse-panel v-if=\"pen.name == 'video'\" header=\"视频\">\r\n              <t-form label-align=\"left\">\r\n                <t-form-item label=\"视频地址\" name=\"video\">\r\n                  <t-input v-model=\"pen.video\" placeholder=\"视频地址不能为空\" clearable @change=\"changeValue('video')\" />\r\n                </t-form-item>\r\n                <t-form-item label=\"自动播放\" name=\"autoPlay\">\r\n                  <t-switch v-model=\"pen.autoPlay\" @change=\"changeValue('autoPlay')\" />\r\n                </t-form-item>\r\n              </t-form>\r\n            </t-collapse-panel>\r\n          </t-collapse>\r\n        </div>\r\n      </template>\r\n\r\n      <template #struct>\r\n        <slot name=\"struct\" :pen=\"pen\"></slot>\r\n      </template>\r\n\r\n      <template #data>\r\n        <div class=\"props-panel\">\r\n          <t-form label-align=\"left\">\r\n            <t-form-item label=\"ID\" name=\"data\">\r\n              <t-tag maxWidth=\"100%\" style=\"flex: 1; width: 0\">{{\r\n                pen.id\r\n              }}</t-tag>\r\n\r\n              <t-button theme=\"primary\" variant=\"text\" style=\"margin-left: 10px\" @click=\"copyId\">\r\n                <t-icon name=\"copy\"></t-icon>\r\n              </t-button>\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"描述\" name=\"description\">\r\n              <t-input v-model=\"pen.description\" maxlength=\"50\" clearable @change=\"changeValue('description')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"标签\" name=\"tags\">\r\n              <t-tag-input v-model=\"pen.tags\" clearable placeholder=\"按回车添加标签，最多10个\" :max=\"10\"\r\n                @change=\"changeValue('tags')\" />\r\n            </t-form-item>\r\n            <template v-if=\"pen.name == 'line'\">\r\n              <t-form-item label=\"\" name=\"description\">\r\n                <t-button theme=\"primary\" @click=\"track\">提取轨迹</t-button>\r\n              </t-form-item>\r\n              <t-form-item v-if=\"linePathString\">\r\n                <t-typography-text code :copyable=\"{ onCopy, }\">{{\r\n                  linePathString\r\n                }}</t-typography-text>\r\n              </t-form-item>\r\n            </template>\r\n          </t-form>\r\n        </div>\r\n      </template>\r\n\r\n      <template #event>\r\n        <EventEditor :defaultEventsValue=\"pen.events\" @change=\"eventsChange\" />\r\n      </template>\r\n    </PropsTab>\r\n\r\n    <t-drawer v-model:visible=\"drawerVisible\" header=\"自定义动画帧\" size=\"20%\" :onConfirm=\"addFrames\">\r\n      <t-button block theme=\"primary\" @click=\"insertFrame\">新增动画帧</t-button>\r\n      <t-collapse class=\"meta-collapse\" expand-mutex>\r\n        <t-collapse-panel v-for=\"item in customFrames\" header=\"动画帧\">\r\n          <prop-editor :data=\"item\" :statusList=\"statusList\"></prop-editor>\r\n          <template #headerRightContent>\r\n            <t-button size=\"small\" variant=\"outline\" theme=\"danger\" :style=\"{ marginLeft: '8px' }\"\r\n              @click=\"deleteFrame(item)\">\r\n              <t-icon name=\"delete\"></t-icon>\r\n            </t-button>\r\n          </template>\r\n        </t-collapse-panel>\r\n      </t-collapse>\r\n    </t-drawer>\r\n\r\n    <t-drawer v-model:visible=\"pathDrawerVisible\" header=\"自定义路径\" size=\"20%\" :onConfirm=\"closePathDrawer\">\r\n      <t-collapse v-if=\"pen && pen.pathFrames\" class=\"meta-collapse\" expand-mutex>\r\n        <t-collapse-panel v-for=\"(item, index) in pen.pathFrames\" :header=\"`路径-${index + 1}`\">\r\n          <t-form label-align=\"left\">\r\n            <t-form-item label=\"时长(ms)\" name=\"duration\">\r\n              <t-input-number v-model=\"item.duration\" :min=\"0\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"偏移X\" name=\"x\">\r\n              <t-input-number v-model=\"item.x\" placeholder=\"px\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"偏移Y\" name=\"y\">\r\n              <t-input-number v-model=\"item.y\" placeholder=\"px\" />\r\n            </t-form-item>\r\n          </t-form>\r\n          <template #headerRightContent>\r\n            <t-button size=\"small\" variant=\"outline\" theme=\"danger\" :style=\"{ marginLeft: '8px' }\"\r\n              @click=\"deletePathFrame(index)\">\r\n              <t-icon name=\"delete\"></t-icon>\r\n            </t-button>\r\n          </template>\r\n        </t-collapse-panel>\r\n      </t-collapse>\r\n    </t-drawer>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, onUnmounted, ref, watch, computed, nextTick } from \"vue\";\r\nimport { useSelection } from \"../services/selections\";\r\nimport { useUpload } from \"../services/useUpload\";\r\nimport {\r\n  PenFrameOptions,\r\n  PenFrames,\r\n  LineAnimateOption,\r\n} from \"../utils/penFrames.ts\";\r\nimport PropEditor from \"./PropEditor.vue\";\r\nimport { deepClone } from \"@meta2d/core\";\r\nimport { copyToClipboard } from \"../utils/index.ts\";\r\nimport { MessagePlugin } from \"tdesign-vue-next\";\r\nimport PropsTab from \"./PropsTab.vue\";\r\nimport EventEditor from \"./EventEditor.vue\";\r\nimport { createPathAnimation } from '../utils/pathAnimate'\r\n\r\nconst tabs = computed(() => {\r\n  return [\r\n    {\r\n      label: \"图元\",\r\n      value: 1,\r\n      slot: \"pen\",\r\n    },\r\n    {\r\n      label: \"图片\",\r\n      value: 2,\r\n      slot: \"image\",\r\n    },\r\n    {\r\n      label: \"动效\",\r\n      value: 3,\r\n      slot: \"animate\",\r\n    },\r\n    {\r\n      label: \"结构\",\r\n      value: 4,\r\n      slot: \"struct\",\r\n    },\r\n    {\r\n      label: \"数据\",\r\n      value: 5,\r\n      slot: \"data\",\r\n    },\r\n    {\r\n      label: \"事件\",\r\n      value: 6,\r\n      slot: \"event\",\r\n    },\r\n  ].filter((item) => {\r\n    if (item.slot == \"image\") {\r\n      return pen.value.name == item.slot;\r\n    }\r\n    return true;\r\n  });\r\n});\r\n\r\nconst { selections } = useSelection();\r\n\r\nconst pen = ref<any>();\r\n// 位置数据。当前版本位置需要动态计算获取\r\nconst rect = ref<any>();\r\nconst activePanel = ref(1);\r\n\r\nconst isLine = computed(() => {\r\n  return pen.value?.name == \"line\";\r\n});\r\n\r\nonMounted(() => {\r\n  activePanel.value = 1;\r\n  getPen();\r\n});\r\n\r\nconst getPen = () => {\r\n  linePathString.value = \"\";\r\n  pen.value = selections.pen || {};\r\n  if (pen.value.globalAlpha == undefined) {\r\n    pen.value.globalAlpha = 1;\r\n  }\r\n  if (!pen.value.tags) {\r\n    pen.value.tags = [];\r\n  }\r\n\r\n  rect.value = meta2d.getPenRect(pen.value);\r\n\r\n  if (activePanel.value == 2) {\r\n    // 非 图片\r\n    if (![\"image\"].includes(pen.value.name)) {\r\n      activePanel.value = 1;\r\n    }\r\n  }\r\n};\r\n\r\n// 状态组合列表\r\nconst statusList = computed(() => {\r\n  if (pen.value?.name != \"combine\") return [];\r\n  return pen.value.children.map((id: string, index: number) => {\r\n    return {\r\n      label: `状态${index + 1}`,\r\n      value: id,\r\n    };\r\n  });\r\n});\r\n\r\n// 动画\r\nconst animate = (play: boolean = false) => {\r\n  // console.log(\"animate: \", play, pen.value);\r\n  // 自定义的路径动画\r\n  if (pen.value.animateType == 'x-custom' && pen.value.pathFrames) {\r\n    let control = pen.value.pathAnimateControl\r\n    if (!control || !control.play) {\r\n      pen.value.pathAnimateControl = createPathAnimation(pen.value, pen.value.pathFrames)\r\n      control = pen.value.pathAnimateControl\r\n    }\r\n    if (play) {\r\n      control.play()\r\n    } else {\r\n      control.stop()\r\n    }\r\n    return;\r\n  }\r\n\r\n\r\n  if (play) {\r\n    meta2d.startAnimate(pen.value.id);\r\n  } else {\r\n    meta2d.stopAnimate(pen.value.id);\r\n  }\r\n};\r\n\r\n// * 自定义动画帧\r\nconst drawerVisible = ref(false);\r\nconst customFrames = ref<any>([]);\r\n\r\nconst showFramesDrawer = () => {\r\n  customFrames.value = deepClone(pen.value.frames || []);\r\n  drawerVisible.value = true;\r\n};\r\nconst addFrames = () => {\r\n  // 动画帧数组\r\n  console.log(\"custom frames: \", customFrames.value);\r\n  pen.value.frames = deepClone(customFrames.value);\r\n  drawerVisible.value = false;\r\n  nextTick(() => {\r\n    customFrames.value = [];\r\n  });\r\n};\r\n\r\nconst insertFrame = () => {\r\n  customFrames.value.push({\r\n    duration: 100,\r\n    globalAlpha: 1,\r\n    penName: pen.value.name,\r\n  });\r\n};\r\n\r\nconst deleteFrame = (frame: any) => {\r\n  const index = customFrames.value.indexOf(frame);\r\n  if (index > -1) {\r\n    customFrames.value.splice(index, 1);\r\n  }\r\n};\r\n\r\n// 监听选中不同图元\r\n// @ts-ignore\r\nconst watcher = watch(() => selections.pen?.id, getPen);\r\n\r\nconst lineDashs = [undefined, [5, 5]];\r\n\r\nconst changeValue = (prop: string) => {\r\n  const v: any = { id: pen.value.id };\r\n  v[prop] = pen.value[prop];\r\n  if (prop === \"dash\") {\r\n    v.lineDash = lineDashs[v[prop]];\r\n  }\r\n  if (prop == \"animateType\") {\r\n    // 补全动画帧\r\n    console.log(\"animate type: \", v);\r\n    const animateType = v.animateType as keyof typeof PenFrames;\r\n    const frames = PenFrames[animateType];\r\n    v.frames = frames;\r\n  }\r\n  console.log(\"change value: \", v);\r\n  meta2d.setValue(v, { render: true });\r\n  console.log(\"meta2d: \", meta2d);\r\n};\r\n\r\nconst changeRect = (prop: string) => {\r\n  const v: any = { id: pen.value.id };\r\n  v[prop] = rect.value[prop];\r\n  meta2d.setValue(v, { render: true });\r\n};\r\n\r\nconst top = () => {\r\n  meta2d.top();\r\n  meta2d.render();\r\n};\r\nconst bottom = () => {\r\n  meta2d.bottom();\r\n  meta2d.render();\r\n};\r\nconst up = () => {\r\n  meta2d.up();\r\n  meta2d.render();\r\n};\r\nconst down = () => {\r\n  meta2d.down();\r\n  meta2d.render();\r\n};\r\n\r\nonUnmounted(() => {\r\n  watcher();\r\n});\r\n\r\n// * 文件上传\r\nconst uploadRef = ref();\r\nconst { uploadValue, sizeLimit, headers } = useUpload();\r\n\r\nconst handleSuccess = (context: any) => {\r\n  console.log(\"upload success: \", context);\r\n  if (context.response) {\r\n    pen.value.image = context.response.url || context.response.data?.fileurl;\r\n    changeValue(\"image\");\r\n  }\r\n};\r\n\r\nconst handleFail = (e: any) => {\r\n  console.log(\"upload fail: \", e);\r\n};\r\n\r\nconst copyId = () => {\r\n  copyToClipboard(pen.value.id).then((res) => {\r\n    console.log(\"copy id: \", res);\r\n    // 提示\r\n    MessagePlugin.success({ content: \"复制成功\" });\r\n  });\r\n};\r\n\r\n// * 事件处理\r\nconst eventsChange = (events: any) => {\r\n  pen.value.events = events;\r\n};\r\n\r\nconst linePathString = ref(\"\");\r\nconst track = () => {\r\n  const res: any[] = [];\r\n  // const wAnchors = pen.value.calculative?.worldAnchors;\r\n  const anchors = pen.value.anchors; // 相对位置\r\n  const width = pen.value.width;\r\n  const height = pen.value.height;\r\n  if (Array.isArray(anchors)) {\r\n    anchors.forEach((anchor: any) => {\r\n      res.push({ x: anchor.x * width, y: anchor.y * height });\r\n    });\r\n  }\r\n  console.log(\"path: \", res);\r\n  linePathString.value = JSON.stringify(res, null, 2);\r\n};\r\n\r\n\r\nconst copyTmpKey = 'meta2d_tmp_copy_string';\r\nconst onCopy = () => {\r\n  console.log(\"on copy: \", linePathString.value);\r\n  localStorage.setItem(copyTmpKey, linePathString.value);\r\n}\r\n\r\nconst createPathFrames = () => {\r\n  console.log(\"create path frames: \", pen.value);\r\n  // TODO: 剪切板数据\r\n  function createPathList(text: string) {\r\n    try {\r\n      const array = JSON.parse(text);\r\n      console.log(\"剪切板数据: \", array);\r\n      if (Array.isArray(array)) {\r\n        // 计算偏移量，相对于前一个点\r\n        const paths = array\r\n          .map((item: any, index: number) => {\r\n            if (index > 0) {\r\n              const prev = array[index - 1];\r\n              const x = item.x - prev.x;\r\n              const y = item.y - prev.y;\r\n              return { x, y };\r\n            }\r\n          })\r\n          .filter((item: any) => item);\r\n        console.log(\"paths: \", paths);\r\n        pen.value.pathFrames = paths.map((item: any) => {\r\n          return {\r\n            x: item.x,\r\n            y: item.y,\r\n            duration: 10000,\r\n          };\r\n        });\r\n      }\r\n      MessagePlugin.success({ content: \"生成成功\" });\r\n    } catch (error) {\r\n      console.log(\"JSON 解析失败: \", error);\r\n      MessagePlugin.error({ content: \"生成失败, 请检查操作是否正确\" });\r\n    }\r\n  }\r\n  if (!navigator.clipboard) {\r\n    const tmpText = localStorage.getItem(copyTmpKey);\r\n    if (tmpText) {\r\n      createPathList(tmpText);\r\n      return;\r\n    }\r\n    MessagePlugin.error({ content: \"无法访问剪切板\" });\r\n    return;\r\n  }\r\n  navigator.clipboard\r\n    .readText()\r\n    .then((text) => {\r\n      createPathList(text);\r\n    })\r\n    .catch((err) => {\r\n      console.error(\"读取剪切板数据失败:\", err);\r\n      MessagePlugin.error({ content: \"生成失败, 无法访问剪切板\" });\r\n    });\r\n};\r\n\r\nconst pathDrawerVisible = ref(false);\r\nconst showPathDrawer = () => {\r\n  pathDrawerVisible.value = true;\r\n}\r\n\r\nconst closePathDrawer = () => {\r\n  pathDrawerVisible.value = false;\r\n}\r\n\r\nconst deletePathFrame = (index: number) => {\r\n  pen.value.pathFrames.splice(index, 1);\r\n}\r\n\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.props-panel {\r\n  padding: 10px;\r\n\r\n  :deep(.t-form) {\r\n    .t-form__item {\r\n      margin-bottom: 8px;\r\n    }\r\n\r\n    .t-form__label {\r\n      padding-right: 8px;\r\n    }\r\n\r\n    .t-divider {\r\n      margin: 12px 0;\r\n    }\r\n\r\n    .t-input--auto-width {\r\n      width: 100%;\r\n    }\r\n\r\n    .t-space {\r\n      gap: 4px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n<style lang=\"css\">\r\n.t-typography {\r\n  code {\r\n    white-space: pre;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <props-tab :tabs=\"tabs\">\r\n    <template #pen-props>\r\n      <div class=\"props-panel\">\r\n        <t-form label-align=\"left\" v-if=\"pen\">\r\n          <t-form-item label=\"文本\" name=\"text\">\r\n            <t-input v-model=\"pen.text\" @change=\"changeValue('text')\" />\r\n          </t-form-item>\r\n          <t-form-item label=\"颜色\" name=\"color\">\r\n            <t-color-picker class=\"w-full\" v-model=\"pen.color\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n              :color-modes=\"['monochrome']\" @change=\"changeValue('color')\" />\r\n          </t-form-item>\r\n          <t-form-item label=\"背景\" name=\"background\">\r\n            <t-color-picker class=\"w-full\" v-model=\"pen.background\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n              :color-modes=\"['monochrome']\" @change=\"changeValue('background')\" />\r\n          </t-form-item>\r\n          <t-form-item label=\"线条\" name=\"dash\">\r\n            <t-select v-model=\"pen.dash\" @change=\"changeValue('dash')\">\r\n              <t-option :key=\"0\" :value=\"0\" label=\"实线\"></t-option>\r\n              <t-option :key=\"1\" :value=\"1\" label=\"虚线\"></t-option>\r\n            </t-select>\r\n          </t-form-item>\r\n          <t-form-item label=\"线条宽度\" name=\"lineWidth\">\r\n            <t-input-number v-model=\"pen.lineWidth\" @change=\"changeValue('lineWidth')\" />\r\n          </t-form-item>\r\n\r\n          <t-form-item label=\"圆角\" name=\"borderRadius\">\r\n            <t-input-number :min=\"0\" :max=\"1\" :step=\"0.01\" v-model=\"pen.borderRadius\"\r\n              @change=\"changeValue('borderRadius')\" />\r\n          </t-form-item>\r\n          <t-form-item label=\"不透明度\" name=\"globalAlpha\">\r\n            <t-slider v-model=\"pen.globalAlpha\" :min=\"0\" :max=\"1\" :step=\"0.01\" @change=\"changeValue('globalAlpha')\" />\r\n            <span class=\"ml-16\" style=\"width: 50px; line-height: 30px\">\r\n              {{ pen.globalAlpha }}\r\n            </span>\r\n          </t-form-item>\r\n\r\n          <t-divider />\r\n\r\n          <t-form-item label=\"文字水平对齐\" name=\"textAlign\">\r\n            <t-select v-model=\"pen.textAlign\" @change=\"changeValue('textAlign')\">\r\n              <t-option key=\"left\" value=\"left\" label=\"左对齐\"></t-option>\r\n              <t-option key=\"center\" value=\"center\" label=\"居中\"></t-option>\r\n              <t-option key=\"right\" value=\"right\" label=\"右对齐\"></t-option>\r\n            </t-select>\r\n          </t-form-item>\r\n          <t-form-item label=\"文字垂直对齐\" name=\"textBaseline\">\r\n            <t-select v-model=\"pen.textBaseline\" @change=\"changeValue('textBaseline')\">\r\n              <t-option key=\"top\" value=\"top\" label=\"顶部对齐\"></t-option>\r\n              <t-option key=\"middle\" value=\"middle\" label=\"居中\"></t-option>\r\n              <t-option key=\"bottom\" value=\"bottom\" label=\"底部对齐\"></t-option>\r\n            </t-select>\r\n          </t-form-item>\r\n          <t-divider />\r\n          <t-collapse expand-icon borderless defaultExpandAll>\r\n            <t-collapse-panel value=\"0\" header=\"对齐\">\r\n              <t-button v-for=\"(item, index) in alginOptions\" :key=\"index\" shape=\"square\" variant=\"outline\"\r\n                style=\"margin-right: 4px\" @click=\"align(item)\">\r\n                <t-icon :name=\"item.icon\" />\r\n              </t-button>\r\n            </t-collapse-panel>\r\n          </t-collapse>\r\n          <t-divider />\r\n          <t-space>\r\n            <t-tooltip content=\"清空高亮图元\">\r\n              <t-button @click=\"inactive\">取消选中</t-button>\r\n            </t-tooltip>\r\n          </t-space>\r\n        </t-form>\r\n      </div>\r\n    </template>\r\n    <template #struct-props>\r\n      <slot name=\"struct\" :pen=\"pen\"></slot>\r\n    </template>\r\n    <template #animation-props>\r\n      <div class=\"props-panel\">\r\n        <t-form v-if=\"allIsLine || allIsRect\" label-width=\"80px\" label-align=\"left\">\r\n          <t-space style=\"width: 100%\">\r\n            <t-alert theme=\"warning\" title=\"批量修改所有图元的动画\" message=\"执行了操作后才会修改\">\r\n            </t-alert>\r\n          </t-space>\r\n          <t-divider />\r\n\r\n          <template v-if=\"allIsRect\">\r\n            <t-form-item label=\"动画效果\" name=\"animateType\">\r\n              <t-select v-model=\"pen.animateType\" clearable @change=\"changeValue('animateType')\">\r\n                <t-option v-for=\"item in PenFrameOptions\" :key=\"item.value\" :value=\"item.value\"\r\n                  :label=\"item.label\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n            <t-form-item v-if=\"pen.animateType == 'x-custom'\" label=\"自定义动画帧\">\r\n              <t-button variant=\"text\" theme=\"primary\" @click=\"showFramesDrawer\">编辑\r\n              </t-button>\r\n            </t-form-item>\r\n          </template>\r\n\r\n          <template v-else-if=\"allIsLine\">\r\n            <t-form-item label=\"动画效果\" name=\"lineAnimateType\">\r\n              <t-select v-model=\"pen.lineAnimateType\" clearable @change=\"changeValue('lineAnimateType')\">\r\n                <t-option v-for=\"item in LineAnimateOption\" :key=\"item.value\" :value=\"item.value\"\r\n                  :label=\"item.label\"></t-option>\r\n              </t-select>\r\n            </t-form-item>\r\n            <t-form-item label=\"反向流动\" name=\"reverse\">\r\n              <t-switch v-model=\"pen.animateReverse\" @change=\"changeValue('animateReverse')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"线宽\" name=\"animateLineWidth\">\r\n              <t-input-number v-model=\"pen.animateLineWidth\" @change=\"changeValue('animateLineWidth')\" />\r\n            </t-form-item>\r\n\r\n            <t-form-item label=\"速度\" name=\"animateSpan\">\r\n              <t-input-number v-model=\"pen.animateSpan\" :min=\"1\" :max=\"5\" @change=\"changeValue('animateSpan')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"颜色\" name=\"color\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.animateColor\" :show-primary-color-preview=\"false\" format=\"CSS\"\r\n                :color-modes=\"['monochrome']\" @change=\"changeValue('animateColor')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"动画发光\" name=\"animateShadow\">\r\n              <t-switch v-model=\"pen.animateShadow\" @change=\"changeValue('animateShadow')\" />\r\n            </t-form-item>\r\n            <t-form-item label=\"发光颜色\" name=\"animateShadowColor\">\r\n              <t-color-picker class=\"w-full\" v-model=\"pen.animateShadowColor\" :show-primary-color-preview=\"false\"\r\n                format=\"CSS\" :color-modes=\"['monochrome']\" @change=\"changeValue('animateShadowColor')\" />\r\n            </t-form-item>\r\n          </template>\r\n\r\n          <t-form-item label=\"自动播放\" name=\"autoPlay\">\r\n            <t-switch v-model=\"pen.autoPlay\" @change=\"changeValue('autoPlay')\" />\r\n          </t-form-item>\r\n\r\n          <t-divider />\r\n          <div>\r\n            <t-statistic title=\"图元总数\" :value=\"pensTotal\" trend=\"increase\" color=\"orange\" />\r\n          </div>\r\n          <t-space>\r\n            <t-tooltip content=\"对大量图元执行动画时存在性能问题，请谨慎操作\">\r\n              <t-button @click=\"animate(true)\">播放</t-button>\r\n            </t-tooltip>\r\n            <t-tooltip content=\"\">\r\n              <t-button @click=\"animate()\">停止</t-button>\r\n            </t-tooltip>\r\n          </t-space>\r\n        </t-form>\r\n        <t-alert v-else theme=\"error\">\r\n          只能对同一类型的图元批量设置动画\r\n        </t-alert>\r\n\r\n        <t-drawer v-model:visible=\"drawerVisible\" header=\"自定义动画帧\" size=\"20%\" :onConfirm=\"addFrames\">\r\n          <t-button block theme=\"primary\" @click=\"insertFrame\">新增动画帧</t-button>\r\n          <t-collapse class=\"meta-collapse\" expand-mutex>\r\n            <t-collapse-panel v-for=\"item in customFrames\" header=\"动画帧\">\r\n              <prop-editor :data=\"item\"></prop-editor>\r\n              <template #headerRightContent>\r\n                <t-button size=\"small\" variant=\"outline\" theme=\"danger\" :style=\"{ marginLeft: '8px' }\"\r\n                  @click=\"deleteFrame(item)\">\r\n                  <t-icon name=\"delete\"></t-icon>\r\n                </t-button>\r\n              </template>\r\n            </t-collapse-panel>\r\n          </t-collapse>\r\n        </t-drawer>\r\n      </div>\r\n    </template>\r\n  </props-tab>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, onUnmounted, ref, watch, computed, nextTick } from \"vue\";\r\nimport { useSelection } from \"../services/selections\";\r\nimport PropsTab from \"./PropsTab.vue\";\r\nimport { Pen } from \"@meta2d/core\";\r\nimport {\r\n  PenFrameOptions,\r\n  LineAnimateOption,\r\n  PenFrames,\r\n} from \"../utils/penFrames\";\r\nimport { deepClone } from \"@meta2d/core\";\r\nimport PropEditor from \"./PropEditor.vue\";\r\n\r\nconst tabs = [\r\n  {\r\n    label: \"图元组\",\r\n    value: 1,\r\n    slot: \"pen-props\",\r\n  },\r\n  {\r\n    label: \"结构\",\r\n    value: 2,\r\n    slot: \"struct-props\",\r\n  },\r\n\r\n  {\r\n    label: \"动效\",\r\n    value: 3,\r\n    slot: \"animation-props\",\r\n  },\r\n];\r\n\r\nconst { selections } = useSelection();\r\n\r\nconst pen = ref<any>({\r\n  globalAlpha: 1,\r\n});\r\n// 位置数据。当前版本位置需要动态计算获取\r\nconst rect = ref<any>();\r\n\r\nonMounted(() => {\r\n  getPen();\r\n});\r\n\r\nconst getPen = () => {\r\n  // console.log(\"get pen: \", allIsLine.value, allIsRect.value);\r\n  rect.value = meta2d.getPenRect(pen.value);\r\n};\r\n\r\nconst allIsLine = computed(() => {\r\n  return selections.pens?.every((pen: any) => pen.type === 1);\r\n});\r\n\r\nconst allIsRect = computed(() => {\r\n  return selections.pens?.every((pen: any) => !pen.type);\r\n});\r\nconst pensTotal = computed(() => {\r\n  return selections.pens?.length || 0;\r\n});\r\n\r\n// 监听选中不同图元\r\n// @ts-ignore\r\nconst watcher = watch(() => selections.pens, getPen);\r\n\r\nconst lineDashs = [undefined, [5, 5]];\r\n\r\nconst changeValue = (prop: string) => {\r\n  // console.log(\"change value: \", prop, pen.value, selections.pens);\r\n  if (selections.pens?.length) {\r\n    const newValue = pen.value[prop];\r\n    selections.pens.forEach((pen: any) => {\r\n      const v: any = { id: pen.id };\r\n      v[prop] = newValue;\r\n      if (prop === \"dash\") {\r\n        v.lineDash = lineDashs[v[prop]];\r\n      } else if (prop == \"animateType\") {\r\n        const animateType = v.animateType as keyof typeof PenFrames;\r\n        const frames = PenFrames[animateType];\r\n        v.frames = frames;\r\n      }\r\n      meta2d.setValue(v, { render: false });\r\n    });\r\n    meta2d.render();\r\n  }\r\n};\r\n\r\nconst animate = (play = false) => {\r\n  // 不传执行所有自动播放的画笔的动画\r\n  // console.log(\"animate: \", play, selections.pens)\r\n\r\n  // ! 使用 Pen[] 有bug，有的不生效\r\n  // if (play) {\r\n  //   meta2d.startAnimate(selections.pens)\r\n  // } else {\r\n  //   meta2d.stopAnimate(selections.pens)\r\n  // }\r\n\r\n  selections.pens?.forEach((pen: any) => {\r\n    if (play) {\r\n      meta2d.startAnimate(pen.id);\r\n    } else {\r\n      meta2d.stopAnimate(pen.id);\r\n    }\r\n  });\r\n};\r\n\r\nconst alginOptions = [\r\n  { label: \"左对齐\", value: \"left\", icon: \"format-vertical-align-left\" },\r\n  { label: \"右对齐\", value: \"right\", icon: \"format-vertical-align-right\" },\r\n  { label: \"顶部对齐\", value: \"top\", icon: \"format-horizontal-align-top\" },\r\n  {\r\n    label: \"底部对齐\",\r\n    value: \"bottom\",\r\n    icon: \"format-horizontal-align-bottom\",\r\n  },\r\n  { label: \"垂直居中\", value: \"center\", icon: \"format-vertical-align-center\" },\r\n  {\r\n    label: \"水平居中\",\r\n    value: \"middle\",\r\n    icon: \"format-horizontal-align-center\",\r\n  },\r\n];\r\n// 对齐方式: left, right, top, bottom, center, middle\r\nconst align = (item: any) => {\r\n  const nodes = selections.pens;\r\n  if (nodes?.length) {\r\n    meta2d.alignNodes(item.value, nodes as Pen[]);\r\n  }\r\n};\r\n\r\nonUnmounted(() => {\r\n  watcher();\r\n});\r\n\r\nconst drawerVisible = ref(false);\r\nconst customFrames = ref<any>([]);\r\n\r\nconst showFramesDrawer = () => {\r\n  customFrames.value = deepClone(pen.value.frames || []);\r\n  drawerVisible.value = true;\r\n};\r\nconst addFrames = () => {\r\n  // 动画帧数组\r\n  pen.value.frames = deepClone(customFrames.value);\r\n  changeValue(\"frames\");\r\n  drawerVisible.value = false;\r\n  nextTick(() => {\r\n    customFrames.value = [];\r\n  });\r\n};\r\n\r\nconst insertFrame = () => {\r\n  customFrames.value.push({\r\n    duration: 100,\r\n    globalAlpha: 1,\r\n  });\r\n};\r\n\r\nconst deleteFrame = (frame: any) => {\r\n  const index = customFrames.value.indexOf(frame);\r\n  if (index > -1) {\r\n    customFrames.value.splice(index, 1);\r\n  }\r\n};\r\n\r\nconst inactive = () => {\r\n  meta2d.inactive();\r\n};\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.props-panel {\r\n  padding: 10px;\r\n\r\n  :deep(.t-form) {\r\n    .t-form__item {\r\n      margin-bottom: 8px;\r\n    }\r\n\r\n    .t-form__label {\r\n      padding-right: 8px;\r\n    }\r\n\r\n    .t-divider {\r\n      margin: 12px 0;\r\n    }\r\n\r\n    .t-input--auto-width {\r\n      width: 100%;\r\n    }\r\n\r\n    .t-space {\r\n      gap: 4px;\r\n    }\r\n\r\n    .t-collapse-panel__wrapper .t-collapse-panel__content {\r\n      padding-left: 10px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <t-tree hover line expand-all activable v-model:actived=\"actived\" :data=\"pensTree\"\r\n    :keys=\"{ label: 'name', value: 'id', children: 'list' }\" :icon=\"icon\" :scroll=\"{\r\n      rowHeight: 34,\r\n      bufferSize: 30,\r\n      threshold: 50,\r\n      type: 'virtual',\r\n    }\" style=\"padding: 10px; height: 100%;\">\r\n    <template #label=\"{ node }\">\r\n      <span @click=\"click(node)\"> {{ node.label }} - {{ node.data.text || node.data.description || node.value }}</span>\r\n    </template>\r\n    <template #operations=\"{ node }\">\r\n      <div class=\"tdesign-demo-block-row\">\r\n        <t-icon :name=\"node.data.visible !== false ? 'browse' : 'browse-off'\" @click=\"toggleVisible(node)\"></t-icon>\r\n      </div>\r\n    </template>\r\n  </t-tree>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, computed, onMounted, ref, onUnmounted, watch, } from \"vue\";\r\nimport { Icon, TreeNodeModel } from \"tdesign-vue-next\";\r\nimport { useSelection } from '../services/selections.ts'\r\n\r\nconst props = defineProps({});\r\n\r\n// 获取画布组件\r\nlet data = ref(meta2d.data());\r\n\r\nconst pensTree = computed(() => {\r\n  const pens = data.value.pens;\r\n  return pens.filter((pen: any) => {\r\n    if (!pen.parentId) {\r\n      if (pen.children) {\r\n        const children: any[] = [];\r\n        pen.children.forEach((id: string) => {\r\n          const child = pens.find((pen) => pen.id === id);\r\n          if (child) {\r\n            children.push(child);\r\n          }\r\n        });\r\n        pen.list = children;\r\n      }\r\n\r\n      return true;\r\n    }\r\n  });\r\n});\r\n\r\nconst updateData = () => {\r\n  data.value = meta2d.data();\r\n}\r\n\r\nconst { selections } = useSelection()\r\nconst actived = ref([])\r\nwatch(selections, (val) => {\r\n  // console.log(\"structure selections: \", val);\r\n  const { mode } = val;\r\n  if (mode == 1 && val.pen) {\r\n    actived.value = [val.pen.id]\r\n    // const active = pensTree.value.find((pen) => pen.id === val.pen.id);\r\n    // if (active) {\r\n    // actived.value = [active.id]\r\n    // }\r\n  }\r\n  // ! 高亮只会存在一个\r\n  // else if (mode == 2 && val.pens) {\r\n  //   actived.value = val.pens.map((pen: Pen) => pen.id)\r\n  // }\r\n  else {\r\n    actived.value = []\r\n  }\r\n}, {\r\n  immediate: true,\r\n})\r\n\r\nonMounted(() => {\r\n  meta2d.on('add', updateData)\r\n  meta2d.on('delete', updateData)\r\n  meta2d.on('clear', updateData)\r\n})\r\n\r\nonUnmounted(() => {\r\n  meta2d.off('add', updateData)\r\n  meta2d.off('delete', updateData)\r\n})\r\n\r\n\r\n// console.log(\"pens: \", pensTree);\r\nconst icon = (h: Function, node: TreeNodeModel) => {\r\n  const iconMap: Record<string | number, string> = {\r\n    1: \"git-commit\",\r\n    combine: \"folder\",\r\n    image: \"image\",\r\n  };\r\n\r\n  const iconName =\r\n    iconMap[node.data.type] || iconMap[node.data.name] || \"rectangle\";\r\n\r\n  return h(Icon, { name: iconName });\r\n};\r\n\r\nconst toggleVisible = (node: TreeNodeModel) => {\r\n  node.data.visible = node.data.visible === false ? true : false;\r\n  node.setData(node.data);\r\n  meta2d.setValue({\r\n    id: node.data.id,\r\n    visible: node.data.visible,\r\n  });\r\n};\r\n\r\nconst click = (node: TreeNodeModel) => {\r\n  // console.log(context);\r\n  const pen = meta2d.findOne(node.data.id);\r\n  if (pen) {\r\n    meta2d.active([pen]);\r\n    meta2d.render();\r\n    meta2d.gotoView(pen);\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped></style>\r\n","<template>\r\n  <div v-if=\"shouldRender\" class=\"app-props\">\r\n    <FileProps v-show=\"selections.mode === SelectionMode.File\" key=\"file\" class=\"props__file\" v-bind=\"$attrs\">\r\n      <template #struct>\r\n        <Structure v-bind=\"$attrs\" />\r\n      </template>\r\n    </FileProps>\r\n    <PenProps v-show=\"selections.mode === SelectionMode.Pen\" key=\"pen\" class=\"props__pen\" v-bind=\"$attrs\">\r\n      <template #struct>\r\n        <Structure v-bind=\"$attrs\" />\r\n      </template>\r\n    </PenProps>\r\n\r\n    <PensProps v-show=\"selections.mode === SelectionMode.Pens\" key=\"pens\" class=\"props__pens\" v-bind=\"$attrs\">\r\n      <template #struct>\r\n        <Structure v-bind=\"$attrs\" />\r\n      </template>\r\n    </PensProps>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport FileProps from \"./FileProps.vue\";\r\nimport PenProps from \"./PenProps.vue\";\r\nimport PensProps from \"./PensProps.vue\";\r\nimport { useSelection, SelectionMode } from \"../services/selections\";\r\nimport { computed, watch } from \"vue\";\r\nimport Structure from \"./Structure.vue\";\r\n\r\nconst { selections } = useSelection();\r\n\r\nconst shouldRender = computed(() => {\r\n  return [SelectionMode.File, SelectionMode.Pen, SelectionMode.Pens].includes(\r\n    selections.mode\r\n  );\r\n});\r\n\r\n\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.app-props {\r\n  padding: 16px;\r\n  border-left: 1px solid var(--color-border);\r\n  z-index: 2;\r\n  height: calc(100vh - 80px);\r\n  overflow-y: auto;\r\n\r\n  .props__file, .props__pen {\r\n    height: 100%;\r\n  }\r\n\r\n  :deep(.t-tabs) {\r\n    height: 100%;\r\n\r\n    .t-tabs__content {\r\n      overflow: auto;\r\n      height: calc(100% - 50px);\r\n\r\n      .t-tab-panel {\r\n        height: 100%;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","export const defaultGraphics = [\r\n  {\r\n    name: '基本形状',\r\n    show: true,\r\n    list: [\r\n      {\r\n        name: '正方形',\r\n        icon: 'l-rect',\r\n        id: 1,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'square',\r\n        },\r\n      },\r\n      {\r\n        name: '矩形',\r\n        icon: 'l-rectangle',\r\n        id: 2,\r\n        data: {\r\n          width: 200,\r\n          height: 50,\r\n          borderRadius: 0.1,\r\n          name: 'rectangle',\r\n        },\r\n      },\r\n      {\r\n        name: '圆',\r\n        icon: 'l-circle',\r\n        id: 3,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'circle',\r\n        },\r\n      },\r\n      {\r\n        name: '三角形',\r\n        icon: 'l-triangle',\r\n        id: 4,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'triangle',\r\n        },\r\n      },\r\n      {\r\n        name: '菱形',\r\n        icon: 'l-diamond',\r\n        id: 5,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'diamond',\r\n        },\r\n      },\r\n      {\r\n        name: '五边形',\r\n        icon: 'l-pentagon',\r\n        id: 6,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'pentagon',\r\n        },\r\n      },\r\n      {\r\n        name: '六边形',\r\n        icon: 'l-hexagon',\r\n        id: 7,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'hexagon',\r\n        },\r\n      },\r\n      {\r\n        name: '五角星',\r\n        icon: 'l-pentagram',\r\n        id: 8,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'pentagram',\r\n        },\r\n      },\r\n      {\r\n        name: '左箭头',\r\n        icon: 'l-arrow-left',\r\n        id: 9,\r\n        data: {\r\n          width: 120,\r\n          height: 60,\r\n          name: 'leftArrow',\r\n        },\r\n      },\r\n      {\r\n        name: '右箭头',\r\n        icon: 'l-arrow-right',\r\n        id: 10,\r\n        data: {\r\n          width: 120,\r\n          height: 60,\r\n          name: 'rightArrow',\r\n        },\r\n      },\r\n      {\r\n        name: '双向箭头',\r\n        icon: 'l-twoway-arrow',\r\n        id: 11,\r\n        data: {\r\n          width: 150,\r\n          height: 60,\r\n          name: 'twowayArrow',\r\n        },\r\n      },\r\n      {\r\n        name: '云',\r\n        icon: 'l-cloud',\r\n        id: 13,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'cloud',\r\n        },\r\n      },\r\n      {\r\n        name: '消息框',\r\n        icon: 'l-msg',\r\n        id: 14,\r\n        data: {\r\n          textTop: -0.1,\r\n          width: 100,\r\n          height: 100,\r\n          name: 'message',\r\n        },\r\n      },\r\n      {\r\n        name: '文件',\r\n        icon: 'l-file',\r\n        id: 15,\r\n        data: {\r\n          width: 80,\r\n          height: 100,\r\n          name: 'file',\r\n        },\r\n      },\r\n      {\r\n        name: '立方体',\r\n        icon: 'l-cube',\r\n        id: 18,\r\n        data: {\r\n          width: 60,\r\n          height: 100,\r\n          name: 'cube',\r\n          z: 0.25,\r\n          props: {\r\n            custom: [\r\n              {\r\n                key: 'z',\r\n                label: 'Z',\r\n                type: 'number',\r\n                min: 0,\r\n                placeholder: '<= 1 即宽度的比例',\r\n              },\r\n              {\r\n                key: 'backgroundFront',\r\n                label: '前背景色',\r\n                type: 'color',\r\n              },\r\n              {\r\n                key: 'backgroundUp',\r\n                label: '顶背景色',\r\n                type: 'color',\r\n              },\r\n              {\r\n                key: 'backgroundRight',\r\n                label: '右背景色',\r\n                type: 'color',\r\n              },\r\n            ],\r\n          },\r\n        },\r\n      },\r\n      {\r\n        name: '人',\r\n        icon: 'l-people',\r\n        id: 19,\r\n        data: {\r\n          width: 70,\r\n          height: 100,\r\n          name: 'people',\r\n        },\r\n      },\r\n      {\r\n        name: '图片',\r\n        icon: 'l-picture',\r\n        id: 20,\r\n        data: {\r\n          width: 100,\r\n          height: 100,\r\n          name: 'image',\r\n          image: '/favicon.ico',\r\n          // crossOrigin: 'undefined', // 没啥用\r\n        },\r\n      },\r\n      {\r\n        name: '视频',\r\n        icon: 'l-shipin',\r\n        id: 'd-1-1',\r\n        data: {\r\n          name: 'video',\r\n          x: 100,\r\n          y: 100,\r\n          width: 300,\r\n          height: 200,\r\n          video: 'https://video.699pic.com/videos/17/69/11/a_aa3jeKZ0D63g1556176911_10s.mp4',\r\n          autoPlay: true,\r\n        },\r\n      }\r\n    ],\r\n  },\r\n  {\r\n    name: '流程图',\r\n    show: false,\r\n    list: [\r\n      {\r\n        name: '开始/结束',\r\n        icon: 'l-flow-start',\r\n        id: 21,\r\n        data: {\r\n          text: '开始/结束',\r\n          width: 120,\r\n          height: 40,\r\n          borderRadius: 0.5,\r\n          name: 'rectangle',\r\n        },\r\n      },\r\n      {\r\n        name: '流程',\r\n        icon: 'l-rectangle',\r\n        id: 22,\r\n        data: {\r\n          text: '流程',\r\n          width: 120,\r\n          height: 40,\r\n          name: 'rectangle',\r\n        },\r\n      },\r\n      {\r\n        name: '判定',\r\n        icon: 'l-diamond',\r\n        id: 23,\r\n        data: {\r\n          text: '判定',\r\n          width: 120,\r\n          height: 60,\r\n          name: 'diamond',\r\n        },\r\n      },\r\n      {\r\n        name: '数据',\r\n        icon: 'l-flow-data',\r\n        id: 24,\r\n        data: {\r\n          text: '数据',\r\n          width: 120,\r\n          height: 50,\r\n          name: 'flowData',\r\n          offsetX: 0.14,\r\n        },\r\n      },\r\n      {\r\n        name: '准备',\r\n        icon: 'l-flow-ready',\r\n        id: 25,\r\n        data: {\r\n          text: '准备',\r\n          width: 120,\r\n          height: 50,\r\n          name: 'hexagon',\r\n        },\r\n      },\r\n      {\r\n        name: '子流程',\r\n        icon: 'l-flow-subprocess',\r\n        id: 26,\r\n        data: {\r\n          text: '子流程',\r\n          width: 120,\r\n          height: 50,\r\n          name: 'flowSubprocess',\r\n        },\r\n      },\r\n      {\r\n        name: '数据库',\r\n        icon: 'l-db',\r\n        id: 27,\r\n        data: {\r\n          text: '数据库',\r\n          width: 80,\r\n          height: 120,\r\n          name: 'flowDb',\r\n        },\r\n      },\r\n      {\r\n        name: '文档',\r\n        icon: 'l-flow-document',\r\n        id: 28,\r\n        data: {\r\n          text: '文档',\r\n          width: 120,\r\n          height: 100,\r\n          name: 'flowDocument',\r\n        },\r\n      },\r\n      {\r\n        name: '内部存储',\r\n        icon: 'l-internal-storage',\r\n        id: 29,\r\n        data: {\r\n          text: '内部存储',\r\n          width: 120,\r\n          height: 80,\r\n          name: 'flowInternalStorage',\r\n        },\r\n      },\r\n      {\r\n        name: '外部存储',\r\n        icon: 'l-extern-storage',\r\n        id: 30,\r\n        data: {\r\n          text: '外部存储',\r\n          width: 120,\r\n          height: 80,\r\n          name: 'flowExternStorage',\r\n        },\r\n      },\r\n      {\r\n        name: '队列',\r\n        icon: 'l-flow-queue',\r\n        id: 31,\r\n        data: {\r\n          text: '队列',\r\n          width: 100,\r\n          height: 100,\r\n          name: 'flowQueue',\r\n        },\r\n      },\r\n      {\r\n        name: '手动输入',\r\n        icon: 'l-flow-manually',\r\n        id: 32,\r\n        data: {\r\n          text: '手动输入',\r\n          width: 120,\r\n          height: 80,\r\n          name: 'flowManually',\r\n        },\r\n      },\r\n      {\r\n        name: '展示',\r\n        icon: 'l-flow-display',\r\n        id: 33,\r\n        data: {\r\n          text: '展示',\r\n          width: 120,\r\n          height: 80,\r\n          name: 'flowDisplay',\r\n        },\r\n      },\r\n      {\r\n        name: '并行模式',\r\n        icon: 'l-flow-parallel',\r\n        id: 34,\r\n        data: {\r\n          text: '并行模式',\r\n          width: 120,\r\n          height: 50,\r\n          name: 'flowParallel',\r\n        },\r\n      },\r\n      {\r\n        name: '注释',\r\n        icon: 'l-flow-comment',\r\n        id: 35,\r\n        data: {\r\n          text: '注释',\r\n          width: 100,\r\n          height: 100,\r\n          name: 'flowComment',\r\n        },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    name: '活动图',\r\n    show: false,\r\n    list: [\r\n      {\r\n        name: '开始',\r\n        icon: 'l-inital',\r\n        id: 36,\r\n        data: {\r\n          text: '',\r\n          width: 30,\r\n          height: 30,\r\n          name: 'circle',\r\n          background: '#555',\r\n          lineWidth: 0,\r\n        },\r\n      },\r\n      {\r\n        name: '结束',\r\n        icon: 'l-final',\r\n        id: 37,\r\n        data: {\r\n          width: 30,\r\n          height: 30,\r\n          name: 'activityFinal',\r\n        },\r\n      },\r\n      {\r\n        name: '活动',\r\n        icon: 'l-action',\r\n        id: 38,\r\n        data: {\r\n          text: '活动',\r\n          width: 120,\r\n          height: 50,\r\n          borderRadius: 0.25,\r\n          name: 'rectangle',\r\n        },\r\n      },\r\n      {\r\n        name: '决策/合并',\r\n        icon: 'l-diamond',\r\n        id: 39,\r\n        data: {\r\n          text: '决策/合并',\r\n          width: 120,\r\n          height: 50,\r\n          name: 'diamond',\r\n        },\r\n      },\r\n      {\r\n        name: '垂直泳道',\r\n        icon: 'l-swimlane-v',\r\n        id: 40,\r\n        data: {\r\n          text: '垂直泳道',\r\n          width: 200,\r\n          height: 500,\r\n          name: 'swimlaneV',\r\n          textBaseline: 'top',\r\n          textTop: 20,\r\n          // textHeight: ,\r\n          lineTop: 0.08,\r\n        },\r\n      },\r\n      {\r\n        name: '水平泳道',\r\n        icon: 'l-swimlane-h',\r\n        id: 41,\r\n        data: {\r\n          text: '水平泳道',\r\n          width: 500,\r\n          height: 200,\r\n          name: 'swimlaneH',\r\n          textWidth: 0.01,\r\n          textLeft: 0.04,\r\n          textAlign: 'left',\r\n          lineLeft: 0.08,\r\n        },\r\n      },\r\n      {\r\n        name: '垂直分岔/汇合',\r\n        icon: 'l-fork-v',\r\n        id: 42,\r\n        data: {\r\n          text: '垂直分岔/汇合',\r\n          width: 10,\r\n          height: 150,\r\n          name: 'forkV',\r\n          fillStyle: '#555',\r\n          strokeStyle: 'transparent',\r\n        },\r\n      },\r\n      {\r\n        name: '水平分岔/汇合',\r\n        icon: 'l-fork',\r\n        id: 43,\r\n        data: {\r\n          text: '水平分岔/汇合',\r\n          width: 150,\r\n          height: 10,\r\n          name: 'forkH',\r\n          fillStyle: '#555',\r\n          strokeStyle: 'transparent',\r\n        },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    name: '时序图和类图',\r\n    show: false,\r\n    list: [\r\n      {\r\n        name: '生命线',\r\n        icon: 'l-lifeline',\r\n        id: 44,\r\n        data: {\r\n          text: '生命线',\r\n          width: 150,\r\n          height: 400,\r\n          textHeight: 50,\r\n          name: 'lifeline',\r\n        },\r\n      },\r\n      {\r\n        name: '激活',\r\n        icon: 'l-focus',\r\n        id: 45,\r\n        data: {\r\n          text: '激活',\r\n          width: 12,\r\n          height: 200,\r\n          name: 'sequenceFocus',\r\n        },\r\n      },\r\n      {\r\n        name: '简单类',\r\n        icon: 'l-simple-class',\r\n        id: 46,\r\n        data: {\r\n          text: 'Topolgoy',\r\n          width: 270,\r\n          height: 200,\r\n          textHeight: 200,\r\n          name: 'simpleClass',\r\n          textAlign: 'center',\r\n          textBaseline: 'top',\r\n          textTop: 10,\r\n          list: [\r\n            {\r\n              text: '- name: string\\n+ setName(name: string): void',\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      {\r\n        name: '类',\r\n        icon: 'l-class',\r\n        id: 47,\r\n        data: {\r\n          text: 'Topolgoy',\r\n          width: 270,\r\n          height: 200,\r\n          textHeight: 200,\r\n          name: 'interfaceClass',\r\n          textAlign: 'center',\r\n          textBaseline: 'top',\r\n          textTop: 10,\r\n          list: [\r\n            {\r\n              text: '- name: string',\r\n            },\r\n            {\r\n              text: '+ setName(name: string): void',\r\n            },\r\n          ],\r\n        },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    name: '故障树',\r\n    show: false,\r\n    list: [\r\n      {\r\n        name: '与门',\r\n        icon: 'l-ANDmen',\r\n        data: {\r\n          name: 'andGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '基本事件',\r\n        icon: 'l-jibenshijian',\r\n        data: {\r\n          name: 'basicEvent',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '未展开事件',\r\n        icon: 'l-weizhankaishijian',\r\n        data: {\r\n          name: 'unexpandedEvent',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '优先AND门',\r\n        icon: 'l-youxianANDmen',\r\n        data: {\r\n          name: 'priorityAndGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '禁止门',\r\n        icon: 'l-jinzhimen',\r\n        data: {\r\n          name: 'forbiddenGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '事件',\r\n        icon: 'l-shijian',\r\n        data: {\r\n          name: 'event',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '开关事件',\r\n        icon: 'l-kaiguanshijian',\r\n        data: {\r\n          name: 'switchEvent',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '条件事件',\r\n        icon: 'l-tiaojianshijian',\r\n        data: {\r\n          name: 'conditionalEvent',\r\n          width: 150,\r\n          height: 100,\r\n        },\r\n      },\r\n      {\r\n        name: '转移符号',\r\n        icon: 'l-zhuanyifuhao',\r\n        data: {\r\n          name: 'transferSymbol',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '或门',\r\n        icon: 'l-ORmen',\r\n        data: {\r\n          name: 'orGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '异或门',\r\n        icon: 'l-yihuomen',\r\n        data: {\r\n          name: 'xorGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n      {\r\n        name: '表决门',\r\n        icon: 'l-biaojuemen',\r\n        data: {\r\n          name: 'votingGate',\r\n          width: 100,\r\n          height: 150,\r\n        },\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    name: '脑图',\r\n    show: true,\r\n    list: [\r\n      {\r\n        name: '主题',\r\n        icon: 'l-zhuti',\r\n        data: {\r\n          text: '主题',\r\n          width: 200,\r\n          height: 50,\r\n          name: 'mindNode',\r\n          borderRadius: 0.5,\r\n        },\r\n      },\r\n      {\r\n        name: '子主题',\r\n        icon: 'l-zizhuti',\r\n        data: {\r\n          text: '子主题',\r\n          width: 160,\r\n          height: 40,\r\n          name: 'mindLine',\r\n        },\r\n      },\r\n    ],\r\n  },\r\n\r\n];\r\n","<template>\r\n  <div class=\"graphics\">\r\n    <t-collapse :defaultValue=\"[0, 6]\">\r\n      <t-collapse-panel\r\n        :header=\"item.name\"\r\n        v-for=\"item in graphicGroups\"\r\n        :key=\"item.name\"\r\n        :class=\"{\r\n          'has--group': item.style == 'group',\r\n        }\"\r\n      >\r\n        <t-collapse v-if=\"item.style === 'group'\" :header=\"item.name\">\r\n          <t-collapse-panel\r\n            v-for=\"panel in item.list\"\r\n            class=\"is--subpanel\"\r\n            :header=\"panel.name\"\r\n          >\r\n            <template #headerRightContent>\r\n              <t-tag theme=\"success\">{{ panel.children.length }}</t-tag>\r\n            </template>\r\n            <div\r\n              v-for=\"elem in panel.children\"\r\n              :key=\"elem.name\"\r\n              class=\"graphic\"\r\n              :draggable=\"true\"\r\n              @dragstart=\"dragStart($event, elem)\"\r\n            >\r\n              <t-tooltip :content=\"elem.name\">\r\n                <img\r\n                  v-if=\"elem.icon?.endsWith('svg')\"\r\n                  :src=\"elem.icon\"\r\n                  style=\"width: 100%; height: 48px\"\r\n                />\r\n                <svg v-else class=\"l-icon\" aria-hidden=\"true\">\r\n                  <use :xlink:href=\"'#' + elem.icon\"></use>\r\n                </svg>\r\n              </t-tooltip>\r\n            </div>\r\n          </t-collapse-panel>\r\n        </t-collapse>\r\n        <template v-else>\r\n          <div\r\n            v-for=\"elem in item.list\"\r\n            :key=\"elem.name\"\r\n            class=\"graphic\"\r\n            :draggable=\"true\"\r\n            @dragstart=\"dragStart($event, elem)\"\r\n          >\r\n            <t-tooltip :content=\"elem.name\">\r\n              <img\r\n                v-if=\"elem.icon?.endsWith('svg')\"\r\n                class=\"icon__image\"\r\n                :src=\"elem.icon\"\r\n                alt=\"\"\r\n                srcset=\"\"\r\n              />\r\n              <svg v-else class=\"l-icon\" aria-hidden=\"true\">\r\n                <use :xlink:href=\"'#' + elem.icon\"></use>\r\n              </svg>\r\n              <p>{{ elem.name }}</p>\r\n            </t-tooltip>\r\n          </div>\r\n        </template>\r\n      </t-collapse-panel>\r\n    </t-collapse>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { parseSvgStr, loadSvg } from \"../utils/svgParser\";\r\nimport {\r\n  electricSvgList,\r\n  electricCombineList,\r\n} from \"../utils/svgConfigList.ts\";\r\nimport { computed } from \"vue\";\r\nimport { defaultGraphics } from \"../utils/graphicConfig.ts\";\r\nimport SwitchCombinesData from \"../utils/switch-combines.json\";\r\nimport { deepClone } from \"@meta2d/core\";\r\n\r\n// 根据名称增加分组\r\nconst electricList = computed(() => {\r\n  const list = [];\r\n\r\n  electricSvgList.forEach((el) => {\r\n    const arr = el.name.split(\"-\");\r\n    let groupName = \"其他\";\r\n    if (arr.length > 1) {\r\n      groupName = arr[0];\r\n    }\r\n    const group = list.find((v) => v.name == groupName);\r\n    if (group) {\r\n      group.children.push(el);\r\n    } else {\r\n      list.push({\r\n        name: groupName,\r\n        children: [el],\r\n      });\r\n    }\r\n  });\r\n\r\n  return list;\r\n});\r\n\r\nconst graphicGroups = [\r\n  ...defaultGraphics,\r\n  {\r\n    name: \"电路元件分组\",\r\n    show: true,\r\n    style: \"group\",\r\n    list: electricList.value,\r\n  },\r\n  {\r\n    name: \"电路元件组合(包含状态)\",\r\n    show: true,\r\n    style: \"group\",\r\n    list: electricCombineList,\r\n  },\r\n];\r\n\r\nfunction findChildren(parent, list) {\r\n  if (!parent) return;\r\n  if (!list) return;\r\n  const result = [];\r\n  const queue = [parent];\r\n\r\n  while (queue.length) {\r\n    const current = queue.shift();\r\n    result.push(current);\r\n    for (const data of list) {\r\n      if (data.parentId == current.id) {\r\n        queue.push(data);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nconst dragStart = (e: any, elem: any) => {\r\n  if (!elem) {\r\n    return;\r\n  }\r\n  e.stopPropagation();\r\n  if (elem.icon.endsWith(\"svg\")) {\r\n    if (elem.type == \"combine-json\") {\r\n      // 加载预设\r\n      console.log(\"load json: \", elem, SwitchCombinesData);\r\n      const parent = SwitchCombinesData.pens.find((v) => {\r\n        if (v.description == elem.name && !v.parentId) {\r\n          // parent\r\n          return true;\r\n        }\r\n      });\r\n      const pens = findChildren(parent, SwitchCombinesData.pens);\r\n      console.log(\"combine pens: \", parent, pens);\r\n      if (pens) {\r\n        elem.data = deepClone(pens);\r\n      }\r\n    } else {\r\n      // 创建 svg 图元对象\r\n      loadSvg(elem.icon, elem);\r\n      return;\r\n    }\r\n  }\r\n  console.log(\"elem: \", elem);\r\n  // 拖拽事件\r\n  if (e instanceof DragEvent) {\r\n    // 设置拖拽数据\r\n    e.dataTransfer?.setData(\"Meta2d\", JSON.stringify(elem.data));\r\n  } else {\r\n    // 支持单击添加图元。平板模式\r\n    // 需要单击画布\r\n    // ! 有问题，ID 不会修改\r\n    meta2d.canvas.addCaches = [elem.data];\r\n  }\r\n};\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.graphics {\r\n  height: calc(100vh - 80px - 50px);\r\n  overflow-y: auto;\r\n  border-right: 1px solid var(--color-border);\r\n  z-index: 2;\r\n\r\n  :deep(.t-collapse) {\r\n    border-top: none;\r\n\r\n    .t-collapse-panel__content {\r\n      background-color: var(--color-background-active);\r\n      padding: 20px 4px;\r\n      display: grid;\r\n      grid-template-columns: 1fr 1fr 1fr 1fr;\r\n      grid-row-gap: 12px;\r\n    }\r\n\r\n    .t-collapse-panel {\r\n      &.has--group {\r\n        .t-collapse-panel__content {\r\n          display: block;\r\n        }\r\n      }\r\n      &.is--subpanel {\r\n        .t-collapse-panel__content {\r\n          display: grid;\r\n        }\r\n        .graphic {\r\n          padding: 10px;\r\n        }\r\n      }\r\n    }\r\n    .graphic {\r\n      position: relative;\r\n      padding: 10px 0;\r\n      border-radius: 2px;\r\n      border: 1px solid transparent;\r\n\r\n      &:hover {\r\n        cursor: pointer;\r\n        border-color: var(--color-primary);\r\n      }\r\n      p {\r\n        margin-top: 6px;\r\n        padding: 0 8px;\r\n        text-align: center;\r\n        font-size: 12px;\r\n        height: 12px;\r\n        line-height: 1;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 1;\r\n        word-break: break-all;\r\n        -webkit-box-orient: vertical;\r\n      }\r\n\r\n      svg {\r\n        color: var(--color);\r\n        height: 28px;\r\n        width: 100%;\r\n        margin: auto;\r\n      }\r\n\r\n      .icon__image {\r\n        height: 28px;\r\n        width: 100%;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <PropsTab v-model=\"activeTab\" :tabs=\"tabs\" @change=\"tabChange\">\r\n    <template #graphics>\r\n      <Graphics />\r\n    </template>\r\n\r\n    <template #diagrams>\r\n      <div class=\"panel__wrapper\">\r\n        <t-button block variant=\"outline\" @click=\"showAddFolder('paper')\">\r\n          <t-icon name=\"add\" slot=\"icon\"></t-icon>\r\n          新建目录\r\n        </t-button>\r\n        <br />\r\n        <t-collapse v-if=\"blueprintList.length\" defaultExpandAll>\r\n          <t-collapse-panel\r\n            v-for=\"item in blueprintList\"\r\n            :value=\"item.id\"\r\n            :header=\"item.dictName\"\r\n          >\r\n            <template #headerRightContent>\r\n              <t-tooltip content=\"新建图纸，将清空画布\">\r\n                <t-button\r\n                  size=\"small\"\r\n                  variant=\"outline\"\r\n                  :style=\"{ marginLeft: '8px' }\"\r\n                  @click=\"addDiagram(item)\"\r\n                >\r\n                  <t-icon name=\"chart-add\"></t-icon>\r\n                </t-button>\r\n              </t-tooltip>\r\n\r\n              <t-tooltip content=\"删除目录\">\r\n                <t-popconfirm\r\n                  theme=\"danger\"\r\n                  content=\"操作后无法恢复, 确定要删除吗?\"\r\n                  @confirm=\"deleteFolder(item, 'paper')\"\r\n                >\r\n                  <t-button\r\n                    size=\"small\"\r\n                    variant=\"outline\"\r\n                    theme=\"danger\"\r\n                    :style=\"{ marginLeft: '8px' }\"\r\n                  >\r\n                    <t-icon name=\"delete\"></t-icon>\r\n                  </t-button>\r\n                </t-popconfirm>\r\n              </t-tooltip>\r\n            </template>\r\n\r\n            <t-row v-if=\"item.data.length\" :gutter=\"[10, 10]\">\r\n              <t-col\r\n                v-for=\"(v, index) in item.data\"\r\n                :key=\"index\"\r\n                :span=\"6\"\r\n                @click=\"openDiagram(v)\"\r\n              >\r\n                <t-tooltip content=\"单击打开图纸\">\r\n                  <t-image\r\n                    overlayTrigger=\"hover\"\r\n                    :src=\"v.cover\"\r\n                    fit=\"contain\"\r\n                    :style=\"{ width: '100px', height: '100px' }\"\r\n                  >\r\n                    <template #overlayContent>\r\n                      <t-popconfirm\r\n                        theme=\"danger\"\r\n                        content=\"操作后无法恢复, 确定要删除吗?\"\r\n                        @confirm=\"deleteMyPen(v, 'paper')\"\r\n                      >\r\n                        <t-button\r\n                          size=\"small\"\r\n                          variant=\"outline\"\r\n                          theme=\"danger\"\r\n                          :style=\"{ float: 'right' }\"\r\n                          @click.stop=\"() => null\"\r\n                        >\r\n                          <t-icon name=\"delete\"></t-icon>\r\n                        </t-button>\r\n                      </t-popconfirm>\r\n                    </template>\r\n                  </t-image>\r\n                </t-tooltip>\r\n              </t-col>\r\n            </t-row>\r\n\r\n            <t-empty v-else description=\"\"></t-empty>\r\n          </t-collapse-panel>\r\n        </t-collapse>\r\n        <t-empty v-else description=\"\"></t-empty>\r\n      </div>\r\n    </template>\r\n\r\n    <template #my-pens>\r\n      <div class=\"panel__wrapper\">\r\n        <t-button block variant=\"outline\" @click=\"showAddFolder('component')\">\r\n          <t-icon name=\"add\" slot=\"icon\"></t-icon>\r\n          新建目录\r\n        </t-button>\r\n        <br />\r\n        <t-collapse v-if=\"componentList.length\" defaultExpandAll>\r\n          <t-collapse-panel\r\n            v-for=\"item in componentList\"\r\n            :value=\"item.id\"\r\n            :header=\"item.dictName\"\r\n          >\r\n            <template #headerRightContent>\r\n              <t-upload\r\n                ref=\"uploadRef\"\r\n                v-model=\"uploadValue\"\r\n                :action=\"\r\n                  $attrs.uploadUrl ||\r\n                  'https://service-bv448zsw-1257786608.gz.apigw.tencentcs.com/api/upload-demo'\r\n                \"\r\n                :headers=\"headers\"\r\n                :sizeLimit=\"sizeLimit\"\r\n                name=\"object\"\r\n                theme=\"custom\"\r\n                accept=\"image/*\"\r\n                style=\"display: inline-flex\"\r\n                @fail=\"handleFail\"\r\n                @success=\"handleSuccess\"\r\n              >\r\n                <t-tooltip content=\"请选择单张小于1MB的图片上传\">\r\n                  <t-button\r\n                    size=\"small\"\r\n                    variant=\"outline\"\r\n                    :style=\"{ marginLeft: '8px' }\"\r\n                    @click=\"setFolder(item)\"\r\n                  >\r\n                    <t-icon name=\"upload\"></t-icon>\r\n                  </t-button>\r\n                </t-tooltip>\r\n              </t-upload>\r\n\r\n              <t-tooltip content=\"删除目录\">\r\n                <t-popconfirm\r\n                  theme=\"danger\"\r\n                  content=\"操作后无法恢复, 确定要删除吗?\"\r\n                  @confirm=\"deleteFolder(item, 'component')\"\r\n                >\r\n                  <t-button\r\n                    size=\"small\"\r\n                    variant=\"outline\"\r\n                    theme=\"danger\"\r\n                    :style=\"{ marginLeft: '8px' }\"\r\n                  >\r\n                    <t-icon name=\"delete\"></t-icon>\r\n                  </t-button>\r\n                </t-popconfirm>\r\n              </t-tooltip>\r\n              <!-- <t-tooltip content=\"公开目录下的所有组件\">\r\n                  <t-button\r\n                    size=\"small\"\r\n                    variant=\"outline\"\r\n                    theme=\"primary\"\r\n                    :style=\"{ marginLeft: '8px' }\"\r\n                  >\r\n                    <t-icon name=\"folder-shared\"></t-icon>\r\n                  </t-button>\r\n              </t-tooltip> -->\r\n            </template>\r\n\r\n            <t-row v-if=\"item.data.length\" :gutter=\"[10, 10]\">\r\n              <t-col\r\n                v-for=\"(v, index) in item.data\"\r\n                :key=\"index\"\r\n                :span=\"6\"\r\n                :draggable=\"true\"\r\n                @dragstart=\"dragStart($event, v)\"\r\n              >\r\n                <t-tooltip :content=\"v.name\">\r\n                  <t-image\r\n                    :src=\"v.cover\"\r\n                    overlayTrigger=\"hover\"\r\n                    fit=\"contain\"\r\n                    :style=\"{ width: '100px', height: '100px' }\"\r\n                  >\r\n                    <template #overlayContent>\r\n                      \r\n                      <t-popconfirm\r\n                        theme=\"danger\"\r\n                        content=\"操作后无法恢复, 确定要删除吗?\"\r\n                        @confirm=\"deleteMyPen(v, 'component')\"\r\n                      >\r\n                        <t-button\r\n                          size=\"small\"\r\n                          variant=\"outline\"\r\n                          theme=\"danger\"\r\n                          :style=\"{ float: 'right' }\"\r\n                          @click.stop=\"() => null\"\r\n                        >\r\n                          <t-icon name=\"delete\"></t-icon>\r\n                        </t-button>\r\n                      </t-popconfirm>\r\n                      <!-- <t-tooltip\r\n                        content=\"公开组件给所有人\"\r\n                        @confirm=\"deleteMyPen(v, 'component')\"\r\n                      >\r\n                        <t-button\r\n                          size=\"small\"\r\n                          variant=\"outline\"\r\n                          theme=\"primary\"\r\n                          :style=\"{ float: 'right', marginRight: '4px' }\"\r\n                          @click.stop=\"shareMyPen(v)\"\r\n                        >\r\n                          <t-icon name=\"share\"></t-icon>\r\n                        </t-button>\r\n                      </t-tooltip> -->\r\n                    </template>\r\n                  </t-image>\r\n                </t-tooltip>\r\n              </t-col>\r\n            </t-row>\r\n            <t-empty v-else></t-empty>\r\n          </t-collapse-panel>\r\n        </t-collapse>\r\n        <t-empty v-else description=\"\"></t-empty>\r\n      </div>\r\n    </template>\r\n  </PropsTab>\r\n\r\n  <t-dialog\r\n    v-model:visible=\"visible\"\r\n    :header=\"selectMode ? '选择目录' : '新建目录'\"\r\n    @confirm=\"confirm\"\r\n    @closed=\"close\"\r\n  >\r\n    <t-input\r\n      v-if=\"!selectMode\"\r\n      v-model=\"folderName\"\r\n      placeholder=\"请输入目录名称\"\r\n      maxlength=\"20\"\r\n      clearable\r\n    ></t-input>\r\n    <template v-else>\r\n      <t-select v-model=\"folderName\" :options=\"folderOptions\"></t-select>\r\n      <br />\r\n      <t-input v-model=\"fileName\" placeholder=\"请输入图纸/组件名称\"></t-input>\r\n    </template>\r\n  </t-dialog>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { computed, defineProps, reactive, ref } from \"vue\";\r\nimport Graphics from \"./Graphics.vue\";\r\nimport PropsTab from \"./PropsTab.vue\";\r\nimport { useData } from \"../services/useGraphics\";\r\nimport { useUpload } from \"../services/useUpload\";\r\nimport { NotifyPlugin, Button } from \"tdesign-vue-next\";\r\n\r\nconst props = defineProps({});\r\n\r\nconst tabs = [\r\n  {\r\n    label: \"图纸\",\r\n    value: 1,\r\n    slot: \"diagrams\",\r\n    code: \"paper\",\r\n  },\r\n  {\r\n    label: \"内置组件\",\r\n    value: 2,\r\n    slot: \"graphics\",\r\n  },\r\n  {\r\n    label: \"我的组件\",\r\n    value: 3,\r\n    slot: \"my-pens\",\r\n    code: \"component\",\r\n  },\r\n];\r\nconst activeTab = ref(2);\r\n\r\nconst {\r\n  blueprintList,\r\n  componentList,\r\n  visible,\r\n  folderName,\r\n  showAddFolder,\r\n  deleteMyPen,\r\n  confirm,\r\n  close,\r\n  selectMode,\r\n  selectType,\r\n  deleteFolder,\r\n  getTree,\r\n  fileName,\r\n  saveImageComponent,\r\n} = useData();\r\n\r\nconst tabChange = (value: number) => {\r\n  const tab = tabs.find((item) => item.value === value);\r\n  if (tab && tab.code) {\r\n    const code = tab.code;\r\n    getTree(code);\r\n  }\r\n};\r\n\r\nconst folderOptions = computed(() => {\r\n  let list = [];\r\n  if (selectType.value == \"paper\") {\r\n    list = blueprintList.value;\r\n  } else {\r\n    list = componentList.value;\r\n  }\r\n  return list.map((item: any) => {\r\n    return {\r\n      label: item.dictName,\r\n      value: item.id,\r\n    };\r\n  });\r\n});\r\n\r\nconst { uploadValue, headers, sizeLimit, handleFail } = useUpload();\r\n\r\nlet targetFolder: any = null;\r\nconst setFolder = (data: any) => {\r\n  console.log(\"set folder: \", data);\r\n  targetFolder = data;\r\n};\r\nconst handleSuccess = (context: any) => {\r\n  if (context.response) {\r\n    // 创建 pen\r\n    const image = context.response.url || context.response.data?.fileurl;\r\n    const data = {\r\n      name: \"image\",\r\n      image,\r\n      relativePath: context.response.data?.relativePath,\r\n      fileName: context.response.data?.fileName,\r\n      width: 100,\r\n      height: 100,\r\n      x: 100,\r\n      y: 100,\r\n    };\r\n\r\n    saveImageComponent(targetFolder, data);\r\n  }\r\n};\r\n\r\n/**\r\n * @description 我的组件，拖拽\r\n * @param e\r\n * @param elem 图片或组合\r\n */\r\nconst dragStart = async (e: any, elem: any) => {\r\n  if (!elem || !elem.data) {\r\n    return;\r\n  }\r\n  e.stopPropagation();\r\n  // console.log(\"dragStart elem: \", elem);\r\n  let data;\r\n  try {\r\n    if (typeof elem.data === \"string\") {\r\n      data = JSON.parse(elem.data);\r\n    } else if (typeof elem.data === \"object\") {\r\n      data = elem.data;\r\n    }\r\n  } catch (error) {\r\n    console.log(\"dragStart error: \", error);\r\n  }\r\n\r\n  if (!data) return;\r\n\r\n  // 拖拽事件\r\n  if (e instanceof DragEvent) {\r\n    // 设置拖拽数据\r\n    e.dataTransfer?.setData(\"Meta2d\", JSON.stringify(data));\r\n  } else {\r\n    // 支持单击添加图元。平板模式\r\n    // 需要单击画布\r\n    meta2d.canvas.addCaches = [data];\r\n  }\r\n};\r\n\r\nconst addDiagram = (item: any) => {\r\n  console.log(\"addDiagram: \", item);\r\n  if (!item.children) {\r\n    item.children = [];\r\n  }\r\n  meta2d.clear();\r\n  meta2d.emit(\"clear\");\r\n};\r\n\r\nconst openDiagram = (item: any) => {\r\n  const p = NotifyPlugin(\"warning\", {\r\n    content: \"系统可能不会保存您所做的更改，是否继续？\",\r\n    title: \"提示\",\r\n    placement: \"top-right\",\r\n    duration: 0,\r\n    closeBtn: true,\r\n    footer(h) {\r\n      return h(\r\n        \"div\",\r\n        {\r\n          style: \"text-align: right\",\r\n        },\r\n        [\r\n          h(\r\n            Button,\r\n            {\r\n              onClick: () => {\r\n                let json;\r\n                try {\r\n                  json = JSON.parse(item.data);\r\n                } catch (error) {\r\n                  console.log(\"open diagram error: \", error);\r\n                }\r\n                meta2d.open(json);\r\n                meta2d.emit(\"clear\");\r\n                meta2d.fitView();\r\n                p.then((instance) => {\r\n                  instance.close();\r\n                  meta2d.render(true);\r\n                });\r\n              },\r\n            },\r\n            \"确定\",\r\n          ),\r\n        ],\r\n      );\r\n    },\r\n  });\r\n};\r\n\r\n\r\nconst shareMyPen = (item: any) => {\r\n  console.log(\"shareMyPen: \", item);\r\n  \r\n}\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.panel__wrapper {\r\n  padding: 10px;\r\n\r\n  :deep(.t-button) .t-button__text {\r\n    align-items: center;\r\n  }\r\n  .t-image__wrapper {\r\n    border: #eee 1px solid;\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div class=\"app-page\">\r\n    <Header v-if=\"renderProps\" v-bind=\"$attrs\" @view=\"toView\" />\r\n\r\n    <div class=\"designer\">\r\n      <GraphicsManager v-bind=\"$attrs\" />\r\n      <View v-bind=\"$attrs\" @ready=\"ready\" />\r\n      <Props v-if=\"renderProps\" v-bind=\"$attrs\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, defineEmits, ref } from \"vue\";\r\nimport Header from \"../components/Header.vue\";\r\nimport View from \"../components/View.vue\";\r\nimport Props from \"../components/Props.vue\";\r\nimport GraphicsManager from \"../components/GraphicsManager.vue\";\r\n\r\nlet timer: any;\r\n\r\nfunction save() {\r\n  if (timer) {\r\n    clearTimeout(timer);\r\n  }\r\n  timer = setTimeout(() => {\r\n    const data: any = meta2d.data();\r\n    localStorage.setItem(\"meta2d\", JSON.stringify(data));\r\n    timer = undefined;\r\n  }, 100);\r\n}\r\n\r\nconst emit = defineEmits([\"view\", \"ready\"]);\r\nconst toView = (data: any) => {\r\n  emit(\"view\", data);\r\n};\r\n\r\nconst renderProps = ref(false);\r\n\r\nconst ready = (data: any) => {\r\n  emit(\"ready\", data);\r\n  renderProps.value = true;\r\n};\r\n\r\nonMounted(() => {\r\n  meta2d.on(\"scale\", save);\r\n  meta2d.on(\"add\", save);\r\n  meta2d.on(\"opened\", save);\r\n  meta2d.on(\"undo\", save);\r\n  meta2d.on(\"redo\", save);\r\n  meta2d.on(\"add\", save);\r\n  meta2d.on(\"delete\", save);\r\n  meta2d.on(\"rotatePens\", save);\r\n  meta2d.on(\"translatePens\", save);\r\n});\r\n</script>\r\n\r\n<style lang=\"postcss\" scoped>\r\n.app-page {\r\n  height: 100vh;\r\n  overflow: hidden;\r\n\r\n  .designer {\r\n    display: grid;\r\n    grid-template-columns: 300px 1fr 350px;\r\n    height: calc(100vh - 80px);\r\n  }\r\n}\r\n</style>\r\n"],"names":["_imports_0","a","b","this","c","d","e","f","global","g","h","i","j","k","l","m","module","emit","__emit","useRouter","assets","reactive","visible","ref","onVisibleChange","val","context","assetClick","item","loadElectricJson","isDrawLine","scale","onMounted","timer","scaleSubscriber","drawLine","lineTypes","currentLineType","changeLineType","value","_a","pen","fromArrow","fromArrows","toArrow","toArrows","changeFromArrow","PenType","changeToArrow","autoAnchor","_b","onAutoAnchor","newFile","readFile","file","resolve","reject","reader","openFile","input","event","elem","text","downloadJson","data","FileSaver","downloadPng","name","onUndo","onRedo","onCut","onCopy","onPaste","onAll","onDelete","saveBlueprintShow","useData","customToolbarClick","code","readSVGFile","res","parseSvgStr","onAddShape","deepClone","onScaleDefault","onScaleWindow","onView","selectPens","type","pens","penList","radius","dotHitOffset","anchorOffsetXY","anchors","downToUpFlag","isDefaultCross","crossLines","lineCross","defaultCross","mouseUp","mouseDown","add","active","opened","handleLineCross","flag","clearIntersect","worldAnchors","ls","actives","el","ll","an","passiveL","v","element","anchor","line","otherIndex","connect","lines","initiativeAnchors","l1","l11","passiveAnchors","n","l2","l22","onLine1","onLine2","x","y","checkLineIntersection","lineFromPoints","ret","inteceptCircleLineSeg","k1","deltaX1","deltaY1","p4","p5","l3","u","u1","u11","calcIsInsideThickLineSegment","an1","s8","an2","getDistance","comparedIds","neighbourIds","gapOverFlag","len","brother","otherBrother","index","brotherIndex","p","o","lastIndex","count","clearLineCross","line1","line2","pnt","lineThickness","L2","r","s","circle","u2","retP1","retP2","v1","v2","p1","p2","x1","y1","x2","y2","line1StartX","line1StartY","line1EndX","line1EndY","line2StartX","line2StartY","line2EndX","line2EndY","denominator","numerator1","numerator2","result","props","__props","activePanel","watch","changeValue","onConfirmAnother","close","onCancel","__expose","jsStr","MONACO_EDITOR_OPTIONS","editorRef","shallowRef","handleMount","editor","handlers","insert","s12","EventAction","deleteEvent","eventChange","eventActionOptions","propOptions","propList","addProp","MessagePlugin","deleteProp","propChange","updatePropList","key","comparisonOptions","drawerVisible","showSelect","changeHandler","currentHandler","shallowReactive","filterIds","findPens","tagOptions","ConfigList","ids","id","onClickConfirm","columns","tag","list","sets","rehandleSelectChange","ctx","activePens","ExtendActionEventNameMap","rowPropList","ExtendAction","dialogModeOptions","extendWhereTypeOptions","extendWhereMessageTypeOptions","ExtendActionMessageTypeMap","videoSourceOptions","whereValueChange","whereMessageType","script","handler","addRowProp","rowPropChange","deleteRowProp","presetScriptsConfig","defaultColumns","addColumn","change","column","scripts","tableProps","deleteColumn","scriptFields","computed","scriptChange","addScript","insertScript","deleteScript","options","tabs","lockStateOptions","onChangeData","prop","uploadRef","uploadValue","sizeLimit","headers","useUpload","handleSuccess","handleFail","changeConnectProp","resolver","useWsHandlers","testConnect","msgTypes","wsClient","WebSocketClient","NotifyPlugin","response","error","codeEditor","showCodeEditor","saveJsStr","addWsMsgField","deleteWsMsgField","wsMsgFieldsChange","wsHandlersChange","changePresetScript","scriptConfig","moveXFrames","moveYFrames","rotateXFrames","scaleFrames","rotateFrames","rotateFrames2","processFrames","colorFrames","PenFrameOptions","LineAnimateOption","PenFrames","changeRect","events","eventTypeOptions","templateCodeStringOptions","actionChange","codeJsChange","action","ExtendActionJsCodeMap","copyTmpKey","selections","useSelection","rect","isLine","getPen","linePathString","statusList","animate","play","control","createPathAnimation","customFrames","showFramesDrawer","addFrames","nextTick","insertFrame","deleteFrame","frame","watcher","lineDashs","animateType","frames","top","bottom","up","down","onUnmounted","copyId","copyToClipboard","eventsChange","track","width","height","createPathFrames","createPathList","array","paths","prev","tmpText","err","pathDrawerVisible","showPathDrawer","closePathDrawer","deletePathFrame","allIsLine","allIsRect","pensTotal","newValue","alginOptions","align","nodes","inactive","pensTree","children","child","updateData","actived","mode","icon","node","iconMap","iconName","Icon","toggleVisible","click","shouldRender","SelectionMode","defaultGraphics","electricList","electricSvgList","arr","groupName","group","graphicGroups","electricCombineList","findChildren","parent","queue","current","dragStart","SwitchCombinesData","loadSvg","activeTab","blueprintList","componentList","folderName","showAddFolder","deleteMyPen","confirm","selectMode","selectType","deleteFolder","getTree","fileName","saveImageComponent","tabChange","tab","folderOptions","targetFolder","setFolder","_c","addDiagram","openDiagram","Button","json","instance","save","toView","renderProps","ready"],"mappings":"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","x_google_ignoreList":[1]}