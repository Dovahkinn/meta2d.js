{"version":3,"file":"pathAnimate-CGf_anjp.mjs","sources":["../../../node_modules/.pnpm/vue-router@4.5.0_vue@3.5.13_typescript@5.7.3_/node_modules/vue-router/dist/vue-router.mjs","../../core/src/diagrams/rectangle.ts","../../core/src/diagrams/circle.ts","../../core/src/pen/model.ts","../../core/src/data.ts","../../core/src/point/point.ts","../../core/src/store/global.ts","../../../node_modules/.pnpm/mitt@2.1.0/node_modules/mitt/dist/mitt.es.js","../../core/src/options.ts","../../core/src/theme.ts","../../core/src/store/store.ts","../../core/src/pen/text.ts","../../core/src/utils/clone.ts","../../core/src/pen/arrow.ts","../../core/src/utils/color.ts","../../core/src/utils/math.ts","../../core/src/utils/uuid.ts","../../core/src/utils/padding.ts","../../core/src/utils/file.ts","../../core/src/utils/url.ts","../../core/src/utils/object.ts","../../core/src/utils/time.ts","../../core/src/pen/render.ts","../../core/src/pen/math.ts","../../core/src/pen/utils.ts","../../core/src/pen/plugin.ts","../../core/src/rect/rect.ts","../../core/src/diagrams/svg/parse.ts","../../core/src/diagrams/svgPath.ts","../../core/src/diagrams/diamond.ts","../../core/src/diagrams/triangle.ts","../../core/src/diagrams/pentagon.ts","../../core/src/diagrams/pentagram.ts","../../core/src/diagrams/hexagon.ts","../../core/src/diagrams/arrow.ts","../../core/src/diagrams/message.ts","../../core/src/diagrams/cloud.ts","../../core/src/diagrams/file.ts","../../core/src/diagrams/cube.ts","../../core/src/diagrams/people.ts","../../core/src/diagrams/line/curve.ts","../../core/src/diagrams/line/line.ts","../../core/src/diagrams/line/polyline.ts","../../core/src/diagrams/line/smooth.ts","../../core/src/diagrams/line/arrow.ts","../../core/src/diagrams/iframe.ts","../../core/src/diagrams/video.ts","../../core/src/canvas/offscreen.ts","../../core/src/tooltip/tooltip.ts","../../core/src/scroll/scroll.ts","../../core/src/canvas/canvasImage.ts","../../core/src/canvas/magnifierCanvas.ts","../../core/src/utils/error.ts","../../core/src/dialog/dialog.ts","../../core/src/title/title.ts","../../core/src/canvas/canvasTemplate.ts","../../core/src/popconfirm/popconfirm.ts","../../core/src/canvas/canvas.ts","../../core/src/diagrams/panel.ts","../../core/src/diagrams/gif.ts","../../core/src/diagrams/mindNode.ts","../../core/src/diagrams/mindLine.ts","../../core/src/diagrams/index.ts","../../core/src/event/event.ts","../../core/src/map/map.ts","../../../node_modules/.pnpm/mqtt@4.3.8/node_modules/mqtt/dist/mqtt.min.js","../../core/src/message/message.ts","../../core/src/core.ts","../src/utils/svgConfigList.ts","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/util.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/validator.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/OptionsBuilder.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/xmlNode.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/DocTypeReader.js","../../../node_modules/.pnpm/strnum@1.0.5/node_modules/strnum/strnum.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/ignoreAttributes.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/OrderedObjParser.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/node2json.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlparser/XMLParser.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlbuilder/orderedJs2Xml.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/xmlbuilder/json2xml.js","../../../node_modules/.pnpm/fast-xml-parser@4.5.1/node_modules/fast-xml-parser/src/fxp.js","../../svg/src/svg.ts","../src/utils/svgParser.ts","../src/utils/index.ts","../src/services/useUpload.ts","../src/services/useGraphics.ts","../../flow-diagram/src/comment.ts","../../flow-diagram/src/data.ts","../../flow-diagram/src/display.ts","../../flow-diagram/src/document.ts","../../flow-diagram/src/externStorage.ts","../../flow-diagram/src/internalStorage.ts","../../flow-diagram/src/manually.ts","../../flow-diagram/src/parallel.ts","../../flow-diagram/src/queue.ts","../../flow-diagram/src/subprocess.ts","../../flow-diagram/src/db.ts","../../flow-diagram/src/register.ts","../../activity-diagram/src/final.ts","../../activity-diagram/src/swimlaneH.ts","../../activity-diagram/src/swimlaneV.ts","../../activity-diagram/src/register.ts","../../class-diagram/src/interfaceClass.ts","../../class-diagram/src/simpleClass.ts","../../class-diagram/src/register.ts","../../sequence-diagram/src/focus.ts","../../sequence-diagram/src/lifeline.ts","../../sequence-diagram/src/register.ts","../../chart-diagram/src/echarts.ts","../../chart-diagram/src/register.ts","../../form-diagram/src/common.ts","../../form-diagram/src/table2.ts","../../form-diagram/src/switch.ts","../../form-diagram/src/slider.ts","../../form-diagram/src/checkbox.ts","../../form-diagram/src/radio.ts","../../form-diagram/src/register.ts","../../le5le-charts/src/normalizedAxis.ts","../../le5le-charts/src/coordinateAxis.ts","../../le5le-charts/src/common.ts","../../le5le-charts/src/lineChart.ts","../../le5le-charts/src/pieChart.ts","../../le5le-charts/src/histogram.ts","../../le5le-charts/src/gauge.ts","../../le5le-charts/src/register.ts","../../fta-diagram/src/andGate.ts","../../fta-diagram/src/basicEvent.ts","../../fta-diagram/src/conditionalEvent.ts","../../fta-diagram/src/event.ts","../../fta-diagram/src/forbiddenGate.ts","../../fta-diagram/src/orGate.ts","../../fta-diagram/src/priorityAndGate.ts","../../fta-diagram/src/switchEvent.ts","../../fta-diagram/src/transferSymbol.ts","../../fta-diagram/src/unexpandedEvent.ts","../../fta-diagram/src/xorGate.ts","../../fta-diagram/src/votingGate.ts","../../fta-diagram/src/register.ts","../src/services/selections.ts","../src/components/ContextMenu.vue","../../websocket-client/type.ts","../../websocket-client/index.ts","../src/types/Event.ts","../src/services/useHandlers.ts","../src/components/View.vue","../src/utils/pathAnimate.ts"],"sourcesContent":["/*!\n  * vue-router v4.5.0\n  * (c) 2024 Eduardo San Martin Morote\n  * @license MIT\n  */\nimport { getCurrentInstance, inject, onUnmounted, onDeactivated, onActivated, computed, unref, watchEffect, defineComponent, reactive, h, provide, ref, watch, shallowRef, shallowReactive, nextTick } from 'vue';\nimport { setupDevtoolsPlugin } from '@vue/devtools-api';\n\nconst isBrowser = typeof document !== 'undefined';\n\n/**\n * Allows differentiating lazy components from functional components and vue-class-component\n * @internal\n *\n * @param component\n */\nfunction isRouteComponent(component) {\n    return (typeof component === 'object' ||\n        'displayName' in component ||\n        'props' in component ||\n        '__vccOpts' in component);\n}\nfunction isESModule(obj) {\n    return (obj.__esModule ||\n        obj[Symbol.toStringTag] === 'Module' ||\n        // support CF with dynamic imports that do not\n        // add the Module string tag\n        (obj.default && isRouteComponent(obj.default)));\n}\nconst assign = Object.assign;\nfunction applyToParams(fn, params) {\n    const newParams = {};\n    for (const key in params) {\n        const value = params[key];\n        newParams[key] = isArray(value)\n            ? value.map(fn)\n            : fn(value);\n    }\n    return newParams;\n}\nconst noop = () => { };\n/**\n * Typesafe alternative to Array.isArray\n * https://github.com/microsoft/TypeScript/pull/48228\n */\nconst isArray = Array.isArray;\n\nfunction warn(msg) {\n    // avoid using ...args as it breaks in older Edge builds\n    const args = Array.from(arguments).slice(1);\n    console.warn.apply(console, ['[Vue Router warn]: ' + msg].concat(args));\n}\n\n/**\n * Encoding Rules (␣ = Space)\n * - Path: ␣ \" < > # ? { }\n * - Query: ␣ \" < > # & =\n * - Hash: ␣ \" < > `\n *\n * On top of that, the RFC3986 (https://tools.ietf.org/html/rfc3986#section-2.2)\n * defines some extra characters to be encoded. Most browsers do not encode them\n * in encodeURI https://github.com/whatwg/url/issues/369, so it may be safer to\n * also encode `!'()*`. Leaving un-encoded only ASCII alphanumeric(`a-zA-Z0-9`)\n * plus `-._~`. This extra safety should be applied to query by patching the\n * string returned by encodeURIComponent encodeURI also encodes `[\\]^`. `\\`\n * should be encoded to avoid ambiguity. Browsers (IE, FF, C) transform a `\\`\n * into a `/` if directly typed in. The _backtick_ (`````) should also be\n * encoded everywhere because some browsers like FF encode it when directly\n * written while others don't. Safari and IE don't encode ``\"<>{}``` in hash.\n */\n// const EXTRA_RESERVED_RE = /[!'()*]/g\n// const encodeReservedReplacer = (c: string) => '%' + c.charCodeAt(0).toString(16)\nconst HASH_RE = /#/g; // %23\nconst AMPERSAND_RE = /&/g; // %26\nconst SLASH_RE = /\\//g; // %2F\nconst EQUAL_RE = /=/g; // %3D\nconst IM_RE = /\\?/g; // %3F\nconst PLUS_RE = /\\+/g; // %2B\n/**\n * NOTE: It's not clear to me if we should encode the + symbol in queries, it\n * seems to be less flexible than not doing so and I can't find out the legacy\n * systems requiring this for regular requests like text/html. In the standard,\n * the encoding of the plus character is only mentioned for\n * application/x-www-form-urlencoded\n * (https://url.spec.whatwg.org/#urlencoded-parsing) and most browsers seems lo\n * leave the plus character as is in queries. To be more flexible, we allow the\n * plus character on the query, but it can also be manually encoded by the user.\n *\n * Resources:\n * - https://url.spec.whatwg.org/#urlencoded-parsing\n * - https://stackoverflow.com/questions/1634271/url-encoding-the-space-character-or-20\n */\nconst ENC_BRACKET_OPEN_RE = /%5B/g; // [\nconst ENC_BRACKET_CLOSE_RE = /%5D/g; // ]\nconst ENC_CARET_RE = /%5E/g; // ^\nconst ENC_BACKTICK_RE = /%60/g; // `\nconst ENC_CURLY_OPEN_RE = /%7B/g; // {\nconst ENC_PIPE_RE = /%7C/g; // |\nconst ENC_CURLY_CLOSE_RE = /%7D/g; // }\nconst ENC_SPACE_RE = /%20/g; // }\n/**\n * Encode characters that need to be encoded on the path, search and hash\n * sections of the URL.\n *\n * @internal\n * @param text - string to encode\n * @returns encoded string\n */\nfunction commonEncode(text) {\n    return encodeURI('' + text)\n        .replace(ENC_PIPE_RE, '|')\n        .replace(ENC_BRACKET_OPEN_RE, '[')\n        .replace(ENC_BRACKET_CLOSE_RE, ']');\n}\n/**\n * Encode characters that need to be encoded on the hash section of the URL.\n *\n * @param text - string to encode\n * @returns encoded string\n */\nfunction encodeHash(text) {\n    return commonEncode(text)\n        .replace(ENC_CURLY_OPEN_RE, '{')\n        .replace(ENC_CURLY_CLOSE_RE, '}')\n        .replace(ENC_CARET_RE, '^');\n}\n/**\n * Encode characters that need to be encoded query values on the query\n * section of the URL.\n *\n * @param text - string to encode\n * @returns encoded string\n */\nfunction encodeQueryValue(text) {\n    return (commonEncode(text)\n        // Encode the space as +, encode the + to differentiate it from the space\n        .replace(PLUS_RE, '%2B')\n        .replace(ENC_SPACE_RE, '+')\n        .replace(HASH_RE, '%23')\n        .replace(AMPERSAND_RE, '%26')\n        .replace(ENC_BACKTICK_RE, '`')\n        .replace(ENC_CURLY_OPEN_RE, '{')\n        .replace(ENC_CURLY_CLOSE_RE, '}')\n        .replace(ENC_CARET_RE, '^'));\n}\n/**\n * Like `encodeQueryValue` but also encodes the `=` character.\n *\n * @param text - string to encode\n */\nfunction encodeQueryKey(text) {\n    return encodeQueryValue(text).replace(EQUAL_RE, '%3D');\n}\n/**\n * Encode characters that need to be encoded on the path section of the URL.\n *\n * @param text - string to encode\n * @returns encoded string\n */\nfunction encodePath(text) {\n    return commonEncode(text).replace(HASH_RE, '%23').replace(IM_RE, '%3F');\n}\n/**\n * Encode characters that need to be encoded on the path section of the URL as a\n * param. This function encodes everything {@link encodePath} does plus the\n * slash (`/`) character. If `text` is `null` or `undefined`, returns an empty\n * string instead.\n *\n * @param text - string to encode\n * @returns encoded string\n */\nfunction encodeParam(text) {\n    return text == null ? '' : encodePath(text).replace(SLASH_RE, '%2F');\n}\n/**\n * Decode text using `decodeURIComponent`. Returns the original text if it\n * fails.\n *\n * @param text - string to decode\n * @returns decoded string\n */\nfunction decode(text) {\n    try {\n        return decodeURIComponent('' + text);\n    }\n    catch (err) {\n        (process.env.NODE_ENV !== 'production') && warn(`Error decoding \"${text}\". Using original value`);\n    }\n    return '' + text;\n}\n\nconst TRAILING_SLASH_RE = /\\/$/;\nconst removeTrailingSlash = (path) => path.replace(TRAILING_SLASH_RE, '');\n/**\n * Transforms a URI into a normalized history location\n *\n * @param parseQuery\n * @param location - URI to normalize\n * @param currentLocation - current absolute location. Allows resolving relative\n * paths. Must start with `/`. Defaults to `/`\n * @returns a normalized history location\n */\nfunction parseURL(parseQuery, location, currentLocation = '/') {\n    let path, query = {}, searchString = '', hash = '';\n    // Could use URL and URLSearchParams but IE 11 doesn't support it\n    // TODO: move to new URL()\n    const hashPos = location.indexOf('#');\n    let searchPos = location.indexOf('?');\n    // the hash appears before the search, so it's not part of the search string\n    if (hashPos < searchPos && hashPos >= 0) {\n        searchPos = -1;\n    }\n    if (searchPos > -1) {\n        path = location.slice(0, searchPos);\n        searchString = location.slice(searchPos + 1, hashPos > -1 ? hashPos : location.length);\n        query = parseQuery(searchString);\n    }\n    if (hashPos > -1) {\n        path = path || location.slice(0, hashPos);\n        // keep the # character\n        hash = location.slice(hashPos, location.length);\n    }\n    // no search and no query\n    path = resolveRelativePath(path != null ? path : location, currentLocation);\n    // empty path means a relative query or hash `?foo=f`, `#thing`\n    return {\n        fullPath: path + (searchString && '?') + searchString + hash,\n        path,\n        query,\n        hash: decode(hash),\n    };\n}\n/**\n * Stringifies a URL object\n *\n * @param stringifyQuery\n * @param location\n */\nfunction stringifyURL(stringifyQuery, location) {\n    const query = location.query ? stringifyQuery(location.query) : '';\n    return location.path + (query && '?') + query + (location.hash || '');\n}\n/**\n * Strips off the base from the beginning of a location.pathname in a non-case-sensitive way.\n *\n * @param pathname - location.pathname\n * @param base - base to strip off\n */\nfunction stripBase(pathname, base) {\n    // no base or base is not found at the beginning\n    if (!base || !pathname.toLowerCase().startsWith(base.toLowerCase()))\n        return pathname;\n    return pathname.slice(base.length) || '/';\n}\n/**\n * Checks if two RouteLocation are equal. This means that both locations are\n * pointing towards the same {@link RouteRecord} and that all `params`, `query`\n * parameters and `hash` are the same\n *\n * @param stringifyQuery - A function that takes a query object of type LocationQueryRaw and returns a string representation of it.\n * @param a - first {@link RouteLocation}\n * @param b - second {@link RouteLocation}\n */\nfunction isSameRouteLocation(stringifyQuery, a, b) {\n    const aLastIndex = a.matched.length - 1;\n    const bLastIndex = b.matched.length - 1;\n    return (aLastIndex > -1 &&\n        aLastIndex === bLastIndex &&\n        isSameRouteRecord(a.matched[aLastIndex], b.matched[bLastIndex]) &&\n        isSameRouteLocationParams(a.params, b.params) &&\n        stringifyQuery(a.query) === stringifyQuery(b.query) &&\n        a.hash === b.hash);\n}\n/**\n * Check if two `RouteRecords` are equal. Takes into account aliases: they are\n * considered equal to the `RouteRecord` they are aliasing.\n *\n * @param a - first {@link RouteRecord}\n * @param b - second {@link RouteRecord}\n */\nfunction isSameRouteRecord(a, b) {\n    // since the original record has an undefined value for aliasOf\n    // but all aliases point to the original record, this will always compare\n    // the original record\n    return (a.aliasOf || a) === (b.aliasOf || b);\n}\nfunction isSameRouteLocationParams(a, b) {\n    if (Object.keys(a).length !== Object.keys(b).length)\n        return false;\n    for (const key in a) {\n        if (!isSameRouteLocationParamsValue(a[key], b[key]))\n            return false;\n    }\n    return true;\n}\nfunction isSameRouteLocationParamsValue(a, b) {\n    return isArray(a)\n        ? isEquivalentArray(a, b)\n        : isArray(b)\n            ? isEquivalentArray(b, a)\n            : a === b;\n}\n/**\n * Check if two arrays are the same or if an array with one single entry is the\n * same as another primitive value. Used to check query and parameters\n *\n * @param a - array of values\n * @param b - array of values or a single value\n */\nfunction isEquivalentArray(a, b) {\n    return isArray(b)\n        ? a.length === b.length && a.every((value, i) => value === b[i])\n        : a.length === 1 && a[0] === b;\n}\n/**\n * Resolves a relative path that starts with `.`.\n *\n * @param to - path location we are resolving\n * @param from - currentLocation.path, should start with `/`\n */\nfunction resolveRelativePath(to, from) {\n    if (to.startsWith('/'))\n        return to;\n    if ((process.env.NODE_ENV !== 'production') && !from.startsWith('/')) {\n        warn(`Cannot resolve a relative location without an absolute path. Trying to resolve \"${to}\" from \"${from}\". It should look like \"/${from}\".`);\n        return to;\n    }\n    if (!to)\n        return from;\n    const fromSegments = from.split('/');\n    const toSegments = to.split('/');\n    const lastToSegment = toSegments[toSegments.length - 1];\n    // make . and ./ the same (../ === .., ../../ === ../..)\n    // this is the same behavior as new URL()\n    if (lastToSegment === '..' || lastToSegment === '.') {\n        toSegments.push('');\n    }\n    let position = fromSegments.length - 1;\n    let toPosition;\n    let segment;\n    for (toPosition = 0; toPosition < toSegments.length; toPosition++) {\n        segment = toSegments[toPosition];\n        // we stay on the same position\n        if (segment === '.')\n            continue;\n        // go up in the from array\n        if (segment === '..') {\n            // we can't go below zero, but we still need to increment toPosition\n            if (position > 1)\n                position--;\n            // continue\n        }\n        // we reached a non-relative path, we stop here\n        else\n            break;\n    }\n    return (fromSegments.slice(0, position).join('/') +\n        '/' +\n        toSegments.slice(toPosition).join('/'));\n}\n/**\n * Initial route location where the router is. Can be used in navigation guards\n * to differentiate the initial navigation.\n *\n * @example\n * ```js\n * import { START_LOCATION } from 'vue-router'\n *\n * router.beforeEach((to, from) => {\n *   if (from === START_LOCATION) {\n *     // initial navigation\n *   }\n * })\n * ```\n */\nconst START_LOCATION_NORMALIZED = {\n    path: '/',\n    // TODO: could we use a symbol in the future?\n    name: undefined,\n    params: {},\n    query: {},\n    hash: '',\n    fullPath: '/',\n    matched: [],\n    meta: {},\n    redirectedFrom: undefined,\n};\n\nvar NavigationType;\n(function (NavigationType) {\n    NavigationType[\"pop\"] = \"pop\";\n    NavigationType[\"push\"] = \"push\";\n})(NavigationType || (NavigationType = {}));\nvar NavigationDirection;\n(function (NavigationDirection) {\n    NavigationDirection[\"back\"] = \"back\";\n    NavigationDirection[\"forward\"] = \"forward\";\n    NavigationDirection[\"unknown\"] = \"\";\n})(NavigationDirection || (NavigationDirection = {}));\n/**\n * Starting location for Histories\n */\nconst START = '';\n// Generic utils\n/**\n * Normalizes a base by removing any trailing slash and reading the base tag if\n * present.\n *\n * @param base - base to normalize\n */\nfunction normalizeBase(base) {\n    if (!base) {\n        if (isBrowser) {\n            // respect <base> tag\n            const baseEl = document.querySelector('base');\n            base = (baseEl && baseEl.getAttribute('href')) || '/';\n            // strip full URL origin\n            base = base.replace(/^\\w+:\\/\\/[^\\/]+/, '');\n        }\n        else {\n            base = '/';\n        }\n    }\n    // ensure leading slash when it was removed by the regex above avoid leading\n    // slash with hash because the file could be read from the disk like file://\n    // and the leading slash would cause problems\n    if (base[0] !== '/' && base[0] !== '#')\n        base = '/' + base;\n    // remove the trailing slash so all other method can just do `base + fullPath`\n    // to build an href\n    return removeTrailingSlash(base);\n}\n// remove any character before the hash\nconst BEFORE_HASH_RE = /^[^#]+#/;\nfunction createHref(base, location) {\n    return base.replace(BEFORE_HASH_RE, '#') + location;\n}\n\nfunction getElementPosition(el, offset) {\n    const docRect = document.documentElement.getBoundingClientRect();\n    const elRect = el.getBoundingClientRect();\n    return {\n        behavior: offset.behavior,\n        left: elRect.left - docRect.left - (offset.left || 0),\n        top: elRect.top - docRect.top - (offset.top || 0),\n    };\n}\nconst computeScrollPosition = () => ({\n    left: window.scrollX,\n    top: window.scrollY,\n});\nfunction scrollToPosition(position) {\n    let scrollToOptions;\n    if ('el' in position) {\n        const positionEl = position.el;\n        const isIdSelector = typeof positionEl === 'string' && positionEl.startsWith('#');\n        /**\n         * `id`s can accept pretty much any characters, including CSS combinators\n         * like `>` or `~`. It's still possible to retrieve elements using\n         * `document.getElementById('~')` but it needs to be escaped when using\n         * `document.querySelector('#\\\\~')` for it to be valid. The only\n         * requirements for `id`s are them to be unique on the page and to not be\n         * empty (`id=\"\"`). Because of that, when passing an id selector, it should\n         * be properly escaped for it to work with `querySelector`. We could check\n         * for the id selector to be simple (no CSS combinators `+ >~`) but that\n         * would make things inconsistent since they are valid characters for an\n         * `id` but would need to be escaped when using `querySelector`, breaking\n         * their usage and ending up in no selector returned. Selectors need to be\n         * escaped:\n         *\n         * - `#1-thing` becomes `#\\31 -thing`\n         * - `#with~symbols` becomes `#with\\\\~symbols`\n         *\n         * - More information about  the topic can be found at\n         *   https://mathiasbynens.be/notes/html5-id-class.\n         * - Practical example: https://mathiasbynens.be/demo/html5-id\n         */\n        if ((process.env.NODE_ENV !== 'production') && typeof position.el === 'string') {\n            if (!isIdSelector || !document.getElementById(position.el.slice(1))) {\n                try {\n                    const foundEl = document.querySelector(position.el);\n                    if (isIdSelector && foundEl) {\n                        warn(`The selector \"${position.el}\" should be passed as \"el: document.querySelector('${position.el}')\" because it starts with \"#\".`);\n                        // return to avoid other warnings\n                        return;\n                    }\n                }\n                catch (err) {\n                    warn(`The selector \"${position.el}\" is invalid. If you are using an id selector, make sure to escape it. You can find more information about escaping characters in selectors at https://mathiasbynens.be/notes/css-escapes or use CSS.escape (https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape).`);\n                    // return to avoid other warnings\n                    return;\n                }\n            }\n        }\n        const el = typeof positionEl === 'string'\n            ? isIdSelector\n                ? document.getElementById(positionEl.slice(1))\n                : document.querySelector(positionEl)\n            : positionEl;\n        if (!el) {\n            (process.env.NODE_ENV !== 'production') &&\n                warn(`Couldn't find element using selector \"${position.el}\" returned by scrollBehavior.`);\n            return;\n        }\n        scrollToOptions = getElementPosition(el, position);\n    }\n    else {\n        scrollToOptions = position;\n    }\n    if ('scrollBehavior' in document.documentElement.style)\n        window.scrollTo(scrollToOptions);\n    else {\n        window.scrollTo(scrollToOptions.left != null ? scrollToOptions.left : window.scrollX, scrollToOptions.top != null ? scrollToOptions.top : window.scrollY);\n    }\n}\nfunction getScrollKey(path, delta) {\n    const position = history.state ? history.state.position - delta : -1;\n    return position + path;\n}\nconst scrollPositions = new Map();\nfunction saveScrollPosition(key, scrollPosition) {\n    scrollPositions.set(key, scrollPosition);\n}\nfunction getSavedScrollPosition(key) {\n    const scroll = scrollPositions.get(key);\n    // consume it so it's not used again\n    scrollPositions.delete(key);\n    return scroll;\n}\n// TODO: RFC about how to save scroll position\n/**\n * ScrollBehavior instance used by the router to compute and restore the scroll\n * position when navigating.\n */\n// export interface ScrollHandler<ScrollPositionEntry extends HistoryStateValue, ScrollPosition extends ScrollPositionEntry> {\n//   // returns a scroll position that can be saved in history\n//   compute(): ScrollPositionEntry\n//   // can take an extended ScrollPositionEntry\n//   scroll(position: ScrollPosition): void\n// }\n// export const scrollHandler: ScrollHandler<ScrollPosition> = {\n//   compute: computeScroll,\n//   scroll: scrollToPosition,\n// }\n\nlet createBaseLocation = () => location.protocol + '//' + location.host;\n/**\n * Creates a normalized history location from a window.location object\n * @param base - The base path\n * @param location - The window.location object\n */\nfunction createCurrentLocation(base, location) {\n    const { pathname, search, hash } = location;\n    // allows hash bases like #, /#, #/, #!, #!/, /#!/, or even /folder#end\n    const hashPos = base.indexOf('#');\n    if (hashPos > -1) {\n        let slicePos = hash.includes(base.slice(hashPos))\n            ? base.slice(hashPos).length\n            : 1;\n        let pathFromHash = hash.slice(slicePos);\n        // prepend the starting slash to hash so the url starts with /#\n        if (pathFromHash[0] !== '/')\n            pathFromHash = '/' + pathFromHash;\n        return stripBase(pathFromHash, '');\n    }\n    const path = stripBase(pathname, base);\n    return path + search + hash;\n}\nfunction useHistoryListeners(base, historyState, currentLocation, replace) {\n    let listeners = [];\n    let teardowns = [];\n    // TODO: should it be a stack? a Dict. Check if the popstate listener\n    // can trigger twice\n    let pauseState = null;\n    const popStateHandler = ({ state, }) => {\n        const to = createCurrentLocation(base, location);\n        const from = currentLocation.value;\n        const fromState = historyState.value;\n        let delta = 0;\n        if (state) {\n            currentLocation.value = to;\n            historyState.value = state;\n            // ignore the popstate and reset the pauseState\n            if (pauseState && pauseState === from) {\n                pauseState = null;\n                return;\n            }\n            delta = fromState ? state.position - fromState.position : 0;\n        }\n        else {\n            replace(to);\n        }\n        // Here we could also revert the navigation by calling history.go(-delta)\n        // this listener will have to be adapted to not trigger again and to wait for the url\n        // to be updated before triggering the listeners. Some kind of validation function would also\n        // need to be passed to the listeners so the navigation can be accepted\n        // call all listeners\n        listeners.forEach(listener => {\n            listener(currentLocation.value, from, {\n                delta,\n                type: NavigationType.pop,\n                direction: delta\n                    ? delta > 0\n                        ? NavigationDirection.forward\n                        : NavigationDirection.back\n                    : NavigationDirection.unknown,\n            });\n        });\n    };\n    function pauseListeners() {\n        pauseState = currentLocation.value;\n    }\n    function listen(callback) {\n        // set up the listener and prepare teardown callbacks\n        listeners.push(callback);\n        const teardown = () => {\n            const index = listeners.indexOf(callback);\n            if (index > -1)\n                listeners.splice(index, 1);\n        };\n        teardowns.push(teardown);\n        return teardown;\n    }\n    function beforeUnloadListener() {\n        const { history } = window;\n        if (!history.state)\n            return;\n        history.replaceState(assign({}, history.state, { scroll: computeScrollPosition() }), '');\n    }\n    function destroy() {\n        for (const teardown of teardowns)\n            teardown();\n        teardowns = [];\n        window.removeEventListener('popstate', popStateHandler);\n        window.removeEventListener('beforeunload', beforeUnloadListener);\n    }\n    // set up the listeners and prepare teardown callbacks\n    window.addEventListener('popstate', popStateHandler);\n    // TODO: could we use 'pagehide' or 'visibilitychange' instead?\n    // https://developer.chrome.com/blog/page-lifecycle-api/\n    window.addEventListener('beforeunload', beforeUnloadListener, {\n        passive: true,\n    });\n    return {\n        pauseListeners,\n        listen,\n        destroy,\n    };\n}\n/**\n * Creates a state object\n */\nfunction buildState(back, current, forward, replaced = false, computeScroll = false) {\n    return {\n        back,\n        current,\n        forward,\n        replaced,\n        position: window.history.length,\n        scroll: computeScroll ? computeScrollPosition() : null,\n    };\n}\nfunction useHistoryStateNavigation(base) {\n    const { history, location } = window;\n    // private variables\n    const currentLocation = {\n        value: createCurrentLocation(base, location),\n    };\n    const historyState = { value: history.state };\n    // build current history entry as this is a fresh navigation\n    if (!historyState.value) {\n        changeLocation(currentLocation.value, {\n            back: null,\n            current: currentLocation.value,\n            forward: null,\n            // the length is off by one, we need to decrease it\n            position: history.length - 1,\n            replaced: true,\n            // don't add a scroll as the user may have an anchor, and we want\n            // scrollBehavior to be triggered without a saved position\n            scroll: null,\n        }, true);\n    }\n    function changeLocation(to, state, replace) {\n        /**\n         * if a base tag is provided, and we are on a normal domain, we have to\n         * respect the provided `base` attribute because pushState() will use it and\n         * potentially erase anything before the `#` like at\n         * https://github.com/vuejs/router/issues/685 where a base of\n         * `/folder/#` but a base of `/` would erase the `/folder/` section. If\n         * there is no host, the `<base>` tag makes no sense and if there isn't a\n         * base tag we can just use everything after the `#`.\n         */\n        const hashIndex = base.indexOf('#');\n        const url = hashIndex > -1\n            ? (location.host && document.querySelector('base')\n                ? base\n                : base.slice(hashIndex)) + to\n            : createBaseLocation() + base + to;\n        try {\n            // BROWSER QUIRK\n            // NOTE: Safari throws a SecurityError when calling this function 100 times in 30 seconds\n            history[replace ? 'replaceState' : 'pushState'](state, '', url);\n            historyState.value = state;\n        }\n        catch (err) {\n            if ((process.env.NODE_ENV !== 'production')) {\n                warn('Error with push/replace State', err);\n            }\n            else {\n                console.error(err);\n            }\n            // Force the navigation, this also resets the call count\n            location[replace ? 'replace' : 'assign'](url);\n        }\n    }\n    function replace(to, data) {\n        const state = assign({}, history.state, buildState(historyState.value.back, \n        // keep back and forward entries but override current position\n        to, historyState.value.forward, true), data, { position: historyState.value.position });\n        changeLocation(to, state, true);\n        currentLocation.value = to;\n    }\n    function push(to, data) {\n        // Add to current entry the information of where we are going\n        // as well as saving the current position\n        const currentState = assign({}, \n        // use current history state to gracefully handle a wrong call to\n        // history.replaceState\n        // https://github.com/vuejs/router/issues/366\n        historyState.value, history.state, {\n            forward: to,\n            scroll: computeScrollPosition(),\n        });\n        if ((process.env.NODE_ENV !== 'production') && !history.state) {\n            warn(`history.state seems to have been manually replaced without preserving the necessary values. Make sure to preserve existing history state if you are manually calling history.replaceState:\\n\\n` +\n                `history.replaceState(history.state, '', url)\\n\\n` +\n                `You can find more information at https://router.vuejs.org/guide/migration/#Usage-of-history-state`);\n        }\n        changeLocation(currentState.current, currentState, true);\n        const state = assign({}, buildState(currentLocation.value, to, null), { position: currentState.position + 1 }, data);\n        changeLocation(to, state, false);\n        currentLocation.value = to;\n    }\n    return {\n        location: currentLocation,\n        state: historyState,\n        push,\n        replace,\n    };\n}\n/**\n * Creates an HTML5 history. Most common history for single page applications.\n *\n * @param base -\n */\nfunction createWebHistory(base) {\n    base = normalizeBase(base);\n    const historyNavigation = useHistoryStateNavigation(base);\n    const historyListeners = useHistoryListeners(base, historyNavigation.state, historyNavigation.location, historyNavigation.replace);\n    function go(delta, triggerListeners = true) {\n        if (!triggerListeners)\n            historyListeners.pauseListeners();\n        history.go(delta);\n    }\n    const routerHistory = assign({\n        // it's overridden right after\n        location: '',\n        base,\n        go,\n        createHref: createHref.bind(null, base),\n    }, historyNavigation, historyListeners);\n    Object.defineProperty(routerHistory, 'location', {\n        enumerable: true,\n        get: () => historyNavigation.location.value,\n    });\n    Object.defineProperty(routerHistory, 'state', {\n        enumerable: true,\n        get: () => historyNavigation.state.value,\n    });\n    return routerHistory;\n}\n\n/**\n * Creates an in-memory based history. The main purpose of this history is to handle SSR. It starts in a special location that is nowhere.\n * It's up to the user to replace that location with the starter location by either calling `router.push` or `router.replace`.\n *\n * @param base - Base applied to all urls, defaults to '/'\n * @returns a history object that can be passed to the router constructor\n */\nfunction createMemoryHistory(base = '') {\n    let listeners = [];\n    let queue = [START];\n    let position = 0;\n    base = normalizeBase(base);\n    function setLocation(location) {\n        position++;\n        if (position !== queue.length) {\n            // we are in the middle, we remove everything from here in the queue\n            queue.splice(position);\n        }\n        queue.push(location);\n    }\n    function triggerListeners(to, from, { direction, delta }) {\n        const info = {\n            direction,\n            delta,\n            type: NavigationType.pop,\n        };\n        for (const callback of listeners) {\n            callback(to, from, info);\n        }\n    }\n    const routerHistory = {\n        // rewritten by Object.defineProperty\n        location: START,\n        // TODO: should be kept in queue\n        state: {},\n        base,\n        createHref: createHref.bind(null, base),\n        replace(to) {\n            // remove current entry and decrement position\n            queue.splice(position--, 1);\n            setLocation(to);\n        },\n        push(to, data) {\n            setLocation(to);\n        },\n        listen(callback) {\n            listeners.push(callback);\n            return () => {\n                const index = listeners.indexOf(callback);\n                if (index > -1)\n                    listeners.splice(index, 1);\n            };\n        },\n        destroy() {\n            listeners = [];\n            queue = [START];\n            position = 0;\n        },\n        go(delta, shouldTrigger = true) {\n            const from = this.location;\n            const direction = \n            // we are considering delta === 0 going forward, but in abstract mode\n            // using 0 for the delta doesn't make sense like it does in html5 where\n            // it reloads the page\n            delta < 0 ? NavigationDirection.back : NavigationDirection.forward;\n            position = Math.max(0, Math.min(position + delta, queue.length - 1));\n            if (shouldTrigger) {\n                triggerListeners(this.location, from, {\n                    direction,\n                    delta,\n                });\n            }\n        },\n    };\n    Object.defineProperty(routerHistory, 'location', {\n        enumerable: true,\n        get: () => queue[position],\n    });\n    return routerHistory;\n}\n\n/**\n * Creates a hash history. Useful for web applications with no host (e.g. `file://`) or when configuring a server to\n * handle any URL is not possible.\n *\n * @param base - optional base to provide. Defaults to `location.pathname + location.search` If there is a `<base>` tag\n * in the `head`, its value will be ignored in favor of this parameter **but note it affects all the history.pushState()\n * calls**, meaning that if you use a `<base>` tag, it's `href` value **has to match this parameter** (ignoring anything\n * after the `#`).\n *\n * @example\n * ```js\n * // at https://example.com/folder\n * createWebHashHistory() // gives a url of `https://example.com/folder#`\n * createWebHashHistory('/folder/') // gives a url of `https://example.com/folder/#`\n * // if the `#` is provided in the base, it won't be added by `createWebHashHistory`\n * createWebHashHistory('/folder/#/app/') // gives a url of `https://example.com/folder/#/app/`\n * // you should avoid doing this because it changes the original url and breaks copying urls\n * createWebHashHistory('/other-folder/') // gives a url of `https://example.com/other-folder/#`\n *\n * // at file:///usr/etc/folder/index.html\n * // for locations with no `host`, the base is ignored\n * createWebHashHistory('/iAmIgnored') // gives a url of `file:///usr/etc/folder/index.html#`\n * ```\n */\nfunction createWebHashHistory(base) {\n    // Make sure this implementation is fine in terms of encoding, specially for IE11\n    // for `file://`, directly use the pathname and ignore the base\n    // location.pathname contains an initial `/` even at the root: `https://example.com`\n    base = location.host ? base || location.pathname + location.search : '';\n    // allow the user to provide a `#` in the middle: `/base/#/app`\n    if (!base.includes('#'))\n        base += '#';\n    if ((process.env.NODE_ENV !== 'production') && !base.endsWith('#/') && !base.endsWith('#')) {\n        warn(`A hash base must end with a \"#\":\\n\"${base}\" should be \"${base.replace(/#.*$/, '#')}\".`);\n    }\n    return createWebHistory(base);\n}\n\nfunction isRouteLocation(route) {\n    return typeof route === 'string' || (route && typeof route === 'object');\n}\nfunction isRouteName(name) {\n    return typeof name === 'string' || typeof name === 'symbol';\n}\n\nconst NavigationFailureSymbol = Symbol((process.env.NODE_ENV !== 'production') ? 'navigation failure' : '');\n/**\n * Enumeration with all possible types for navigation failures. Can be passed to\n * {@link isNavigationFailure} to check for specific failures.\n */\nvar NavigationFailureType;\n(function (NavigationFailureType) {\n    /**\n     * An aborted navigation is a navigation that failed because a navigation\n     * guard returned `false` or called `next(false)`\n     */\n    NavigationFailureType[NavigationFailureType[\"aborted\"] = 4] = \"aborted\";\n    /**\n     * A cancelled navigation is a navigation that failed because a more recent\n     * navigation finished started (not necessarily finished).\n     */\n    NavigationFailureType[NavigationFailureType[\"cancelled\"] = 8] = \"cancelled\";\n    /**\n     * A duplicated navigation is a navigation that failed because it was\n     * initiated while already being at the exact same location.\n     */\n    NavigationFailureType[NavigationFailureType[\"duplicated\"] = 16] = \"duplicated\";\n})(NavigationFailureType || (NavigationFailureType = {}));\n// DEV only debug messages\nconst ErrorTypeMessages = {\n    [1 /* ErrorTypes.MATCHER_NOT_FOUND */]({ location, currentLocation }) {\n        return `No match for\\n ${JSON.stringify(location)}${currentLocation\n            ? '\\nwhile being at\\n' + JSON.stringify(currentLocation)\n            : ''}`;\n    },\n    [2 /* ErrorTypes.NAVIGATION_GUARD_REDIRECT */]({ from, to, }) {\n        return `Redirected from \"${from.fullPath}\" to \"${stringifyRoute(to)}\" via a navigation guard.`;\n    },\n    [4 /* ErrorTypes.NAVIGATION_ABORTED */]({ from, to }) {\n        return `Navigation aborted from \"${from.fullPath}\" to \"${to.fullPath}\" via a navigation guard.`;\n    },\n    [8 /* ErrorTypes.NAVIGATION_CANCELLED */]({ from, to }) {\n        return `Navigation cancelled from \"${from.fullPath}\" to \"${to.fullPath}\" with a new navigation.`;\n    },\n    [16 /* ErrorTypes.NAVIGATION_DUPLICATED */]({ from, to }) {\n        return `Avoided redundant navigation to current location: \"${from.fullPath}\".`;\n    },\n};\n/**\n * Creates a typed NavigationFailure object.\n * @internal\n * @param type - NavigationFailureType\n * @param params - { from, to }\n */\nfunction createRouterError(type, params) {\n    // keep full error messages in cjs versions\n    if ((process.env.NODE_ENV !== 'production') || !true) {\n        return assign(new Error(ErrorTypeMessages[type](params)), {\n            type,\n            [NavigationFailureSymbol]: true,\n        }, params);\n    }\n    else {\n        return assign(new Error(), {\n            type,\n            [NavigationFailureSymbol]: true,\n        }, params);\n    }\n}\nfunction isNavigationFailure(error, type) {\n    return (error instanceof Error &&\n        NavigationFailureSymbol in error &&\n        (type == null || !!(error.type & type)));\n}\nconst propertiesToLog = ['params', 'query', 'hash'];\nfunction stringifyRoute(to) {\n    if (typeof to === 'string')\n        return to;\n    if (to.path != null)\n        return to.path;\n    const location = {};\n    for (const key of propertiesToLog) {\n        if (key in to)\n            location[key] = to[key];\n    }\n    return JSON.stringify(location, null, 2);\n}\n\n// default pattern for a param: non-greedy everything but /\nconst BASE_PARAM_PATTERN = '[^/]+?';\nconst BASE_PATH_PARSER_OPTIONS = {\n    sensitive: false,\n    strict: false,\n    start: true,\n    end: true,\n};\n// Special Regex characters that must be escaped in static tokens\nconst REGEX_CHARS_RE = /[.+*?^${}()[\\]/\\\\]/g;\n/**\n * Creates a path parser from an array of Segments (a segment is an array of Tokens)\n *\n * @param segments - array of segments returned by tokenizePath\n * @param extraOptions - optional options for the regexp\n * @returns a PathParser\n */\nfunction tokensToParser(segments, extraOptions) {\n    const options = assign({}, BASE_PATH_PARSER_OPTIONS, extraOptions);\n    // the amount of scores is the same as the length of segments except for the root segment \"/\"\n    const score = [];\n    // the regexp as a string\n    let pattern = options.start ? '^' : '';\n    // extracted keys\n    const keys = [];\n    for (const segment of segments) {\n        // the root segment needs special treatment\n        const segmentScores = segment.length ? [] : [90 /* PathScore.Root */];\n        // allow trailing slash\n        if (options.strict && !segment.length)\n            pattern += '/';\n        for (let tokenIndex = 0; tokenIndex < segment.length; tokenIndex++) {\n            const token = segment[tokenIndex];\n            // resets the score if we are inside a sub-segment /:a-other-:b\n            let subSegmentScore = 40 /* PathScore.Segment */ +\n                (options.sensitive ? 0.25 /* PathScore.BonusCaseSensitive */ : 0);\n            if (token.type === 0 /* TokenType.Static */) {\n                // prepend the slash if we are starting a new segment\n                if (!tokenIndex)\n                    pattern += '/';\n                pattern += token.value.replace(REGEX_CHARS_RE, '\\\\$&');\n                subSegmentScore += 40 /* PathScore.Static */;\n            }\n            else if (token.type === 1 /* TokenType.Param */) {\n                const { value, repeatable, optional, regexp } = token;\n                keys.push({\n                    name: value,\n                    repeatable,\n                    optional,\n                });\n                const re = regexp ? regexp : BASE_PARAM_PATTERN;\n                // the user provided a custom regexp /:id(\\\\d+)\n                if (re !== BASE_PARAM_PATTERN) {\n                    subSegmentScore += 10 /* PathScore.BonusCustomRegExp */;\n                    // make sure the regexp is valid before using it\n                    try {\n                        new RegExp(`(${re})`);\n                    }\n                    catch (err) {\n                        throw new Error(`Invalid custom RegExp for param \"${value}\" (${re}): ` +\n                            err.message);\n                    }\n                }\n                // when we repeat we must take care of the repeating leading slash\n                let subPattern = repeatable ? `((?:${re})(?:/(?:${re}))*)` : `(${re})`;\n                // prepend the slash if we are starting a new segment\n                if (!tokenIndex)\n                    subPattern =\n                        // avoid an optional / if there are more segments e.g. /:p?-static\n                        // or /:p?-:p2\n                        optional && segment.length < 2\n                            ? `(?:/${subPattern})`\n                            : '/' + subPattern;\n                if (optional)\n                    subPattern += '?';\n                pattern += subPattern;\n                subSegmentScore += 20 /* PathScore.Dynamic */;\n                if (optional)\n                    subSegmentScore += -8 /* PathScore.BonusOptional */;\n                if (repeatable)\n                    subSegmentScore += -20 /* PathScore.BonusRepeatable */;\n                if (re === '.*')\n                    subSegmentScore += -50 /* PathScore.BonusWildcard */;\n            }\n            segmentScores.push(subSegmentScore);\n        }\n        // an empty array like /home/ -> [[{home}], []]\n        // if (!segment.length) pattern += '/'\n        score.push(segmentScores);\n    }\n    // only apply the strict bonus to the last score\n    if (options.strict && options.end) {\n        const i = score.length - 1;\n        score[i][score[i].length - 1] += 0.7000000000000001 /* PathScore.BonusStrict */;\n    }\n    // TODO: dev only warn double trailing slash\n    if (!options.strict)\n        pattern += '/?';\n    if (options.end)\n        pattern += '$';\n    // allow paths like /dynamic to only match dynamic or dynamic/... but not dynamic_something_else\n    else if (options.strict && !pattern.endsWith('/'))\n        pattern += '(?:/|$)';\n    const re = new RegExp(pattern, options.sensitive ? '' : 'i');\n    function parse(path) {\n        const match = path.match(re);\n        const params = {};\n        if (!match)\n            return null;\n        for (let i = 1; i < match.length; i++) {\n            const value = match[i] || '';\n            const key = keys[i - 1];\n            params[key.name] = value && key.repeatable ? value.split('/') : value;\n        }\n        return params;\n    }\n    function stringify(params) {\n        let path = '';\n        // for optional parameters to allow to be empty\n        let avoidDuplicatedSlash = false;\n        for (const segment of segments) {\n            if (!avoidDuplicatedSlash || !path.endsWith('/'))\n                path += '/';\n            avoidDuplicatedSlash = false;\n            for (const token of segment) {\n                if (token.type === 0 /* TokenType.Static */) {\n                    path += token.value;\n                }\n                else if (token.type === 1 /* TokenType.Param */) {\n                    const { value, repeatable, optional } = token;\n                    const param = value in params ? params[value] : '';\n                    if (isArray(param) && !repeatable) {\n                        throw new Error(`Provided param \"${value}\" is an array but it is not repeatable (* or + modifiers)`);\n                    }\n                    const text = isArray(param)\n                        ? param.join('/')\n                        : param;\n                    if (!text) {\n                        if (optional) {\n                            // if we have more than one optional param like /:a?-static we don't need to care about the optional param\n                            if (segment.length < 2) {\n                                // remove the last slash as we could be at the end\n                                if (path.endsWith('/'))\n                                    path = path.slice(0, -1);\n                                // do not append a slash on the next iteration\n                                else\n                                    avoidDuplicatedSlash = true;\n                            }\n                        }\n                        else\n                            throw new Error(`Missing required param \"${value}\"`);\n                    }\n                    path += text;\n                }\n            }\n        }\n        // avoid empty path when we have multiple optional params\n        return path || '/';\n    }\n    return {\n        re,\n        score,\n        keys,\n        parse,\n        stringify,\n    };\n}\n/**\n * Compares an array of numbers as used in PathParser.score and returns a\n * number. This function can be used to `sort` an array\n *\n * @param a - first array of numbers\n * @param b - second array of numbers\n * @returns 0 if both are equal, < 0 if a should be sorted first, > 0 if b\n * should be sorted first\n */\nfunction compareScoreArray(a, b) {\n    let i = 0;\n    while (i < a.length && i < b.length) {\n        const diff = b[i] - a[i];\n        // only keep going if diff === 0\n        if (diff)\n            return diff;\n        i++;\n    }\n    // if the last subsegment was Static, the shorter segments should be sorted first\n    // otherwise sort the longest segment first\n    if (a.length < b.length) {\n        return a.length === 1 && a[0] === 40 /* PathScore.Static */ + 40 /* PathScore.Segment */\n            ? -1\n            : 1;\n    }\n    else if (a.length > b.length) {\n        return b.length === 1 && b[0] === 40 /* PathScore.Static */ + 40 /* PathScore.Segment */\n            ? 1\n            : -1;\n    }\n    return 0;\n}\n/**\n * Compare function that can be used with `sort` to sort an array of PathParser\n *\n * @param a - first PathParser\n * @param b - second PathParser\n * @returns 0 if both are equal, < 0 if a should be sorted first, > 0 if b\n */\nfunction comparePathParserScore(a, b) {\n    let i = 0;\n    const aScore = a.score;\n    const bScore = b.score;\n    while (i < aScore.length && i < bScore.length) {\n        const comp = compareScoreArray(aScore[i], bScore[i]);\n        // do not return if both are equal\n        if (comp)\n            return comp;\n        i++;\n    }\n    if (Math.abs(bScore.length - aScore.length) === 1) {\n        if (isLastScoreNegative(aScore))\n            return 1;\n        if (isLastScoreNegative(bScore))\n            return -1;\n    }\n    // if a and b share the same score entries but b has more, sort b first\n    return bScore.length - aScore.length;\n    // this is the ternary version\n    // return aScore.length < bScore.length\n    //   ? 1\n    //   : aScore.length > bScore.length\n    //   ? -1\n    //   : 0\n}\n/**\n * This allows detecting splats at the end of a path: /home/:id(.*)*\n *\n * @param score - score to check\n * @returns true if the last entry is negative\n */\nfunction isLastScoreNegative(score) {\n    const last = score[score.length - 1];\n    return score.length > 0 && last[last.length - 1] < 0;\n}\n\nconst ROOT_TOKEN = {\n    type: 0 /* TokenType.Static */,\n    value: '',\n};\nconst VALID_PARAM_RE = /[a-zA-Z0-9_]/;\n// After some profiling, the cache seems to be unnecessary because tokenizePath\n// (the slowest part of adding a route) is very fast\n// const tokenCache = new Map<string, Token[][]>()\nfunction tokenizePath(path) {\n    if (!path)\n        return [[]];\n    if (path === '/')\n        return [[ROOT_TOKEN]];\n    if (!path.startsWith('/')) {\n        throw new Error((process.env.NODE_ENV !== 'production')\n            ? `Route paths should start with a \"/\": \"${path}\" should be \"/${path}\".`\n            : `Invalid path \"${path}\"`);\n    }\n    // if (tokenCache.has(path)) return tokenCache.get(path)!\n    function crash(message) {\n        throw new Error(`ERR (${state})/\"${buffer}\": ${message}`);\n    }\n    let state = 0 /* TokenizerState.Static */;\n    let previousState = state;\n    const tokens = [];\n    // the segment will always be valid because we get into the initial state\n    // with the leading /\n    let segment;\n    function finalizeSegment() {\n        if (segment)\n            tokens.push(segment);\n        segment = [];\n    }\n    // index on the path\n    let i = 0;\n    // char at index\n    let char;\n    // buffer of the value read\n    let buffer = '';\n    // custom regexp for a param\n    let customRe = '';\n    function consumeBuffer() {\n        if (!buffer)\n            return;\n        if (state === 0 /* TokenizerState.Static */) {\n            segment.push({\n                type: 0 /* TokenType.Static */,\n                value: buffer,\n            });\n        }\n        else if (state === 1 /* TokenizerState.Param */ ||\n            state === 2 /* TokenizerState.ParamRegExp */ ||\n            state === 3 /* TokenizerState.ParamRegExpEnd */) {\n            if (segment.length > 1 && (char === '*' || char === '+'))\n                crash(`A repeatable param (${buffer}) must be alone in its segment. eg: '/:ids+.`);\n            segment.push({\n                type: 1 /* TokenType.Param */,\n                value: buffer,\n                regexp: customRe,\n                repeatable: char === '*' || char === '+',\n                optional: char === '*' || char === '?',\n            });\n        }\n        else {\n            crash('Invalid state to consume buffer');\n        }\n        buffer = '';\n    }\n    function addCharToBuffer() {\n        buffer += char;\n    }\n    while (i < path.length) {\n        char = path[i++];\n        if (char === '\\\\' && state !== 2 /* TokenizerState.ParamRegExp */) {\n            previousState = state;\n            state = 4 /* TokenizerState.EscapeNext */;\n            continue;\n        }\n        switch (state) {\n            case 0 /* TokenizerState.Static */:\n                if (char === '/') {\n                    if (buffer) {\n                        consumeBuffer();\n                    }\n                    finalizeSegment();\n                }\n                else if (char === ':') {\n                    consumeBuffer();\n                    state = 1 /* TokenizerState.Param */;\n                }\n                else {\n                    addCharToBuffer();\n                }\n                break;\n            case 4 /* TokenizerState.EscapeNext */:\n                addCharToBuffer();\n                state = previousState;\n                break;\n            case 1 /* TokenizerState.Param */:\n                if (char === '(') {\n                    state = 2 /* TokenizerState.ParamRegExp */;\n                }\n                else if (VALID_PARAM_RE.test(char)) {\n                    addCharToBuffer();\n                }\n                else {\n                    consumeBuffer();\n                    state = 0 /* TokenizerState.Static */;\n                    // go back one character if we were not modifying\n                    if (char !== '*' && char !== '?' && char !== '+')\n                        i--;\n                }\n                break;\n            case 2 /* TokenizerState.ParamRegExp */:\n                // TODO: is it worth handling nested regexp? like :p(?:prefix_([^/]+)_suffix)\n                // it already works by escaping the closing )\n                // https://paths.esm.dev/?p=AAMeJbiAwQEcDKbAoAAkP60PG2R6QAvgNaA6AFACM2ABuQBB#\n                // is this really something people need since you can also write\n                // /prefix_:p()_suffix\n                if (char === ')') {\n                    // handle the escaped )\n                    if (customRe[customRe.length - 1] == '\\\\')\n                        customRe = customRe.slice(0, -1) + char;\n                    else\n                        state = 3 /* TokenizerState.ParamRegExpEnd */;\n                }\n                else {\n                    customRe += char;\n                }\n                break;\n            case 3 /* TokenizerState.ParamRegExpEnd */:\n                // same as finalizing a param\n                consumeBuffer();\n                state = 0 /* TokenizerState.Static */;\n                // go back one character if we were not modifying\n                if (char !== '*' && char !== '?' && char !== '+')\n                    i--;\n                customRe = '';\n                break;\n            default:\n                crash('Unknown state');\n                break;\n        }\n    }\n    if (state === 2 /* TokenizerState.ParamRegExp */)\n        crash(`Unfinished custom RegExp for param \"${buffer}\"`);\n    consumeBuffer();\n    finalizeSegment();\n    // tokenCache.set(path, tokens)\n    return tokens;\n}\n\nfunction createRouteRecordMatcher(record, parent, options) {\n    const parser = tokensToParser(tokenizePath(record.path), options);\n    // warn against params with the same name\n    if ((process.env.NODE_ENV !== 'production')) {\n        const existingKeys = new Set();\n        for (const key of parser.keys) {\n            if (existingKeys.has(key.name))\n                warn(`Found duplicated params with name \"${key.name}\" for path \"${record.path}\". Only the last one will be available on \"$route.params\".`);\n            existingKeys.add(key.name);\n        }\n    }\n    const matcher = assign(parser, {\n        record,\n        parent,\n        // these needs to be populated by the parent\n        children: [],\n        alias: [],\n    });\n    if (parent) {\n        // both are aliases or both are not aliases\n        // we don't want to mix them because the order is used when\n        // passing originalRecord in Matcher.addRoute\n        if (!matcher.record.aliasOf === !parent.record.aliasOf)\n            parent.children.push(matcher);\n    }\n    return matcher;\n}\n\n/**\n * Creates a Router Matcher.\n *\n * @internal\n * @param routes - array of initial routes\n * @param globalOptions - global route options\n */\nfunction createRouterMatcher(routes, globalOptions) {\n    // normalized ordered array of matchers\n    const matchers = [];\n    const matcherMap = new Map();\n    globalOptions = mergeOptions({ strict: false, end: true, sensitive: false }, globalOptions);\n    function getRecordMatcher(name) {\n        return matcherMap.get(name);\n    }\n    function addRoute(record, parent, originalRecord) {\n        // used later on to remove by name\n        const isRootAdd = !originalRecord;\n        const mainNormalizedRecord = normalizeRouteRecord(record);\n        if ((process.env.NODE_ENV !== 'production')) {\n            checkChildMissingNameWithEmptyPath(mainNormalizedRecord, parent);\n        }\n        // we might be the child of an alias\n        mainNormalizedRecord.aliasOf = originalRecord && originalRecord.record;\n        const options = mergeOptions(globalOptions, record);\n        // generate an array of records to correctly handle aliases\n        const normalizedRecords = [mainNormalizedRecord];\n        if ('alias' in record) {\n            const aliases = typeof record.alias === 'string' ? [record.alias] : record.alias;\n            for (const alias of aliases) {\n                normalizedRecords.push(\n                // we need to normalize again to ensure the `mods` property\n                // being non enumerable\n                normalizeRouteRecord(assign({}, mainNormalizedRecord, {\n                    // this allows us to hold a copy of the `components` option\n                    // so that async components cache is hold on the original record\n                    components: originalRecord\n                        ? originalRecord.record.components\n                        : mainNormalizedRecord.components,\n                    path: alias,\n                    // we might be the child of an alias\n                    aliasOf: originalRecord\n                        ? originalRecord.record\n                        : mainNormalizedRecord,\n                    // the aliases are always of the same kind as the original since they\n                    // are defined on the same record\n                })));\n            }\n        }\n        let matcher;\n        let originalMatcher;\n        for (const normalizedRecord of normalizedRecords) {\n            const { path } = normalizedRecord;\n            // Build up the path for nested routes if the child isn't an absolute\n            // route. Only add the / delimiter if the child path isn't empty and if the\n            // parent path doesn't have a trailing slash\n            if (parent && path[0] !== '/') {\n                const parentPath = parent.record.path;\n                const connectingSlash = parentPath[parentPath.length - 1] === '/' ? '' : '/';\n                normalizedRecord.path =\n                    parent.record.path + (path && connectingSlash + path);\n            }\n            if ((process.env.NODE_ENV !== 'production') && normalizedRecord.path === '*') {\n                throw new Error('Catch all routes (\"*\") must now be defined using a param with a custom regexp.\\n' +\n                    'See more at https://router.vuejs.org/guide/migration/#Removed-star-or-catch-all-routes.');\n            }\n            // create the object beforehand, so it can be passed to children\n            matcher = createRouteRecordMatcher(normalizedRecord, parent, options);\n            if ((process.env.NODE_ENV !== 'production') && parent && path[0] === '/')\n                checkMissingParamsInAbsolutePath(matcher, parent);\n            // if we are an alias we must tell the original record that we exist,\n            // so we can be removed\n            if (originalRecord) {\n                originalRecord.alias.push(matcher);\n                if ((process.env.NODE_ENV !== 'production')) {\n                    checkSameParams(originalRecord, matcher);\n                }\n            }\n            else {\n                // otherwise, the first record is the original and others are aliases\n                originalMatcher = originalMatcher || matcher;\n                if (originalMatcher !== matcher)\n                    originalMatcher.alias.push(matcher);\n                // remove the route if named and only for the top record (avoid in nested calls)\n                // this works because the original record is the first one\n                if (isRootAdd && record.name && !isAliasRecord(matcher)) {\n                    if ((process.env.NODE_ENV !== 'production')) {\n                        checkSameNameAsAncestor(record, parent);\n                    }\n                    removeRoute(record.name);\n                }\n            }\n            // Avoid adding a record that doesn't display anything. This allows passing through records without a component to\n            // not be reached and pass through the catch all route\n            if (isMatchable(matcher)) {\n                insertMatcher(matcher);\n            }\n            if (mainNormalizedRecord.children) {\n                const children = mainNormalizedRecord.children;\n                for (let i = 0; i < children.length; i++) {\n                    addRoute(children[i], matcher, originalRecord && originalRecord.children[i]);\n                }\n            }\n            // if there was no original record, then the first one was not an alias and all\n            // other aliases (if any) need to reference this record when adding children\n            originalRecord = originalRecord || matcher;\n            // TODO: add normalized records for more flexibility\n            // if (parent && isAliasRecord(originalRecord)) {\n            //   parent.children.push(originalRecord)\n            // }\n        }\n        return originalMatcher\n            ? () => {\n                // since other matchers are aliases, they should be removed by the original matcher\n                removeRoute(originalMatcher);\n            }\n            : noop;\n    }\n    function removeRoute(matcherRef) {\n        if (isRouteName(matcherRef)) {\n            const matcher = matcherMap.get(matcherRef);\n            if (matcher) {\n                matcherMap.delete(matcherRef);\n                matchers.splice(matchers.indexOf(matcher), 1);\n                matcher.children.forEach(removeRoute);\n                matcher.alias.forEach(removeRoute);\n            }\n        }\n        else {\n            const index = matchers.indexOf(matcherRef);\n            if (index > -1) {\n                matchers.splice(index, 1);\n                if (matcherRef.record.name)\n                    matcherMap.delete(matcherRef.record.name);\n                matcherRef.children.forEach(removeRoute);\n                matcherRef.alias.forEach(removeRoute);\n            }\n        }\n    }\n    function getRoutes() {\n        return matchers;\n    }\n    function insertMatcher(matcher) {\n        const index = findInsertionIndex(matcher, matchers);\n        matchers.splice(index, 0, matcher);\n        // only add the original record to the name map\n        if (matcher.record.name && !isAliasRecord(matcher))\n            matcherMap.set(matcher.record.name, matcher);\n    }\n    function resolve(location, currentLocation) {\n        let matcher;\n        let params = {};\n        let path;\n        let name;\n        if ('name' in location && location.name) {\n            matcher = matcherMap.get(location.name);\n            if (!matcher)\n                throw createRouterError(1 /* ErrorTypes.MATCHER_NOT_FOUND */, {\n                    location,\n                });\n            // warn if the user is passing invalid params so they can debug it better when they get removed\n            if ((process.env.NODE_ENV !== 'production')) {\n                const invalidParams = Object.keys(location.params || {}).filter(paramName => !matcher.keys.find(k => k.name === paramName));\n                if (invalidParams.length) {\n                    warn(`Discarded invalid param(s) \"${invalidParams.join('\", \"')}\" when navigating. See https://github.com/vuejs/router/blob/main/packages/router/CHANGELOG.md#414-2022-08-22 for more details.`);\n                }\n            }\n            name = matcher.record.name;\n            params = assign(\n            // paramsFromLocation is a new object\n            paramsFromLocation(currentLocation.params, \n            // only keep params that exist in the resolved location\n            // only keep optional params coming from a parent record\n            matcher.keys\n                .filter(k => !k.optional)\n                .concat(matcher.parent ? matcher.parent.keys.filter(k => k.optional) : [])\n                .map(k => k.name)), \n            // discard any existing params in the current location that do not exist here\n            // #1497 this ensures better active/exact matching\n            location.params &&\n                paramsFromLocation(location.params, matcher.keys.map(k => k.name)));\n            // throws if cannot be stringified\n            path = matcher.stringify(params);\n        }\n        else if (location.path != null) {\n            // no need to resolve the path with the matcher as it was provided\n            // this also allows the user to control the encoding\n            path = location.path;\n            if ((process.env.NODE_ENV !== 'production') && !path.startsWith('/')) {\n                warn(`The Matcher cannot resolve relative paths but received \"${path}\". Unless you directly called \\`matcher.resolve(\"${path}\")\\`, this is probably a bug in vue-router. Please open an issue at https://github.com/vuejs/router/issues/new/choose.`);\n            }\n            matcher = matchers.find(m => m.re.test(path));\n            // matcher should have a value after the loop\n            if (matcher) {\n                // we know the matcher works because we tested the regexp\n                params = matcher.parse(path);\n                name = matcher.record.name;\n            }\n            // location is a relative path\n        }\n        else {\n            // match by name or path of current route\n            matcher = currentLocation.name\n                ? matcherMap.get(currentLocation.name)\n                : matchers.find(m => m.re.test(currentLocation.path));\n            if (!matcher)\n                throw createRouterError(1 /* ErrorTypes.MATCHER_NOT_FOUND */, {\n                    location,\n                    currentLocation,\n                });\n            name = matcher.record.name;\n            // since we are navigating to the same location, we don't need to pick the\n            // params like when `name` is provided\n            params = assign({}, currentLocation.params, location.params);\n            path = matcher.stringify(params);\n        }\n        const matched = [];\n        let parentMatcher = matcher;\n        while (parentMatcher) {\n            // reversed order so parents are at the beginning\n            matched.unshift(parentMatcher.record);\n            parentMatcher = parentMatcher.parent;\n        }\n        return {\n            name,\n            path,\n            params,\n            matched,\n            meta: mergeMetaFields(matched),\n        };\n    }\n    // add initial routes\n    routes.forEach(route => addRoute(route));\n    function clearRoutes() {\n        matchers.length = 0;\n        matcherMap.clear();\n    }\n    return {\n        addRoute,\n        resolve,\n        removeRoute,\n        clearRoutes,\n        getRoutes,\n        getRecordMatcher,\n    };\n}\nfunction paramsFromLocation(params, keys) {\n    const newParams = {};\n    for (const key of keys) {\n        if (key in params)\n            newParams[key] = params[key];\n    }\n    return newParams;\n}\n/**\n * Normalizes a RouteRecordRaw. Creates a copy\n *\n * @param record\n * @returns the normalized version\n */\nfunction normalizeRouteRecord(record) {\n    const normalized = {\n        path: record.path,\n        redirect: record.redirect,\n        name: record.name,\n        meta: record.meta || {},\n        aliasOf: record.aliasOf,\n        beforeEnter: record.beforeEnter,\n        props: normalizeRecordProps(record),\n        children: record.children || [],\n        instances: {},\n        leaveGuards: new Set(),\n        updateGuards: new Set(),\n        enterCallbacks: {},\n        // must be declared afterwards\n        // mods: {},\n        components: 'components' in record\n            ? record.components || null\n            : record.component && { default: record.component },\n    };\n    // mods contain modules and shouldn't be copied,\n    // logged or anything. It's just used for internal\n    // advanced use cases like data loaders\n    Object.defineProperty(normalized, 'mods', {\n        value: {},\n    });\n    return normalized;\n}\n/**\n * Normalize the optional `props` in a record to always be an object similar to\n * components. Also accept a boolean for components.\n * @param record\n */\nfunction normalizeRecordProps(record) {\n    const propsObject = {};\n    // props does not exist on redirect records, but we can set false directly\n    const props = record.props || false;\n    if ('component' in record) {\n        propsObject.default = props;\n    }\n    else {\n        // NOTE: we could also allow a function to be applied to every component.\n        // Would need user feedback for use cases\n        for (const name in record.components)\n            propsObject[name] = typeof props === 'object' ? props[name] : props;\n    }\n    return propsObject;\n}\n/**\n * Checks if a record or any of its parent is an alias\n * @param record\n */\nfunction isAliasRecord(record) {\n    while (record) {\n        if (record.record.aliasOf)\n            return true;\n        record = record.parent;\n    }\n    return false;\n}\n/**\n * Merge meta fields of an array of records\n *\n * @param matched - array of matched records\n */\nfunction mergeMetaFields(matched) {\n    return matched.reduce((meta, record) => assign(meta, record.meta), {});\n}\nfunction mergeOptions(defaults, partialOptions) {\n    const options = {};\n    for (const key in defaults) {\n        options[key] = key in partialOptions ? partialOptions[key] : defaults[key];\n    }\n    return options;\n}\nfunction isSameParam(a, b) {\n    return (a.name === b.name &&\n        a.optional === b.optional &&\n        a.repeatable === b.repeatable);\n}\n/**\n * Check if a path and its alias have the same required params\n *\n * @param a - original record\n * @param b - alias record\n */\nfunction checkSameParams(a, b) {\n    for (const key of a.keys) {\n        if (!key.optional && !b.keys.find(isSameParam.bind(null, key)))\n            return warn(`Alias \"${b.record.path}\" and the original record: \"${a.record.path}\" must have the exact same param named \"${key.name}\"`);\n    }\n    for (const key of b.keys) {\n        if (!key.optional && !a.keys.find(isSameParam.bind(null, key)))\n            return warn(`Alias \"${b.record.path}\" and the original record: \"${a.record.path}\" must have the exact same param named \"${key.name}\"`);\n    }\n}\n/**\n * A route with a name and a child with an empty path without a name should warn when adding the route\n *\n * @param mainNormalizedRecord - RouteRecordNormalized\n * @param parent - RouteRecordMatcher\n */\nfunction checkChildMissingNameWithEmptyPath(mainNormalizedRecord, parent) {\n    if (parent &&\n        parent.record.name &&\n        !mainNormalizedRecord.name &&\n        !mainNormalizedRecord.path) {\n        warn(`The route named \"${String(parent.record.name)}\" has a child without a name and an empty path. Using that name won't render the empty path child so you probably want to move the name to the child instead. If this is intentional, add a name to the child route to remove the warning.`);\n    }\n}\nfunction checkSameNameAsAncestor(record, parent) {\n    for (let ancestor = parent; ancestor; ancestor = ancestor.parent) {\n        if (ancestor.record.name === record.name) {\n            throw new Error(`A route named \"${String(record.name)}\" has been added as a ${parent === ancestor ? 'child' : 'descendant'} of a route with the same name. Route names must be unique and a nested route cannot use the same name as an ancestor.`);\n        }\n    }\n}\nfunction checkMissingParamsInAbsolutePath(record, parent) {\n    for (const key of parent.keys) {\n        if (!record.keys.find(isSameParam.bind(null, key)))\n            return warn(`Absolute path \"${record.record.path}\" must have the exact same param named \"${key.name}\" as its parent \"${parent.record.path}\".`);\n    }\n}\n/**\n * Performs a binary search to find the correct insertion index for a new matcher.\n *\n * Matchers are primarily sorted by their score. If scores are tied then we also consider parent/child relationships,\n * with descendants coming before ancestors. If there's still a tie, new routes are inserted after existing routes.\n *\n * @param matcher - new matcher to be inserted\n * @param matchers - existing matchers\n */\nfunction findInsertionIndex(matcher, matchers) {\n    // First phase: binary search based on score\n    let lower = 0;\n    let upper = matchers.length;\n    while (lower !== upper) {\n        const mid = (lower + upper) >> 1;\n        const sortOrder = comparePathParserScore(matcher, matchers[mid]);\n        if (sortOrder < 0) {\n            upper = mid;\n        }\n        else {\n            lower = mid + 1;\n        }\n    }\n    // Second phase: check for an ancestor with the same score\n    const insertionAncestor = getInsertionAncestor(matcher);\n    if (insertionAncestor) {\n        upper = matchers.lastIndexOf(insertionAncestor, upper - 1);\n        if ((process.env.NODE_ENV !== 'production') && upper < 0) {\n            // This should never happen\n            warn(`Finding ancestor route \"${insertionAncestor.record.path}\" failed for \"${matcher.record.path}\"`);\n        }\n    }\n    return upper;\n}\nfunction getInsertionAncestor(matcher) {\n    let ancestor = matcher;\n    while ((ancestor = ancestor.parent)) {\n        if (isMatchable(ancestor) &&\n            comparePathParserScore(matcher, ancestor) === 0) {\n            return ancestor;\n        }\n    }\n    return;\n}\n/**\n * Checks if a matcher can be reachable. This means if it's possible to reach it as a route. For example, routes without\n * a component, or name, or redirect, are just used to group other routes.\n * @param matcher\n * @param matcher.record record of the matcher\n * @returns\n */\nfunction isMatchable({ record }) {\n    return !!(record.name ||\n        (record.components && Object.keys(record.components).length) ||\n        record.redirect);\n}\n\n/**\n * Transforms a queryString into a {@link LocationQuery} object. Accept both, a\n * version with the leading `?` and without Should work as URLSearchParams\n\n * @internal\n *\n * @param search - search string to parse\n * @returns a query object\n */\nfunction parseQuery(search) {\n    const query = {};\n    // avoid creating an object with an empty key and empty value\n    // because of split('&')\n    if (search === '' || search === '?')\n        return query;\n    const hasLeadingIM = search[0] === '?';\n    const searchParams = (hasLeadingIM ? search.slice(1) : search).split('&');\n    for (let i = 0; i < searchParams.length; ++i) {\n        // pre decode the + into space\n        const searchParam = searchParams[i].replace(PLUS_RE, ' ');\n        // allow the = character\n        const eqPos = searchParam.indexOf('=');\n        const key = decode(eqPos < 0 ? searchParam : searchParam.slice(0, eqPos));\n        const value = eqPos < 0 ? null : decode(searchParam.slice(eqPos + 1));\n        if (key in query) {\n            // an extra variable for ts types\n            let currentValue = query[key];\n            if (!isArray(currentValue)) {\n                currentValue = query[key] = [currentValue];\n            }\n            currentValue.push(value);\n        }\n        else {\n            query[key] = value;\n        }\n    }\n    return query;\n}\n/**\n * Stringifies a {@link LocationQueryRaw} object. Like `URLSearchParams`, it\n * doesn't prepend a `?`\n *\n * @internal\n *\n * @param query - query object to stringify\n * @returns string version of the query without the leading `?`\n */\nfunction stringifyQuery(query) {\n    let search = '';\n    for (let key in query) {\n        const value = query[key];\n        key = encodeQueryKey(key);\n        if (value == null) {\n            // only null adds the value\n            if (value !== undefined) {\n                search += (search.length ? '&' : '') + key;\n            }\n            continue;\n        }\n        // keep null values\n        const values = isArray(value)\n            ? value.map(v => v && encodeQueryValue(v))\n            : [value && encodeQueryValue(value)];\n        values.forEach(value => {\n            // skip undefined values in arrays as if they were not present\n            // smaller code than using filter\n            if (value !== undefined) {\n                // only append & with non-empty search\n                search += (search.length ? '&' : '') + key;\n                if (value != null)\n                    search += '=' + value;\n            }\n        });\n    }\n    return search;\n}\n/**\n * Transforms a {@link LocationQueryRaw} into a {@link LocationQuery} by casting\n * numbers into strings, removing keys with an undefined value and replacing\n * undefined with null in arrays\n *\n * @param query - query object to normalize\n * @returns a normalized query object\n */\nfunction normalizeQuery(query) {\n    const normalizedQuery = {};\n    for (const key in query) {\n        const value = query[key];\n        if (value !== undefined) {\n            normalizedQuery[key] = isArray(value)\n                ? value.map(v => (v == null ? null : '' + v))\n                : value == null\n                    ? value\n                    : '' + value;\n        }\n    }\n    return normalizedQuery;\n}\n\n/**\n * RouteRecord being rendered by the closest ancestor Router View. Used for\n * `onBeforeRouteUpdate` and `onBeforeRouteLeave`. rvlm stands for Router View\n * Location Matched\n *\n * @internal\n */\nconst matchedRouteKey = Symbol((process.env.NODE_ENV !== 'production') ? 'router view location matched' : '');\n/**\n * Allows overriding the router view depth to control which component in\n * `matched` is rendered. rvd stands for Router View Depth\n *\n * @internal\n */\nconst viewDepthKey = Symbol((process.env.NODE_ENV !== 'production') ? 'router view depth' : '');\n/**\n * Allows overriding the router instance returned by `useRouter` in tests. r\n * stands for router\n *\n * @internal\n */\nconst routerKey = Symbol((process.env.NODE_ENV !== 'production') ? 'router' : '');\n/**\n * Allows overriding the current route returned by `useRoute` in tests. rl\n * stands for route location\n *\n * @internal\n */\nconst routeLocationKey = Symbol((process.env.NODE_ENV !== 'production') ? 'route location' : '');\n/**\n * Allows overriding the current route used by router-view. Internally this is\n * used when the `route` prop is passed.\n *\n * @internal\n */\nconst routerViewLocationKey = Symbol((process.env.NODE_ENV !== 'production') ? 'router view location' : '');\n\n/**\n * Create a list of callbacks that can be reset. Used to create before and after navigation guards list\n */\nfunction useCallbacks() {\n    let handlers = [];\n    function add(handler) {\n        handlers.push(handler);\n        return () => {\n            const i = handlers.indexOf(handler);\n            if (i > -1)\n                handlers.splice(i, 1);\n        };\n    }\n    function reset() {\n        handlers = [];\n    }\n    return {\n        add,\n        list: () => handlers.slice(),\n        reset,\n    };\n}\n\nfunction registerGuard(record, name, guard) {\n    const removeFromList = () => {\n        record[name].delete(guard);\n    };\n    onUnmounted(removeFromList);\n    onDeactivated(removeFromList);\n    onActivated(() => {\n        record[name].add(guard);\n    });\n    record[name].add(guard);\n}\n/**\n * Add a navigation guard that triggers whenever the component for the current\n * location is about to be left. Similar to {@link beforeRouteLeave} but can be\n * used in any component. The guard is removed when the component is unmounted.\n *\n * @param leaveGuard - {@link NavigationGuard}\n */\nfunction onBeforeRouteLeave(leaveGuard) {\n    if ((process.env.NODE_ENV !== 'production') && !getCurrentInstance()) {\n        warn('getCurrentInstance() returned null. onBeforeRouteLeave() must be called at the top of a setup function');\n        return;\n    }\n    const activeRecord = inject(matchedRouteKey, \n    // to avoid warning\n    {}).value;\n    if (!activeRecord) {\n        (process.env.NODE_ENV !== 'production') &&\n            warn('No active route record was found when calling `onBeforeRouteLeave()`. Make sure you call this function inside a component child of <router-view>. Maybe you called it inside of App.vue?');\n        return;\n    }\n    registerGuard(activeRecord, 'leaveGuards', leaveGuard);\n}\n/**\n * Add a navigation guard that triggers whenever the current location is about\n * to be updated. Similar to {@link beforeRouteUpdate} but can be used in any\n * component. The guard is removed when the component is unmounted.\n *\n * @param updateGuard - {@link NavigationGuard}\n */\nfunction onBeforeRouteUpdate(updateGuard) {\n    if ((process.env.NODE_ENV !== 'production') && !getCurrentInstance()) {\n        warn('getCurrentInstance() returned null. onBeforeRouteUpdate() must be called at the top of a setup function');\n        return;\n    }\n    const activeRecord = inject(matchedRouteKey, \n    // to avoid warning\n    {}).value;\n    if (!activeRecord) {\n        (process.env.NODE_ENV !== 'production') &&\n            warn('No active route record was found when calling `onBeforeRouteUpdate()`. Make sure you call this function inside a component child of <router-view>. Maybe you called it inside of App.vue?');\n        return;\n    }\n    registerGuard(activeRecord, 'updateGuards', updateGuard);\n}\nfunction guardToPromiseFn(guard, to, from, record, name, runWithContext = fn => fn()) {\n    // keep a reference to the enterCallbackArray to prevent pushing callbacks if a new navigation took place\n    const enterCallbackArray = record &&\n        // name is defined if record is because of the function overload\n        (record.enterCallbacks[name] = record.enterCallbacks[name] || []);\n    return () => new Promise((resolve, reject) => {\n        const next = (valid) => {\n            if (valid === false) {\n                reject(createRouterError(4 /* ErrorTypes.NAVIGATION_ABORTED */, {\n                    from,\n                    to,\n                }));\n            }\n            else if (valid instanceof Error) {\n                reject(valid);\n            }\n            else if (isRouteLocation(valid)) {\n                reject(createRouterError(2 /* ErrorTypes.NAVIGATION_GUARD_REDIRECT */, {\n                    from: to,\n                    to: valid,\n                }));\n            }\n            else {\n                if (enterCallbackArray &&\n                    // since enterCallbackArray is truthy, both record and name also are\n                    record.enterCallbacks[name] === enterCallbackArray &&\n                    typeof valid === 'function') {\n                    enterCallbackArray.push(valid);\n                }\n                resolve();\n            }\n        };\n        // wrapping with Promise.resolve allows it to work with both async and sync guards\n        const guardReturn = runWithContext(() => guard.call(record && record.instances[name], to, from, (process.env.NODE_ENV !== 'production') ? canOnlyBeCalledOnce(next, to, from) : next));\n        let guardCall = Promise.resolve(guardReturn);\n        if (guard.length < 3)\n            guardCall = guardCall.then(next);\n        if ((process.env.NODE_ENV !== 'production') && guard.length > 2) {\n            const message = `The \"next\" callback was never called inside of ${guard.name ? '\"' + guard.name + '\"' : ''}:\\n${guard.toString()}\\n. If you are returning a value instead of calling \"next\", make sure to remove the \"next\" parameter from your function.`;\n            if (typeof guardReturn === 'object' && 'then' in guardReturn) {\n                guardCall = guardCall.then(resolvedValue => {\n                    // @ts-expect-error: _called is added at canOnlyBeCalledOnce\n                    if (!next._called) {\n                        warn(message);\n                        return Promise.reject(new Error('Invalid navigation guard'));\n                    }\n                    return resolvedValue;\n                });\n            }\n            else if (guardReturn !== undefined) {\n                // @ts-expect-error: _called is added at canOnlyBeCalledOnce\n                if (!next._called) {\n                    warn(message);\n                    reject(new Error('Invalid navigation guard'));\n                    return;\n                }\n            }\n        }\n        guardCall.catch(err => reject(err));\n    });\n}\nfunction canOnlyBeCalledOnce(next, to, from) {\n    let called = 0;\n    return function () {\n        if (called++ === 1)\n            warn(`The \"next\" callback was called more than once in one navigation guard when going from \"${from.fullPath}\" to \"${to.fullPath}\". It should be called exactly one time in each navigation guard. This will fail in production.`);\n        // @ts-expect-error: we put it in the original one because it's easier to check\n        next._called = true;\n        if (called === 1)\n            next.apply(null, arguments);\n    };\n}\nfunction extractComponentsGuards(matched, guardType, to, from, runWithContext = fn => fn()) {\n    const guards = [];\n    for (const record of matched) {\n        if ((process.env.NODE_ENV !== 'production') && !record.components && !record.children.length) {\n            warn(`Record with path \"${record.path}\" is either missing a \"component(s)\"` +\n                ` or \"children\" property.`);\n        }\n        for (const name in record.components) {\n            let rawComponent = record.components[name];\n            if ((process.env.NODE_ENV !== 'production')) {\n                if (!rawComponent ||\n                    (typeof rawComponent !== 'object' &&\n                        typeof rawComponent !== 'function')) {\n                    warn(`Component \"${name}\" in record with path \"${record.path}\" is not` +\n                        ` a valid component. Received \"${String(rawComponent)}\".`);\n                    // throw to ensure we stop here but warn to ensure the message isn't\n                    // missed by the user\n                    throw new Error('Invalid route component');\n                }\n                else if ('then' in rawComponent) {\n                    // warn if user wrote import('/component.vue') instead of () =>\n                    // import('./component.vue')\n                    warn(`Component \"${name}\" in record with path \"${record.path}\" is a ` +\n                        `Promise instead of a function that returns a Promise. Did you ` +\n                        `write \"import('./MyPage.vue')\" instead of ` +\n                        `\"() => import('./MyPage.vue')\" ? This will break in ` +\n                        `production if not fixed.`);\n                    const promise = rawComponent;\n                    rawComponent = () => promise;\n                }\n                else if (rawComponent.__asyncLoader &&\n                    // warn only once per component\n                    !rawComponent.__warnedDefineAsync) {\n                    rawComponent.__warnedDefineAsync = true;\n                    warn(`Component \"${name}\" in record with path \"${record.path}\" is defined ` +\n                        `using \"defineAsyncComponent()\". ` +\n                        `Write \"() => import('./MyPage.vue')\" instead of ` +\n                        `\"defineAsyncComponent(() => import('./MyPage.vue'))\".`);\n                }\n            }\n            // skip update and leave guards if the route component is not mounted\n            if (guardType !== 'beforeRouteEnter' && !record.instances[name])\n                continue;\n            if (isRouteComponent(rawComponent)) {\n                // __vccOpts is added by vue-class-component and contain the regular options\n                const options = rawComponent.__vccOpts || rawComponent;\n                const guard = options[guardType];\n                guard &&\n                    guards.push(guardToPromiseFn(guard, to, from, record, name, runWithContext));\n            }\n            else {\n                // start requesting the chunk already\n                let componentPromise = rawComponent();\n                if ((process.env.NODE_ENV !== 'production') && !('catch' in componentPromise)) {\n                    warn(`Component \"${name}\" in record with path \"${record.path}\" is a function that does not return a Promise. If you were passing a functional component, make sure to add a \"displayName\" to the component. This will break in production if not fixed.`);\n                    componentPromise = Promise.resolve(componentPromise);\n                }\n                guards.push(() => componentPromise.then(resolved => {\n                    if (!resolved)\n                        throw new Error(`Couldn't resolve component \"${name}\" at \"${record.path}\"`);\n                    const resolvedComponent = isESModule(resolved)\n                        ? resolved.default\n                        : resolved;\n                    // keep the resolved module for plugins like data loaders\n                    record.mods[name] = resolved;\n                    // replace the function with the resolved component\n                    // cannot be null or undefined because we went into the for loop\n                    record.components[name] = resolvedComponent;\n                    // __vccOpts is added by vue-class-component and contain the regular options\n                    const options = resolvedComponent.__vccOpts || resolvedComponent;\n                    const guard = options[guardType];\n                    return (guard &&\n                        guardToPromiseFn(guard, to, from, record, name, runWithContext)());\n                }));\n            }\n        }\n    }\n    return guards;\n}\n/**\n * Ensures a route is loaded, so it can be passed as o prop to `<RouterView>`.\n *\n * @param route - resolved route to load\n */\nfunction loadRouteLocation(route) {\n    return route.matched.every(record => record.redirect)\n        ? Promise.reject(new Error('Cannot load a route that redirects.'))\n        : Promise.all(route.matched.map(record => record.components &&\n            Promise.all(Object.keys(record.components).reduce((promises, name) => {\n                const rawComponent = record.components[name];\n                if (typeof rawComponent === 'function' &&\n                    !('displayName' in rawComponent)) {\n                    promises.push(rawComponent().then(resolved => {\n                        if (!resolved)\n                            return Promise.reject(new Error(`Couldn't resolve component \"${name}\" at \"${record.path}\". Ensure you passed a function that returns a promise.`));\n                        const resolvedComponent = isESModule(resolved)\n                            ? resolved.default\n                            : resolved;\n                        // keep the resolved module for plugins like data loaders\n                        record.mods[name] = resolved;\n                        // replace the function with the resolved component\n                        // cannot be null or undefined because we went into the for loop\n                        record.components[name] = resolvedComponent;\n                        return;\n                    }));\n                }\n                return promises;\n            }, [])))).then(() => route);\n}\n\n// TODO: we could allow currentRoute as a prop to expose `isActive` and\n// `isExactActive` behavior should go through an RFC\n/**\n * Returns the internal behavior of a {@link RouterLink} without the rendering part.\n *\n * @param props - a `to` location and an optional `replace` flag\n */\nfunction useLink(props) {\n    const router = inject(routerKey);\n    const currentRoute = inject(routeLocationKey);\n    let hasPrevious = false;\n    let previousTo = null;\n    const route = computed(() => {\n        const to = unref(props.to);\n        if ((process.env.NODE_ENV !== 'production') && (!hasPrevious || to !== previousTo)) {\n            if (!isRouteLocation(to)) {\n                if (hasPrevious) {\n                    warn(`Invalid value for prop \"to\" in useLink()\\n- to:`, to, `\\n- previous to:`, previousTo, `\\n- props:`, props);\n                }\n                else {\n                    warn(`Invalid value for prop \"to\" in useLink()\\n- to:`, to, `\\n- props:`, props);\n                }\n            }\n            previousTo = to;\n            hasPrevious = true;\n        }\n        return router.resolve(to);\n    });\n    const activeRecordIndex = computed(() => {\n        const { matched } = route.value;\n        const { length } = matched;\n        const routeMatched = matched[length - 1];\n        const currentMatched = currentRoute.matched;\n        if (!routeMatched || !currentMatched.length)\n            return -1;\n        const index = currentMatched.findIndex(isSameRouteRecord.bind(null, routeMatched));\n        if (index > -1)\n            return index;\n        // possible parent record\n        const parentRecordPath = getOriginalPath(matched[length - 2]);\n        return (\n        // we are dealing with nested routes\n        length > 1 &&\n            // if the parent and matched route have the same path, this link is\n            // referring to the empty child. Or we currently are on a different\n            // child of the same parent\n            getOriginalPath(routeMatched) === parentRecordPath &&\n            // avoid comparing the child with its parent\n            currentMatched[currentMatched.length - 1].path !== parentRecordPath\n            ? currentMatched.findIndex(isSameRouteRecord.bind(null, matched[length - 2]))\n            : index);\n    });\n    const isActive = computed(() => activeRecordIndex.value > -1 &&\n        includesParams(currentRoute.params, route.value.params));\n    const isExactActive = computed(() => activeRecordIndex.value > -1 &&\n        activeRecordIndex.value === currentRoute.matched.length - 1 &&\n        isSameRouteLocationParams(currentRoute.params, route.value.params));\n    function navigate(e = {}) {\n        if (guardEvent(e)) {\n            const p = router[unref(props.replace) ? 'replace' : 'push'](unref(props.to)\n            // avoid uncaught errors are they are logged anyway\n            ).catch(noop);\n            if (props.viewTransition &&\n                typeof document !== 'undefined' &&\n                'startViewTransition' in document) {\n                document.startViewTransition(() => p);\n            }\n            return p;\n        }\n        return Promise.resolve();\n    }\n    // devtools only\n    if (((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) && isBrowser) {\n        const instance = getCurrentInstance();\n        if (instance) {\n            const linkContextDevtools = {\n                route: route.value,\n                isActive: isActive.value,\n                isExactActive: isExactActive.value,\n                error: null,\n            };\n            // @ts-expect-error: this is internal\n            instance.__vrl_devtools = instance.__vrl_devtools || [];\n            // @ts-expect-error: this is internal\n            instance.__vrl_devtools.push(linkContextDevtools);\n            watchEffect(() => {\n                linkContextDevtools.route = route.value;\n                linkContextDevtools.isActive = isActive.value;\n                linkContextDevtools.isExactActive = isExactActive.value;\n                linkContextDevtools.error = isRouteLocation(unref(props.to))\n                    ? null\n                    : 'Invalid \"to\" value';\n            }, { flush: 'post' });\n        }\n    }\n    /**\n     * NOTE: update {@link _RouterLinkI}'s `$slots` type when updating this\n     */\n    return {\n        route,\n        href: computed(() => route.value.href),\n        isActive,\n        isExactActive,\n        navigate,\n    };\n}\nfunction preferSingleVNode(vnodes) {\n    return vnodes.length === 1 ? vnodes[0] : vnodes;\n}\nconst RouterLinkImpl = /*#__PURE__*/ defineComponent({\n    name: 'RouterLink',\n    compatConfig: { MODE: 3 },\n    props: {\n        to: {\n            type: [String, Object],\n            required: true,\n        },\n        replace: Boolean,\n        activeClass: String,\n        // inactiveClass: String,\n        exactActiveClass: String,\n        custom: Boolean,\n        ariaCurrentValue: {\n            type: String,\n            default: 'page',\n        },\n    },\n    useLink,\n    setup(props, { slots }) {\n        const link = reactive(useLink(props));\n        const { options } = inject(routerKey);\n        const elClass = computed(() => ({\n            [getLinkClass(props.activeClass, options.linkActiveClass, 'router-link-active')]: link.isActive,\n            // [getLinkClass(\n            //   props.inactiveClass,\n            //   options.linkInactiveClass,\n            //   'router-link-inactive'\n            // )]: !link.isExactActive,\n            [getLinkClass(props.exactActiveClass, options.linkExactActiveClass, 'router-link-exact-active')]: link.isExactActive,\n        }));\n        return () => {\n            const children = slots.default && preferSingleVNode(slots.default(link));\n            return props.custom\n                ? children\n                : h('a', {\n                    'aria-current': link.isExactActive\n                        ? props.ariaCurrentValue\n                        : null,\n                    href: link.href,\n                    // this would override user added attrs but Vue will still add\n                    // the listener, so we end up triggering both\n                    onClick: link.navigate,\n                    class: elClass.value,\n                }, children);\n        };\n    },\n});\n// export the public type for h/tsx inference\n// also to avoid inline import() in generated d.ts files\n/**\n * Component to render a link that triggers a navigation on click.\n */\nconst RouterLink = RouterLinkImpl;\nfunction guardEvent(e) {\n    // don't redirect with control keys\n    if (e.metaKey || e.altKey || e.ctrlKey || e.shiftKey)\n        return;\n    // don't redirect when preventDefault called\n    if (e.defaultPrevented)\n        return;\n    // don't redirect on right click\n    if (e.button !== undefined && e.button !== 0)\n        return;\n    // don't redirect if `target=\"_blank\"`\n    // @ts-expect-error getAttribute does exist\n    if (e.currentTarget && e.currentTarget.getAttribute) {\n        // @ts-expect-error getAttribute exists\n        const target = e.currentTarget.getAttribute('target');\n        if (/\\b_blank\\b/i.test(target))\n            return;\n    }\n    // this may be a Weex event which doesn't have this method\n    if (e.preventDefault)\n        e.preventDefault();\n    return true;\n}\nfunction includesParams(outer, inner) {\n    for (const key in inner) {\n        const innerValue = inner[key];\n        const outerValue = outer[key];\n        if (typeof innerValue === 'string') {\n            if (innerValue !== outerValue)\n                return false;\n        }\n        else {\n            if (!isArray(outerValue) ||\n                outerValue.length !== innerValue.length ||\n                innerValue.some((value, i) => value !== outerValue[i]))\n                return false;\n        }\n    }\n    return true;\n}\n/**\n * Get the original path value of a record by following its aliasOf\n * @param record\n */\nfunction getOriginalPath(record) {\n    return record ? (record.aliasOf ? record.aliasOf.path : record.path) : '';\n}\n/**\n * Utility class to get the active class based on defaults.\n * @param propClass\n * @param globalClass\n * @param defaultClass\n */\nconst getLinkClass = (propClass, globalClass, defaultClass) => propClass != null\n    ? propClass\n    : globalClass != null\n        ? globalClass\n        : defaultClass;\n\nconst RouterViewImpl = /*#__PURE__*/ defineComponent({\n    name: 'RouterView',\n    // #674 we manually inherit them\n    inheritAttrs: false,\n    props: {\n        name: {\n            type: String,\n            default: 'default',\n        },\n        route: Object,\n    },\n    // Better compat for @vue/compat users\n    // https://github.com/vuejs/router/issues/1315\n    compatConfig: { MODE: 3 },\n    setup(props, { attrs, slots }) {\n        (process.env.NODE_ENV !== 'production') && warnDeprecatedUsage();\n        const injectedRoute = inject(routerViewLocationKey);\n        const routeToDisplay = computed(() => props.route || injectedRoute.value);\n        const injectedDepth = inject(viewDepthKey, 0);\n        // The depth changes based on empty components option, which allows passthrough routes e.g. routes with children\n        // that are used to reuse the `path` property\n        const depth = computed(() => {\n            let initialDepth = unref(injectedDepth);\n            const { matched } = routeToDisplay.value;\n            let matchedRoute;\n            while ((matchedRoute = matched[initialDepth]) &&\n                !matchedRoute.components) {\n                initialDepth++;\n            }\n            return initialDepth;\n        });\n        const matchedRouteRef = computed(() => routeToDisplay.value.matched[depth.value]);\n        provide(viewDepthKey, computed(() => depth.value + 1));\n        provide(matchedRouteKey, matchedRouteRef);\n        provide(routerViewLocationKey, routeToDisplay);\n        const viewRef = ref();\n        // watch at the same time the component instance, the route record we are\n        // rendering, and the name\n        watch(() => [viewRef.value, matchedRouteRef.value, props.name], ([instance, to, name], [oldInstance, from, oldName]) => {\n            // copy reused instances\n            if (to) {\n                // this will update the instance for new instances as well as reused\n                // instances when navigating to a new route\n                to.instances[name] = instance;\n                // the component instance is reused for a different route or name, so\n                // we copy any saved update or leave guards. With async setup, the\n                // mounting component will mount before the matchedRoute changes,\n                // making instance === oldInstance, so we check if guards have been\n                // added before. This works because we remove guards when\n                // unmounting/deactivating components\n                if (from && from !== to && instance && instance === oldInstance) {\n                    if (!to.leaveGuards.size) {\n                        to.leaveGuards = from.leaveGuards;\n                    }\n                    if (!to.updateGuards.size) {\n                        to.updateGuards = from.updateGuards;\n                    }\n                }\n            }\n            // trigger beforeRouteEnter next callbacks\n            if (instance &&\n                to &&\n                // if there is no instance but to and from are the same this might be\n                // the first visit\n                (!from || !isSameRouteRecord(to, from) || !oldInstance)) {\n                (to.enterCallbacks[name] || []).forEach(callback => callback(instance));\n            }\n        }, { flush: 'post' });\n        return () => {\n            const route = routeToDisplay.value;\n            // we need the value at the time we render because when we unmount, we\n            // navigated to a different location so the value is different\n            const currentName = props.name;\n            const matchedRoute = matchedRouteRef.value;\n            const ViewComponent = matchedRoute && matchedRoute.components[currentName];\n            if (!ViewComponent) {\n                return normalizeSlot(slots.default, { Component: ViewComponent, route });\n            }\n            // props from route configuration\n            const routePropsOption = matchedRoute.props[currentName];\n            const routeProps = routePropsOption\n                ? routePropsOption === true\n                    ? route.params\n                    : typeof routePropsOption === 'function'\n                        ? routePropsOption(route)\n                        : routePropsOption\n                : null;\n            const onVnodeUnmounted = vnode => {\n                // remove the instance reference to prevent leak\n                if (vnode.component.isUnmounted) {\n                    matchedRoute.instances[currentName] = null;\n                }\n            };\n            const component = h(ViewComponent, assign({}, routeProps, attrs, {\n                onVnodeUnmounted,\n                ref: viewRef,\n            }));\n            if (((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) &&\n                isBrowser &&\n                component.ref) {\n                // TODO: can display if it's an alias, its props\n                const info = {\n                    depth: depth.value,\n                    name: matchedRoute.name,\n                    path: matchedRoute.path,\n                    meta: matchedRoute.meta,\n                };\n                const internalInstances = isArray(component.ref)\n                    ? component.ref.map(r => r.i)\n                    : [component.ref.i];\n                internalInstances.forEach(instance => {\n                    // @ts-expect-error\n                    instance.__vrv_devtools = info;\n                });\n            }\n            return (\n            // pass the vnode to the slot as a prop.\n            // h and <component :is=\"...\"> both accept vnodes\n            normalizeSlot(slots.default, { Component: component, route }) ||\n                component);\n        };\n    },\n});\nfunction normalizeSlot(slot, data) {\n    if (!slot)\n        return null;\n    const slotContent = slot(data);\n    return slotContent.length === 1 ? slotContent[0] : slotContent;\n}\n// export the public type for h/tsx inference\n// also to avoid inline import() in generated d.ts files\n/**\n * Component to display the current route the user is at.\n */\nconst RouterView = RouterViewImpl;\n// warn against deprecated usage with <transition> & <keep-alive>\n// due to functional component being no longer eager in Vue 3\nfunction warnDeprecatedUsage() {\n    const instance = getCurrentInstance();\n    const parentName = instance.parent && instance.parent.type.name;\n    const parentSubTreeType = instance.parent && instance.parent.subTree && instance.parent.subTree.type;\n    if (parentName &&\n        (parentName === 'KeepAlive' || parentName.includes('Transition')) &&\n        typeof parentSubTreeType === 'object' &&\n        parentSubTreeType.name === 'RouterView') {\n        const comp = parentName === 'KeepAlive' ? 'keep-alive' : 'transition';\n        warn(`<router-view> can no longer be used directly inside <transition> or <keep-alive>.\\n` +\n            `Use slot props instead:\\n\\n` +\n            `<router-view v-slot=\"{ Component }\">\\n` +\n            `  <${comp}>\\n` +\n            `    <component :is=\"Component\" />\\n` +\n            `  </${comp}>\\n` +\n            `</router-view>`);\n    }\n}\n\n/**\n * Copies a route location and removes any problematic properties that cannot be shown in devtools (e.g. Vue instances).\n *\n * @param routeLocation - routeLocation to format\n * @param tooltip - optional tooltip\n * @returns a copy of the routeLocation\n */\nfunction formatRouteLocation(routeLocation, tooltip) {\n    const copy = assign({}, routeLocation, {\n        // remove variables that can contain vue instances\n        matched: routeLocation.matched.map(matched => omit(matched, ['instances', 'children', 'aliasOf'])),\n    });\n    return {\n        _custom: {\n            type: null,\n            readOnly: true,\n            display: routeLocation.fullPath,\n            tooltip,\n            value: copy,\n        },\n    };\n}\nfunction formatDisplay(display) {\n    return {\n        _custom: {\n            display,\n        },\n    };\n}\n// to support multiple router instances\nlet routerId = 0;\nfunction addDevtools(app, router, matcher) {\n    // Take over router.beforeEach and afterEach\n    // make sure we are not registering the devtool twice\n    if (router.__hasDevtools)\n        return;\n    router.__hasDevtools = true;\n    // increment to support multiple router instances\n    const id = routerId++;\n    setupDevtoolsPlugin({\n        id: 'org.vuejs.router' + (id ? '.' + id : ''),\n        label: 'Vue Router',\n        packageName: 'vue-router',\n        homepage: 'https://router.vuejs.org',\n        logo: 'https://router.vuejs.org/logo.png',\n        componentStateTypes: ['Routing'],\n        app,\n    }, api => {\n        if (typeof api.now !== 'function') {\n            console.warn('[Vue Router]: You seem to be using an outdated version of Vue Devtools. Are you still using the Beta release instead of the stable one? You can find the links at https://devtools.vuejs.org/guide/installation.html.');\n        }\n        // display state added by the router\n        api.on.inspectComponent((payload, ctx) => {\n            if (payload.instanceData) {\n                payload.instanceData.state.push({\n                    type: 'Routing',\n                    key: '$route',\n                    editable: false,\n                    value: formatRouteLocation(router.currentRoute.value, 'Current Route'),\n                });\n            }\n        });\n        // mark router-link as active and display tags on router views\n        api.on.visitComponentTree(({ treeNode: node, componentInstance }) => {\n            if (componentInstance.__vrv_devtools) {\n                const info = componentInstance.__vrv_devtools;\n                node.tags.push({\n                    label: (info.name ? `${info.name.toString()}: ` : '') + info.path,\n                    textColor: 0,\n                    tooltip: 'This component is rendered by &lt;router-view&gt;',\n                    backgroundColor: PINK_500,\n                });\n            }\n            // if multiple useLink are used\n            if (isArray(componentInstance.__vrl_devtools)) {\n                componentInstance.__devtoolsApi = api;\n                componentInstance.__vrl_devtools.forEach(devtoolsData => {\n                    let label = devtoolsData.route.path;\n                    let backgroundColor = ORANGE_400;\n                    let tooltip = '';\n                    let textColor = 0;\n                    if (devtoolsData.error) {\n                        label = devtoolsData.error;\n                        backgroundColor = RED_100;\n                        textColor = RED_700;\n                    }\n                    else if (devtoolsData.isExactActive) {\n                        backgroundColor = LIME_500;\n                        tooltip = 'This is exactly active';\n                    }\n                    else if (devtoolsData.isActive) {\n                        backgroundColor = BLUE_600;\n                        tooltip = 'This link is active';\n                    }\n                    node.tags.push({\n                        label,\n                        textColor,\n                        tooltip,\n                        backgroundColor,\n                    });\n                });\n            }\n        });\n        watch(router.currentRoute, () => {\n            // refresh active state\n            refreshRoutesView();\n            api.notifyComponentUpdate();\n            api.sendInspectorTree(routerInspectorId);\n            api.sendInspectorState(routerInspectorId);\n        });\n        const navigationsLayerId = 'router:navigations:' + id;\n        api.addTimelineLayer({\n            id: navigationsLayerId,\n            label: `Router${id ? ' ' + id : ''} Navigations`,\n            color: 0x40a8c4,\n        });\n        // const errorsLayerId = 'router:errors'\n        // api.addTimelineLayer({\n        //   id: errorsLayerId,\n        //   label: 'Router Errors',\n        //   color: 0xea5455,\n        // })\n        router.onError((error, to) => {\n            api.addTimelineEvent({\n                layerId: navigationsLayerId,\n                event: {\n                    title: 'Error during Navigation',\n                    subtitle: to.fullPath,\n                    logType: 'error',\n                    time: api.now(),\n                    data: { error },\n                    groupId: to.meta.__navigationId,\n                },\n            });\n        });\n        // attached to `meta` and used to group events\n        let navigationId = 0;\n        router.beforeEach((to, from) => {\n            const data = {\n                guard: formatDisplay('beforeEach'),\n                from: formatRouteLocation(from, 'Current Location during this navigation'),\n                to: formatRouteLocation(to, 'Target location'),\n            };\n            // Used to group navigations together, hide from devtools\n            Object.defineProperty(to.meta, '__navigationId', {\n                value: navigationId++,\n            });\n            api.addTimelineEvent({\n                layerId: navigationsLayerId,\n                event: {\n                    time: api.now(),\n                    title: 'Start of navigation',\n                    subtitle: to.fullPath,\n                    data,\n                    groupId: to.meta.__navigationId,\n                },\n            });\n        });\n        router.afterEach((to, from, failure) => {\n            const data = {\n                guard: formatDisplay('afterEach'),\n            };\n            if (failure) {\n                data.failure = {\n                    _custom: {\n                        type: Error,\n                        readOnly: true,\n                        display: failure ? failure.message : '',\n                        tooltip: 'Navigation Failure',\n                        value: failure,\n                    },\n                };\n                data.status = formatDisplay('❌');\n            }\n            else {\n                data.status = formatDisplay('✅');\n            }\n            // we set here to have the right order\n            data.from = formatRouteLocation(from, 'Current Location during this navigation');\n            data.to = formatRouteLocation(to, 'Target location');\n            api.addTimelineEvent({\n                layerId: navigationsLayerId,\n                event: {\n                    title: 'End of navigation',\n                    subtitle: to.fullPath,\n                    time: api.now(),\n                    data,\n                    logType: failure ? 'warning' : 'default',\n                    groupId: to.meta.__navigationId,\n                },\n            });\n        });\n        /**\n         * Inspector of Existing routes\n         */\n        const routerInspectorId = 'router-inspector:' + id;\n        api.addInspector({\n            id: routerInspectorId,\n            label: 'Routes' + (id ? ' ' + id : ''),\n            icon: 'book',\n            treeFilterPlaceholder: 'Search routes',\n        });\n        function refreshRoutesView() {\n            // the routes view isn't active\n            if (!activeRoutesPayload)\n                return;\n            const payload = activeRoutesPayload;\n            // children routes will appear as nested\n            let routes = matcher.getRoutes().filter(route => !route.parent ||\n                // these routes have a parent with no component which will not appear in the view\n                // therefore we still need to include them\n                !route.parent.record.components);\n            // reset match state to false\n            routes.forEach(resetMatchStateOnRouteRecord);\n            // apply a match state if there is a payload\n            if (payload.filter) {\n                routes = routes.filter(route => \n                // save matches state based on the payload\n                isRouteMatching(route, payload.filter.toLowerCase()));\n            }\n            // mark active routes\n            routes.forEach(route => markRouteRecordActive(route, router.currentRoute.value));\n            payload.rootNodes = routes.map(formatRouteRecordForInspector);\n        }\n        let activeRoutesPayload;\n        api.on.getInspectorTree(payload => {\n            activeRoutesPayload = payload;\n            if (payload.app === app && payload.inspectorId === routerInspectorId) {\n                refreshRoutesView();\n            }\n        });\n        /**\n         * Display information about the currently selected route record\n         */\n        api.on.getInspectorState(payload => {\n            if (payload.app === app && payload.inspectorId === routerInspectorId) {\n                const routes = matcher.getRoutes();\n                const route = routes.find(route => route.record.__vd_id === payload.nodeId);\n                if (route) {\n                    payload.state = {\n                        options: formatRouteRecordMatcherForStateInspector(route),\n                    };\n                }\n            }\n        });\n        api.sendInspectorTree(routerInspectorId);\n        api.sendInspectorState(routerInspectorId);\n    });\n}\nfunction modifierForKey(key) {\n    if (key.optional) {\n        return key.repeatable ? '*' : '?';\n    }\n    else {\n        return key.repeatable ? '+' : '';\n    }\n}\nfunction formatRouteRecordMatcherForStateInspector(route) {\n    const { record } = route;\n    const fields = [\n        { editable: false, key: 'path', value: record.path },\n    ];\n    if (record.name != null) {\n        fields.push({\n            editable: false,\n            key: 'name',\n            value: record.name,\n        });\n    }\n    fields.push({ editable: false, key: 'regexp', value: route.re });\n    if (route.keys.length) {\n        fields.push({\n            editable: false,\n            key: 'keys',\n            value: {\n                _custom: {\n                    type: null,\n                    readOnly: true,\n                    display: route.keys\n                        .map(key => `${key.name}${modifierForKey(key)}`)\n                        .join(' '),\n                    tooltip: 'Param keys',\n                    value: route.keys,\n                },\n            },\n        });\n    }\n    if (record.redirect != null) {\n        fields.push({\n            editable: false,\n            key: 'redirect',\n            value: record.redirect,\n        });\n    }\n    if (route.alias.length) {\n        fields.push({\n            editable: false,\n            key: 'aliases',\n            value: route.alias.map(alias => alias.record.path),\n        });\n    }\n    if (Object.keys(route.record.meta).length) {\n        fields.push({\n            editable: false,\n            key: 'meta',\n            value: route.record.meta,\n        });\n    }\n    fields.push({\n        key: 'score',\n        editable: false,\n        value: {\n            _custom: {\n                type: null,\n                readOnly: true,\n                display: route.score.map(score => score.join(', ')).join(' | '),\n                tooltip: 'Score used to sort routes',\n                value: route.score,\n            },\n        },\n    });\n    return fields;\n}\n/**\n * Extracted from tailwind palette\n */\nconst PINK_500 = 0xec4899;\nconst BLUE_600 = 0x2563eb;\nconst LIME_500 = 0x84cc16;\nconst CYAN_400 = 0x22d3ee;\nconst ORANGE_400 = 0xfb923c;\n// const GRAY_100 = 0xf4f4f5\nconst DARK = 0x666666;\nconst RED_100 = 0xfee2e2;\nconst RED_700 = 0xb91c1c;\nfunction formatRouteRecordForInspector(route) {\n    const tags = [];\n    const { record } = route;\n    if (record.name != null) {\n        tags.push({\n            label: String(record.name),\n            textColor: 0,\n            backgroundColor: CYAN_400,\n        });\n    }\n    if (record.aliasOf) {\n        tags.push({\n            label: 'alias',\n            textColor: 0,\n            backgroundColor: ORANGE_400,\n        });\n    }\n    if (route.__vd_match) {\n        tags.push({\n            label: 'matches',\n            textColor: 0,\n            backgroundColor: PINK_500,\n        });\n    }\n    if (route.__vd_exactActive) {\n        tags.push({\n            label: 'exact',\n            textColor: 0,\n            backgroundColor: LIME_500,\n        });\n    }\n    if (route.__vd_active) {\n        tags.push({\n            label: 'active',\n            textColor: 0,\n            backgroundColor: BLUE_600,\n        });\n    }\n    if (record.redirect) {\n        tags.push({\n            label: typeof record.redirect === 'string'\n                ? `redirect: ${record.redirect}`\n                : 'redirects',\n            textColor: 0xffffff,\n            backgroundColor: DARK,\n        });\n    }\n    // add an id to be able to select it. Using the `path` is not possible because\n    // empty path children would collide with their parents\n    let id = record.__vd_id;\n    if (id == null) {\n        id = String(routeRecordId++);\n        record.__vd_id = id;\n    }\n    return {\n        id,\n        label: record.path,\n        tags,\n        children: route.children.map(formatRouteRecordForInspector),\n    };\n}\n//  incremental id for route records and inspector state\nlet routeRecordId = 0;\nconst EXTRACT_REGEXP_RE = /^\\/(.*)\\/([a-z]*)$/;\nfunction markRouteRecordActive(route, currentRoute) {\n    // no route will be active if matched is empty\n    // reset the matching state\n    const isExactActive = currentRoute.matched.length &&\n        isSameRouteRecord(currentRoute.matched[currentRoute.matched.length - 1], route.record);\n    route.__vd_exactActive = route.__vd_active = isExactActive;\n    if (!isExactActive) {\n        route.__vd_active = currentRoute.matched.some(match => isSameRouteRecord(match, route.record));\n    }\n    route.children.forEach(childRoute => markRouteRecordActive(childRoute, currentRoute));\n}\nfunction resetMatchStateOnRouteRecord(route) {\n    route.__vd_match = false;\n    route.children.forEach(resetMatchStateOnRouteRecord);\n}\nfunction isRouteMatching(route, filter) {\n    const found = String(route.re).match(EXTRACT_REGEXP_RE);\n    route.__vd_match = false;\n    if (!found || found.length < 3) {\n        return false;\n    }\n    // use a regexp without $ at the end to match nested routes better\n    const nonEndingRE = new RegExp(found[1].replace(/\\$$/, ''), found[2]);\n    if (nonEndingRE.test(filter)) {\n        // mark children as matches\n        route.children.forEach(child => isRouteMatching(child, filter));\n        // exception case: `/`\n        if (route.record.path !== '/' || filter === '/') {\n            route.__vd_match = route.re.test(filter);\n            return true;\n        }\n        // hide the / route\n        return false;\n    }\n    const path = route.record.path.toLowerCase();\n    const decodedPath = decode(path);\n    // also allow partial matching on the path\n    if (!filter.startsWith('/') &&\n        (decodedPath.includes(filter) || path.includes(filter)))\n        return true;\n    if (decodedPath.startsWith(filter) || path.startsWith(filter))\n        return true;\n    if (route.record.name && String(route.record.name).includes(filter))\n        return true;\n    return route.children.some(child => isRouteMatching(child, filter));\n}\nfunction omit(obj, keys) {\n    const ret = {};\n    for (const key in obj) {\n        if (!keys.includes(key)) {\n            // @ts-expect-error\n            ret[key] = obj[key];\n        }\n    }\n    return ret;\n}\n\n/**\n * Creates a Router instance that can be used by a Vue app.\n *\n * @param options - {@link RouterOptions}\n */\nfunction createRouter(options) {\n    const matcher = createRouterMatcher(options.routes, options);\n    const parseQuery$1 = options.parseQuery || parseQuery;\n    const stringifyQuery$1 = options.stringifyQuery || stringifyQuery;\n    const routerHistory = options.history;\n    if ((process.env.NODE_ENV !== 'production') && !routerHistory)\n        throw new Error('Provide the \"history\" option when calling \"createRouter()\":' +\n            ' https://router.vuejs.org/api/interfaces/RouterOptions.html#history');\n    const beforeGuards = useCallbacks();\n    const beforeResolveGuards = useCallbacks();\n    const afterGuards = useCallbacks();\n    const currentRoute = shallowRef(START_LOCATION_NORMALIZED);\n    let pendingLocation = START_LOCATION_NORMALIZED;\n    // leave the scrollRestoration if no scrollBehavior is provided\n    if (isBrowser && options.scrollBehavior && 'scrollRestoration' in history) {\n        history.scrollRestoration = 'manual';\n    }\n    const normalizeParams = applyToParams.bind(null, paramValue => '' + paramValue);\n    const encodeParams = applyToParams.bind(null, encodeParam);\n    const decodeParams = \n    // @ts-expect-error: intentionally avoid the type check\n    applyToParams.bind(null, decode);\n    function addRoute(parentOrRoute, route) {\n        let parent;\n        let record;\n        if (isRouteName(parentOrRoute)) {\n            parent = matcher.getRecordMatcher(parentOrRoute);\n            if ((process.env.NODE_ENV !== 'production') && !parent) {\n                warn(`Parent route \"${String(parentOrRoute)}\" not found when adding child route`, route);\n            }\n            record = route;\n        }\n        else {\n            record = parentOrRoute;\n        }\n        return matcher.addRoute(record, parent);\n    }\n    function removeRoute(name) {\n        const recordMatcher = matcher.getRecordMatcher(name);\n        if (recordMatcher) {\n            matcher.removeRoute(recordMatcher);\n        }\n        else if ((process.env.NODE_ENV !== 'production')) {\n            warn(`Cannot remove non-existent route \"${String(name)}\"`);\n        }\n    }\n    function getRoutes() {\n        return matcher.getRoutes().map(routeMatcher => routeMatcher.record);\n    }\n    function hasRoute(name) {\n        return !!matcher.getRecordMatcher(name);\n    }\n    function resolve(rawLocation, currentLocation) {\n        // const resolve: Router['resolve'] = (rawLocation: RouteLocationRaw, currentLocation) => {\n        // const objectLocation = routerLocationAsObject(rawLocation)\n        // we create a copy to modify it later\n        currentLocation = assign({}, currentLocation || currentRoute.value);\n        if (typeof rawLocation === 'string') {\n            const locationNormalized = parseURL(parseQuery$1, rawLocation, currentLocation.path);\n            const matchedRoute = matcher.resolve({ path: locationNormalized.path }, currentLocation);\n            const href = routerHistory.createHref(locationNormalized.fullPath);\n            if ((process.env.NODE_ENV !== 'production')) {\n                if (href.startsWith('//'))\n                    warn(`Location \"${rawLocation}\" resolved to \"${href}\". A resolved location cannot start with multiple slashes.`);\n                else if (!matchedRoute.matched.length) {\n                    warn(`No match found for location with path \"${rawLocation}\"`);\n                }\n            }\n            // locationNormalized is always a new object\n            return assign(locationNormalized, matchedRoute, {\n                params: decodeParams(matchedRoute.params),\n                hash: decode(locationNormalized.hash),\n                redirectedFrom: undefined,\n                href,\n            });\n        }\n        if ((process.env.NODE_ENV !== 'production') && !isRouteLocation(rawLocation)) {\n            warn(`router.resolve() was passed an invalid location. This will fail in production.\\n- Location:`, rawLocation);\n            return resolve({});\n        }\n        let matcherLocation;\n        // path could be relative in object as well\n        if (rawLocation.path != null) {\n            if ((process.env.NODE_ENV !== 'production') &&\n                'params' in rawLocation &&\n                !('name' in rawLocation) &&\n                // @ts-expect-error: the type is never\n                Object.keys(rawLocation.params).length) {\n                warn(`Path \"${rawLocation.path}\" was passed with params but they will be ignored. Use a named route alongside params instead.`);\n            }\n            matcherLocation = assign({}, rawLocation, {\n                path: parseURL(parseQuery$1, rawLocation.path, currentLocation.path).path,\n            });\n        }\n        else {\n            // remove any nullish param\n            const targetParams = assign({}, rawLocation.params);\n            for (const key in targetParams) {\n                if (targetParams[key] == null) {\n                    delete targetParams[key];\n                }\n            }\n            // pass encoded values to the matcher, so it can produce encoded path and fullPath\n            matcherLocation = assign({}, rawLocation, {\n                params: encodeParams(targetParams),\n            });\n            // current location params are decoded, we need to encode them in case the\n            // matcher merges the params\n            currentLocation.params = encodeParams(currentLocation.params);\n        }\n        const matchedRoute = matcher.resolve(matcherLocation, currentLocation);\n        const hash = rawLocation.hash || '';\n        if ((process.env.NODE_ENV !== 'production') && hash && !hash.startsWith('#')) {\n            warn(`A \\`hash\\` should always start with the character \"#\". Replace \"${hash}\" with \"#${hash}\".`);\n        }\n        // the matcher might have merged current location params, so\n        // we need to run the decoding again\n        matchedRoute.params = normalizeParams(decodeParams(matchedRoute.params));\n        const fullPath = stringifyURL(stringifyQuery$1, assign({}, rawLocation, {\n            hash: encodeHash(hash),\n            path: matchedRoute.path,\n        }));\n        const href = routerHistory.createHref(fullPath);\n        if ((process.env.NODE_ENV !== 'production')) {\n            if (href.startsWith('//')) {\n                warn(`Location \"${rawLocation}\" resolved to \"${href}\". A resolved location cannot start with multiple slashes.`);\n            }\n            else if (!matchedRoute.matched.length) {\n                warn(`No match found for location with path \"${rawLocation.path != null ? rawLocation.path : rawLocation}\"`);\n            }\n        }\n        return assign({\n            fullPath,\n            // keep the hash encoded so fullPath is effectively path + encodedQuery +\n            // hash\n            hash,\n            query: \n            // if the user is using a custom query lib like qs, we might have\n            // nested objects, so we keep the query as is, meaning it can contain\n            // numbers at `$route.query`, but at the point, the user will have to\n            // use their own type anyway.\n            // https://github.com/vuejs/router/issues/328#issuecomment-649481567\n            stringifyQuery$1 === stringifyQuery\n                ? normalizeQuery(rawLocation.query)\n                : (rawLocation.query || {}),\n        }, matchedRoute, {\n            redirectedFrom: undefined,\n            href,\n        });\n    }\n    function locationAsObject(to) {\n        return typeof to === 'string'\n            ? parseURL(parseQuery$1, to, currentRoute.value.path)\n            : assign({}, to);\n    }\n    function checkCanceledNavigation(to, from) {\n        if (pendingLocation !== to) {\n            return createRouterError(8 /* ErrorTypes.NAVIGATION_CANCELLED */, {\n                from,\n                to,\n            });\n        }\n    }\n    function push(to) {\n        return pushWithRedirect(to);\n    }\n    function replace(to) {\n        return push(assign(locationAsObject(to), { replace: true }));\n    }\n    function handleRedirectRecord(to) {\n        const lastMatched = to.matched[to.matched.length - 1];\n        if (lastMatched && lastMatched.redirect) {\n            const { redirect } = lastMatched;\n            let newTargetLocation = typeof redirect === 'function' ? redirect(to) : redirect;\n            if (typeof newTargetLocation === 'string') {\n                newTargetLocation =\n                    newTargetLocation.includes('?') || newTargetLocation.includes('#')\n                        ? (newTargetLocation = locationAsObject(newTargetLocation))\n                        : // force empty params\n                            { path: newTargetLocation };\n                // @ts-expect-error: force empty params when a string is passed to let\n                // the router parse them again\n                newTargetLocation.params = {};\n            }\n            if ((process.env.NODE_ENV !== 'production') &&\n                newTargetLocation.path == null &&\n                !('name' in newTargetLocation)) {\n                warn(`Invalid redirect found:\\n${JSON.stringify(newTargetLocation, null, 2)}\\n when navigating to \"${to.fullPath}\". A redirect must contain a name or path. This will break in production.`);\n                throw new Error('Invalid redirect');\n            }\n            return assign({\n                query: to.query,\n                hash: to.hash,\n                // avoid transferring params if the redirect has a path\n                params: newTargetLocation.path != null ? {} : to.params,\n            }, newTargetLocation);\n        }\n    }\n    function pushWithRedirect(to, redirectedFrom) {\n        const targetLocation = (pendingLocation = resolve(to));\n        const from = currentRoute.value;\n        const data = to.state;\n        const force = to.force;\n        // to could be a string where `replace` is a function\n        const replace = to.replace === true;\n        const shouldRedirect = handleRedirectRecord(targetLocation);\n        if (shouldRedirect)\n            return pushWithRedirect(assign(locationAsObject(shouldRedirect), {\n                state: typeof shouldRedirect === 'object'\n                    ? assign({}, data, shouldRedirect.state)\n                    : data,\n                force,\n                replace,\n            }), \n            // keep original redirectedFrom if it exists\n            redirectedFrom || targetLocation);\n        // if it was a redirect we already called `pushWithRedirect` above\n        const toLocation = targetLocation;\n        toLocation.redirectedFrom = redirectedFrom;\n        let failure;\n        if (!force && isSameRouteLocation(stringifyQuery$1, from, targetLocation)) {\n            failure = createRouterError(16 /* ErrorTypes.NAVIGATION_DUPLICATED */, { to: toLocation, from });\n            // trigger scroll to allow scrolling to the same anchor\n            handleScroll(from, from, \n            // this is a push, the only way for it to be triggered from a\n            // history.listen is with a redirect, which makes it become a push\n            true, \n            // This cannot be the first navigation because the initial location\n            // cannot be manually navigated to\n            false);\n        }\n        return (failure ? Promise.resolve(failure) : navigate(toLocation, from))\n            .catch((error) => isNavigationFailure(error)\n            ? // navigation redirects still mark the router as ready\n                isNavigationFailure(error, 2 /* ErrorTypes.NAVIGATION_GUARD_REDIRECT */)\n                    ? error\n                    : markAsReady(error) // also returns the error\n            : // reject any unknown error\n                triggerError(error, toLocation, from))\n            .then((failure) => {\n            if (failure) {\n                if (isNavigationFailure(failure, 2 /* ErrorTypes.NAVIGATION_GUARD_REDIRECT */)) {\n                    if ((process.env.NODE_ENV !== 'production') &&\n                        // we are redirecting to the same location we were already at\n                        isSameRouteLocation(stringifyQuery$1, resolve(failure.to), toLocation) &&\n                        // and we have done it a couple of times\n                        redirectedFrom &&\n                        // @ts-expect-error: added only in dev\n                        (redirectedFrom._count = redirectedFrom._count\n                            ? // @ts-expect-error\n                                redirectedFrom._count + 1\n                            : 1) > 30) {\n                        warn(`Detected a possibly infinite redirection in a navigation guard when going from \"${from.fullPath}\" to \"${toLocation.fullPath}\". Aborting to avoid a Stack Overflow.\\n Are you always returning a new location within a navigation guard? That would lead to this error. Only return when redirecting or aborting, that should fix this. This might break in production if not fixed.`);\n                        return Promise.reject(new Error('Infinite redirect in navigation guard'));\n                    }\n                    return pushWithRedirect(\n                    // keep options\n                    assign({\n                        // preserve an existing replacement but allow the redirect to override it\n                        replace,\n                    }, locationAsObject(failure.to), {\n                        state: typeof failure.to === 'object'\n                            ? assign({}, data, failure.to.state)\n                            : data,\n                        force,\n                    }), \n                    // preserve the original redirectedFrom if any\n                    redirectedFrom || toLocation);\n                }\n            }\n            else {\n                // if we fail we don't finalize the navigation\n                failure = finalizeNavigation(toLocation, from, true, replace, data);\n            }\n            triggerAfterEach(toLocation, from, failure);\n            return failure;\n        });\n    }\n    /**\n     * Helper to reject and skip all navigation guards if a new navigation happened\n     * @param to\n     * @param from\n     */\n    function checkCanceledNavigationAndReject(to, from) {\n        const error = checkCanceledNavigation(to, from);\n        return error ? Promise.reject(error) : Promise.resolve();\n    }\n    function runWithContext(fn) {\n        const app = installedApps.values().next().value;\n        // support Vue < 3.3\n        return app && typeof app.runWithContext === 'function'\n            ? app.runWithContext(fn)\n            : fn();\n    }\n    // TODO: refactor the whole before guards by internally using router.beforeEach\n    function navigate(to, from) {\n        let guards;\n        const [leavingRecords, updatingRecords, enteringRecords] = extractChangingRecords(to, from);\n        // all components here have been resolved once because we are leaving\n        guards = extractComponentsGuards(leavingRecords.reverse(), 'beforeRouteLeave', to, from);\n        // leavingRecords is already reversed\n        for (const record of leavingRecords) {\n            record.leaveGuards.forEach(guard => {\n                guards.push(guardToPromiseFn(guard, to, from));\n            });\n        }\n        const canceledNavigationCheck = checkCanceledNavigationAndReject.bind(null, to, from);\n        guards.push(canceledNavigationCheck);\n        // run the queue of per route beforeRouteLeave guards\n        return (runGuardQueue(guards)\n            .then(() => {\n            // check global guards beforeEach\n            guards = [];\n            for (const guard of beforeGuards.list()) {\n                guards.push(guardToPromiseFn(guard, to, from));\n            }\n            guards.push(canceledNavigationCheck);\n            return runGuardQueue(guards);\n        })\n            .then(() => {\n            // check in components beforeRouteUpdate\n            guards = extractComponentsGuards(updatingRecords, 'beforeRouteUpdate', to, from);\n            for (const record of updatingRecords) {\n                record.updateGuards.forEach(guard => {\n                    guards.push(guardToPromiseFn(guard, to, from));\n                });\n            }\n            guards.push(canceledNavigationCheck);\n            // run the queue of per route beforeEnter guards\n            return runGuardQueue(guards);\n        })\n            .then(() => {\n            // check the route beforeEnter\n            guards = [];\n            for (const record of enteringRecords) {\n                // do not trigger beforeEnter on reused views\n                if (record.beforeEnter) {\n                    if (isArray(record.beforeEnter)) {\n                        for (const beforeEnter of record.beforeEnter)\n                            guards.push(guardToPromiseFn(beforeEnter, to, from));\n                    }\n                    else {\n                        guards.push(guardToPromiseFn(record.beforeEnter, to, from));\n                    }\n                }\n            }\n            guards.push(canceledNavigationCheck);\n            // run the queue of per route beforeEnter guards\n            return runGuardQueue(guards);\n        })\n            .then(() => {\n            // NOTE: at this point to.matched is normalized and does not contain any () => Promise<Component>\n            // clear existing enterCallbacks, these are added by extractComponentsGuards\n            to.matched.forEach(record => (record.enterCallbacks = {}));\n            // check in-component beforeRouteEnter\n            guards = extractComponentsGuards(enteringRecords, 'beforeRouteEnter', to, from, runWithContext);\n            guards.push(canceledNavigationCheck);\n            // run the queue of per route beforeEnter guards\n            return runGuardQueue(guards);\n        })\n            .then(() => {\n            // check global guards beforeResolve\n            guards = [];\n            for (const guard of beforeResolveGuards.list()) {\n                guards.push(guardToPromiseFn(guard, to, from));\n            }\n            guards.push(canceledNavigationCheck);\n            return runGuardQueue(guards);\n        })\n            // catch any navigation canceled\n            .catch(err => isNavigationFailure(err, 8 /* ErrorTypes.NAVIGATION_CANCELLED */)\n            ? err\n            : Promise.reject(err)));\n    }\n    function triggerAfterEach(to, from, failure) {\n        // navigation is confirmed, call afterGuards\n        // TODO: wrap with error handlers\n        afterGuards\n            .list()\n            .forEach(guard => runWithContext(() => guard(to, from, failure)));\n    }\n    /**\n     * - Cleans up any navigation guards\n     * - Changes the url if necessary\n     * - Calls the scrollBehavior\n     */\n    function finalizeNavigation(toLocation, from, isPush, replace, data) {\n        // a more recent navigation took place\n        const error = checkCanceledNavigation(toLocation, from);\n        if (error)\n            return error;\n        // only consider as push if it's not the first navigation\n        const isFirstNavigation = from === START_LOCATION_NORMALIZED;\n        const state = !isBrowser ? {} : history.state;\n        // change URL only if the user did a push/replace and if it's not the initial navigation because\n        // it's just reflecting the url\n        if (isPush) {\n            // on the initial navigation, we want to reuse the scroll position from\n            // history state if it exists\n            if (replace || isFirstNavigation)\n                routerHistory.replace(toLocation.fullPath, assign({\n                    scroll: isFirstNavigation && state && state.scroll,\n                }, data));\n            else\n                routerHistory.push(toLocation.fullPath, data);\n        }\n        // accept current navigation\n        currentRoute.value = toLocation;\n        handleScroll(toLocation, from, isPush, isFirstNavigation);\n        markAsReady();\n    }\n    let removeHistoryListener;\n    // attach listener to history to trigger navigations\n    function setupListeners() {\n        // avoid setting up listeners twice due to an invalid first navigation\n        if (removeHistoryListener)\n            return;\n        removeHistoryListener = routerHistory.listen((to, _from, info) => {\n            if (!router.listening)\n                return;\n            // cannot be a redirect route because it was in history\n            const toLocation = resolve(to);\n            // due to dynamic routing, and to hash history with manual navigation\n            // (manually changing the url or calling history.hash = '#/somewhere'),\n            // there could be a redirect record in history\n            const shouldRedirect = handleRedirectRecord(toLocation);\n            if (shouldRedirect) {\n                pushWithRedirect(assign(shouldRedirect, { replace: true, force: true }), toLocation).catch(noop);\n                return;\n            }\n            pendingLocation = toLocation;\n            const from = currentRoute.value;\n            // TODO: should be moved to web history?\n            if (isBrowser) {\n                saveScrollPosition(getScrollKey(from.fullPath, info.delta), computeScrollPosition());\n            }\n            navigate(toLocation, from)\n                .catch((error) => {\n                if (isNavigationFailure(error, 4 /* ErrorTypes.NAVIGATION_ABORTED */ | 8 /* ErrorTypes.NAVIGATION_CANCELLED */)) {\n                    return error;\n                }\n                if (isNavigationFailure(error, 2 /* ErrorTypes.NAVIGATION_GUARD_REDIRECT */)) {\n                    // Here we could call if (info.delta) routerHistory.go(-info.delta,\n                    // false) but this is bug prone as we have no way to wait the\n                    // navigation to be finished before calling pushWithRedirect. Using\n                    // a setTimeout of 16ms seems to work but there is no guarantee for\n                    // it to work on every browser. So instead we do not restore the\n                    // history entry and trigger a new navigation as requested by the\n                    // navigation guard.\n                    // the error is already handled by router.push we just want to avoid\n                    // logging the error\n                    pushWithRedirect(assign(locationAsObject(error.to), {\n                        force: true,\n                    }), toLocation\n                    // avoid an uncaught rejection, let push call triggerError\n                    )\n                        .then(failure => {\n                        // manual change in hash history #916 ending up in the URL not\n                        // changing, but it was changed by the manual url change, so we\n                        // need to manually change it ourselves\n                        if (isNavigationFailure(failure, 4 /* ErrorTypes.NAVIGATION_ABORTED */ |\n                            16 /* ErrorTypes.NAVIGATION_DUPLICATED */) &&\n                            !info.delta &&\n                            info.type === NavigationType.pop) {\n                            routerHistory.go(-1, false);\n                        }\n                    })\n                        .catch(noop);\n                    // avoid the then branch\n                    return Promise.reject();\n                }\n                // do not restore history on unknown direction\n                if (info.delta) {\n                    routerHistory.go(-info.delta, false);\n                }\n                // unrecognized error, transfer to the global handler\n                return triggerError(error, toLocation, from);\n            })\n                .then((failure) => {\n                failure =\n                    failure ||\n                        finalizeNavigation(\n                        // after navigation, all matched components are resolved\n                        toLocation, from, false);\n                // revert the navigation\n                if (failure) {\n                    if (info.delta &&\n                        // a new navigation has been triggered, so we do not want to revert, that will change the current history\n                        // entry while a different route is displayed\n                        !isNavigationFailure(failure, 8 /* ErrorTypes.NAVIGATION_CANCELLED */)) {\n                        routerHistory.go(-info.delta, false);\n                    }\n                    else if (info.type === NavigationType.pop &&\n                        isNavigationFailure(failure, 4 /* ErrorTypes.NAVIGATION_ABORTED */ | 16 /* ErrorTypes.NAVIGATION_DUPLICATED */)) {\n                        // manual change in hash history #916\n                        // it's like a push but lacks the information of the direction\n                        routerHistory.go(-1, false);\n                    }\n                }\n                triggerAfterEach(toLocation, from, failure);\n            })\n                // avoid warnings in the console about uncaught rejections, they are logged by triggerErrors\n                .catch(noop);\n        });\n    }\n    // Initialization and Errors\n    let readyHandlers = useCallbacks();\n    let errorListeners = useCallbacks();\n    let ready;\n    /**\n     * Trigger errorListeners added via onError and throws the error as well\n     *\n     * @param error - error to throw\n     * @param to - location we were navigating to when the error happened\n     * @param from - location we were navigating from when the error happened\n     * @returns the error as a rejected promise\n     */\n    function triggerError(error, to, from) {\n        markAsReady(error);\n        const list = errorListeners.list();\n        if (list.length) {\n            list.forEach(handler => handler(error, to, from));\n        }\n        else {\n            if ((process.env.NODE_ENV !== 'production')) {\n                warn('uncaught error during route navigation:');\n            }\n            console.error(error);\n        }\n        // reject the error no matter there were error listeners or not\n        return Promise.reject(error);\n    }\n    function isReady() {\n        if (ready && currentRoute.value !== START_LOCATION_NORMALIZED)\n            return Promise.resolve();\n        return new Promise((resolve, reject) => {\n            readyHandlers.add([resolve, reject]);\n        });\n    }\n    function markAsReady(err) {\n        if (!ready) {\n            // still not ready if an error happened\n            ready = !err;\n            setupListeners();\n            readyHandlers\n                .list()\n                .forEach(([resolve, reject]) => (err ? reject(err) : resolve()));\n            readyHandlers.reset();\n        }\n        return err;\n    }\n    // Scroll behavior\n    function handleScroll(to, from, isPush, isFirstNavigation) {\n        const { scrollBehavior } = options;\n        if (!isBrowser || !scrollBehavior)\n            return Promise.resolve();\n        const scrollPosition = (!isPush && getSavedScrollPosition(getScrollKey(to.fullPath, 0))) ||\n            ((isFirstNavigation || !isPush) &&\n                history.state &&\n                history.state.scroll) ||\n            null;\n        return nextTick()\n            .then(() => scrollBehavior(to, from, scrollPosition))\n            .then(position => position && scrollToPosition(position))\n            .catch(err => triggerError(err, to, from));\n    }\n    const go = (delta) => routerHistory.go(delta);\n    let started;\n    const installedApps = new Set();\n    const router = {\n        currentRoute,\n        listening: true,\n        addRoute,\n        removeRoute,\n        clearRoutes: matcher.clearRoutes,\n        hasRoute,\n        getRoutes,\n        resolve,\n        options,\n        push,\n        replace,\n        go,\n        back: () => go(-1),\n        forward: () => go(1),\n        beforeEach: beforeGuards.add,\n        beforeResolve: beforeResolveGuards.add,\n        afterEach: afterGuards.add,\n        onError: errorListeners.add,\n        isReady,\n        install(app) {\n            const router = this;\n            app.component('RouterLink', RouterLink);\n            app.component('RouterView', RouterView);\n            app.config.globalProperties.$router = router;\n            Object.defineProperty(app.config.globalProperties, '$route', {\n                enumerable: true,\n                get: () => unref(currentRoute),\n            });\n            // this initial navigation is only necessary on client, on server it doesn't\n            // make sense because it will create an extra unnecessary navigation and could\n            // lead to problems\n            if (isBrowser &&\n                // used for the initial navigation client side to avoid pushing\n                // multiple times when the router is used in multiple apps\n                !started &&\n                currentRoute.value === START_LOCATION_NORMALIZED) {\n                // see above\n                started = true;\n                push(routerHistory.location).catch(err => {\n                    if ((process.env.NODE_ENV !== 'production'))\n                        warn('Unexpected error when starting the router:', err);\n                });\n            }\n            const reactiveRoute = {};\n            for (const key in START_LOCATION_NORMALIZED) {\n                Object.defineProperty(reactiveRoute, key, {\n                    get: () => currentRoute.value[key],\n                    enumerable: true,\n                });\n            }\n            app.provide(routerKey, router);\n            app.provide(routeLocationKey, shallowReactive(reactiveRoute));\n            app.provide(routerViewLocationKey, currentRoute);\n            const unmountApp = app.unmount;\n            installedApps.add(app);\n            app.unmount = function () {\n                installedApps.delete(app);\n                // the router is not attached to an app anymore\n                if (installedApps.size < 1) {\n                    // invalidate the current navigation\n                    pendingLocation = START_LOCATION_NORMALIZED;\n                    removeHistoryListener && removeHistoryListener();\n                    removeHistoryListener = null;\n                    currentRoute.value = START_LOCATION_NORMALIZED;\n                    started = false;\n                    ready = false;\n                }\n                unmountApp();\n            };\n            // TODO: this probably needs to be updated so it can be used by vue-termui\n            if (((process.env.NODE_ENV !== 'production') || __VUE_PROD_DEVTOOLS__) && isBrowser) {\n                addDevtools(app, router, matcher);\n            }\n        },\n    };\n    // TODO: type this as NavigationGuardReturn or similar instead of any\n    function runGuardQueue(guards) {\n        return guards.reduce((promise, guard) => promise.then(() => runWithContext(guard)), Promise.resolve());\n    }\n    return router;\n}\nfunction extractChangingRecords(to, from) {\n    const leavingRecords = [];\n    const updatingRecords = [];\n    const enteringRecords = [];\n    const len = Math.max(from.matched.length, to.matched.length);\n    for (let i = 0; i < len; i++) {\n        const recordFrom = from.matched[i];\n        if (recordFrom) {\n            if (to.matched.find(record => isSameRouteRecord(record, recordFrom)))\n                updatingRecords.push(recordFrom);\n            else\n                leavingRecords.push(recordFrom);\n        }\n        const recordTo = to.matched[i];\n        if (recordTo) {\n            // the type doesn't matter because we are comparing per reference\n            if (!from.matched.find(record => isSameRouteRecord(record, recordTo))) {\n                enteringRecords.push(recordTo);\n            }\n        }\n    }\n    return [leavingRecords, updatingRecords, enteringRecords];\n}\n\n/**\n * Returns the router instance. Equivalent to using `$router` inside\n * templates.\n */\nfunction useRouter() {\n    return inject(routerKey);\n}\n/**\n * Returns the current route location. Equivalent to using `$route` inside\n * templates.\n */\nfunction useRoute(_name) {\n    return inject(routeLocationKey);\n}\n\nexport { NavigationFailureType, RouterLink, RouterView, START_LOCATION_NORMALIZED as START_LOCATION, createMemoryHistory, createRouter, createRouterMatcher, createWebHashHistory, createWebHistory, isNavigationFailure, loadRouteLocation, matchedRouteKey, onBeforeRouteLeave, onBeforeRouteUpdate, parseQuery, routeLocationKey, routerKey, routerViewLocationKey, stringifyQuery, useLink, useRoute, useRouter, viewDepthKey };\n","import { Pen } from '../pen';\r\n\r\nexport function rectangle(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  const { x, y, width, height, ex, ey } = pen.calculative.worldRect;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * hr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  path.moveTo(x + r, y);\r\n  path.arcTo(ex, y, ex, ey, r);\r\n  path.arcTo(ex, ey, x, ey, r);\r\n  path.arcTo(x, ey, x, y, r);\r\n  path.arcTo(x, y, ex, y, r);\r\n  path.closePath();\r\n  if (path instanceof Path2D) {\r\n    return path;\r\n  }\r\n}\r\nexport const square = rectangle;\r\n","import { Pen } from '../pen';\r\n\r\nexport function circle(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.ellipse(\r\n    x + width / 2,\r\n    y + height / 2,\r\n    width / 2,\r\n    height / 2,\r\n    0,\r\n    0,\r\n    Math.PI * 2\r\n  );\r\n\r\n  if (path instanceof Path2D) {\r\n    return path;\r\n  }\r\n}\r\n","import { Point } from '../point';\r\nimport { Rect } from '../rect';\r\nimport { Event, RealTime, Trigger } from '../event';\r\nimport { Canvas } from '../canvas';\r\n\r\nexport enum PenType {\r\n  Node,\r\n  Line,\r\n}\r\n\r\nexport enum LockState {\r\n  None,\r\n  DisableEdit,\r\n  DisableMove,\r\n  DisableScale, //仅占位\r\n  DisableMoveScale,\r\n  // DisableActive,\r\n  Disable = 10,\r\n}\r\n\r\nexport enum AnchorMode {\r\n  Default,\r\n  In,\r\n  Out,\r\n}\r\n\r\nexport enum Gradient {\r\n  None, // 没有渐变\r\n  Linear, // 线性渐变\r\n  Radial, // 镜像渐变\r\n}\r\n\r\n//所在画布层 值和画布zIndex对应\r\nexport enum CanvasLayer{\r\n  CanvasTemplate = 1, //模版层\r\n  CanvasImageBottom, //底部图片层\r\n  CanvasMain, //主画布层\r\n  CanvasImage //顶部图片层\r\n}\r\n\r\n// export enum Flip {\r\n//   None, // 正常\r\n//   Horizontal, // 水平翻转\r\n//   Vertical, // 垂直翻转\r\n//   Both, // 全翻转\r\n// }\r\n\r\n// 修改哪些属性需要重现计算 textRect\r\nexport const needCalcTextRectProps = [\r\n  'text',\r\n  'textWidth',\r\n  'textHeight',\r\n  'textLeft',\r\n  'textTop',\r\n  'fontFamily',\r\n  'fontSize',\r\n  'lineHeight',\r\n  'fontStyle',\r\n  'fontWeight',\r\n  'textAlign',\r\n  'textBaseline',\r\n  'whiteSpace',\r\n  'ellipsis',\r\n  'keepDecimal',\r\n];\r\n\r\nexport const needSetPenProps = ['x', 'y', 'width', 'height', 'flipX', 'flipY'];\r\n\r\nexport const needPatchFlagsPenRectProps = [\r\n  'paddingTop',\r\n  'paddingRight',\r\n  'paddingBottom',\r\n  'paddingLeft',\r\n  'flipX',\r\n  'flipY',\r\n  'visible',\r\n  'showChild',\r\n];\r\n\r\nexport const needCalcIconRectProps = ['iconLeft', 'iconTop', 'iconRotate'];\r\n\r\nexport interface ConnectLine {\r\n  lineId: string;\r\n  lineAnchor: string;\r\n  anchor: string;\r\n}\r\n\r\nexport type TextAlign = 'left' | 'center' | 'right';\r\nexport type TextBaseline = 'top' | 'middle' | 'bottom';\r\nexport type WhiteSpace = 'nowrap' | 'pre-line' | 'break-all' | '';\r\n// SetValue 方法参数类型\r\nexport type IValue = Pen &\r\n  Partial<ChartData> &\r\n  Partial<Record<'tag' | 'newId', string>> & { [key: string]: any };\r\n\r\n// obj 类型数组 text 字段显示文字，其它属性选中后合并到画笔上\r\n// string 类型，只展示文字\r\nexport type Dropdown = string | IValue;\r\n\r\nexport enum LineAnimateType {\r\n  Normal, // 水流\r\n  Beads, // 水珠流动\r\n  Dot, // 圆点\r\n  Arrow, // 箭头,\r\n  WaterDrop, // 水滴\r\n}\r\n\r\nexport interface ColorStop {\r\n  i: number; //取值0-1,色标位置\r\n  color: string;\r\n}\r\n\r\nexport interface Pen extends Rect {\r\n  id?: string;\r\n  tags?: string[];\r\n  parentId?: string;\r\n  type?: PenType;\r\n  name?: string;\r\n  lineName?: string;\r\n  borderRadius?: number;\r\n  // Hidden only visible == false\r\n  visible?: boolean;\r\n  locked?: LockState;\r\n\r\n  // 连线是否闭合路径\r\n  close?: boolean;\r\n  // 连线长度\r\n  length?: number;\r\n\r\n  title?: string;\r\n  // 优先级高于 title\r\n  titleFnJs?: string;\r\n  titleFn?: (pen: Pen) => string;\r\n\r\n  lineWidth?: number;\r\n  borderWidth?: number;\r\n  borderColor?: string;\r\n  globalAlpha?: number;\r\n  lineDash?: number[];\r\n  lineDashOffset?: number;\r\n  color?: string;\r\n  background?: string;\r\n  anchorColor?: string;\r\n  hoverAnchorColor?: string;\r\n  hoverColor?: string;\r\n  hoverBackground?: string;\r\n  activeColor?: string;\r\n  activeBackground?: string;\r\n  mouseDownValid?: boolean; // 是否鼠标按下是否有样式效果\r\n  mouseDownColor?: string;\r\n  mouseDownBackground?: string;\r\n  bkType?: Gradient;\r\n  /**\r\n   * @deprecated 改用 gradientColors\r\n   */\r\n  gradientFromColor?: string;\r\n  /**\r\n   * @deprecated 改用 gradientColors\r\n   */\r\n  gradientToColor?: string;\r\n  /**\r\n   * @deprecated 改用 gradientColors\r\n   */\r\n  gradientAngle?: number;\r\n  gradientRadius?: number;\r\n\r\n  // TODO: stroke 尚无径向渐变\r\n  strokeType?: Gradient;\r\n  /**\r\n   * @deprecated 改用 lineGradientColors\r\n   */\r\n  lineGradientFromColor?: string;\r\n  /**\r\n   * @deprecated 改用 lineGradientColors\r\n   */\r\n  lineGradientToColor?: string;\r\n  /**\r\n   * @deprecated 改用 lineGradientColors\r\n   */\r\n  lineGradientAngle?: number;\r\n\r\n  gradientColors?: string;\r\n  switch?: boolean; // 图元是否有开关状态\r\n  checked?: boolean; // 是否选中\r\n  onBackground?: string;\r\n  onGradientColors?: string;\r\n  lineGradientColors?: string;\r\n  lineCap?: CanvasLineCap;\r\n  fromLineCap?: CanvasLineCap;\r\n  toLineCap?: CanvasLineCap;\r\n  lineJoin?: CanvasLineJoin;\r\n  shadowColor?: string;\r\n  shadowBlur?: number;\r\n  shadowOffsetX?: number;\r\n  shadowOffsetY?: number;\r\n  textHasShadow?: boolean; // 文字是否需要阴影\r\n\r\n  text?: string;\r\n  textWidth?: number;\r\n  textHeight?: number;\r\n  textLeft?: number;\r\n  textTop?: number;\r\n  textColor?: string;\r\n  hoverTextColor?: string;\r\n  activeTextColor?: string;\r\n  fontFamily?: string;\r\n  fontSize?: number;\r\n  lineHeight?: number;\r\n  fontStyle?: string;\r\n  fontWeight?: string;\r\n  textAlign?: TextAlign;\r\n  textBaseline?: TextBaseline;\r\n  textBackground?: string;\r\n  whiteSpace?: WhiteSpace;\r\n  ellipsis?: boolean;\r\n\r\n  image?: string;\r\n  icon?: string;\r\n  iconRotate?: number;\r\n  iconWidth?: number;\r\n  iconHeight?: number;\r\n  iconTop?: number;\r\n  iconLeft?: number;\r\n  iconColor?: string;\r\n  iconFamily?: string;\r\n  iconWeight?: string;\r\n  iconSize?: number;\r\n  iconAlign?:\r\n    | 'top'\r\n    | 'bottom'\r\n    | 'left'\r\n    | 'right'\r\n    | 'left-top'\r\n    | 'right-top'\r\n    | 'left-bottom'\r\n    | 'right-bottom'\r\n    | 'center';\r\n  imageRatio?: boolean;\r\n\r\n  disableInput?: boolean;\r\n  disableRotate?: boolean;\r\n  disableSize?: boolean;\r\n  disableAnchor?: boolean;\r\n\r\n  // 相对值，若小于 1 认为是相对坐标\r\n  paddingTop?: number;\r\n  paddingBottom?: number;\r\n  paddingLeft?: number;\r\n  paddingRight?: number;\r\n\r\n  backgroundImage?: string;\r\n  strokeImage?: string;\r\n\r\n  children?: string[];\r\n  followers?: string[];\r\n\r\n  anchors?: Point[];\r\n  anchorRadius?: number;\r\n  anchorBackground?: string;\r\n\r\n  pathId?: string;\r\n  path?: string;\r\n\r\n  fromArrow?: string;\r\n  toArrow?: string;\r\n  fromArrowSize?: number;\r\n  toArrowSize?: number;\r\n  fromArrowColor?: string;\r\n  toArrowColor?: string;\r\n\r\n  autoFrom?: boolean;\r\n  autoTo?: boolean;\r\n\r\n  connectedLines?: ConnectLine[];\r\n\r\n  // Cycle count. Infinite if == 0.\r\n  animateCycle?: number;\r\n  nextAnimate?: string;\r\n  // TODO: video 与 动画公用该属性，可能是个问题\r\n  autoPlay?: boolean;\r\n  playLoop?: boolean;\r\n\r\n  // 动画帧时长\r\n  duration?: number;\r\n  // 匀速渐变\r\n  linear?: boolean;\r\n  // 主要用于动画帧的缩放\r\n  scale?: number;\r\n  // 连线动画速度\r\n  animateSpan?: number;\r\n  animateColor?: string;\r\n  animateLineDash?: number[];\r\n  animateReverse?: boolean;\r\n  // 结束动画后，是否保持动画状态\r\n  keepAnimateState?: boolean;\r\n\r\n  lineAnimateType?: LineAnimateType;\r\n  animateName?: string; // 当前执行的动画名称\r\n  frames?: Pen[];\r\n  // 提前预置的不同效果的动画组\r\n  animateList?: Pen[][];\r\n  animateInterval?: number;//动画间隔 （箭头）\r\n  animateShadow?: boolean;//发光效果\r\n  animateShadowColor?: string;\r\n  animateShadowBlur?: number;\r\n  input?: boolean;\r\n  autofocus?: boolean;\r\n  dropdownList?: Dropdown[];\r\n  dropdownBackground?: string;\r\n  dropdownColor?: string;\r\n  dropdownHoverColor?: string;\r\n  dropdownHoverBackground?: string;\r\n  events?: Event[];\r\n\r\n  iframe?: string;\r\n  video?: string;\r\n  audio?: string;\r\n\r\n  progress?: number;\r\n  progressColor?: string;\r\n  verticalProgress?: boolean;\r\n  reverseProgress?: boolean;\r\n  progressGradientColors?: string;\r\n  externElement?: boolean;\r\n\r\n  autoPolyline?: boolean;\r\n\r\n  // flip?: Flip;\r\n  flipX?: boolean;\r\n  flipY?: boolean;\r\n\r\n  fillTexts?: string[];\r\n\r\n  hiddenText?: boolean; // 隐藏 text\r\n  keepDecimal?: number; // undefined 显示原内容；0 显示整数\r\n  showChild?: number; // 第几个子元素展示 undefined 即展示全部\r\n  animateDotSize?: number; // 线条原点动画，原点大小\r\n  isRuleLine?: boolean; // 是否是规则线，规则线不受缩放，平移影响\r\n   /**\r\n   * @deprecated 改用 canvasLayer\r\n   */\r\n  isBottom?: boolean; // 是否是底部图片\r\n  canvasLayer?: CanvasLayer; //图元所在画布层\r\n  form?: FormItem[]; // 业务表单\r\n  lockedOnCombine?: LockState; // 组合成 combine ，该节点的 locked 值\r\n  ratio?: boolean; //宽高比锁定\r\n  animateLineWidth?: number; //连线动画线宽\r\n  lineSmooth?:number; //连线平滑度\r\n  gradientSmooth?: number; //渐进色平滑度\r\n  scrolling?: string; //iframe scrolling属性\r\n  animations?: any[]; //动画数组\r\n  currentAnimation?: number; //当前动画索引\r\n  realTimes?: RealTime[];\r\n  triggers?:  Trigger[]; //状态\r\n  crossOrigin?: string;\r\n  imageRadius?: number; //图片圆角\r\n  textFlip?: boolean; //文字是否镜像\r\n  textRotate?: boolean; //文字是否旋转\r\n  // calculative 对象中的值是为了动画存在，表明了渐变过程中，画布上绘制的当前值\r\n  textAutoAdjust?: boolean; //text图元宽高根据文本自动调整\r\n  dbInput?: boolean; //锁定状态下，双击能否输入\r\n  operationalRect?: Rect; //iframe可操作区域 x,y,width,height 均取值0-1\r\n  blur?: number;\r\n  blurBackground?: string;\r\n  /**\r\n   * @deprecated 改用 canvasLayer\r\n   */\r\n  template?: boolean; //是否作为模版图元\r\n  thumbImg?: string; //iframe嵌入场景缩略图\r\n  apiUrl?: string;\r\n  apiMethod?: string;\r\n  apiHeaders?: any;\r\n  apiBody?: any;\r\n  apiEnable?: boolean;\r\n  container?:boolean; //是否是容器组件\r\n  disabled?:boolean; //是否禁用\r\n  disabledColor?:string; //禁用颜色\r\n  disabledBackground?:string; //禁用背景色\r\n  disabledTextColor?:string; //禁用文字颜色\r\n  inputType?:string; //输入框类型\r\n  productId?:string; //产品id\r\n  deviceId?:string;//关联的设备id\r\n  pivot?:Point; //旋转中心 \r\n  noOnBinds?:boolean; //是否禁用绑定事件\r\n  interaction?:boolean; //是否开启交互 组合时将不会被锁定\r\n  childHover?:boolean; //子元素hover和active是否生效\r\n  childActive?:boolean; \r\n  draw?:boolean; //是否绘制 针对combine\r\n  calculative?: {\r\n    x?: number;\r\n    y?: number;\r\n    width?: number;\r\n    height?: number;\r\n    borderRadius?: number;\r\n\r\n    progress?: number;\r\n    progressColor?: string;\r\n    progressGradientColors?: string;\r\n    verticalProgress?: boolean;\r\n    worldRect?: Rect;\r\n    worldAnchors?: Point[];\r\n    worldIconRect?: Rect;\r\n    worldTextRect?: Rect;\r\n    textDrawRect?: Rect;\r\n    svgRect?: Rect;\r\n\r\n    // 执行动画前的初始位置\r\n    initRect?: Rect;\r\n    // 执行动画前的初始相对位置\r\n    initRelativeRect?: Rect;\r\n    // 执行动画前存储子图元的显示隐藏情况\r\n    childrenVisible?: any;\r\n    rotate?: number;\r\n    lineWidth?: number;\r\n    borderWidth?: number;\r\n    borderColor?: string;\r\n    globalAlpha?: number;\r\n    lineDash?: number[];\r\n    lineDashOffset?: number;\r\n    color?: string;\r\n    background?: string;\r\n    // anchorColor?: string;    // TODO: 锚点颜色动画，应该不需要\r\n    bkType?: number;\r\n    /**\r\n     * @deprecated 改用 gradientColors\r\n     */\r\n    gradientFromColor?: string;\r\n    /**\r\n     * @deprecated 改用 gradientColors\r\n     */\r\n    gradientToColor?: string;\r\n    /**\r\n     * @deprecated 改用 gradientColors\r\n     */\r\n    gradientAngle?: number;\r\n    gradientRadius?: number;\r\n\r\n    // TODO: stroke 尚无径向渐变\r\n    strokeType?: Gradient;\r\n    /**\r\n     * @deprecated 改用 lineGradientColors\r\n     */\r\n    lineGradientFromColor?: string;\r\n    /**\r\n     * @deprecated 改用 lineGradientColors\r\n     */\r\n    lineGradientToColor?: string;\r\n    /**\r\n     * @deprecated 改用 lineGradientColors\r\n     */\r\n    lineGradientAngle?: number;\r\n    shadowColor?: string;\r\n    shadowBlur?: number;\r\n    shadowOffsetX?: number;\r\n    shadowOffsetY?: number;\r\n    textHasShadow?: boolean;\r\n\r\n    tempText?: string;\r\n    text?: string;\r\n    textWidth?: number;\r\n    textHeight?: number;\r\n    textLeft?: number;\r\n    textTop?: number;\r\n    textColor?: string;\r\n    textType?: Gradient;\r\n    textGradientColors?: string;\r\n    fontFamily?: string;\r\n    fontSize?: number;\r\n    lineHeight?: number;\r\n    fontStyle?: string;\r\n    fontWeight?: string;\r\n    textBackground?: string;\r\n    iconSize?: number;\r\n    icon?: string;\r\n    iconRotate?: number;\r\n    iconWidth?: number;\r\n    iconHeight?: number;\r\n    iconTop?: number;\r\n    iconLeft?: number;\r\n    iconColor?: string;\r\n    iconFamily?: string;\r\n    iconWeight?: string;\r\n\r\n    // 绝对值，计算后的结果\r\n    paddingTop?: number;\r\n    paddingBottom?: number;\r\n    paddingLeft?: number;\r\n    paddingRight?: number;\r\n\r\n    textLines?: string[];\r\n    textLineWidths?: number[]; // textLines 每一行 width 组成的数组\r\n    image?: string;\r\n    img?: HTMLImageElement;\r\n    imgNaturalWidth?: number;\r\n    imgNaturalHeight?: number;\r\n    backgroundImage?: string;\r\n    strokeImage?: string;\r\n    backgroundImg?: HTMLImageElement;\r\n    strokeImg?: HTMLImageElement;\r\n    active?: boolean;\r\n    focus?: boolean; //聚焦图元\r\n    hover?: boolean;\r\n    mouseDown?: boolean; //是否鼠标按下\r\n    containerHover?: boolean; //容器组件hover\r\n    isDock?: boolean; // 是否是对齐参考画笔\r\n    pencil?: boolean;\r\n    activeAnchor?: Point;\r\n    patchFlags?: boolean;\r\n    visible?: boolean; // TODO: visible 是否参与动画呢？\r\n    // 仅仅内部专用\r\n    inView?: boolean;\r\n    // 辅助变量，画线时，动态计算锚点是否时水平方向\r\n    drawlineH?: boolean;\r\n\r\n    // 节点是否有图片\r\n    hasImage?: boolean;\r\n    // 图片是否已经绘画，避免频繁重绘\r\n    imageDrawed?: boolean;\r\n    // 图片是否在底层\r\n    /**\r\n     * @deprecated 改用 canvasLayer\r\n     */\r\n    isBottom?: boolean;\r\n    canvasLayer?: CanvasLayer; //图元所在画布层\r\n\r\n    scale?: number;\r\n\r\n    // 动画开始时间\r\n    start?: number;\r\n    // 动画时长\r\n    duration?: number;\r\n    // 动画结束时间\r\n    end?: number;\r\n    // 当前动画帧\r\n    frameIndex?: number;\r\n    // 当前动画帧起止时间\r\n    frameStart?: number;\r\n    frameEnd?: number;\r\n    frameDuration?: number;\r\n    animatePos?: number;\r\n    // 已经循环次数\r\n    cycleIndex?: number;\r\n    // 是否暂停动画\r\n    pause?: number;\r\n\r\n    layer?: number;\r\n\r\n    canvas?: Canvas;\r\n\r\n    iframe?: string;\r\n    video?: string;\r\n    audio?: string;\r\n    media?: HTMLMediaElement;\r\n\r\n    // flip?: Flip;\r\n    flipX?: boolean;\r\n    flipY?: boolean;\r\n\r\n    h?: boolean; // 是否水平\r\n\r\n    hiddenText?: boolean; // 隐藏 text\r\n    keepDecimal?: number; // undefined 显示原内容；0 显示整数；保留几位小数\r\n    showChild?: number; // 第几个子元素展示 undefined 即展示全部\r\n    animateDotSize?: number; // 线条原点动画，原点大小\r\n    zIndex?: number; //dom节点 z-index;\r\n    // media element\r\n    onended?: (pen: Pen) => void;\r\n\r\n    // 不应该被deepClone多份的数据，例如外部第三方组件库挂载点，\r\n    singleton?: any;\r\n    gradientColors?: string;\r\n    onBackground?: string;\r\n    onGradientColors?: string;\r\n    checked?: boolean;\r\n    lineGradientColors?: string;\r\n    gradient?: CanvasGradient; //临时渐进色 防止每次都计算\r\n    lineGradient?: CanvasGradient;\r\n    radialGradient?: CanvasGradient;\r\n    gradientColorStop?: ColorStop[]; //临时 连线ColorStop\r\n    gradientTimer?: any;\r\n    animateLineWidth?: number;\r\n    lineSmooth?:number; //连线平滑度\r\n    gradientSmooth?: number; //渐进色平滑度\r\n    gradientAnimatePath?: Path2D;\r\n    cssDisplay?: string; //css display\r\n    animations?: any[];\r\n    imageRadius?: number;\r\n    disabled?: boolean; //是否禁用\r\n    disabledColor?: string;\r\n    disabledBackground?: string;\r\n    disabledTextColor?:string; //禁用文字颜色\r\n  };\r\n  lastConnected?:any;\r\n  // 下划线相关配置属性\r\n  textDecoration?: string;\r\n  textDecorationDash?: number[];\r\n  textDecorationColor?: string;\r\n  // 删除线相关配置\r\n  textStrickoutColor?: string;\r\n  textStrickoutDash?: number[];\r\n  textStrickout?: boolean;\r\n  // 前一个动画帧状态数据\r\n  prevFrame?: Pen;\r\n\r\n  onAdd?: (pen: Pen) => void;\r\n  onValue?: (pen: Pen) => void;\r\n  onBeforeValue?: (pen: Pen, value: ChartData) => any;\r\n  onDestroy?: (pen: Pen) => void;\r\n  onMove?: (pen: Pen) => void;\r\n  onResize?: (pen: Pen) => void;\r\n  onRotate?: (pen: Pen) => void;\r\n  onScale?: (pen: Pen) => void;\r\n  onClick?: (pen: Pen, e: Point) => void;\r\n  onMouseEnter?: (pen: Pen, e: Point) => void;\r\n  onMouseLeave?: (pen: Pen, e: Point) => void;\r\n  onMouseDown?: (pen: Pen, e: Point) => void;\r\n  onMouseMove?: (pen: Pen, e: Point) => void;\r\n  onMouseUp?: (pen: Pen, e: Point) => void;\r\n  onShowInput?: (pen: Pen, e: Point) => void;\r\n  onInput?: (pen: Pen, text: string) => void;\r\n  onChangeId?: (pen: Pen, oldId: string, newId: string) => void;\r\n  onBinds?: (pen: Pen, values: IValue[], formItem: FormItem) => IValue;\r\n  onStartVideo?: (pen: Pen) => void;\r\n  onPauseVideo?: (pen: Pen) => void;\r\n  onStopVideo?: (pen: Pen) => void;\r\n  onRenderPenRaw?: (pen: Pen) => void;\r\n  onKeyDown?: (pen: Pen, key: string) => void;\r\n  onWheel?: (pen: Pen, e: WheelEvent) => void;\r\n  onContextmenu?: (pen: Pen, e: Point) => void;\r\n  onConnectLine?: (line: Pen, e: {\r\n    lineAnchor: Point;\r\n    fromAnchor: Point;\r\n    line: Pen;\r\n    anchor: Point;\r\n    pen: Pen;\r\n    fromPen: Pen\r\n  }) => void;\r\n}\r\n\r\n// 属性绑定变量\r\nexport interface FormItem {\r\n  key: string;\r\n  /**\r\n   * 单属性绑定单变量 或 绑定多变量\r\n   * 为数组时，顺序不重要\r\n   */\r\n  dataIds?: BindId | BindId[];\r\n}\r\n\r\nexport type BindId = {\r\n  dataId: string;\r\n  name: string; // TODO: 用作图表的归类\r\n};\r\n\r\n/**\r\n * 图表追加或替换数据，只关注数据\r\n */\r\nexport interface ChartData {\r\n  dataX: any | any[]; // x轴 或 y 轴分类变化\r\n  dataY: any | any[]; // series 数据变化\r\n  /**\r\n   * @deprecated 旧版本，未来移除该属性\r\n   */\r\n  overwrite?: boolean; // 追加 or 替换 ， false 追加\r\n}\r\n\r\n/**\r\n * dom 类型的 图形\r\n */\r\nexport const isDomShapes = [\r\n  'gif',\r\n  'iframe',\r\n  'video',\r\n  'echarts',\r\n  'highcharts',\r\n  'lightningCharts',\r\n];\r\n\r\n/**\r\n *  交互图元\r\n */\r\nexport const isInteraction = [\r\n  'radio',\r\n  'checkbox',\r\n  'button',\r\n  'inputDom',\r\n  'slider',\r\n  'echarts',\r\n]\r\n\r\n// 格式刷同步的属性\r\nexport const formatAttrs: Set<string> = new Set([\r\n  'borderRadius',\r\n  // 'rotate',\r\n  'paddingLeft',\r\n  'paddingRight',\r\n  'paddingTop',\r\n  'paddingBottom',\r\n  'progress',\r\n  'progressColor',\r\n  'verticalProgress',\r\n  'reverseProgress',\r\n  // 'flip',\r\n  'flipX',\r\n  'flipY',\r\n  'input',\r\n  'lineDash',\r\n  'lineCap',\r\n  'lineJoin',\r\n  'strokeType',\r\n  'lineGradientFromColor',\r\n  'lineGradientToColor',\r\n  'lineGradientAngle',\r\n  'color',\r\n  'hoverColor',\r\n  'activeColor',\r\n  'lineWidth',\r\n  'bkType',\r\n  'gradientFromColor',\r\n  'gradientToColor',\r\n  'gradientAngle',\r\n  'gradientRadius',\r\n  'hoverBackground',\r\n  'activeBackground',\r\n  'globalAlpha',\r\n  'anchorColor',\r\n  'anchorRadius',\r\n  'shadowColor',\r\n  'shadowBlur',\r\n  'shadowOffsetX',\r\n  'shadowOffsetY',\r\n  'textHasShadow',\r\n  'fontFamily',\r\n  'fontSize',\r\n  'textColor',\r\n  'hoverTextColor',\r\n  'activeTextColor',\r\n  'textBackground',\r\n  'fontStyle',\r\n  'fontWeight',\r\n  'textAlign',\r\n  'textBaseline',\r\n  'lineHeight',\r\n  'whiteSpace',\r\n  'textWidth',\r\n  'textHeight',\r\n  'textLeft',\r\n  'textTop',\r\n  'ellipsis',\r\n  'hiddenText',\r\n  'keepDecimal',\r\n  'borderWidth',\r\n  'borderColor',\r\n  'animateLineWidth',\r\n  'lineAnimateType',\r\n  'frames',\r\n  'animateColor',\r\n  'animateType',\r\n  'animateReverse',\r\n  'background',\r\n  'gradientColors',\r\n  'lineGradientColors',\r\n  'animateLineWidth',\r\n  'gradientSmooth',\r\n  'lineSmooth',\r\n  'animations'\r\n]);\r\n\r\n/**\r\n * 清空 pen 的 生命周期\r\n */\r\nexport function clearLifeCycle(pen: Pen) {\r\n  pen.onAdd = undefined;\r\n  pen.onValue = undefined;\r\n  pen.onBeforeValue = undefined;\r\n  pen.onDestroy = undefined;\r\n  pen.onMove = undefined;\r\n  pen.onResize = undefined;\r\n  pen.onRotate = undefined;\r\n  pen.onClick = undefined;\r\n  pen.onMouseEnter = undefined;\r\n  pen.onMouseLeave = undefined;\r\n  pen.onMouseDown = undefined;\r\n  pen.onMouseMove = undefined;\r\n  pen.onMouseUp = undefined;\r\n  pen.onShowInput = undefined;\r\n  pen.onInput = undefined;\r\n  pen.onChangeId = undefined;\r\n  pen.onBinds = undefined;\r\n  pen.onStartVideo = undefined;\r\n  pen.onPauseVideo = undefined;\r\n  pen.onStopVideo = undefined;\r\n  pen.onRenderPenRaw = undefined;\r\n  pen.onKeyDown = undefined;\r\n  pen.onContextmenu = undefined;\r\n  pen.onScale = undefined;\r\n  pen.onWheel = undefined;\r\n  pen.onConnectLine = undefined;\r\n}\r\n","export enum HoverType {\r\n  None,\r\n  LineAnchor,\r\n  NodeAnchor,\r\n  Line,\r\n  Node,\r\n  Resize,\r\n  Rotate,\r\n  LineAnchorPrev,\r\n  LineAnchorNext,\r\n}\r\n\r\nexport enum HotkeyType {\r\n  None,\r\n  Translate,\r\n  Select, // TODO: 未实现\r\n  Resize,\r\n  AddAnchor,\r\n}\r\n\r\nexport enum MouseRight {\r\n  None,\r\n  Down,\r\n  Translate,\r\n}\r\n\r\nexport enum Direction {\r\n  None = -1,\r\n  Up,\r\n  Right,\r\n  Bottom,\r\n  Left,\r\n}\r\n\r\nexport const defaultCursors = [\r\n  'nw-resize',\r\n  'ne-resize',\r\n  'se-resize',\r\n  'sw-resize',\r\n] as const;\r\nexport const rotatedCursors = [\r\n  'n-resize',\r\n  'e-resize',\r\n  's-resize',\r\n  'w-resize',\r\n] as const;\r\n\r\nexport const defaultDrawLineFns = ['curve', 'polyline', 'line'];\r\n\r\nexport const inheritanceProps = [\r\n  'dash',\r\n  'lineWidth',\r\n  'lineCap',\r\n  'lineJoin',\r\n  'strokeType',\r\n  'color',\r\n  'lineGradientFromColor',\r\n  'lineGradientToColor',\r\n  'lineGradientAngle',\r\n  'globalAlpha',\r\n  'bkType',\r\n  'background',\r\n  'gradientFromColor',\r\n  'gradientToColor',\r\n  'gradientAngle',\r\n  'gradientRadius',\r\n  'fontFamily',\r\n  'fontSize',\r\n  'textColor',\r\n  'hoverTextColor',\r\n  'activeTextColor',\r\n  'textBackground',\r\n  'fontStyle',\r\n  'fontWeight',\r\n  'textAlign',\r\n  'textBaseline',\r\n  'lineHeight',\r\n  'whiteSpace',\r\n  'textLeft',\r\n  'textTop',\r\n  'flipX',\r\n  'flipY',\r\n  'lineDash',\r\n  'visible',\r\n  'iconColor'\r\n];\r\n","import { Direction } from '../data';\r\nimport { Pen } from '../pen';\r\nimport { pointInRect } from '../rect';\r\nimport { Meta2dStore } from '../store';\r\n\r\nexport enum PrevNextType {\r\n  Mirror,\r\n  Bilateral,\r\n  Free,\r\n}\r\n\r\nexport enum TwoWay {\r\n  Default,\r\n  In,\r\n  Out,\r\n  DisableConnected, // 禁止被连接\r\n  DisableConnectTo, // 禁止连线锚点连接其他锚点\r\n  Disable = 10,\r\n}\r\n\r\nexport enum PointType {\r\n  Default,\r\n  Line,\r\n}\r\n\r\nexport interface Point {\r\n  x: number;\r\n  y: number;\r\n  radius?: number;\r\n  color?: string;\r\n  background?: string;\r\n  id?: string;\r\n  penId?: string;\r\n  // line连接的pen.id\r\n  connectTo?: string;\r\n  // line连接的pen的anchor.id\r\n  anchorId?: string;\r\n  twoWay?: TwoWay;\r\n  prev?: Point;\r\n  next?: Point;\r\n  prevNextType?: PrevNextType;\r\n  start?: boolean;\r\n  lineLength?: number;\r\n  step?: number;\r\n  curvePoints?: Point[];\r\n  rotate?: number; //线锚点 [0,180)\r\n  hidden?: boolean;\r\n  locked?: number;\r\n  flag?: number;\r\n  // 临时绘制的点\r\n  isTemp?: boolean;\r\n  // 拖拽停靠的锚点\r\n  dockAnchorId?: string;\r\n  direction?: Direction; //锚点出线方向\r\n  title?: string; //锚点hover提示文字\r\n  type?: PointType;\r\n  length?: number;\r\n  distance?: number;\r\n}\r\n\r\nexport function rotatePoint(pt: Point, angle: number, center: Point) {\r\n  if (!angle || angle % 360 === 0) {\r\n    return;\r\n  }\r\n  const a = (angle * Math.PI) / 180;\r\n  const x =\r\n    (pt.x - center.x) * Math.cos(a) -\r\n    (pt.y - center.y) * Math.sin(a) +\r\n    center.x;\r\n  const y =\r\n    (pt.x - center.x) * Math.sin(a) +\r\n    (pt.y - center.y) * Math.cos(a) +\r\n    center.y;\r\n  pt.x = x;\r\n  pt.y = y;\r\n\r\n  pt.prev && rotatePoint(pt.prev, angle, center);\r\n  pt.next && rotatePoint(pt.next, angle, center);\r\n}\r\n\r\nexport function hitPoint(pt: Point, target: Point, radius = 5, pen?: Pen) {\r\n  if (target.type === PointType.Line) {\r\n    let _rotate = pen.rotate;\r\n    if (pen.flipX) {\r\n      _rotate *= -1;\r\n    }\r\n    if (pen.flipY) {\r\n      _rotate *= -1;\r\n    }\r\n    let rotate = target.rotate + _rotate;\r\n    if (pen.flipX) {\r\n      rotate *= -1;\r\n    }\r\n    if (pen.flipY) {\r\n      rotate *= -1;\r\n    }\r\n    return pointInRect(pt, {\r\n      x:\r\n        target.x -\r\n        (target.length * pen.calculative.canvas.store.data.scale) / 2,\r\n      y: target.y - radius,\r\n      width: target.length * pen.calculative.canvas.store.data.scale,\r\n      height: radius * 2,\r\n      rotate: rotate,\r\n    });\r\n  } else {\r\n    return (\r\n      pt.x > target.x - radius &&\r\n      pt.x < target.x + radius &&\r\n      pt.y > target.y - radius &&\r\n      pt.y < target.y + radius\r\n    );\r\n  }\r\n}\r\n\r\nexport function scalePoint(pt: Point, scale: number, center: Point) {\r\n  pt.x = center.x - (center.x - pt.x) * scale;\r\n  pt.y = center.y - (center.y - pt.y) * scale;\r\n}\r\n\r\nexport function calcRotate(pt: Point, center: Point) {\r\n  if (pt.x === center.x) {\r\n    return pt.y <= center.y ? 0 : 180;\r\n  }\r\n\r\n  if (pt.y === center.y) {\r\n    return pt.x < center.x ? 270 : 90;\r\n  }\r\n\r\n  const x = pt.x - center.x;\r\n  const y = pt.y - center.y;\r\n  let angle = (Math.atan(Math.abs(x / y)) / (2 * Math.PI)) * 360;\r\n  if (x > 0 && y > 0) {\r\n    angle = 180 - angle;\r\n  } else if (x < 0 && y > 0) {\r\n    angle += 180;\r\n  } else if (x < 0 && y < 0) {\r\n    angle = 360 - angle;\r\n  }\r\n\r\n  return angle;\r\n}\r\n\r\nexport function distance(pt1: Point, pt2: Point): number {\r\n  const x = pt1.x - pt2.x;\r\n  const y = pt1.y - pt2.y;\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n\r\nexport function facePoint(pt: Point, targetPt?: Point) {\r\n  let d = Direction.None;\r\n  if (!targetPt) {\r\n    return d;\r\n  }\r\n\r\n  const disX = pt.x - targetPt.x;\r\n  const disY = pt.y - targetPt.y;\r\n\r\n  if (Math.abs(disX) > Math.abs(disY)) {\r\n    if (disX > 0) {\r\n      d = Direction.Right;\r\n    } else {\r\n      d = Direction.Left;\r\n    }\r\n  } else {\r\n    if (disY > 0) {\r\n      d = Direction.Bottom;\r\n    } else {\r\n      d = Direction.Up;\r\n    }\r\n  }\r\n\r\n  return d;\r\n}\r\n\r\nexport function translatePoint(pt: Point, x: number, y: number) {\r\n  if (!pt) {\r\n    return;\r\n  }\r\n\r\n  pt.x += x;\r\n  pt.y += y;\r\n\r\n  if (pt.next) {\r\n    pt.next.x += x;\r\n    pt.next.y += y;\r\n  }\r\n  if (pt.prev) {\r\n    pt.prev.x += x;\r\n    pt.prev.y += y;\r\n  }\r\n}\r\n\r\n/**\r\n * 是否是同一个点\r\n * @param pt1 点1\r\n * @param pt2 点2\r\n * @returns true 相同\r\n */\r\nexport function samePoint(pt1: Point, pt2: Point): boolean {\r\n  return pt1.anchorId === pt2.anchorId && pt1.connectTo === pt2.connectTo;\r\n}\r\n\r\nexport function getDistance(form: Point, to: Point, store: Meta2dStore) {\r\n  let dis =\r\n    Math.sqrt(\r\n      (form.x - to.x) * (form.x - to.x) + (form.y - to.y) * (form.y - to.y)\r\n    ) / store.data.scale;\r\n\r\n  if (to.rotate === 0) {\r\n    if (form.x < to.x) {\r\n      if (!store.pens[to.penId].flipX) {\r\n        dis *= -1;\r\n      }\r\n    } else {\r\n      if (store.pens[to.penId].flipX) {\r\n        dis *= -1;\r\n      }\r\n    }\r\n  } else {\r\n    if (form.y < to.y) {\r\n      if (!store.pens[to.penId].flipY) {\r\n        dis *= -1;\r\n      }\r\n    } else {\r\n      if (store.pens[to.penId].flipY) {\r\n        dis *= -1;\r\n      }\r\n    }\r\n  }\r\n  form.distance = dis;\r\n}\r\n","import pkg from '../../package.json';\r\nimport { Pen } from '../pen';\r\n\r\nexport const globalStore: {\r\n  version: string;\r\n  path2dDraws: {\r\n    [key: string]: (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D;\r\n  };\r\n  canvasDraws: {\r\n    [key: string]: (ctx: CanvasRenderingContext2D, pen: Pen) => void;\r\n  };\r\n  anchors: { [key: string]: (pen: Pen) => void }; // TODO: 存储的是 副作用 函数，函数内修改 anchors\r\n  htmlElements: { [key: string]: HTMLImageElement }; // 目前只存在图片资源，此处使用 HTMLImageElement\r\n} = {\r\n  version: pkg.version,\r\n  path2dDraws: {},\r\n  canvasDraws: {},\r\n  anchors: {},\r\n  htmlElements: {},\r\n};\r\n\r\nexport function register(path2dFns: {\r\n  [key: string]: (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D;\r\n}) {\r\n  Object.assign(globalStore.path2dDraws, path2dFns);\r\n}\r\n\r\nexport function registerCanvasDraw(drawFns: {\r\n  [key: string]: (ctx: CanvasRenderingContext2D, pen: Pen) => void;\r\n}) {\r\n  Object.assign(globalStore.canvasDraws, drawFns);\r\n}\r\n\r\nexport function registerAnchors(anchorsFns: {\r\n  [key: string]: (pen: Pen) => void;\r\n}) {\r\n  Object.assign(globalStore.anchors, anchorsFns);\r\n}\r\n","export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i&&i.push(e)||n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&i.splice(i.indexOf(e)>>>0,1)},emit:function(t,e){(n.get(t)||[]).slice().map(function(n){n(e)}),(n.get(\"*\")||[]).slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.es.js.map\n","import { TextAlign, TextBaseline, Pen } from './pen';\r\nimport { Point } from './point';\r\nimport { Padding } from './utils';\r\n\r\nexport enum KeydownType {\r\n  None = -1,\r\n  Document,\r\n  Canvas,\r\n}\r\n\r\nexport interface Options {\r\n  color?: string;\r\n  activeColor?: string;\r\n  activeBackground?: string;\r\n  hoverColor?: string;\r\n  hoverBackground?: string;\r\n  anchorColor?: string;\r\n  hoverAnchorColor?: string;\r\n  anchorRadius?: number;\r\n  anchorBackground?: string;\r\n  dockColor?: string;\r\n  dockPenColor?: string;\r\n  dragColor?: string;\r\n  animateColor?: string;\r\n  textColor?: string;\r\n  fontFamily?: string;\r\n  fontSize?: number;\r\n  lineHeight?: number;\r\n  textAlign?: TextAlign;\r\n  textBaseline?: TextBaseline;\r\n  rotateCursor?: string;\r\n  rightCursor?: string; // table 右箭 选中行\r\n  downCursor?: string; // table 下箭 选中列\r\n  hoverCursor?: string;\r\n  disableInput?: boolean;\r\n  disableRotate?: boolean;\r\n  disableSize?: boolean;\r\n  disableAnchor?: boolean;\r\n  autoAnchor?: boolean;\r\n  autoAlignGrid?: boolean; // 自动对齐网格\r\n  disableEmptyLine?: boolean;\r\n  disableRepeatLine?: boolean;\r\n  disableScale?: boolean;\r\n  disableTranslate?: boolean;\r\n  disableDock?: boolean; // 禁止所有停靠辅助线\r\n  disableLineDock?: boolean; // 禁止移动连线时出现辅助线\r\n  moveConnectedLine?: boolean; // 是否能移动被连接的连线\r\n  minScale?: number;\r\n  maxScale?: number;\r\n  keydown?: KeydownType;\r\n  background?: string;\r\n  shadowOffsetX?: number;\r\n  shadowOffsetY?: number;\r\n  shadowBlur?: number;\r\n  shadowColor?: string;\r\n  globalAlpha?: number;\r\n  grid?: boolean;\r\n  gridColor?: string;\r\n  gridSize?: number;\r\n  rule?: boolean;\r\n  ruleColor?: string;\r\n  ruleOptions?:{\r\n    height?:number;\r\n    background?:string; //背景颜色\r\n    underline?:boolean; \r\n    textColor?:string; //文字颜色\r\n    textLeft?:number;\r\n    textTop?:number;\r\n    baseline?:string;\r\n  },\r\n  drawingLineName?: string;\r\n  fromArrow?: string;\r\n  toArrow?: string;\r\n  autoPolyline?: boolean;\r\n  interval?: number;\r\n  animateInterval?: number;\r\n  dragAllIn?: boolean;\r\n  scroll?: boolean;\r\n  uploadFn?: (file: File) => Promise<string>; // uploadFn 优先级最高\r\n  uploadUrl?: string;\r\n  uploadParams?: Record<string, any>;\r\n  uploadHeaders?: Record<string, string>;\r\n  disableRuleLine?: boolean;\r\n  ruleLineColor?: string;\r\n  defaultAnchors?: Point[]; // 图形的默认瞄点\r\n  measureTextWidth?: boolean; // 测量文字宽度\r\n  mouseRightActive?: boolean; //是否允许右键选中节点\r\n  disableClipboard?: boolean; //是否禁止系统剪切板\r\n  drawingLineLength?: number; //绘制过程中允许的最大长度，0表示不限\r\n  disableTouchPadScale?: boolean; //是否禁止触控板缩放\r\n  cdn?: string;\r\n  x?: number;\r\n  y?: number;\r\n  width?: number;\r\n  height?: number;\r\n  polylineSpace?: number;\r\n  defaultFormat?: Pen; //默认格式刷\r\n  domShapes?: string[]; //扩展的dom节点\r\n  containerShapes?: string[]; //容器节点\r\n  textFlip?: boolean; //文字镜像\r\n  textRotate?: boolean; //文字旋转\r\n  cacheLength?: number; //缓存数据长度\r\n  unavailableKeys?: string[]; //屏蔽的快捷键\r\n  activeLineDash?: number[];\r\n  activeLineWidth?: number;\r\n  activeGlobalAlpha?: number;\r\n  diagramOptions?: { [key: string]: any };\r\n  strictScope?: boolean; //大屏严格范围\r\n  padding?: Padding; //大屏padding区域\r\n  resizeMode?: boolean;\r\n  svgPathStroke?:boolean; //svg path是否显示边框\r\n  disabledColor?: string;\r\n  disabledBackground?: string;\r\n  scaleOff?: number; //缩放偏移量\r\n  scrollButScale?: boolean; //滚动条滚动，鼠标缩放\r\n  reconnetTimes?: number; //通信重连次数\r\n  navigatorNetWork?: {\r\n    url?: string,\r\n    headers?: any,\r\n    method?: string,\r\n  }\r\n}\r\n\r\nexport const defaultOptions: Options = {\r\n  fontFamily:\r\n    '\"Hiragino Sans GB\", \"Microsoft YaHei\", \"Helvetica Neue\", Helvetica, Arial',\r\n  fontSize: 12,\r\n  lineHeight: 1.5,\r\n  textAlign: 'center',\r\n  textBaseline: 'middle',\r\n  color: '#222222',\r\n  activeColor: '#278df8',\r\n  hoverColor: 'rgba(39,141,248,0.50)',\r\n  anchorColor: '#278DF8',\r\n  hoverAnchorColor: '#FF4101',\r\n  anchorRadius: 4,\r\n  anchorBackground: '#fff',\r\n  dockColor: 'rgba(39,141,248,0.50)',\r\n  dockPenColor: '#1890FF',\r\n  dragColor: '#1890ff',\r\n  rotateCursor: 'rotate.cur',\r\n  rightCursor: 'right.cur',\r\n  downCursor: 'down.cur',\r\n  hoverCursor: 'pointer',\r\n  minScale: 0.1,\r\n  maxScale: 10,\r\n  keydown: KeydownType.Document,\r\n  gridSize: 20,\r\n  gridColor: '#e2e2e2',\r\n  ruleColor: '#888888',\r\n  drawingLineName: 'curve',\r\n  interval: 30,\r\n  animateInterval: 30,\r\n  autoPolyline: true,\r\n  autoAnchor: true,\r\n  autoAlignGrid: false,\r\n  animateColor: '#30EEDC',\r\n  ruleLineColor: '#FF4101',\r\n  shadowOffsetX: 0,\r\n  shadowOffsetY: 0,\r\n  shadowBlur: 64,\r\n  shadowColor: \"#00000014\",\r\n  globalAlpha: 1,\r\n  defaultAnchors: [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 0.5,\r\n    },\r\n  ],\r\n  measureTextWidth: true,\r\n  moveConnectedLine: true,\r\n  mouseRightActive: true,\r\n  disableClipboard: false,\r\n  drawingLineLength: 0,\r\n  disableTouchPadScale: false,\r\n  cdn: '',\r\n  polylineSpace: 10,\r\n  domShapes: [],\r\n  containerShapes:['tablePlus'],\r\n  textFlip: true,\r\n  textRotate: true,\r\n  unavailableKeys: [],\r\n  diagramOptions: {},\r\n  svgPathStroke:true\r\n};\r\n\r\nexport interface PenPlugin {\r\n  install: (pen:Pen|string,options)=>void;\r\n  uninstall: (pen:Pen|string,options)=>void;\r\n  name:string;\r\n  [key:string]:any;\r\n}\r\nexport interface PluginOptions {\r\n  plugin:PenPlugin;\r\n  options?:object;\r\n  enable?:boolean;\r\n  [key:string]:any;\r\n}\r\n","export interface Theme {\r\n  [key: string]: {\r\n    color?: string;\r\n    background?: string;\r\n    parentBackground?: string;\r\n    ruleColor?:string;\r\n    ruleOptions?:{\r\n      background?:string,\r\n      textColor?:string\r\n    }\r\n  };\r\n}\r\n\r\nexport const defaultTheme: Theme = {\r\n  dark:{\r\n    color:'#bdc7db',\r\n    background:'#1e2430',\r\n    parentBackground:'#080b0f',\r\n    ruleColor:'#222E47',\r\n    ruleOptions:{\r\n      background:'#121924',\r\n      textColor:'#6E7B91'\r\n    },\r\n  },\r\n  light:{\r\n    color:'#222222',\r\n    background:'#FFFFFF',\r\n    parentBackground:'#F0F1F2',\r\n    ruleColor:'#C8D0E1',\r\n    ruleOptions:{\r\n      background:'#F7F8FA',\r\n      textColor:'#C8D0E1'\r\n    },\r\n  }\r\n}","import { default as mitt, Emitter } from 'mitt';\r\n\r\nimport { CanvasLayer, FormItem, LockState, Pen } from '../pen';\r\nimport { defaultOptions, Options } from '../options';\r\nimport { defaultTheme, Theme } from '../theme';\r\n\r\nimport { Point } from '../point';\r\nimport { globalStore } from './global';\r\nimport { Rect } from '../rect';\r\nimport { Event, Trigger } from '../event';\r\n\r\nexport interface Meta2dData {\r\n  pens: Pen[];\r\n  x: number;\r\n  y: number;\r\n  scale: number;\r\n  // 标尺起点\r\n  origin: Point;\r\n  center: Point;\r\n  locked?: LockState;\r\n  websocket?: string;\r\n  mqtt?: string;\r\n  mqttOptions?: {\r\n    clientId?: string;\r\n    username?: string;\r\n    password?: string;\r\n    customClientId?: boolean;\r\n  };\r\n  mqttTopics?: string;\r\n  websocketProtocols?: string | string[];\r\n  background?: string;\r\n  globalAlpha?: number;\r\n  socketCbJs?: string;\r\n  initJs?: string;\r\n  grid?: boolean;\r\n  gridColor?: string;\r\n  gridSize?: number;\r\n  gridRotate?: number;\r\n  rule?: boolean;\r\n  ruleColor?: string;\r\n  fromArrow?: string;\r\n  toArrow?: string;\r\n  lineWidth?: number;\r\n  lineColor?: string; // 线条默认颜色\r\n  color?: string; // 画笔默认 color 优先级高于 options.color\r\n  textColor?: string; // 画笔文字颜色\r\n  penBackground?: string; // 画笔默认背景色\r\n  paths?: { [key: string]: string }; // paths 该图纸使用到的 svgPath ，打开后需要保存到 globalStore.paths\r\n  bkImage?: string; // 背景图片\r\n  http?: string; // http 请求 Url\r\n  httpTimeInterval?: number; // http 请求间隔\r\n  httpHeaders?: HeadersInit; //请求头\r\n  version?: string; // 版本号\r\n  id?: string;\r\n  _id?: string;\r\n  https?: HttpOptions[];\r\n  width?: number;\r\n  height?: number;\r\n  networkInterval?: number;\r\n  networks?: Network[];\r\n  iconUrls?: string[];\r\n  mockData?: Function;\r\n  name?: string;\r\n  enableMock?: boolean;\r\n  minScale?: number;\r\n  maxScale?: number;\r\n  template?: string; //模版id\r\n  cancelFirstConnect?: boolean; //http定时轮询首次是否请求\r\n  component?: boolean;\r\n  theme?: string; //主题\r\n  smoothNum?:number;//平滑量 值越大，平滑效果越好\r\n  triggers?:Trigger[]; //全局状态\r\n  dataPoints?: string[]; //数据点\r\n  dataset?:{\r\n    devices?: DataMock[]; //数据模拟\r\n  };\r\n  dataEvents?:Event[]; //数据点事件\r\n  fits?: Fit[];\r\n  disableTranslate?: boolean; //禁止平移\r\n  disableScale?: boolean; //禁止缩放\r\n}\r\n\r\nexport interface Fit {\r\n  id?:string;\r\n  name?:string;\r\n  x?:number;\r\n  y?:number;\r\n  ex?:number;\r\n  ey?:number;\r\n  width?:number;\r\n  height?:number;\r\n  children?:string[];\r\n  active?:boolean;\r\n  left?:boolean;\r\n  right?:boolean;\r\n  top?:boolean;\r\n  bottom?:boolean;\r\n  leftValue?:number;\r\n  rightValue?:number;\r\n  topValue?:number;\r\n  bottomValue?:number;\r\n}\r\n\r\nexport interface DataMock {\r\n  id: string;\r\n  label?: string;\r\n  mock?: string;\r\n  type?: string;\r\n  enableMock?: boolean;\r\n}\r\n\r\nexport interface Network {\r\n  name?: string;\r\n  protocol?: 'mqtt' | 'websocket' | 'http' | 'iot' | 'sql'| 'jetLinks';\r\n  type?: string; //subscribe\r\n  url?: string;\r\n  //websocket\r\n  protocols?: string;\r\n  //mqtt\r\n  topics?: string;\r\n  options?: {\r\n    clientId?: string;\r\n    username?: string;\r\n    password?: string;\r\n    customClientId?: boolean;\r\n  };\r\n  //http\r\n  headers?: any; //请求头\r\n  method?: string;\r\n  body?: any;\r\n  data?: Network\r\n  interval?: number; // http 请求间隔\r\n  times?: number; // 临时 重连次数\r\n  index?: number; // 临时 索引\r\n  devices?: any[]; //物联网设备,\r\n  dbId?: string; //数据库id\r\n  sql?: string; //sql语句\r\n}\r\n\r\nexport interface HttpOptions {\r\n  http?: string; // http 请求 Url\r\n  httpTimeInterval?: number; // http 请求间隔\r\n  httpHeaders?: HeadersInit; //请求头\r\n  method?: string;\r\n  body?: BodyInit | null;\r\n  times?: number; // 临时 重连次数\r\n}\r\n\r\nexport enum EditType {\r\n  Add,\r\n  Update,\r\n  Delete,\r\n  Replace\r\n}\r\n\r\nexport interface EditAction {\r\n  type?: EditType;\r\n  initPens?: Pen[];\r\n  pens?: Pen[];\r\n  step?: number; // 多次历史记录记为一次， step >= 2\r\n  origin?: Point;\r\n  scale?: number;\r\n}\r\n\r\nexport interface Meta2dStore {\r\n  id: string;\r\n  data: Meta2dData;\r\n  pens: { [key: string]: Pen };\r\n\r\n  histories?: EditAction[];\r\n  historyIndex?: number;\r\n  path2dMap: WeakMap<Pen, Path2D>;\r\n  animateMap: WeakMap<Pen, Pen>;\r\n  bindDatas: { [key: string]: { id: string; formItem: FormItem }[] };\r\n  bind?: { [key: string]: { id: string; key: string }[] };\r\n  active?: Pen[];\r\n  hover?: Pen;\r\n  lastHover?: Pen;\r\n  hoverContainer?:Pen;\r\n  lastHoverContainer?:Pen;\r\n  activeAnchor?: Point;\r\n  hoverAnchor?: Point;\r\n  pointAt?: Point;\r\n  pointAtIndex?: number;\r\n  animates: Set<Pen>;\r\n  options: Options;\r\n  theme: Theme;\r\n  emitter: Emitter;\r\n  dpiRatio?: number;\r\n  clipboard?: Meta2dClipboard;\r\n  patchFlagsBackground?: boolean; // 是否需要绘制底层图片   是否需要重绘背景，包含网格\r\n  patchFlagsTop?: boolean; // 是否需要重绘标尺\r\n  bkImg?: HTMLImageElement;\r\n  // 测试使用\r\n  fillWorldTextRect?: boolean; // 填充文本区域\r\n  cacheDatas?: {\r\n    data: Meta2dData;\r\n  }[];\r\n  patchFlagsLast?: boolean; // 清除上次图片画布层\r\n  messageEvents?: { [key: string]: { pen: Pen; event: Event }[] };\r\n  templatePens?: { [key: string]: Pen };\r\n  sameTemplate?: boolean; //标记是否是同一模版\r\n  lastScale?: number; //记录上次模版的scale\r\n  pensNetwork?: {\r\n    [key: string]: { url?: string; method?: string; headers?: any; body?: any };\r\n  };\r\n  globalTriggers?:{[key:string]:Trigger[]};\r\n}\r\n\r\nexport interface Meta2dClipboard {\r\n  meta2d?: boolean;\r\n  pens: Pen[];\r\n  origin: Point;\r\n  scale: number;\r\n  offset?: number;\r\n  page: string;\r\n  initRect?: Rect;\r\n  pos?: Point;\r\n}\r\n\r\nexport const createStore = () => {\r\n  return {\r\n    data: {\r\n      x: 0,\r\n      y: 0,\r\n      scale: 1,\r\n      pens: [],\r\n      origin: { x: 0, y: 0 },\r\n      center: { x: 0, y: 0 },\r\n      paths: {},\r\n      theme:'light'\r\n    },\r\n    histories: [],\r\n    pens: {},\r\n    path2dMap: new WeakMap(),\r\n    animateMap: new WeakMap(),\r\n    active: [],\r\n    animates: new Set(),\r\n    options: { ...defaultOptions },\r\n    theme:{ ...defaultTheme },\r\n    emitter: mitt(),\r\n    bindDatas: {},\r\n    bind: {},\r\n    pensNetwork: {},\r\n    cacheDatas: [],\r\n    messageEvents: {},\r\n    templatePens: {},\r\n    globalTriggers:{},\r\n  } as Meta2dStore;\r\n};\r\n\r\n// Return a data store, if not exists will create a store.\r\nexport const useStore = (id = 'default'): Meta2dStore => {\r\n  if (!globalStore[id]) {\r\n    globalStore[id] = createStore();\r\n    globalStore[id].id = id;\r\n  }\r\n\r\n  return globalStore[id];\r\n};\r\n\r\nexport const clearStore = (store: Meta2dStore, template?: string) => {\r\n  const isSame = store.data.template === template;\r\n  if (isSame) {\r\n    //模版一样\r\n    for (const pen of store.data.pens) {\r\n      // if (pen.template) {\r\n      if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n        store.templatePens[pen.id] = pen;\r\n      }\r\n    }\r\n  }\r\n  store.lastScale = store.data.scale;\r\n  store.data = {\r\n    x: 0,\r\n    y: 0,\r\n    scale: 1,\r\n    pens: [],\r\n    origin: { x: 0, y: 0 },\r\n    center: { x: 0, y: 0 },\r\n    paths: {},\r\n    template: isSame ? template : null,\r\n  };\r\n  store.sameTemplate = isSame;\r\n  store.pens = {};\r\n  store.histories = [];\r\n  store.historyIndex = null;\r\n  store.path2dMap = new WeakMap();\r\n  store.animateMap = new WeakMap();\r\n  store.bindDatas = {};\r\n  store.bind = {};\r\n  store.pensNetwork = {};\r\n  store.active = [];\r\n  store.hover = undefined;\r\n  store.lastHover = undefined;\r\n  store.animates.clear();\r\n};\r\n","import { Pen } from '.';\r\nimport { Canvas } from '../canvas';\r\nimport { calcRightBottom, Rect } from '../rect';\r\nimport { getFont } from './render';\r\n\r\nexport function calcTextRect(pen: Pen) {\r\n  const {\r\n    paddingTop,\r\n    paddingBottom,\r\n    paddingLeft,\r\n    paddingRight,\r\n    worldRect,\r\n    canvas,\r\n  } = pen.calculative;\r\n  let { textLeft, textTop, textWidth, textHeight } = pen.calculative;\r\n  let x = paddingLeft;\r\n  let y = paddingTop;\r\n  // if (textLeft && Math.abs(textLeft) < 1) {\r\n  //   textLeft *= worldRect.width;\r\n  // }\r\n  // if (textTop && Math.abs(textTop) < 1) {\r\n  //   textTop *= worldRect.height;\r\n  // }\r\n\r\n  const width =\r\n    worldRect.width -\r\n    paddingLeft -\r\n    paddingRight;\r\n  const height =\r\n    worldRect.height -\r\n    paddingTop -\r\n    paddingBottom;\r\n  if (textWidth && textWidth < 1) {\r\n    textWidth *= worldRect.width;\r\n  }\r\n  if (textHeight && textHeight < 1) {\r\n    textHeight *= worldRect.height;\r\n  }\r\n  if (textWidth < pen.calculative.fontSize) {\r\n    textWidth = pen.calculative.fontSize;\r\n  }\r\n  // 默认居左，居上\r\n  x += (textLeft || 0) + worldRect.x;\r\n  y += (textTop || 0) + worldRect.y;\r\n  const textAlign = pen.textAlign || canvas.store.options.textAlign;\r\n  const textBaseline = pen.textBaseline || canvas.store.options.textBaseline;\r\n\r\n  switch (textAlign) {\r\n    case 'center':\r\n      x += (width - (textWidth || width)) / 2;\r\n      break;\r\n    case 'right':\r\n      x += width - (textWidth || width);\r\n      break;\r\n  }\r\n\r\n  switch (textBaseline) {\r\n    case 'middle':\r\n      y += (height - (textHeight || height)) / 2;\r\n      break;\r\n    case 'bottom':\r\n      y += height - (textHeight || height);\r\n      break;\r\n  }\r\n\r\n  const rect: Rect = {\r\n    x,\r\n    y,\r\n    width: textWidth || width,\r\n    height: textHeight || height,\r\n  };\r\n  calcRightBottom(rect);\r\n  pen.calculative.worldTextRect = rect;\r\n\r\n  calcTextLines(pen);\r\n  pen.calculative.textDrawRect = undefined;\r\n}\r\n\r\nexport function calcTextDrawRect(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  // By default, the text is center aligned.\r\n  const lineHeight = pen.calculative.fontSize * pen.calculative.lineHeight;\r\n  const h = pen.calculative.textLines.length * lineHeight;\r\n  const textWidth = calcTextAdaptionWidth(ctx, pen); // 多行文本最大宽度\r\n  const rect = pen.calculative.worldTextRect;\r\n  let x = rect.x + (rect.width - textWidth) / 2;\r\n  let y = rect.y + (rect.height - h) / 2;\r\n  const options = pen.calculative.canvas.store.options;\r\n  const textAlign = pen.textAlign || options.textAlign;\r\n  switch (textAlign) {\r\n    case 'left':\r\n      x = rect.x;\r\n      break;\r\n    case 'right':\r\n      x = rect.x + rect.width - textWidth;\r\n      break;\r\n  }\r\n  const textBaseline = pen.textBaseline || options.textBaseline;\r\n  switch (textBaseline) {\r\n    case 'top':\r\n      y = rect.y;\r\n      break;\r\n    case 'bottom':\r\n      y = rect.ey - h;\r\n      break;\r\n  }\r\n\r\n  pen.calculative.textDrawRect = {\r\n    x,\r\n    y,\r\n    width: textWidth,\r\n    height: h,\r\n  };\r\n  calcRightBottom(pen.calculative.textDrawRect);\r\n}\r\n\r\nexport function calcTextLines(pen: Pen, text = pen.calculative.text) {\r\n  if (text == undefined) {\r\n    pen.calculative.textLines = [];\r\n    return;\r\n  }\r\n  text = text.toString();\r\n  let lines: string[] = [];\r\n  const oneRowHeight = pen.calculative.fontSize * pen.calculative.lineHeight;\r\n  const textHeight = pen.calculative.worldTextRect.height;\r\n  const calcRows = Math.floor(textHeight / oneRowHeight);\r\n  // 最小值为 1\r\n  const maxRows = calcRows > 1 ? calcRows : 1;\r\n  switch (pen.whiteSpace) {\r\n    case 'nowrap':\r\n      if (pen.ellipsis !== false) {\r\n        const allLines = wrapLines(text.split(''), pen);\r\n        if (allLines[0]) {\r\n          lines.push(allLines[0]);\r\n          if (allLines.length > 1) {\r\n            // 存在第二行，说明宽度超出\r\n            setEllipsisOnLastLine(lines);\r\n          }\r\n        }\r\n      } else {\r\n        lines.push(text);\r\n      }\r\n      break;\r\n    case 'pre-line':\r\n      lines = text.split(/[\\n]/g);\r\n      if (pen.ellipsis !== false && lines.length > maxRows) {\r\n        lines = lines.slice(0, maxRows);\r\n        setEllipsisOnLastLine(lines);\r\n      }\r\n      break;\r\n    case 'break-all':\r\n    default:\r\n      const paragraphs = text.split(/[\\n]/g);\r\n      let currentRow = 0;\r\n      outer: for (const paragraph of paragraphs) {\r\n        const words =\r\n          pen.whiteSpace === 'break-all'\r\n            ? paragraph.split('')\r\n            : getWords(paragraph);\r\n        let items = wrapLines(words, pen);\r\n        // 空行换行的情况\r\n        if (items.length === 0) items = [''];\r\n        if (pen.ellipsis != false) {\r\n          for (const l of items) {\r\n            currentRow++;\r\n            if (currentRow > maxRows) {\r\n              setEllipsisOnLastLine(lines);\r\n              break outer;\r\n            } else {\r\n              lines.push(l);\r\n            }\r\n          }\r\n        } else {\r\n          lines.push(...items);\r\n        }\r\n      }\r\n      break;\r\n  }\r\n\r\n  const keepDecimal = pen.calculative.keepDecimal;\r\n  if (keepDecimal != undefined) {\r\n    lines.forEach((text, i) => {\r\n      const textNum = Number(text);\r\n      if (!isNaN(textNum)) {\r\n        lines[i] = textNum.toFixed(keepDecimal);\r\n      }\r\n    });\r\n  }\r\n\r\n  pen.calculative.textLines = lines;\r\n\r\n  return lines;\r\n}\r\n\r\nexport function getWords(txt: string = '') {\r\n  const words: string[] = [];\r\n  let word = '';\r\n  for (let i = 0; i < txt.length; ++i) {\r\n    const ch = txt.charCodeAt(i);\r\n    if (ch < 33 || ch > 126) {\r\n      if (word) {\r\n        words.push(word);\r\n        word = '';\r\n      }\r\n      words.push(txt[i]);\r\n    } else {\r\n      word += txt[i];\r\n    }\r\n  }\r\n\r\n  if (word) {\r\n    words.push(word);\r\n  }\r\n\r\n  return words;\r\n}\r\n\r\nexport function wrapLines(words: string[], pen: Pen) {\r\n  const canvas: Canvas = pen.calculative.canvas;\r\n  const ctx = canvas.offscreen.getContext('2d') as CanvasRenderingContext2D;\r\n  const { fontStyle, fontWeight, fontSize, fontFamily, lineHeight } =\r\n    pen.calculative;\r\n  ctx.save();\r\n  const lines: string[] = [];\r\n  let currentLine = words[0] || '';\r\n  for (let i = 1; i < words.length; ++i) {\r\n    const word = words[i] || '';\r\n    const text = currentLine + word;\r\n    let currentWidth = 0;\r\n    if (canvas.store.options.measureTextWidth) {\r\n      ctx.font = getFont({\r\n        fontStyle,\r\n        fontWeight,\r\n        fontFamily: fontFamily || canvas.store.options.fontFamily,\r\n        fontSize,\r\n        lineHeight,\r\n      });\r\n      currentWidth = ctx.measureText(text).width;\r\n    } else {\r\n      // 近似计算\r\n      const chinese = text.match(/[^\\x00-\\xff]/g) || '';\r\n      const chineseWidth = chinese.length * fontSize; // 中文占用的宽度\r\n      const spaces = text.match(/\\s/g) || '';\r\n      const spaceWidth = spaces.length * fontSize * 0.3; // 空格占用的宽度\r\n      const otherWidth =\r\n        (text.length - chinese.length - spaces.length) * fontSize * 0.6; // 其他字符占用的宽度\r\n      currentWidth = chineseWidth + spaceWidth + otherWidth;\r\n    }\r\n    const textWidth = pen.calculative.worldTextRect.width;\r\n    if (currentWidth <= textWidth + 0.1) {\r\n      currentLine += word;\r\n    } else {\r\n      currentLine.length && lines.push(currentLine);\r\n      currentLine = word;\r\n    }\r\n  }\r\n  currentLine.length && lines.push(currentLine);\r\n  ctx.restore();\r\n  return lines;\r\n}\r\n\r\nexport function calcTextAdaptionWidth(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen\r\n): number {\r\n  let maxWidth = 0;\r\n  pen.calculative.textLineWidths = [];\r\n  pen.calculative.textLines.forEach((text: string) => {\r\n    const width = ctx.measureText(text).width;\r\n    pen.calculative.textLineWidths.push(width);\r\n    maxWidth < width && (maxWidth = width);\r\n  });\r\n  return maxWidth;\r\n}\r\n/**\r\n * 副作用函数，会修改传入的参数\r\n * 把最后一行的最后变成 ...\r\n * TODO: 中文的三个字符宽度比 . 大，显示起来像是删多了\r\n * @param lines\r\n */\r\nfunction setEllipsisOnLastLine(lines: string[]) {\r\n  lines[lines.length - 1] = lines[lines.length - 1].slice(0, -3) + '...';\r\n}\r\n\r\nexport function calcTextAutoWidth(pen: Pen) {\r\n  let arr = pen.text.split('\\n');\r\n  const canvas: Canvas = pen.calculative.canvas;\r\n  const ctx = canvas.offscreen.getContext('2d') as CanvasRenderingContext2D;\r\n  const { fontStyle, fontWeight, fontSize, fontFamily, lineHeight } =\r\n    pen.calculative;\r\n  let textWidth = 0; // pen.calculative.worldTextRect.width;\r\n  let currentWidth = 0; // textWidth;\r\n  ctx.save();\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (canvas.store.options.measureTextWidth) {\r\n      ctx.font = getFont({\r\n        fontStyle,\r\n        fontWeight,\r\n        fontFamily: fontFamily || canvas.store.options.fontFamily,\r\n        fontSize,\r\n        lineHeight,\r\n      });\r\n      currentWidth = ctx.measureText(arr[i]).width; //* scale;\r\n    } else {\r\n      // 近似计算\r\n      const chinese = arr[i].match(/[^\\x00-\\xff]/g) || '';\r\n      const chineseWidth = chinese.length * fontSize; // 中文占用的宽度\r\n      const spaces = arr[i].match(/\\s/g) || '';\r\n      const spaceWidth = spaces.length * fontSize * 0.3; // 空格占用的宽度\r\n      const otherWidth =\r\n        (arr[i].length - chinese.length - spaces.length) * fontSize * 0.6; // 其他字符占用的宽度\r\n      currentWidth = chineseWidth + spaceWidth + otherWidth;\r\n    }\r\n    if (currentWidth > textWidth) {\r\n      textWidth = currentWidth; //* scale;\r\n    }\r\n  }\r\n  ctx.restore();\r\n  let textHeight = arr.length * fontSize * lineHeight;\r\n  if (pen.textAlign === 'left') {\r\n    // pen.x = pen.x;\r\n  } else if (pen.textAlign === 'right') {\r\n    pen.x = pen.x - (textWidth - pen.width);\r\n  } else {\r\n    pen.x = pen.x - (textWidth - pen.width) / 2;\r\n  }\r\n\r\n  if (pen.textBaseline === 'top') {\r\n  } else if (pen.textBaseline === 'bottom') {\r\n    pen.y = pen.y - (textHeight - pen.height);\r\n  } else {\r\n    pen.y = pen.y - (textHeight - pen.height) / 2;\r\n  }\r\n  // if (textHeight > pen.height) {\r\n  pen.height = textHeight + 2;\r\n  // }\r\n  pen.width = textWidth + 2; //误差\r\n  pen.calculative.canvas.updatePenRect(pen);\r\n  pen.calculative.canvas.calcActiveRect();\r\n}\r\n","/**\r\n * 拷贝一个对象\r\n * @param o - object to clone\r\n * @param keepCalc 是否保留计算属性， false, 不保留， true, 保留（但 calculative.canvas 属性仍不保存）\r\n * @returns 拷贝后的对象\r\n */\r\nexport function deepClone<T>(o: T, keepCalc = false): T {\r\n  if (Array.isArray(o)) {\r\n    const arr = [] as T & any[];\r\n    o.forEach((item) => {\r\n      arr.push(deepClone(item, keepCalc));\r\n    });\r\n    return arr;\r\n  } else if (typeof o === 'object') {\r\n    if (o === null) {\r\n      return null;\r\n    } else if (o.constructor === RegExp) {\r\n      return o;\r\n    }\r\n    const _o = {} as T;\r\n    for (const key in o) {\r\n      if (\r\n        ['canvas', 'lastFrame'].includes(key) ||\r\n        o[key] instanceof HTMLImageElement ||\r\n        o[key] instanceof HTMLMediaElement\r\n      ) {\r\n        continue;\r\n      } else if (key === 'calculative' && !keepCalc) {\r\n        continue;\r\n      } else if (key === 'singleton') {\r\n        if (keepCalc) {\r\n          _o[key] = {} as any;\r\n        } else {\r\n          _o[key] = o[key];\r\n        }\r\n        continue;\r\n      }\r\n      _o[key] = deepClone(o[key], keepCalc);\r\n    }\r\n    return _o;\r\n  }\r\n\r\n  return o;\r\n}\r\n\r\nexport function deepSetValue<T>(o: any, keyWords: string[], value: number): T {\r\n  if (Array.isArray(o)) {\r\n    const arr = [] as T & any[];\r\n    o.forEach((item) => {\r\n      arr.push(deepSetValue(item, keyWords, value));\r\n    });\r\n    return arr;\r\n  } else if (typeof o === 'object') {\r\n    if (o === null) {\r\n      return null;\r\n    }\r\n    // const _o = {} as any;\r\n    for (const key in o) {\r\n      if (keyWords.includes(key)) {\r\n        if(Array.isArray(o[key])){\r\n          o[key].forEach((i,index)=>{\r\n            if(!Number.isNaN(Number(i))){\r\n              o[key][index] = Number(i * value);\r\n            }\r\n          });\r\n        }else {\r\n          if(Number.isNaN(Number(o[key]))){\r\n            continue;\r\n          }\r\n          o[key] = Number(o[key]) * value;\r\n        }\r\n      } else {\r\n        o[key] = deepSetValue(o[key], keyWords, value);\r\n      }\r\n    }\r\n    return o;\r\n  }\r\n  return o;\r\n}\r\n","import { calcRotate, Point } from '../point';\r\nimport { Meta2dStore } from '../store';\r\nimport { Pen } from './model';\r\nimport { getFromAnchor, getToAnchor } from './render';\r\n\r\nconst arrows: Record<\r\n  string,\r\n  (\r\n    ctx: CanvasRenderingContext2D,\r\n    pen: Pen,\r\n    store: Meta2dStore,\r\n    point: Point\r\n  ) => void\r\n> = {};\r\n\r\nexport function renderFromArrow(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore\r\n) {\r\n  if (!arrows[pen.fromArrow]) {\r\n    return;\r\n  }\r\n  const from = getFromAnchor(pen);\r\n  const { x, y } = from;\r\n  const pt: Point = { x, y };\r\n  pt.step = (pen.fromArrowSize || 10) * store.data.scale;\r\n  if (from.next) {\r\n    pt.rotate = calcRotate(from.next, from) + 90;\r\n  } else {\r\n    const p = pen.calculative.worldAnchors[1];\r\n    if (!p) {\r\n      return;\r\n    }\r\n    if (p.prev) {\r\n      pt.rotate = calcRotate(p.prev, from) + 90;\r\n    } else {\r\n      pt.rotate = calcRotate(p, from) + 90;\r\n    }\r\n  }\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.setLineDash([]);\r\n  const fromArrowColor = pen.fromArrowColor || pen.calculative.color;\r\n  fromArrowColor && (ctx.strokeStyle = fromArrowColor);\r\n  arrows[pen.fromArrow](ctx, pen, store, pt);\r\n  ctx.restore();\r\n}\r\n\r\nexport function renderToArrow(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore\r\n) {\r\n  if (!arrows[pen.toArrow] || pen.calculative.worldAnchors.length < 2) {\r\n    return;\r\n  }\r\n  ctx.save();\r\n  const to = getToAnchor(pen);\r\n  const { x, y } = to;\r\n  const pt: Point = { x, y };\r\n  pt.step = (pen.toArrowSize || 10) * store.data.scale;\r\n  if (to.prev) {\r\n    pt.rotate = calcRotate(to.prev, to) + 90;\r\n  } else {\r\n    const p =\r\n      pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 2];\r\n    if (p.next) {\r\n      pt.rotate = calcRotate(p.next, to) + 90;\r\n    } else {\r\n      pt.rotate = calcRotate(p, to) + 90;\r\n    }\r\n  }\r\n  ctx.beginPath();\r\n  ctx.setLineDash([]);\r\n  const toArrowColor = pen.toArrowColor || pen.calculative.color;\r\n  toArrowColor && (ctx.strokeStyle = toArrowColor);\r\n  arrows[pen.toArrow](ctx, pen, store, pt);\r\n  ctx.restore();\r\n}\r\n\r\narrows.triangleSolid = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  ctx.moveTo(fromX, point.y - point.step / 4);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.lineTo(fromX, point.y + point.step / 4);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.fillStyle = ctx.strokeStyle;\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.triangle = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  if (ctx.lineWidth < 2) {\r\n    ctx.lineWidth = 2;\r\n  }\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  ctx.moveTo(fromX, point.y - point.step / 4);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.lineTo(fromX, point.y + point.step / 4);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.fillStyle = store.data.background || '#ffffff';\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.circleSolid = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const r = point.step / 2;\r\n  ctx.arc(point.x - r, point.y, r, 0, 2 * Math.PI);\r\n  ctx.stroke();\r\n  ctx.fillStyle = ctx.strokeStyle;\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.circle = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const r = point.step / 2;\r\n  ctx.arc(point.x - r, point.y, r, 0, 2 * Math.PI);\r\n  ctx.stroke();\r\n  ctx.fillStyle = store.data.background || '#ffffff';\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.diamondSolid = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  const r = point.step / 2;\r\n  ctx.moveTo(fromX, point.y);\r\n  ctx.lineTo(fromX + r, point.y - r / 2);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.lineTo(fromX + r, point.y + r / 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.fillStyle = ctx.strokeStyle;\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.diamond = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  const r = point.step / 2;\r\n  ctx.moveTo(fromX, point.y);\r\n  ctx.lineTo(fromX + r, point.y - r / 2);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.lineTo(fromX + r, point.y + r / 2);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n  ctx.fillStyle = store.data.background || '#ffffff';\r\n  ctx.fill();\r\n  ctx.restore();\r\n};\r\n\r\narrows.line = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  ctx.moveTo(fromX, point.y - point.step / 3);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.lineTo(fromX, point.y + point.step / 3);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n\r\narrows.lineUp = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  ctx.moveTo(fromX, point.y - point.step / 3);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n\r\narrows.lineDown = (\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  point: Point\r\n) => {\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.rotate((point.rotate * Math.PI) / 180);\r\n  ctx.translate(-point.x, -point.y);\r\n  const fromX = point.x - point.step;\r\n  ctx.moveTo(fromX, point.y + point.step / 3);\r\n  ctx.lineTo(point.x, point.y);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n","// pSBC - Shade Blend Convert - Version 4.0 - 02/18/2019\r\n// https://github.com/PimpTrizkit/PJs/edit/master/pSBC.js\r\n\r\nexport function pSBCr(d) {\r\n  const i = parseInt,\r\n    m = Math.round;\r\n  let n = d.length,\r\n    x: any = {};\r\n  if (n > 9) {\r\n    const [r, g, b, a] = (d = d.split(','));\r\n    n = d.length;\r\n    if (n < 3 || n > 4) return null;\r\n    (x.r = i(r[3] == 'a' ? r.slice(5) : r.slice(4))),\r\n      (x.g = i(g)),\r\n      (x.b = i(b)),\r\n      (x.a = a ? parseFloat(a) : -1);\r\n  } else {\r\n    if (n == 8 || n == 6 || n < 4) return null;\r\n    if (n < 6)\r\n      d =\r\n        '#' +\r\n        d[1] +\r\n        d[1] +\r\n        d[2] +\r\n        d[2] +\r\n        d[3] +\r\n        d[3] +\r\n        (n > 4 ? d[4] + d[4] : '');\r\n    d = i(d.slice(1), 16);\r\n    if (n == 9 || n == 5)\r\n      (x.r = (d >> 24) & 255),\r\n        (x.g = (d >> 16) & 255),\r\n        (x.b = (d >> 8) & 255),\r\n        (x.a = m((d & 255) / 0.255) / 1000);\r\n    else (x.r = d >> 16), (x.g = (d >> 8) & 255), (x.b = d & 255), (x.a = -1);\r\n  }\r\n  return x;\r\n}\r\n\r\n/*\r\nexample：\r\npSBC ( 0.42, color1 ); // rgb(20,60,200) + [42% Lighter] => rgb(166,171,225)\r\npSBC ( -0.4, color5 ); // #F3A + [40% Darker] => #c62884\r\n\r\npSBC ( -0.5, color2, color8, true ); // rgba(20,60,200,0.67423) + rgba(200,60,20,0.98631) + [50% Blend] => rgba(110,60,110,0.83)\r\npSBC ( 0.7, color2, color7, true ); // rgba(20,60,200,0.67423) + rgb(200,60,20) + [70% Blend] => rgba(146,60,74,0.67423)\r\n\r\nmore:\r\nhttps://github-wiki-see.page/m/PimpTrizkit/PJs/wiki/12.-Shade%2C-Blend-and-Convert-a-Web-Color-%28pSBC.js%29\r\n*/\r\n\r\nexport function pSBC(p, c0, c1?, l?) {\r\n  let r,\r\n    g,\r\n    b,\r\n    P,\r\n    f,\r\n    t,\r\n    h,\r\n    m = Math.round,\r\n    a: any = typeof c1 == 'string';\r\n  if (\r\n    typeof p != 'number' ||\r\n    p < -1 ||\r\n    p > 1 ||\r\n    typeof c0 != 'string' ||\r\n    (c0[0] != 'r' && c0[0] != '#') ||\r\n    (c1 && !a)\r\n  )\r\n    return null;\r\n  (h = c0.length > 9),\r\n    (h = a ? (c1.length > 9 ? true : c1 == 'c' ? !h : false) : h),\r\n    (f = pSBCr(c0)),\r\n    (P = p < 0),\r\n    (t =\r\n      c1 && c1 != 'c'\r\n        ? pSBCr(c1)\r\n        : P\r\n        ? { r: 0, g: 0, b: 0, a: -1 }\r\n        : { r: 255, g: 255, b: 255, a: -1 }),\r\n    (p = P ? p * -1 : p),\r\n    (P = 1 - p);\r\n  if (!f || !t) return null;\r\n  if (l)\r\n    (r = m(P * f.r + p * t.r)),\r\n      (g = m(P * f.g + p * t.g)),\r\n      (b = m(P * f.b + p * t.b));\r\n  else\r\n    (r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5)),\r\n      (g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5)),\r\n      (b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5));\r\n  (a = f.a),\r\n    (t = t.a),\r\n    (f = a >= 0 || t >= 0),\r\n    (a = f ? (a < 0 ? t : t < 0 ? a : a * P + t * p) : 0);\r\n  if (h)\r\n    return (\r\n      'rgb' +\r\n      (f ? 'a(' : '(') +\r\n      r +\r\n      ',' +\r\n      g +\r\n      ',' +\r\n      b +\r\n      (f ? ',' + m(a * 1000) / 1000 : '') +\r\n      ')'\r\n    );\r\n  else\r\n    return (\r\n      '#' +\r\n      (4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0))\r\n        .toString(16)\r\n        .slice(1, f ? undefined : -2)\r\n    );\r\n}\r\n\r\nglobalThis.pSBC = pSBC;\r\n\r\nexport function rgba(c: string, p: number) {\r\n  const f = pSBCr(c) || { r: 0, g: 0, b: 0 };\r\n  if (f.a < 0) {\r\n    return `rgba(${f.r},${f.g},${f.b},${p})`;\r\n  }\r\n\r\n  return `rgba(${f.r},${f.g},${f.b},${p + f.a})`;\r\n}\r\n","export function abs(num: number, percent: number | string): number {\r\n  if (+percent) {\r\n    return +percent;\r\n  }\r\n\r\n  if (!percent || percent[(percent as string).length - 1] !== '%') {\r\n    return 0;\r\n  }\r\n\r\n  percent = (percent as string).substr(0, (percent as string).length - 1);\r\n\r\n  return (num * +percent) / 100;\r\n}\r\n\r\n/**\r\n * 实际值是否在范围中, 数学上的开闭\r\n * @param realValue 实际值\r\n * @param collection 集合规范，与数学上相同，如[0, 100]，前闭后闭；如[0, 100)，前闭后开；\r\n * @returns undefined 说明参数不规范 ，true 说明在范围内，false 说明不在范围内\r\n */\r\nexport function valueInRange(realValue: number, collection: unknown): boolean {\r\n  if (isNaN(realValue)) {\r\n    console.warn(`realValue not number`);\r\n    return;\r\n  }\r\n  if (typeof collection !== 'string') {\r\n    console.warn('collection must be string');\r\n    return;\r\n  }\r\n  const [start, end] = [collection[0], collection[collection.length - 1]];\r\n  if (!['[', '('].includes(start)) {\r\n    console.warn('collection must start with \"[\" or \"(\"');\r\n    return;\r\n  }\r\n  if (![']', ')'].includes(end)) {\r\n    console.warn('collection must end with \"]\" or \")\"');\r\n    return;\r\n  }\r\n  const nums = collection.substring(1, collection.length - 1).split(',');\r\n  if (nums.length !== 2) {\r\n    console.warn('collection must have 2 numbers');\r\n    return;\r\n  }\r\n  const [startNum, endNum] = [+nums[0], +nums[1]];\r\n  if (startNum >= endNum) {\r\n    console.warn('startNum must less than endNum');\r\n    return;\r\n  }\r\n  // 大于 startNum 左肯定成立\r\n  const left =\r\n    realValue > startNum || (start === '[' && realValue === startNum)\r\n      ? true\r\n      : false;\r\n  if (!left) {\r\n    return false;\r\n  }\r\n  // 执行到这，左边已经是true了，判断右边\r\n  const right =\r\n    realValue < endNum || (end === ']' && realValue === endNum) ? true : false;\r\n\r\n  return right;\r\n}\r\n\r\n/**\r\n * 实际值是否在数组中，即是否属于\r\n * 例如: [1,2,3] 只有 1 2 3 是属于 collection 的\r\n * .. 范围值 30..50 等于 闭区间的 [30,50] ，即范围值\r\n * [1,20,30..50,65] 只有 1 20 30..50 65 是属于 collection 的\r\n * @param realValue 实际值\r\n * @param collection 集合\r\n * @returns undefined 说明参数不规范 ，true 说明在范围内，false 说明不在范围内\r\n */\r\nexport function valueInArray(realValue: any, collection: unknown): boolean {\r\n  // if (isNaN(realValue)) {\r\n  //   console.warn(`realValue not number`);\r\n  //   return;\r\n  // }\r\n  //允许字符串的情况\r\n  if (typeof collection !== 'string') {\r\n    console.warn('collection must be string');\r\n    return;\r\n  }\r\n  const [start, end] = [collection[0], collection[collection.length - 1]];\r\n  if (start !== '[' || end !== ']') {\r\n    console.warn('collection must start with \"[\" and end with \"]\"');\r\n    return;\r\n  }\r\n  const numStrs = collection.substring(1, collection.length - 1).split(',');\r\n  for (const numStr of numStrs) {\r\n    if (numStr.includes('..')) {\r\n      // 范围值\r\n      const [start, end] = numStr.split('..');\r\n      const [startNum, endNum] = [+start, +end];\r\n      if (startNum >= endNum) {\r\n        console.warn('startNum must less than endNum');\r\n        return;\r\n      }\r\n      if (realValue >= startNum && realValue <= endNum) {\r\n        return true;\r\n      }\r\n    } else {\r\n      // 单个值\r\n      // let num:any = +numStr;\r\n      // if(Number.isNaN(num)){\r\n      //   num = numStr;\r\n      //   const [start, end] = [num[0], num[num.length - 1]];\r\n      //   if (!((start !== '\"' && end !== '\"')||(start !== \"'\" && end !== \"'\"))) {\r\n      //     console.warn('Not a valid string');\r\n      //     return;\r\n      //   }else{\r\n      //     num = num.substring(1, num.length - 1)\r\n      //   }\r\n      // }\r\n      if (realValue == numStr) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n","export function s4() {\r\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport function s8() {\r\n  return (((1 + Math.random()) * 0x100000000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport function s12() {\r\n  return s4() + s8();\r\n}\r\n\r\nexport function s16() {\r\n  return s8() + s8();\r\n}","export type Padding = number | string | number[];\r\n\r\n/**\r\n * turn padding into [top, right, bottom, left]\r\n * @param  {Number|Array} padding input padding\r\n * @return {array} output\r\n */\r\nexport const formatPadding = (padding: Padding): number[] => {\r\n  let top = 0;\r\n  let left = 0;\r\n  let right = 0;\r\n  let bottom = 0;\r\n\r\n  if (typeof padding === 'number') {\r\n    top = left = right = bottom = padding;\r\n  } else if (typeof padding === 'string') {\r\n    const intPadding = parseInt(padding, 10);\r\n    top = left = right = bottom = intPadding;\r\n  } else if (Array.isArray(padding)) {\r\n    top = padding[0];\r\n    right = !isNil(padding[1]) ? padding[1] : padding[0];\r\n    bottom = !isNil(padding[2]) ? padding[2] : padding[0];\r\n    left = !isNil(padding[3]) ? padding[3] : right;\r\n  }\r\n  return [top, right, bottom, left];\r\n};\r\n\r\n/**\r\n * Checks if `value` is `null` or `undefined`.\r\n *\r\n * @since 4.0.0\r\n * @category Lang\r\n * @param {*} value The value to check.\r\n * @returns {boolean} Returns `true` if `value` is nullish, else `false`.\r\n * @example\r\n *\r\n * isNil(null)\r\n * // => true\r\n *\r\n * isNil(void 0)\r\n * // => true\r\n *\r\n * isNil(NaN)\r\n * // => false\r\n */\r\nfunction isNil(value: unknown): value is null {\r\n  return value == null;\r\n}\r\n","export async function fileToBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      resolve(e.target.result as string);\r\n    };\r\n    reader.onerror = (e) => {\r\n      reject(e);\r\n    };\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\nexport async function uploadFile(\r\n  file: File,\r\n  url: string,\r\n  params: Record<string, any>,\r\n  headers: Record<string, string>\r\n): Promise<string> {\r\n  const formData = new FormData();\r\n  // 后端接受的 formData 文件属性名一定为 file\r\n  formData.append('file', file);\r\n  if (params) {\r\n    for (const key in params) {\r\n      if (params.hasOwnProperty(key)) {\r\n        formData.append(key, params[key]);\r\n      }\r\n    }\r\n  }\r\n  const res = await fetch(url, {\r\n    method: 'POST',\r\n    headers,\r\n    body: formData,\r\n  });\r\n  // 后端返回的一级属性中，必须包含一个名为url的属性\r\n  return (await res.json()).url;\r\n}\r\n\r\nexport function loadCss(url: string, success?: any, error?: any) {\r\n  var link = document.createElement('link');\r\n  link.href = url;\r\n  link.rel = 'stylesheet';\r\n  success && (link.onload = success);\r\n  error && (link.onerror = error);\r\n  document.head.appendChild(link);\r\n}\r\n","export function queryURLParams(value?: string) {\r\n  let url = value || window.location.search.split('?')[1];\r\n  const urlSearchParams = new URLSearchParams(url);\r\n  const params = Object.fromEntries(urlSearchParams.entries());\r\n  return params;\r\n}\r\n\r\nexport const getRootDomain = () => {\r\n  let domain = '';\r\n  const domainItems = location.hostname.split('.');\r\n  if (\r\n    domainItems.length < 3 ||\r\n    (domainItems.length === 4 &&\r\n      +domainItems[0] > 0 &&\r\n      +domainItems[1] > 0 &&\r\n      +domainItems[2] > 0 &&\r\n      +domainItems[3] > 0)\r\n  ) {\r\n    domain = location.hostname;\r\n  } else if (\r\n    location.hostname.endsWith('.com.cn') ||\r\n    location.hostname.endsWith('.org.cn')\r\n  ) {\r\n    domain = domainItems.slice(-3).join('.');\r\n  } else {\r\n    domain = domainItems.slice(-2).join('.');\r\n  }\r\n\r\n  return domain;\r\n};\r\n","// const obj = {a:{b:[0,1,2]}}\r\n// getter(obj, 'a.b.1')\r\nexport function getter(object: any, path: string) {\r\n  if (path == undefined) {\r\n    return object;\r\n  }\r\n  const arr = path.split('.');\r\n  while (arr.length && (object = object[arr.shift()]));\r\n  return object;\r\n}\r\n\r\n// setter(obj, 'a.b.1', 111)\r\nexport function setter(object: any, path: string, value: any) {\r\n  if (path == undefined) {\r\n    return;\r\n  }\r\n  path\r\n    .split('.')\r\n    .reduce(\r\n      (o, p, i) => (o[p] = path.split('.').length === ++i ? value : o[p] || {}),\r\n      object\r\n    );\r\n}\r\n","export function formatTime(format?: string) {\r\n  const weeks = ['天', '一', '二', '三', '四', '五', '六'];\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = now.getMonth() + 1;\r\n  const day = now.getDate();\r\n  const week = now.getDay();\r\n  const hours = now.getHours();\r\n  const minutes = now.getMinutes();\r\n  const seconds = now.getSeconds();\r\n  const fn = new Function(\r\n    'year',\r\n    'month',\r\n    'day',\r\n    'week',\r\n    'hours',\r\n    'minutes',\r\n    'seconds',\r\n    format\r\n      ? `return ${format}`\r\n      : 'return `${year}:${month}:${day} ${hours}:${minutes}:${seconds} 星期${week}`'\r\n  );\r\n  const time = fn(year, month, day, weeks[week], hours, minutes, seconds);\r\n  return time;\r\n}\r\n","import {\r\n  CanvasLayer,\r\n  ColorStop,\r\n  IValue,\r\n  LineAnimateType,\r\n  LockState,\r\n  Pen,\r\n} from './model';\r\nimport { drawArrow, getLineRect, getSplitAnchor } from '../diagrams';\r\nimport { Direction, inheritanceProps } from '../data';\r\nimport {\r\n  calcRotate,\r\n  distance,\r\n  facePoint,\r\n  Point,\r\n  rotatePoint,\r\n  scalePoint,\r\n  translatePoint,\r\n  TwoWay,\r\n} from '../point';\r\nimport {\r\n  calcCenter,\r\n  calcRightBottom,\r\n  calcRelativePoint,\r\n  calcRelativeRect,\r\n  Rect,\r\n  rectInRect,\r\n  scaleRect,\r\n  translateRect,\r\n  calcPivot,\r\n} from '../rect';\r\nimport { globalStore, Meta2dStore } from '../store';\r\nimport { calcTextLines, calcTextDrawRect, calcTextRect } from './text';\r\nimport { deepClone } from '../utils/clone';\r\nimport { renderFromArrow, renderToArrow } from './arrow';\r\nimport { Gradient, isEqual, PenType } from '../pen';\r\nimport { pSBC, rgba } from '../utils';\r\nimport { Canvas } from '../canvas';\r\n\r\n/**\r\n * ancestor 是否是 pen 的祖先\r\n * @param pen 当前画笔\r\n * @param ancestor 祖先画笔\r\n */\r\nexport function isAncestor(pen: Pen, ancestor: Pen) {\r\n  if (!pen || !ancestor) {\r\n    return false;\r\n  }\r\n  let parent = getParent(pen);\r\n  while (parent) {\r\n    if (parent.id === ancestor.id) {\r\n      return true;\r\n    }\r\n    parent = getParent(parent);\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function getParent(pen: Pen, root?: boolean): Pen {\r\n  if (!pen || !pen.parentId || !pen.calculative) {\r\n    return undefined;\r\n  }\r\n\r\n  const store = pen.calculative.canvas.store;\r\n  const parent = store.pens[pen.parentId];\r\n  if (!root) {\r\n    return parent;\r\n  }\r\n  return getParent(parent, root) || parent;\r\n}\r\n\r\nexport function getAllChildren(pen: Pen, store: Meta2dStore): Pen[] {\r\n  if (!pen || !pen.children) {\r\n    return [];\r\n  }\r\n  const children: Pen[] = [];\r\n  pen.children.forEach((id) => {\r\n    const child = store.pens[id];\r\n    if (child) {\r\n      children.push(child);\r\n      children.push(...getAllChildren(child, store));\r\n    }\r\n  });\r\n  return children;\r\n}\r\n\r\nexport function getAllFollowers(pen: Pen, store: Meta2dStore): Pen[] {\r\n  if (!pen || !pen.followers) {\r\n    return [];\r\n  }\r\n  const followers: Pen[] = [];\r\n  pen.followers.forEach((id) => {\r\n    const follower = store.pens[id];\r\n    if (follower && !follower.parentId) {\r\n      followers.push(follower);\r\n      followers.push(...getAllFollowers(follower, store));\r\n    }\r\n  });\r\n  return followers;\r\n}\r\n\r\nfunction drawBkLinearGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { worldRect, gradientFromColor, gradientToColor, gradientAngle } =\r\n    pen.calculative;\r\n  return linearGradient(\r\n    ctx,\r\n    worldRect,\r\n    gradientFromColor,\r\n    gradientToColor,\r\n    gradientAngle\r\n  );\r\n}\r\n\r\n/**\r\n * 避免副作用，把创建好后的径向渐变对象返回出来\r\n * @param ctx 画布绘制对象\r\n * @param pen 当前画笔\r\n * @returns 径向渐变\r\n */\r\nfunction drawBkRadialGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { worldRect, gradientFromColor, gradientToColor, gradientRadius } =\r\n    pen.calculative;\r\n  if (!gradientFromColor || !gradientToColor) {\r\n    return;\r\n  }\r\n\r\n  const { width, height, center } = worldRect;\r\n  const { x: centerX, y: centerY } = center;\r\n  let r = width;\r\n  if (r < height) {\r\n    r = height;\r\n  }\r\n  r *= 0.5;\r\n  const grd = ctx.createRadialGradient(\r\n    centerX,\r\n    centerY,\r\n    r * (gradientRadius || 0),\r\n    centerX,\r\n    centerY,\r\n    r\r\n  );\r\n  grd.addColorStop(0, gradientFromColor);\r\n  grd.addColorStop(1, gradientToColor);\r\n\r\n  return grd;\r\n}\r\n\r\nfunction getLinearGradientPoints(\r\n  x1: number,\r\n  y1: number,\r\n  x2: number,\r\n  y2: number,\r\n  r: number\r\n) {\r\n  let slantAngle = 0;\r\n  slantAngle = Math.PI / 2 - Math.atan2(y2 - y1, x2 - x1);\r\n  const originX = (x1 + x2) / 2;\r\n  const originY = (y1 + y2) / 2;\r\n\r\n  const perpX1 = originX + r * Math.sin((90 * Math.PI) / 180 - slantAngle);\r\n  const perpY1 = originY + r * -Math.cos((90 * Math.PI) / 180 - slantAngle);\r\n\r\n  const perpX2 = originX + r * Math.sin((270 * Math.PI) / 180 - slantAngle);\r\n  const perpY2 = originY + r * -Math.cos((270 * Math.PI) / 180 - slantAngle);\r\n\r\n  return [perpX1, perpY1, perpX2, perpY2];\r\n}\r\n\r\nfunction getBkRadialGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { worldRect, gradientColors, gradientRadius } = pen.calculative;\r\n  if (!gradientColors) {\r\n    return;\r\n  }\r\n  let color = pen.calculative.gradientColors;\r\n  if(pen.calculative.checked){\r\n    color = pen.calculative.onGradientColors;\r\n  }\r\n  const { width, height, center } = worldRect;\r\n  const { x: centerX, y: centerY } = center;\r\n  let r = width;\r\n  if (r < height) {\r\n    r = height;\r\n  }\r\n  r *= 0.5;\r\n  const { colors } = formatGradient(color);\r\n  const grd = ctx.createRadialGradient(\r\n    centerX,\r\n    centerY,\r\n    r * (gradientRadius || 0),\r\n    centerX,\r\n    centerY,\r\n    r\r\n  );\r\n  colors.forEach((stop) => {\r\n    grd.addColorStop(stop.i, stop.color);\r\n  });\r\n\r\n  return grd;\r\n}\r\n\r\nfunction getBkGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, ex, width, height, center } = pen.calculative.worldRect;\r\n  let points = [\r\n    { x: ex, y: y + height / 2 },\r\n    { x: x, y: y + height / 2 },\r\n  ];\r\n  let color = pen.calculative.gradientColors;\r\n  if(pen.calculative.checked){\r\n    color = pen.calculative.onGradientColors;\r\n  }\r\n  const { angle, colors } = formatGradient(color);\r\n  let r = getGradientR(angle, width, height);\r\n  points.forEach((point) => {\r\n    rotatePoint(point, angle, center);\r\n  });\r\n  return getLinearGradient(ctx, points, colors, r);\r\n}\r\n\r\nfunction getTextRadialGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { worldRect, textGradientColors } = pen.calculative;\r\n  if (!textGradientColors) {\r\n    return;\r\n  }\r\n\r\n  const { width, height, center } = worldRect;\r\n  const { x: centerX, y: centerY } = center;\r\n  let r = width;\r\n  if (r < height) {\r\n    r = height;\r\n  }\r\n  r *= 0.5;\r\n  const { colors } = formatGradient(textGradientColors);\r\n  const grd = ctx.createRadialGradient(\r\n    centerX,\r\n    centerY,\r\n    0,\r\n    centerX,\r\n    centerY,\r\n    r\r\n  );\r\n  colors.forEach((stop) => {\r\n    grd.addColorStop(stop.i, stop.color);\r\n  });\r\n\r\n  return grd;\r\n}\r\n\r\nfunction getTextGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, ex, width, height, center } = pen.calculative.worldRect;\r\n  let points = [\r\n    { x: ex, y: y + height / 2 },\r\n    { x: x, y: y + height / 2 },\r\n  ];\r\n  const { angle, colors } = formatGradient(pen.calculative.textGradientColors);\r\n  let r = getGradientR(angle, width, height);\r\n  points.forEach((point) => {\r\n    rotatePoint(point, angle, center);\r\n  });\r\n  return getLinearGradient(ctx, points, colors, r);\r\n}\r\n\r\nfunction getGradientR(angle: number, width: number, height: number) {\r\n  const dividAngle = (Math.atan(height / width) / Math.PI) * 180;\r\n  let calculateAngle = (angle - 90) % 360;\r\n  let r = 0;\r\n  if (\r\n    (calculateAngle > dividAngle && calculateAngle < 180 - dividAngle) ||\r\n    (calculateAngle > 180 + dividAngle && calculateAngle < 360 - dividAngle) ||\r\n    calculateAngle < 0\r\n  ) {\r\n    //根据高计算\r\n    if (calculateAngle > 270) {\r\n      calculateAngle = 360 - calculateAngle;\r\n    } else if (calculateAngle > 180) {\r\n      calculateAngle = calculateAngle - 180;\r\n    } else if (calculateAngle > 90) {\r\n      calculateAngle = 180 - calculateAngle;\r\n    }\r\n    r = Math.abs(height / Math.sin((calculateAngle / 180) * Math.PI) / 2);\r\n  } else {\r\n    //根据宽计算\r\n    if (calculateAngle > 270) {\r\n      calculateAngle = 360 - calculateAngle;\r\n    } else if (calculateAngle > 180) {\r\n      calculateAngle = calculateAngle - 180;\r\n    } else if (calculateAngle > 90) {\r\n      calculateAngle = 180 - calculateAngle;\r\n    }\r\n    r = Math.abs(width / Math.cos((calculateAngle / 180) * Math.PI) / 2);\r\n  }\r\n  return r;\r\n}\r\n\r\nfunction formatGradient(color: string) {\r\n  if (typeof color == 'string' && color.startsWith('linear-gradient')) {\r\n    let arr = color.slice(16, -2).split('deg,');\r\n    if (arr.length > 1) {\r\n      let _arr = arr[1].split('%,');\r\n      const colors = [];\r\n      _arr.forEach((stap) => {\r\n        if (/rgba?/.test(stap)) {\r\n          let _arr = stap.split(') ');\r\n          colors.push({\r\n            color: rgbaToHex(_arr[0] + ')'),\r\n            i: parseFloat(_arr[1]) / 100,\r\n          });\r\n        } else {\r\n          let _arr = stap.split(' ');\r\n          if (_arr.length > 2) {\r\n            colors.push({\r\n              color: _arr[1],\r\n              i: parseFloat(_arr[2]) / 100,\r\n            });\r\n          } else {\r\n            colors.push({\r\n              color: _arr[0],\r\n              i: parseFloat(_arr[1]) / 100,\r\n            });\r\n          }\r\n        }\r\n      });\r\n      return {\r\n        angle: parseFloat(arr[0]),\r\n        colors,\r\n      };\r\n    } else {\r\n      return {\r\n        angle: parseFloat(arr[0]),\r\n        colors: [],\r\n      };\r\n    }\r\n  } else {\r\n    return {\r\n      angle: 0,\r\n      colors: [],\r\n    };\r\n  }\r\n}\r\n\r\nfunction rgbaToHex(value) {\r\n  if (/rgba?/.test(value)) {\r\n    let array = value.split(',');\r\n    //不符合rgb或rgb规则直接return\r\n    if (array.length < 3) return '';\r\n    value = '#';\r\n    for (let i = 0, color; (color = array[i++]); ) {\r\n      if (i < 4) {\r\n        //前三位转换成16进制\r\n        color = parseInt(color.replace(/[^\\d]/gi, ''), 10).toString(16);\r\n        value += color.length == 1 ? '0' + color : color;\r\n      } else {\r\n        //rgba的透明度转换成16进制\r\n        color = color.replace(')', '');\r\n        let colorA = parseInt(color * 255 + '');\r\n        let colorAHex = colorA.toString(16);\r\n        colorAHex = colorAHex.length === 2 ? colorAHex : '0' + colorAHex;\r\n        value += colorAHex;\r\n      }\r\n    }\r\n    value = value.toUpperCase();\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction getLineGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, ex, width, height, center } = pen.calculative.worldRect;\r\n  let points = [\r\n    { x: ex, y: y + height / 2 },\r\n    { x: x, y: y + height / 2 },\r\n  ];\r\n\r\n  const { angle, colors } = formatGradient(pen.calculative.lineGradientColors);\r\n  let r = getGradientR(angle, width, height);\r\n\r\n  points.forEach((point) => {\r\n    rotatePoint(point, angle, center);\r\n  });\r\n  return getLinearGradient(ctx, points, colors, r);\r\n}\r\n\r\nfunction getLinearGradient(\r\n  ctx: CanvasRenderingContext2D,\r\n  points: Point[],\r\n  colors: ColorStop[],\r\n  radius: number\r\n): CanvasGradient {\r\n  let arr = getLinearGradientPoints(\r\n    points[0].x,\r\n    points[0].y,\r\n    points[1].x,\r\n    points[1].y,\r\n    radius\r\n  );\r\n  let gradient = ctx.createLinearGradient(arr[0], arr[1], arr[2], arr[3]);\r\n  colors.forEach((stop) => {\r\n    gradient.addColorStop(stop.i, stop.color);\r\n  });\r\n  return gradient;\r\n}\r\n\r\nfunction drawLinearGradientLine(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  points: Point[]\r\n) {\r\n  let colors = [];\r\n  if (pen.calculative.gradientColorStop) {\r\n    colors = pen.calculative.gradientColorStop;\r\n  } else {\r\n    colors = formatGradient(pen.calculative.lineGradientColors).colors;\r\n    pen.calculative.gradientColorStop = colors;\r\n  }\r\n  ctx.strokeStyle = getLinearGradient(\r\n    ctx,\r\n    points,\r\n    colors,\r\n    pen.calculative.lineWidth / 2\r\n  );\r\n  ctx.beginPath();\r\n  ctx.moveTo(points[0].x, points[0].y);\r\n  ctx.lineTo(points[1].x, points[1].y);\r\n  ctx.stroke();\r\n}\r\n\r\nfunction ctxDrawLinearGradientPath(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const anchors = pen.calculative.worldAnchors;\r\n  let smoothLenth =\r\n    pen.calculative.lineWidth *\r\n    (pen.calculative.gradientSmooth || pen.calculative.lineSmooth || 0);\r\n  for (let i = 0; i < anchors.length - 1; i++) {\r\n    if (\r\n      (pen.lineName === 'curve' || pen.lineName === 'mind') &&\r\n      anchors[i].curvePoints\r\n    ) {\r\n      if (i > 0) {\r\n        let lastCurvePoints = anchors[i - 1].curvePoints;\r\n        if (lastCurvePoints) {\r\n          //上一个存在锚点\r\n          smoothTransition(\r\n            ctx,\r\n            pen,\r\n            smoothLenth,\r\n            lastCurvePoints[lastCurvePoints.length - 1],\r\n            anchors[i],\r\n            anchors[i].curvePoints[0]\r\n          );\r\n        } else {\r\n          smoothTransition(\r\n            ctx,\r\n            pen,\r\n            smoothLenth,\r\n            anchors[i - 1],\r\n            anchors[i],\r\n            anchors[i].curvePoints[0]\r\n          );\r\n        }\r\n        //获取当前相对于0的位置\r\n        let next = getSmoothAdjacent(\r\n          smoothLenth,\r\n          anchors[i],\r\n          anchors[i].curvePoints[0]\r\n        );\r\n        drawLinearGradientLine(ctx, pen, [next, anchors[i].curvePoints[1]]);\r\n      } else {\r\n        drawLinearGradientLine(ctx, pen, [\r\n          anchors[i],\r\n          anchors[i].curvePoints[0],\r\n        ]);\r\n        drawLinearGradientLine(ctx, pen, [\r\n          anchors[i].curvePoints[0],\r\n          anchors[i].curvePoints[1],\r\n        ]);\r\n      }\r\n      let len = anchors[i].curvePoints.length - 1;\r\n      for (let j = 1; j < len; j++) {\r\n        drawLinearGradientLine(ctx, pen, [\r\n          anchors[i].curvePoints[j],\r\n          anchors[i].curvePoints[j + 1],\r\n        ]);\r\n      }\r\n      let last = getSmoothAdjacent(\r\n        smoothLenth,\r\n        anchors[i + 1],\r\n        anchors[i].curvePoints[len]\r\n      );\r\n      drawLinearGradientLine(ctx, pen, [anchors[i].curvePoints[len], last]);\r\n    } else {\r\n      let _next = anchors[i];\r\n      let _last = anchors[i + 1];\r\n      if (i > 0 && i < anchors.length - 1) {\r\n        //有突兀的地方\r\n        let lastCurvePoints = anchors[i - 1].curvePoints;\r\n        if (lastCurvePoints) {\r\n          smoothTransition(\r\n            ctx,\r\n            pen,\r\n            smoothLenth,\r\n            lastCurvePoints[lastCurvePoints.length - 1],\r\n            anchors[i],\r\n            anchors[i + 1]\r\n          );\r\n        } else {\r\n          smoothTransition(\r\n            ctx,\r\n            pen,\r\n            smoothLenth,\r\n            anchors[i - 1],\r\n            anchors[i],\r\n            anchors[i + 1]\r\n          );\r\n        }\r\n      }\r\n      if (i > 0 && i < anchors.length - 1) {\r\n        _next = getSmoothAdjacent(smoothLenth, anchors[i], anchors[i + 1]);\r\n      }\r\n      if (i < anchors.length - 2) {\r\n        _last = getSmoothAdjacent(smoothLenth, anchors[i + 1], anchors[i]);\r\n      }\r\n      let flag = false;\r\n      if (i === 0) {\r\n        if (pen.fromLineCap && pen.fromLineCap !== 'butt') {\r\n          ctx.save();\r\n          flag = true;\r\n          ctx.lineCap = pen.fromLineCap;\r\n        }\r\n      }\r\n      if (i !== 0 && i === anchors.length - 2) {\r\n        if (pen.toLineCap && pen.toLineCap !== 'butt') {\r\n          ctx.save();\r\n          flag = true;\r\n          ctx.lineCap = pen.toLineCap;\r\n        }\r\n      }\r\n\r\n      drawLinearGradientLine(ctx, pen, [_next, _last]);\r\n      if (flag) {\r\n        ctx.restore();\r\n      }\r\n      if (anchors.length === 2 && i === 0) {\r\n        ctx.save();\r\n        flag = true;\r\n        ctx.lineCap = pen.toLineCap;\r\n        let _y = 0.1;\r\n        let _x = 0.1;\r\n        if (_next.x - _last.x === 0) {\r\n          _x = 0;\r\n        } else {\r\n          _y = ((_next.y - _last.y) / (_next.x - _last.x)) * 0.1;\r\n        }\r\n        drawLinearGradientLine(ctx, pen, [\r\n          { x: _last.x - _x, y: _last.y - _y },\r\n          _last,\r\n        ]);\r\n        ctx.restore();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getSmoothAdjacent(smoothLenth: number, p1: Point, p2: Point) {\r\n  let nexLength = Math.sqrt(\r\n    (p2.x - p1.x) * (p2.x - p1.x) + (p2.y - p1.y) * (p2.y - p1.y)\r\n  );\r\n  if (nexLength === 0) {\r\n    return {\r\n      x: p1.x,\r\n      y: p1.y,\r\n    };\r\n  }\r\n  if (smoothLenth < nexLength) {\r\n    return {\r\n      x: p1.x + ((p2.x - p1.x) * smoothLenth) / nexLength,\r\n      y: p1.y + ((p2.y - p1.y) * smoothLenth) / nexLength,\r\n    };\r\n  } else {\r\n    return {\r\n      x: p1.x + (p2.x - p1.x) / nexLength / 2,\r\n      y: p1.y + (p2.y - p1.y) / nexLength / 2,\r\n    };\r\n  }\r\n}\r\n\r\nfunction smoothTransition(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  smoothLenth: number,\r\n  p1: Point,\r\n  p2: Point,\r\n  p3: Point\r\n) {\r\n  let last = getSmoothAdjacent(smoothLenth, p2, p1);\r\n  let next = getSmoothAdjacent(smoothLenth, p2, p3);\r\n  let contrlPoint = { x: p2.x, y: p2.y };\r\n\r\n  let points = getBezierPoints(\r\n    pen.calculative.canvas.store.data.smoothNum || 20,\r\n    last,\r\n    contrlPoint,\r\n    next\r\n  );\r\n  for (let k = 0; k < points.length - 1; k++) {\r\n    drawLinearGradientLine(ctx, pen, [\r\n      {\r\n        x: points[k].x,\r\n        y: points[k].y,\r\n      },\r\n      {\r\n        x: points[k + 1].x,\r\n        y: points[k + 1].y,\r\n      },\r\n    ]);\r\n  }\r\n}\r\n\r\nfunction smoothAnimateTransition(\r\n  ctx: Path2D,\r\n  smoothLenth: number,\r\n  p2: Point,\r\n  p3: Point\r\n) {\r\n  let next = getSmoothAdjacent(smoothLenth, p2, p3);\r\n  let contrlPoint = { x: p2.x, y: p2.y };\r\n\r\n  ctx.quadraticCurveTo(contrlPoint.x, contrlPoint.y, next.x, next.y);\r\n}\r\n\r\nexport function getGradientAnimatePath(pen: Pen) {\r\n  const anchors = pen.calculative.worldAnchors;\r\n  let smoothLenth =\r\n    pen.calculative.lineWidth *\r\n    (pen.calculative.gradientSmooth || pen.calculative.lineSmooth || 0);\r\n  //只创建一次\r\n  const _path = new Path2D();\r\n  for (let i = 0; i < anchors.length - 1; i++) {\r\n    let _next = anchors[i];\r\n    let _last = anchors[i + 1];\r\n    if (i == 0) {\r\n      _path.moveTo(anchors[i].x, anchors[i].y);\r\n    }\r\n    if (i > 0 && i < anchors.length - 1) {\r\n      //有突兀的地方\r\n      let lastCurvePoints = anchors[i - 1].curvePoints;\r\n      // const path = new Path2D();\r\n      if (lastCurvePoints) {\r\n        smoothAnimateTransition(_path, smoothLenth, anchors[i], anchors[i + 1]);\r\n      } else {\r\n        smoothAnimateTransition(_path, smoothLenth, anchors[i], anchors[i + 1]);\r\n      }\r\n    }\r\n    if (i > 0 && i < anchors.length - 1) {\r\n      _next = getSmoothAdjacent(smoothLenth, anchors[i], anchors[i + 1]);\r\n    }\r\n    if (i < anchors.length - 2) {\r\n      _last = getSmoothAdjacent(smoothLenth, anchors[i + 1], anchors[i]);\r\n    }\r\n    _path.lineTo(_last.x, _last.y);\r\n  }\r\n\r\n  return _path;\r\n}\r\n\r\nfunction getAngle(p1: Point, p2: Point, p3: Point) {\r\n  let a = { x: 0, y: 0 },\r\n    b = { x: 0, y: 0 };\r\n  a.x = p1.x - p2.x;\r\n  a.y = p1.y - p2.y;\r\n  b.x = p3.x - p2.x;\r\n  b.y = p3.y - p2.y;\r\n\r\n  return (\r\n    (Math.acos(\r\n      (a.x * b.x + a.y * b.y) /\r\n        (Math.sqrt(a.x * a.x + a.y * a.y) * Math.sqrt(b.x * b.x + b.y * b.y))\r\n    ) /\r\n      Math.PI) *\r\n    180\r\n  );\r\n}\r\n\r\nfunction getBezierPoints(\r\n  num = 100,\r\n  p1?: Point,\r\n  p2?: Point,\r\n  p3?: Point,\r\n  p4?: Point\r\n) {\r\n  let func = null;\r\n  const points = [];\r\n  if (!p3 && !p4) {\r\n    func = oneBezier;\r\n  } else if (p3 && !p4) {\r\n    func = twoBezier;\r\n  } else if (p3 && p4) {\r\n    func = threeBezier;\r\n  }\r\n  for (let i = 0; i < num; i++) {\r\n    points.push(func(i / num, p1, p2, p3, p4));\r\n  }\r\n  if (p4) {\r\n    points.push(p4);\r\n  } else if (p3) {\r\n    points.push(p3);\r\n  }\r\n  return points;\r\n}\r\n\r\n/**\r\n * @desc 一阶贝塞尔\r\n * @param  t 当前百分比\r\n * @param  p1 起点坐标\r\n * @param  p2 终点坐标\r\n */\r\nfunction oneBezier(t: number, p1: Point, p2: Point) {\r\n  const { x: x1, y: y1 } = p1;\r\n  const { x: x2, y: y2 } = p2;\r\n  let x = x1 + (x2 - x1) * t;\r\n  let y = y1 + (y2 - y1) * t;\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * @desc 二阶贝塞尔\r\n * @param  t 当前百分比\r\n * @param  p1 起点坐标\r\n * @param  p2 终点坐标\r\n * @param  cp 控制点\r\n */\r\nfunction twoBezier(t: number, p1: Point, cp: Point, p2: Point) {\r\n  const { x: x1, y: y1 } = p1;\r\n  const { x: cx, y: cy } = cp;\r\n  const { x: x2, y: y2 } = p2;\r\n  let x = (1 - t) * (1 - t) * x1 + 2 * t * (1 - t) * cx + t * t * x2;\r\n  let y = (1 - t) * (1 - t) * y1 + 2 * t * (1 - t) * cy + t * t * y2;\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * @desc 三阶贝塞尔\r\n * @param  t 当前百分比\r\n * @param  p1 起点坐标\r\n * @param  p2 终点坐标\r\n * @param  cp1 控制点1\r\n * @param  cp2 控制点2\r\n */\r\nfunction threeBezier(t: number, p1: Point, cp1: Point, cp2: Point, p2: Point) {\r\n  const { x: x1, y: y1 } = p1;\r\n  const { x: x2, y: y2 } = p2;\r\n  const { x: cx1, y: cy1 } = cp1;\r\n  const { x: cx2, y: cy2 } = cp2;\r\n  let x =\r\n    x1 * (1 - t) * (1 - t) * (1 - t) +\r\n    3 * cx1 * t * (1 - t) * (1 - t) +\r\n    3 * cx2 * t * t * (1 - t) +\r\n    x2 * t * t * t;\r\n  let y =\r\n    y1 * (1 - t) * (1 - t) * (1 - t) +\r\n    3 * cy1 * t * (1 - t) * (1 - t) +\r\n    3 * cy2 * t * t * (1 - t) +\r\n    y2 * t * t * t;\r\n  return { x, y };\r\n}\r\n\r\nfunction strokeLinearGradient(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const {\r\n    worldRect,\r\n    lineGradientFromColor,\r\n    lineGradientToColor,\r\n    lineGradientAngle,\r\n  } = pen.calculative;\r\n  return linearGradient(\r\n    ctx,\r\n    worldRect,\r\n    lineGradientFromColor,\r\n    lineGradientToColor,\r\n    lineGradientAngle\r\n  );\r\n}\r\n\r\n/**\r\n * 避免副作用，把创建好后的线性渐变对象返回出来\r\n * @param ctx 画布绘制对象\r\n * @param worldRect 世界坐标\r\n * @returns 线性渐变\r\n */\r\nfunction linearGradient(\r\n  ctx: CanvasRenderingContext2D,\r\n  worldRect: Rect,\r\n  fromColor: string,\r\n  toColor: string,\r\n  angle: number\r\n) {\r\n  if (!fromColor || !toColor) {\r\n    return;\r\n  }\r\n\r\n  const { x, y, center, ex, ey } = worldRect;\r\n  const from: Point = {\r\n    x,\r\n    y: center.y,\r\n  };\r\n  const to: Point = {\r\n    x: ex,\r\n    y: center.y,\r\n  };\r\n  if (angle % 90 === 0 && angle % 180) {\r\n    from.x = center.x;\r\n    to.x = center.x;\r\n    if (angle % 270) {\r\n      from.y = y;\r\n      to.y = ey;\r\n    } else {\r\n      from.y = ey;\r\n      to.y = y;\r\n    }\r\n  } else if (angle) {\r\n    rotatePoint(from, angle, worldRect.center);\r\n    rotatePoint(to, angle, worldRect.center);\r\n  }\r\n\r\n  // contributor: https://github.com/sunnyguohua/meta2d\r\n  const grd = ctx.createLinearGradient(from.x, from.y, to.x, to.y);\r\n  grd.addColorStop(0, fromColor);\r\n  grd.addColorStop(1, toColor);\r\n  return grd;\r\n}\r\n\r\n/**\r\n * 根据图片的宽高， imageRatio iconAlign 来获取图片的实际位置\r\n * @param pen 画笔\r\n */\r\nfunction getImagePosition(pen: Pen) {\r\n  const {\r\n    worldIconRect: rect,\r\n    iconWidth,\r\n    iconHeight,\r\n    imgNaturalWidth,\r\n    imgNaturalHeight,\r\n  } = pen.calculative;\r\n  let { x, y, width: w, height: h } = rect;\r\n  if (iconWidth) {\r\n    w = iconWidth;\r\n  }\r\n  if (iconHeight) {\r\n    h = iconHeight;\r\n  }\r\n  if (imgNaturalWidth && imgNaturalHeight && pen.imageRatio) {\r\n    const scaleW = rect.width / imgNaturalWidth;\r\n    const scaleH = rect.height / imgNaturalHeight;\r\n    const scaleMin = Math.min(scaleW, scaleH);\r\n    const wDivideH = imgNaturalWidth / imgNaturalHeight;\r\n    if (iconWidth) {\r\n      h = iconWidth / wDivideH;\r\n    } else if (iconHeight) {\r\n      w = iconHeight * wDivideH;\r\n    } else {\r\n      w = scaleMin * imgNaturalWidth;\r\n      h = scaleMin * imgNaturalHeight;\r\n    }\r\n  }\r\n  x += (rect.width - w) / 2;\r\n  y += (rect.height - h) / 2;\r\n\r\n  switch (pen.iconAlign) {\r\n    case 'top':\r\n      y = rect.y;\r\n      break;\r\n    case 'bottom':\r\n      y = rect.ey - h;\r\n      break;\r\n    case 'left':\r\n      x = rect.x;\r\n      break;\r\n    case 'right':\r\n      x = rect.ex - w;\r\n      break;\r\n    case 'left-top':\r\n      x = rect.x;\r\n      y = rect.y;\r\n      break;\r\n    case 'right-top':\r\n      x = rect.ex - w;\r\n      y = rect.y;\r\n      break;\r\n    case 'left-bottom':\r\n      x = rect.x;\r\n      y = rect.ey - h;\r\n      break;\r\n    case 'right-bottom':\r\n      x = rect.ex - w;\r\n      y = rect.ey - h;\r\n      break;\r\n  }\r\n\r\n  return {\r\n    x,\r\n    y,\r\n    width: w,\r\n    height: h,\r\n  };\r\n}\r\n\r\nexport function drawImage(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen\r\n) {\r\n  const { x, y, width, height } = getImagePosition(pen);\r\n  const { worldIconRect, iconRotate, img } = pen.calculative;\r\n\r\n  if (iconRotate) {\r\n    const { x: centerX, y: centerY } = worldIconRect.center;\r\n    ctx.translate(centerX, centerY);\r\n    ctx.rotate((iconRotate * Math.PI) / 180);\r\n    ctx.translate(-centerX, -centerY);\r\n  }\r\n  if (pen.imageRadius) {\r\n    ctx.save();\r\n    let wr = pen.calculative.imageRadius || 0,\r\n      hr = wr;\r\n    const {\r\n      x: _x,\r\n      y: _y,\r\n      width: w,\r\n      height: h,\r\n      ex,\r\n      ey,\r\n    } = pen.calculative.worldRect;\r\n    if (wr < 1) {\r\n      wr = w * wr;\r\n      hr = h * hr;\r\n    }\r\n    let r = wr < hr ? wr : hr;\r\n    if (w < 2 * r) {\r\n      r = w / 2;\r\n    }\r\n    if (h < 2 * r) {\r\n      r = h / 2;\r\n    }\r\n    ctx.beginPath();\r\n\r\n    ctx.moveTo(_x + r, _y);\r\n    ctx.arcTo(ex, _y, ex, ey, r);\r\n    ctx.arcTo(ex, ey, _x, ey, r);\r\n    ctx.arcTo(_x, ey, _x, _y, r);\r\n    ctx.arcTo(_x, _y, ex, _y, r);\r\n    ctx.clip();\r\n    ctx.drawImage(img, x, y, width, height);\r\n    ctx.restore();\r\n  } else {\r\n    ctx.drawImage(img, x, y, width, height);\r\n  }\r\n}\r\n\r\n/**\r\n * 获取文字颜色， textColor 优先其次 color\r\n */\r\nexport function getTextColor(pen: Pen, store: Meta2dStore) {\r\n  const { textColor, color } = pen.calculative;\r\n  const { data, options } = store;\r\n  return (\r\n    textColor ||\r\n    color ||\r\n    data.textColor ||\r\n    data.color ||\r\n    options.textColor ||\r\n    options.color\r\n  );\r\n}\r\n\r\nfunction drawText(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const {\r\n    fontStyle,\r\n    fontWeight,\r\n    fontSize,\r\n    fontFamily,\r\n    lineHeight,\r\n    text,\r\n    hiddenText,\r\n    canvas,\r\n    textHasShadow,\r\n    textBackground,\r\n    textType,\r\n  } = pen.calculative;\r\n  if (text == undefined || hiddenText) {\r\n    return;\r\n  }\r\n  const store = canvas.store;\r\n  ctx.save();\r\n  if (!textHasShadow) {\r\n    ctx.shadowBlur = 0;\r\n    ctx.shadowOffsetX = 0;\r\n    ctx.shadowOffsetY = 0;\r\n  }\r\n  let fill: string = undefined;\r\n  if (pen.calculative.disabled) {\r\n    fill =\r\n      pen.disabledTextColor ||\r\n      pen.disabledColor ||\r\n      pSBC(0.4, getTextColor(pen, store));\r\n  } else if (pen.calculative.hover) {\r\n    fill = pen.hoverTextColor || pen.hoverColor || store.options.hoverColor;\r\n  } else if (pen.calculative.active) {\r\n    fill = pen.activeTextColor || pen.activeColor || store.options.activeColor;\r\n  }\r\n  let gradient = undefined;\r\n  if (textType === Gradient.Linear) {\r\n    gradient = getTextGradient(ctx, pen);\r\n  } else if (textType === Gradient.Radial) {\r\n    gradient = getTextRadialGradient(ctx, pen);\r\n  }\r\n  ctx.fillStyle = fill || gradient || getTextColor(pen, store);\r\n  ctx.font = getFont({\r\n    fontStyle,\r\n    fontWeight,\r\n    fontFamily: fontFamily || store.options.fontFamily,\r\n    fontSize,\r\n    lineHeight,\r\n  });\r\n\r\n  !pen.calculative.textDrawRect && calcTextDrawRect(ctx, pen);\r\n  const {\r\n    x: drawRectX,\r\n    y: drawRectY,\r\n    width,\r\n    height,\r\n  } = pen.calculative.textDrawRect;\r\n  if (textBackground) {\r\n    ctx.save();\r\n    ctx.fillStyle = textBackground;\r\n    ctx.fillRect(drawRectX, drawRectY, width, height);\r\n    ctx.restore();\r\n  }\r\n\r\n  const y = 0.55;\r\n  const textAlign = pen.textAlign || store.options.textAlign;\r\n  const oneRowHeight = fontSize * lineHeight;\r\n  pen.calculative.textLines.forEach((text, i) => {\r\n    const textLineWidth = pen.calculative.textLineWidths[i];\r\n    let x = 0;\r\n    if (textAlign === 'center') {\r\n      x = (width - textLineWidth) / 2;\r\n    } else if (textAlign === 'right') {\r\n      x = width - textLineWidth;\r\n    }\r\n    // 下划线\r\n    ctx.fillText(text, drawRectX + x, drawRectY + (i + y) * oneRowHeight);\r\n    const { textDecorationColor, textDecorationDash, textDecoration } = pen;\r\n    if (textDecoration) {\r\n      drawUnderLine(\r\n        ctx,\r\n        {\r\n          x: drawRectX + x,\r\n          y: drawRectY + (i + y) * oneRowHeight,\r\n          width: textLineWidth,\r\n        },\r\n        { textDecorationColor, textDecorationDash, fontSize }\r\n      );\r\n    }\r\n    // 删除线\r\n    const { textStrickoutColor, textStrickoutDash, textStrickout } = pen;\r\n    if (textStrickout) {\r\n      drawStrickout(\r\n        ctx,\r\n        {\r\n          x: drawRectX + x,\r\n          y: drawRectY + (i + y) * oneRowHeight,\r\n          width: textLineWidth,\r\n        },\r\n        { textStrickoutColor, textStrickoutDash, fontSize }\r\n      );\r\n    }\r\n  });\r\n  ctx.restore();\r\n}\r\nfunction drawUnderLine(\r\n  ctx: CanvasRenderingContext2D,\r\n  location: any,\r\n  config: any\r\n) {\r\n  const { textDecorationColor, textDecorationDash, fontSize } = config;\r\n  let { x, y, width } = location;\r\n  switch (ctx.textBaseline) {\r\n    case 'top':\r\n      y += fontSize;\r\n      break;\r\n    case 'middle':\r\n      y += fontSize / 2;\r\n      break;\r\n  }\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = textDecorationColor ? textDecorationColor : ctx.fillStyle;\r\n  ctx.lineWidth = 1;\r\n  ctx.moveTo(x, y);\r\n  ctx.setLineDash(textDecorationDash || []);\r\n  ctx.lineTo(x + width, y);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\nfunction drawStrickout(\r\n  ctx: CanvasRenderingContext2D,\r\n  location: any,\r\n  config: any\r\n) {\r\n  const { textStrickoutColor, textStrickoutDash, fontSize } = config;\r\n  let { x, y, width } = location;\r\n  switch (ctx.textBaseline) {\r\n    case 'top':\r\n      y += fontSize / 2;\r\n      break;\r\n    case 'bottom':\r\n      y -= fontSize / 2;\r\n      break;\r\n  }\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = textStrickoutColor ? textStrickoutColor : ctx.fillStyle;\r\n  ctx.lineWidth = 1;\r\n  ctx.moveTo(x, y);\r\n  ctx.setLineDash(textStrickoutDash || []);\r\n  ctx.lineTo(x + width, y);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\nfunction drawFillText(ctx: CanvasRenderingContext2D, pen: Pen, text: string) {\r\n  if (text == undefined) {\r\n    return;\r\n  }\r\n\r\n  const { fontStyle, fontWeight, fontSize, fontFamily, lineHeight, canvas } =\r\n    pen.calculative;\r\n\r\n  const store = canvas.store;\r\n  ctx.save();\r\n\r\n  let fill: string = undefined;\r\n  if (pen.calculative.hover) {\r\n    fill = pen.hoverTextColor || pen.hoverColor || store.options.hoverColor;\r\n  } else if (pen.calculative.active) {\r\n    fill = pen.activeTextColor || pen.activeColor || store.options.activeColor;\r\n  }\r\n  ctx.fillStyle = fill || getTextColor(pen, store);\r\n\r\n  ctx.font = getFont({\r\n    fontStyle,\r\n    fontWeight,\r\n    fontFamily: fontFamily || store.options.fontFamily,\r\n    fontSize,\r\n    lineHeight,\r\n  });\r\n\r\n  const w = ctx.measureText(text).width;\r\n  let t: string;\r\n\r\n  let prev: Point;\r\n  for (const anchor of pen.calculative.worldAnchors) {\r\n    if (!prev) {\r\n      prev = anchor;\r\n      continue;\r\n    }\r\n\r\n    const dis = distance(prev, anchor);\r\n\r\n    const n = Math.floor(dis / w);\r\n    t = '';\r\n    for (let i = 0; i < n; i++) {\r\n      t += text;\r\n    }\r\n\r\n    const angle = calcRotate(prev, anchor) - 270;\r\n    ctx.save();\r\n    if (angle % 360 !== 0) {\r\n      const { x, y } = prev;\r\n      ctx.translate(x, y);\r\n      let rotate = (angle * Math.PI) / 180;\r\n      ctx.rotate(rotate);\r\n      ctx.translate(-x, -y);\r\n    }\r\n    ctx.fillText(t, prev.x, prev.y + lineHeight / 2);\r\n    ctx.restore();\r\n    prev = anchor;\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\nexport function drawIcon(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen\r\n) {\r\n  const store = pen.calculative.canvas.store;\r\n  ctx.save();\r\n  ctx.shadowColor = '';\r\n  ctx.shadowBlur = 0;\r\n  ctx.shadowOffsetX = 0;\r\n  ctx.shadowOffsetY = 0;\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  const iconRect = pen.calculative.worldIconRect;\r\n  let x = iconRect.x + iconRect.width / 2;\r\n  let y = iconRect.y + iconRect.height / 2;\r\n\r\n  switch (pen.iconAlign) {\r\n    case 'top':\r\n      y = iconRect.y;\r\n      ctx.textBaseline = 'top';\r\n      break;\r\n    case 'bottom':\r\n      y = iconRect.ey;\r\n      ctx.textBaseline = 'bottom';\r\n      break;\r\n    case 'left':\r\n      x = iconRect.x;\r\n      ctx.textAlign = 'left';\r\n      break;\r\n    case 'right':\r\n      x = iconRect.ex;\r\n      ctx.textAlign = 'right';\r\n      break;\r\n    case 'left-top':\r\n      x = iconRect.x;\r\n      y = iconRect.y;\r\n      ctx.textAlign = 'left';\r\n      ctx.textBaseline = 'top';\r\n      break;\r\n    case 'right-top':\r\n      x = iconRect.ex;\r\n      y = iconRect.y;\r\n      ctx.textAlign = 'right';\r\n      ctx.textBaseline = 'top';\r\n      break;\r\n    case 'left-bottom':\r\n      x = iconRect.x;\r\n      y = iconRect.ey;\r\n      ctx.textAlign = 'left';\r\n      ctx.textBaseline = 'bottom';\r\n      break;\r\n    case 'right-bottom':\r\n      x = iconRect.ex;\r\n      y = iconRect.ey;\r\n      ctx.textAlign = 'right';\r\n      ctx.textBaseline = 'bottom';\r\n      break;\r\n  }\r\n\r\n  const fontWeight = pen.calculative.iconWeight;\r\n  let fontSize: number = undefined;\r\n  const fontFamily = pen.calculative.iconFamily;\r\n  if (pen.calculative.iconSize > 0) {\r\n    fontSize = pen.calculative.iconSize;\r\n  } else if (iconRect.width > iconRect.height) {\r\n    fontSize = iconRect.height;\r\n  } else {\r\n    fontSize = iconRect.width;\r\n  }\r\n  ctx.font = getFont({\r\n    fontSize,\r\n    fontWeight,\r\n    fontFamily,\r\n  });\r\n  ctx.fillStyle = pen.calculative.iconColor || getTextColor(pen, store);\r\n\r\n  if (pen.calculative.iconRotate) {\r\n    ctx.translate(iconRect.center.x, iconRect.center.y);\r\n    ctx.rotate((pen.calculative.iconRotate * Math.PI) / 180);\r\n    ctx.translate(-iconRect.center.x, -iconRect.center.y);\r\n  }\r\n\r\n  ctx.beginPath();\r\n  ctx.fillText(pen.calculative.icon, x, y);\r\n  ctx.restore();\r\n}\r\n\r\nexport function drawDropdown(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen\r\n){\r\n  const scale = pen.calculative.canvas.store.data.scale;\r\n  const inputPenId = pen.calculative.canvas.inputDiv.dataset.penId;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  if(pen.id === inputPenId){\r\n    ctx.moveTo(x+width-20*scale, y+height/2+2*scale);\r\n    ctx.lineTo(x+width-14*scale, y+height/2-4*scale);\r\n    ctx.lineTo(x+width-8*scale, y+height/2+2*scale);\r\n  }else{\r\n    ctx.moveTo(x+width-20*scale, y+height/2-4*scale);\r\n    ctx.lineTo(x+width-14*scale, y+height/2+2*scale);\r\n    ctx.lineTo(x+width-8*scale, y+height/2-4*scale);\r\n  }\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * canvas2svg 中对 font 的解析规则比 canvas 中简单，能识别的类型很少\r\n * @returns ctx.font\r\n */\r\nexport function getFont({\r\n  fontStyle = 'normal',\r\n  textDecoration = 'normal',\r\n  fontWeight = 'normal',\r\n  fontSize = 12,\r\n  fontFamily = 'Arial',\r\n  lineHeight = 1, // TODO: lineHeight 默认值待测试\r\n}: {\r\n  fontStyle?: string;\r\n  textDecoration?: string;\r\n  fontWeight?: string;\r\n  fontSize?: number;\r\n  fontFamily?: string;\r\n  lineHeight?: number;\r\n} = {}) {\r\n  return `${fontStyle} ${textDecoration} ${fontWeight} ${fontSize}px/${lineHeight} ${fontFamily}`;\r\n}\r\n\r\n// TODO: 0.5 偏移量在 图片中可能存在问题\r\nexport function ctxFlip(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen\r\n) {\r\n  // worldRect 可能为 undefined\r\n  const { x, ex, y, ey } = pen.calculative.worldRect || {};\r\n  if (pen.calculative.flipX) {\r\n    ctx.translate(x + ex + 0.5, 0.5);\r\n    ctx.scale(-1, 1);\r\n  }\r\n  if (pen.calculative.flipY) {\r\n    ctx.translate(0.5, y + ey + 0.5);\r\n    ctx.scale(1, -1);\r\n  }\r\n}\r\n\r\nexport function ctxRotate(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen,\r\n  noFlip: boolean = false\r\n) {\r\n  const { x, y } =\r\n    pen.calculative.worldRect.pivot || pen.calculative.worldRect.center;\r\n  ctx.translate(x, y);\r\n  let rotate = (pen.calculative.rotate * Math.PI) / 180;\r\n  // 目前只有水平和垂直翻转，都需要 * -1\r\n  if (!noFlip) {\r\n    if (pen.calculative.flipX) {\r\n      rotate *= -1;\r\n    }\r\n    if (pen.calculative.flipY) {\r\n      rotate *= -1;\r\n    }\r\n  }\r\n  ctx.rotate(rotate);\r\n  ctx.translate(-x, -y);\r\n}\r\n\r\nexport function renderPen(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  download?: boolean\r\n) {\r\n  ctx.save();\r\n  ctx.translate(0.5, 0.5);\r\n  ctx.beginPath();\r\n  const store = pen.calculative.canvas.store;\r\n  const textFlip = pen.textFlip || store.options.textFlip;\r\n  const textRotate = pen.textRotate || store.options.textRotate;\r\n  if (!textFlip || !textRotate) {\r\n    ctx.save();\r\n  }\r\n  ctxFlip(ctx, pen);\r\n\r\n  if (pen.calculative.rotate && pen.name !== 'line') {\r\n    ctxRotate(ctx, pen);\r\n  }\r\n  if (pen.calculative.lineWidth > 1 || download) {\r\n    ctx.lineWidth = pen.calculative.lineWidth;\r\n  }\r\n\r\n  inspectRect(ctx, store, pen); // 审查 rect\r\n  let fill: any;\r\n  // 该变量控制在 hover active 状态下的节点是否设置填充颜色\r\n  // let setBack = true;\r\n  let lineGradientFlag = false;\r\n  let _stroke = undefined;\r\n  if (pen.calculative.disabled) {\r\n    _stroke =\r\n      pen.disabledColor ||\r\n      store.options.disabledColor ||\r\n      pSBC(0.4, pen.calculative.color || getGlobalColor(store));\r\n    fill =\r\n      pen.disabledBackground ||\r\n      store.options.disabledBackground ||\r\n      pSBC(0.4, pen.calculative.background || store.data.penBackground);\r\n  } else if (pen.mouseDownValid && pen.calculative.mouseDown) {\r\n    _stroke =\r\n      pen.mouseDownColor ||\r\n      pSBC(-0.4, pen.calculative.color || getGlobalColor(store));\r\n    fill =\r\n      pen.mouseDownBackground ||\r\n      pSBC(-0.4, pen.calculative.background || store.data.penBackground);\r\n  } else if (pen.switch && pen.calculative.checked) {\r\n    if(!pen.calculative.bkType){\r\n      fill = pen.onBackground;\r\n    }\r\n  } else if (pen.calculative.hover) {\r\n    _stroke = pen.hoverColor || store.options.hoverColor;\r\n    fill = pen.hoverBackground || store.options.hoverBackground;\r\n    //  ctx.fillStyle = fill;\r\n    //  fill && (setBack = false);\r\n  } else if (pen.calculative.active) {\r\n    _stroke = pen.activeColor || store.options.activeColor;\r\n    fill = pen.activeBackground || store.options.activeBackground;\r\n    // ctx.fillStyle = fill;\r\n    // fill && (setBack = false);\r\n  } else if (pen.calculative.isDock) {\r\n    if (pen.type === PenType.Line) {\r\n      _stroke = store.options.dockPenColor;\r\n    } else {\r\n      fill = rgba(store.options.dockPenColor, 0.2);\r\n      //  ctx.fillStyle = fill;\r\n      //  fill && (setBack = false);\r\n    }\r\n  }\r\n  // else {\r\n  const strokeImg = pen.calculative.strokeImg;\r\n  if (pen.calculative.strokeImage && strokeImg) {\r\n    ctx.strokeStyle = _stroke || ctx.createPattern(strokeImg, 'repeat');\r\n    // fill = true;\r\n  } else {\r\n    let stroke: string | CanvasGradient | CanvasPattern;\r\n    // TODO: 线只有线性渐变\r\n    if (pen.calculative.strokeType) {\r\n      if (pen.calculative.lineGradientColors) {\r\n        if (pen.name === 'line') {\r\n          lineGradientFlag = true;\r\n        } else {\r\n          if (pen.calculative.lineGradient) {\r\n            stroke = pen.calculative.lineGradient;\r\n          } else {\r\n            stroke = getLineGradient(ctx, pen);\r\n            pen.calculative.lineGradient = stroke;\r\n          }\r\n        }\r\n      } else {\r\n        stroke = strokeLinearGradient(ctx, pen);\r\n      }\r\n    } else {\r\n      stroke = pen.calculative.color || (pen.type ? store.data.lineColor : '') || getGlobalColor(store);\r\n    }\r\n    ctx.strokeStyle = _stroke || stroke;\r\n  }\r\n  // }\r\n  //if (setBack) {\r\n  const backgroundImg = pen.calculative.backgroundImg;\r\n  if (pen.calculative.backgroundImage && backgroundImg) {\r\n    ctx.fillStyle = fill || ctx.createPattern(backgroundImg, 'repeat');\r\n    fill = true;\r\n  } else {\r\n    let back: string | CanvasGradient | CanvasPattern;\r\n    if (pen.calculative.bkType === Gradient.Linear) {\r\n      if (pen.calculative.gradientColors) {\r\n        // if (!pen.type) {\r\n        //连线不考虑渐进背景\r\n        if (pen.calculative.gradient) {\r\n          //位置变化/放大缩小操作不会触发重新计算\r\n          back = pen.calculative.gradient;\r\n        } else {\r\n          back = getBkGradient(ctx, pen);\r\n          pen.calculative.gradient = back;\r\n        }\r\n        // }\r\n      } else {\r\n        back = drawBkLinearGradient(ctx, pen);\r\n      }\r\n    } else if (pen.calculative.bkType === Gradient.Radial) {\r\n      if (pen.calculative.gradientColors) {\r\n        if (pen.calculative.radialGradient) {\r\n          back = pen.calculative.radialGradient;\r\n        } else {\r\n          back = getBkRadialGradient(ctx, pen);\r\n          pen.calculative.radialGradient = back;\r\n        }\r\n      } else {\r\n        back = drawBkRadialGradient(ctx, pen);\r\n      }\r\n    } else {\r\n      back = pen.calculative.background || store.data.penBackground;\r\n    }\r\n    ctx.fillStyle = fill || back;\r\n    fill = !!back;\r\n  }\r\n  // }\r\n\r\n  setLineCap(ctx, pen);\r\n  setLineJoin(ctx, pen);\r\n\r\n  setGlobalAlpha(ctx, pen);\r\n\r\n  if (pen.calculative.lineDash) {\r\n    ctx.setLineDash(\r\n      pen.calculative.lineDash.map(\r\n        (item) => item * pen.calculative.canvas.store.data.scale\r\n      )\r\n    );\r\n  }\r\n  if (pen.calculative.lineDashOffset) {\r\n    ctx.lineDashOffset = pen.calculative.lineDashOffset;\r\n  }\r\n\r\n  if (pen.calculative.shadowColor) {\r\n    ctx.shadowColor = pen.calculative.shadowColor;\r\n    ctx.shadowOffsetX = pen.calculative.shadowOffsetX;\r\n    ctx.shadowOffsetY = pen.calculative.shadowOffsetY;\r\n    ctx.shadowBlur = pen.calculative.shadowBlur;\r\n  }\r\n  if (lineGradientFlag) {\r\n    ctxDrawLinearGradientPath(ctx, pen);\r\n    ctxDrawLinePath(true, ctx, pen, store);\r\n  } else {\r\n    ctxDrawPath(true, ctx, pen, store, fill);\r\n\r\n    ctxDrawCanvas(ctx, pen);\r\n  }\r\n  if (!(pen.image && pen.calculative.img) && pen.calculative.icon) {\r\n    drawIcon(ctx, pen);\r\n  }\r\n\r\n  if(pen.dropdownList){\r\n    drawDropdown(ctx, pen);\r\n  }\r\n\r\n  if (!textFlip || !textRotate) {\r\n    ctx.restore();\r\n  }\r\n  if (textFlip && !textRotate) {\r\n    ctxFlip(ctx, pen);\r\n  }\r\n  if (!textFlip && textRotate) {\r\n    if (pen.calculative.rotate && pen.name !== 'line') {\r\n      ctxRotate(ctx, pen, true);\r\n    }\r\n  }\r\n\r\n  drawText(ctx, pen);\r\n  if (pen.type === PenType.Line && pen.fillTexts) {\r\n    for (const text of pen.fillTexts) {\r\n      drawFillText(ctx, pen, text);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * 更改 ctx 的 lineCap 属性\r\n */\r\nexport function setLineCap(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const lineCap = pen.lineCap || (pen.type ? 'round' : 'square');\r\n  if (lineCap) {\r\n    ctx.lineCap = lineCap;\r\n  } else if (pen.type) {\r\n    ctx.lineCap = 'round';\r\n  }\r\n}\r\n\r\n/**\r\n * 更改 ctx 的 lineJoin 属性\r\n */\r\nexport function setLineJoin(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const lineJoin = pen.lineJoin;\r\n  if (lineJoin) {\r\n    ctx.lineJoin = lineJoin;\r\n  } else if (pen.type) {\r\n    ctx.lineJoin = 'round';\r\n  }\r\n}\r\n\r\n/**\r\n * 通常用在下载 svg\r\n * canvas2svg 与 canvas ctx 设置 strokeStyle 表现不同\r\n * 若设置值为 undefined ，canvas2svg 为空， canvas ctx 为上一个值\r\n */\r\nexport function renderPenRaw(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  rect?: Rect,\r\n  download?: boolean\r\n) {\r\n  ctx.save();\r\n  if (rect) {\r\n    ctx.translate(-rect.x, -rect.y);\r\n  }\r\n\r\n  // for canvas2svg\r\n  (ctx as any).setAttrs?.(pen);\r\n  // end\r\n  let lineGradientFlag = false;\r\n  const store = pen.calculative.canvas.store;\r\n  const textFlip = pen.textFlip || store.options.textFlip;\r\n  const textRotate = pen.textRotate || store.options.textRotate;\r\n  ctx.beginPath();\r\n  if (!textFlip || !textRotate) {\r\n    ctx.save();\r\n  }\r\n  if (pen.calculative.flipX) {\r\n    if (rect) {\r\n      ctx.translate(\r\n        pen.calculative.worldRect.x + pen.calculative.worldRect.ex,\r\n        0\r\n      );\r\n    } else {\r\n      ctx.translate(\r\n        pen.calculative.worldRect.x + pen.calculative.worldRect.ex,\r\n        0\r\n      );\r\n    }\r\n    ctx.scale(-1, 1);\r\n  }\r\n  if (pen.calculative.flipY) {\r\n    if (rect) {\r\n      ctx.translate(\r\n        0,\r\n        pen.calculative.worldRect.y + pen.calculative.worldRect.ey\r\n      );\r\n    } else {\r\n      ctx.translate(\r\n        0,\r\n        pen.calculative.worldRect.y + pen.calculative.worldRect.ey\r\n      );\r\n    }\r\n    ctx.scale(1, -1);\r\n  }\r\n\r\n  if (pen.calculative.rotate && pen.name !== 'line') {\r\n    ctxRotate(ctx, pen);\r\n  }\r\n  if (pen.calculative.lineWidth > 1 || download) {\r\n    ctx.lineWidth = pen.calculative.lineWidth;\r\n  }\r\n  let fill: any;\r\n  if (pen.calculative.hover) {\r\n    ctx.strokeStyle = pen.hoverColor || store.options.hoverColor;\r\n    ctx.fillStyle = pen.hoverBackground || store.options.hoverBackground;\r\n    fill = pen.hoverBackground || store.options.hoverBackground;\r\n  } else if (pen.calculative.active) {\r\n    ctx.strokeStyle = pen.activeColor || store.options.activeColor;\r\n    ctx.fillStyle = pen.activeBackground || store.options.activeBackground;\r\n    fill = pen.activeBackground || store.options.activeBackground;\r\n  } else {\r\n    if (pen.strokeImage) {\r\n      if (pen.calculative.strokeImg) {\r\n        ctx.strokeStyle = ctx.createPattern(\r\n          pen.calculative.strokeImg,\r\n          'repeat'\r\n        );\r\n        fill = true;\r\n      }\r\n    } else {\r\n      let stroke: string | CanvasGradient | CanvasPattern;\r\n      if (\r\n        pen.calculative.strokeType &&\r\n        pen.calculative.lineGradientColors &&\r\n        pen.name === 'line'\r\n      ) {\r\n        lineGradientFlag = true;\r\n      } else {\r\n        stroke = pen.calculative.color || getGlobalColor(store);\r\n      }\r\n      ctx.strokeStyle = stroke;\r\n    }\r\n\r\n    if (pen.backgroundImage) {\r\n      if (pen.calculative.backgroundImg) {\r\n        ctx.fillStyle = ctx.createPattern(\r\n          pen.calculative.backgroundImg,\r\n          'repeat'\r\n        );\r\n        fill = true;\r\n      }\r\n    } else {\r\n      ctx.fillStyle = pen.background;\r\n      fill = !!pen.background;\r\n    }\r\n  }\r\n\r\n  setLineCap(ctx, pen);\r\n  setLineJoin(ctx, pen);\r\n\r\n  setGlobalAlpha(ctx, pen);\r\n\r\n  if (pen.calculative.lineDash) {\r\n    ctx.setLineDash(pen.calculative.lineDash);\r\n  }\r\n  if (pen.calculative.lineDashOffset) {\r\n    ctx.lineDashOffset = pen.calculative.lineDashOffset;\r\n  }\r\n\r\n  if (pen.calculative.shadowColor) {\r\n    ctx.shadowColor = pen.calculative.shadowColor;\r\n    ctx.shadowOffsetX = pen.calculative.shadowOffsetX;\r\n    ctx.shadowOffsetY = pen.calculative.shadowOffsetY;\r\n    ctx.shadowBlur = pen.calculative.shadowBlur;\r\n  }\r\n\r\n  if (lineGradientFlag) {\r\n    ctxDrawLinearGradientPath(ctx, pen);\r\n    ctxDrawLinePath(true, ctx, pen, store);\r\n  } else {\r\n    ctxDrawPath(false, ctx, pen, store, fill);\r\n\r\n    ctxDrawCanvas(ctx, pen);\r\n  }\r\n\r\n  // renderPenRaw 用在 downloadPng svg , echarts 等图形需要\r\n  if (pen.calculative.img) {\r\n    ctx.save();\r\n    ctx.shadowColor = '';\r\n    ctx.shadowBlur = 0;\r\n    ctx.shadowOffsetX = 0;\r\n    ctx.shadowOffsetY = 0;\r\n    drawImage(ctx, pen);\r\n    ctx.restore();\r\n  } else if (pen.calculative.icon) {\r\n    drawIcon(ctx, pen);\r\n  }\r\n\r\n  if(pen.dropdownList){\r\n    drawDropdown(ctx, pen);\r\n  }\r\n\r\n  if (!textFlip || !textRotate) {\r\n    ctx.restore();\r\n  }\r\n\r\n  if (textFlip && !textRotate) {\r\n    if (pen.calculative.flipX) {\r\n      if (rect) {\r\n        ctx.translate(\r\n          pen.calculative.worldRect.x + pen.calculative.worldRect.ex,\r\n          0\r\n        );\r\n      } else {\r\n        ctx.translate(\r\n          pen.calculative.worldRect.x + pen.calculative.worldRect.ex,\r\n          0\r\n        );\r\n      }\r\n      ctx.scale(-1, 1);\r\n    }\r\n    if (pen.calculative.flipY) {\r\n      if (rect) {\r\n        ctx.translate(\r\n          0,\r\n          pen.calculative.worldRect.y + pen.calculative.worldRect.ey\r\n        );\r\n      } else {\r\n        ctx.translate(\r\n          0,\r\n          pen.calculative.worldRect.y + pen.calculative.worldRect.ey\r\n        );\r\n      }\r\n      ctx.scale(1, -1);\r\n    }\r\n  }\r\n  if (!textFlip && textRotate) {\r\n    if (pen.calculative.rotate && pen.name !== 'line') {\r\n      ctxRotate(ctx, pen, true);\r\n    }\r\n  }\r\n\r\n  drawText(ctx, pen);\r\n\r\n  if (pen.type === PenType.Line && pen.fillTexts) {\r\n    for (const text of pen.fillTexts) {\r\n      drawFillText(ctx, pen, text);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * 根据 path2D 绘制 path\r\n * @param canUsePath 是否可使用 Path2D, downloadSvg 不可使用 path2D\r\n */\r\nexport function ctxDrawPath(\r\n  canUsePath = true,\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore,\r\n  fill: boolean\r\n) {\r\n  if(pen.name === 'drawCommand')return;\r\n  const path = canUsePath\r\n    ? store.path2dMap.get(pen)\r\n    : globalStore.path2dDraws[pen.name];\r\n\r\n  let path_from = null;\r\n  let path_to = null;\r\n  if (pen.type === PenType.Line) {\r\n    //线段的起始和结束线帽 分别配置\r\n    if (pen.fromLineCap && pen.fromLineCap !== 'butt') {\r\n      ctx.lineCap = 'butt';\r\n      path_from = new Path2D();\r\n      path_from.moveTo(\r\n        pen.calculative.worldAnchors[0].x,\r\n        pen.calculative.worldAnchors[0].y\r\n      );\r\n      path_from.lineTo(\r\n        pen.calculative.worldAnchors[0].x,\r\n        pen.calculative.worldAnchors[0].y\r\n      );\r\n    }\r\n    if (pen.toLineCap && pen.toLineCap !== 'butt') {\r\n      ctx.lineCap = 'butt';\r\n      path_to = new Path2D();\r\n      path_to.moveTo(\r\n        pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1].x,\r\n        pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1].y\r\n      );\r\n      path_to.lineTo(\r\n        pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1].x,\r\n        pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1].y\r\n      );\r\n    }\r\n  }\r\n  if (path) {\r\n    if (pen.type === PenType.Line && pen.borderWidth) {\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      const lineWidth = pen.calculative.lineWidth + pen.calculative.borderWidth;\r\n      ctx.lineWidth = lineWidth;\r\n      ctx.strokeStyle = pen.borderColor;\r\n      if (path_from) {\r\n        ctx.save();\r\n        ctx.lineCap = pen.fromLineCap;\r\n        ctx.stroke(path_from);\r\n        ctx.restore();\r\n      }\r\n      if (path instanceof Path2D) {\r\n        fill && ctx.fill(path);\r\n        lineWidth && ctx.stroke(path);\r\n      } else {\r\n        path(pen, ctx);\r\n        fill && ctx.fill();\r\n        lineWidth && ctx.stroke();\r\n      }\r\n      if (path_to) {\r\n        ctx.save();\r\n        ctx.lineCap = pen.toLineCap;\r\n        ctx.stroke(path_to);\r\n        ctx.restore();\r\n      }\r\n      ctx.restore();\r\n    }\r\n    if (path instanceof Path2D) {\r\n      if (pen.type) {\r\n        if (pen.close) {\r\n          fill && ctx.fill(path);\r\n        }\r\n      } else {\r\n        //svgPath\r\n        fill && ctx.fill(path);\r\n      }\r\n    } else {\r\n      ctx.save();\r\n      path(pen, ctx);\r\n      fill && ctx.fill();\r\n      ctx.restore();\r\n    }\r\n\r\n    const progress = pen.calculative.progress;\r\n    if (progress != null) {\r\n      // 从左往右 x, y, x + width * progress, y\r\n      // 从右往左 ex, y, x + width * (1-progress), y\r\n      // 从下往上 x, y, x, y + height * progress\r\n      // 从上往下 x, ey, x, y + height * (1 - progress)\r\n      ctx.save();\r\n      const { ex, x, y, width, height, ey } = pen.calculative.worldRect;\r\n      let grd = null;\r\n      if (!pen.calculative.verticalProgress) {\r\n        grd = !pen.reverseProgress\r\n          ? ctx.createLinearGradient(x, y, x + width * progress, y)\r\n          : ctx.createLinearGradient(ex, y, x + width * (1 - progress), y);\r\n      } else {\r\n        grd = !pen.reverseProgress\r\n          ? ctx.createLinearGradient(x, ey, x, y + height * (1 - progress))\r\n          : ctx.createLinearGradient(x, y, x, y + height * progress);\r\n      }\r\n\r\n      if (pen.calculative.progressGradientColors) {\r\n        const { colors } = formatGradient(\r\n          pen.calculative.progressGradientColors\r\n        );\r\n        colors.forEach((stop) => {\r\n          grd.addColorStop(stop.i, stop.color);\r\n        });\r\n      } else {\r\n        const color =\r\n          pen.calculative.progressColor ||\r\n          pen.calculative.color ||\r\n          store.options.activeColor;\r\n        grd.addColorStop(0, color);\r\n        grd.addColorStop(1, color);\r\n      }\r\n      grd.addColorStop(1, 'transparent');\r\n\r\n      ctx.fillStyle = grd;\r\n      if (path instanceof Path2D) {\r\n        ctx.fill(path);\r\n      } else {\r\n        path(pen, ctx);\r\n        ctx.fill();\r\n      }\r\n      ctx.restore();\r\n    }\r\n\r\n    if (pen.calculative.lineWidth) {\r\n      if (path instanceof Path2D) {\r\n        if (store.options.svgPathStroke || pen.name !== 'svgPath') {\r\n          if (path_from) {\r\n            ctx.save();\r\n            ctx.lineCap = pen.fromLineCap;\r\n            ctx.stroke(path_from);\r\n            ctx.restore();\r\n          }\r\n          ctx.stroke(path);\r\n          if (path_to) {\r\n            ctx.save();\r\n            ctx.lineCap = pen.toLineCap;\r\n            ctx.stroke(path_to);\r\n            ctx.restore();\r\n          }\r\n        }\r\n      } else {\r\n        path(pen, ctx);\r\n        ctx.stroke();\r\n      }\r\n    }\r\n\r\n    if (pen.type) {\r\n      if (pen.calculative.animatePos) {\r\n        ctx.save();\r\n        setCtxLineAnimate(ctx, pen, store);\r\n        if (\r\n          pen.lineAnimateType === LineAnimateType.Arrow ||\r\n          pen.lineAnimateType === LineAnimateType.WaterDrop\r\n        ) {\r\n          //箭头动画\r\n          let _path = drawArrow(pen, ctx);\r\n          if (_path instanceof Path2D) {\r\n            ctx.stroke(_path);\r\n            ctx.fill(_path);\r\n          } else {\r\n            ctx.stroke();\r\n            ctx.fill();\r\n          }\r\n        } else {\r\n          if (path instanceof Path2D) {\r\n            if (path_from && !pen.lineAnimateType) {\r\n              ctx.save();\r\n              ctx.lineCap = pen.fromLineCap;\r\n              ctx.stroke(path_from);\r\n              ctx.restore();\r\n            }\r\n            ctx.lineCap = pen.lineCap;\r\n            ctx.stroke(path);\r\n          } else {\r\n            path(pen, ctx);\r\n            ctx.stroke();\r\n          }\r\n        }\r\n        ctx.restore();\r\n      }\r\n\r\n      pen.fromArrow && renderFromArrow(ctx, pen, store);\r\n      pen.toArrow && renderToArrow(ctx, pen, store);\r\n\r\n      if (\r\n        pen.calculative.active &&\r\n        !pen.calculative.pencil &&\r\n        !store.options.disableAnchor &&\r\n        !store.data.locked\r\n      ) {\r\n        renderLineAnchors(ctx, pen);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 连线配置线条渐进后，动画效果、起始点、终点的绘制\r\n */\r\nexport function ctxDrawLinePath(\r\n  canUsePath = true,\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore\r\n) {\r\n  const path = canUsePath\r\n    ? store.path2dMap.get(pen)\r\n    : globalStore.path2dDraws[pen.name];\r\n  if (path) {\r\n    if (pen.type) {\r\n      if (pen.calculative.animatePos) {\r\n        ctx.save();\r\n        setCtxLineAnimate(ctx, pen, store);\r\n        ctx.beginPath();\r\n        if (path instanceof Path2D) {\r\n          if (pen.lineName === 'polyline' || pen.lineName === 'line') {\r\n            if (\r\n              pen.lineAnimateType === LineAnimateType.Arrow ||\r\n              pen.lineAnimateType === LineAnimateType.WaterDrop\r\n            ) {\r\n              //箭头动画\r\n              const _path = drawArrow(pen);\r\n              ctx.stroke(_path);\r\n              ctx.fill(_path);\r\n            } else {\r\n              if (\r\n                pen.calculative.gradientSmooth ||\r\n                pen.calculative.lineSmooth\r\n              ) {\r\n                if (!pen.calculative.gradientAnimatePath) {\r\n                  pen.calculative.gradientAnimatePath =\r\n                    getGradientAnimatePath(pen);\r\n                }\r\n                if (pen.calculative.gradientAnimatePath instanceof Path2D) {\r\n                  ctx.stroke(pen.calculative.gradientAnimatePath);\r\n                }\r\n              } else {\r\n                ctx.stroke(path);\r\n              }\r\n            }\r\n          } else {\r\n            ctx.stroke(path);\r\n          }\r\n        } else {\r\n          path(pen, ctx);\r\n          ctx.stroke();\r\n        }\r\n        ctx.restore();\r\n      }\r\n\r\n      pen.fromArrow && renderFromArrow(ctx, pen, store);\r\n      pen.toArrow && renderToArrow(ctx, pen, store);\r\n      //TODO 锚点处渐进色的过渡\r\n      if (\r\n        pen.calculative.active &&\r\n        !pen.calculative.pencil &&\r\n        !store.options.disableAnchor &&\r\n        !store.data.locked\r\n      ) {\r\n        renderLineAnchors(ctx, pen);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 设置线条动画，ctx 的 strokeStyle lineDash 等属性更改\r\n */\r\nexport function setCtxLineAnimate(\r\n  ctx: CanvasRenderingContext2D,\r\n  pen: Pen,\r\n  store: Meta2dStore\r\n) {\r\n  ctx.strokeStyle = pen.animateColor || store.options.animateColor;\r\n  if (pen.animateShadow) {\r\n    ctx.shadowBlur = pen.animateShadowBlur || pen.animateLineWidth || 6;\r\n    ctx.shadowColor =\r\n      pen.animateShadowColor || pen.animateColor || store.options.animateColor;\r\n  }\r\n  pen.calculative.animateLineWidth &&\r\n    (ctx.lineWidth = pen.calculative.animateLineWidth * store.data.scale);\r\n  let len = 0;\r\n  switch (pen.lineAnimateType) {\r\n    case LineAnimateType.Beads:\r\n      if (pen.animateReverse) {\r\n        ctx.lineDashOffset = pen.calculative.animatePos;\r\n      } else {\r\n        ctx.lineDashOffset = pen.length - pen.calculative.animatePos;\r\n      }\r\n      len = pen.calculative.lineWidth || 5;\r\n      if (len < 5) {\r\n        len = 5;\r\n      }\r\n      const dash =\r\n        pen.animateLineDash &&\r\n        pen.animateLineDash.map((item) => (item * len) / 5);\r\n      ctx.setLineDash(dash || [len, len * 2]);\r\n      break;\r\n    case LineAnimateType.Dot:\r\n      if (pen.animateReverse) {\r\n        ctx.lineDashOffset = pen.calculative.animatePos;\r\n      } else {\r\n        ctx.lineDashOffset = pen.length - pen.calculative.animatePos;\r\n      }\r\n      len =\r\n        pen.calculative.animateDotSize || pen.calculative.lineWidth * 2 || 6;\r\n      if (len < 6) {\r\n        len = 6;\r\n      }\r\n      if (len > 40) {\r\n        len = 40;\r\n      }\r\n      ctx.lineWidth =\r\n        (pen.calculative.animateLineWidth || len) * store.data.scale;\r\n      ctx.setLineDash([0.1, pen.length]);\r\n      break;\r\n    case LineAnimateType.Arrow:\r\n      ctx.fillStyle = pen.animateColor || store.options.animateColor;\r\n      ctx.lineWidth = 1;\r\n      break;\r\n    case LineAnimateType.WaterDrop:\r\n      ctx.fillStyle = pen.animateColor || store.options.animateColor;\r\n      ctx.lineWidth = 1;\r\n      break;\r\n    default:\r\n      if (pen.animateReverse) {\r\n        ctx.lineDashOffset = Number.EPSILON; //防止在执行动画时会绘制多余的远点\r\n        ctx.setLineDash([\r\n          0,\r\n          pen.length - pen.calculative.animatePos + 1,\r\n          pen.calculative.animatePos,\r\n        ]);\r\n      } else {\r\n        ctx.setLineDash([\r\n          pen.calculative.animatePos,\r\n          pen.length + 0.01 - pen.calculative.animatePos, //避免在缩放时，精度问题绘制多余圆点\r\n        ]);\r\n      }\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * 全局 color\r\n */\r\nexport function getGlobalColor(store: Meta2dStore) {\r\n  const { data, options } = store;\r\n  return data.color || options.color;\r\n}\r\n\r\nexport function renderLineAnchors(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const store = pen.calculative.canvas.store;\r\n\r\n  ctx.save();\r\n  ctx.lineWidth = 1;\r\n  ctx.fillStyle = pen.activeColor || store.options.activeColor;\r\n  pen.calculative.worldAnchors.forEach((pt) => {\r\n    !pt.hidden && !pt.isTemp && renderAnchor(ctx, pt, pen);\r\n  });\r\n  ctx.restore();\r\n}\r\n\r\nexport function renderAnchor(\r\n  ctx: CanvasRenderingContext2D,\r\n  pt: Point,\r\n  pen: Pen\r\n) {\r\n  if (!pt) {\r\n    return;\r\n  }\r\n\r\n  const active =\r\n    pen.calculative.canvas.store.activeAnchor ===\r\n      pen.calculative.activeAnchor && pen.calculative.activeAnchor === pt;\r\n  let r = 3;\r\n  if (pen.calculative.lineWidth > 3) {\r\n    r = pen.calculative.lineWidth;\r\n  }\r\n  if (pen.anchorRadius) {\r\n    r = pen.anchorRadius;\r\n  }\r\n  if (pt.radius) {\r\n    r = pt.radius;\r\n  }\r\n  if (active) {\r\n    if (pt.prev) {\r\n      ctx.save();\r\n      ctx.strokeStyle = '#4dffff';\r\n      ctx.beginPath();\r\n      ctx.moveTo(pt.prev.x, pt.prev.y);\r\n      ctx.lineTo(pt.x, pt.y);\r\n      ctx.stroke();\r\n      ctx.restore();\r\n\r\n      ctx.save();\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.beginPath();\r\n      ctx.arc(pt.prev.x, pt.prev.y, r, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      ctx.restore();\r\n    }\r\n    if (pt.next) {\r\n      ctx.save();\r\n      ctx.strokeStyle = '#4dffff';\r\n      ctx.beginPath();\r\n      ctx.moveTo(pt.x, pt.y);\r\n      ctx.lineTo(pt.next.x, pt.next.y);\r\n      ctx.stroke();\r\n      ctx.restore();\r\n\r\n      ctx.save();\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.beginPath();\r\n      ctx.arc(pt.next.x, pt.next.y, r, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      ctx.restore();\r\n\r\n      ctx.beginPath();\r\n      ctx.arc(pt.x, pt.y, r, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n    }\r\n\r\n    ctx.beginPath();\r\n    ctx.arc(pt.x, pt.y, r, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.stroke();\r\n  } else {\r\n    ctx.save();\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.beginPath();\r\n    ctx.arc(pt.x, pt.y, r, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nexport function calcWorldRects(pen: Pen) {\r\n  const store: Meta2dStore = pen.calculative.canvas.store;\r\n\r\n  let rect: Rect = {\r\n    x: pen.x,\r\n    y: pen.y,\r\n  };\r\n\r\n  if (!pen.parentId || (pen.parentId && !store.pens[pen.parentId])) {\r\n    pen.parentId = undefined;\r\n    rect.width = pen.width;\r\n    rect.height = pen.height;\r\n    rect.rotate = pen.rotate;\r\n    calcRightBottom(rect);\r\n    calcCenter(rect);\r\n    if (pen.pivot) {\r\n      calcPivot(rect, pen.pivot);\r\n    }\r\n  } else {\r\n    const parent = store.pens[pen.parentId];\r\n    let parentRect = parent.calculative.worldRect;\r\n    if (!parentRect) {\r\n      parentRect = calcWorldRects(parent);\r\n    }\r\n\r\n    rect.x = parentRect.x + parentRect.width * pen.x;\r\n    rect.y = parentRect.y + parentRect.height * pen.y;\r\n    rect.width = parentRect.width * pen.width;\r\n    rect.height = parentRect.height * pen.height;\r\n    if (parent.flipX) {\r\n      rect.x =\r\n        parentRect.width - (rect.x - parentRect.x + rect.width) + parentRect.x;\r\n    }\r\n    if (parent.flipY) {\r\n      rect.y =\r\n        parentRect.height -\r\n        (rect.y - parentRect.y + rect.height) +\r\n        parentRect.y;\r\n    }\r\n\r\n    calcRightBottom(rect);\r\n\r\n    rect.rotate = parentRect.rotate + pen.rotate;\r\n    calcCenter(rect);\r\n    if (pen.pivot) {\r\n      calcPivot(rect, pen.pivot);\r\n    }\r\n  }\r\n\r\n  pen.calculative.worldRect = rect;\r\n  // 这里的 rect 均是绝对值\r\n  calcPadding(pen, rect);\r\n\r\n  return rect;\r\n}\r\n\r\nexport function calcPadding(pen: Pen, rect: Rect) {\r\n  !pen.paddingTop && (pen.calculative.paddingTop = 0);\r\n  !pen.paddingBottom && (pen.calculative.paddingBottom = 0);\r\n  !pen.paddingLeft && (pen.calculative.paddingLeft = 0);\r\n  !pen.paddingRight && (pen.calculative.paddingRight = 0);\r\n\r\n  Math.abs(pen.calculative.paddingTop) < 1 &&\r\n    (pen.calculative.paddingTop *= rect.height);\r\n  Math.abs(pen.calculative.paddingBottom) < 1 &&\r\n    (pen.calculative.paddingBottom *= rect.height);\r\n  Math.abs(pen.calculative.paddingLeft) < 1 &&\r\n    (pen.calculative.paddingLeft *= rect.width);\r\n  Math.abs(pen.calculative.paddingRight) < 1 &&\r\n    (pen.calculative.paddingRight *= rect.width);\r\n}\r\n\r\nexport function calcPenRect(pen: Pen) {\r\n  const worldRect = deepClone(pen.calculative.worldRect);\r\n  delete worldRect.pivot;\r\n  if (!pen.parentId) {\r\n    Object.assign(pen, worldRect);\r\n    return;\r\n  }\r\n  const store = pen.calculative.canvas.store;\r\n  const parentRect = store.pens[pen.parentId].calculative.worldRect;\r\n  Object.assign(pen, calcRelativeRect(worldRect, parentRect));\r\n}\r\n\r\nexport function calcWorldAnchors(pen: Pen) {\r\n  const store: Meta2dStore = pen.calculative.canvas.store;\r\n  let anchors: Point[] = [];\r\n  if (pen.anchors) {\r\n    let _anchors = deepClone(pen.anchors);\r\n    if (pen.flipX) {\r\n      _anchors.forEach((anchor) => {\r\n        anchor.x = 0.5 - (anchor.x - 0.5);\r\n      });\r\n    }\r\n    if (pen.flipY) {\r\n      _anchors.forEach((anchor) => {\r\n        anchor.y = 0.5 - (anchor.y - 0.5);\r\n      });\r\n    }\r\n    _anchors.forEach((anchor) => {\r\n      anchors.push(calcWorldPointOfPen(pen, anchor));\r\n    });\r\n  }\r\n\r\n  // Default anchors of node\r\n  if (\r\n    !anchors.length &&\r\n    !pen.type &&\r\n    !pen.calculative.canvas.parent.isCombine(pen)\r\n  ) {\r\n    const { x, y, width, height } = pen.calculative.worldRect;\r\n    anchors = store.options.defaultAnchors.map((anchor, index) => {\r\n      return {\r\n        id: `${index}`,\r\n        penId: pen.id,\r\n        x: x + width * anchor.x,\r\n        y: y + height * anchor.y,\r\n      };\r\n    });\r\n  }\r\n\r\n  if (pen.calculative.rotate) {\r\n    anchors.forEach((anchor) => {\r\n      rotatePoint(\r\n        anchor,\r\n        pen.calculative.rotate,\r\n        pen.calculative.worldRect.pivot || pen.calculative.worldRect.center\r\n      );\r\n    });\r\n  }\r\n\r\n  if (!pen.type || pen.anchors) {\r\n    pen.calculative.worldAnchors = anchors;\r\n  }\r\n\r\n  if (pen.calculative.activeAnchor && anchors.length) {\r\n    pen.calculative.activeAnchor = anchors.find((a) => {\r\n      a.id === pen.calculative.activeAnchor.id;\r\n    });\r\n  }\r\n\r\n  pen.calculative.gradientAnimatePath = undefined;\r\n}\r\n\r\nexport function calcChildrenInitRect(pen: Pen) {\r\n  // 重新计算子节点初始化坐标\r\n  if (pen.children?.length) {\r\n    let parentRect = pen.calculative.worldRect;\r\n    pen.children.forEach((id) => {\r\n      const child = pen.calculative.canvas.store.pens[id];\r\n      if (child.calculative.initRect && child.calculative.initRelativeRect) {\r\n        child.calculative.initRect.x =\r\n          parentRect.x +\r\n          parentRect.width * child.calculative.initRelativeRect.x;\r\n        child.calculative.initRect.y =\r\n          parentRect.y +\r\n          parentRect.height * child.calculative.initRelativeRect.y;\r\n        child.calculative.initRect.ex =\r\n          child.calculative.initRect.x +\r\n          parentRect.width * child.calculative.initRelativeRect.width;\r\n        child.calculative.initRect.ey =\r\n          child.calculative.initRect.y +\r\n          parentRect.height +\r\n          child.calculative.initRelativeRect.height;\r\n        calcCenter(child.calculative.initRect);\r\n      }\r\n      calcChildrenInitRect(child);\r\n    });\r\n  }\r\n}\r\n\r\nexport function calcWorldPointOfPen(pen: Pen, pt: Point) {\r\n  const p: Point = { ...pt };\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  p.x = x + width * pt.x;\r\n  p.y = y + height * pt.y;\r\n  if (pt.prev) {\r\n    p.prev = {\r\n      penId: pen.id,\r\n      connectTo: pt.prev.connectTo,\r\n      x: x + width * pt.prev.x,\r\n      y: y + height * pt.prev.y,\r\n    };\r\n  }\r\n  if (pt.next) {\r\n    p.next = {\r\n      penId: pen.id,\r\n      connectTo: pt.next.connectTo,\r\n      x: x + width * pt.next.x,\r\n      y: y + height * pt.next.y,\r\n    };\r\n  }\r\n\r\n  return p;\r\n}\r\n\r\nexport function calcIconRect(pens: { [key: string]: Pen }, pen: Pen) {\r\n  const { paddingTop, paddingBottom, paddingLeft, paddingRight } =\r\n    pen.calculative;\r\n  let x = paddingLeft;\r\n  let y = paddingTop;\r\n  let width = pen.calculative.worldRect.width - paddingLeft - paddingRight;\r\n  let height = pen.calculative.worldRect.height - paddingTop - paddingBottom;\r\n  let iconLeft = pen.calculative.iconLeft;\r\n  let iconTop = pen.calculative.iconTop;\r\n  if (iconLeft && Math.abs(iconLeft) < 1) {\r\n    iconLeft = pen.calculative.worldRect.width * iconLeft;\r\n  }\r\n\r\n  if (iconTop && Math.abs(iconTop) < 1) {\r\n    iconTop = pen.calculative.worldRect.height * iconTop;\r\n  }\r\n  x += iconLeft || 0;\r\n  y += iconTop || 0;\r\n  width -= iconLeft || 0;\r\n  height -= iconTop || 0;\r\n\r\n  let rotate = pen.calculative.iconRotate || 0;\r\n  if (pen.parentId) {\r\n    const parentPen = pens[pen.parentId].calculative;\r\n    if (parentPen) {\r\n      rotate += parentPen.rotate;\r\n      rotate %= 360;\r\n    }\r\n  }\r\n\r\n  x = pen.calculative.worldRect.x + x;\r\n  y = pen.calculative.worldRect.y + y;\r\n  pen.calculative.worldIconRect = {\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    rotate,\r\n  };\r\n  calcRightBottom(pen.calculative.worldIconRect);\r\n  calcCenter(pen.calculative.worldIconRect);\r\n}\r\n\r\nexport function scalePen(pen: Pen, scale: number, center: Point) {\r\n  scaleRect(pen.calculative.worldRect, scale, center, pen.pivot);\r\n\r\n  if (pen.calculative.initRect) {\r\n    scaleRect(pen.calculative.initRect, scale, center, pen.pivot);\r\n  }\r\n  scaleChildrenInitRect(pen, scale, center);\r\n  if (pen.calculative.x) {\r\n    scalePoint(pen.calculative as any as Point, scale, center);\r\n  }\r\n\r\n  if (pen.type) {\r\n    calcWorldAnchors(pen);\r\n  }\r\n}\r\n\r\nexport function scaleChildrenInitRect(pen: Pen, scale: number, center: Point) {\r\n  if (!pen) {\r\n    return;\r\n  }\r\n  if (pen.children?.length) {\r\n    pen.children.forEach((id) => {\r\n      const child = pen.calculative.canvas.store.pens[id];\r\n      if (child) {\r\n        if (child.calculative.initRect) {\r\n          scaleRect(child.calculative.initRect, scale, center);\r\n        }\r\n        scaleChildrenInitRect(child, scale, center);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function pushPenAnchor(pen: Pen, pt: Point) {\r\n  if (!pen.anchors) {\r\n    pen.anchors = [];\r\n  }\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n\r\n  const worldAnchor = {\r\n    id: pt.id,\r\n    penId: pen.id,\r\n    x: pt.x,\r\n    y: pt.y,\r\n  };\r\n  pen.calculative.worldAnchors.push(worldAnchor);\r\n\r\n  if (pen.calculative.worldRect) {\r\n    if (pen.rotate % 360) {\r\n      rotatePoint(pt, -pen.rotate, pen.calculative.worldRect.center);\r\n    }\r\n\r\n    const anchor = {\r\n      id: pt.id,\r\n      penId: pen.id,\r\n      x: (pt.x - pen.calculative.worldRect.x) / pen.calculative.worldRect.width,\r\n      y:\r\n        (pt.y - pen.calculative.worldRect.y) / pen.calculative.worldRect.height,\r\n    };\r\n    pen.anchors.push(anchor);\r\n  }\r\n\r\n  return worldAnchor;\r\n}\r\n\r\nexport function addLineAnchor(pen: Pen, pt: Point, index: number) {\r\n  if (!pen.anchors) {\r\n    pen.anchors = [];\r\n  }\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n\r\n  const worldAnchor = getSplitAnchor(pen, pt, index);\r\n  pen.calculative.worldAnchors.splice(index + 1, 0, worldAnchor);\r\n  pen.anchors.splice(\r\n    index + 1,\r\n    0,\r\n    calcRelativePoint(worldAnchor, pen.calculative.worldRect)\r\n  );\r\n  pen.calculative.activeAnchor = worldAnchor;\r\n  return worldAnchor;\r\n}\r\n\r\nexport function removePenAnchor(pen: Pen, anchor: Point) {\r\n  if (!pen || !pen.calculative.worldAnchors) {\r\n    return;\r\n  }\r\n  let i = pen.calculative.worldAnchors.findIndex((a) => a.id === anchor.id);\r\n  if (i > -1) {\r\n    pen.calculative.worldAnchors.splice(i, 1);\r\n  }\r\n\r\n  i = pen.anchors.findIndex((a) => a.id === anchor.id);\r\n  if (i > -1) {\r\n    pen.anchors.splice(i, 1);\r\n  }\r\n}\r\n\r\nexport function facePen(pt: Point, pen?: Pen) {\r\n  if (!pen || !pen.calculative || !pen.calculative.worldRect.center) {\r\n    return Direction.None;\r\n  }\r\n  if (pt.anchorId) {\r\n    let anchor = pen.anchors.filter((_anchor) => _anchor.id === pt.anchorId);\r\n    if (anchor.length) {\r\n      if (anchor[0].direction > -1) {\r\n        return anchor[0].direction;\r\n      }\r\n    }\r\n  }\r\n  return facePoint(pt, pen.calculative.worldRect.center);\r\n}\r\n\r\nexport function nearestAnchor(pen: Pen, pt: Point) {\r\n  let dis = Infinity;\r\n  let anchor: Point;\r\n  pen.calculative.worldAnchors.forEach((a: Point) => {\r\n    const d = distance(pt, a);\r\n    if (dis > d) {\r\n      dis = d;\r\n      anchor = a;\r\n    }\r\n  });\r\n\r\n  return anchor;\r\n}\r\n\r\nexport function translateLine(pen: Pen, x: number, y: number) {\r\n  pen.x += x;\r\n  pen.y += y;\r\n\r\n  if (pen.anchors) {\r\n    pen.anchors.forEach((a) => {\r\n      translatePoint(a, x, y);\r\n    });\r\n  }\r\n\r\n  if (pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors.forEach((a) => {\r\n      translatePoint(a, x, y);\r\n    });\r\n  }\r\n}\r\n\r\nexport function deleteTempAnchor(pen: Pen) {\r\n  if (pen && pen.calculative && pen.calculative.worldAnchors.length) {\r\n    let to: Point = getToAnchor(pen);\r\n\r\n    // 第一次画线\r\n    if (!pen.anchors || !pen.anchors.length) {\r\n      while (\r\n        pen.calculative.worldAnchors.length &&\r\n        to !== pen.calculative.activeAnchor\r\n      ) {\r\n        pen.calculative.worldAnchors.pop();\r\n        to = getToAnchor(pen);\r\n      }\r\n    }\r\n    // 拖拽终点\r\n    else if (to === pen.calculative.activeAnchor) {\r\n      pen.calculative.worldAnchors = [pen.calculative.worldAnchors[0]];\r\n    }\r\n    // 拖拽起点\r\n    else if (pen.calculative.worldAnchors[0] === pen.calculative.activeAnchor) {\r\n      pen.calculative.worldAnchors = [\r\n        pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1],\r\n      ];\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 添加line到pen的connectedLines中，并关联相关属性\r\n * 不添加连线到画布中，请确保画布中已经有该连线。\r\n * */\r\nexport function connectLine(\r\n  pen: Pen,\r\n  anchor: Point,\r\n  line: Pen,\r\n  lineAnchor: Point\r\n) {\r\n  if (\r\n    !pen ||\r\n    !anchor ||\r\n    !line ||\r\n    !lineAnchor ||\r\n    anchor.twoWay === TwoWay.DisableConnected ||\r\n    anchor.twoWay === TwoWay.Disable ||\r\n    lineAnchor.twoWay === TwoWay.DisableConnectTo ||\r\n    lineAnchor.twoWay === TwoWay.Disable\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  if (anchor.twoWay === TwoWay.In) {\r\n    if (line.calculative.worldAnchors.length === 1) {\r\n      return;\r\n    }\r\n    const to = getToAnchor(line);\r\n    if (lineAnchor.id !== to.id) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (anchor.twoWay === TwoWay.Out) {\r\n    const from = getFromAnchor(line);\r\n    if (lineAnchor.id !== from.id) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (lineAnchor.connectTo === pen.id && lineAnchor.anchorId === anchor.id) {\r\n    return;\r\n  }\r\n\r\n  if (lineAnchor.connectTo) {\r\n    const p = pen.calculative.canvas.store.pens[lineAnchor.connectTo];\r\n    disconnectLine(p, getAnchor(p, lineAnchor.anchorId), line, lineAnchor);\r\n  }\r\n\r\n  if (!pen.connectedLines) {\r\n    pen.connectedLines = [];\r\n  }\r\n\r\n  const i = pen.connectedLines.findIndex(\r\n    (item) =>\r\n      item.lineId === line.id &&\r\n      item.lineAnchor === lineAnchor.id &&\r\n      item.anchor === anchor.id\r\n  );\r\n\r\n  if (i < 0) {\r\n    pen.connectedLines.push({\r\n      lineId: line.id,\r\n      lineAnchor: lineAnchor.id,\r\n      anchor: anchor.id,\r\n    });\r\n  }\r\n\r\n  lineAnchor.connectTo = pen.id;\r\n  lineAnchor.anchorId = anchor.id;\r\n\r\n  // 如果两条连线，则相互关联\r\n  if (pen.type) {\r\n    connectLine(line, lineAnchor, pen, anchor);\r\n  }\r\n\r\n  pen.calculative.canvas.store.emitter.emit('connectLine', {\r\n    line,\r\n    lineAnchor,\r\n    pen,\r\n    anchor,\r\n  });\r\n  // 新增连线生命周期\r\n  let fromPen =\r\n    line.calculative.worldAnchors?.length >= 2\r\n      ? line.calculative.worldAnchors?.[0].connectTo\r\n      : undefined;\r\n  let fromAnchor =\r\n    line.calculative.worldAnchors?.length >= 2\r\n      ? line.calculative.canvas.store.pens[\r\n          line.calculative.worldAnchors?.[0].connectTo\r\n        ]?.anchors.find(\r\n          (i) => i.id === line.calculative.worldAnchors?.[0].anchorId\r\n        )\r\n      : undefined; // num\r\n  pen.onConnectLine?.(pen, {\r\n    line,\r\n    lineAnchor,\r\n    pen,\r\n    anchor,\r\n    fromPen,\r\n    fromAnchor,\r\n  });\r\n  return true;\r\n}\r\n\r\n/**\r\n * 从 pen.connectedLines 中删除 lineId 和 lineAnchor\r\n */\r\nexport function disconnectLine(\r\n  pen: Pen,\r\n  anchor: Point,\r\n  line: Pen,\r\n  lineAnchor: Point\r\n) {\r\n  if (!pen || !anchor || !line || !lineAnchor) {\r\n    return;\r\n  }\r\n\r\n  if (!pen.connectedLines || !pen.connectedLines.length) {\r\n    return;\r\n  }\r\n\r\n  if (!line.lastConnected) {\r\n    line.lastConnected = {};\r\n  }\r\n  if (!line.lastConnected[pen.id]) {\r\n    line.lastConnected[pen.id] = deepClone(pen.connectedLines);\r\n  }\r\n  pen.connectedLines.forEach((item, index, arr) => {\r\n    if (\r\n      (item.lineId === line.id || item.lineId === line.id) &&\r\n      item.lineAnchor === lineAnchor.id &&\r\n      item.anchor === anchor.id\r\n    ) {\r\n      arr.splice(index, 1);\r\n    }\r\n  });\r\n\r\n  lineAnchor.connectTo = undefined;\r\n  lineAnchor.anchorId = undefined;\r\n  // 如果两条连线相互关联，则都取消关联\r\n  if (\r\n    pen.type &&\r\n    anchor.connectTo === line.id &&\r\n    anchor.anchorId === lineAnchor.id\r\n  ) {\r\n    disconnectLine(line, lineAnchor, pen, anchor);\r\n  }\r\n\r\n  pen.calculative.canvas.store.emitter.emit('disconnectLine', {\r\n    line,\r\n    lineAnchor,\r\n    pen,\r\n    anchor,\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nexport function getAnchor(pen: Pen, anchorId: string) {\r\n  if (!pen || !anchorId) {\r\n    return;\r\n  }\r\n\r\n  return pen.calculative.worldAnchors?.find((item) => item.id === anchorId);\r\n}\r\n\r\nexport function getFromAnchor(pen: Pen) {\r\n  if (!pen || !pen.calculative.worldAnchors) {\r\n    return;\r\n  }\r\n\r\n  return pen.calculative.worldAnchors[0];\r\n}\r\n\r\nexport function getToAnchor(pen: Pen) {\r\n  if (!pen || !pen.calculative.worldAnchors) {\r\n    return;\r\n  }\r\n\r\n  return pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1];\r\n}\r\n\r\nexport function setNodeAnimate(pen: Pen, now: number) {\r\n  if (pen.calculative.start === 0 || !pen.frames || !pen.frames.length) {\r\n    pen.calculative.start = undefined;\r\n    return 0;\r\n  }\r\n  if (!pen.calculative.duration) {\r\n    pen.calculative.duration = 0;\r\n    for (const f of pen.frames) {\r\n      pen.calculative.duration += f.duration;\r\n      for (const k in f) {\r\n        if (k !== 'duration' && !pen[k]) {\r\n          if (k === 'scale') {\r\n            pen[k] = 1;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  if (!pen.animateCycle) {\r\n    pen.animateCycle = Infinity;\r\n  }\r\n\r\n  if (!pen.calculative.start) {\r\n    pen.calculative.start = now;\r\n    pen.calculative.frameIndex = 0;\r\n    pen.calculative.frameStart = pen.calculative.start;\r\n    pen.calculative.frameDuration = pen.frames[0].duration;\r\n    pen.calculative.frameEnd =\r\n      pen.calculative.frameStart + pen.calculative.frameDuration;\r\n    pen.calculative.cycleIndex = 1;\r\n    pen.calculative.x = pen.calculative.worldRect.x;\r\n    pen.calculative.y = pen.calculative.worldRect.y;\r\n    pen.calculative.initRect = deepClone(pen.calculative.worldRect);\r\n    if (pen.parentId) {\r\n      pen.calculative.initRelativeRect = {\r\n        x: pen.x,\r\n        y: pen.y,\r\n        width: pen.width,\r\n        height: pen.height,\r\n      };\r\n    }\r\n    if (pen.children?.length) {\r\n      const store = pen.calculative.canvas.store;\r\n      pen.calculative.childrenVisible = {};\r\n      pen.children.forEach((id) => {\r\n        pen.calculative.childrenVisible[id] = store.pens[id].visible;\r\n      });\r\n    }\r\n    pen.calculative.initRect.rotate = pen.calculative.rotate || 0;\r\n\r\n    initPrevFrame(pen);\r\n  } else {\r\n    let frameIndex = 0;\r\n    const cycleIndex = Math.ceil(\r\n      (now - pen.calculative.start) / pen.calculative.duration\r\n    );\r\n    // 播放结束\r\n    if (cycleIndex > pen.animateCycle) {\r\n      pen.currentAnimation = undefined;\r\n      pen.calculative.start = undefined;\r\n      setNodeAnimateProcess(pen, 1);\r\n      return 0;\r\n    }\r\n\r\n    const pos = (now - pen.calculative.start) % pen.calculative.duration;\r\n    let d = 0;\r\n    for (const frame of pen.frames) {\r\n      d += frame.duration;\r\n      if (pos > d) {\r\n        ++frameIndex;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n    // 帧超出\r\n    if (!pen.frames[frameIndex]) {\r\n      return true;\r\n    }\r\n\r\n    pen.calculative.frameDuration = pen.frames[frameIndex].duration;\r\n    pen.calculative.frameStart =\r\n      pen.calculative.start + pen.calculative.duration * (cycleIndex - 1);\r\n    pen.calculative.frameEnd =\r\n      pen.calculative.frameStart + pen.calculative.frameDuration;\r\n\r\n    // 换帧\r\n    const frameChanged = frameIndex !== pen.calculative.frameIndex;\r\n    // 新循环播放\r\n    const cycleChanged = cycleIndex > pen.calculative.cycleIndex;\r\n\r\n    frameChanged && (pen.calculative.frameIndex = frameIndex);\r\n    cycleChanged && (pen.calculative.cycleIndex = cycleIndex);\r\n\r\n    if (frameChanged || cycleChanged) {\r\n      // 以初始位置为参考点。因为网页在后台时，不执行动画帧，网页恢复显示时，位置不确定\r\n      pen.calculative.x = pen.calculative.initRect.x;\r\n      pen.calculative.y = pen.calculative.initRect.y;\r\n      if (pen.children?.length && !pen.parentId) {\r\n        pen.calculative.canvas.rotatePen(\r\n          pen,\r\n          (pen.calculative.initRect.rotate || 0) -\r\n            (pen.calculative.rotate || 0),\r\n          pen.calculative.initRect\r\n        );\r\n      } else {\r\n        pen.calculative.rotate = pen.calculative.initRect.rotate || 0;\r\n      }\r\n      if (frameIndex > 0) {\r\n        pen.prevFrame = {};\r\n        const prevFrame = pen.frames[frameIndex - 1];\r\n        for (const k in prevFrame) {\r\n          pen.prevFrame[k] = prevFrame[k];\r\n        }\r\n        Object.assign(pen.prevFrame, {\r\n          rotate: prevFrame.rotate || 0,\r\n          x: prevFrame.x || 0,\r\n          y: prevFrame.y || 0,\r\n          scale: prevFrame.scale || 1,\r\n        });\r\n      } else {\r\n        initPrevFrame(pen);\r\n      }\r\n    }\r\n  }\r\n\r\n  const process =\r\n    ((now - pen.calculative.frameStart) / pen.calculative.frameDuration) % 1;\r\n  setNodeAnimateProcess(pen, process);\r\n\r\n  return true;\r\n}\r\n\r\n// 把前一个动画帧初始化为播放前状态\r\nexport function initPrevFrame(pen: Pen) {\r\n  pen.prevFrame = {};\r\n  for (const k in pen) {\r\n    if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n      pen.prevFrame[k] = pen[k];\r\n    }\r\n  }\r\n  pen.prevFrame.rotate = 0;\r\n  pen.prevFrame.x = 0;\r\n  pen.prevFrame.y = 0;\r\n  pen.prevFrame.scale = 1;\r\n}\r\n\r\n// 根据process进度值（纯小数），计算节点动画属性\r\nexport function setNodeAnimateProcess(pen: Pen, process: number) {\r\n  if (process < 0) {\r\n    return;\r\n  }\r\n\r\n  if (process > 1) {\r\n    process = 1;\r\n  }\r\n\r\n  const frame = pen.frames[pen.calculative.frameIndex];\r\n  for (const k in frame) {\r\n    if (k === 'duration') {\r\n      continue;\r\n    } else if (k === 'scale') {\r\n      pen.calculative.worldRect = deepClone(pen.calculative.initRect);\r\n      scaleRect(\r\n        pen.calculative.worldRect,\r\n        pen.prevFrame.scale,\r\n        pen.calculative.worldRect.center\r\n      );\r\n      const newScale =\r\n        pen.prevFrame.scale + (frame[k] - pen.prevFrame.scale) * process;\r\n      scaleRect(\r\n        pen.calculative.worldRect,\r\n        newScale / pen.prevFrame.scale,\r\n        pen.calculative.worldRect.center\r\n      );\r\n      pen.calculative.patchFlags = true;\r\n    } else if (k === 'x') {\r\n      const lastVal = getFrameValue(pen, k, pen.calculative.frameIndex);\r\n      pen.calculative.worldRect.x = pen.calculative.initRect.x + lastVal;\r\n      pen.calculative.worldRect.ex = pen.calculative.initRect.ex + lastVal;\r\n      translateRect(\r\n        pen.calculative.worldRect,\r\n        frame[k] * process * pen.calculative.canvas.store.data.scale,\r\n        0\r\n      );\r\n      pen.calculative.patchFlags = true;\r\n    } else if (k === 'y') {\r\n      const lastVal = getFrameValue(pen, k, pen.calculative.frameIndex);\r\n      pen.calculative.worldRect.y = pen.calculative.initRect.y + lastVal;\r\n      pen.calculative.worldRect.ey = pen.calculative.initRect.ey + lastVal;\r\n      translateRect(\r\n        pen.calculative.worldRect,\r\n        0,\r\n        frame[k] * process * pen.calculative.canvas.store.data.scale\r\n      );\r\n      pen.calculative.patchFlags = true;\r\n    } else if (k === 'rotate') {\r\n      if (pen.prevFrame[k] >= 360) {\r\n        pen.prevFrame[k] %= 360;\r\n      }\r\n      const lastVal = getFrameValue(pen, k, pen.calculative.frameIndex);\r\n      const offsetRotate =\r\n        ((pen.calculative.initRect.rotate + lastVal + frame[k] * process) %\r\n          360) -\r\n        (pen.calculative.rotate || 0);\r\n      if (pen.children?.length) {\r\n        pen.calculative.canvas.rotatePen(\r\n          pen,\r\n          offsetRotate,\r\n          pen.calculative.initRect\r\n        );\r\n      } else {\r\n        pen.calculative.rotate =\r\n          (pen.calculative.initRect.rotate + lastVal + frame[k] * process) %\r\n          360;\r\n      }\r\n      pen.calculative.patchFlags = true;\r\n    } else if (k === 'image') {\r\n      pen.image = frame['image'];\r\n      pen.calculative.image = undefined;\r\n      pen.calculative.canvas.loadImage(pen);\r\n      // if (pen.isBottom) {\r\n      //   pen.calculative.canvas.canvasImageBottom.init();\r\n      // } else {\r\n      //   pen.calculative.canvas.canvasImage.init();\r\n      // }\r\n      if (pen.canvasLayer === CanvasLayer.CanvasImageBottom) {\r\n        pen.calculative.canvas.canvasImageBottom.init();\r\n      } else if (pen.canvasLayer === CanvasLayer.CanvasImage) {\r\n        pen.calculative.canvas.canvasImage.init();\r\n      }\r\n    } else if (isLinear(frame[k], k, pen)) {\r\n      if (pen.prevFrame[k] == null) {\r\n        if (k === 'globalAlpha') {\r\n          pen.prevFrame[k] = 1;\r\n        } else {\r\n          pen.prevFrame[k] = 0;\r\n        }\r\n      }\r\n\r\n      const current =\r\n        pen.prevFrame[k] + (frame[k] - pen.prevFrame[k]) * process;\r\n      pen.calculative[k] = Math.round(current * 100) / 100;\r\n    } else {\r\n      if (k === 'visible') {\r\n        if (pen.calculative.image) {\r\n          // if (pen.isBottom) {\r\n          //   pen.calculative.canvas.canvasImageBottom.init();\r\n          // } else {\r\n          //   pen.calculative.canvas.canvasImage.init();\r\n          // }\r\n          if (pen.canvasLayer === CanvasLayer.CanvasImageBottom) {\r\n            pen.calculative.canvas.canvasImageBottom.init();\r\n          } else if (pen.canvasLayer === CanvasLayer.CanvasImage) {\r\n            pen.calculative.canvas.canvasImage.init();\r\n          }\r\n        } else if (pen.children?.length) {\r\n          const childs = getAllChildren(pen, pen.calculative.canvas.store);\r\n          pen.calculative.canvas.initImageCanvas(childs);\r\n        }\r\n      }\r\n      pen.calculative[k] = frame[k];\r\n      const v: any = {};\r\n      v[k] = frame[k];\r\n      setChildValue(pen, v);\r\n    }\r\n\r\n    if (k === 'text') {\r\n      calcTextLines(pen);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 值类型为 number , pen.linear 为 false 时，且 key 不属于 noLinear 时，返回 true\r\n * @param value 值\r\n * @param key 键值\r\n * @param pen 画笔\r\n * @returns\r\n */\r\nfunction isLinear(value: unknown, key: string, pen: Pen): boolean {\r\n  // 不线性变化的属性\r\n  const noLinear = ['strokeType', 'bkType', 'showChild'] as const;\r\n  type NoLinear = (typeof noLinear)[number];\r\n  return (\r\n    typeof value === 'number' &&\r\n    pen.linear !== false &&\r\n    !noLinear.includes(key as NoLinear)\r\n  );\r\n}\r\n\r\nexport function setLineAnimate(pen: Pen, now: number) {\r\n  if (pen.calculative.start === 0) {\r\n    pen.calculative.start = undefined;\r\n    return 0;\r\n  }\r\n\r\n  if (!pen.animateCycle) {\r\n    pen.animateCycle = Infinity;\r\n  }\r\n\r\n  if (!pen.animateSpan) {\r\n    pen.animateSpan = 1;\r\n  }\r\n\r\n  pen.calculative.animatePos +=\r\n    pen.animateSpan * (pen.calculative.canvas.store.data.scale || 1);\r\n  if (!pen.calculative.start) {\r\n    pen.calculative.start = Date.now();\r\n    pen.calculative.animatePos =\r\n      pen.animateSpan * (pen.calculative.canvas.store.data.scale || 1);\r\n    pen.calculative.cycleIndex = 1;\r\n  } else if (pen.calculative.animatePos > pen.length) {\r\n    // 播放到尾了\r\n    ++pen.calculative.cycleIndex;\r\n\r\n    // 播放结束\r\n    if (pen.calculative.cycleIndex > pen.animateCycle) {\r\n      pen.currentAnimation = undefined;\r\n      pen.calculative.start = undefined;\r\n      return 0;\r\n    }\r\n    pen.calculative.animatePos = pen.animateSpan;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function setChildrenActive(pen: Pen, active = true) {\r\n  if (!pen.children || pen.childActive === false) {\r\n    return;\r\n  }\r\n  const store = pen.calculative.canvas.store;\r\n  pen.children.forEach((id) => {\r\n    const child: Pen = store.pens[id];\r\n    if (child) {\r\n      child.calculative.active = active;\r\n\r\n      setChildrenActive(child, active);\r\n    }\r\n  });\r\n}\r\n\r\nexport function setHover(pen: Pen, hover = true) {\r\n  if (!pen) {\r\n    return;\r\n  }\r\n  const store = pen.calculative.canvas.store;\r\n  pen.calculative.hover = hover;\r\n  if (pen.childHover === false) {\r\n    return;\r\n  }\r\n  if (pen.children) {\r\n    pen.children.forEach((id) => {\r\n      // 子节点没有自己的独立hover，继承父节点hover\r\n      if (\r\n        store.pens[id]?.hoverColor == undefined &&\r\n        store.pens[id]?.hoverBackground == undefined\r\n      ) {\r\n        setHover(store.pens[id], hover);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function setElemPosition(pen: Pen, elem: HTMLElement) {\r\n  if (!elem) {\r\n    return;\r\n  }\r\n  const store = pen.calculative.canvas.store;\r\n  const worldRect = pen.calculative.worldRect;\r\n  elem.style.opacity = pen.globalAlpha + '';\r\n  elem.style.position = 'absolute';\r\n  elem.style.outline = 'none';\r\n  elem.style.left = worldRect.x + store.data.x + 'px';\r\n  elem.style.top = worldRect.y + store.data.y + 'px';\r\n  elem.style.width = worldRect.width + 'px';\r\n  elem.style.height = worldRect.height + 'px';\r\n  elem.style.display =\r\n    pen.calculative.inView != false\r\n      ? pen.calculative.cssDisplay || 'inline'\r\n      : 'none'; // 是否隐藏元素\r\n  !pen.calculative.rotate && (pen.calculative.rotate = 0);\r\n  elem.style.transform = `rotate(${pen.calculative.rotate}deg)`;\r\n  if (!pen.calculative.rotate) {\r\n    if (pen.calculative.flipX) {\r\n      elem.style.transform = `rotateY(180deg)`;\r\n    }\r\n    if (pen.calculative.flipY) {\r\n      elem.style.transform = `rotateX(180deg)`;\r\n    }\r\n    if (pen.calculative.flipX && pen.calculative.flipY) {\r\n      elem.style.transform = `rotateZ(180deg)`;\r\n    }\r\n  }\r\n  elem.style.zIndex =\r\n    pen.calculative.zIndex !== undefined ? pen.calculative.zIndex + '' : '5';\r\n  if (pen.calculative.zIndex > pen.calculative.canvas.maxZindex) {\r\n    pen.calculative.canvas.maxZindex = pen.calculative.zIndex;\r\n  }\r\n  if (\r\n    pen.locked === LockState.DisableEdit ||\r\n    pen.locked === LockState.DisableMove ||\r\n    store.data.locked\r\n  ) {\r\n    // gif 组合后，作为子节点可通过 lockedOnCombine 来决定自身的 locked 状态\r\n    elem.style.userSelect = 'initial';\r\n    elem.style.pointerEvents = 'initial';\r\n    if (pen.name === 'gif') {\r\n      elem.style.userSelect = 'none';\r\n      elem.style.pointerEvents = 'none';\r\n    }\r\n  } else {\r\n    // pen.locked LockState.Disable 不响应鼠标\r\n    elem.style.userSelect = 'none';\r\n    elem.style.pointerEvents = 'none';\r\n  }\r\n}\r\n\r\nexport function setElemImg(pen: Pen, elem: HTMLElement) {\r\n  if (!elem) {\r\n    return;\r\n  }\r\n  //https://github.com/niklasvh/html2canvas\r\n  globalThis.html2canvas &&\r\n    globalThis.html2canvas(elem).then(function (canvas) {\r\n      // document.body.appendChild(canvas);\r\n      const img = new Image();\r\n      img.src = canvas.toDataURL('image/png', 0.1);\r\n      if (img.src.length > 10) {\r\n        pen.calculative.img = img;\r\n      }\r\n    });\r\n}\r\n\r\n/**\r\n * 每个画笔 locked\r\n * @param pens 画笔\r\n * @returns\r\n */\r\nexport function getPensLock(pens: Pen[]): boolean {\r\n  return pens.every((pen) => pen.locked);\r\n}\r\n\r\n/**\r\n * 画笔们的 disabledRotate = true\r\n * 即 全部禁止旋转 返回 true\r\n * @param pens 画笔\r\n * @returns\r\n */\r\nexport function getPensDisableRotate(pens: Pen[]): boolean {\r\n  return pens.every((pen) => pen.disableRotate);\r\n}\r\n\r\nexport function rotatePen(pen: Pen, angle: number, rect: Rect) {\r\n  if (pen.type) {\r\n    pen.calculative.worldAnchors.forEach((anchor) => {\r\n      rotatePoint(anchor, angle, rect.center);\r\n    });\r\n    initLineRect(pen);\r\n    calcPenRect(pen);\r\n  } else {\r\n    if (pen.calculative.rotate) {\r\n      pen.calculative.rotate += angle;\r\n    } else {\r\n      pen.calculative.rotate = angle;\r\n    }\r\n    rotatePoint(pen.calculative.worldRect.center, angle, rect.center);\r\n    if (pen.parentId) {\r\n      pen.calculative.worldRect.x =\r\n        pen.calculative.worldRect.center.x -\r\n        pen.calculative.worldRect.width / 2;\r\n      pen.calculative.worldRect.y =\r\n        pen.calculative.worldRect.center.y -\r\n        pen.calculative.worldRect.height / 2;\r\n      pen.x = (pen.calculative.worldRect.x - rect.x) / rect.width;\r\n      pen.y = (pen.calculative.worldRect.y - rect.y) / rect.height;\r\n    }\r\n  }\r\n\r\n  pen.children?.forEach((id) => {\r\n    const child = pen.calculative.canvas.store.pens[id];\r\n    rotatePen(child, angle, rect);\r\n  });\r\n}\r\n\r\nfunction initLineRect(pen: Pen) {\r\n  if (!pen.calculative.worldAnchors?.length) {\r\n    return;\r\n  }\r\n  if (!isFinite(pen.x) || !isFinite(pen.x)) {\r\n    return;\r\n  }\r\n  if (pen.x == null || pen.y == null) {\r\n    return;\r\n  }\r\n  const rect = getLineRect(pen);\r\n  if (!pen.parentId) {\r\n    Object.assign(pen, rect);\r\n  }\r\n  const { fontSize, lineHeight } = pen.calculative.canvas.store.options;\r\n  if (!pen.fontSize) {\r\n    pen.fontSize = fontSize >= 0 ? fontSize : 12;\r\n    pen.calculative.fontSize =\r\n      pen.fontSize * pen.calculative.canvas.store.data.scale;\r\n  } else if (pen.fontSize < 0) {\r\n    pen.fontSize = 0;\r\n    pen.calculative.fontSize = 0;\r\n  }\r\n  if (!pen.lineHeight) {\r\n    pen.lineHeight = lineHeight;\r\n    pen.calculative.lineHeight = pen.lineHeight;\r\n  }\r\n  calcCenter(rect);\r\n  pen.calculative.worldRect = rect;\r\n  calcPadding(pen, rect);\r\n  calcTextRect(pen);\r\n  if (pen.calculative.worldAnchors) {\r\n    pen.anchors = pen.calculative.worldAnchors.map((pt) => {\r\n      return calcRelativePoint(pt, pen.calculative.worldRect);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 画笔们的 disableSize = true\r\n * 即 全部不允许改变大小 返回 true\r\n * @param pens 画笔\r\n * @returns\r\n */\r\nexport function getPensDisableResize(pens: Pen[]): boolean {\r\n  return pens.every((pen) => pen.disableSize || pen.pivot); //旋转中心点图元不允许改变大小\r\n}\r\n\r\nexport function getFrameValue(pen: Pen, prop: string, frameIndex: number) {\r\n  if (!pen.frames || !prop) {\r\n    return 0;\r\n  }\r\n\r\n  let v = 0;\r\n  for (let i = 0; i < frameIndex; i++) {\r\n    if (pen.frames[i]) {\r\n      v += pen.frames[i][prop] || 0;\r\n    }\r\n  }\r\n\r\n  return v;\r\n}\r\n\r\n/**\r\n * 判断该画笔 是否是组合为状态中 展示的画笔\r\n */\r\nexport function isShowChild(pen: Pen, store: Meta2dStore) {\r\n  let selfPen = pen;\r\n  while (selfPen && selfPen.parentId) {\r\n    const oldPen = selfPen;\r\n    selfPen = store.pens[selfPen.parentId];\r\n    const showChildIndex = selfPen?.calculative?.showChild;\r\n    if (showChildIndex != undefined) {\r\n      const showChildId = selfPen.children[showChildIndex];\r\n      if (showChildId !== oldPen.id) {\r\n        // toPng 不展示它\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * 计算画笔的 inView\r\n * @param pen 画笔\r\n * @param calcChild 是否计算子画笔\r\n */\r\nexport function calcInView(pen: Pen, calcChild = false) {\r\n  const { store, canvasRect } = pen.calculative.canvas as Canvas;\r\n  if (calcChild) {\r\n    pen.children?.forEach((id) => {\r\n      const child = store.pens[id];\r\n      child && calcInView(child, true);\r\n    });\r\n  }\r\n\r\n  pen.calculative.inView = true;\r\n  if (\r\n    !isShowChild(pen, store) ||\r\n    pen.visible == false ||\r\n    pen.calculative.visible == false\r\n  ) {\r\n    pen.calculative.inView = false;\r\n  } else {\r\n    const { x, y, width, height, rotate } = pen.calculative.worldRect;\r\n    const penRect: Rect = {\r\n      x: x + store.data.x,\r\n      y: y + store.data.y,\r\n      width,\r\n      height,\r\n      rotate,\r\n    };\r\n    calcRightBottom(penRect);\r\n    if (!rectInRect(penRect, canvasRect)) {\r\n      pen.calculative.inView = false;\r\n    }\r\n  }\r\n  // TODO: 语义化上，用 onValue 更合适，但 onValue 会触发 echarts 图形的重绘，没有必要\r\n  // 更改 view 后，修改 dom 节点的显示隐藏\r\n  // pen.onMove?.(pen);\r\n  pen.calculative.singleton?.div &&\r\n    setElemPosition(pen, pen.calculative.singleton.div);\r\n}\r\n\r\n/**\r\n * 绘制 rect ，上线后可查看 rect 位置\r\n */\r\nfunction inspectRect(\r\n  ctx: CanvasRenderingContext2D,\r\n  store: Meta2dStore,\r\n  pen: Pen\r\n) {\r\n  if (store.fillWorldTextRect) {\r\n    ctx.save();\r\n    ctx.fillStyle = '#c3deb7';\r\n    const { x, y, width, height } = pen.calculative.worldTextRect;\r\n    ctx.fillRect(x, y, width, height);\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nexport function setGlobalAlpha(\r\n  ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D,\r\n  pen: Pen\r\n) {\r\n  const globalAlpha = pen.calculative.globalAlpha;\r\n  if (\r\n    typeof globalAlpha === 'number' &&\r\n    globalAlpha < 1 &&\r\n    !isNaN(globalAlpha)\r\n  ) {\r\n    ctx.globalAlpha = globalAlpha;\r\n  }\r\n}\r\n\r\n/**\r\n * ctx 绘制图纸，并非 Path2D\r\n * @param ctx 画布上下文\r\n * @param pen 画笔\r\n */\r\nfunction ctxDrawCanvas(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const canvasDraw =\r\n    drawFuncGenerator(ctx, pen) || globalStore.canvasDraws[pen.name];\r\n  if (canvasDraw) {\r\n    // TODO: 后续考虑优化 save / restore\r\n    ctx.save();\r\n    // TODO: 原有 return 终止后续操作，必要性不大\r\n    canvasDraw(ctx, pen);\r\n    ctx.restore();\r\n  }\r\n}\r\nfunction drawFuncGenerator(ctx: CanvasRenderingContext2D, pen: any) {\r\n  // 进行数据的预处理\r\n  const drawCommand:Array<any> = pen.drawCommand;\r\n  if(!drawCommand || pen.name === 'line')return ;\r\n  // 单位转换 将其他单位转换为px\r\n\r\n  // 执行自定义绘画函数\r\n  return (ctx: CanvasRenderingContext2D,pen: Pen)=> {\r\n    // TODO  绘制命令的转换 （能否兼容多种指令？？）\r\n    drawCommand.forEach((command)=> {\r\n      try {\r\n        command.steps = command.steps.flat(Infinity);\r\n        command.steps.reduce((calculate,step)=>{\r\n          const cs = commandTransfer(step,pen,calculate.x,calculate.y);\r\n          // 应当保证顺序的正确\r\n          try {\r\n            if(cs.c){\r\n              if(cs.c.startsWith('_')){\r\n                const prop = cs.c.split('_')[1];\r\n                if(typeof cs.v.value === \"number\")cs.v.value *= pen.calculative.canvas.store.data.scale;\r\n                // debugger;\r\n                (cs.p || ctx)[prop] = cs.v.value;\r\n                return {x:calculate.x,y:calculate.y};\r\n              }\r\n              let l = [];\r\n              for (const csKey in cs.v) {\r\n                l.push(cs.v[csKey]);\r\n              }\r\n              // ctx.beginPath();\r\n              (cs.p || ctx)[cs.c](...l);\r\n              // ctx.moveTo(cs.startX || cs.v.x,cs.startY || cs.v.y);\r\n              // command.prop.NoFill === '0'?ctx.fill():'';\r\n              return {x:cs.startX || cs.v.x, y:cs.startY||cs.v.y};\r\n            }\r\n            return {x:calculate.x,y:calculate.y};\r\n          }catch (e) {\r\n            // pass\r\n            // console.log(e,'error',cs);\r\n          }\r\n        },{});\r\n      }\r\n      catch (e) {\r\n      }\r\n    });\r\n    ctx.stroke();\r\n  };\r\n}\r\n\r\nfunction commandTransfer(command,pen,startX,startY){\r\n\r\n  // TODO 是否支持扩展更多的命令？用于兼容未来的其他解析格式？\r\n  //1. 进行简单的命令解析\r\n  // VISIO\r\n  const map = {\r\n    'visio':dealWithVisio,\r\n    'dxf':dealWithDXF\r\n  };\r\n  // CAD\r\n  return map[pen.parseType](command,pen,startX,startY);\r\n}\r\n\r\nfunction dealWithDXF(command,pen,startX,startY) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const {originWidth,originHeight} = pen.dxfOrigin;\r\n  switch (command.c) {\r\n    case \"beginPath\":\r\n      return {\r\n        c:'beginPath',\r\n        v:{}\r\n      };\r\n    case \"closePath\":\r\n      return {\r\n        c:'closePath',\r\n        v:{}\r\n      };\r\n    case \"moveTo\":\r\n      return {\r\n        c:'moveTo',\r\n        v:{\r\n          x: command.v.x * (width / originWidth) + x,\r\n          y: command.v.y * (height / originHeight) + y\r\n        }\r\n      };\r\n    case \"lineTo\":\r\n      return {\r\n        c:'lineTo',\r\n        v:{\r\n          x: command.v.x * (width / originWidth) + x,\r\n          y: command.v.y * (height / originHeight) + y\r\n        }\r\n      };\r\n    case \"arc\":\r\n      return {\r\n        c:'ellipse',\r\n        v:{\r\n          x:command.v.x * (width / originWidth) + x,\r\n          y:(command.v.y * (height / originHeight)) + y,\r\n          rx:command.v.xr * (width / originWidth),\r\n          ry:command.v.yr * (height / originHeight),\r\n          rotation:command.v.rotation || 0,\r\n          startAngle:command.v.startAngle,\r\n          endAngle: command.v.endAngle,\r\n          a:command.v.aclockwise ?? true\r\n        }\r\n      };\r\n    case \"ellipse\":\r\n      return {\r\n        c:'ellipse',\r\n        v:{\r\n          x:command.v.x * (width / originWidth) + x,\r\n          y:(command.v.y * (height / originHeight)) + y,\r\n          rx:command.v.xr * (width / originWidth),\r\n          ry:command.v.yr * (height / originHeight),\r\n          rotation:command.v.rotation || 0,\r\n          startAngle:command.v.startAngle,\r\n          endAngle: command.v.endAngle,\r\n          a:command.v.aclockwise ?? true\r\n        }\r\n      };\r\n    case \"_font\":\r\n      return {\r\n        c:'_font',\r\n        v:{\r\n          value:command.v.fontSize * pen.calculative.canvas.store.data.scale + 'px ' + (command.v.fontFamily || pen.calculative.canvas.store.options.fontFamily)\r\n        }\r\n      };\r\n    case \"_fillStyle\":\r\n      return {\r\n        c:'_fillStyle',\r\n        v:{\r\n          value:pen.color || command.v.value\r\n        }\r\n      };\r\n    default:\r\n      const c = {\r\n        c:command.c,\r\n        v:{\r\n          ...command.v,\r\n        }\r\n      };\r\n      if((c.v.x)!==undefined)c.v.x = command.v.x * (width / originWidth) + x;\r\n      if(c.v.y!==undefined)c.v.y = (command.v.y * (height / originHeight)) + y;\r\n      return c;\r\n  }\r\n}\r\nfunction dealWithVisio(command, pen, startX, startY) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const { width: originWidth, height: originHeight } = pen.origin;\r\n  switch (command.c) {\r\n    case 'MoveTo':\r\n      return {\r\n        c: 'moveTo',\r\n        v: {\r\n          x: +command.v.X * 100 * (width / originWidth) + x,\r\n          y: +command.v.Y * 100 * (height / originHeight) + y,\r\n        },\r\n      };\r\n    case 'RelMoveTo':\r\n      return {\r\n        c: 'moveTo',\r\n        v: {\r\n          x: +command.v.X * originWidth * (width / originWidth) + x,\r\n          y: +command.v.Y * originHeight * (height / originHeight) + y,\r\n        },\r\n      };\r\n    case 'LineTo':\r\n      return {\r\n        c: 'lineTo',\r\n        v: {\r\n          x: +command.v.X * 100 * (width / originWidth) + x,\r\n          y: +command.v.Y * 100 * (height / originHeight) + y,\r\n        },\r\n      };\r\n    case 'RelLineTo':\r\n      return {\r\n        c: 'lineTo',\r\n        v: {\r\n          x: +command.v.X * originWidth * (width / originWidth) + x,\r\n          y: +command.v.Y * originHeight * (height / originHeight) + y,\r\n        },\r\n      };\r\n    case 'Ellipse':\r\n      let centerX1 = command.v.X;\r\n      let centerY1 = command.v.Y;\r\n      let longAxis = Math.abs(command.v.A - command.v.C);\r\n      let shortAxis = Math.abs(command.v.B - command.v.D);\r\n\r\n      return {\r\n        c: 'ellipse',\r\n        v: {\r\n          x: centerX1 * 100 * (width / originWidth) + x,\r\n          y: centerY1 * 100 * (height / originHeight) + y,\r\n          radiuX: longAxis * 100 * (width / originWidth),\r\n          radiuY: shortAxis * 100 * (height / originHeight),\r\n          rotation: 0,\r\n          startAngle: 0,\r\n          endAngle: Math.PI * 2,\r\n          anticlockwise: true,\r\n        },\r\n      };\r\n    case 'EllipticalArcTo':\r\n      const endX = command.v.X * 100 * (width / originWidth) + x; // 弧上结束顶点的 x 坐标\r\n      const endY = command.v.Y * 100 * (height / originHeight) + y; // 弧上结束顶点的 y 坐标\r\n      const ctrlX = command.v.A * 100 * (width / originWidth) + x; // 控制点的 x 坐标\r\n      const ctrlY = command.v.B * 100 * (height / originHeight) + y; // 控制点的 y 坐标\r\n      const angleDeg = command.v.C; // 主轴相对于 x 轴的角度 (度)\r\n      const axisRatio =\r\n        command.v.D * (width / height) * (originHeight / originWidth); // 长轴和短轴的比率\r\n      //\r\n\r\n      const crossProduct = (endX - startX) * (ctrlY - startY) - (endY - startY) * (ctrlX - startX) > 0;\r\n\r\n      const params = calculateEllipseParameters(\r\n        startX,\r\n        startY,\r\n        endX,\r\n        endY,\r\n        ctrlX,\r\n        ctrlY,\r\n        axisRatio\r\n      );\r\n      // 开始绘制路径\r\n      !command.orign && (command.orign = {});\r\n      !command.orign.startA &&\r\n        (command.orign.startA = calculateAngleInRadians(\r\n          params.x0,\r\n          params.y0,\r\n          startX,\r\n          startY\r\n        ));\r\n      !command.orign.endA &&\r\n        (command.orign.endA = calculateAngleInRadians(\r\n          params.x0,\r\n          params.y0,\r\n          endX,\r\n          endY\r\n        ));\r\n      return {\r\n        c: 'ellipse',\r\n        v: {\r\n          centerX: params.x0,\r\n          centerY: params.y0,\r\n          radiuX: params.a,\r\n          radiuY: params.b,\r\n          // rotation:radiansToDegrees(angleDeg),\r\n          rotation: 0,\r\n          startAngle: command.orign.startA,\r\n          endAngle: command.orign.endA,\r\n          // startAngle: 0,\r\n          // endAngle: Math.PI * 2,\r\n          // anticlockwise: startA > 0 && startA>endA\r\n          anticlockwise: crossProduct,\r\n          // anticlockwise: Math.abs(endA - startA) < Math.PI\r\n        },\r\n        startX: endX,\r\n        startY: endY,\r\n      };\r\n    case \"RelEllipticalArcTo\":\r\n      const endX3 = command.v.X * originWidth * (width / originWidth) + x; // 弧上结束顶点的 x 坐标\r\n      const endY3 = command.v.Y * originHeight * (height / originHeight) + y; // 弧上结束顶点的 y 坐标\r\n      const ctrlX3 = command.v.A * originWidth * (width / originWidth) + x; // 控制点的 x 坐标\r\n      const ctrlY3 = command.v.B * originHeight * (height / originHeight) + y; // 控制点的 y 坐标\r\n      const angleDeg3 = command.v.C; // 主轴相对于 x 轴的角度 (度)\r\n      const axisRatio3 =\r\n        command.v.D * (width / height) * (originHeight / originWidth); // 长轴和短轴的比率\r\n      //\r\n      const crossProduct2 = (endX3 - startX) * (ctrlY3 - startY) - (endY3 - startY) * (ctrlX3 - startX) > 0;\r\n\r\n      const params2 = calculateEllipseParameters(\r\n        startX,\r\n        startY,\r\n        endX3,\r\n        endY3,\r\n        ctrlX3,\r\n        ctrlY3,\r\n        axisRatio3\r\n      );\r\n      // 开始绘制路径\r\n      !command.orign && (command.orign = {});\r\n      !command.orign.startA &&\r\n      (command.orign.startA = calculateAngleInRadians(\r\n        params2.x0,\r\n        params2.y0,\r\n        startX,\r\n        startY\r\n      ));\r\n      !command.orign.endA &&\r\n      (command.orign.endA = calculateAngleInRadians(\r\n        params2.x0,\r\n        params2.y0,\r\n        endX3,\r\n        endY3\r\n      ));\r\n      return {\r\n        c: 'ellipse',\r\n        v: {\r\n          centerX: params2.x0,\r\n          centerY: params2.y0,\r\n          radiuX: params2.a,\r\n          radiuY: params2.b,\r\n          // rotation:radiansToDegrees(angleDeg),\r\n          rotation: 0,\r\n          startAngle: command.orign.startA,\r\n          endAngle: command.orign.endA,\r\n          // startAngle: 0,\r\n          // endAngle: Math.PI * 2,\r\n          // anticlockwise: startA > 0 && startA>endA\r\n          anticlockwise: crossProduct2\r\n          // anticlockwise: Math.abs(endA - startA) < Math.PI\r\n        },\r\n        startX: endX3,\r\n        startY: endY3,\r\n      };\r\n    case 'ArcTo':\r\n      let endX2 = (command.v.X * 100 * width) / originWidth + x;\r\n      let endY2 = (command.v.Y * 100 * height) / originHeight + y;\r\n      let h =\r\n        command.v.A * 100 * (width / height) * (originHeight / originWidth);\r\n      // 计算弦的中点\r\n      let xm = (startX + endX2) / 2;\r\n      let ym = (startY + endY2) / 2;\r\n\r\n      // 计算弦的长度\r\n      let d = Math.sqrt((endX2 - startX) ** 2 + (endY2 - startY) ** 2);\r\n\r\n      // 计算圆弧的半径\r\n      let R = d ** 2 / (8 * h) + h / 2;\r\n\r\n      // 计算单位垂直向量\r\n      let ux = -(endY2 - startY) / d;\r\n      let uy = (endX2 - startX) / d;\r\n\r\n      // 计算两个可能的圆心\r\n      let xc1 = xm + ux * R;\r\n      let yc1 = ym + uy * R;\r\n      let xc2 = xm - ux * R;\r\n      let yc2 = ym - uy * R;\r\n\r\n      // 选择一个圆心\r\n      let xc = xc1;\r\n      let yc = yc1;\r\n\r\n      // 计算起点和终点到圆心的角度\r\n      let startAngle = Math.atan2(startY - yc, startX - xc);\r\n      let endAngle = Math.atan2(endY2 - yc, endX2 - xc);\r\n      return {\r\n        c: 'arc',\r\n        v: {\r\n          x: xc,\r\n          y: yc,\r\n          radius: R,\r\n          startAngle: startAngle,\r\n          endAngle: endAngle,\r\n          aclockwise: true,\r\n        },\r\n      };\r\n    default:\r\n      const cloneCommand = deepClone(command)\r\n      Object.entries(cloneCommand.v).forEach(([k,v]:any)=>{\r\n        // 表明此类型为\r\n          if(k.endsWith?.('_x')){\r\n            if(typeof v === \"number\") cloneCommand.v[k] = v * (width / originWidth) + x;\r\n          } else if(k.endsWith?.(\"_y\")){\r\n            if(typeof v === \"number\") cloneCommand.v[k] = v * (height / originHeight) + y;\r\n          }else {\r\n            if(typeof v === \"number\") cloneCommand.v[k] = v\r\n          }\r\n      })\r\n      return cloneCommand;\r\n  }\r\n}\r\nexport function setChildValue(pen: Pen, data: IValue) {\r\n  for (const k in data) {\r\n    if (inheritanceProps.includes(k)) {\r\n      if (k == 'fontSize' && data[k] < 0) {\r\n        data[k] = 0;\r\n      }\r\n      pen[k] = data[k];\r\n      if (['fontSize', 'lineWidth'].includes(k)) {\r\n        pen.calculative[k] = data[k] * pen.calculative.canvas.store.data.scale;\r\n        calcTextRect(pen);\r\n      } else {\r\n        pen.calculative[k] = data[k];\r\n      }\r\n    }\r\n  }\r\n  if (\r\n    pen.calculative.canvas.parent.isCombine(pen)\r\n    //&& pen.showChild === undefined\r\n  ) {\r\n    const children = pen.children;\r\n    children?.forEach((childId) => {\r\n      let _data = deepClone(data);\r\n      if (pen.calculative.childrenVisible) {\r\n        if (pen.calculative.childrenVisible[childId] === false) {\r\n          delete _data.visible;\r\n        }\r\n      }\r\n      const child = pen.calculative.canvas.store.pens[childId];\r\n      child && setChildValue(child, _data);\r\n    });\r\n  }\r\n}\r\n\r\nfunction calculateEllipseParameters(x1, y1, x2, y2, x3, y3, D) {\r\n  // Calculate x₀ using equation ⑥\r\n  let numeratorX0 =\r\n    (x1 - x2) * (x1 + x2) * (y2 - y3) -\r\n    (x2 - x3) * (x2 + x3) * (y1 - y2) +\r\n    D * D * (y1 - y2) * (y2 - y3) * (y1 - y3);\r\n  let denominatorX0 = 2 * ((x1 - x2) * (y2 - y3) - (x2 - x3) * (y1 - y2));\r\n  let x0 = numeratorX0 / denominatorX0;\r\n\r\n  // Calculate y₀ using equation ⑦\r\n  let numeratorY0 =\r\n    (x1 - x2) * (x2 - x3) * (x1 - x3) +\r\n    D *\r\n      D *\r\n      ((x2 - x3) * (y1 - y2) * (y1 + y2) - (x1 - x2) * (y2 - y3) * (y2 + y3));\r\n  let denominatorY0 =\r\n    2 * D * D * ((x2 - x3) * (y1 - y2) - (x1 - x2) * (y2 - y3));\r\n  let y0 = numeratorY0 / denominatorY0;\r\n\r\n  // Calculate 'a' using equation ⑧, substituting x₀ and y₀\r\n  let a = Math.sqrt(Math.pow(x1 - x0, 2) + Math.pow(D * (y1 - y0), 2));\r\n\r\n  // Calculate 'b' using equation ⑨\r\n  let b = a / D;\r\n\r\n  return { x0, y0, a, b };\r\n}\r\n\r\nfunction calculateAngleInRadians(x1, y1, x2, y2) {\r\n  // 计算两个点的差值\r\n  let dx = x2 - x1;\r\n  let dy = y2 - y1;\r\n\r\n  // 使用 atan2 计算角度，结果为弧度\r\n  let angleRadians = Math.atan2(dy, dx);\r\n\r\n  // 如果角度为负值，加上2π\r\n  if (angleRadians < 0) {\r\n    angleRadians += 2 * Math.PI;\r\n  }\r\n  return angleRadians;\r\n}\r\n","import { PenType } from '.';\r\nimport { Point } from '../point';\r\nimport {\r\n  calcCenter,\r\n  expandRect,\r\n  Rect,\r\n  rectInFourAngRect,\r\n  rectToPoints,\r\n} from '../rect';\r\nimport { Meta2dStore } from '../store';\r\nimport { deepClone } from '../utils';\r\nimport { Pen } from './model';\r\n\r\nexport function calcAnchorDock(\r\n  store: Meta2dStore,\r\n  e: Point,\r\n  curAnchor?: Point\r\n) {\r\n  let xDock: Point;\r\n  let yDock: Point;\r\n  let x = Infinity;\r\n  let y = Infinity;\r\n  const size = 8;\r\n  for (const pen of store.data.pens) {\r\n    if (pen.calculative.inView === false) {\r\n      continue;\r\n    }\r\n\r\n    // 得到图形的全部点\r\n    const points = getPointsByPen(pen);\r\n    points.forEach((pt) => {\r\n      if (pt === e || pt === curAnchor) {\r\n        return;\r\n      }\r\n      let distance =\r\n        (pen.calculative.worldRect.center.x - e.x) *\r\n          (pen.calculative.worldRect.center.x - e.x) +\r\n        (pen.calculative.worldRect.center.y - e.y) *\r\n          (pen.calculative.worldRect.center.y - e.y);\r\n      const disX = Math.abs(pt.x - e.x);\r\n      if (disX > 0 && disX < size && distance < x) {\r\n        xDock = {\r\n          x: Math.round(pt.x) + 0.5,\r\n          y: Math.round(pt.y) + 0.5,\r\n          prev: {\r\n            x: Math.round(e.x) + 0.5,\r\n            y: Math.round(e.y) + 0.5,\r\n          },\r\n          step: pt.x - e.x,\r\n        };\r\n        x = distance;\r\n      }\r\n      const disY = Math.abs(pt.y - e.y);\r\n      if (disY > 0 && disY < size && distance < y) {\r\n        yDock = {\r\n          x: Math.round(pt.x) + 0.5,\r\n          y: Math.round(pt.y) + 0.5,\r\n          prev: {\r\n            x: Math.round(e.x) + 0.5,\r\n            y: Math.round(e.y) + 0.5,\r\n          },\r\n          step: pt.y - e.y,\r\n        };\r\n        y = distance;\r\n      }\r\n    });\r\n  }\r\n\r\n  return {\r\n    xDock,\r\n    yDock,\r\n  };\r\n}\r\n\r\nexport function calcMoveDock(\r\n  store: Meta2dStore,\r\n  rect: Rect,\r\n  pens: Pen[],\r\n  offset: Point\r\n) {\r\n  // 找到 points ，深拷贝一下，不影响原值\r\n  let activePoints: Point[] = [];\r\n  if (pens.length === 1) {\r\n    activePoints = deepClone(getPointsByPen(pens[0]));\r\n    activePoints.forEach((point) => {\r\n      point.x += offset.x;\r\n      point.y += offset.y;\r\n    });\r\n  } else {\r\n    calcCenter(rect);\r\n    activePoints = [rect.center, ...rectToPoints(rect)];\r\n  }\r\n  return calcDockByPoints(store, activePoints, rect, true);\r\n}\r\n\r\n/**\r\n * 得到画笔的全部点\r\n * 线 即全部的 worldAnchors\r\n * 图形 即全部的 worldAnchors ，加上边缘四个点以及中心点\r\n * @param pen 画笔\r\n */\r\nexport function getPointsByPen(pen: Pen): Point[] {\r\n  if (!pen.type) {\r\n    const outerPoints = rectToPoints(pen.calculative.worldRect);\r\n    calcCenter(pen.calculative.worldRect);\r\n    return [\r\n      ...pen.calculative.worldAnchors,\r\n      ...outerPoints,\r\n      pen.calculative.worldRect.center,\r\n    ];\r\n  } else if (pen.type === PenType.Line) {\r\n    return pen.calculative.worldAnchors;\r\n  }\r\n}\r\n\r\nexport function calcResizeDock(\r\n  store: Meta2dStore,\r\n  rect: Rect,\r\n  pens: Pen[],\r\n  resizeIndex: number\r\n): { xDock: Point; yDock: Point } {\r\n  const activePoints = rectToPoints(rect);\r\n  return calcDockByPoints(store, activePoints, rect);\r\n}\r\n\r\n/**\r\n * 通过当前 活动层 的所有点 计算 dock\r\n * @param activePoints 活动层 的所有点\r\n * @param rect 当前区域\r\n * @param calcActive 是否与 活动层画笔 的点进行计算\r\n */\r\nfunction calcDockByPoints(\r\n  store: Meta2dStore,\r\n  activePoints: Point[],\r\n  rect: Rect,\r\n  calcActive = false\r\n): { xDock: Point; yDock: Point } {\r\n  let xDock: Point;\r\n  let yDock: Point;\r\n  let minCloseX = Infinity;\r\n  let minCloseY = Infinity;\r\n\r\n  // 临近范围\r\n  const closeSize = 10;\r\n  const paddingRect = expandRect(rect, closeSize);\r\n  store.data.pens.forEach((pen) => {\r\n    const { inView, worldRect, active } = pen.calculative;\r\n    if (\r\n      inView === false ||\r\n      (!calcActive && active) || // 如果不计算活动层，则过滤掉活动层\r\n      rectInFourAngRect(paddingRect, worldRect) || // 水平和垂直方向 无重合\r\n      (pen.type &&\r\n        store.active.some((active) => isConnectLine(store, active, pen)))\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // 得到图形的全部点\r\n    const points = getPointsByPen(pen);\r\n    if (!points) {\r\n      return;\r\n    }\r\n    // 比对 points 中的点，必须找出最近的点，不可提前跳出\r\n    for (const point of points) {\r\n      for (const activePoint of activePoints) {\r\n        const stepX = point.x - activePoint.x;\r\n        const stepY = point.y - activePoint.y;\r\n        const absStepX = Math.abs(stepX);\r\n        const absStepY = Math.abs(stepY);\r\n        if (!rect.center) {\r\n          rect.center = {\r\n            x: rect.x + rect.width / 2,\r\n            y: rect.y + rect.height / 2,\r\n          };\r\n        }\r\n        if (absStepX < closeSize && absStepX < minCloseX) {\r\n          xDock = {\r\n            x: Math.round(point.x) + 0.5,\r\n            y: Math.round(point.y) + 0.5,\r\n            step: stepX,\r\n            prev: {\r\n              x: Math.round(activePoint.x) + 0.5,\r\n              y: Math.round(activePoint.y) + 0.5,\r\n            },\r\n            penId: pen.id,\r\n            anchorId: activePoint.id,\r\n            dockAnchorId: point.id,\r\n          };\r\n          minCloseX = absStepX;\r\n        }\r\n        if (absStepY < closeSize && absStepY < minCloseY) {\r\n          yDock = {\r\n            x: Math.round(point.x) + 0.5,\r\n            y: Math.round(point.y) + 0.5,\r\n            step: stepY,\r\n            prev: {\r\n              x: Math.round(activePoint.x) + 0.5,\r\n              y: Math.round(activePoint.y) + 0.5,\r\n            },\r\n            penId: pen.id,\r\n            anchorId: activePoint.id,\r\n            dockAnchorId: point.id,\r\n          };\r\n          minCloseY = absStepY;\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  return {\r\n    xDock,\r\n    yDock,\r\n  };\r\n}\r\n\r\n/**\r\n * 判断 line 是否是 active 的连接线（并且计算子节点）\r\n * @param store\r\n * @param active 本次计算的画笔\r\n * @param line 连线\r\n * @returns\r\n */\r\nfunction isConnectLine(store: Meta2dStore, active: Pen, line: Pen) {\r\n  if (!line.type) {\r\n    return false;\r\n  }\r\n  if (Array.isArray(active?.connectedLines)) {\r\n    for (const cline of active?.connectedLines) {\r\n      if (cline.lineId === line.id) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  // 考虑子节点\r\n  if (Array.isArray(active?.children)) {\r\n    for (const id of active.children) {\r\n      const child = store.pens[id];\r\n      if (isConnectLine(store, child, line)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * 是否近似于 num\r\n * @param num\r\n */\r\nexport function isEqual(source: number, target: number): boolean {\r\n  // @ts-ignore\r\n  return source.toFixed(12) == target;\r\n}\r\n","import { s8 } from '../utils';\r\nimport { Pen } from './model';\r\n\r\nexport function randomId(pen: Pen) {\r\n  pen.id = s8();\r\n  if (Array.isArray(pen.anchors)) {\r\n    for (const pt of pen.anchors) {\r\n      pen.type && (pt.id = s8());\r\n      pt.penId = pen.id;\r\n      if (pt.prev) {\r\n        pen.type && (pt.prev.id = s8());\r\n        pt.prev.penId = pen.id;\r\n      }\r\n\r\n      if (pt.next) {\r\n        pen.type && (pt.next.id = s8());\r\n        pt.next.penId = pen.id;\r\n      }\r\n    }\r\n  }\r\n}\r\n","// 该文件为penPlugin的相关文件\r\n\r\nimport {Pen} from \"../pen\";\r\n\r\n/**\r\n * @description 闭包 重写 pen的生命周期，为了追加回调函数\r\n * @return 生命周期操作函数，可在原生命周期回调函数基础上进行执行多个函数，可通过传参，设置函数的增加和删除，类似addEventListener 和 removeEventListener\r\n * @bug 漏洞：后面的生命周期无法将前面的生命周期需要的参数正确传递\r\n */\r\nfunction rewritePenLifeCycle() {\r\n  let funcMap = null;\r\n  let funcPenMap = new Map();\r\n  return (pen: Pen, lifeCycle, func: Function, del= false )=>{\r\n    if(funcPenMap.has(pen) && funcPenMap.get(pen)){\r\n      funcMap = funcPenMap.get(pen);\r\n    }else {\r\n      funcPenMap.set(pen,funcMap = new Map());\r\n    }\r\n    if(typeof func !== \"function\")return ()=>{\r\n      console.warn('[rewritePenLifeCycle] warn: not a function ');\r\n    };\r\n    let funcListSet = new Set();\r\n    let originFuncMap = new Map(); // 原始事件回调Map\r\n    if(funcMap.has(lifeCycle) && funcMap.get(lifeCycle)){\r\n      funcListSet = funcMap.get(lifeCycle);\r\n    }else {\r\n      originFuncMap.set(lifeCycle,pen[lifeCycle]);\r\n      funcMap.set(lifeCycle,funcListSet);\r\n    }\r\n    if(del){\r\n      funcListSet.delete(func);\r\n    }else {\r\n      funcListSet.add(func);\r\n    }\r\n    let originLifeCycle = originFuncMap.get(lifeCycle); // 原始事件;\r\n    let rewriteFunc = (...args)=>{\r\n      originLifeCycle?.(...args);\r\n      funcListSet.forEach(i=>{\r\n        // @ts-ignore\r\n        i(...args);\r\n      });\r\n    };\r\n    pen[lifeCycle] = rewriteFunc;\r\n  };\r\n}\r\nexport let setLifeCycleFunc = rewritePenLifeCycle();\r\n\r\n/**\r\n * @description 校验插件*/\r\nexport function validationPlugin(plugin){\r\n  // 校验penPlugin\r\n  if(!plugin.name && !plugin.install){\r\n    console.error('installPenPlugin Error: Validation Failed');\r\n    return false;\r\n  }\r\n  return  true;\r\n}\r\n","import { isEqual, Pen } from '../pen';\r\nimport { Point, rotatePoint, scalePoint } from '../point';\r\nimport { formatPadding, Padding } from '../utils';\r\n\r\nexport interface Rect {\r\n  x?: number;\r\n  y?: number;\r\n  ex?: number;\r\n  ey?: number;\r\n  width?: number;\r\n  height?: number;\r\n  rotate?: number;\r\n  center?: Point;\r\n  pivot?: Point; //旋转中心\r\n}\r\n\r\nexport function pointInRect(pt: Point, rect: Rect) {\r\n  if (!rect) {\r\n    return;\r\n  }\r\n  if (rect.ex == null) {\r\n    calcRightBottom(rect);\r\n  }\r\n\r\n  if (\r\n    !rect.rotate ||\r\n    // rect.width < 20 ||\r\n    // rect.height < 20 ||\r\n    rect.rotate % 360 === 0\r\n  ) {\r\n    return pt.x > rect.x && pt.x < rect.ex && pt.y > rect.y && pt.y < rect.ey;\r\n  }\r\n\r\n  if (!rect.center) {\r\n    calcCenter(rect);\r\n  }\r\n\r\n  const pts: Point[] = [\r\n    { x: rect.x, y: rect.y },\r\n    { x: rect.ex, y: rect.y },\r\n    { x: rect.ex, y: rect.ey },\r\n    { x: rect.x, y: rect.ey },\r\n  ];\r\n  pts.forEach((item: Point) => {\r\n    rotatePoint(item, rect.rotate, rect.pivot || rect.center);\r\n  });\r\n\r\n  return pointInVertices(pt, pts);\r\n}\r\n\r\nexport function pointInSimpleRect(pt: Point, rect: Rect, r = 0) {\r\n  const { x, y, ex, ey } = rect;\r\n  return pt.x >= x - r && pt.x <= ex + r && pt.y >= y - r && pt.y <= ey + r;\r\n}\r\n\r\nexport function calcCenter(rect: Rect) {\r\n  if (!rect.center) {\r\n    rect.center = {} as Point;\r\n  }\r\n  rect.center.x = rect.x + rect.width / 2;\r\n  rect.center.y = rect.y + rect.height / 2;\r\n}\r\n\r\nexport function calcRightBottom(rect: Rect) {\r\n  rect.ex = rect.x + rect.width;\r\n  rect.ey = rect.y + rect.height;\r\n}\r\n\r\nexport function calcPivot(rect: Rect, pivot:Point) {\r\n  if (!rect.pivot) {\r\n    rect.pivot = {} as Point;\r\n  }\r\n  rect.pivot.x = rect.x + rect.width * pivot.x;\r\n  rect.pivot.y = rect.y + rect.height * pivot.y;\r\n}\r\n\r\nexport function pointInVertices(\r\n  point: { x: number; y: number },\r\n  vertices: Point[]\r\n): boolean {\r\n  if (vertices.length < 3) {\r\n    return false;\r\n  }\r\n  let isIn = false;\r\n  let last = vertices[vertices.length - 1];\r\n  for (const item of vertices) {\r\n    if (last.y > point.y !== item.y > point.y) {\r\n      if (\r\n        item.x + ((point.y - item.y) * (last.x - item.x)) / (last.y - item.y) >\r\n        point.x\r\n      ) {\r\n        isIn = !isIn;\r\n      }\r\n    }\r\n\r\n    last = item;\r\n  }\r\n\r\n  return isIn;\r\n}\r\n\r\nexport function getRect(pens: Pen[]): Rect {\r\n  const points: Point[] = [];\r\n  pens.forEach((pen) => {\r\n    if (pen.isRuleLine) {\r\n      return;\r\n    }\r\n    const rect = pen.calculative.worldRect;\r\n    if (rect) {\r\n      const pts = rectToPoints(rect);\r\n      // rectToPoints 已经计算过 rotate 无需重复计算\r\n      points.push(...pts);\r\n    }\r\n  });\r\n\r\n  const rect = getRectOfPoints(points);\r\n  calcCenter(rect);\r\n  return rect;\r\n}\r\n\r\nexport function rectToPoints(rect: Rect) {\r\n  const pts = [\r\n    { x: rect.x, y: rect.y },\r\n    { x: rect.ex, y: rect.y },\r\n    { x: rect.ex, y: rect.ey },\r\n    { x: rect.x, y: rect.ey },\r\n  ];\r\n\r\n  if (rect.rotate) {\r\n    if (!rect.center) {\r\n      calcCenter(rect);\r\n    }\r\n    pts.forEach((pt) => {\r\n      rotatePoint(pt, rect.rotate, rect.pivot || rect.center);\r\n    });\r\n  }\r\n  return pts;\r\n}\r\n\r\nexport function getRectOfPoints(points: Point[]): Rect {\r\n  let x = Infinity;\r\n  let y = Infinity;\r\n  let ex = -Infinity;\r\n  let ey = -Infinity;\r\n\r\n  points?.forEach((item) => {\r\n    if (!isFinite(item.x) || !isFinite(item.y)) {\r\n      return;\r\n    }\r\n    x = Math.min(x, item.x);\r\n    y = Math.min(y, item.y);\r\n    ex = Math.max(ex, item.x);\r\n    ey = Math.max(ey, item.y);\r\n  });\r\n  return { x, y, ex, ey, width: ex - x, height: ey - y };\r\n}\r\n\r\nexport function rectInRect(source: Rect, target: Rect, allIn?: boolean) {\r\n  if (source.rotate) {\r\n    // 根据 rotate 扩大 rect\r\n    source = getRectOfPoints(rectToPoints(source)); // 更改 source 引用地址值，不影响原值\r\n  }\r\n  if (allIn) {\r\n    return (\r\n      source.x > target.x &&\r\n      source.ex < target.ex &&\r\n      source.y > target.y &&\r\n      source.ey < target.ey\r\n    );\r\n  }\r\n  return !(\r\n    source.x > target.ex ||\r\n    source.ex < target.x ||\r\n    source.ey < target.y ||\r\n    source.y > target.ey\r\n  );\r\n}\r\n\r\n/**\r\n * 一个 rect 在另一个 rect 的 四个角，即水平区域不重合，垂直区域不重合\r\n */\r\nexport function rectInFourAngRect(source: Rect, target: Rect) {\r\n  return (\r\n    (target.x > source.ex || target.ex < source.x) &&\r\n    (target.y > source.ey || target.ey < source.y)\r\n  );\r\n}\r\n\r\n/**\r\n * 扩大 rect ，x，y，ex，ey 值都会变\r\n * @param rect 原 rect ，无副作用\r\n * @param size padding 类型，可传四个方向的值，也可以只传一个值\r\n */\r\nexport function expandRect(rect: Rect, size: Padding): Rect {\r\n  const padding = formatPadding(size);\r\n  const retRect = {\r\n    x: rect.x - padding[3],\r\n    y: rect.y - padding[0],\r\n    width: rect.width + padding[1] + padding[3],\r\n    height: rect.height + padding[0] + padding[2],\r\n  };\r\n  calcRightBottom(retRect);\r\n  return retRect;\r\n}\r\n\r\nexport function translateRect(rect: Rect | Pen, x: number, y: number) {\r\n  rect.x += x;\r\n  rect.y += y;\r\n  rect.ex += x;\r\n  rect.ey += y;\r\n\r\n  if (rect.center) {\r\n    rect.center.x += x;\r\n    rect.center.y += y;\r\n  }\r\n\r\n  if(rect.pivot){\r\n    rect.pivot.x += x;\r\n    rect.pivot.y += y;\r\n  }\r\n}\r\n\r\n/**\r\n * 通过两条线段计算出相交的点\r\n * @param line1 线段1\r\n * @param line2 线段2\r\n */\r\nfunction getIntersectPoint(\r\n  line1: { from: Point; to: Point },\r\n  line2: { from: Point; to: Point }\r\n): Point {\r\n  const k1 = (line1.to.y - line1.from.y) / (line1.to.x - line1.from.x);\r\n  const k2 = (line2.to.y - line2.from.y) / (line2.to.x - line2.from.x);\r\n  return getIntersectPointByK(\r\n    {\r\n      k: k1,\r\n      point: line1.from,\r\n    },\r\n    {\r\n      k: k2,\r\n      point: line2.from,\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * 该方法作用同上，不过此方法需要传的是 斜率\r\n * @param line1 线段1\r\n * @param line2 线段2\r\n * @returns\r\n */\r\nfunction getIntersectPointByK(\r\n  line1: { k: number; point: Point },\r\n  line2: { k: number; point: Point }\r\n): Point {\r\n  if (isEqual(line1.k, 0)) {\r\n    return {\r\n      x: line2.point.x,\r\n      y: line1.point.y,\r\n    };\r\n  } else if (isEqual(line2.k, 0)) {\r\n    return {\r\n      x: line1.point.x,\r\n      y: line2.point.y,\r\n    };\r\n  }\r\n\r\n  const b1 = line1.point.y - line1.k * line1.point.x;\r\n  const b2 = line2.point.y - line2.k * line2.point.x;\r\n  const x = (b2 - b1) / (line1.k - line2.k);\r\n  const y = line1.k * x + b1;\r\n\r\n  return {\r\n    x,\r\n    y,\r\n  };\r\n}\r\n\r\n/**\r\n * 通过 4 个点和旋转角度，计算出原矩形（旋转前的矩形）\r\n * @param pts 4 个点\r\n * @param rotate 旋转角度\r\n */\r\nfunction pointsToRect(pts: Point[], rotate: number): Rect {\r\n  // 1. 计算 center，认为 0，2 ；1，3 的连线相交就是 center 点\r\n  const center = getIntersectPoint(\r\n    {\r\n      from: pts[0],\r\n      to: pts[2],\r\n    },\r\n    {\r\n      from: pts[1],\r\n      to: pts[3],\r\n    }\r\n  );\r\n  // 2. 把点反向转 rotate °\r\n  for (const pt of pts) {\r\n    rotatePoint(pt, -rotate, center);\r\n  }\r\n  // 3. 计算区域\r\n  return getRectOfPoints(pts);\r\n}\r\n\r\nexport function resizeRect(\r\n  rect: Rect | Pen,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  resizeIndex: number\r\n) {\r\n  let calcRotate = rect.rotate?rect.rotate % 360 : 0;\r\n  if (calcRotate) {\r\n    // 计算出外边的四个点\r\n    const pts = rectToPoints(rect);\r\n    // 斜率不改变，提前计算\r\n    const k1 = (pts[0].y - pts[1].y) / (pts[0].x - pts[1].x);\r\n    const k2 = (pts[1].y - pts[2].y) / (pts[1].x - pts[2].x);\r\n    if (resizeIndex < 4) {\r\n      // 斜对角的四个点\r\n      // resize 的点\r\n      pts[resizeIndex].x += offsetX;\r\n      if((rect as Pen ).ratio){\r\n        if(resizeIndex === 0 || resizeIndex === 2){\r\n          let calcOffsetY = offsetX * Math.tan((90-(360-calcRotate) - (Math.atan(rect.width/rect.height))/Math.PI*180)/ 180 * Math.PI);\r\n          pts[resizeIndex].y += calcOffsetY;\r\n        }else {\r\n          let calcOffsetY = offsetX * Math.tan((90-(360-calcRotate) + (Math.atan(rect.width/rect.height))/Math.PI*180)/ 180 * Math.PI);\r\n          pts[resizeIndex].y += calcOffsetY;\r\n        }\r\n      }else{\r\n        pts[resizeIndex].y += offsetY;\r\n      }\r\n      // 不变的点\r\n      const noChangePoint = pts[(resizeIndex + 2) % 4];\r\n      // 由于斜率是不变的，我们只需要根据斜率 和 已知的两点求出相交的 另外两点\r\n      pts[(resizeIndex + 1) % 4] = getIntersectPointByK(\r\n        { k: resizeIndex % 2 ? k2 : k1, point: pts[resizeIndex] },\r\n        { k: resizeIndex % 2 ? k1 : k2, point: noChangePoint }\r\n      );\r\n      pts[(resizeIndex + 4 - 1) % 4] = getIntersectPointByK(\r\n        { k: resizeIndex % 2 ? k1 : k2, point: pts[resizeIndex] },\r\n        { k: resizeIndex % 2 ? k2 : k1, point: noChangePoint }\r\n      );\r\n    } else {\r\n      // 边缘四个点有两个点固定\r\n      const k = [4, 6].includes(resizeIndex) ? k2 : k1;\r\n      if (!isEqual(k, 0)) {\r\n        pts[resizeIndex % 4].y += offsetY;\r\n        pts[resizeIndex % 4].x += offsetY / k;\r\n        pts[(resizeIndex + 1) % 4].y += offsetY;\r\n        pts[(resizeIndex + 1) % 4].x += offsetY / k;\r\n      } else {\r\n        pts[resizeIndex % 4].x += offsetX;\r\n        pts[(resizeIndex + 1) % 4].x += offsetX;\r\n      }\r\n    }\r\n    if (\r\n      (pts[0].x - pts[1].x) ** 2 + (pts[0].y - pts[1].y) ** 2 < 25 ||\r\n      (pts[1].x - pts[2].x) ** 2 + (pts[1].y - pts[2].y) ** 2 < 25\r\n    ) {\r\n      // 距离小于 5 不能继续 resize 了\r\n      return;\r\n    }\r\n    const retRect = pointsToRect(pts, rect.rotate);\r\n    calcCenter(retRect);\r\n    Object.assign(rect, retRect);\r\n    return;\r\n  }\r\n  switch (resizeIndex) {\r\n    case 0:\r\n      if (rect.width - offsetX < 5 || rect.height - offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.x += offsetX;\r\n      rect.y += offsetY;\r\n      rect.width -= offsetX;\r\n      rect.height -= offsetY;\r\n      break;\r\n    case 1:\r\n      if (rect.width + offsetX < 5 || rect.height - offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.ex += offsetX;\r\n      rect.y += offsetY;\r\n      rect.width += offsetX;\r\n      rect.height -= offsetY;\r\n      break;\r\n    case 2:\r\n      if (rect.width + offsetX < 5 || rect.height + offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.ex += offsetX;\r\n      rect.ey += offsetY;\r\n      rect.width += offsetX;\r\n      rect.height += offsetY;\r\n      break;\r\n    case 3:\r\n      if (rect.width - offsetX < 5 || rect.height + offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.x += offsetX;\r\n      rect.ey += offsetY;\r\n      rect.width -= offsetX;\r\n      rect.height += offsetY;\r\n      break;\r\n    case 4:\r\n      if (rect.height - offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.y += offsetY;\r\n      rect.height -= offsetY;\r\n      break;\r\n    case 5:\r\n      if (rect.width + offsetX < 5) {\r\n        break;\r\n      }\r\n      rect.ex += offsetX;\r\n      rect.width += offsetX;\r\n      break;\r\n    case 6:\r\n      if (rect.height + offsetY < 5) {\r\n        break;\r\n      }\r\n      rect.ey += offsetY;\r\n      rect.height += offsetY;\r\n      break;\r\n    case 7:\r\n      if (rect.width - offsetX < 5) {\r\n        break;\r\n      }\r\n      rect.x += offsetX;\r\n      rect.width -= offsetX;\r\n      break;\r\n  }\r\n}\r\n\r\nexport function scaleRect(rect: Rect, scale: number, center: Point, pivot?: Point) {\r\n  if (!rect) {\r\n    return;\r\n  }\r\n  rect.width *= scale;\r\n  rect.height *= scale;\r\n  scalePoint(rect as Point, scale, center);\r\n\r\n  calcRightBottom(rect);\r\n  calcCenter(rect);\r\n  if(pivot){\r\n    calcPivot(rect, pivot);\r\n  }\r\n}\r\n\r\nexport function calcRelativeRect(rect: Rect, worldRect: Rect) {\r\n  const relRect: Rect = {\r\n    x: (rect.x - worldRect.x) / worldRect.width,\r\n    y: (rect.y - worldRect.y) / worldRect.height,\r\n    width: rect.width / worldRect.width,\r\n    height: rect.height / worldRect.height,\r\n  };\r\n  calcRightBottom(relRect);\r\n\r\n  return relRect;\r\n}\r\n\r\n/**\r\n * 计算相对点 ，anchors 中的值都是百分比\r\n * @param pt 绝对坐标\r\n * @param worldRect 图形外接矩形\r\n * @returns 相对坐标点\r\n */\r\nexport function calcRelativePoint(pt: Point, worldRect: Rect) {\r\n  const { x, y, width, height } = worldRect;\r\n  const { penId, connectTo } = pt;\r\n  const point: Point = Object.assign({}, pt, {\r\n    x: width ? (pt.x - x) / width : 0,\r\n    y: height ? (pt.y - y) / height : 0,\r\n  });\r\n  if (pt.prev) {\r\n    point.prev = {\r\n      penId,\r\n      connectTo,\r\n      x: width ? (pt.prev.x - x) / width : 0,\r\n      y: height ? (pt.prev.y - y) / height : 0,\r\n    };\r\n  }\r\n  if (pt.next) {\r\n    point.next = {\r\n      penId,\r\n      connectTo,\r\n      x: width ? (pt.next.x - x) / width : 0,\r\n      y: height ? (pt.next.y - y) / height : 0,\r\n    };\r\n  }\r\n  return point;\r\n}\r\n\r\n//射线法 判断点是否在多边形内部\r\nexport function pointInPolygon(pt: Point, pts: Point[]) {\r\n  let inside = false;\r\n  for (let i = 0, j = pts.length - 1; i < pts.length; j = i++) {\r\n    let xi = pts[i].x, yi = pts[i].y;\r\n    let xj = pts[j].x, yj = pts[j].y;\r\n      \r\n    let intersect = ((yi > pt.y) != (yj > pt.y))\r\n          && (pt.x < (xj - xi) * (pt.y - yi) / (yj - yi) + xi);\r\n    if (intersect) inside = !inside;\r\n  }\r\n  return inside;\r\n}","import { Rect } from '../../rect';\r\n\r\nexport interface SvgCommand {\r\n  key: string;\r\n  values: number[];\r\n  relative?: boolean;\r\n  worldPoints?: number[];\r\n}\r\n\r\nexport interface SvgPath {\r\n  commands: SvgCommand[];\r\n}\r\n\r\n// This logic is shamelessly borrowed from Yqnn/svg-path-editor\r\n// https://github.com/Yqnn/svg-path-editor\r\nconst commandRegex = /^[\\t\\n\\f\\r ]*([MLHVZCSQTAmlhvzcsqta])[\\t\\n\\f\\r ]*/;\r\nconst flagRegex = /^[01]/;\r\nconst numberRegex =\r\n  /^[+-]?(([0-9]*\\.[0-9]+)|([0-9]+\\.)|([0-9]+))([eE][+-]?[0-9]+)?/;\r\nconst commaWsp = /^(([\\t\\n\\f\\r ]+,?[\\t\\n\\f\\r ]*)|(,[\\t\\n\\f\\r ]*))/;\r\n\r\nconst grammar: { [key: string]: RegExp[] } = {\r\n  M: [numberRegex, numberRegex],\r\n  L: [numberRegex, numberRegex],\r\n  H: [numberRegex],\r\n  V: [numberRegex],\r\n  Z: [],\r\n  C: [\r\n    numberRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n  ],\r\n  S: [numberRegex, numberRegex, numberRegex, numberRegex],\r\n  Q: [numberRegex, numberRegex, numberRegex, numberRegex],\r\n  T: [numberRegex, numberRegex],\r\n  A: [\r\n    numberRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n    flagRegex,\r\n    flagRegex,\r\n    numberRegex,\r\n    numberRegex,\r\n  ],\r\n};\r\n\r\nexport function parseSvgPath(path: string): SvgPath {\r\n  let cursor = 0;\r\n  const commands: SvgCommand[] = [];\r\n  while (cursor < path.length) {\r\n    const match = path.slice(cursor).match(commandRegex);\r\n    if (match !== null) {\r\n      const command = match[1];\r\n      cursor += match[0].length;\r\n      const parser = parseCommands(command, path, cursor);\r\n      cursor = parser.cursor;\r\n      commands.push(...parser.commands);\r\n    } else {\r\n      throw new Error('malformed path (first error at ' + cursor + ')');\r\n    }\r\n  }\r\n  return { commands };\r\n}\r\n\r\nexport function getRect(path: SvgPath): Rect {\r\n  let x = Infinity;\r\n  let y = Infinity;\r\n  let ex = -Infinity;\r\n  let ey = -Infinity;\r\n\r\n  calcWorldPositions(path);\r\n\r\n  path.commands.forEach((item) => {\r\n    item.worldPoints.forEach((num: number, index: number) => {\r\n      if (index % 2 === 0) {\r\n        if (num < x) {\r\n          x = num;\r\n        }\r\n        if (num > ex) {\r\n          ex = num;\r\n        }\r\n      } else {\r\n        if (num < y) {\r\n          y = num;\r\n        }\r\n        if (num > ey) {\r\n          ey = num;\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  --x;\r\n  --y;\r\n  return {\r\n    x,\r\n    y,\r\n    ex,\r\n    ey,\r\n    width: ex - x + 1,\r\n    height: ey - y + 1,\r\n  };\r\n}\r\n\r\nexport function translatePath(path: SvgPath, x: number, y?: number) {\r\n  if (y == null) {\r\n    y = x;\r\n  }\r\n\r\n  path.commands.forEach((item, index) => {\r\n    if (item.relative && index) {\r\n      return;\r\n    }\r\n\r\n    switch (item.key) {\r\n      case 'A':\r\n      case 'a':\r\n        item.values[5] += x;\r\n        item.values[6] += y;\r\n        break;\r\n      case 'V':\r\n      case 'v':\r\n        item.values[0] += y;\r\n        break;\r\n      default:\r\n        item.values.forEach((val, i) => {\r\n          item.values[i] = val + (i % 2 === 0 ? x : y);\r\n        });\r\n        break;\r\n    }\r\n  });\r\n}\r\n\r\nexport function scalePath(path: SvgPath, x: number, y?: number) {\r\n  if (y == null) {\r\n    y = x;\r\n  }\r\n\r\n  path.commands.forEach((item) => {\r\n    switch (item.key) {\r\n      case 'A':\r\n      case 'a':\r\n        const a = item.values[0];\r\n        const b = item.values[1];\r\n        const angle = (Math.PI * item.values[2]) / 180;\r\n        const cos = Math.cos(angle);\r\n        const sin = Math.sin(angle);\r\n        const A = b * b * y * y * cos * cos + a * a * y * y * sin * sin;\r\n        const B = 2 * x * y * cos * sin * (b * b - a * a);\r\n        const C = a * a * x * x * cos * cos + b * b * x * x * sin * sin;\r\n        const F = -(a * a * b * b * x * x * y * y);\r\n        const det = B * B - 4 * A * C;\r\n        const val1 = Math.sqrt((A - C) * (A - C) + B * B);\r\n\r\n        // New rotation:\r\n        item.values[2] =\r\n          B !== 0\r\n            ? (Math.atan((C - A - val1) / B) * 180) / Math.PI\r\n            : A < C\r\n            ? 0\r\n            : 90;\r\n\r\n        // New radius-x, radius-y\r\n        item.values[0] = -Math.sqrt(2 * det * F * (A + C + val1)) / det;\r\n        item.values[1] = -Math.sqrt(2 * det * F * (A + C - val1)) / det;\r\n\r\n        // New target\r\n        item.values[5] *= x;\r\n        item.values[6] *= y;\r\n\r\n        // New sweep flag\r\n        item.values[4] = x * y >= 0 ? item.values[4] : 1 - item.values[4];\r\n        break;\r\n      case 'V':\r\n      case 'v':\r\n        item.values[0] *= y;\r\n        break;\r\n      default:\r\n        item.values.forEach((val, index) => {\r\n          item.values[index] = val * (index % 2 === 0 ? x : y);\r\n        });\r\n        break;\r\n    }\r\n  });\r\n}\r\n\r\nexport function pathToString(path: SvgPath): string {\r\n  let text = '';\r\n\r\n  path.commands.forEach((item) => {\r\n    text += item.key + ' ';\r\n    item.values.forEach((num) => {\r\n      text += num + ' ';\r\n    });\r\n  });\r\n  return text;\r\n}\r\n\r\nfunction parseCommands(\r\n  type: string,\r\n  path: string,\r\n  cursor: number\r\n): { cursor: number; commands: SvgCommand[] } {\r\n  const expectedRegexList = grammar[type.toUpperCase()];\r\n\r\n  const commands: SvgCommand[] = [];\r\n  while (cursor <= path.length) {\r\n    const command: SvgCommand = { key: type, values: [] };\r\n    for (const regex of expectedRegexList) {\r\n      const match = path.slice(cursor).match(regex);\r\n\r\n      if (match !== null) {\r\n        command.values.push(+match[0]);\r\n        cursor += match[0].length;\r\n        const ws = path.slice(cursor).match(commaWsp);\r\n        if (ws !== null) {\r\n          cursor += ws[0].length;\r\n        }\r\n      } else if (command.values.length === 0) {\r\n        return { cursor, commands };\r\n      } else {\r\n        throw new Error('malformed path (first error at ' + cursor + ')');\r\n      }\r\n    }\r\n    command.relative = command.key.toUpperCase() !== command.key;\r\n    commands.push(command);\r\n    if (expectedRegexList.length === 0) {\r\n      return { cursor, commands };\r\n    }\r\n    if (type === 'm') {\r\n      type = 'l';\r\n    }\r\n    if (type === 'M') {\r\n      type = 'L';\r\n    }\r\n  }\r\n  throw new Error('malformed path (first error at ' + cursor + ')');\r\n}\r\n\r\nfunction calcWorldPoints(command: SvgCommand, previous: SvgCommand) {\r\n  const worldPoints: number[] = [];\r\n  let current =\r\n    command.relative && previous\r\n      ? {\r\n          x: previous.worldPoints[previous.worldPoints.length - 2],\r\n          y: previous.worldPoints[previous.worldPoints.length - 1],\r\n        }\r\n      : { x: 0, y: 0 };\r\n  for (let i = 0; i < command.values.length - 1; i += 2) {\r\n    worldPoints.push(current.x + command.values[i]);\r\n    worldPoints.push(current.y + command.values[i + 1]);\r\n  }\r\n\r\n  command.worldPoints = worldPoints;\r\n}\r\n\r\nfunction calcWorldPositions(path: SvgPath) {\r\n  let previous: SvgCommand;\r\n  let x = 0;\r\n  let y = 0;\r\n  path.commands.forEach((item) => {\r\n    switch (item.key) {\r\n      case 'Z':\r\n      case 'z':\r\n        item.worldPoints = [x, y];\r\n        break;\r\n      case 'H':\r\n        item.worldPoints = [\r\n          item.values[0],\r\n          previous.worldPoints[previous.worldPoints.length - 1],\r\n        ];\r\n        break;\r\n      case 'h':\r\n        item.worldPoints = [\r\n          item.values[0] +\r\n            previous.worldPoints[previous.worldPoints.length - 2],\r\n          previous.worldPoints[previous.worldPoints.length - 1],\r\n        ];\r\n        break;\r\n      case 'V':\r\n        item.worldPoints = [\r\n          previous.worldPoints[previous.worldPoints.length - 2],\r\n          item.values[0],\r\n        ];\r\n        break;\r\n      case 'v':\r\n        item.worldPoints = [\r\n          previous.worldPoints[previous.worldPoints.length - 2],\r\n          item.values[0] +\r\n            previous.worldPoints[previous.worldPoints.length - 1],\r\n        ];\r\n        break;\r\n      case 'A':\r\n        item.worldPoints = [\r\n          previous.worldPoints[previous.worldPoints.length - 2],\r\n          item.values[0] +\r\n            previous.worldPoints[previous.worldPoints.length - 1],\r\n        ];\r\n        break;\r\n      default:\r\n        calcWorldPoints(item, previous);\r\n        break;\r\n    }\r\n\r\n    if (\r\n      item.key === 'M' ||\r\n      item.key === 'm' ||\r\n      item.key === 'Z' ||\r\n      item.key === 'z'\r\n    ) {\r\n      x = item.worldPoints[item.worldPoints.length - 2];\r\n      y = item.worldPoints[item.worldPoints.length - 1];\r\n    }\r\n    previous = item;\r\n  });\r\n}\r\n","import { Meta2dStore } from './../store/store';\r\nimport { Pen } from '../pen';\r\nimport { calcCenter } from '../rect';\r\nimport {\r\n  getRect,\r\n  parseSvgPath,\r\n  pathToString,\r\n  scalePath,\r\n  translatePath,\r\n} from './svg/parse';\r\n\r\nexport function svgPath(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const store: Meta2dStore = pen.calculative.canvas.store;\r\n  const pathText = store.data.paths[pen.pathId];\r\n  if (!pathText) {\r\n    return new Path2D();\r\n  }\r\n  const path = parseSvgPath(pathText);\r\n  pen.calculative.svgRect = getRect(path);\r\n  calcCenter(pen.calculative.svgRect);\r\n\r\n  if (\r\n    pen.calculative.svgRect.width !== pen.calculative.worldRect.width ||\r\n    pen.calculative.svgRect.height !== pen.calculative.worldRect.height\r\n  ) {\r\n    const scaleX = pen.calculative.worldRect.width / pen.calculative.svgRect.width;\r\n    const scaleY = pen.calculative.worldRect.height / pen.calculative.svgRect.height;\r\n    const scale = Math.max(scaleX, scaleY);\r\n    // scalePath(path, scale, scale);\r\n    scalePath(\r\n      path,\r\n      pen.calculative.worldRect.width / pen.calculative.svgRect.width,\r\n      pen.calculative.worldRect.height / pen.calculative.svgRect.height\r\n    );\r\n  }\r\n\r\n  const rect = getRect(path);\r\n  calcCenter(rect);\r\n  translatePath(\r\n    path,\r\n    pen.calculative.worldRect.x - rect.x,\r\n    pen.calculative.worldRect.y - rect.y\r\n  );\r\n\r\n  // console.log('svg path: ', pathText, path);\r\n  // ! 有 bug, 曲线转换后变形了\r\n  const pathStr = pathToString(path);\r\n  if (ctx) {\r\n    (ctx as any).svgPath?.(pathStr);\r\n    return;\r\n  }\r\n  // console.log('pathStr: ', pathStr);\r\n  const path2D = new Path2D(pathStr);\r\n  // TODO: 为何要闭合曲线\r\n  // path2D.closePath();\r\n\r\n  return path2D;\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function diamond(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.moveTo(x + width / 2, y);\r\n  path.lineTo(x + width, y + height / 2);\r\n  path.lineTo(x + width / 2, y + height);\r\n  path.lineTo(x, y + height / 2);\r\n  path.lineTo(x + width / 2, y);\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\n\r\nexport function triangle(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.moveTo(x + width / 2, y);\r\n  path.lineTo(x + width, y + height);\r\n  path.lineTo(x, y + height);\r\n  path.lineTo(x + width / 2, y);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function triangleAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.75,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.25,\r\n      y: 0.5,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\nexport function pentagon(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x + width / 2, y);\r\n  path.lineTo(x + width, y + (height * 2) / 5);\r\n  path.lineTo(x + (width * 4) / 5, y + height);\r\n  path.lineTo(x + width / 5, y + height);\r\n  path.lineTo(x, y + (height * 2) / 5);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function pentagonAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 0.4,\r\n    },\r\n    {\r\n      x: 0.8,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.2,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 0.4,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\n\r\nexport function pentagram(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  if (!pen.onResize) {\r\n    pen.onResize = resize;\r\n  }\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { width, height, center } = pen.calculative.worldRect;\r\n\r\n  const r = width > height ? height : width;\r\n  //旋转中心点\r\n  const centerx = center.x;\r\n  const centery = center.y;\r\n  const basey = centery - r / 2;\r\n  const baseyi = centery - r / 4;\r\n\r\n  const lx = -(baseyi - centery) * Math.sin((Math.PI / 180) * 324) + centerx;\r\n  const ly = (baseyi - centery) * Math.cos((Math.PI / 180) * 324) + centery;\r\n  path.moveTo(lx, ly);\r\n  for (let i = 0; i < 5; ++i) {\r\n    // TODO: Math.sin Math.cos 考虑优化下\r\n    path.lineTo(\r\n      -(basey - centery) * Math.sin((Math.PI / 180) * 72 * i) + centerx,\r\n      (basey - centery) * Math.cos((Math.PI / 180) * 72 * i) + centery\r\n    );\r\n    path.lineTo(\r\n      (lx - centerx) * Math.cos((Math.PI / 180) * 72 * (i + 1)) -\r\n        (ly - centery) * Math.sin((Math.PI / 180) * 72 * (i + 1)) +\r\n        centerx,\r\n      (lx - centerx) * Math.sin((Math.PI / 180) * 72 * (i + 1)) +\r\n        (ly - centery) * Math.cos((Math.PI / 180) * 72 * (i + 1)) +\r\n        centery\r\n    );\r\n  }\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function pentagramAnchors(pen: Pen) {\r\n  // TODO: 组合状态下的 width height 成了固定的百分比\r\n  const { width, height } = pen;\r\n  const r = width > height ? height : width;\r\n  const anchors: Point[] = [];\r\n\r\n  for (let i = 0; i < 5; ++i) {\r\n    anchors.push({\r\n      flag: 1, // 默认锚点\r\n      id: String(i),\r\n      penId: pen.id,\r\n      x: 0.5 + ((r / 2) * Math.sin((Math.PI / 180) * 72 * i)) / width,\r\n      y: ((-r / 2) * Math.cos((Math.PI / 180) * 72 * i)) / height + 0.5,\r\n    });\r\n  }\r\n  pen.anchors = anchors;\r\n}\r\n\r\nfunction resize(pen: Pen) {\r\n  // 过滤出非默认锚点，即自定义锚点\r\n  const manualPoints = pen.anchors.filter((point: Point) => point.flag !== 1);\r\n  pentagramAnchors(pen);\r\n  pen.anchors = pen.anchors.concat(...manualPoints);\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\n\r\nexport function hexagon(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.moveTo(x + width / 4, y);\r\n  path.lineTo(x + (width * 3) / 4, y);\r\n  path.lineTo(x + width, y + height / 2);\r\n  path.lineTo(x + (width * 3) / 4, y + height);\r\n  path.lineTo(x + (width * 1) / 4, y + height);\r\n  path.lineTo(x, y + height / 2);\r\n  path.lineTo(x + width / 4, y);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\n// export function hexagonAnchors(pen: Pen) {\r\n//   const anchors: Point[] = [];\r\n//   anchors.push({\r\n//     id: '0',\r\n//     penId: pen.id,\r\n//     x: 0.25,\r\n//     y: 0,\r\n//   });\r\n\r\n//   anchors.push({\r\n//     id: '1',\r\n//     penId: pen.id,\r\n//     x: 0.75,\r\n//     y: 0,\r\n//   });\r\n\r\n//   anchors.push({\r\n//     id: '2',\r\n//     penId: pen.id,\r\n//     x: 1,\r\n//     y: 0.5,\r\n//   });\r\n//   anchors.push({\r\n//     id: '3',\r\n//     penId: pen.id,\r\n//     x: 0.75,\r\n//     y: 1,\r\n//   });\r\n//   anchors.push({\r\n//     id: '4',\r\n//     penId: pen.id,\r\n//     x: 0.25,\r\n//     y: 1,\r\n//   });\r\n//   anchors.push({\r\n//     id: '5',\r\n//     penId: pen.id,\r\n//     x: 0,\r\n//     y: 0.5,\r\n//   });\r\n//   pen.anchors = anchors;\r\n// }\r\n","import { Pen } from '../pen';\r\n\r\nexport function leftArrow(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x, y + height / 2);\r\n  path.lineTo(x + height / 2, y);\r\n  path.lineTo(x + height / 2, y + height / 3);\r\n  path.lineTo(x + width, y + height / 3);\r\n  path.lineTo(x + width, y + (height * 2) / 3);\r\n  path.lineTo(x + height / 2, y + (height * 2) / 3);\r\n  path.lineTo(x + height / 2, y + (height * 2) / 3);\r\n  path.lineTo(x + height / 2, y + height);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function rightArrow(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.moveTo(x, y + height / 3);\r\n  path.lineTo(x + (width - height / 2), y + height / 3);\r\n  path.lineTo(x + (width - height / 2), y);\r\n  path.lineTo(x + width, y + height / 2);\r\n  path.lineTo(x + (width - height / 2), y + height);\r\n  path.lineTo(x + (width - height / 2), y + (height * 2) / 3);\r\n  path.lineTo(x, y + (height * 2) / 3);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function twowayArrow(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x, y + height / 2);\r\n  path.lineTo(x + height / 2, y);\r\n  path.lineTo(x + height / 2, y + height / 3);\r\n  path.lineTo(x + (width - height / 2), y + height / 3);\r\n  path.lineTo(x + (width - height / 2), y);\r\n  path.lineTo(x + width, y + height / 2);\r\n  path.lineTo(x + (width - height / 2), y + height);\r\n  path.lineTo(x + (width - height / 2), y + (height * 2) / 3);\r\n  path.lineTo(x + height / 2, y + (height * 2) / 3);\r\n  path.lineTo(x + height / 2, y + height);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function message(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ey } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x, y);\r\n  path.lineTo(x + width, y);\r\n  path.lineTo(x + width, y + (height * 3) / 4);\r\n  path.lineTo(x + (width * 8) / 16, y + (height * 3) / 4);\r\n  path.lineTo(x + width / 4, ey);\r\n  path.lineTo(x + (width * 5) / 16, y + (height * 3) / 4);\r\n  path.lineTo(x, y + (height * 3) / 4);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function cloud(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x + width / 5, y + (height * 13) / 16);\r\n  path.bezierCurveTo(\r\n    x - width / 15,\r\n    y + (height * 13) / 16,\r\n    x - width / 15,\r\n    y + (height * 7) / 16,\r\n    x + width / 5,\r\n    y + (height * 7) / 16\r\n  );\r\n  path.bezierCurveTo(\r\n    x + width / 5,\r\n    y,\r\n    x + (width * 4) / 5,\r\n    y,\r\n    x + (width * 4) / 5,\r\n    y + (height * 7) / 16\r\n  );\r\n  path.bezierCurveTo(\r\n    x + (width * 16) / 15,\r\n    y + (height * 7) / 16,\r\n    x + (width * 16) / 15,\r\n    y + (height * 13) / 16,\r\n    x + (width * 4) / 5,\r\n    y + (height * 13) / 16\r\n  );\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function file(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  const offsetX = width / 6;\r\n  path.moveTo(x, y);\r\n  path.lineTo(ex - offsetX, y);\r\n  path.lineTo(ex, y + offsetX);\r\n  path.lineTo(ex, ey);\r\n  path.lineTo(x, ey);\r\n  path.closePath();\r\n  path.moveTo(ex - offsetX, y);\r\n  path.lineTo(ex - offsetX, y + offsetX);\r\n  path.lineTo(ex, y + offsetX);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\n\r\nexport function cube(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  let offset = width * 0.25;\r\n\r\n  const z: number = (pen as any).z;\r\n  if (z > 1) {\r\n    offset = z;\r\n  } else if (z > 0) {\r\n    offset = width * z;\r\n  }\r\n\r\n  const p1 = {\r\n    x: x,\r\n    y: y + offset,\r\n  };\r\n  const p2 = {\r\n    x: ex - offset,\r\n    y: y + offset,\r\n  };\r\n  const p3 = {\r\n    x: ex - offset,\r\n    y: ey,\r\n  };\r\n  const p4 = {\r\n    x: x,\r\n    y: ey,\r\n  };\r\n\r\n  // front\r\n  face(\r\n    ctx,\r\n    [p1, p2, p3, p4],\r\n    (pen as any).backgroundFront || pen.background,\r\n    pen.color\r\n  );\r\n\r\n  // up\r\n  face(\r\n    ctx,\r\n    [\r\n      p1,\r\n      {\r\n        x: x + offset,\r\n        y: y,\r\n      },\r\n      { x: ex, y: y },\r\n      p2,\r\n    ],\r\n    (pen as any).backgroundUp || pen.background,\r\n    pen.color\r\n  );\r\n\r\n  // right\r\n  face(\r\n    ctx,\r\n    [\r\n      p2,\r\n      { x: ex, y: y },\r\n      {\r\n        x: ex,\r\n        y: ey - offset,\r\n      },\r\n      p3,\r\n    ],\r\n    (pen as any).backgroundRight || pen.background,\r\n    pen.color\r\n  );\r\n}\r\n\r\nfunction face(\r\n  ctx: CanvasRenderingContext2D,\r\n  points: Point[],\r\n  fillStyle = '',\r\n  strokeStyle = ''\r\n) {\r\n  ctx.save();\r\n  fillStyle && (ctx.fillStyle = fillStyle);\r\n  strokeStyle && (ctx.strokeStyle = strokeStyle);\r\n  ctx.beginPath();\r\n  for (let i = 0; i < points.length; ++i) {\r\n    if (i) {\r\n      ctx.lineTo(points[i].x, points[i].y);\r\n    } else {\r\n      ctx.moveTo(points[i].x, points[i].y);\r\n    }\r\n  }\r\n  ctx.closePath();\r\n  fillStyle && ctx.fill();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function people(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  const r = width / 4;\r\n  const middle = x + width / 2;\r\n  path.arc(middle, y + r, r, 0, Math.PI * 2);\r\n\r\n  path.moveTo(x, y + r * 3);\r\n  path.lineTo(ex, y + r * 3);\r\n\r\n  path.moveTo(middle, y + r * 2);\r\n  path.lineTo(middle, y + r * 4);\r\n\r\n  path.moveTo(middle, y + r * 4);\r\n  path.lineTo(x, ey);\r\n\r\n  path.moveTo(middle, y + r * 4);\r\n  path.lineTo(ex, ey);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Direction } from '../../data';\r\nimport { facePen, getToAnchor, Pen } from '../../pen';\r\nimport { distance, Point, PrevNextType, rotatePoint } from '../../point';\r\nimport { Meta2dStore } from '../../store';\r\nimport { s8 } from '../../utils';\r\n\r\nexport function curve(store: Meta2dStore, pen: Pen, mousedwon?: Point) {\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n\r\n  if (mousedwon) {\r\n    if (pen.calculative.activeAnchor) {\r\n      pen.calculative.activeAnchor.next = {\r\n        penId: pen.id,\r\n        x: mousedwon.x,\r\n        y: mousedwon.y,\r\n      };\r\n      if (\r\n        distance(\r\n          pen.calculative.activeAnchor.next,\r\n          pen.calculative.activeAnchor\r\n        ) < 5\r\n      ) {\r\n        pen.calculative.activeAnchor.next = undefined;\r\n      } else {\r\n        pen.calculative.activeAnchor.prev = {\r\n          ...pen.calculative.activeAnchor.next,\r\n        };\r\n        rotatePoint(\r\n          pen.calculative.activeAnchor.prev,\r\n          180,\r\n          pen.calculative.activeAnchor\r\n        );\r\n      }\r\n    }\r\n  } else {\r\n    const from = pen.calculative.worldAnchors[0];\r\n    if (!from.next) {\r\n      const fromFace = facePen(from, store.pens[from.connectTo]);\r\n      calcCurveCP(from, fromFace, 50);\r\n      from.prev = undefined;\r\n    }\r\n\r\n    const to =\r\n      pen.calculative.worldAnchors[pen.calculative.worldAnchors.length - 1];\r\n    if (to && to !== from && !to.prev) {\r\n      const toFace = facePen(to, store.pens[to.connectTo]);\r\n      calcCurveCP(to, toFace, -50);\r\n      to.next = undefined;\r\n    }\r\n  }\r\n}\r\n\r\nfunction calcCurveCP(pt: Point, d: Direction, dis: number) {\r\n  switch (d) {\r\n    case Direction.Up:\r\n      pt.prev = {\r\n        penId: pt.penId,\r\n        x: pt.x,\r\n        y: pt.y + dis,\r\n      };\r\n      pt.next = {\r\n        penId: pt.penId,\r\n        x: pt.x,\r\n        y: pt.y - dis,\r\n      };\r\n      break;\r\n    case Direction.Right:\r\n      pt.prev = {\r\n        penId: pt.penId,\r\n        x: pt.x - dis,\r\n        y: pt.y,\r\n      };\r\n      pt.next = {\r\n        penId: pt.penId,\r\n        x: pt.x + dis,\r\n        y: pt.y,\r\n      };\r\n      break;\r\n    case Direction.Bottom:\r\n      pt.prev = {\r\n        penId: pt.penId,\r\n        x: pt.x,\r\n        y: pt.y - dis,\r\n      };\r\n      pt.next = {\r\n        penId: pt.penId,\r\n        x: pt.x,\r\n        y: pt.y + dis,\r\n      };\r\n      break;\r\n    case Direction.Left:\r\n      pt.prev = {\r\n        penId: pt.penId,\r\n        x: pt.x + dis,\r\n        y: pt.y,\r\n      };\r\n      pt.next = {\r\n        penId: pt.penId,\r\n        x: pt.x - dis,\r\n        y: pt.y,\r\n      };\r\n      break;\r\n  }\r\n}\r\n\r\n// Get a point in quadratic.\r\n// pos - The position of point in quadratic. It is expressed as a percentage(0 - 1).\r\nexport function getQuadraticPoint(\r\n  step: number,\r\n  from: Point,\r\n  cp: Point,\r\n  to: Point\r\n) {\r\n  const pos = 1 - step;\r\n  const x = pos * pos * from.x + 2 * pos * step * cp.x + step * step * to.x;\r\n  const y = pos * pos * from.y + 2 * pos * step * cp.y + step * step * to.y;\r\n  return { x, y, step };\r\n}\r\n\r\n// Get a point in bezier.\r\n// pos - The position of point in bezier. It is expressed as a percentage(0 - 1).\r\nexport function getBezierPoint(\r\n  step: number,\r\n  from: Point,\r\n  cp1: Point,\r\n  cp2: Point,\r\n  to: Point\r\n) {\r\n  const { x: x1, y: y1 } = from;\r\n  const { x: x2, y: y2 } = to;\r\n  const { x: cx1, y: cy1 } = cp1;\r\n  const { x: cx2, y: cy2 } = cp2;\r\n\r\n  const pos = 1 - step;\r\n  const x =\r\n    x1 * pos * pos * pos +\r\n    3 * cx1 * step * pos * pos +\r\n    3 * cx2 * step * step * pos +\r\n    x2 * step * step * step;\r\n  const y =\r\n    y1 * pos * pos * pos +\r\n    3 * cy1 * step * pos * pos +\r\n    3 * cy2 * step * step * pos +\r\n    y2 * step * step * step;\r\n  return { x, y, step };\r\n}\r\n\r\nfunction lerp(pt1: Point, pt2: Point, t: number) {\r\n  return {\r\n    x: pt1.x + t * (pt2.x - pt1.x),\r\n    y: pt1.y + t * (pt2.y - pt1.y),\r\n  };\r\n}\r\n\r\nexport function getSplitAnchor(pen: Pen, pt: Point, index: number) {\r\n  let from = pen.calculative.worldAnchors[index];\r\n  let to = pen.calculative.worldAnchors[index + 1];\r\n  if(!to && pen.close){\r\n    to = pen.calculative.worldAnchors[0];\r\n  }\r\n  const t = pt.step;\r\n  let anchor: Point;\r\n  if (from.next && to.prev) {\r\n    const p0 = from;\r\n    const p1 = from.next;\r\n    const p2 = to.prev;\r\n    const p3 = to;\r\n    const p4 = lerp(p0, p1, t);\r\n    const p5 = lerp(p1, p2, t);\r\n    const p6 = lerp(p2, p3, t);\r\n    const p7: Point = lerp(p4, p5, t);\r\n    const p8: Point = lerp(p5, p6, t);\r\n    anchor = lerp(p7, p8, t);\r\n    p7.penId = pen.id;\r\n    anchor.prev = p7;\r\n    p8.penId = pen.id;\r\n    anchor.next = p8;\r\n    from.next.x = p4.x;\r\n    from.next.y = p4.y;\r\n    to.prev.x = p6.x;\r\n    to.prev.y = p6.y;\r\n  } else if (from.next || to.prev) {\r\n    const p0 = from;\r\n    const p1 = from.next || to.prev;\r\n    const p2 = to;\r\n    const p3: Point = lerp(p0, p1, t);\r\n    const p4: Point = lerp(p1, p2, t);\r\n    anchor = pt;\r\n    p3.penId = pen.id;\r\n    p4.penId = pen.id;\r\n    anchor.prev = p3;\r\n    anchor.next = p4;\r\n    from.next = undefined;\r\n    to.prev = undefined;\r\n  } else {\r\n    // 并非贝塞尔点，即 from 和 to 之间是一条直线\r\n    anchor = pt;\r\n  }\r\n\r\n  anchor.penId = pen.id;\r\n  anchor.id = s8();\r\n  anchor.prevNextType = PrevNextType.Bilateral;\r\n  return anchor;\r\n}\r\n\r\nexport function mind(store: Meta2dStore, pen: Pen, mousedwon?: Point) {\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n\r\n  if (pen.calculative.worldAnchors.length < 2) {\r\n    return;\r\n  }\r\n\r\n  let from = pen.calculative.activeAnchor;\r\n  let to = mousedwon || getToAnchor(pen);\r\n  if (!from || !to) {\r\n    return;\r\n  }\r\n\r\n  const dis = 20;\r\n\r\n  const fromPen = store.pens[from.connectTo];\r\n  let fromFace = facePen(from, fromPen);\r\n  if (fromFace === Direction.None) {\r\n    if (to.x > from.x) {\r\n      fromFace = Direction.Right;\r\n    } else {\r\n      fromFace = Direction.Left;\r\n    }\r\n  }\r\n  from.next = {\r\n    id: s8(),\r\n    penId: pen.id,\r\n    x: from.x,\r\n    y: from.y,\r\n    prevNextType: 2,\r\n  };\r\n  to.prev = { id: s8(), penId: pen.id, x: to.x, y: to.y, prevNextType: 2 };\r\n  switch (fromFace) {\r\n    case Direction.Up:\r\n      from.next.y -= dis;\r\n      to.prev.y = from.y;\r\n      break;\r\n    case Direction.Bottom:\r\n      from.next.y += dis;\r\n      to.prev.y = from.y;\r\n      break;\r\n    case Direction.Left:\r\n      from.next.x -= dis;\r\n      to.prev.x = from.x;\r\n      break;\r\n    default:\r\n      from.next.x += dis;\r\n      to.prev.x = from.x;\r\n      break;\r\n  }\r\n}\r\n","import { deleteTempAnchor, getFromAnchor, getGradientAnimatePath, getToAnchor, Pen } from '../../pen';\r\nimport { hitPoint, Point } from '../../point';\r\nimport { getRectOfPoints, pointInSimpleRect, Rect } from '../../rect';\r\nimport { Meta2dStore } from '../../store';\r\nimport { getBezierPoint, getQuadraticPoint } from './curve';\r\n\r\nexport function line(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D | Path2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  if (pen.lineName === 'line' || pen.lineName === 'polyline') {\r\n    if (pen.calculative.lineSmooth) {\r\n      let _path = getGradientAnimatePath(pen);\r\n      (path as Path2D).addPath(_path);\r\n      if (path instanceof Path2D) return path;\r\n    }\r\n  }\r\n  const worldAnchors = pen.calculative.worldAnchors;\r\n  if (worldAnchors.length > 1) {\r\n    let from: Point; // 上一个点\r\n    worldAnchors.forEach((pt: Point) => {\r\n      if (from) {\r\n        draw(path, from, pt);\r\n      } else {\r\n        pt.start = true;\r\n      }\r\n      from = pt;\r\n    });\r\n    if (pen.close) {\r\n      if(pen.lineName === 'curve') {  \r\n        draw(path, from, worldAnchors[0]);\r\n      } else {\r\n        path.closePath();\r\n      }\r\n    }\r\n  }\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function lineSegment(store: Meta2dStore, pen: Pen, mousedwon?: Point) {\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n\r\n  if (pen.calculative.worldAnchors.length < 2 || pen.anchors?.length > 1) {\r\n    return;\r\n  }\r\n\r\n  const from = getFromAnchor(pen);\r\n  const to = getToAnchor(pen);\r\n  if (!from || !to || !to.id || from === to) {\r\n    return;\r\n  }\r\n  from.next = undefined;\r\n  deleteTempAnchor(pen);\r\n  to.prev = undefined;\r\n  pen.calculative.worldAnchors.push(to);\r\n}\r\n\r\nfunction draw(path: CanvasRenderingContext2D | Path2D, from: Point, to: Point) {\r\n  if (!to || to.isTemp) {\r\n    return;\r\n  }\r\n  from.start && path.moveTo(from.x, from.y);\r\n  if (from.next) {\r\n    if (to.prev) {\r\n      path.bezierCurveTo(\r\n        from.next.x,\r\n        from.next.y,\r\n        to.prev.x,\r\n        to.prev.y,\r\n        to.x,\r\n        to.y\r\n      );\r\n    } else {\r\n      path.quadraticCurveTo(from.next.x, from.next.y, to.x, to.y);\r\n    }\r\n  } else {\r\n    if (to.prev) {\r\n      path.quadraticCurveTo(to.prev.x, to.prev.y, to.x, to.y);\r\n    } else {\r\n      path.lineTo(to.x, to.y);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getLineRect(pen: Pen) {\r\n  getLineLength(pen);\r\n  return getRectOfPoints(getLinePoints(pen));\r\n}\r\n\r\n/**\r\n * 获取连线的 points ，并非 worldAnchors ，worldAnchors 之前的路径点也会记录\r\n */\r\nexport function getLinePoints(pen: Pen) {\r\n  const pts: Point[] = [];\r\n  let from: Point; // 上一个点\r\n  pen.calculative.worldAnchors.forEach((pt: Point) => {\r\n    pts.push(pt);\r\n    from && pts.push(...getPoints(from, pt, pen));\r\n    from = pt;\r\n  });\r\n  if (pen.close && pen.calculative.worldAnchors.length > 1) {\r\n    pts.push(...getPoints(from, pen.calculative.worldAnchors[0], pen));\r\n  }\r\n  return pts;\r\n}\r\n\r\nexport function getLineR(pen: Pen) {\r\n  return pen?.lineWidth ? pen.lineWidth / 2 + 4 : 4;\r\n}\r\n\r\nexport function getPoints(from: Point, to: Point, pen?: Pen) {\r\n  const pts: Point[] = [];\r\n  if (!to) {\r\n    return pts;\r\n  }\r\n\r\n  let step = 0.02;\r\n  if (from.lineLength) {\r\n    const r = getLineR(pen);\r\n    step = r / from.lineLength;\r\n  }\r\n  if (from.next) {\r\n    if (to.prev) {\r\n      for (let i = step; i < 1; i += step) {\r\n        pts.push(getBezierPoint(i, from, from.next, to.prev, to));\r\n      }\r\n    } else {\r\n      for (let i = step; i < 1; i += step) {\r\n        pts.push(getQuadraticPoint(i, from, from.next, to));\r\n      }\r\n    }\r\n  } else {\r\n    if (to.prev) {\r\n      for (let i = step; i < 1; i += step) {\r\n        pts.push(getQuadraticPoint(i, from, to.prev, to));\r\n      }\r\n    } else {\r\n      pts.push({ x: to.x, y: to.y });\r\n    }\r\n  }\r\n  if (pts.length > 1) {\r\n    from.curvePoints = pts;\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nexport function pointInLine(pt: Point, pen: Pen) {\r\n  const r = getLineR(pen);\r\n\r\n  let i = 0;\r\n  let from: Point; // 上一个点\r\n  let point: Point;\r\n  for (const anchor of pen.calculative.worldAnchors) {\r\n    if (from) {\r\n      point = pointInLineSegment(pt, from, anchor, r);\r\n      if (point) {\r\n        return {\r\n          i,\r\n          point,\r\n        };\r\n      }\r\n      ++i;\r\n    }\r\n    from = anchor;\r\n  }\r\n  if (\r\n    pen.close &&\r\n    pen.calculative.worldAnchors.length > 1 &&\r\n    (point = pointInLineSegment(pt, from, pen.calculative.worldAnchors[0], r))\r\n  ) {\r\n    return {\r\n      i,\r\n      point,\r\n    };\r\n  }\r\n}\r\nexport function pointInLineSegment(pt: Point, pt1: Point, pt2: Point, r = 4) {\r\n  if (!pt1.next && !pt2.prev) {\r\n    const { x: x1, y: y1 } = pt1;\r\n    const { x: x2, y: y2 } = pt2;\r\n    const minX = Math.min(x1, x2);\r\n    const maxX = Math.max(x1, x2);\r\n    const minY = Math.min(y1, y2);\r\n    const maxY = Math.max(y1, y2);\r\n    if (\r\n      !(\r\n        pt.x >= minX - r &&\r\n        pt.x <= maxX + r &&\r\n        pt.y >= minY - r &&\r\n        pt.y <= maxY + r\r\n      )\r\n    ) {\r\n      return;\r\n    }\r\n    return pointToLine(pt, pt1, pt2, r);\r\n  } else if (pt1.curvePoints) {\r\n    for (const point of pt1.curvePoints) {\r\n      if (hitPoint(pt, point, r)) {\r\n        return point;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function pointToLine(pt: Point, pt1: Point, pt2: Point, r = 4) {\r\n  // 竖线\r\n  if (pt1.x === pt2.x) {\r\n    const len = Math.abs(pt.x - pt1.x);\r\n    if (len <= r) {\r\n      return {\r\n        x: pt1.x,\r\n        y: pt.y,\r\n      };\r\n    }\r\n  } else {\r\n    const A = (pt1.y - pt2.y) / (pt1.x - pt2.x);\r\n    const B = pt1.y - A * pt1.x;\r\n    const len = Math.abs((A * pt.x + B - pt.y) / Math.sqrt(A * A + 1));\r\n    if (len <= r) {\r\n      const m = pt.x + A * pt.y;\r\n      const x = (m - A * B) / (A * A + 1);\r\n      return {\r\n        x,\r\n        y: A * x + B,\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nfunction lineLen(from: Point, cp1?: Point, cp2?: Point, to?: Point): number {\r\n  if (!cp1 && !cp2) {\r\n    return (\r\n      Math.sqrt(\r\n        Math.pow(Math.abs(from.x - to.x), 2) +\r\n          Math.pow(Math.abs(from.y - to.y), 2)\r\n      ) || 0\r\n    );\r\n  }\r\n\r\n  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n  if (cp1 && cp2) {\r\n    path.setAttribute(\r\n      'd',\r\n      `M${from.x} ${from.y} C${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${to.x} ${to.y}`\r\n    );\r\n  } else if (cp1) {\r\n    path.setAttribute(\r\n      'd',\r\n      `M${from.x} ${from.y} Q${cp1.x} ${cp1.y} ${to.x} ${to.y}`\r\n    );\r\n  } else {\r\n    path.setAttribute(\r\n      'd',\r\n      `M${from.x} ${from.y} Q${cp2.x} ${cp2.y} ${to.x} ${to.y}`\r\n    );\r\n  }\r\n  return path.getTotalLength() || 0;\r\n}\r\n\r\nexport function getLineLength(pen: Pen): number {\r\n  if (pen.calculative.worldAnchors.length < 2) {\r\n    return 0;\r\n  }\r\n\r\n  let len = 0;\r\n  let from: Point; // 上一个点\r\n  pen.calculative.worldAnchors.forEach((pt: Point) => {\r\n    if (from) {\r\n      from.lineLength = lineLen(from, from.next, pt.prev, pt);\r\n      len += from.lineLength;\r\n    }\r\n    from = pt;\r\n  });\r\n  if (pen.close) {\r\n    // pen.close ，下一个点即第一个点\r\n    const to = getFromAnchor(pen);\r\n    from.lineLength = lineLen(from, from.next, to.prev, to);\r\n    len += from.lineLength;\r\n  }\r\n  if (pen.calculative.animatePos) {\r\n    pen.calculative.animatePos =\r\n      (len / pen.length) * pen.calculative.animatePos;\r\n  }\r\n  pen.length = len;\r\n  return len;\r\n}\r\n\r\n/**\r\n * 连线在 rect 内， 连线与 rect 相交\r\n */\r\nexport function lineInRect(line: Pen, rect: Rect) {\r\n  // 判断是直线还是贝塞尔\r\n  const worldAnchors = line.calculative.worldAnchors;\r\n  for (let index = 0; index < worldAnchors.length - 1; index++) {\r\n    const current = worldAnchors[index];\r\n    const next = worldAnchors[index + 1];\r\n    if (!current.next && !next.prev) {\r\n      // 线段\r\n      if (isLineIntersectRectangle(current, next, rect)) {\r\n        return true;\r\n      }\r\n    } else {\r\n      // 贝塞尔\r\n      if (isBezierIntersectRectangle(current, next, rect)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * 线段与矩形是否相交\r\n * @param rect 矩形\r\n */\r\nexport function isLineIntersectRectangle(pt1: Point, pt2: Point, rect: Rect) {\r\n  if (pointInSimpleRect(pt1, rect) || pointInSimpleRect(pt2, rect)) {\r\n    // 存在一个点在矩形内部\r\n    return true;\r\n  }\r\n  const linePointX1 = pt1.x;\r\n  const linePointY1 = pt1.y;\r\n  const linePointX2 = pt2.x;\r\n  const linePointY2 = pt2.y;\r\n\r\n  let rectangleLeftTopX = rect.x;\r\n  let rectangleLeftTopY = rect.y;\r\n  let rectangleRightBottomX = rect.ex;\r\n  let rectangleRightBottomY = rect.ey;\r\n\r\n  const lineHeight = linePointY1 - linePointY2;\r\n  const lineWidth = linePointX2 - linePointX1; // 计算叉乘\r\n  const c = linePointX1 * linePointY2 - linePointX2 * linePointY1;\r\n  if (\r\n    (lineHeight * rectangleLeftTopX + lineWidth * rectangleLeftTopY + c >= 0 &&\r\n      lineHeight * rectangleRightBottomX +\r\n        lineWidth * rectangleRightBottomY +\r\n        c <=\r\n        0) ||\r\n    (lineHeight * rectangleLeftTopX + lineWidth * rectangleLeftTopY + c <= 0 &&\r\n      lineHeight * rectangleRightBottomX +\r\n        lineWidth * rectangleRightBottomY +\r\n        c >=\r\n        0) ||\r\n    (lineHeight * rectangleLeftTopX + lineWidth * rectangleRightBottomY + c >=\r\n      0 &&\r\n      lineHeight * rectangleRightBottomX + lineWidth * rectangleLeftTopY + c <=\r\n        0) ||\r\n    (lineHeight * rectangleLeftTopX + lineWidth * rectangleRightBottomY + c <=\r\n      0 &&\r\n      lineHeight * rectangleRightBottomX + lineWidth * rectangleLeftTopY + c >=\r\n        0)\r\n  ) {\r\n    if (rectangleLeftTopX > rectangleRightBottomX) {\r\n      const temp = rectangleLeftTopX;\r\n      rectangleLeftTopX = rectangleRightBottomX;\r\n      rectangleRightBottomX = temp;\r\n    }\r\n    if (rectangleLeftTopY < rectangleRightBottomY) {\r\n      const temp1 = rectangleLeftTopY;\r\n      rectangleLeftTopY = rectangleRightBottomY;\r\n      rectangleRightBottomY = temp1;\r\n    }\r\n    if (\r\n      (linePointX1 < rectangleLeftTopX && linePointX2 < rectangleLeftTopX) ||\r\n      (linePointX1 > rectangleRightBottomX &&\r\n        linePointX2 > rectangleRightBottomX) ||\r\n      (linePointY1 > rectangleLeftTopY && linePointY2 > rectangleLeftTopY) ||\r\n      (linePointY1 < rectangleRightBottomY &&\r\n        linePointY2 < rectangleRightBottomY)\r\n    ) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * 贝塞尔曲线与矩形是否相交\r\n * @param from 前点\r\n * @param to 后点\r\n * @param rect 矩形\r\n */\r\nexport function isBezierIntersectRectangle(from: Point, to: Point, rect: Rect) {\r\n  const step = 0.02;\r\n  if (!from.next && !to.prev) {\r\n    // 直线\r\n    return isLineIntersectRectangle(from, to, rect);\r\n  } else if (from.next && to.prev) {\r\n    for (let i = step; i < 1; i += step) {\r\n      const point = getBezierPoint(i, from, from.next, to.prev, to);\r\n      if (pointInSimpleRect(point, rect)) {\r\n        return true;\r\n      }\r\n    }\r\n  } else if (from.next || to.prev) {\r\n    for (let i = step; i < 1; i += step) {\r\n      const point = getQuadraticPoint(i, from, from.next || to.prev, to);\r\n      if (pointInSimpleRect(point, rect)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","import { Direction } from '../../data';\r\nimport {\r\n  deleteTempAnchor,\r\n  facePen,\r\n  getFromAnchor,\r\n  getToAnchor,\r\n  Pen,\r\n} from '../../pen';\r\nimport { Point } from '../../point';\r\nimport { Meta2dStore } from '../../store';\r\nimport { s8 } from '../../utils';\r\n\r\nlet faceSpace = 10;\r\nexport function polyline(store: Meta2dStore, pen: Pen, mousedwon?: Point) {\r\n  if (!pen.calculative.worldAnchors) {\r\n    pen.calculative.worldAnchors = [];\r\n  }\r\n  faceSpace = store.options.polylineSpace || 10;\r\n  if (pen.calculative.worldAnchors.length < 2) {\r\n    return;\r\n  }\r\n\r\n  let from = getFromAnchor(pen);\r\n  let to = getToAnchor(pen);\r\n\r\n  if (!from || !to) {\r\n    return;\r\n  }\r\n\r\n  // 拖拽起点\r\n  let dragFrom: boolean;\r\n  if (pen.anchors?.length && from === pen.calculative.activeAnchor) {\r\n    dragFrom = true;\r\n    from = to;\r\n    to = getFromAnchor(pen);\r\n  } else if (\r\n    (!pen.anchors || !pen.anchors.length) &&\r\n    from !== pen.calculative.activeAnchor\r\n  ) {\r\n    from = pen.calculative.activeAnchor;\r\n  }\r\n  if (!from || !to) {\r\n    return;\r\n  }\r\n  from.next = undefined;\r\n  to.prev = undefined;\r\n  const connected = to.connectTo;\r\n  deleteTempAnchor(pen);\r\n\r\n  const pts: Point[] = [];\r\n\r\n  const fromPen = store.pens[from.connectTo];\r\n  const toPen = store.pens[to.connectTo];\r\n\r\n  const fromFace = facePen(from, fromPen);\r\n  const toFace = facePen(to, toPen);\r\n\r\n  let a = getFacePoint(from, fromFace, faceSpace);\r\n  if (a) {\r\n    from = a;\r\n    pts.push(a);\r\n  }\r\n  a = getFacePoint(to, toFace, faceSpace);\r\n  const end = to;\r\n  let corner = undefined;\r\n  if (a) {\r\n    to = a;\r\n    if (end.connectTo) {\r\n      if ((a.y > end.y && from.y < end.y) || (a.y < end.y && from.y > end.y)) {\r\n        //拐角 防止连线覆盖\r\n        corner = a;\r\n        let _faceSpace = faceSpace;\r\n        if (from.x < a.x) {\r\n          _faceSpace = -_faceSpace;\r\n        }\r\n        if (Math.abs(from.x - a.x) < _faceSpace) {\r\n          _faceSpace = -_faceSpace;\r\n        }\r\n        const point = { x: a.x + _faceSpace, y: a.y, id: s8() };\r\n        to = point;\r\n      }\r\n    }\r\n  }\r\n\r\n  switch (fromFace) {\r\n    case Direction.Up:\r\n      pts.push(...getNextPointsOfUp(from, to, toFace));\r\n      break;\r\n    case Direction.Right:\r\n      pts.push(...getNextPointsOfRight(from, to, toFace));\r\n      break;\r\n    case Direction.Bottom:\r\n      pts.push(...getNextPointsOfBottom(from, to, toFace));\r\n      break;\r\n    case Direction.Left:\r\n      pts.push(...getNextPointsOfLeft(from, to, toFace));\r\n      break;\r\n    default:\r\n      pts.push(...getNextPoints(pen, from, to));\r\n      break;\r\n  }\r\n\r\n  pts.forEach((anchor: Point) => {\r\n    anchor.id = s8();\r\n    anchor.penId = pen.id;\r\n    pen.calculative.worldAnchors.push(anchor);\r\n  });\r\n\r\n  pen.calculative.worldAnchors.push(to);\r\n  if (corner) {\r\n    pen.calculative.worldAnchors.push(corner);\r\n  }\r\n  if (a) {\r\n    pen.calculative.worldAnchors.push(end);\r\n  }\r\n\r\n  if (dragFrom) {\r\n    pen.calculative.worldAnchors.reverse();\r\n  }\r\n\r\n  if (connected) {\r\n    const i = pen.calculative.worldAnchors.length - 2;\r\n    pen.calculative.worldAnchors[i].isTemp = false;\r\n    pen.calculative.worldAnchors[1].isTemp = false;\r\n  }\r\n}\r\n\r\nfunction getFacePoint(pt: Point, d: Direction, dis: number) {\r\n  const point = { x: pt.x, y: pt.y, id: s8() };\r\n  switch (d) {\r\n    case Direction.Up:\r\n      point.y -= dis;\r\n      break;\r\n    case Direction.Right:\r\n      point.x += dis;\r\n      break;\r\n    case Direction.Bottom:\r\n      point.y += dis;\r\n      break;\r\n    case Direction.Left:\r\n      point.x -= dis;\r\n      break;\r\n    default: {\r\n      return;\r\n    }\r\n  }\r\n  return point;\r\n}\r\n\r\nfunction getNextPointsOfUp(from: Point, to: Point, toFace: Direction) {\r\n  if (from.x === to.x || from.y === to.y) {\r\n    return [];\r\n  }\r\n\r\n  const pts: Point[] = [];\r\n  let x: number;\r\n  let y: number;\r\n  switch (toFace) {\r\n    case Direction.Up:\r\n      if (from.y < to.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      } else {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Bottom:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.y > from.y) {\r\n        x = from.x + (to.x - from.x) / 2;\r\n        pts.push({ x, y: from.y }, { x, y: to.y });\r\n      } else {\r\n        const centerY = (from.y + to.y) / 2;\r\n        pts.push({ x: from.x, y: centerY }, { x: to.x, y: centerY });\r\n      }\r\n\r\n      break;\r\n    case Direction.Right:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.x < from.x && to.y < from.y) {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Left:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.x > from.x && to.y < from.y) {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    default:\r\n      if (to.y > from.y - faceSpace) {\r\n        x = from.x + (to.x - from.x) / 2;\r\n        pts.push({ x, y: from.y }, { x, y: to.y });\r\n      } else {\r\n        const centerY = (from.y + to.y + faceSpace) / 2;\r\n        pts.push({ x: from.x, y: centerY }, { x: to.x, y: centerY });\r\n      }\r\n      break;\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nfunction getNextPointsOfRight(from: Point, to: Point, toFace: Direction) {\r\n  if (from.x === to.x || from.y === to.y) {\r\n    return [];\r\n  }\r\n\r\n  const pts: Point[] = [];\r\n  let x: number;\r\n  let y: number;\r\n  switch (toFace) {\r\n    case Direction.Up:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x > from.x && to.y > from.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Bottom:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x > from.x && to.y < from.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Left:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.x < from.x) {\r\n        y = from.y + (to.y - from.y) / 2;\r\n        pts.push({ x: from.x, y }, { x: to.x, y });\r\n      } else {\r\n        const centerX = (from.x + to.x) / 2;\r\n        pts.push({ x: centerX, y }, { x: centerX, y: to.y });\r\n      }\r\n      break;\r\n    case Direction.Right:\r\n      if (to.x < from.x) {\r\n        pts.push({ x: from.x, y: to.y });\r\n      } else {\r\n        pts.push({ x: to.x, y: from.y });\r\n      }\r\n      break;\r\n    default:\r\n      x = to.x;\r\n      y = to.y;\r\n      if (to.x < from.x + faceSpace) {\r\n        pts.push({ x: from.x, y });\r\n      } else {\r\n        const centerX = (from.x + to.x - faceSpace) / 2;\r\n        pts.push({ x: centerX, y: from.y }, { x: centerX, y });\r\n      }\r\n      break;\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nfunction getNextPointsOfBottom(from: Point, to: Point, toFace: Direction) {\r\n  if (from.x === to.x || from.y === to.y) {\r\n    return [];\r\n  }\r\n\r\n  const pts: Point[] = [];\r\n  let x: number;\r\n  let y: number;\r\n  switch (toFace) {\r\n    case Direction.Up:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.y < from.y) {\r\n        x = from.x + (to.x - from.x) / 2;\r\n        pts.push({ x, y: from.y }, { x, y: to.y });\r\n      } else {\r\n        const centerY = (from.y + to.y) / 2;\r\n        pts.push({ x, y: centerY }, { x: to.x, y: centerY });\r\n      }\r\n      break;\r\n    case Direction.Right:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.x < from.x && to.y > from.y) {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Bottom:\r\n      if (from.y > to.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      } else {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n\r\n      break;\r\n    case Direction.Left:\r\n      x = to.x;\r\n      y = from.y;\r\n      if (to.x > from.x && to.y > from.y) {\r\n        x = from.x;\r\n        y = to.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    default:\r\n      x = from.x;\r\n      if (to.y < from.y + faceSpace) {\r\n        x = from.x + (to.x - from.x) / 2;\r\n        pts.push({ x, y: from.y }, { x, y: to.y });\r\n      } else {\r\n        const centerY = (from.y + to.y - faceSpace) / 2;\r\n        pts.push({ x, y: centerY }, { x: to.x, y: centerY });\r\n      }\r\n      break;\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nfunction getNextPointsOfLeft(from: Point, to: Point, toFace: Direction) {\r\n  if (from.x === to.x || from.y === to.y) {\r\n    return [];\r\n  }\r\n\r\n  const pts: Point[] = [];\r\n  let x: number;\r\n  let y: number;\r\n  switch (toFace) {\r\n    case Direction.Up:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x < from.x && to.y > from.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Bottom:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x < from.x && to.y < from.y) {\r\n        x = to.x;\r\n        y = from.y;\r\n      }\r\n      pts.push({ x, y });\r\n      break;\r\n    case Direction.Right:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x > from.x) {\r\n        x = to.x;\r\n        y = from.y + (to.y - from.y) / 2;\r\n        pts.push({ x: from.x, y }, { x: to.x, y });\r\n      } else {\r\n        const centerX = (from.x + to.x) / 2;\r\n        pts.push({ x: centerX, y: from.y }, { x: centerX, y: to.y });\r\n      }\r\n      break;\r\n    case Direction.Left:\r\n      if (to.x > from.x) {\r\n        pts.push({ x: from.x, y: to.y });\r\n      } else {\r\n        pts.push({ x: to.x, y: from.y });\r\n      }\r\n      break;\r\n    default:\r\n      x = from.x;\r\n      y = to.y;\r\n      if (to.x < from.x - faceSpace) {\r\n        const centerX = (from.x + to.x + faceSpace) / 2;\r\n        pts.push({ x: centerX, y: from.y }, { x: centerX, y });\r\n      } else {\r\n        pts.push({ x: from.x, y });\r\n      }\r\n      break;\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nfunction getNextPoints(pen: Pen, from: Point, to: Point) {\r\n  const pts: Point[] = [];\r\n\r\n  if (pen.calculative.drawlineH == undefined) {\r\n    pen.calculative.drawlineH =\r\n      Math.abs(to.x - from.x) > Math.abs(to.y - from.y);\r\n  }\r\n  let index = pen.calculative.worldAnchors.findIndex(\r\n    (anchor) => anchor.id == from.id\r\n  );\r\n  if (index > 1) {\r\n    let prev = pen.calculative.worldAnchors[index - 1];\r\n    if (prev.x === from.x && prev.y !== from.y) {\r\n      //水平\r\n      pts.push({ x: to.x, y: from.y });\r\n      return pts;\r\n    } else if (prev.y === from.y && prev.x !== from.x) {\r\n      //垂直\r\n      pts.push({ x: from.x, y: to.y });\r\n      return pts;\r\n    }\r\n  }\r\n\r\n  if (pen.calculative.worldAnchors.length) {\r\n    to.isTemp = undefined;\r\n    if (pen.calculative.drawlineH) {\r\n      pts.push({ x: to.x, y: from.y });\r\n      if (Math.abs(to.y - from.y) < faceSpace) {\r\n        to.isTemp = true;\r\n      }\r\n    } else {\r\n      pts.push({ x: from.x, y: to.y });\r\n      if (Math.abs(to.x - from.x) < faceSpace) {\r\n        to.isTemp = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return pts;\r\n}\r\n\r\nexport function anchorInHorizontal(pen: Pen, anchor: Point, from = true) {\r\n  let anchors = pen.calculative.worldAnchors;\r\n  if (!from) {\r\n    anchors = [];\r\n    pen.calculative.worldAnchors.forEach((item) => {\r\n      anchors.unshift(item);\r\n    });\r\n  }\r\n  for (let i = 0; i < anchors.length; i++) {\r\n    if (anchors[i].id === anchor.id) {\r\n      break;\r\n    }\r\n\r\n    if (anchors[i].y !== anchor.y) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      anchors[i].x === anchors[i + 1]?.x &&\r\n      anchors[i].y !== anchors[i + 1]?.y\r\n    ) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function anchorInVertical(pen: Pen, anchor: Point, from = true) {\r\n  let anchors = pen.calculative.worldAnchors;\r\n  if (!from) {\r\n    anchors = [];\r\n    pen.calculative.worldAnchors.forEach((item) => {\r\n      anchors.unshift(item);\r\n    });\r\n  }\r\n  for (let i = 0; i < anchors.length; i++) {\r\n    if (anchors[i].id === anchor.id) {\r\n      break;\r\n    }\r\n\r\n    if (anchors[i].x !== anchor.x) {\r\n      return false;\r\n    }\r\n\r\n    if (\r\n      anchors[i].y === anchors[i + 1]?.y &&\r\n      anchors[i].x !== anchors[i + 1]?.x\r\n    ) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function translatePolylineAnchor(\r\n  pen: Pen,\r\n  anchor: Point,\r\n  pt: { x: number; y: number }\r\n) {\r\n  if (!pen.calculative.worldAnchors) {\r\n    return;\r\n  }\r\n\r\n  const i = pen.calculative.worldAnchors.findIndex(\r\n    (item) => item.id === anchor.id\r\n  );\r\n\r\n  const from = getFromAnchor(pen);\r\n  const to = getToAnchor(pen);\r\n\r\n  let prev = pen.calculative.worldAnchors[i - 1];\r\n  let next = pen.calculative.worldAnchors[i + 1];\r\n  if (pen.calculative.h == undefined) {\r\n    if (from.connectTo) {\r\n      if (anchorInHorizontal(pen, anchor, true)) {\r\n        pen.calculative.h = true;\r\n      } else if (anchorInVertical(pen, anchor, true)) {\r\n        pen.calculative.h = false;\r\n      }\r\n    }\r\n    if (pen.calculative.h == undefined && to.connectTo) {\r\n      if (anchorInHorizontal(pen, anchor, false)) {\r\n        pen.calculative.h = true;\r\n      } else if (anchorInVertical(pen, anchor, false)) {\r\n        pen.calculative.h = false;\r\n      }\r\n    }\r\n\r\n    if (pen.calculative.h == undefined) {\r\n      if (prev) {\r\n        pen.calculative.h = prev.y === anchor.y;\r\n      } else if (next) {\r\n        pen.calculative.h = next.y === anchor.y;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 水平\r\n  if (pen.calculative.h) {\r\n    anchor.x = pt.x;\r\n\r\n    if (from.connectTo && anchorInHorizontal(pen, anchor, true)) {\r\n      if (next && next.y !== anchor.y) {\r\n        next.x = anchor.x;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (to.connectTo && anchorInHorizontal(pen, anchor, false)) {\r\n      if (prev && prev.y !== anchor.y) {\r\n        prev.x = anchor.x;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const a = pen.anchors[i];\r\n    let d: any;\r\n    for (let pos = i - 1; pos > -1; pos--) {\r\n      prev = pen.anchors[pos];\r\n      if (d == undefined) {\r\n        d = prev.y === a.y;\r\n      }\r\n      if (d === true) {\r\n        if (prev.y === a.y) {\r\n          pen.calculative.worldAnchors[pos].y = pt.y;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        if (prev.x === a.x) {\r\n          pen.calculative.worldAnchors[pos].x = pt.x;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    d = undefined;\r\n    for (let pos = i + 1; pos < pen.calculative.worldAnchors.length; pos++) {\r\n      next = pen.anchors[pos];\r\n      if (next) {\r\n        if (d == undefined) {\r\n          d = next.y === a.y;\r\n        }\r\n\r\n        if (d === true) {\r\n          if (next.y === a.y) {\r\n            pen.calculative.worldAnchors[pos].y = pt.y;\r\n          } else {\r\n            break;\r\n          }\r\n        } else {\r\n          if (next.x === a.x) {\r\n            pen.calculative.worldAnchors[pos].x = pt.x;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    anchor.y = pt.y;\r\n  }\r\n  // 垂直\r\n  else {\r\n    anchor.y = pt.y;\r\n\r\n    if (from.connectTo && anchorInVertical(pen, anchor, true)) {\r\n      if (next && next.x !== anchor.x) {\r\n        next.y = anchor.y;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (to.connectTo && anchorInVertical(pen, anchor, false)) {\r\n      if (prev && prev.x !== anchor.x) {\r\n        prev.y = anchor.y;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const a = pen.anchors[i];\r\n    let d: any;\r\n    for (let pos = i - 1; pos > -1; pos--) {\r\n      prev = pen.anchors[pos];\r\n      if (d == undefined) {\r\n        d = prev.x === a.x;\r\n      }\r\n      if (d === true) {\r\n        if (prev.x === a.x) {\r\n          pen.calculative.worldAnchors[pos].x = pt.x;\r\n        } else {\r\n          break;\r\n        }\r\n      } else {\r\n        if (prev.y === a.y) {\r\n          pen.calculative.worldAnchors[pos].y = pt.y;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    d = undefined;\r\n    for (let pos = i + 1; pos < pen.calculative.worldAnchors.length; pos++) {\r\n      next = pen.anchors[pos];\r\n      if (next) {\r\n        if (d == undefined) {\r\n          d = next.x === a.x;\r\n        }\r\n\r\n        if (d === true) {\r\n          if (next.x === a.x) {\r\n            pen.calculative.worldAnchors[pos].x = pt.x;\r\n          } else {\r\n            break;\r\n          }\r\n        } else {\r\n          if (next.y === a.y) {\r\n            pen.calculative.worldAnchors[pos].y = pt.y;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    anchor.x = pt.x;\r\n  }\r\n}\r\n","import { Point, PrevNextType } from '../../point';\r\n\r\nexport function simplify(points: Point[], length: number, start: number, end: number) {\r\n  const newPoints: Point[] = [];\r\n  let maxDist, index, xx, yy, dx, dy, ddx, ddy, p1, p2, p, t, dist, dist1;\r\n  p1 = points[start];\r\n  p2 = points[end];\r\n  xx = p1.x;\r\n  yy = p1.y;\r\n  ddx = p2.x - xx;\r\n  ddy = p2.y - yy;\r\n  dist1 = ddx * ddx + ddy * ddy;\r\n  maxDist = length;\r\n  for (let i = start + 1; i < end; i++) {\r\n    p = points[i];\r\n    if (ddx !== 0 || ddy !== 0) {\r\n      t = ((p.x - xx) * ddx + (p.y - yy) * ddy) / dist1;\r\n      if (t > 1) {\r\n        dx = p.x - p2.x;\r\n        dy = p.y - p2.y;\r\n      } else if (t > 0) {\r\n        dx = p.x - (xx + ddx * t);\r\n        dy = p.y - (yy + ddy * t);\r\n      } else {\r\n        dx = p.x - xx;\r\n        dy = p.y - yy;\r\n      }\r\n    } else {\r\n      dx = p.x - xx;\r\n      dy = p.y - yy;\r\n    }\r\n    dist = dx * dx + dy * dy;\r\n    if (dist > maxDist) {\r\n      index = i;\r\n      maxDist = dist;\r\n    }\r\n  }\r\n\r\n  if (maxDist > length) {\r\n    // continue simplification while maxDist > length\r\n    if (index - start > 1) {\r\n      newPoints.push(...simplify(points, length, start, index));\r\n    }\r\n    newPoints.push({\r\n      id: points[index].id,\r\n      penId: points[index].penId,\r\n      x: points[index].x,\r\n      y: points[index].y,\r\n    });\r\n    if (end - index > 1) {\r\n      newPoints.push(...simplify(points, length, index, end));\r\n    }\r\n  }\r\n\r\n  return newPoints;\r\n}\r\n\r\nexport function smoothLine(points: Point[], cornerThres = 0.8, match = false) {\r\n  if (points.length < 3) {\r\n    return points;\r\n  }\r\n\r\n  // adds bezier control points at points if lines have angle less than thres\r\n  let p1, p2, p3, dist1, dist2, x, y, endP, len, angle, newPoints, aLen, nx1, nx2, ny1, ny2;\r\n  const dot = (x, y, xx, yy) => {\r\n    dist1 = Math.sqrt(x * x + y * y);\r\n    if (dist1 > 0) {\r\n      // normalise\r\n      nx1 = x / dist1;\r\n      ny1 = y / dist1;\r\n    } else {\r\n      nx1 = 1; // need to have something so this will do as good as anything\r\n      ny1 = 0;\r\n    }\r\n    dist2 = Math.sqrt(xx * xx + yy * yy);\r\n    if (dist2 > 0) {\r\n      nx2 = xx / dist2;\r\n      ny2 = yy / dist2;\r\n    } else {\r\n      nx2 = 1;\r\n      ny2 = 0;\r\n    }\r\n    return Math.acos(nx1 * nx2 + ny1 * ny2);\r\n  };\r\n  newPoints = [];\r\n  aLen = points.length;\r\n  p1 = points[0];\r\n  endP = points[aLen - 1];\r\n  newPoints.push({ ...points[0] });\r\n  for (let i = 0; i < aLen - 1; i++) {\r\n    p2 = points[i];\r\n    p3 = points[i + 1];\r\n    angle = Math.abs(dot(p2.x - p1.x, p2.y - p1.y, p3.x - p2.x, p3.y - p2.y));\r\n    if (dist1) {\r\n      // dist1 and dist2 come from dot function\r\n      if (angle < cornerThres * 3.14) {\r\n        // bend it if angle between lines is small\r\n        if (match) {\r\n          dist1 = Math.min(dist1, dist2);\r\n          dist2 = dist1;\r\n        }\r\n        // use the two normalized vectors along the lines to create the tangent vector\r\n        x = (nx1 + nx2) / 2;\r\n        y = (ny1 + ny2) / 2;\r\n        len = Math.sqrt(x * x + y * y); // normalise the tangent\r\n        if (len === 0) {\r\n          newPoints.push({ ...p2 });\r\n        } else {\r\n          x /= len;\r\n          y /= len;\r\n          const pt: Point = { ...p2 };\r\n          pt.prevNextType = PrevNextType.Bilateral;\r\n          pt.prev = {\r\n            penId: pt.penId,\r\n            x: p2.x - x * dist1 * 0.25,\r\n            y: p2.y - y * dist1 * 0.25,\r\n          };\r\n          pt.next = {\r\n            penId: pt.penId,\r\n            x: p2.x + x * dist2 * 0.25,\r\n            y: p2.y + y * dist2 * 0.25,\r\n          };\r\n          newPoints.push(pt);\r\n        }\r\n      } else {\r\n        newPoints.push({ ...p2 });\r\n      }\r\n    }\r\n    p1 = p2;\r\n  }\r\n  newPoints.push({ ...points[points.length - 1] });\r\n  return newPoints;\r\n}\r\n","import { Pen, LineAnimateType } from '../../pen';\r\nimport { Point } from '../../point';\r\n\r\n//箭头动画\r\nexport function drawArrow(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D | Path2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const worldAnchors = pen.calculative.worldAnchors;\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n  let size = (pen.calculative.animateLineWidth || 6) * scale; // 箭头大小\r\n  let arrowLength = (pen.animateLineWidth*2 || 12) * scale; // 箭头长度\r\n  if(pen.lineAnimateType === LineAnimateType.WaterDrop){\r\n    arrowLength = (pen.animateLineWidth*4 || 24) * scale; // 水滴长度\r\n  }\r\n  let d = (pen.animateInterval || 100) * scale; // 箭头间距\r\n  let smoothLenth = pen.calculative.lineWidth *(pen.calculative.lineSmooth || 0)//*scale;\r\n  let lineWidth = (pen.calculative.animateLineWidth/2 || 3) * scale;\r\n  if (pen.animateReverse) {\r\n    //箭头反向\r\n    arrowLength = -arrowLength;\r\n    size = -size;\r\n  }\r\n  if (worldAnchors.length > 1) {\r\n    let from: Point; // 上一个点\r\n    let lastLength = 0;\r\n    for (let i = 0; i < worldAnchors.length; i++) {\r\n      let pt = worldAnchors[i];\r\n      //获取箭头角度\r\n      if (from) {\r\n        let angle = getAngle(from, pt);\r\n        let newP = {\r\n          x:\r\n            from.x +\r\n            ((pen.calculative.animatePos - lastLength) % d) *\r\n              Math.cos((angle * Math.PI) / 180),\r\n          y:\r\n            from.y -\r\n            ((pen.calculative.animatePos - lastLength) % d) *\r\n              Math.sin((angle * Math.PI) / 180),\r\n        };\r\n        if (pen.animateReverse) {\r\n          newP = {\r\n            x:\r\n              from.x +\r\n              ((pen.length - (pen.calculative.animatePos + lastLength)) % d) *\r\n                Math.cos((angle * Math.PI) / 180),\r\n            y:\r\n              from.y -\r\n              ((pen.length - (pen.calculative.animatePos + lastLength)) % d) *\r\n                Math.sin((angle * Math.PI) / 180),\r\n          };\r\n        }\r\n        let newPTFrom = Math.sqrt(\r\n          (newP.x - from.x) ** 2 + (newP.y - from.y) ** 2\r\n        );\r\n        let ptTFrom = Math.sqrt((pt.x - from.x) ** 2 + (pt.y - from.y) ** 2);\r\n        while (newPTFrom < ptTFrom) {\r\n          if (\r\n            ((pen.animateReverse && newPTFrom - arrowLength < ptTFrom) || //不允许超出连线绘制\r\n            (!pen.animateReverse &&\r\n              newPTFrom > arrowLength)) &&\r\n              newPTFrom > (smoothLenth+arrowLength) &&\r\n              ptTFrom - newPTFrom > smoothLenth\r\n          ) {\r\n            if(pen.lineAnimateType === LineAnimateType.Arrow){\r\n              arrow(path, newP, size, angle, lineWidth, arrowLength);\r\n            }else if(pen.lineAnimateType === LineAnimateType.WaterDrop){\r\n              waterDrop(path, newP, pen.animateReverse, angle, lineWidth, arrowLength);\r\n            }\r\n          }\r\n          newP.x += d * Math.cos((angle * Math.PI) / 180);\r\n          newP.y -= d * Math.sin((angle * Math.PI) / 180);\r\n          newPTFrom = Math.sqrt(\r\n            (newP.x - from.x) ** 2 + (newP.y - from.y) ** 2\r\n          );\r\n        }\r\n        // lastLength += ptTFrom-newPTFrom;\r\n      }\r\n      from = pt;\r\n    }\r\n  }\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\n//获取两点连线和水平线的夹角\r\nfunction getAngle(p1, p2) {\r\n  let dx = p2.x - p1.x;\r\n  let dy = p2.y - p1.y;\r\n  let angle = (Math.atan(dy / dx) * 180) / Math.PI;\r\n  if (p2.x >= p1.x) {\r\n    angle = -angle;\r\n  } else {\r\n    angle = 180 - angle;\r\n  }\r\n  return angle;\r\n}\r\n\r\n//获取p相对rp旋转_angle后的点坐标\r\nfunction getRotatePoint(p: Point, rp: Point, _angle: number) {\r\n  let angle = ((180 - _angle) * Math.PI) / 180;\r\n  return {\r\n    x: (p.x - rp.x) * Math.cos(angle) - (p.y - rp.y) * Math.sin(angle) + rp.x,\r\n    y: (p.x - rp.x) * Math.sin(angle) + (p.y - rp.y) * Math.cos(angle) + rp.y,\r\n  };\r\n}\r\n\r\n//标准箭头\r\nfunction arrow(path:CanvasRenderingContext2D |Path2D, newP:Point, size:number, angle:number, lineWidth:number, arrowLength:number){\r\n  let pr = getRotatePoint(\r\n    { x: newP.x + size, y: newP.y + 0.57*size },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pl = getRotatePoint(\r\n    { x: newP.x + size, y: newP.y - 0.57*size },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pr1 = getRotatePoint(\r\n    { x: newP.x + size, y: newP.y + lineWidth/2 },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pr2 = getRotatePoint(\r\n    { x: newP.x + arrowLength, y: newP.y + lineWidth/2},\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pl1 = getRotatePoint(\r\n    { x: newP.x + size, y: newP.y - lineWidth/2 },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pl2 = getRotatePoint(\r\n    { x: newP.x + arrowLength, y: newP.y - lineWidth/2 },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  path.moveTo(pr.x, pr.y);\r\n  path.lineTo(newP.x, newP.y);\r\n  path.lineTo(pl.x, pl.y);\r\n  path.lineTo(pl1.x, pl1.y);\r\n  path.lineTo(pl2.x, pl2.y);\r\n  path.lineTo(pr2.x, pr2.y);\r\n  path.lineTo(pr1.x, pr1.y);\r\n  path.lineTo(pr.x, pr.y);\r\n}\r\n\r\n//水滴\r\nfunction waterDrop(path:CanvasRenderingContext2D |Path2D, newP:Point, reverse:boolean, angle:number, lineWidth:number, arrowLength:number){\r\n  let dis = lineWidth/2;\r\n  if(reverse){\r\n    dis = -lineWidth/2;\r\n  }\r\n  let pl1 = getRotatePoint(\r\n    { x: newP.x, y: newP.y + dis },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let pE = getRotatePoint(\r\n    { x: newP.x + arrowLength, y: newP.y  },\r\n    { x: newP.x, y: newP.y },\r\n    angle\r\n  );\r\n  let rAngle =Math.PI/2;\r\n  if(reverse){\r\n    rAngle = -Math.PI/2;\r\n  }\r\n  path.moveTo(newP.x, newP.y);\r\n  path.arc(newP.x, newP.y, lineWidth/2, -rAngle-angle/180*Math.PI, rAngle-angle/180*Math.PI, false);\r\n  path.lineTo(pE.x, pE.y);\r\n  path.lineTo(pl1.x, pl1.y);\r\n}\r\n","import { Pen, setElemPosition } from '../pen';\r\nimport { Point } from '../point';\r\nimport { deepClone, getRootDomain } from '../utils';\r\n\r\nexport function iframe(pen: Pen) {\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = destory;\r\n    pen.onMove = move;\r\n    pen.onResize = move;\r\n    pen.onRotate = move;\r\n    pen.onValue = move;\r\n    pen.onMouseMove = mouseMove;\r\n    pen.onBeforeValue = beforeValue;\r\n    pen.onRenderPenRaw = renderPenRaw;\r\n  }\r\n  if (!pen.calculative.singleton) {\r\n    pen.calculative.singleton = {};\r\n  }\r\n  const worldRect = pen.calculative.worldRect;\r\n\r\n  if (!pen.calculative.singleton.div) {\r\n    const div = document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.outline = 'none';\r\n    div.style.left = '-9999px';\r\n    div.style.top = '-9999px';\r\n    div.style.width = worldRect.width + 'px';\r\n    div.style.height = worldRect.height + 'px';\r\n    document.body.appendChild(div);\r\n    pen.calculative.canvas.externalElements?.parentElement.appendChild(div);\r\n    setElemPosition(pen, div);\r\n    pen.calculative.singleton.div = div;\r\n    const iframe = document.createElement('iframe');\r\n    iframe.style.width = '100%';\r\n    iframe.style.height = '100%';\r\n    iframe.scrolling = pen.scrolling || 'no';\r\n    iframe.frameBorder = '0';\r\n    iframe.style.border = 'none';\r\n    iframe.src = pen.iframe;\r\n    pen.calculative.iframe = pen.iframe;\r\n    div.appendChild(iframe);\r\n    generateAroundDiv(pen);\r\n    iframe.onload = () => {\r\n      iframe.setAttribute('document.domain', '');\r\n    };\r\n  }\r\n\r\n  if (pen.calculative.patchFlags) {\r\n    setElemPosition(pen, pen.calculative.singleton.div);\r\n  }\r\n  pen.onRenderPenRaw(pen);\r\n  return new Path2D();\r\n}\r\n\r\nfunction destory(pen: Pen) {\r\n  updatePointerEvents(pen);\r\n  if (pen.calculative.singleton && pen.calculative.singleton.div) {\r\n    pen.calculative.singleton.div.remove();\r\n    delete pen.calculative.singleton.div;\r\n  }\r\n}\r\n\r\nfunction move(pen: Pen) {\r\n  pen.calculative.singleton.div &&\r\n    setElemPosition(pen, pen.calculative.singleton.div);\r\n}\r\n\r\nfunction beforeValue(pen: Pen, value: any) {\r\n  if (value.iframe) {\r\n    if (pen.calculative.singleton.div) {\r\n      pen.calculative.singleton.div.children[0].src = value.iframe;\r\n      pen.calculative.iframe = value.iframe;\r\n    }\r\n  }\r\n\r\n  if (\r\n    value.operationalRect ||\r\n    value['operationalRect.x'] !== undefined ||\r\n    value['operationalRect.y'] !== undefined ||\r\n    value['operationalRect.width'] !== undefined ||\r\n    value['operationalRect.height'] !== undefined\r\n  ) {\r\n    if (!pen.operationalRect) {\r\n      pen.operationalRect = {};\r\n    }\r\n    let _value = deepClone(value);\r\n    if (!_value.operationalRect) {\r\n      _value.operationalRect = {};\r\n    }\r\n    if (_value['operationalRect.x'] !== undefined) {\r\n      _value.operationalRect.x = _value['operationalRect.x'];\r\n    }\r\n    if (_value['operationalRect.y'] !== undefined) {\r\n      _value.operationalRect.y = _value['operationalRect.y'];\r\n    }\r\n    if (_value['operationalRect.width'] !== undefined) {\r\n      _value.operationalRect.width = _value['operationalRect.width'];\r\n    }\r\n    if (_value['operationalRect.height'] !== undefined) {\r\n      _value.operationalRect.height = _value['operationalRect.height'];\r\n    }\r\n    Object.assign(pen.operationalRect, _value.operationalRect);\r\n    if (pen.calculative.singleton.div) {\r\n      let length = pen.calculative.singleton.div.children.length;\r\n      if (length === 1) {\r\n        //没有创建\r\n        generateAroundDiv(pen);\r\n      } else {\r\n        //有更新值\r\n        pen.calculative.singleton.div.children[1].style.height =\r\n          pen.operationalRect.y * 100 + '%';\r\n        pen.calculative.singleton.div.children[1].style.left =\r\n          pen.operationalRect.x * 100 + '%';\r\n        pen.calculative.singleton.div.children[1].style.width =\r\n          pen.operationalRect.width * 100 + '%';\r\n        pen.calculative.singleton.div.children[2].style.width =\r\n          (1 - pen.operationalRect.x - pen.operationalRect.width) * 100 + '%';\r\n\r\n        pen.calculative.singleton.div.children[3].style.height =\r\n          (1 - pen.operationalRect.y - pen.operationalRect.height) * 100 + '%';\r\n        pen.calculative.singleton.div.children[3].style.left =\r\n          pen.operationalRect.x * 100 + '%';\r\n        pen.calculative.singleton.div.children[3].style.width =\r\n          pen.operationalRect.width * 100 + '%';\r\n\r\n        pen.calculative.singleton.div.children[4].style.width =\r\n          pen.operationalRect.x * 100 + '%';\r\n      }\r\n    }\r\n  }\r\n  if (value.blur !== undefined) {\r\n    for (let i = 1; i < 5; i++) {\r\n      pen.calculative.singleton.div.children[i].style[\r\n        'backdrop-filter'\r\n      ] = `blur(${value.blur || 2}px)`;\r\n    }\r\n  }\r\n  if (value.blurBackground !== undefined) {\r\n    for (let i = 1; i < 5; i++) {\r\n      pen.calculative.singleton.div.children[i].style.backgroundColor =\r\n        value.blurBackground;\r\n    }\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction mouseMove(pen: Pen, e: Point) {\r\n  if (!pen.calculative.canvas.store.data.locked && !pen.locked) {\r\n    return;\r\n  }\r\n  if (initOperationalRect(pen.operationalRect)) {\r\n    if (\r\n      pen.calculative.zIndex < 5 &&\r\n      e.x > pen.x + pen.width * pen.operationalRect.x &&\r\n      e.x <\r\n        pen.x +\r\n          pen.width * (pen.operationalRect.x + pen.operationalRect.width) &&\r\n      e.y > pen.y + pen.height * pen.operationalRect.y &&\r\n      e.y <\r\n        pen.y +\r\n          pen.height * (pen.operationalRect.y + pen.operationalRect.height)\r\n    ) {\r\n      if (pen.calculative.singleton.div) {\r\n        let children: HTMLElement[] =\r\n          pen.calculative.singleton.div.parentNode.children;\r\n        for (let i = 0; i < 6; i++) {\r\n          children[i].style.pointerEvents = 'none';\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction initOperationalRect(operationalRect) {\r\n  if (operationalRect) {\r\n    if (!operationalRect.width || !operationalRect.height) {\r\n      return false;\r\n    }\r\n    //默认居中\r\n    if (operationalRect.x === undefined) {\r\n      operationalRect.x = (1 - operationalRect.width) / 2;\r\n    }\r\n    if (operationalRect.y === undefined) {\r\n      operationalRect.y = (1 - operationalRect.height) / 2;\r\n    }\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction generateAroundDiv(pen: Pen) {\r\n  if (!initOperationalRect(pen.operationalRect)) {\r\n    return;\r\n  }\r\n  const div = pen.calculative.singleton.div;\r\n  if (!div) {\r\n    return;\r\n  }\r\n  const top = document.createElement('div');\r\n  top.style.position = 'absolute';\r\n  top.style.left = pen.operationalRect.x * 100 + '%';\r\n  top.style.top = '0px';\r\n  top.style.width = pen.operationalRect.width * 100 + '%';\r\n  top.style.height = pen.operationalRect.y * 100 + '%';\r\n  top.style['backdrop-filter'] = `blur(${pen.blur || 2}px)`;\r\n  top.style.backgroundColor = pen.blurBackground;\r\n  div.appendChild(top);\r\n\r\n  const right = document.createElement('div');\r\n  right.style.position = 'absolute';\r\n  right.style.right = '0px';\r\n  right.style.top = '0px';\r\n  right.style.width =\r\n    (1 - pen.operationalRect.x - pen.operationalRect.width) * 100 + '%';\r\n  right.style.height = '100%';\r\n  right.style['backdrop-filter'] = `blur(${pen.blur || 2}px)`;\r\n  right.style.backgroundColor = pen.blurBackground;\r\n  div.appendChild(right);\r\n\r\n  const bottom = document.createElement('div');\r\n  bottom.style.position = 'absolute';\r\n  bottom.style.left = pen.operationalRect.x * 100 + '%';\r\n  bottom.style.bottom = '0px';\r\n  bottom.style.width = pen.operationalRect.width * 100 + '%';\r\n  bottom.style.height =\r\n    (1 - pen.operationalRect.y - pen.operationalRect.height) * 100 + '%';\r\n  bottom.style['backdrop-filter'] = `blur(${pen.blur || 2}px)`;\r\n  bottom.style.backgroundColor = pen.blurBackground;\r\n  div.appendChild(bottom);\r\n\r\n  const left = document.createElement('div');\r\n  left.style.position = 'absolute';\r\n  left.style.left = '0px';\r\n  left.style.top = '0px';\r\n  left.style.width = pen.operationalRect.x * 100 + '%';\r\n  left.style.height = '100%';\r\n  left.style['backdrop-filter'] = `blur(${pen.blur || 2}px)`;\r\n  left.style.backgroundColor = pen.blurBackground;\r\n  div.appendChild(left);\r\n\r\n  let mouseEnter = () => {\r\n    updatePointerEvents(pen);\r\n  };\r\n\r\n  top.onmouseenter = mouseEnter;\r\n  bottom.onmouseenter = mouseEnter;\r\n  right.onmouseenter = mouseEnter;\r\n  left.onmouseenter = mouseEnter;\r\n  div.onmouseleave = mouseEnter;\r\n  // }\r\n}\r\n\r\nfunction updatePointerEvents(pen: Pen) {\r\n  if (!pen.calculative.canvas.store.data.locked && !pen.locked) {\r\n    return;\r\n  }\r\n  if (pen.calculative.zIndex < 5) {\r\n    let children: any = pen.calculative.singleton.div.parentNode.children;\r\n    for (let i = 1; i < 6; i++) {\r\n      children[i].style.pointerEvents = 'initial';\r\n    }\r\n  }\r\n}\r\n\r\nfunction renderPenRaw(pen: Pen) {\r\n  if (pen.thumbImg) {\r\n    if (!pen.calculative.img) {\r\n      const img = new Image();\r\n      img.crossOrigin =\r\n        pen.crossOrigin === 'undefined'\r\n          ? undefined\r\n          : pen.crossOrigin || 'anonymous';\r\n      if (\r\n        pen.calculative.canvas.store.options.cdn &&\r\n        !(\r\n          pen.thumbImg.startsWith('http') ||\r\n          pen.thumbImg.startsWith('//') ||\r\n          pen.thumbImg.startsWith('data:image')\r\n        )\r\n      ) {\r\n        img.src = pen.calculative.canvas.store.options.cdn + pen.thumbImg;\r\n      } else {\r\n        img.src = pen.thumbImg;\r\n      }\r\n      img.onerror = (e) => {\r\n        img.remove();\r\n        pen.calculative.img = undefined;\r\n      };\r\n      pen.calculative.img = img;\r\n    }\r\n  } else {\r\n    // if (pen.calculative.singleton && pen.calculative.singleton.div) {\r\n    //   try {\r\n    //     // handleSaveImg(pen);\r\n    //   } catch (e) {\r\n    //     console.warn(e);\r\n    //     pen.calculative.img = null;\r\n    //   }\r\n    // }\r\n  }\r\n}\r\n\r\nasync function handleSaveImg(pen: Pen) {\r\n  let iframeHtml = pen.calculative.singleton.div.children[0].contentWindow;\r\n  const iframeBody = iframeHtml.document.getElementsByTagName('body')[0];\r\n  const iframeScrollY = iframeHtml.document.documentElement.scrollTop;\r\n  const iframeScrollX = iframeHtml.document.documentElement.scrollLeft;\r\n  var fillContent = document.createElement('div');\r\n  // 把需要转换成图片的元素内容赋给创建的元素\r\n  fillContent.innerHTML = iframeBody.outerHTML;\r\n  document.body.appendChild(fillContent);\r\n  iframeHtml.document.domain = getRootDomain();\r\n  if (globalThis.html2canvas) {\r\n    const canvas = await globalThis.html2canvas(fillContent, {\r\n      allowTaint: true,\r\n      useCORS: true,\r\n      width: pen.width, // TODO 截屏按照1920*1080分辨率下的预览窗口宽高\r\n      height: pen.height,\r\n      x: iframeScrollX,\r\n      y: iframeScrollY,\r\n      // foreignObjectRendering: true,\r\n    });\r\n    // canvas.getContext('2d', {\r\n    //   willReadFrequently: true,\r\n    // });\r\n    const img = new Image();\r\n    img.crossOrigin =\r\n      pen.crossOrigin === 'undefined'\r\n        ? undefined\r\n        : pen.crossOrigin || 'anonymous';\r\n    img.src = canvas.toDataURL('image/png', 0.1);\r\n    if (img.src.length > 10) {\r\n      pen.calculative.img = img;\r\n    }\r\n    document.body.removeChild(fillContent);\r\n  }\r\n  // globalThis.html2canvas &&\r\n  //   globalThis\r\n  //     .html2canvas(iframeBody, {\r\n  //       allowTaint: true,\r\n  //       useCORS: true,\r\n  //       width: pen.width, // TODO 截屏按照1920*1080分辨率下的预览窗口宽高\r\n  //       height: pen.height,\r\n  //       x: iframeScrollX,\r\n  //       y: iframeScrollY,\r\n  //       foreignObjectRendering: true,\r\n  //     })\r\n  //     .then((canvas) => {\r\n  //       // 转成图片，生成图片地址\r\n  //       // imgBase64 = canvas.toDataURL('image/png');\r\n  //       const img = new Image();\r\n  //       img.crossOrigin =\r\n  //         pen.crossOrigin === 'undefined'\r\n  //           ? undefined\r\n  //           : pen.crossOrigin || 'anonymous';\r\n  //       img.src = canvas.toDataURL('image/png', 0.1);\r\n  //       if (img.src.length > 10) {\r\n  //         pen.calculative.img = img;\r\n  //       }\r\n  //     })\r\n  //     .catch((e) => {\r\n  //       console.warn(e);\r\n  //     });\r\n}\r\n","import { Pen, setElemPosition } from '../pen';\r\n\r\nexport const videos: {\r\n  [id: string]: HTMLDivElement;\r\n} = {};\r\n\r\nconst mutedIcons =['<svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M473.088 125.44L256 256H52.224C23.552 256 0 279.552 0 308.224V716.8c0 28.16 23.04 51.2 51.2 51.2h204.8l217.088 130.56c16.896 10.24 38.912-2.048 38.912-22.016V147.456c0-19.968-21.504-32.256-38.912-22.016zM699.904 320.512c-20.992-18.944-53.248-17.408-72.192 3.584-18.944 20.992-17.408 53.248 3.584 72.192 0.512 0.512 58.368 54.784 58.368 121.344 0 37.888-19.456 74.752-58.368 110.08-20.992 18.944-22.528 51.2-3.584 72.192 10.24 11.264 24.064 16.896 37.888 16.896 12.288 0 24.576-4.608 34.304-13.312 61.44-55.296 92.16-117.76 92.16-185.856 0-112.64-88.576-193.536-92.16-197.12z\" fill=\"\" p-id=\"2434\"></path><path d=\"M853.504 166.4c-20.992-18.944-53.248-16.896-72.192 4.096-18.944 20.992-16.896 53.248 4.096 72.192 1.536 1.024 135.68 122.88 135.68 280.576 0 90.624-45.568 177.152-135.68 257.536-20.992 18.944-23.04 51.2-4.096 72.192 10.24 11.264 24.064 16.896 38.4 16.896 12.288 0 24.576-4.096 34.304-12.8 112.64-100.864 169.984-212.992 169.984-333.824-1.024-202.752-163.84-350.208-170.496-356.864z\"></path></svg>','<svg viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" ><path d=\"M256 768H51.2c-28.16 0-51.2-23.04-51.2-51.2V308.224C0 279.552 23.552 256 52.224 256H256v512zM512 147.456v728.576c0 19.968-21.504 32.256-38.912 22.016L256 768V256l217.088-130.56c17.408-10.24 38.912 2.048 38.912 22.016zM623.104 656.896c-19.968-19.968-19.968-52.224 0-72.192l217.088-217.088c19.968-19.968 52.224-19.968 72.192 0 19.968 19.968 19.968 52.224 0 72.192l-217.088 217.088c-19.456 19.968-52.224 19.968-72.192 0z\" fill=\"\" p-id=\"2582\"></path><path d=\"M623.104 367.104c19.968-19.968 52.224-19.968 72.192 0l217.088 217.088c19.968 19.968 19.968 52.224 0 72.192-19.968 19.968-52.224 19.968-72.192 0l-217.088-217.088c-19.968-19.456-19.968-52.224 0-72.192z\"></path></svg>'];\r\n\r\nexport function video(pen: Pen) {\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = destory;\r\n    pen.onMove = move;\r\n    pen.onResize = move;\r\n    pen.onRotate = move;\r\n    pen.onClick = click;\r\n    pen.onValue = value;\r\n    pen.onChangeId = changeId;\r\n  }\r\n\r\n  if (!videos[pen.id]) {\r\n    const player = document.createElement('div');\r\n\r\n    const progress = document.createElement('div');\r\n    progress.style.position = 'absolute';\r\n    progress.style.outline = 'none';\r\n    progress.style.left = '0';\r\n    progress.style.bottom = '0';\r\n    progress.style.width = '0';\r\n    progress.style.height = '2px';\r\n    progress.style.background = '#52c41a';\r\n    progress.style.zIndex = '1';\r\n    if((pen as any).hideProgress){\r\n      progress.style.display = 'none';\r\n    }\r\n    const muted = document.createElement('div');\r\n    muted.innerHTML = mutedIcons[1];\r\n    muted.style.position = 'absolute';\r\n    muted.style.right = '0';\r\n    muted.style.bottom = '0';\r\n    muted.style.width = '20px';\r\n    muted.style.height = '20px';\r\n    muted.style.fill = 'hsla(0, 0%, 100%, .8)';\r\n    muted.style.zIndex = '1';\r\n    muted.style.display = 'none';\r\n    player.appendChild(progress);\r\n    player.appendChild(muted);\r\n\r\n    muted.onclick = (e)=>{\r\n      e.stopPropagation();\r\n      if(pen.calculative.media.muted){\r\n        muted.innerHTML = mutedIcons[0];\r\n        pen.calculative.media.muted = false;\r\n      }else{\r\n        muted.innerHTML = mutedIcons[1];\r\n        pen.calculative.media.muted = true;\r\n      }\r\n    }\r\n    if(!pen.calculative.singleton){\r\n      pen.calculative.singleton = {};\r\n    }\r\n    pen.calculative.singleton.muted = muted;\r\n    player.onmouseenter = (e)=>{\r\n      muted.style.display = 'block';\r\n    }\r\n    player.onmouseleave = (e)=>{\r\n      muted.style.display = 'none';\r\n    }\r\n    player.onclick = (e)=>{\r\n      e.stopPropagation();\r\n      click(pen);\r\n    }\r\n    let media: HTMLMediaElement;\r\n    if (pen.video) {\r\n      media = document.createElement('video');\r\n      media.src = pen.video;\r\n    } else if (pen.audio) {\r\n      media = document.createElement('audio');\r\n      media.src = pen.audio;\r\n    }\r\n    media.loop = pen.playLoop;\r\n    media.ontimeupdate = () => {\r\n      resizeProcessWidth(progress, media, pen.calculative.worldRect.width);\r\n    };\r\n    media.onended = () => {\r\n      pen.calculative.onended && pen.calculative.onended(pen);\r\n    };\r\n    pen.calculative.media = media;\r\n    media.style.position = 'absolute';\r\n    media.style.outline = 'none';\r\n    media.style.left = '0';\r\n    media.style.top = '0';\r\n    media.style.width = '100%';\r\n    media.style.height = '100%';\r\n    player.appendChild(media);\r\n    videos[pen.id] = player;\r\n    pen.calculative.canvas.externalElements?.parentElement.appendChild(player);\r\n    setElemPosition(pen, player);\r\n    if (pen.autoPlay) {\r\n      media.autoplay = true;\r\n      media.muted = true;\r\n    }\r\n  } else if (\r\n    pen.video &&\r\n    pen.calculative.media &&\r\n    pen.video !== pen.calculative.video\r\n  ) {\r\n    console.warn('video 更改, 此处是否执行？');\r\n    pen.calculative.media.src = pen.video;\r\n    if (pen.autoPlay) {\r\n      pen.calculative.media.muted = true;\r\n      pen.calculative.media.autoplay = true;\r\n    }\r\n    pen.calculative.media.loop = pen.playLoop;\r\n    pen.calculative.video = pen.video;\r\n  } else if (\r\n    pen.audio &&\r\n    pen.calculative.media &&\r\n    pen.audio !== pen.calculative.audio\r\n  ) {\r\n    pen.calculative.media.src = pen.audio;\r\n    if (pen.autoPlay) {\r\n      pen.calculative.media.muted = true;\r\n      pen.calculative.media.autoplay = true;\r\n    }\r\n    pen.calculative.media.loop = pen.playLoop;\r\n    pen.calculative.audio = pen.audio;\r\n  }\r\n  if (pen.calculative.patchFlags) {\r\n    setElemPosition(pen, videos[pen.id]);\r\n  }\r\n  return new Path2D();\r\n}\r\n\r\nfunction destory(pen: Pen) {\r\n  videos[pen.id].onclick = null;\r\n  videos[pen.id].remove();\r\n  videos[pen.id] = undefined;\r\n}\r\n\r\nfunction move(pen: Pen) {\r\n  setElemPosition(pen, videos[pen.id]);\r\n  const progress = videos[pen.id].children[0];\r\n  const media = videos[pen.id].children[1];\r\n  resizeProcessWidth(\r\n    progress as HTMLDivElement,\r\n    media as HTMLMediaElement,\r\n    pen.calculative.worldRect.width\r\n  );\r\n}\r\n\r\nfunction click(pen: Pen) {\r\n  if (pen.calculative.media) {\r\n    pen.calculative.media.muted = false;\r\n    pen.calculative.singleton.muted.innerHTML = mutedIcons[0];\r\n    if (pen.calculative.media.paused) {\r\n      pen.calculative.media.play();\r\n    } else {\r\n      pen.calculative.media.pause();\r\n    }\r\n  }\r\n}\r\nfunction resizeProcessWidth(\r\n  progress: HTMLDivElement,\r\n  media: HTMLMediaElement,\r\n  width: number\r\n) {\r\n  // worldRect 会重新赋值，而 pen 不会变，这里才能取到实时的 worldRect\r\n  progress.style.width = (media.currentTime / media.duration) * width + 'px';\r\n}\r\n\r\nfunction changeId(pen: Pen, oldId: string, newId: string) {\r\n  if (!videos[oldId]) {\r\n    return;\r\n  }\r\n  videos[newId] = videos[oldId];\r\n  delete videos[oldId];\r\n}\r\n\r\nfunction value(pen: Pen) {\r\n  const video = videos[pen.id];\r\n  if (!video) {\r\n    return;\r\n  }\r\n  setElemPosition(pen, video);\r\n  const currentSrc = pen.calculative.media.getAttribute('src');\r\n  if (pen.video) {\r\n    if (currentSrc !== pen.video) {\r\n      pen.calculative.media.src = pen.video;\r\n    }\r\n  } else if (pen.audio) {\r\n    if (currentSrc !== pen.audio) {\r\n      pen.calculative.media.src = pen.audio;\r\n    }\r\n  }\r\n  // TODO: 下面每次都改动，是否影响性能？\r\n  if (pen.autoPlay) {\r\n    pen.calculative.media.muted = true;\r\n    // TODO: 自动播放何时关？\r\n    pen.calculative.media.autoplay = true;\r\n  }\r\n  pen.calculative.media.loop = pen.playLoop;\r\n}\r\n","export function createOffscreen(): any {\r\n  try {\r\n    const offscreen = new OffscreenCanvas(0, 0);\r\n    const context = offscreen.getContext('2d');\r\n\r\n    if (context && context.arc) {\r\n      return offscreen;\r\n    }\r\n\r\n    return document.createElement('canvas');\r\n  } catch (e) {\r\n    return document.createElement('canvas');\r\n  }\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\nimport { Meta2dStore } from '../store';\r\nimport type { marked as Marked } from 'marked';\r\nimport { getParent } from '../pen';\r\n\r\nexport class Tooltip {\r\n  box: HTMLElement;\r\n  text: HTMLElement;\r\n  arrowUp: HTMLElement;\r\n  arrowDown: HTMLElement;\r\n  x: number;\r\n  y: number;\r\n  private currentPen: Pen; // 本次 tooltip 在哪个画笔上\r\n  constructor(public parentElement: HTMLElement, private store: Meta2dStore) {\r\n    this.box = document.createElement('div');\r\n    this.text = document.createElement('div');\r\n    this.arrowUp = document.createElement('div');\r\n    this.arrowDown = document.createElement('div');\r\n\r\n    this.box.className = 'meta2d-tooltip';\r\n    this.text.className = 'text';\r\n    this.arrowUp.className = 'arrow';\r\n    this.arrowDown.className = 'arrow down';\r\n\r\n    this.box.appendChild(this.text);\r\n    this.box.appendChild(this.arrowUp);\r\n    this.box.appendChild(this.arrowDown);\r\n    parentElement.appendChild(this.box);\r\n\r\n    this.box.onmouseleave = () => {\r\n      this.hide();\r\n      this.store.lastHover = undefined;\r\n    };\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com/tooltip') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/tooltip';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        '.meta2d-tooltip{position:absolute;padding:8px 0;z-index:10;left: -9999px;top: -9999px;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-tooltip .text{max-width:320px;min-height:30px;max-height:400px;outline:none;padding:8px 16px;border-radius:4px;background:#777777;color:#ffffff;line-height:1.8;overflow-y:auto;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-tooltip .arrow{position:absolute;border:10px solid transparent;background:transparent;top:-5px;left:50%;transform:translateX(-50%)}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-tooltip .arrow.down{top:initial;bottom: -1px;}'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 通过 pen 的 titleFn titleFnJs title 来获取 title\r\n   * @returns 此次应该展示的 title\r\n   */\r\n  private static getTitle(pen: Pen) {\r\n    if (pen.titleFnJs && !pen.titleFn) {\r\n      try {\r\n        pen.titleFn = new Function('pen', pen.titleFnJs) as (\r\n          pen: Pen\r\n        ) => string;\r\n      } catch (error) {\r\n        console.log('titleFnJs', error);\r\n      }\r\n    }\r\n    return pen.titleFn ? pen.titleFn(pen) : String(pen.title);\r\n  }\r\n\r\n  /**\r\n   * 更改 tooltip dom 的文本\r\n   * @returns 返回设置前的 rect\r\n   */\r\n  private setText(pen: Pen): DOMRect {\r\n    const oldElemRect = this.box.getBoundingClientRect();\r\n    let marked: typeof Marked = globalThis.marked;\r\n    const title = Tooltip.getTitle(pen);\r\n    if (marked) {\r\n      this.text.innerHTML = marked(title);\r\n      const a = this.text.getElementsByTagName('A');\r\n      for (let i = 0; i < a.length; ++i) {\r\n        a[i].setAttribute('target', '_blank');\r\n      }\r\n    } else {\r\n      this.text.innerHTML = title;\r\n    }\r\n    return oldElemRect;\r\n  }\r\n\r\n  /**\r\n   * 更新文字\r\n   */\r\n  updateText(pen: Pen) {\r\n    if (this.currentPen?.id !== pen.id) {\r\n      return;\r\n    }\r\n\r\n    if (Tooltip.titleEmpty(pen)) {\r\n      return;\r\n    }\r\n\r\n    const oldRect = this.setText(pen);\r\n    const newRect = this.box.getBoundingClientRect();\r\n    this.changePositionByText(oldRect, newRect);\r\n  }\r\n\r\n  /**\r\n   * 改变文字会 影响 box 的大小，需要重新设置位置\r\n   * @param oldRect 原\r\n   * @param newRect 新\r\n   */\r\n  private changePositionByText(oldRect: DOMRect, newRect: DOMRect) {\r\n    this.x -= (newRect.width - oldRect.width) / 2;\r\n    this.y -= newRect.height - oldRect.height;\r\n    this.box.style.left = this.x + 'px';\r\n    this.box.style.top = this.y + 'px';\r\n  }\r\n\r\n  private static titleEmpty(pen: Pen) {\r\n    return !pen.title && !pen.titleFn && !pen.titleFnJs;\r\n  }\r\n\r\n  show(pen: Pen, pos: Point) {\r\n    this.currentPen = pen;\r\n    if (Tooltip.titleEmpty(pen)) {\r\n      let parent = getParent(pen, true);\r\n      if (parent) {\r\n        this.show(parent, pos);\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.setText(pen);\r\n    const elemRect = this.box.getBoundingClientRect();\r\n    const rect = pen.calculative.worldRect;\r\n    let x = pen.calculative.canvas.store.data.x + pos.x - elemRect.width / 2;\r\n    let y = pen.calculative.canvas.store.data.y + pos.y - elemRect.height;\r\n    if (!pen.type) {\r\n      x =\r\n        pen.calculative.canvas.store.data.x +\r\n        rect.x -\r\n        (elemRect.width - rect.width) / 2;\r\n      y =\r\n        pen.calculative.canvas.store.data.y +\r\n        rect.ey -\r\n        elemRect.height -\r\n        rect.height;\r\n    }\r\n\r\n    if (y > 0) {\r\n      this.arrowUp.style.borderBottomColor = 'transparent';\r\n      this.arrowDown.style.borderTopColor = '#777777';\r\n    } else {\r\n      y += elemRect.height + rect.height + 5;\r\n      this.arrowUp.style.borderBottomColor = '#777777';\r\n      this.arrowDown.style.borderTopColor = 'transparent';\r\n    }\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.box.style.left = this.x + 'px';\r\n    this.box.style.top = this.y + 'px';\r\n  }\r\n\r\n  hide() {\r\n    this.currentPen = null;\r\n    this.x = -9999;\r\n    this.box.style.left = '-9999px';\r\n  }\r\n\r\n  translate(x: number, y: number) {\r\n    if (this.x < -1000) {\r\n      return;\r\n    }\r\n    this.x += x;\r\n    this.y += y;\r\n    this.box.style.left = this.x + 'px';\r\n    this.box.style.top = this.y + 'px';\r\n  }\r\n\r\n  destroy() {\r\n    this.box.onmouseleave = null;\r\n  }\r\n}\r\n","import { Canvas } from '../canvas';\r\nimport { getRect, Rect } from '../rect';\r\n\r\nexport class Scroll {\r\n  h: HTMLElement;\r\n  v: HTMLElement;\r\n  isDownH: number;\r\n  isDownV: number;\r\n  x: number;\r\n  y: number;\r\n  hSize: number;\r\n  vSize: number;\r\n  scrollX: number;\r\n  scrollY: number;\r\n  lastScrollX: number;\r\n  lastScrollY: number;\r\n  rect: Rect;\r\n  isShow: boolean;\r\n  pageMode: boolean; //页面模式\r\n  constructor(public parent: Canvas) {\r\n    this.h = document.createElement('div');\r\n    this.v = document.createElement('div');\r\n\r\n    this.parent.externalElements.appendChild(this.h);\r\n    this.parent.externalElements.appendChild(this.v);\r\n\r\n    this.h.className = 'meta2d-scroll h';\r\n    this.h.onmousedown = this.onMouseDownH;\r\n\r\n    this.v.className = 'meta2d-scroll v';\r\n    this.v.onmousedown = this.onMouseDownV;\r\n\r\n    document.addEventListener('mousemove', this.onMouseMove);\r\n    document.addEventListener('mouseup', this.onMouseUp);\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le/scroll') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/scroll';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        '.meta2d-scroll{position:absolute;width:8px;height:200px;background:#dddddd;border-radius:10px;z-index:20;cursor:default;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-scroll:hover{background:#cccccc;cursor:pointer}'\r\n      );\r\n      sheet.insertRule('.meta2d-scroll.v{right:0;top:calc(50% - 100px);}');\r\n      sheet.insertRule(\r\n        '.meta2d-scroll.h{bottom:2px;left:calc(50% - 100px);width:200px;height:8px;}'\r\n      );\r\n    }\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.isShow = true;\r\n    this.resize();\r\n    this.initPos();\r\n  }\r\n\r\n  private onMouseDownH = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    this.isDownH = e.x;\r\n    this.x = this.parent.store.data.x || 0;\r\n    this.lastScrollX = this.scrollX;\r\n  };\r\n\r\n  private onMouseDownV = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    this.isDownV = e.y;\r\n    this.y = this.parent.store.data.y || 0;\r\n    this.lastScrollY = this.scrollY;\r\n  };\r\n\r\n  private onMouseMove = (e: MouseEvent) => {\r\n    if (this.isDownH) {\r\n      const x = e.x - this.isDownH;\r\n      this.scrollX = this.lastScrollX + x;\r\n      this.h.style.left = `${this.scrollX}px`;\r\n      this.parent.store.data.x =\r\n        this.x - (x * this.rect.width) / this.parent.parentElement.clientWidth;\r\n    }\r\n\r\n    if (this.isDownV) {\r\n      const y = e.y - this.isDownV;\r\n      if (this.pageMode && this.canMouseMove(y)) {\r\n        return;\r\n      }\r\n      this.scrollY = this.lastScrollY + y;\r\n      this.v.style.top = `${this.scrollY}px`;\r\n      this.parent.store.data.y =\r\n        this.y -\r\n        (y * this.rect.height) / this.parent.parentElement.clientHeight;\r\n    }\r\n\r\n    if (this.isDownH || this.isDownV) {\r\n      this.parent.onMovePens();\r\n      this.parent.canvasTemplate.init();\r\n      this.parent.canvasImage.init();\r\n      this.parent.canvasImageBottom.init();\r\n      this.parent.render();\r\n    }\r\n  };\r\n\r\n  private onMouseUp = (e: MouseEvent) => {\r\n    if (!this.isDownH && !this.isDownV) {\r\n      return;\r\n    }\r\n\r\n    this.isDownH = undefined;\r\n    this.isDownV = undefined;\r\n\r\n    if (this.scrollX < 20) {\r\n      this.scrollX = 20;\r\n      this.h.style.left = `${this.scrollX}px`;\r\n    } else if (\r\n      this.scrollX >\r\n      this.parent.parentElement.clientWidth - this.hSize - 20\r\n    ) {\r\n      this.scrollX = this.parent.parentElement.clientWidth - this.hSize - 20;\r\n      this.h.style.left = `${this.scrollX}px`;\r\n    }\r\n\r\n    if (this.scrollY < 20) {\r\n      this.scrollY = 20;\r\n      this.v.style.top = `${this.scrollY}px`;\r\n    } else if (\r\n      this.scrollY >\r\n      this.parent.parentElement.clientHeight - this.vSize - 20\r\n    ) {\r\n      this.scrollY = this.parent.parentElement.clientHeight - this.vSize - 20;\r\n      this.v.style.top = `${this.scrollY}px`;\r\n    }\r\n\r\n    this.resize();\r\n  };\r\n\r\n  canMouseMove(y: number) {\r\n    const rect = this.parent.parent.getRect();\r\n    if (y < 0 && rect.y + this.parent.store.data.y >= 0) {\r\n      return true;\r\n    }\r\n    if (y > 0 && rect.ey - this.parent.height + this.parent.store.data.y <= 0) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  changeMode() {\r\n    this.pageMode = true;\r\n    this.h.style.display = `none`;\r\n    const rect = this.parent.parent.getRect();\r\n    if (rect.height < this.parent.height) {\r\n      this.v.style.display = `none`;\r\n    }\r\n  }\r\n\r\n  initPos() {\r\n    this.scrollX = (this.parent.parentElement.clientWidth - this.hSize) / 2;\r\n    this.scrollY = (this.parent.parentElement.clientHeight - this.vSize) / 2;\r\n    this.h.style.left = `${this.scrollX}px`;\r\n    this.v.style.top = `${this.scrollY}px`;\r\n  }\r\n\r\n  resize() {\r\n    this.rect = getRect(this.parent.store.data.pens);\r\n    if (this.rect.width < 1400) {\r\n      this.rect.width = 1400;\r\n    }\r\n    if (this.rect.height < 900) {\r\n      this.rect.height = 900;\r\n    }\r\n\r\n    if (this.parent.store.data.x > 0) {\r\n      this.rect.width +=\r\n        this.parent.store.data.x + (this.rect.x > 0 ? 0 : this.rect.x);\r\n    } else {\r\n      this.rect.width -=\r\n        this.parent.store.data.x + (this.rect.x > 0 ? 0 : this.rect.x);\r\n    }\r\n\r\n    if (this.parent.store.data.y > 0) {\r\n      this.rect.height +=\r\n        this.parent.store.data.y + (this.rect.y > 0 ? 0 : this.rect.y);\r\n    } else {\r\n      this.rect.height -=\r\n        this.parent.store.data.y + (this.rect.y > 0 ? 0 : this.rect.y);\r\n    }\r\n\r\n    if (this.rect.width < 1400) {\r\n      this.rect.width = 1400;\r\n    }\r\n    if (this.rect.height < 900) {\r\n      this.rect.height = 900;\r\n    }\r\n\r\n    this.hSize =\r\n      (1000 * this.parent.parentElement.clientWidth) / this.rect.width / 3;\r\n    this.vSize =\r\n      (1000 * this.parent.parentElement.clientHeight) / this.rect.height / 3;\r\n    this.h.style.width = this.hSize + 'px';\r\n    this.v.style.height = this.vSize + 'px';\r\n  }\r\n\r\n  show() {\r\n    this.isShow = true;\r\n    this.h.style.display = `block`;\r\n    this.v.style.display = `block`;\r\n    document.addEventListener('mousemove', this.onMouseMove);\r\n    document.addEventListener('mouseup', this.onMouseUp);\r\n  }\r\n\r\n  hide() {\r\n    this.isShow = false;\r\n    this.h.style.display = `none`;\r\n    this.v.style.display = `none`;\r\n    this.destroy();\r\n  }\r\n\r\n  translate(x: number, y: number) {\r\n    if (x) {\r\n      this.scrollX -=\r\n        (x * this.parent.parentElement.clientWidth) / this.rect.width;\r\n      this.h.style.left = `${this.scrollX}px`;\r\n    }\r\n\r\n    if (y) {\r\n      this.scrollY -=\r\n        (y * this.parent.parentElement.clientHeight) / this.rect.height;\r\n      this.v.style.top = `${this.scrollY}px`;\r\n    }\r\n  }\r\n\r\n  wheel(up?: boolean) {\r\n    let y = 10;\r\n    if (up) {\r\n      y = -10;\r\n    }\r\n\r\n    if (this.pageMode && this.canMouseMove(y)) {\r\n      return;\r\n    }\r\n\r\n    this.scrollY += y;\r\n    this.v.style.top = `${this.scrollY}px`;\r\n    this.parent.store.data.y -=\r\n      (y * this.rect.height) / this.parent.parentElement.clientHeight;\r\n\r\n    this.parent.onMovePens();\r\n    this.parent.canvasTemplate.init();\r\n    this.parent.canvasImage.init();\r\n    this.parent.canvasImageBottom.init();\r\n    this.parent.render();\r\n  }\r\n\r\n  destroy() {\r\n    document.removeEventListener('mousemove', this.onMouseMove);\r\n    document.removeEventListener('mouseup', this.onMouseUp);\r\n  }\r\n}\r\n","import {\r\n  ctxFlip,\r\n  ctxRotate,\r\n  drawImage,\r\n  Pen,\r\n  setGlobalAlpha,\r\n  getParent,\r\n  CanvasLayer,\r\n} from '../pen';\r\nimport { Fit, Meta2dStore } from '../store';\r\nimport { rgba } from '../utils';\r\nimport { createOffscreen } from './offscreen';\r\n\r\nexport class CanvasImage {\r\n  canvas = document.createElement('canvas');\r\n  /**\r\n   * 非图片的绘制\r\n   * isBottom true 指背景颜色，背景网格\r\n   * isBottom false 指 标尺\r\n   */\r\n  otherOffsreen = createOffscreen(); // 非图片的\r\n  offscreen = createOffscreen();\r\n  animateOffsScreen = createOffscreen();\r\n  fitOffscreen = createOffscreen();\r\n  fitFlag = false; //开启自定义填充\r\n  currentFit:string;\r\n  activeFit: Fit;\r\n\r\n  constructor(\r\n    public parentElement: HTMLElement,\r\n    public store: Meta2dStore,\r\n    private isBottom?: boolean\r\n  ) {\r\n    parentElement.appendChild(this.canvas);\r\n    this.canvas.style.backgroundRepeat = 'no-repeat';\r\n    this.canvas.style.backgroundSize = '100% 100%';\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.top = '0';\r\n    this.canvas.style.left = '0';\r\n  }\r\n\r\n  resize(w?: number, h?: number) {\r\n    this.canvas.style.width = w + 'px';\r\n    this.canvas.style.height = h + 'px';\r\n\r\n    w = (w * this.store.dpiRatio) | 0;\r\n    h = (h * this.store.dpiRatio) | 0;\r\n\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.otherOffsreen.width = w;\r\n    this.otherOffsreen.height = h;\r\n\r\n    this.offscreen.width = w;\r\n    this.offscreen.height = h;\r\n\r\n    this.animateOffsScreen.width = w;\r\n    this.animateOffsScreen.height = h;\r\n\r\n    this.fitOffscreen.width = w;\r\n    this.fitOffscreen.height = h;\r\n\r\n    this.otherOffsreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.otherOffsreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.offscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.animateOffsScreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.animateOffsScreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.fitOffscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.fitOffscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.animateOffsScreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.fitOffscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    for (const pen of this.store.data.pens) {\r\n      if (this.hasImage(pen)) {\r\n        // 只影响本层的\r\n        pen.calculative.imageDrawed = false;\r\n      }\r\n    }\r\n    if(this.isBottom){\r\n      this.store.patchFlagsBackground = true;\r\n    }else{\r\n      this.store.patchFlagsTop = true;\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.otherOffsreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.otherOffsreen.width, this.otherOffsreen.height);\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.animateOffsScreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.fitOffscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.canvas\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n\r\n  hasImage(pen: Pen) {\r\n    pen.calculative.hasImage =\r\n      pen.calculative &&\r\n      pen.calculative.inView &&\r\n      // !pen.isBottom == !this.isBottom && // undefined == false 结果 false\r\n      ((this.isBottom && pen.canvasLayer === CanvasLayer.CanvasImageBottom) ||\r\n        (!this.isBottom && pen.canvasLayer === CanvasLayer.CanvasImage)) &&\r\n      pen.image &&\r\n      pen.calculative.img &&\r\n      pen.name !== 'gif';\r\n\r\n    return pen.calculative.hasImage;\r\n  }\r\n\r\n  render() {\r\n    let patchFlags = false;\r\n    let patchFlagsAnimate = false;\r\n    for (const pen of this.store.data.pens) {\r\n      if (this.hasImage(pen)) {\r\n        if (this.store.animates.has(pen)) {\r\n          patchFlagsAnimate = true;\r\n        } else if (!pen.calculative.imageDrawed) {\r\n          patchFlags = true;\r\n        }\r\n        if (pen.parentId && this.store.animates.has(getParent(pen, true))) {\r\n          patchFlagsAnimate = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    const patchFlagsBackground = this.store.patchFlagsBackground;\r\n    // if (patchFlagsBackground && this.isBottom) {\r\n    //   const ctx = this.otherOffsreen.getContext('2d');\r\n    //   ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    //   const width = this.store.data.width || this.store.options.width;\r\n    //   const height = this.store.data.height || this.store.options.height;\r\n    //   const x = this.store.data.x || this.store.options.x;\r\n    //   const y = this.store.data.y || this.store.options.y;\r\n    //   if (width && height && this.store.bkImg) {\r\n    //     ctx.save();\r\n    //     ctx.drawImage(\r\n    //       this.store.bkImg,\r\n    //       this.store.data.origin.x + x,\r\n    //       this.store.data.origin.y + y,\r\n    //       width * this.store.data.scale,\r\n    //       height * this.store.data.scale\r\n    //     );\r\n    //     ctx.restore();\r\n    //   }\r\n    //   const background =\r\n    //     this.store.data.background ||\r\n    //     (this.store.bkImg ? undefined : this.store.options.background);\r\n    //   if (background) {\r\n    //     ctx.save();\r\n    //     ctx.fillStyle = background;\r\n    //     if (width && height) {\r\n    //       ctx.fillRect(\r\n    //         this.store.data.origin.x + x,\r\n    //         this.store.data.origin.y + y,\r\n    //         width * this.store.data.scale,\r\n    //         height * this.store.data.scale\r\n    //       );\r\n    //     } else {\r\n    //       ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    //     }\r\n    //     ctx.restore();\r\n    //   }\r\n    //   this.renderGrid(ctx);\r\n    // }\r\n\r\n    const patchFlagsTop = this.store.patchFlagsTop;\r\n    if (patchFlagsTop && !this.isBottom) {\r\n      const ctx = this.otherOffsreen.getContext('2d');\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      this.renderRule(ctx);\r\n    }\r\n    // 从有图片画布层切换到无图片画布\r\n    const patchFlagsLast = this.store.patchFlagsLast;\r\n    if (patchFlagsLast) {\r\n      const ctx = this.offscreen.getContext('2d');\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n    if (patchFlags) {\r\n      const ctx = this.offscreen.getContext('2d');\r\n      ctx.save();\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      ctx.translate(this.store.data.x, this.store.data.y);\r\n      for (const pen of this.store.data.pens) {\r\n        //pen.calculative.imageDrawed  只用于判断是否需要重绘整块画布，不用于判断改图片节点是否绘制过\r\n        if (\r\n          !pen.calculative.hasImage ||\r\n          this.store.animates.has(pen) ||\r\n          this.store.animates.has(getParent(pen, true))\r\n        ) {\r\n          continue;\r\n        }\r\n        // if (pen.template) {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n          continue;\r\n        }\r\n        if (pen.name === 'combine' && !pen.draw){\r\n          continue;\r\n        }\r\n        pen.calculative.imageDrawed = true;\r\n        ctx.save();\r\n        ctxFlip(ctx, pen);\r\n        if (pen.calculative.rotate) {\r\n          ctxRotate(ctx, pen);\r\n        }\r\n\r\n        setGlobalAlpha(ctx, pen);\r\n        drawImage(ctx, pen);\r\n        ctx.restore();\r\n      }\r\n      ctx.restore();\r\n    }\r\n    if (patchFlagsAnimate) {\r\n      const ctx = this.animateOffsScreen.getContext('2d');\r\n      ctx.save();\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      ctx.translate(this.store.data.x, this.store.data.y);\r\n      for (const pen of this.store.animates) {\r\n        if (!pen.calculative.hasImage) {\r\n          continue;\r\n        }\r\n        // if (pen.template) {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n          continue;\r\n        }\r\n        pen.calculative.imageDrawed = true;\r\n        ctx.save();\r\n        ctxFlip(ctx, pen);\r\n        if (pen.calculative.rotate) {\r\n          ctxRotate(ctx, pen);\r\n        }\r\n\r\n        setGlobalAlpha(ctx, pen);\r\n        drawImage(ctx, pen);\r\n        ctx.restore();\r\n      }\r\n      //图片组合节点 动画\r\n      for (const pen of this.store.data.pens) {\r\n        if (!pen.calculative.hasImage || !pen.parentId) {\r\n          continue;\r\n        }\r\n        // if (pen.template) {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n          continue;\r\n        }\r\n        if (this.store.animates.has(getParent(pen, true))) {\r\n          pen.calculative.imageDrawed = true;\r\n          ctx.save();\r\n          ctxFlip(ctx, pen);\r\n          if (pen.calculative.rotate) {\r\n            ctxRotate(ctx, pen);\r\n          }\r\n\r\n          setGlobalAlpha(ctx, pen);\r\n          drawImage(ctx, pen);\r\n          ctx.restore();\r\n        }\r\n      }\r\n      ctx.restore();\r\n    }\r\n\r\n    if (!this.isBottom && !this.store.data.locked && this.fitFlag) {\r\n      const width =\r\n        (this.store.data.width || this.store.options.width) *\r\n        this.store.data.scale;\r\n      const height =\r\n        (this.store.data.height || this.store.options.height) *\r\n        this.store.data.scale;\r\n      const x =\r\n        this.store.data.origin.x + this.store.data.x ||\r\n        this.store.options.x ||\r\n        0;\r\n      const y =\r\n        this.store.data.origin.y + this.store.data.y ||\r\n        this.store.options.y ||\r\n        0;\r\n      const ctx = this.fitOffscreen.getContext('2d');\r\n      ctx.save();\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      ctx.fillStyle = '#ffffff66';\r\n      ctx.strokeStyle = this.store.options.activeColor;\r\n      this.store.data.fits?.forEach((item, index) => {\r\n        ctx.fillRect(\r\n          x + width * item.x,\r\n          y + height * item.y,\r\n          width * item.width,\r\n          height * item.height\r\n        );\r\n        if (item.active) {\r\n          ctx.strokeRect(\r\n            x + width * item.x,\r\n            y + height * item.y,\r\n            width * item.width,\r\n            height * item.height\r\n          );\r\n        }\r\n      });\r\n      ctx.restore();\r\n    }\r\n    if (\r\n      patchFlags ||\r\n      patchFlagsAnimate ||\r\n      (patchFlagsBackground && this.isBottom) ||\r\n      // this.isBottom ||\r\n      (patchFlagsTop && !this.isBottom)\r\n    ) {\r\n      const ctxCanvas = this.canvas.getContext('2d');\r\n      ctxCanvas.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      if (this.isBottom) {\r\n      //   ctxCanvas.drawImage(\r\n      //     this.otherOffsreen,\r\n      //     0,\r\n      //     0,\r\n      //     this.canvas.width,\r\n      //     this.canvas.height\r\n      //   );\r\n        this.store.patchFlagsBackground = false;\r\n      }\r\n      ctxCanvas.drawImage(\r\n        this.offscreen,\r\n        0,\r\n        0,\r\n        this.canvas.width,\r\n        this.canvas.height\r\n      );\r\n      ctxCanvas.drawImage(\r\n        this.animateOffsScreen,\r\n        0,\r\n        0,\r\n        this.canvas.width,\r\n        this.canvas.height\r\n      );\r\n      if (!this.isBottom) {\r\n        ctxCanvas.drawImage(\r\n          this.otherOffsreen,\r\n          0,\r\n          0,\r\n          this.canvas.width,\r\n          this.canvas.height\r\n        );\r\n        this.store.patchFlagsTop = false;\r\n        if (!this.store.data.locked && this.fitFlag) {\r\n          ctxCanvas.drawImage(\r\n            this.fitOffscreen,\r\n            0,\r\n            0,\r\n            this.canvas.width,\r\n            this.canvas.height\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // renderGrid(\r\n  //   ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D\r\n  // ) {\r\n  //   const { data, options } = this.store;\r\n  //   const { grid, gridRotate, gridColor, gridSize, scale } = data;\r\n  //   if (!(grid ?? options.grid)) {\r\n  //     // grid false 时不绘制, undefined 时看 options.grid\r\n  //     return;\r\n  //   }\r\n  //   ctx.save();\r\n  //   const { width, height } = this.canvas;\r\n  //   if (gridRotate) {\r\n  //     ctx.translate(width / 2, height / 2);\r\n  //     ctx.rotate((gridRotate * Math.PI) / 180);\r\n  //     ctx.translate(-width / 2, -height / 2);\r\n  //   }\r\n  //   ctx.lineWidth = 1;\r\n  //   ctx.strokeStyle = gridColor || options.gridColor;\r\n  //   ctx.beginPath();\r\n  //   const size = (gridSize || options.gridSize) * scale;\r\n  //   const longSide = Math.max(width, height);\r\n  //   const count = Math.ceil(longSide / size);\r\n  //   for (let i = -size * count; i < longSide * 2; i += size) {\r\n  //     ctx.moveTo(i, -longSide);\r\n  //     ctx.lineTo(i, longSide * 2);\r\n  //   }\r\n  //   for (let i = -size * count; i < longSide * 2; i += size) {\r\n  //     ctx.moveTo(-longSide, i);\r\n  //     ctx.lineTo(longSide * 2, i);\r\n  //   }\r\n  //   ctx.stroke();\r\n  //   ctx.restore();\r\n  // }\r\n\r\n  renderRule(\r\n    ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D\r\n  ) {\r\n    const { data, options } = this.store;\r\n    const { rule, ruleColor, scale, origin } = data;\r\n    if (!(rule ?? options.rule)) {\r\n      // rule false 时不绘制, undefined 时看 options.rule\r\n      return;\r\n    }\r\n\r\n    const span = scale * 10;\r\n\r\n    ctx.save();\r\n\r\n    const finalRuleColor = ruleColor || options.ruleColor;\r\n    ctx.strokeStyle = rgba(finalRuleColor, 0.7);\r\n\r\n    const x = origin.x + data.x;\r\n    const y = origin.y + data.y;\r\n    const { width, height } = this.canvas;\r\n    let h = options.ruleOptions?.height || 20;\r\n    if(options.ruleOptions?.background){\r\n      //背景颜色\r\n      ctx.beginPath();\r\n      ctx.fillStyle = options.ruleOptions?.background;\r\n      ctx.rect(0,0,width,h);\r\n      ctx.fill();\r\n      ctx.rect(0,0,h,height);\r\n      ctx.fill();\r\n    }\r\n    if(options.ruleOptions?.underline){\r\n      ctx.beginPath();\r\n      ctx.fillStyle = rgba(finalRuleColor, 0.7);\r\n      ctx.moveTo(0, h);\r\n      ctx.lineTo(width, h);\r\n      ctx.stroke();\r\n      ctx.moveTo(h, 0);\r\n      ctx.lineTo(h, height);\r\n      ctx.stroke();\r\n    }\r\n    let b_y = h/4;\r\n    if(options.ruleOptions?.baseline === \"bottom\"){\r\n      b_y = h*3/4;\r\n    }\r\n    // horizontal rule\r\n    ctx.beginPath();\r\n    ctx.lineWidth = h/2;\r\n    ctx.lineDashOffset = -x % span;\r\n    ctx.setLineDash([1, span - 1]);\r\n    ctx.moveTo(0, b_y);\r\n    ctx.lineTo(width, b_y);\r\n    ctx.stroke();\r\n\r\n    // vertical rule\r\n    ctx.beginPath();\r\n    ctx.lineDashOffset = -y % span;\r\n    ctx.moveTo(b_y, 0);\r\n    ctx.lineTo(b_y, height);\r\n    ctx.stroke();\r\n\r\n    // the big rule\r\n    ctx.strokeStyle = finalRuleColor;\r\n    ctx.beginPath();\r\n    ctx.lineWidth = h;\r\n    ctx.lineDashOffset = -x % (span * 10);\r\n    ctx.setLineDash([1, span * 10 - 1]);\r\n    ctx.moveTo(0, h/2);\r\n    ctx.lineTo(width, h/2);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.lineDashOffset = -y % (span * 10);\r\n    ctx.moveTo(h/2, 0);\r\n    ctx.lineTo(h/2, height);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.fillStyle = options.ruleOptions?.textColor|| ctx.strokeStyle;\r\n    let text: number = 0 - Math.floor(x / span / 10) * 100;\r\n    let textTop = options.ruleOptions?.textTop || 16;\r\n    let textLeft = options.ruleOptions?.textLeft || 4;\r\n    if (x < 0) {\r\n      text -= 100;\r\n    }\r\n    for (let i = x % (span * 10); i < width; i += 10 * span, text += 100) {\r\n      if (span < 3 && text % 500) {\r\n        continue;\r\n      }\r\n      ctx.fillText(text.toString(), i + textLeft, textTop);\r\n    }\r\n\r\n    text = 0 - Math.floor(y / span / 10) * 100;\r\n    if (y < 0) {\r\n      text -= 100;\r\n    }\r\n    for (let i = y % (span * 10); i < height; i += 10 * span, text += 100) {\r\n      if (span < 3 && text % 500) {\r\n        continue;\r\n      }\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      ctx.translate(textTop, i - textLeft);\r\n      ctx.rotate((270 * Math.PI) / 180);\r\n      ctx.fillText(text.toString(), 0, 0);\r\n      ctx.restore();\r\n    }\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Meta2dStore } from '../store';\r\nimport { Canvas } from './canvas';\r\nimport { createOffscreen } from './offscreen';\r\n\r\nexport class MagnifierCanvas {\r\n  canvas = document.createElement('canvas');\r\n  magnifierScreen = createOffscreen();\r\n  offscreen = createOffscreen();\r\n  domOffscreen = createOffscreen();\r\n  private magnifierSize: number = 300;\r\n  magnifier: boolean;\r\n\r\n  constructor(\r\n    public parentCanvas: Canvas,\r\n    public parentElement: HTMLElement,\r\n    public store: Meta2dStore\r\n  ) {\r\n    parentElement.appendChild(this.canvas);\r\n    this.canvas.style.backgroundRepeat = 'no-repeat';\r\n    this.canvas.style.backgroundSize = '100% 100%';\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.top = '0';\r\n    this.canvas.style.left = '0';\r\n  }\r\n\r\n  resize(w?: number, h?: number) {\r\n    this.canvas.style.width = w + 'px';\r\n    this.canvas.style.height = h + 'px';\r\n\r\n    w = (w * this.store.dpiRatio) | 0;\r\n    h = (h * this.store.dpiRatio) | 0;\r\n\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.offscreen.width = w;\r\n    this.offscreen.height = h;\r\n\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.offscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.domOffscreen.width = w;\r\n    this.domOffscreen.height = h;\r\n    this.domOffscreen.getContext('2d').scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.domOffscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.magnifierScreen.width = this.magnifierSize + 5;\r\n    this.magnifierScreen.height = this.magnifierSize + 5;\r\n  }\r\n\r\n  /**\r\n   * 绘制到 该画布的 离屏层\r\n   */\r\n  private renderMagnifier() {\r\n    if (!this.magnifier) {\r\n      return;\r\n    }\r\n\r\n    const r = this.magnifierSize / 2;\r\n    const size = this.magnifierSize + 5;\r\n\r\n    const ctx = this.magnifierScreen.getContext(\r\n      '2d'\r\n    ) as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, size, size);\r\n    ctx.lineWidth = 5;\r\n\r\n    ctx.save();\r\n    ctx.translate(2.5, 2.5);\r\n\r\n    ctx.save();\r\n    ctx.arc(r, r, r, 0, Math.PI * 2, false);\r\n    ctx.clip();\r\n    // ctx.fillStyle =\r\n    //   this.store.data.background || this.store.options.background || '#f4f4f4';\r\n    // ctx.fillRect(0, 0, size, size);\r\n    ctx.translate(-r, -r);\r\n    ctx.scale(2, 2);\r\n    const pt = {\r\n      x:\r\n        (this.parentCanvas.mousePos.x + this.store.data.x) *\r\n        this.store.dpiRatio,\r\n      y:\r\n        (this.parentCanvas.mousePos.y + this.store.data.y) *\r\n        this.store.dpiRatio,\r\n    };\r\n    const drawOffscreens = [\r\n      this.parentCanvas.canvasTemplate.bgOffscreen,\r\n      this.parentCanvas.canvasTemplate.offscreen,\r\n      this.parentCanvas.canvasImageBottom.offscreen,\r\n      this.parentCanvas.canvasImageBottom.animateOffsScreen,\r\n      this.parentCanvas.offscreen,\r\n      this.parentCanvas.canvasImage.offscreen,\r\n      this.parentCanvas.canvasImage.animateOffsScreen,\r\n      this.domOffscreen //dom元素的绘制层\r\n    ];\r\n    drawOffscreens.forEach((offscreen) => {\r\n      ctx.drawImage(\r\n        offscreen,\r\n        pt.x - r,\r\n        pt.y - r,\r\n        this.magnifierSize,\r\n        this.magnifierSize,\r\n        0,\r\n        0,\r\n        this.magnifierSize,\r\n        this.magnifierSize\r\n      );\r\n    });\r\n\r\n    ctx.restore();\r\n\r\n    ctx.beginPath();\r\n    const gradient = ctx.createRadialGradient(r, r, r - 5, r, r, r);\r\n    gradient.addColorStop(0, 'rgba(0,0,0,0.2)');\r\n    gradient.addColorStop(0.8, 'rgb(200,200,200)');\r\n    gradient.addColorStop(0.9, 'rgb(200,200,200)');\r\n    gradient.addColorStop(1.0, 'rgba(200,200,200,0.9)');\r\n    ctx.strokeStyle = gradient;\r\n    ctx.arc(r, r, r, 0, Math.PI * 2, false);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n\r\n    const offscreenCtx = this.offscreen.getContext('2d');\r\n    offscreenCtx.drawImage(\r\n      this.magnifierScreen,\r\n      0,\r\n      0,\r\n      this.magnifierSize + 5,\r\n      this.magnifierSize + 5,\r\n      (pt.x - r - 2.5) / this.store.dpiRatio,\r\n      (pt.y - r - 2.5) / this.store.dpiRatio,\r\n      (this.magnifierSize + 5) / this.store.dpiRatio,\r\n      (this.magnifierSize + 5) / this.store.dpiRatio\r\n    );\r\n  }\r\n\r\n  updateDomOffscreen(){\r\n    const domCtx =  this.domOffscreen.getContext('2d');\r\n    domCtx.clearRect(0, 0, this.domOffscreen.width, this.domOffscreen.height);\r\n    for (const pen of this.store.data.pens) {\r\n      if(pen.externElement||pen.name==='gif'){\r\n        if(pen.calculative.img){\r\n          domCtx.save();\r\n          domCtx.translate(this.store.data.x, this.store.data.y);\r\n          const { x, y, width, height } = pen.calculative.worldRect;\r\n          domCtx.drawImage(pen.calculative.img as HTMLImageElement, x, y, width, height);\r\n          domCtx.restore();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.renderMagnifier();\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    ctx.drawImage(this.offscreen, 0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","import { Meta2dStore } from '../store';\r\n\r\nexport function lockedError(store: Meta2dStore) {\r\n  if (store.data.locked) {\r\n    throw new Error('canvas is locked');\r\n  }\r\n}\r\n","export class Dialog {\r\n  box: HTMLElement;\r\n  iframe: HTMLElement;\r\n  dialog: HTMLElement;\r\n  close: HTMLElement;\r\n  title: HTMLElement;\r\n  body: HTMLElement;\r\n  x: number;\r\n  y: number;\r\n  url: string;\r\n  constructor(public parentElement: HTMLElement) {\r\n    this.box = document.createElement('div');\r\n    this.dialog = document.createElement('div');\r\n    let header = document.createElement('div');\r\n    this.title = document.createElement('div');\r\n    this.close = document.createElement('span');\r\n    this.close.innerHTML = `\r\n      <svg fill=\"none\" viewBox=\"0 0 16 16\" width=\"1em\" height=\"1em\">\r\n      <path\r\n        fill=\"currentColor\"\r\n        d=\"M8 8.92L11.08 12l.92-.92L8.92 8 12 4.92 11.08 4 8 7.08 4.92 4 4 4.92 7.08 8 4 11.08l.92.92L8 8.92z\"\r\n        fill-opacity=\"0.9\"\r\n      ></path>\r\n    </svg>`;\r\n    this.body = document.createElement('div');\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.setAttribute('frameborder', '0');\r\n    this.box.className = 'meta2d-dialog_mask';\r\n    this.dialog.className = 'meta2d-dialog';\r\n    this.body.className = 'meta2d-dialog_body';\r\n    header.className = 'meta2d-dialog_header';\r\n    this.title.className = 'meta2d-dialog-content';\r\n    this.close.className = 'meta2d-dialog-close';\r\n\r\n    header.appendChild(this.title);\r\n    header.appendChild(this.close);\r\n    this.body.appendChild(this.iframe);\r\n    this.dialog.appendChild(header);\r\n    this.dialog.appendChild(this.body);\r\n    this.box.appendChild(this.dialog);\r\n    parentElement.appendChild(this.box);\r\n\r\n    this.dialog.onclick = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n    this.box.onclick = () => {\r\n      this.hide();\r\n    };\r\n    this.close.onclick = () => {\r\n      this.hide();\r\n    };\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com/dialog') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/dialog';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        `.meta2d-dialog_mask {\r\n        display: none;\r\n        position: absolute;\r\n        top: 0%;\r\n        left: 0%;\r\n        width: 100%;\r\n        height: 100%;\r\n        background-color: #0000006f;\r\n        z-index: 9999;`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog_mask .meta2d-dialog {\r\n            position: absolute;\r\n            top: 15vh;\r\n            left: 10%;\r\n            width: 80%;\r\n            height:420px;\r\n            padding: 16px 20px;\r\n            border-radius: 9px;\r\n            background-color: #1e2430;\r\n            z-index: 19999;\r\n            overflow: auto;\r\n        }`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog_header {\r\n            display: flex;\r\n        }`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog-content {\r\n            width: calc(100% - 20px);\r\n            font-weight: 600;\r\n            font-size: 14px;\r\n            color: #bdc7db;\r\n            padding-bottom:8px;\r\n        }`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog-close {\r\n            width: 20px;\r\n            height: 20px;\r\n            line-height: 20px;\r\n            text-align: center;\r\n            color: #617b91;\r\n            position: absolute;\r\n            right:20px;\r\n            top:18px;\r\n        }`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog-close :hover{\r\n            cursor: pointer;\r\n        }`\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog_body{\r\n            // margin-top: 4px;\r\n        } `\r\n      );\r\n      sheet.insertRule(\r\n        `.meta2d-dialog_body iframe{\r\n            width: 100%;\r\n            height: 100%;\r\n        }`\r\n      );\r\n    }\r\n  }\r\n\r\n  show(title?: string, url?: string, rect?:{x:number,y:number,width:number,height:number}) {\r\n    if(!url){\r\n      return;\r\n    }\r\n    if(url !== this.url){\r\n      this.iframe.setAttribute('src', url);\r\n      this.url = url;\r\n    }\r\n    title && (this.title.innerText = title);\r\n    if(!title){\r\n      this.dialog.style.padding = '0px';\r\n      this.title.style.display = 'none';\r\n      this.body.style.height = '100%';\r\n      this.body.style.overflow= 'hidden';\r\n    }else{\r\n      this.dialog.style.padding = '16px 20px';\r\n      this.title.style.display = 'block';\r\n      this.body.style.height = 'calc(100% - 26px)';\r\n    }\r\n    if(rect) {\r\n      this.dialog.style.width = rect.width?(rect.width + 'px'): '80%'\r\n      this.dialog.style.height = rect.height?(rect.height + 'px'): '420px';\r\n      this.dialog.style.top = rect.y?(rect.y + 'px'): '15vh';\r\n      this.dialog.style.left = rect.x? (rect.x + 'px'): `calc( 50% - ${rect.width? rect.width/2+'px': '40%'} )`;\r\n    }\r\n    this.box.style.display = 'block';\r\n  }\r\n\r\n  hide() {\r\n    this.box.style.display = 'none';\r\n  }\r\n\r\n  destroy() {\r\n    this.dialog.onclick = undefined;\r\n    this.box.onclick = undefined;\r\n    this.close.onclick = undefined;\r\n  }\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\n\r\nexport class Title {\r\n  box: HTMLElement;\r\n  private currentAnchor: Point; // 本次 tooltip 在哪个画笔上\r\n  constructor(public parentElement: HTMLElement) {\r\n    this.box = document.createElement('div');\r\n    this.box.className = 'meta2d-title';\r\n\r\n    parentElement.appendChild(this.box);\r\n\r\n    // this.box.onmouseleave = () => {\r\n    //   this.hide();\r\n    // };\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com/title') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/title';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        '.meta2d-title{position:absolute;padding:0;z-index:10;left: -9999px;top: -9999px;background:#fff;color:#000; cursor: crosshair;border: 1px solid black;}'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns 此次应该展示的 title\r\n   */\r\n  private static getTitle(anchor: Point) {\r\n    // if (anchor.titleFnJs && !anchor.titleFn) {\r\n    //   try {\r\n    //     anchor.titleFn = new Function('anchor', anchor.titleFnJs) as (\r\n    //       anchor: Point\r\n    //     ) => string;\r\n    //   } catch (error) {\r\n    //     console.log('titleFnJs', error);\r\n    //   }\r\n    // }\r\n    // return anchor.titleFn ? anchor.titleFn(anchor) : String(anchor.title);\r\n  }\r\n\r\n  /**\r\n   * @returns 返回设置前的 rect\r\n   */\r\n  private setText(anchor: Point) {\r\n    // this.box.title = anchor.title;\r\n    this.box.innerText = anchor.title;\r\n  }\r\n\r\n  /**\r\n   * 更新文字\r\n   */\r\n  updateText(anchor: Point) {\r\n    if (this.currentAnchor?.id !== anchor.id) {\r\n      return;\r\n    }\r\n    if (Title.titleEmpty(anchor)) {\r\n      return;\r\n    }\r\n\r\n    this.setText(anchor);\r\n    this.changePositionByAnchor(anchor);\r\n  }\r\n\r\n  /**\r\n   * 改变文字会 影响 box 的大小，需要重新设置位置\r\n   * @param oldRect 原\r\n   * @param newRect 新\r\n   */\r\n  private changePositionByAnchor(anchor: Point) {\r\n    this.box.style.left = anchor.x + 10 + 'px';\r\n    this.box.style.top = anchor.y + 10 + 'px';\r\n  }\r\n\r\n  private static titleEmpty(anchor: Point) {\r\n    return !anchor.title; // && !anchor.titleFn && !anchor.titleFnJs;\r\n  }\r\n\r\n  show(anchor: Point, pen: Pen) {\r\n    if (Title.titleEmpty(anchor)) {\r\n      return;\r\n    }\r\n    this.currentAnchor = anchor;\r\n    this.setText(anchor);\r\n    let pos = {\r\n      x: pen.calculative.canvas.store.data.x + anchor.x,\r\n      y: pen.calculative.canvas.store.data.y + anchor.y,\r\n    };\r\n    this.changePositionByAnchor(pos);\r\n  }\r\n\r\n  hide() {\r\n    this.box.style.left = '-9999px';\r\n    this.box.innerText = '';\r\n    this.currentAnchor = null;\r\n  }\r\n\r\n  destroy() {\r\n    this.box.onmouseleave = null;\r\n  }\r\n}\r\n","import {\r\n  ctxFlip,\r\n  ctxRotate,\r\n  drawImage,\r\n  Pen,\r\n  setGlobalAlpha,\r\n  getParent,\r\n  renderPen,\r\n  CanvasLayer,\r\n} from '../pen';\r\nimport { Meta2dStore } from '../store';\r\nimport { rgba } from '../utils';\r\nimport { createOffscreen } from './offscreen';\r\n\r\nexport class CanvasTemplate {\r\n  canvas = document.createElement('canvas');\r\n  offscreen = createOffscreen();\r\n  bgOffscreen = createOffscreen();\r\n  patchFlags: boolean;\r\n  bgPatchFlags: boolean;\r\n  constructor(public parentElement: HTMLElement, public store: Meta2dStore) {\r\n    parentElement.appendChild(this.canvas);\r\n    this.canvas.style.backgroundRepeat = 'no-repeat';\r\n    this.canvas.style.backgroundSize = '100% 100%';\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.top = '0';\r\n    this.canvas.style.left = '0';\r\n  }\r\n\r\n  resize(w?: number, h?: number) {\r\n    this.canvas.style.width = w + 'px';\r\n    this.canvas.style.height = h + 'px';\r\n\r\n    w = (w * this.store.dpiRatio) | 0;\r\n    h = (h * this.store.dpiRatio) | 0;\r\n\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.bgOffscreen.width = w;\r\n    this.bgOffscreen.height = h;\r\n\r\n    this.offscreen.width = w;\r\n    this.offscreen.height = h;\r\n\r\n    this.bgOffscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.bgOffscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.offscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.bgOffscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.patchFlags = true;\r\n    this.bgPatchFlags = true;\r\n\r\n    // for (const pen of this.store.data.pens) {\r\n    //   if (this.hasImage(pen)) {\r\n    //     // 只影响本层的\r\n    //     pen.calculative.imageDrawed = false;\r\n    //   }\r\n    // }\r\n    // this.store.patchFlagsBackground = true;\r\n    // this.store.patchFlagsTop = true;\r\n  }\r\n\r\n  hidden() {\r\n    this.canvas.style.display = 'none';\r\n  }\r\n\r\n  show() {\r\n    this.canvas.style.display = 'block';\r\n  }\r\n\r\n  clear() {\r\n    this.bgOffscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.canvas\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.bgPatchFlags = true;\r\n    this.patchFlags = true;\r\n  }\r\n\r\n  render() {\r\n    if (this.bgPatchFlags) {\r\n      const ctx = this.bgOffscreen.getContext('2d');\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      const width = this.store.data.width || this.store.options.width;\r\n      const height = this.store.data.height || this.store.options.height;\r\n      const x = this.store.data.x || this.store.options.x || 0;\r\n      const y = this.store.data.y || this.store.options.y || 0;\r\n      const background =\r\n        this.store.data.background || this.store.options.background;\r\n      if (background) {\r\n        ctx.save();\r\n        ctx.fillStyle = background;\r\n        ctx.globalAlpha = this.store.data.globalAlpha ?? this.store.options.globalAlpha;\r\n        if (width && height) {\r\n          ctx.shadowOffsetX = this.store.options.shadowOffsetX;\r\n          ctx.shadowOffsetY = this.store.options.shadowOffsetY;\r\n          ctx.shadowBlur = this.store.options.shadowBlur;\r\n          ctx.shadowColor = this.store.options.shadowColor;\r\n          ctx.fillRect(\r\n            this.store.data.origin.x + x,\r\n            this.store.data.origin.y + y,\r\n            width * this.store.data.scale,\r\n            height * this.store.data.scale\r\n          );\r\n        } else {\r\n          ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n        ctx.restore();\r\n      }\r\n      if (width && height && this.store.bkImg) {\r\n        ctx.save();\r\n        ctx.drawImage(\r\n          this.store.bkImg,\r\n          this.store.data.origin.x + x,\r\n          this.store.data.origin.y + y,\r\n          width * this.store.data.scale,\r\n          height * this.store.data.scale\r\n        );\r\n        ctx.restore();\r\n      }\r\n      this.renderGrid(ctx);\r\n    }\r\n    if (this.patchFlags) {\r\n      const ctx = this.offscreen.getContext('2d') as CanvasRenderingContext2D;\r\n      ctx.save();\r\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      ctx.translate(this.store.data.x, this.store.data.y);\r\n      for (const pen of this.store.data.pens) {\r\n        if (!isFinite(pen.x)) {\r\n          continue;\r\n        }\r\n        if (\r\n          // pen.template \r\n          pen.canvasLayer===CanvasLayer.CanvasTemplate\r\n          && pen.calculative.inView) {\r\n          if (pen.name === 'combine' && !pen.draw){\r\n            continue;\r\n          }\r\n          //非图片\r\n          renderPen(ctx, pen);\r\n          //图片\r\n          if (pen.image && pen.name !== 'gif' && pen.calculative.img) {\r\n            ctx.save();\r\n            ctxFlip(ctx, pen);\r\n            if (pen.calculative.rotate) {\r\n              ctxRotate(ctx, pen);\r\n            }\r\n\r\n            setGlobalAlpha(ctx, pen);\r\n            drawImage(ctx, pen);\r\n            ctx.restore();\r\n          }\r\n        }\r\n      }\r\n      ctx.restore();\r\n    }\r\n\r\n    if (this.patchFlags || this.bgPatchFlags) {\r\n      const ctxCanvas = this.canvas.getContext('2d');\r\n      ctxCanvas.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      ctxCanvas.drawImage(\r\n        this.bgOffscreen,\r\n        0,\r\n        0,\r\n        this.canvas.width,\r\n        this.canvas.height\r\n      );\r\n      ctxCanvas.drawImage(\r\n        this.offscreen,\r\n        0,\r\n        0,\r\n        this.canvas.width,\r\n        this.canvas.height\r\n      );\r\n      this.patchFlags = false;\r\n      this.bgPatchFlags = false;\r\n    }\r\n  }\r\n\r\n  renderGrid(\r\n    ctx: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D\r\n  ) {\r\n    const { data, options } = this.store;\r\n    const { grid, gridRotate, gridColor, gridSize, scale, origin } = data;\r\n    if (!(grid ?? options.grid)) {\r\n      // grid false 时不绘制, undefined 时看 options.grid\r\n      return;\r\n    }\r\n    ctx.save();\r\n    const width = (data.width || options.width) * scale;\r\n    const height = (data.height || options.height) * scale;\r\n    const startX = (data.x || options.x || 0) + origin.x;\r\n    const startY = (data.y || options.y || 0) + origin.y;\r\n    if (gridRotate) {\r\n      ctx.translate(width / 2, height / 2);\r\n      ctx.rotate((gridRotate * Math.PI) / 180);\r\n      ctx.translate(-width / 2, -height / 2);\r\n    }\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = gridColor || options.gridColor;\r\n    ctx.beginPath();\r\n    let size = (gridSize || options.gridSize) * scale;\r\n    size = size < 0 ? 0 : size;\r\n    if (!width || !height) {\r\n      const ratio = this.store.dpiRatio;\r\n      const cW = this.canvas.width / ratio;\r\n      const cH = this.canvas.height / ratio;\r\n      const m = startX / size;\r\n      const n = startY / size;\r\n      const offset = size * 10; //补偿值\r\n      const newX = startX - Math.ceil(m) * size;\r\n      const newY = startY - Math.ceil(n) * size;\r\n      const endX = cW + newX + offset;\r\n      const endY = cH + newY + offset;\r\n      for (let i = newX; i <= endX; i += size) {\r\n        ctx.moveTo(i, newY);\r\n        ctx.lineTo(i, cH + newY + offset);\r\n      }\r\n      for (let i = newY; i <= endY; i += size) {\r\n        ctx.moveTo(newX, i);\r\n        ctx.lineTo(cW + newX + offset, i);\r\n      }\r\n    } else {\r\n      const endX = width + startX;\r\n      const endY = height + startY;\r\n      for (let i = startX; i <= endX; i += size) {\r\n        ctx.moveTo(i, startY);\r\n        ctx.lineTo(i, height + startY);\r\n      }\r\n      for (let i = startY; i <= endY; i += size) {\r\n        ctx.moveTo(startX, i);\r\n        ctx.lineTo(width + startX, i);\r\n      }\r\n    }\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Pen } from '../pen';\r\nimport { Point } from '../point';\r\nimport { Meta2dStore } from '../store';\r\n\r\nconst status = {\r\n  'success':{\r\n\r\n  },\r\n  'info':{\r\n    icon:'<svg fill=\"none\" viewBox=\"0 0 24 24\"><path fill=\"#0052d9\" d=\"M12 23a11 11 0 100-22 11 11 0 000 22zM11 8.5v-2h2v2h-2zm2 1.5v7.5h-2V10h2z\"></path></svg>',\r\n  }, \r\n  'warning':{\r\n\r\n  }, \r\n  'error':{\r\n\r\n  }\r\n};\r\n\r\nexport class Popconfirm {\r\n  box: HTMLElement;\r\n  text: HTMLElement;\r\n  arrowUp: HTMLElement;\r\n  arrowDown: HTMLElement;\r\n  icon: HTMLElement;\r\n  confirm: HTMLElement;\r\n  cancel: HTMLElement;\r\n  x: number;\r\n  y: number;\r\n  constructor(public parentElement: HTMLElement, private store: Meta2dStore) {\r\n    this.box = document.createElement('div');\r\n    this.text = document.createElement('div');\r\n    this.arrowUp = document.createElement('div');\r\n    this.arrowDown = document.createElement('div');\r\n    this.icon = document.createElement('div');\r\n    this.confirm = document.createElement('button');\r\n    this.cancel = document.createElement('button');\r\n\r\n    this.box.className = 'meta2d-popconfirm';\r\n    this.text.className = 'text';\r\n    this.arrowUp.className = 'arrow';\r\n    this.arrowDown.className = 'arrow down';\r\n    this.icon.className = 'icon';\r\n    this.confirm.className = 'confirm';\r\n    this.cancel.className = 'cancel';\r\n\r\n    this.confirm.innerHTML = '确定';\r\n    this.cancel.innerHTML = '取消';\r\n    this.icon.innerHTML = status.info.icon;\r\n    this.box.appendChild(this.text);\r\n    this.box.appendChild(this.arrowUp);\r\n    this.box.appendChild(this.arrowDown);\r\n    this.box.appendChild(this.confirm);\r\n    this.box.appendChild(this.cancel);\r\n    this.box.appendChild(this.icon);\r\n\r\n    parentElement.appendChild(this.box);\r\n\r\n    // this.box.onmouseleave = () => {\r\n    //   this.hide();\r\n    //   this.store.lastHover = undefined;\r\n    // };\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com/popconfirm') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/popconfirm';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm{position:absolute;z-index:999;left: -9999px;top: -9999px;padding:16px;max-width:400px;background:#fff;border-radius:6px;box-shadow:0 3px 14px 2px rgba(0, 0, 0, .05),0 8px 10px 1px rgba(0, 0, 0, 6%),0 5px 5px -3px rgba(0, 0, 0, 10%);}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .text{outline:none;padding:0px 0px 40px 28px;border-radius:4px;color:rgba(0, 0, 0, 0.9);overflow-y:auto;line-height:22px;font-size:13px;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .arrow{position:absolute;border:10px solid transparent;background:transparent;top:-18px;left:50%;transform:translateX(-50%)}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .arrow.down{top:initial;bottom: -18px;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .icon{position:absolute;width:22px;height:22px;left:16px;top:16px;}'\r\n      )\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .confirm{position:absolute;right:16px;bottom:16px;width:40px;height:24px;text-align:center;background:#4582e6;color:#fff;border-radius:3px;border-color:transparent}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .confirm:hover{background:#003cab;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .cancel{position:absolute;right:64px;bottom:16px;width:40px;height:24px;text-align:center;background:#dcdcdc;color:rgba(0, 0, 0, 0.9);border-radius:3px;border-color:transparent}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-popconfirm .cancel:hover{background:#a6a6a6;}'\r\n      );\r\n    }\r\n  }\r\n\r\n  show(pen: Pen, pos: Point) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    const elemRect = this.box.getBoundingClientRect();\r\n    const rect = pen.calculative.worldRect;\r\n    let x = pen.calculative.canvas.store.data.x + pos.x - elemRect.width / 2;\r\n    let y = pen.calculative.canvas.store.data.y + pos.y - elemRect.height-20;\r\n    if (!pen.type) {\r\n      x =\r\n        pen.calculative.canvas.store.data.x +\r\n        rect.x -\r\n        (elemRect.width - rect.width) / 2;\r\n      y =\r\n        pen.calculative.canvas.store.data.y +\r\n        rect.ey -\r\n        elemRect.height -\r\n        rect.height;\r\n    }\r\n\r\n    if (y > 0) {\r\n      this.arrowUp.style.borderBottomColor = 'transparent';\r\n      this.arrowDown.style.borderTopColor = '#fff';\r\n      y-=10;\r\n    } else {\r\n      y += elemRect.height + rect.height + 5;\r\n      y+=10;\r\n      this.arrowUp.style.borderBottomColor = '#fff';\r\n      this.arrowDown.style.borderTopColor = 'transparent';\r\n    }\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.box.style.left = this.x + 'px';\r\n    this.box.style.top = this.y + 'px';\r\n  }\r\n\r\n  hide() {\r\n    this.x = -9999;\r\n    this.box.style.left = '-9999px';\r\n  }\r\n\r\n  showModal(pen: Pen,pos:Point,title?:string): Promise<boolean> {\r\n    return new Promise<boolean>((resolve) => {\r\n      this.text.innerHTML = title || '确认执行操作吗？';\r\n      this.show(pen,pos);\r\n      this.confirm.onclick = () => {\r\n        resolve(true);\r\n        this.hide();\r\n      };\r\n      this.cancel.onclick = () => {\r\n        resolve(false);\r\n        this.hide();\r\n      };\r\n    })\r\n  }\r\n\r\n  destroy() {\r\n    this.box = null;\r\n  }\r\n}\r\n","import { KeydownType } from '../options';\r\nimport {\r\n  addLineAnchor,\r\n  calcIconRect,\r\n  calcTextRect,\r\n  calcWorldAnchors,\r\n  calcWorldRects,\r\n  LockState,\r\n  nearestAnchor,\r\n  PenType,\r\n  pushPenAnchor,\r\n  removePenAnchor,\r\n  renderPen,\r\n  scalePen,\r\n  Pen,\r\n  translateLine,\r\n  deleteTempAnchor,\r\n  connectLine,\r\n  disconnectLine,\r\n  getAnchor,\r\n  calcAnchorDock,\r\n  calcMoveDock,\r\n  calcTextLines,\r\n  setNodeAnimate,\r\n  setLineAnimate,\r\n  calcPenRect,\r\n  setChildrenActive,\r\n  getParent,\r\n  setHover,\r\n  randomId,\r\n  getPensLock,\r\n  getToAnchor,\r\n  getFromAnchor,\r\n  calcPadding,\r\n  getPensDisableRotate,\r\n  getPensDisableResize,\r\n  needCalcTextRectProps,\r\n  calcResizeDock,\r\n  needPatchFlagsPenRectProps,\r\n  needCalcIconRectProps,\r\n  isDomShapes,\r\n  renderPenRaw,\r\n  needSetPenProps,\r\n  getAllChildren,\r\n  calcInView,\r\n  isShowChild,\r\n  ConnectLine,\r\n  IValue,\r\n  getTextColor,\r\n  getGlobalColor,\r\n  clearLifeCycle,\r\n  rotatePen,\r\n  calcTextAutoWidth,\r\n  getGradientAnimatePath,\r\n  CanvasLayer,\r\n  ctxFlip,\r\n  ctxRotate,\r\n  setGlobalAlpha,\r\n  drawImage,\r\n  setElemPosition,\r\n  getAllFollowers,\r\n  calcChildrenInitRect,\r\n} from '../pen';\r\nimport {\r\n  calcRotate,\r\n  distance,\r\n  getDistance,\r\n  hitPoint,\r\n  Point,\r\n  PointType,\r\n  PrevNextType,\r\n  rotatePoint,\r\n  samePoint,\r\n  scalePoint,\r\n  translatePoint,\r\n  TwoWay,\r\n} from '../point';\r\nimport {\r\n  calcCenter,\r\n  calcRightBottom,\r\n  calcRelativePoint,\r\n  getRect,\r\n  getRectOfPoints,\r\n  pointInRect,\r\n  pointInSimpleRect,\r\n  Rect,\r\n  rectInRect,\r\n  rectToPoints,\r\n  resizeRect,\r\n  translateRect,\r\n  pointInPolygon\r\n} from '../rect';\r\nimport {\r\n  EditAction,\r\n  EditType,\r\n  Fit,\r\n  globalStore,\r\n  Meta2dClipboard,\r\n  Meta2dStore,\r\n} from '../store';\r\nimport {\r\n  deepClone,\r\n  fileToBase64,\r\n  uploadFile,\r\n  formatPadding,\r\n  Padding,\r\n  rgba,\r\n  s8,\r\n} from '../utils';\r\nimport {\r\n  inheritanceProps,\r\n  defaultCursors,\r\n  defaultDrawLineFns,\r\n  HotkeyType,\r\n  HoverType,\r\n  MouseRight,\r\n  rotatedCursors,\r\n} from '../data';\r\nimport { createOffscreen } from './offscreen';\r\nimport {\r\n  curve,\r\n  mind,\r\n  getLineLength,\r\n  getLineRect,\r\n  pointInLine,\r\n  simplify,\r\n  smoothLine,\r\n  lineSegment,\r\n  getLineR,\r\n  lineInRect,\r\n} from '../diagrams';\r\nimport { polyline, translatePolylineAnchor } from '../diagrams/line/polyline';\r\nimport { Tooltip } from '../tooltip';\r\nimport { Scroll } from '../scroll';\r\nimport { CanvasImage } from './canvasImage';\r\nimport { MagnifierCanvas } from './magnifierCanvas';\r\nimport { lockedError } from '../utils/error';\r\nimport { Meta2d } from '../core';\r\nimport { Dialog } from '../dialog';\r\nimport { setter } from '../utils/object';\r\nimport { Title } from '../title';\r\nimport { CanvasTemplate } from './canvasTemplate';\r\nimport { getLinePoints } from '../diagrams/line';\r\nimport { Popconfirm } from '../popconfirm';\r\n\r\nexport const movingSuffix = '-moving' as const;\r\nexport class Canvas {\r\n  canvas = document.createElement('canvas');\r\n  offscreen = createOffscreen() as HTMLCanvasElement;\r\n\r\n  width: number;\r\n  height: number;\r\n\r\n  externalElements = document.createElement('div');\r\n  clientRect?: DOMRect;\r\n  canvasRect: Rect;\r\n\r\n  activeRect: Rect;\r\n  initActiveRect: Rect;\r\n  dragRect: Rect;\r\n  lastRotate = 0;\r\n  sizeCPs: Point[];\r\n  activeInitPos: Point[];\r\n\r\n  hoverType = HoverType.None;\r\n  resizeIndex = 0;\r\n  mouseDown: { x: number; y: number; restore?: boolean };\r\n  hotkeyType: HotkeyType;\r\n  mouseRight: MouseRight;\r\n  addCaches: Pen[];\r\n  touchCenter?: Point;\r\n  initTouchDis?: number;\r\n  initScale?: number;\r\n  touchScaling?: boolean;\r\n  touchMoving?: boolean;\r\n  startTouches?: TouchList;\r\n\r\n  lastOffsetX = 0;\r\n  lastOffsetY = 0;\r\n\r\n  drawingLineName?: string;\r\n  drawLineFns: string[] = [...defaultDrawLineFns];\r\n  drawingLine?: Pen;\r\n\r\n  pencil?: boolean;\r\n  pencilLine?: Pen;\r\n\r\n  movingPens: Pen[];\r\n\r\n  patchFlagsLines?: Set<Pen> = new Set();\r\n  dock: { xDock: Point; yDock: Point };\r\n\r\n  prevAnchor: Point;\r\n  nextAnchor: Point;\r\n\r\n  private lastMouseTime = 0;\r\n  private hoverTimer: number = 0;\r\n  private fitTimer: number = 0;\r\n  // 即将取消活动状态的画笔，用于Ctrl选中/取消选中画笔\r\n  private willInactivePen: Pen;\r\n\r\n  patchFlags = false;\r\n  lastRender = 0;\r\n  touchStart = 0;\r\n  touchStartTimer: any;\r\n  timer: any;\r\n\r\n  private lastAnimateRender = 0;\r\n  animateRendering = false;\r\n  renderTimer: number;\r\n\r\n  initPens?: Pen[];\r\n\r\n  pointSize = 8 as const;\r\n  pasteOffset: boolean = true;\r\n  opening: boolean = false;\r\n  maxZindex: number = 5;\r\n  canMoveLine: boolean = false; //moveConnectedLine=false\r\n  randomIdObj: object; //记录拖拽前后id变化\r\n  keyOptions?:{\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n    ctrlKey?:boolean;\r\n    metaKey?:boolean;\r\n  }\r\n  /**\r\n   * @deprecated 改用 beforeAddPens\r\n   */\r\n  beforeAddPen: (pen: Pen) => boolean;\r\n  beforeAddPens: (pens: Pen[]) => Promise<boolean>;\r\n  beforeAddAnchor: (pen: Pen, anchor: Point) => Promise<boolean>;\r\n  beforeRemovePens: (pens: Pen[]) => Promise<boolean>;\r\n  beforeRemoveAnchor: (pen: Pen, anchor: Point) => Promise<boolean>;\r\n\r\n  customResizeDock: (\r\n    store: Meta2dStore,\r\n    rect: Rect,\r\n    pens: Pen[],\r\n    resizeIndex: number\r\n  ) => { xDock: Point; yDock: Point };\r\n  customMoveDock: (\r\n    store: Meta2dStore,\r\n    rect: Rect,\r\n    pens: Pen[],\r\n    offset: Point\r\n  ) => { xDock: Point; yDock: Point };\r\n\r\n  inputParent = document.createElement('div');\r\n  // input = document.createElement('textarea');\r\n  inputDiv = document.createElement('div');\r\n  // inputRight = document.createElement('div');\r\n  dropdown = document.createElement('ul');\r\n\r\n  tooltip: Tooltip;\r\n  popconfirm: Popconfirm;\r\n  title: Title;\r\n  mousePos: Point = { x: 0, y: 0 };\r\n\r\n  scroll: Scroll;\r\n  movingAnchor: Point; // 正在移动中的瞄点\r\n\r\n  canvasTemplate: CanvasTemplate;\r\n  canvasImage: CanvasImage;\r\n  canvasImageBottom: CanvasImage;\r\n  magnifierCanvas: MagnifierCanvas;\r\n  dialog: Dialog;\r\n  autoPolylineFlag: boolean = false; //标记open不自动计算\r\n\r\n  stopPropagation = (e: MouseEvent) => {\r\n    e.stopPropagation();\r\n  };\r\n\r\n  constructor(\r\n    public parent: Meta2d,\r\n    public parentElement: HTMLElement,\r\n    public store: Meta2dStore\r\n  ) {\r\n    this.canvasTemplate = new CanvasTemplate(parentElement, store);\r\n    this.canvasTemplate.canvas.style.zIndex = '1';\r\n    this.canvasImageBottom = new CanvasImage(parentElement, store, true);\r\n    this.canvasImageBottom.canvas.style.zIndex = '2';\r\n\r\n    parentElement.appendChild(this.canvas);\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.backgroundRepeat = 'no-repeat';\r\n    this.canvas.style.backgroundSize = '100% 100%';\r\n    this.canvas.style.zIndex = '3';\r\n\r\n    this.canvasImage = new CanvasImage(parentElement, store);\r\n    this.canvasImage.canvas.style.zIndex = '4';\r\n\r\n    this.magnifierCanvas = new MagnifierCanvas(this, parentElement, store);\r\n    this.magnifierCanvas.canvas.style.zIndex = '5'; \r\n\r\n    this.externalElements.style.position = 'absolute';\r\n    this.externalElements.style.left = '0';\r\n    this.externalElements.style.top = '0';\r\n    this.externalElements.style.outline = 'none';\r\n    this.externalElements.style.background = 'transparent';\r\n    this.externalElements.style.zIndex = '5';\r\n    parentElement.style.position = 'relative';\r\n    parentElement.appendChild(this.externalElements);\r\n    this.createInput();\r\n\r\n    this.tooltip = new Tooltip(parentElement, store);\r\n    this.tooltip.box.onmouseleave = (e) => {\r\n      this.patchFlags = true;\r\n      this.store.lastHover && (this.store.lastHover.calculative.hover = false);\r\n      let hover = this.store.data.pens.find(\r\n        (item) => item.calculative.hover === true\r\n      );\r\n      setHover(hover, false);\r\n    };\r\n    this.popconfirm = new Popconfirm(parentElement, store);\r\n\r\n    this.dialog = new Dialog(parentElement);\r\n    this.title = new Title(parentElement);\r\n\r\n    if (this.store.options.scroll) {\r\n      this.scroll = new Scroll(this);\r\n    }\r\n\r\n    this.store.dpiRatio = globalThis.devicePixelRatio || 1;\r\n\r\n    if (this.store.dpiRatio < 1) {\r\n      this.store.dpiRatio = 1;\r\n    } else if (this.store.dpiRatio > 1 && this.store.dpiRatio < 1.5) {\r\n      this.store.dpiRatio = 1.5;\r\n    }\r\n\r\n    this.clientRect = this.externalElements.getBoundingClientRect();\r\n    this.listen();\r\n\r\n    window?.addEventListener('resize', this.onResize);\r\n    window?.addEventListener('scroll', this.onScroll);\r\n    window?.addEventListener('message', this.onMessage);\r\n  }\r\n\r\n  curve = curve;\r\n  polyline = polyline;\r\n  mind = mind;\r\n  line = lineSegment;\r\n\r\n  listen() {\r\n    // ios\r\n    this.externalElements.addEventListener('gesturestart', this.onGesturestart);\r\n\r\n    this.externalElements.ondragover = (e) => e.preventDefault();\r\n    this.externalElements.ondrop = this.ondrop;\r\n    this.externalElements.oncontextmenu = (e) => e.preventDefault();\r\n    this.store.options.interval = 50;\r\n    this.externalElements.ontouchstart = this.ontouchstart;\r\n    this.externalElements.ontouchmove = this.ontouchmove;\r\n    this.externalElements.ontouchend = this.ontouchend;\r\n    this.externalElements.onmousedown = (e) => {\r\n      this.onMouseDown({\r\n        x: e.offsetX,\r\n        y: e.offsetY,\r\n        clientX: e.clientX,\r\n        clientY: e.clientY,\r\n        pageX: e.pageX,\r\n        pageY: e.pageY,\r\n        ctrlKey: e.ctrlKey || e.metaKey,\r\n        shiftKey: e.shiftKey,\r\n        altKey: e.altKey,\r\n        buttons: e.buttons,\r\n      });\r\n    };\r\n    this.externalElements.onmousemove = (e) => {\r\n      if (e.target !== this.externalElements) {\r\n        return;\r\n      }\r\n      this.onMouseMove({\r\n        x: e.offsetX,\r\n        y: e.offsetY,\r\n        clientX: e.clientX,\r\n        clientY: e.clientY,\r\n        pageX: e.pageX,\r\n        pageY: e.pageY,\r\n        ctrlKey: e.ctrlKey || e.metaKey,\r\n        shiftKey: e.shiftKey,\r\n        altKey: e.altKey,\r\n        buttons: e.buttons,\r\n      });\r\n    };\r\n    this.externalElements.onmouseup = (e) => {\r\n      this.onMouseUp({\r\n        x: e.offsetX,\r\n        y: e.offsetY,\r\n        clientX: e.clientX,\r\n        clientY: e.clientY,\r\n        pageX: e.pageX,\r\n        pageY: e.pageY,\r\n        ctrlKey: e.ctrlKey || e.metaKey,\r\n        shiftKey: e.shiftKey,\r\n        altKey: e.altKey,\r\n        buttons: e.buttons,\r\n        button: e.button,\r\n      });\r\n    };\r\n    this.externalElements.onmouseleave = (e) => {\r\n      //离开画布取消所有选中\r\n      this.store.data.pens.forEach((pen) => {\r\n        if (pen.calculative.hover) {\r\n          pen.calculative.hover = false;\r\n        }\r\n      });\r\n      if (this.store.hover) {\r\n        this.store.hover.calculative.hover = false;\r\n        this.store.hover = undefined;\r\n      }\r\n      this.render();\r\n      if (\r\n        (e as any).toElement !== this.tooltip.box &&\r\n        (e as any).toElement !== this.tooltip.arrowUp &&\r\n        (e as any).toElement !== this.tooltip.arrowDown\r\n      ) {\r\n        this.tooltip.hide();\r\n        this.store.lastHover = undefined;\r\n      }\r\n    };\r\n\r\n    this.externalElements.ondblclick = this.ondblclick;\r\n    this.externalElements.tabIndex = 0;\r\n    this.externalElements.onblur = () => {\r\n      this.mouseDown = undefined;\r\n    };\r\n    this.externalElements.onwheel = this.onwheel;\r\n\r\n    document.addEventListener('copy', this.onCopy);\r\n    document.addEventListener('cut', this.onCut);\r\n    document.addEventListener('paste', this.onPaste);\r\n\r\n    switch (this.store.options.keydown) {\r\n      case KeydownType.Document:\r\n        document.addEventListener('keydown', this.onkeydown);\r\n        document.addEventListener('keyup', this.onkeyup);\r\n        break;\r\n      case KeydownType.Canvas:\r\n        this.externalElements.addEventListener('keydown', this.onkeydown);\r\n        this.externalElements.addEventListener('keyup', this.onkeyup);\r\n        break;\r\n    }\r\n  }\r\n\r\n  onCopy = (event: ClipboardEvent) => {\r\n    if (this.store.options.disableClipboard) {\r\n      return;\r\n    }\r\n    if (\r\n      event.target !== this.externalElements &&\r\n      event.target !== document.body &&\r\n      (event.target as any).offsetParent !== this.externalElements\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    this.copy();\r\n  };\r\n\r\n  onCut = (event: ClipboardEvent) => {\r\n    if (this.store.options.disableClipboard) {\r\n      return;\r\n    }\r\n    if (\r\n      event.target !== this.externalElements &&\r\n      event.target !== document.body &&\r\n      (event.target as any).offsetParent !== this.externalElements\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    this.cut();\r\n  };\r\n\r\n  onPaste = (event: ClipboardEvent) => {\r\n    if (this.store.data.locked || this.store.options.disableClipboard) {\r\n      return;\r\n    }\r\n    if (\r\n      event.target !== this.externalElements &&\r\n      event.target !== document.body &&\r\n      (event.target as any).offsetParent !== this.externalElements\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // 是否粘贴图片\r\n    let hasImages: boolean;\r\n    if (navigator.clipboard && event.clipboardData) {\r\n      const items = event.clipboardData.items;\r\n      if (items) {\r\n        for (let i = 0; i < items.length; i++) {\r\n          if (items[i].type.indexOf('image') !== -1 && items[i].getAsFile()) {\r\n            hasImages = true;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (hasImages) {\r\n      const items = event.clipboardData.items;\r\n      if (items) {\r\n        for (let i = 0; i < items.length; i++) {\r\n          if (items[i].type.indexOf('image') !== -1 && items[i].getAsFile()) {\r\n            const { x, y } = this.mousePos;\r\n            const blob = items[i].getAsFile();\r\n            let name = items[i].type.slice(6) === 'gif' ? 'gif' : 'image';\r\n            if (blob !== null) {\r\n              let base64_str: any;\r\n              const reader = new FileReader();\r\n              reader.onload = (e) => {\r\n                base64_str = e.target.result;\r\n                const image = new Image();\r\n                image.src = base64_str;\r\n                image.onload = () => {\r\n                  const { width, height } = image;\r\n                  const pen = {\r\n                    name,\r\n                    x: x - 50 / 2,\r\n                    y: y - (height / width) * 50,\r\n                    externElement: name === 'gif',\r\n                    width: 100,\r\n                    height: (height / width) * 100,\r\n                    image: base64_str as any,\r\n                  };\r\n                  this.addPens([pen]);\r\n                  this.active([pen]);\r\n                  this.copy([pen]);\r\n                };\r\n              };\r\n              reader.readAsDataURL(blob);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      this.paste();\r\n    }\r\n  };\r\n\r\n  onMessage = (e: MessageEvent) => {\r\n    if (\r\n      typeof e.data !== 'string' ||\r\n      !e.data ||\r\n      e.data.startsWith('setImmediate')\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let data = JSON.parse(e.data);\r\n    if (typeof data === 'object') {\r\n      this.parent.doMessageEvent(data.name, data.value);\r\n    }else{\r\n      this.parent.doMessageEvent(data);\r\n    }\r\n  }\r\n\r\n  onwheel = (e: WheelEvent) => {\r\n    //输入模式不允许滚动\r\n    if (this.inputDiv.contentEditable === 'true') {\r\n      return;\r\n    }\r\n    //画线过程中不允许缩放\r\n    if (this.drawingLine) {\r\n      return;\r\n    }\r\n    if (this.pencil) {\r\n      return;\r\n    }\r\n    if (this.store.hover) {\r\n      if (this.store.hover.onWheel) {\r\n        this.store.hover.onWheel(this.store.hover, e);\r\n        return;\r\n      }\r\n    }\r\n    if (this.store.data.disableScale || this.store.options.disableScale) {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    //移动画笔过程中不允许缩放\r\n    if (\r\n      this.mouseDown &&\r\n      (this.hoverType === HoverType.Node || this.hoverType === HoverType.Line)\r\n    )\r\n      return;\r\n    if (this.store.data.locked === LockState.Disable) return;\r\n    if (this.store.data.locked === LockState.DisableScale) return;\r\n    if (this.store.data.locked === LockState.DisableMoveScale) return;\r\n\r\n    // e.ctrlKey: false - 平移； true - 缩放。老windows触摸板不支持\r\n    if (\r\n      !e.ctrlKey &&\r\n      Math.abs((e as any).wheelDelta) < 100 &&\r\n      e.deltaY.toString().indexOf('.') === -1\r\n    ) {\r\n      if (this.store.options.scroll && !e.metaKey && this.scroll) {\r\n        this.scroll.wheel(e.deltaY < 0);\r\n        return;\r\n      }\r\n      const scale = this.store.data.scale || 1;\r\n      this.translate(-e.deltaX / scale, -e.deltaY / scale);\r\n      return;\r\n    }\r\n    if (Math.abs((e as any).wheelDelta) > 100) {\r\n      //鼠标滚轮滚动 scroll模式下是上下滚动而不是缩放 ctrl可以控制缩放\r\n      if (this.store.options.scroll && this.scroll && !this.store.options.scrollButScale && !(e.ctrlKey||e.metaKey)) {\r\n        this.scroll.wheel(e.deltaY < 0);\r\n        return;\r\n      }\r\n    }\r\n\r\n    //禁止触摸屏双指缩放操作\r\n    if (this.store.options.disableTouchPadScale) {\r\n      return;\r\n    }\r\n\r\n    let scaleOff = 0.015;\r\n    if(this.store.options.scaleOff){\r\n      scaleOff = this.store.options.scaleOff;\r\n      if (e.deltaY > 0) {\r\n        scaleOff = - this.store.options.scaleOff;\r\n      }\r\n    }else{\r\n      let isMac = /mac os /i.test(navigator.userAgent);\r\n      if (isMac) {\r\n        if (!e.ctrlKey) {\r\n          scaleOff *= (e as any).wheelDeltaY / 240;\r\n        } else if (e.deltaY > 0) {\r\n          scaleOff *= -1;\r\n        }\r\n      } else {\r\n        let offset = 0.2;\r\n        if (e.deltaY.toString().indexOf('.') !== -1) {\r\n          offset = 0.01;\r\n        }\r\n        if (e.deltaY > 0) {\r\n          scaleOff = -offset;\r\n        } else {\r\n          scaleOff = offset;\r\n        }\r\n      }\r\n    }\r\n    let { offsetX: x, offsetY: y } = e;\r\n    // if (this.parent.map && e.target === this.parent.map?.box) {\r\n    //   //放大镜缩放\r\n    //   const width = this.store.data.width || this.store.options.width;\r\n    //   const height = this.store.data.height || this.store.options.height;\r\n    //   if (width && height) {\r\n    //     //大屏\r\n    //     x =\r\n    //       (x / this.parent.map.boxWidth) * width * this.store.data.scale +\r\n    //       this.store.data.origin.x;\r\n    //     y =\r\n    //       (y / this.parent.map.boxHeight) * height * this.store.data.scale +\r\n    //       this.store.data.origin.y;\r\n    //     const rect = this.canvas.getBoundingClientRect();\r\n    //     x = x + rect.left;\r\n    //     y = y + rect.top;\r\n    //   } else {\r\n    //     const rect = this.parent.getRect();\r\n    //     x =\r\n    //       (x / this.parent.map.boxWidth) * rect.width +\r\n    //       rect.x +\r\n    //       this.store.data.x;\r\n    //     y =\r\n    //       (y / this.parent.map.boxHeight) * rect.height +\r\n    //       rect.y +\r\n    //       this.store.data.y;\r\n    //   }\r\n    // }\r\n    this.scale(this.store.data.scale + scaleOff, { x, y });\r\n    this.externalElements.focus(); // 聚焦\r\n  };\r\n\r\n  onkeydown = (e: KeyboardEvent) => {\r\n    if (\r\n      this.store.data.locked >= LockState.DisableEdit &&\r\n      (e.target as HTMLElement).tagName !== 'INPUT' &&\r\n      (e.target as HTMLElement).tagName !== 'TEXTAREA' &&\r\n      !(e.target as HTMLElement).dataset.meta2dIgnore\r\n    ) {\r\n      this.store.active.forEach((pen) => {\r\n        pen.onKeyDown?.(pen, e.key);\r\n      });\r\n    }\r\n    if (\r\n      this.store.data.locked >= LockState.DisableEdit ||\r\n      (e.target as HTMLElement).tagName === 'INPUT' ||\r\n      (e.target as HTMLElement).tagName === 'TEXTAREA' ||\r\n      (e.target as HTMLElement).dataset.meta2dIgnore\r\n    ) {\r\n      return;\r\n    }\r\n    if (this.store.options.unavailableKeys.includes(e.key)) {\r\n      return;\r\n    }\r\n    if (!this.keyOptions) {\r\n      this.keyOptions = {};\r\n    }\r\n    this.keyOptions.altKey = e.altKey;\r\n    this.keyOptions.shiftKey = e.shiftKey;\r\n    this.keyOptions.ctrlKey = e.ctrlKey;\r\n    this.keyOptions.metaKey = e.metaKey;\r\n    let x = 10;\r\n    let y = 10;\r\n    let vRect: Rect = null;\r\n    if (this.store.options.strictScope) {\r\n      const width = this.store.data.width || this.store.options.width;\r\n      const height = this.store.data.height || this.store.options.height;\r\n      if (width && height) {\r\n        vRect = {\r\n          x: this.store.data.origin.x,\r\n          y: this.store.data.origin.y,\r\n          width: width * this.store.data.scale,\r\n          height: height * this.store.data.scale,\r\n        };\r\n      }\r\n    }\r\n    switch (e.key) {\r\n      case ' ':\r\n        this.hotkeyType = HotkeyType.Translate;\r\n        break;\r\n      case 'Control':\r\n        if (this.drawingLine) {\r\n          this.drawingLine.calculative.drawlineH =\r\n            !this.drawingLine.calculative.drawlineH;\r\n        } else if (!this.hotkeyType) {\r\n          this.patchFlags = true;\r\n          this.hotkeyType = HotkeyType.Select;\r\n        }\r\n        break;\r\n      case 'Meta':\r\n        break;\r\n      case 'Shift':\r\n        if (\r\n          this.store.active.length === 1 &&\r\n          this.store.active[0].type &&\r\n          this.store.activeAnchor\r\n        ) {\r\n          this.toggleAnchorHand();\r\n        } else if (!this.hotkeyType) {\r\n          this.patchFlags = true;\r\n          if (!this.store.options.resizeMode) {\r\n            this.hotkeyType = HotkeyType.Resize;\r\n          }\r\n        }\r\n        break;\r\n      case 'Alt':\r\n        if (!e.ctrlKey && !e.shiftKey && this.drawingLine) {\r\n          const to = getToAnchor(this.drawingLine);\r\n          if (to !== this.drawingLine.calculative.activeAnchor) {\r\n            deleteTempAnchor(this.drawingLine);\r\n            this.drawingLine.calculative.worldAnchors.push(to);\r\n          } else {\r\n            this.drawingLine.calculative.worldAnchors.push({\r\n              x: to.x,\r\n              y: to.y,\r\n            });\r\n          }\r\n          const index = this.drawLineFns.indexOf(this.drawingLineName);\r\n          this.drawingLineName =\r\n            this.drawLineFns[(index + 1) % this.drawLineFns.length];\r\n          this.drawingLine.lineName = this.drawingLineName;\r\n          this.drawline();\r\n          this.patchFlags = true;\r\n        }\r\n        e.preventDefault();\r\n        break;\r\n      case 'a':\r\n      case 'A':\r\n        if (e.ctrlKey || e.metaKey) {\r\n          // TODO: ctrl + A 会选中 visible == false 的元素\r\n          this.active(\r\n            this.store.data.pens.filter(\r\n              (pen) => !pen.parentId && pen.locked !== LockState.Disable\r\n            )\r\n          );\r\n          e.preventDefault();\r\n        } else {\r\n          this.toggleAnchorMode();\r\n        }\r\n        break;\r\n      case 'Delete':\r\n      case 'Backspace':\r\n        if(this.canvasImage.fitFlag && this.canvasImage.activeFit){\r\n          this.deleteFit();\r\n          break;\r\n        }\r\n        !this.store.data.locked && this.delete();\r\n        break;\r\n      case 'ArrowLeft':\r\n        if (this.movingAnchor) {\r\n          this.translateAnchor(-1, 0);\r\n          break;\r\n        }\r\n        x = -1;\r\n        if (e.shiftKey) {\r\n          x = -5;\r\n        }\r\n        if (e.ctrlKey || e.metaKey) {\r\n          x = -10;\r\n        }\r\n        x = x * this.store.data.scale;\r\n\r\n        if (\r\n          this.store.activeAnchor &&\r\n          this.store.active &&\r\n          this.store.active.length === 1 &&\r\n          this.store.active[0].type\r\n        ) {\r\n          this.moveLineAnchor(\r\n            { x: this.store.activeAnchor.x + x, y: this.store.activeAnchor.y },\r\n            {}\r\n          );\r\n          break;\r\n        }\r\n        if (vRect && this.activeRect.x + x < vRect.x) {\r\n          x = vRect.x - this.activeRect.x;\r\n        }\r\n\r\n        this.translatePens(this.store.active, x, 0);\r\n        break;\r\n      case 'ArrowUp':\r\n        if (this.movingAnchor) {\r\n          this.translateAnchor(0, -1);\r\n          break;\r\n        }\r\n        y = -1;\r\n        if (e.shiftKey) {\r\n          y = -5;\r\n        }\r\n        if (e.ctrlKey || e.metaKey) {\r\n          y = -10;\r\n        }\r\n        y = y * this.store.data.scale;\r\n\r\n        if (vRect && this.activeRect.y + y < vRect.y) {\r\n          y = vRect.y - this.activeRect.y;\r\n        }\r\n\r\n        if (\r\n          this.store.activeAnchor &&\r\n          this.store.active &&\r\n          this.store.active.length === 1 &&\r\n          this.store.active[0].type\r\n        ) {\r\n          this.moveLineAnchor(\r\n            { x: this.store.activeAnchor.x, y: this.store.activeAnchor.y + y },\r\n            {}\r\n          );\r\n          break;\r\n        }\r\n        this.translatePens(this.store.active, 0, y);\r\n        break;\r\n      case 'ArrowRight':\r\n        if (this.movingAnchor) {\r\n          this.translateAnchor(1, 0);\r\n          break;\r\n        }\r\n        x = 1;\r\n        if (e.shiftKey) {\r\n          x = 5;\r\n        }\r\n        if (e.ctrlKey || e.metaKey) {\r\n          x = 10;\r\n        }\r\n        x = x * this.store.data.scale;\r\n\r\n        if (\r\n          this.store.activeAnchor &&\r\n          this.store.active &&\r\n          this.store.active.length === 1 &&\r\n          this.store.active[0].type\r\n        ) {\r\n          this.moveLineAnchor(\r\n            { x: this.store.activeAnchor.x + x, y: this.store.activeAnchor.y },\r\n            {}\r\n          );\r\n          break;\r\n        }\r\n        if (\r\n          vRect &&\r\n          this.activeRect.x + this.activeRect.width + x > vRect.x + vRect.width\r\n        ) {\r\n          x =\r\n            vRect.x + vRect.width - (this.activeRect.x + this.activeRect.width);\r\n        }\r\n        this.translatePens(this.store.active, x, 0);\r\n        break;\r\n      case 'ArrowDown':\r\n        if (this.movingAnchor) {\r\n          this.translateAnchor(0, 1);\r\n          break;\r\n        }\r\n        y = 1;\r\n        if (e.shiftKey) {\r\n          y = 5;\r\n        }\r\n        if (e.ctrlKey || e.metaKey) {\r\n          y = 10;\r\n        }\r\n        y = y * this.store.data.scale;\r\n        if (\r\n          vRect &&\r\n          this.activeRect.y + this.activeRect.height + y >\r\n            vRect.y + vRect.height\r\n        ) {\r\n          y =\r\n            vRect.y +\r\n            vRect.height -\r\n            (this.activeRect.y + this.activeRect.height);\r\n        }\r\n        if (\r\n          this.store.activeAnchor &&\r\n          this.store.active &&\r\n          this.store.active.length === 1 &&\r\n          this.store.active[0].type\r\n        ) {\r\n          this.moveLineAnchor(\r\n            { x: this.store.activeAnchor.x, y: this.store.activeAnchor.y + y },\r\n            {}\r\n          );\r\n          break;\r\n        }\r\n        this.translatePens(this.store.active, 0, y);\r\n        break;\r\n      case 'd':\r\n      case 'D':\r\n        if (!this.store.active[0]?.locked) {\r\n          this.removeAnchorHand();\r\n        }\r\n        break;\r\n      case 'h':\r\n      case 'H':\r\n        if (!this.store.active[0]?.locked) {\r\n          this.addAnchorHand();\r\n        }\r\n        break;\r\n      case 'm':\r\n      case 'M':\r\n        this.toggleMagnifier();\r\n        break;\r\n      case 'g':\r\n      case 'G':\r\n        // 进入移动瞄点状态\r\n        if (this.hoverType === HoverType.NodeAnchor) {\r\n          this.movingAnchor = this.store.hoverAnchor;\r\n          this.externalElements.style.cursor = 'move';\r\n        }\r\n        break;\r\n      case 's':\r\n      case 'S':\r\n        // 分割线\r\n        if (\r\n          !this.store.data.locked &&\r\n          this.hoverType === HoverType.LineAnchor &&\r\n          this.store.hover === this.store.active[0]\r\n        ) {\r\n          this.splitLine(this.store.active[0], this.store.hoverAnchor);\r\n        }\r\n        // 保存\r\n        (e.ctrlKey || e.metaKey) &&\r\n          this.store.emitter.emit('save', { event: e });\r\n        break;\r\n      case 'c':\r\n      case 'C':\r\n        if ((e.ctrlKey || e.metaKey) && this.store.options.disableClipboard) {\r\n          this.copy();\r\n        }\r\n        break;\r\n      case 'x':\r\n      case 'X':\r\n        if ((e.ctrlKey || e.metaKey) && this.store.options.disableClipboard) {\r\n          this.cut();\r\n        }\r\n        break;\r\n      case '√': //MAC OPTION + V\r\n      case 'v':\r\n      case 'V':\r\n        if (!e.ctrlKey && !e.metaKey) {\r\n          if (this.pencil) {\r\n            this.stopPencil();\r\n          }\r\n          if (this.drawingLineName) {\r\n            this.finishDrawline();\r\n            this.drawingLineName = '';\r\n          } else {\r\n            this.drawingLineName = this.store.options.drawingLineName;\r\n          }\r\n        }\r\n        if (!this.store.data.locked && (e.ctrlKey || e.metaKey) && (this.store.options.disableClipboard ||\r\n          (!this.store.options.disableClipboard && e.altKey)) //alt按下，paste事件无效\r\n        ) {\r\n          this.paste();\r\n        }\r\n\r\n        break;\r\n      case 'b':\r\n      case 'B':\r\n        if (this.drawingLineName) {\r\n          this.finishDrawline();\r\n          this.drawingLineName = '';\r\n        }\r\n        if (this.pencil) {\r\n          this.stopPencil();\r\n        } else {\r\n          this.drawingPencil();\r\n        }\r\n        break;\r\n      case 'y':\r\n      case 'Y':\r\n        if (e.ctrlKey || e.metaKey) {\r\n          this.redo();\r\n        }\r\n        break;\r\n      case 'z':\r\n      case 'Z':\r\n        if (e.ctrlKey || e.metaKey) {\r\n          this.undo();\r\n        } else if (e.shiftKey) {\r\n          this.redo();\r\n        }\r\n        break;\r\n      case 'Enter':\r\n        if (this.drawingLineName) {\r\n          this.finishDrawline(true);\r\n          if (this.store.active[0].anchors[0].connectTo) {\r\n            this.drawingLineName = '';\r\n          } else {\r\n            this.drawingLineName = this.store.options.drawingLineName;\r\n          }\r\n        }\r\n\r\n        if (this.store.active) {\r\n          this.store.active.forEach((pen) => {\r\n            if (pen.type) {\r\n              pen.close = !pen.close;\r\n              if(pen.close){\r\n                getLinePoints(pen);\r\n              }\r\n              this.store.path2dMap.set(pen, globalStore.path2dDraws.line(pen));\r\n              getLineLength(pen);\r\n            }else{\r\n              //图元进入编辑模式\r\n              pen.calculative.focus = true;\r\n            }\r\n          });\r\n          this.render();\r\n        }\r\n        break;\r\n      case 'Escape':\r\n        if (this.drawingLineName) {\r\n          this.finishDrawline();\r\n        }\r\n        this.drawingLineName = undefined;\r\n        this.stopPencil();\r\n        if (this.store.active) {\r\n          this.store.active.forEach((pen) => {\r\n            if (pen.type) {\r\n            }else{\r\n              //图元退出编辑模式\r\n              pen.calculative.focus = false;\r\n            }\r\n          });\r\n        }\r\n        if (this.movingPens) {\r\n          this.getAllByPens(this.movingPens).forEach((pen) => {\r\n            this.store.pens[pen.id] = undefined;\r\n          });\r\n          this.movingPens = undefined;\r\n          this.mouseDown = undefined;\r\n          this.clearDock();\r\n          this.store.active?.forEach((pen) => {\r\n            this.updateLines(pen);\r\n          });\r\n          this.calcActiveRect();\r\n          this.patchFlags = true;\r\n        }\r\n        this.hotkeyType = HotkeyType.None;\r\n        this.movingAnchor = undefined;\r\n        if (this.magnifierCanvas.magnifier) {\r\n          this.magnifierCanvas.magnifier = false;\r\n          this.patchFlags = true;\r\n        }\r\n        break;\r\n      case 'E':\r\n      case 'e':\r\n        this.store.options.disableAnchor = !this.store.options.disableAnchor;\r\n        this.store.emitter.emit(\r\n          'disableAnchor',\r\n          this.store.options.disableAnchor\r\n        );\r\n        break;\r\n      case '=':\r\n        if (e.ctrlKey || e.metaKey) {\r\n          this.scale(this.store.data.scale + 0.1);\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n        break;\r\n      case '-':\r\n        if (e.ctrlKey || e.metaKey) {\r\n          this.scale(this.store.data.scale - 0.1);\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }\r\n        break;\r\n      case 'l':\r\n      case 'L':\r\n        this.canMoveLine = true;\r\n        break;\r\n      case '[':\r\n        //下一层\r\n        this.parent.down();\r\n        break;\r\n      case ']':\r\n        //上一层\r\n        this.parent.up();\r\n        break;\r\n      case '{':\r\n        // 置底\r\n        this.parent.bottom();\r\n        break;\r\n      case '}':\r\n        //置顶\r\n        this.parent.top();\r\n        break;\r\n      case 'F':\r\n      case 'f':\r\n        this.setFollowers();\r\n        break;\r\n    }\r\n\r\n    this.render(false);\r\n  };\r\n\r\n  /**\r\n   * 分割连线的锚点，变成两条线\r\n   * @param line 连线\r\n   * @param anchor 锚点，连线的某个锚点，引用相同\r\n   */\r\n  splitLine(line: Pen, anchor: Point): void {\r\n    const worldAnchors = line.calculative.worldAnchors;\r\n    const index = worldAnchors.findIndex((a) => a === anchor);\r\n    if ([-1, 0, worldAnchors.length - 1].includes(index)) {\r\n      // 没找到，起终点不处理\r\n      return;\r\n    }\r\n\r\n    const initLine = deepClone(line, true);\r\n    const newLine = deepClone(line, true);\r\n    const id = s8();\r\n    newLine.id = id;\r\n    newLine.calculative.canvas = this;\r\n    newLine.calculative.active = false;\r\n    newLine.calculative.hover = false;\r\n\r\n    // index 作为公共点\r\n    const preAnchors = deepClone(worldAnchors.slice(0, index + 1));\r\n    const laterAnchors = deepClone(worldAnchors.slice(index)).map((a) => {\r\n      a.penId = id;\r\n      return a;\r\n    });\r\n\r\n    line.calculative.worldAnchors = preAnchors;\r\n    newLine.calculative.worldAnchors = laterAnchors;\r\n    this.initLineRect(line);\r\n    this.initLineRect(newLine);\r\n    this.store.data.pens.push(newLine);\r\n    this.store.pens[id] = newLine;\r\n\r\n    this.pushHistory({\r\n      type: EditType.Add,\r\n      pens: [deepClone(newLine, true)],\r\n      step: 2,\r\n    });\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens: [initLine],\r\n      pens: [deepClone(line, true)],\r\n      step: 2,\r\n    });\r\n  }\r\n\r\n  private translateAnchor(x: number, y: number) {\r\n    this.movingAnchor.x += x;\r\n    this.movingAnchor.y += y;\r\n    // 点不在范围内，移动到范围内\r\n    const penId = this.movingAnchor.penId;\r\n    if (penId) {\r\n      const pen = this.store.pens[penId];\r\n      const rect = pen.calculative.worldRect;\r\n      if (this.movingAnchor.x < rect.x) {\r\n        this.movingAnchor.x = rect.x;\r\n      } else if (this.movingAnchor.x > rect.ex) {\r\n        this.movingAnchor.x = rect.ex;\r\n      }\r\n      if (this.movingAnchor.y < rect.y) {\r\n        this.movingAnchor.y = rect.y;\r\n      } else if (this.movingAnchor.y > rect.ey) {\r\n        this.movingAnchor.y = rect.ey;\r\n      }\r\n      const anchor = calcRelativePoint(this.movingAnchor, rect);\r\n      // 更改 pen 的 anchors 属性\r\n      const index = pen.anchors.findIndex(\r\n        (anchor) => anchor.id === this.movingAnchor.id\r\n      );\r\n      pen.anchors[index] = anchor;\r\n      this.patchFlags = true;\r\n    }\r\n  }\r\n\r\n  onkeyup = (e: KeyboardEvent) => {\r\n    switch (e.key) {\r\n      case 'l':\r\n      case 'L':\r\n        this.canMoveLine = false;\r\n        break;\r\n      // case 'Alt':\r\n      //   if (this.drawingLine) {\r\n      //     this.store.options.autoAnchor = !this.store.options.autoAnchor;\r\n      //   }\r\n      //   break;\r\n    }\r\n\r\n    if (this.hotkeyType) {\r\n      this.render();\r\n    }\r\n    if (this.hotkeyType < HotkeyType.AddAnchor) {\r\n      this.hotkeyType = HotkeyType.None;\r\n    }\r\n  };\r\n\r\n  async fileToPen(file: File, isGif: boolean): Promise<Pen> {\r\n    let url = '';\r\n    if (this.store.options.uploadFn) {\r\n      url = await this.store.options.uploadFn(file);\r\n    } else if (this.store.options.uploadUrl) {\r\n      url = await uploadFile(\r\n        file,\r\n        this.store.options.uploadUrl,\r\n        this.store.options.uploadParams,\r\n        this.store.options.uploadHeaders\r\n      );\r\n    } else {\r\n      url = await fileToBase64(file);\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        globalStore.htmlElements[url] = img;\r\n        resolve({\r\n          width: img.width,\r\n          height: img.height,\r\n          name: isGif ? 'gif' : 'image',\r\n          image: url,\r\n        });\r\n      };\r\n      img.onerror = (e) => {\r\n        reject(e);\r\n      };\r\n      img.crossOrigin = 'anonymous';\r\n      img.src = url;\r\n    });\r\n  }\r\n\r\n  ondrop = async (event: DragEvent) => {\r\n    if (this.store.data.locked) {\r\n      console.warn('canvas is locked, can not drop');\r\n      return;\r\n    }\r\n    // Fix bug: 在 firefox 上拖拽图片会打开新页\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    const json =\r\n      event.dataTransfer.getData('Meta2d') ||\r\n      event.dataTransfer.getData('Text');\r\n\r\n    let obj = null;\r\n    try {\r\n      if (json) {\r\n        obj = JSON.parse(json);\r\n      }\r\n    } catch (e) {}\r\n    if (!obj) {\r\n      const { files } = event.dataTransfer;\r\n      if (\r\n        files.length &&\r\n        files[0].type.match('image.*') &&\r\n        !(this.addCaches && this.addCaches.length)\r\n      ) {\r\n        // 必须是图片类型\r\n        const isGif = files[0].type === 'image/gif';\r\n        obj = await this.fileToPen(files[0], isGif);\r\n      } else if (this.addCaches && this.addCaches.length) {\r\n        obj = this.addCaches;\r\n        this.addCaches = [];\r\n      } else {\r\n        this.store.emitter.emit('drop', undefined);\r\n        return;\r\n      }\r\n    }\r\n    obj = Array.isArray(obj) ? obj : [obj];\r\n    if (obj[0] && obj[0].draggable !== false) {\r\n      const pt = { x: event.offsetX, y: event.offsetY };\r\n      this.calibrateMouse(pt);\r\n      this.dropPens(obj, pt);\r\n      this.addCaches = [];\r\n      // 拖拽新增图元判断是否是在容器上\r\n      this.getContainerHover(pt);\r\n      this.mousePos.x = pt.x;\r\n      this.mousePos.y = pt.y;\r\n      this.store.emitter.emit('mouseup', {\r\n        x: pt.x,\r\n        y: pt.y,\r\n        pen: this.store.hoverContainer,\r\n      });\r\n    }\r\n\r\n    this.store.emitter.emit('drop', obj || json);\r\n  };\r\n\r\n  async dropPens(pens: Pen[], e: Point) {\r\n    this.randomIdObj = {};\r\n    for (const pen of pens) {\r\n      // 只修改 树根处的 祖先节点, randomCombineId 会递归更改子节点\r\n      !pen.parentId && this.randomCombineId(pen, pens);\r\n    }\r\n    if (Object.keys(this.randomIdObj).length !== 0) {\r\n      for (const pen of pens) {\r\n        if (pen.type) {\r\n          pen.anchors[0].connectTo = this.randomIdObj[pen.anchors[0].connectTo];\r\n          pen.anchors[pen.anchors.length - 1].connectTo =\r\n            this.randomIdObj[pen.anchors[pen.anchors.length - 1].connectTo];\r\n        } else {\r\n          pen.connectedLines?.forEach((item) => {\r\n            item.lineAnchor = this.randomIdObj[item.lineAnchor];\r\n            item.lineId = this.randomIdObj[item.lineId];\r\n          });\r\n        }\r\n      }\r\n    }\r\n    for (const pen of pens) {\r\n      // TODO: randomCombineId 会更改 id， 此处应该不存在空 id\r\n      if (!pen.id) {\r\n        pen.id = s8();\r\n      }\r\n      !pen.calculative && (pen.calculative = { canvas: this });\r\n      this.store.pens[pen.id] = pen;\r\n    }\r\n    // // 计算区域\r\n    // for (const pen of pens) {\r\n    //   // 组合节点才需要提前计算\r\n    //   Array.isArray(pen.children) && pen.children.length > 0 && this.updatePenRect(pen);\r\n    // }\r\n    let num = 0;\r\n    let lastH = 0;\r\n    let lastW = 0;\r\n    for (const pen of pens) {\r\n      if (!pen.parentId) {\r\n        pen.width *= this.store.data.scale;\r\n        pen.height *= this.store.data.scale;\r\n        pen.x = e.x - pen.width / 2 + lastW;\r\n        pen.y = e.y - pen.height / 2 + lastH;\r\n        if (pen.tags && pen.tags.includes('meta3d')) {\r\n          pen.x = this.store.data.origin.x;\r\n          pen.y = this.store.data.origin.y;\r\n        }\r\n        if((pen as any).dataset){\r\n          if(num % 2 === 0){\r\n            lastW = pen.width - 40 * this.store.data.scale;\r\n          }else{\r\n            lastW = 0;\r\n          }\r\n          num ++;\r\n          if(num % 2 === 0){\r\n            lastH += pen.height + 10 * this.store.data.scale;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    //大屏区域\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    if (width && height) {\r\n      let rect = {\r\n        x: this.store.data.origin.x,\r\n        y: this.store.data.origin.y,\r\n        width: width * this.store.data.scale,\r\n        height: height * this.store.data.scale,\r\n      };\r\n      let flag = true;\r\n      for (const pen of pens) {\r\n        if (!pen.parentId) {\r\n          let points = [\r\n            { x: pen.x, y: pen.y },\r\n            { x: pen.x + pen.width, y: pen.y },\r\n            { x: pen.x, y: pen.y + pen.height },\r\n            { x: pen.x + pen.width, y: pen.y + pen.height },\r\n            { x: pen.x + pen.width / 2, y: pen.y + pen.height / 2 },\r\n          ];\r\n          if (\r\n            (pen.x === rect.x &&\r\n              pen.y === rect.y &&\r\n              pen.width === rect.width &&\r\n              pen.height === rect.height) ||\r\n            points.some((point) => pointInRect(point, rect))\r\n          ) {\r\n            flag = false;\r\n            //严格范围模式下对齐大屏边界\r\n            if (this.store.options.strictScope) {\r\n              if (pen.x < rect.x) {\r\n                pen.x = rect.x;\r\n              }\r\n              if (pen.y < rect.y) {\r\n                pen.y = rect.y;\r\n              }\r\n              if (pen.x + pen.width > rect.x + rect.width) {\r\n                pen.x = rect.x + rect.width - pen.width;\r\n              }\r\n              if (pen.y + pen.height > rect.y + rect.height) {\r\n                pen.y = rect.y + rect.height - pen.height;\r\n              }\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (flag) {\r\n        console.info('画笔在大屏范围外');\r\n        return;\r\n      }\r\n    }\r\n\r\n    await this.addPens(pens, true);\r\n    this.active(pens.filter((pen) => !pen.parentId));\r\n    this.render();\r\n    this.externalElements.focus(); // 聚焦\r\n  }\r\n\r\n  randomCombineId(pen: Pen, pens: Pen[], parentId?: string) {\r\n    let beforeIds = null;\r\n    if (pen.type) {\r\n      if (\r\n        pen.anchors[0].connectTo ||\r\n        pen.anchors[pen.anchors.length - 1].connectTo\r\n      ) {\r\n        beforeIds = [\r\n          pen.id,\r\n          pen.anchors[0].id,\r\n          pen.anchors[pen.anchors.length - 1].id,\r\n        ];\r\n      }\r\n    } else {\r\n      if (pen.connectedLines && pen.connectedLines.length) {\r\n        beforeIds = [pen.id];\r\n      }\r\n    }\r\n    randomId(pen);\r\n    if (beforeIds) {\r\n      if (beforeIds.length === 1) {\r\n        this.randomIdObj[beforeIds[0]] = pen.id;\r\n      } else {\r\n        this.randomIdObj[beforeIds[0]] = pen.id;\r\n        this.randomIdObj[beforeIds[1]] = pen.anchors[0].id;\r\n        this.randomIdObj[beforeIds[2]] = pen.anchors[pen.anchors.length - 1].id;\r\n      }\r\n    }\r\n    //处理链接关系\r\n    pen.parentId = parentId;\r\n    const newChildren = [];\r\n    if (Array.isArray(pen.children)) {\r\n      for (const childId of pen.children) {\r\n        const childPen = pens.find((pen) => pen.id === childId);\r\n        childPen &&\r\n          newChildren.push(this.randomCombineId(childPen, pens, pen.id).id);\r\n        // TODO: 既已成为 组合节点，连接关系是否仍需要考虑呢？\r\n      }\r\n    }\r\n    pen.children = newChildren;\r\n    return pen;\r\n  }\r\n\r\n  async addPens(pens: Pen[], history?: boolean, abs?:boolean): Promise<Pen[]> {\r\n    if (this.beforeAddPens && (await this.beforeAddPens(pens)) != true) {\r\n      return [];\r\n    }\r\n    const list: Pen[] = [];\r\n    for (const pen of pens) {\r\n      if (this.beforeAddPen && this.beforeAddPen(pen) != true) {\r\n        continue;\r\n      }\r\n      if(abs) {\r\n        pen.x = pen.x * this.store.data.scale + this.store.data.origin.x;\r\n        pen.y = pen.y * this.store.data.scale + this.store.data.origin.y;\r\n        pen.width = pen.width * this.store.data.scale;\r\n        pen.height = pen.height * this.store.data.scale;\r\n      }\r\n      this.makePen(pen);\r\n      list.push(pen);\r\n    }\r\n    this.render();\r\n    this.store.emitter.emit('add', list);\r\n    if (history) {\r\n      this.pushHistory({ type: EditType.Add, pens: deepClone(list, true) });\r\n    }\r\n    return list;\r\n  }\r\n\r\n  ontouchstart = (e: TouchEvent) => {\r\n    if (this.store.data.locked === LockState.Disable) {\r\n      return;\r\n    }\r\n    if (this.touchStartTimer) {\r\n      clearTimeout(this.touchStartTimer);\r\n    }\r\n    this.touchStartTimer = setTimeout(() => {\r\n      this.touchStart = performance.now();\r\n      const x = e.touches[0].pageX - this.clientRect.x;\r\n      const y = e.touches[0].pageY - this.clientRect.y;\r\n      const pos: Point = { x, y };\r\n      this.calibrateMouse(pos);\r\n      this.getHover(pos);\r\n      this.onMouseDown({\r\n        x,\r\n        y,\r\n        clientX: e.touches[0].clientX,\r\n        clientY: e.touches[0].clientY,\r\n        pageX: e.touches[0].pageX,\r\n        pageY: e.touches[0].pageY,\r\n        ctrlKey: e.ctrlKey || e.metaKey,\r\n        shiftKey: e.shiftKey,\r\n        altKey: e.altKey,\r\n        buttons: 1,\r\n      });\r\n\r\n      if (e.touches.length === 2) {\r\n        this.initTouchDis = Math.hypot(\r\n          e.touches[0].pageX - e.touches[1].pageX,\r\n          e.touches[0].pageY - e.touches[1].pageY\r\n        );\r\n        this.initScale = this.store.data.scale;\r\n        this.startTouches = e.touches;\r\n        this.touchCenter = {\r\n          x:\r\n            e.touches[0].pageX +\r\n            (e.touches[1].pageX - e.touches[0].pageX) / 2 -\r\n            this.clientRect.x,\r\n          y:\r\n            e.touches[0].pageY +\r\n            (e.touches[1].pageY - e.touches[0].pageY) / 2 -\r\n            this.clientRect.y,\r\n        };\r\n\r\n        return;\r\n      } else if (e.touches.length === 3) {\r\n        this.store.emitter.emit('contextmenu', {\r\n          e: {\r\n            x,\r\n            y,\r\n            clientX: e.touches[0].clientX,\r\n            clientY: e.touches[0].clientY,\r\n            pageX: e.touches[0].pageX,\r\n            pageY: e.touches[0].pageY,\r\n          },\r\n          clientRect: this.clientRect,\r\n        });\r\n\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      }\r\n\r\n      this.touchStartTimer = undefined;\r\n    }, 50);\r\n  };\r\n\r\n  ontouchmove = (event: TouchEvent) => {\r\n    if (this.store.data.locked === LockState.Disable) {\r\n      return;\r\n    }\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n    const now = performance.now();\r\n    if (now - this.touchStart < 50) {\r\n      return;\r\n    }\r\n    this.touchStart = now;\r\n\r\n    const touches = event.touches;\r\n    const len = touches.length;\r\n\r\n    const x = event.touches[0].pageX - this.clientRect.x;\r\n    const y = event.touches[0].pageY - this.clientRect.y;\r\n    if (len === 1) {\r\n      this.onMouseMove({\r\n        x,\r\n        y,\r\n        clientX: event.changedTouches[0].clientX,\r\n        clientY: event.changedTouches[0].clientY,\r\n        pageX: event.changedTouches[0].pageX,\r\n        pageY: event.changedTouches[0].pageY,\r\n        ctrlKey: event.ctrlKey || event.metaKey,\r\n        shiftKey: event.shiftKey,\r\n        altKey: event.altKey,\r\n        buttons: 1,\r\n      });\r\n    } else if (len === 2 && this.startTouches?.length === 2) {\r\n      if (!this.touchMoving && !this.touchScaling) {\r\n        const x1 = this.startTouches[0].pageX - touches[0].pageX;\r\n        const x2 = this.startTouches[1].pageX - touches[1].pageX;\r\n        const y1 = this.startTouches[0].pageY - touches[0].pageY;\r\n        const y2 = this.startTouches[1].pageY - touches[1].pageY;\r\n        if (\r\n          ((x1 >= 0 && x2 < 0) || (x1 <= 0 && x2 > 0)) &&\r\n          ((y1 >= 0 && y2 < 0) || (y1 <= 0 && y2 > 0))\r\n        ) {\r\n          this.touchScaling = true;\r\n        } else {\r\n          this.touchMoving = true;\r\n        }\r\n      }\r\n\r\n      if (this.touchScaling) {\r\n        if (this.store.data.disableScale || this.store.options.disableScale) {\r\n          return;\r\n        }\r\n        const scale =\r\n          Math.hypot(\r\n            touches[0].pageX - touches[1].pageX,\r\n            touches[0].pageY - touches[1].pageY\r\n          ) / this.initTouchDis;\r\n        this.scale(this.initScale * scale, deepClone(this.touchCenter));\r\n      }\r\n\r\n      if (this.touchMoving) {\r\n        if (\r\n          (this.store.data.locked >= LockState.DisableMove &&\r\n            this.store.data.locked !== LockState.DisableScale) ||\r\n            this.store.data.disableScale ||\r\n            this.store.options.disableScale\r\n        ) {\r\n          return;\r\n        }\r\n        if (this.lastOffsetX) {\r\n          const { scale } = this.store.data;\r\n          this.translate(\r\n            (x - this.lastOffsetX) / scale,\r\n            (y - this.lastOffsetY) / scale\r\n          );\r\n        }\r\n\r\n        this.lastOffsetX = x;\r\n        this.lastOffsetY = y;\r\n      }\r\n    }\r\n  };\r\n\r\n  ontouchend = (event: TouchEvent) => {\r\n    if (this.store.data.locked === LockState.Disable) {\r\n      return;\r\n    }\r\n    this.touchCenter = undefined;\r\n    this.touchScaling = undefined;\r\n    this.touchMoving = undefined;\r\n    this.startTouches = undefined;\r\n    this.lastOffsetX = 0;\r\n    this.lastOffsetY = 0;\r\n\r\n    const x = event.changedTouches[0].pageX - this.clientRect.x;\r\n    const y = event.changedTouches[0].pageY - this.clientRect.y;\r\n\r\n    this.onMouseUp({\r\n      x,\r\n      y,\r\n      clientX: event.changedTouches[0].clientX,\r\n      clientY: event.changedTouches[0].clientY,\r\n      pageX: event.changedTouches[0].pageX,\r\n      pageY: event.changedTouches[0].pageY,\r\n      ctrlKey: event.ctrlKey || event.metaKey,\r\n      shiftKey: event.shiftKey,\r\n      altKey: event.altKey,\r\n      buttons: 1,\r\n    });\r\n    setTimeout(() => {\r\n      this.render();\r\n    }, 20);\r\n  };\r\n\r\n  onGesturestart = (e) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  /**\r\n   * 获取初始化的 pencilLine\r\n   * @param pt 需包含 penId\r\n   */\r\n  private getInitPencilLine(pt: Point): Pen {\r\n    const { data, options } = this.store;\r\n    const scale = data.scale;\r\n    const lineWidth = data.lineWidth || 1;\r\n    return {\r\n      id: pt.penId,\r\n      name: 'line',\r\n      x: pt.x,\r\n      y: pt.y,\r\n      type: PenType.Line,\r\n      calculative: {\r\n        canvas: this,\r\n        pencil: true,\r\n        active: true,\r\n        worldAnchors: [pt],\r\n        lineWidth: lineWidth * scale,\r\n      },\r\n      fromArrow: data.fromArrow || options.fromArrow,\r\n      toArrow: data.toArrow || options.toArrow,\r\n      lineWidth,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 获取初始化的 drawingLine\r\n   * @param pt 需包含 penId\r\n   */\r\n  private createDrawingLine(pt: Point): Pen {\r\n    this.inactive();\r\n    const { data, options } = this.store;\r\n    const scale = data.scale;\r\n    const lineWidth = data.lineWidth || 1;\r\n    pt.penId = s8();\r\n    return {\r\n      id: pt.penId,\r\n      name: 'line',\r\n      lineName: this.drawingLineName,\r\n      x: pt.x,\r\n      y: pt.y,\r\n      type: PenType.Line,\r\n      calculative: {\r\n        canvas: this,\r\n        active: true,\r\n        worldAnchors: [pt],\r\n        lineWidth: lineWidth * scale,\r\n      },\r\n      fromArrow: data.fromArrow || options.fromArrow,\r\n      toArrow: data.toArrow || options.toArrow,\r\n      lineWidth,\r\n    };\r\n  }\r\n\r\n  onMouseDown = (e: {\r\n    x: number;\r\n    y: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    buttons?: number;\r\n    ctrlKey?: boolean;\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n  }) => {\r\n    if (e.buttons === 2 && !this.drawingLine) {\r\n      this.mouseRight = MouseRight.Down;\r\n    }\r\n    this.hideInput();\r\n    this.popconfirm.hide();\r\n    if (\r\n      this.store.data.locked === LockState.Disable ||\r\n      (e.buttons !== 1 && e.buttons !== 2)\r\n    ) {\r\n      this.hoverType = HoverType.None;\r\n      return;\r\n    }\r\n\r\n    if (this.magnifierCanvas.magnifier) {\r\n      return;\r\n    }\r\n\r\n    this.calibrateMouse(e);\r\n    this.mousePos.x = e.x;\r\n    this.mousePos.y = e.y;\r\n\r\n    this.mouseDown = e;\r\n    this.lastMouseTime = performance.now();\r\n    if(this.canvasImage.fitFlag){\r\n      if(!this.canvasImage.currentFit){\r\n        //选中布局容器\r\n        this.calcuActiveFit();\r\n      }\r\n      return;\r\n    }\r\n    // Set anchor of pen.\r\n    if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n      this.setAnchor(this.store.pointAt);\r\n      return;\r\n    }\r\n\r\n    //shift 快捷添加锚点并连线\r\n    if (!this.store.options.autoAnchor && !this.drawingLine) {\r\n      if (e.shiftKey && e.ctrlKey && e.altKey) {\r\n        this.setAnchor(this.store.pointAt);\r\n        this.drawingLineName = this.store.options.drawingLineName;\r\n        const anchor = this.store.activeAnchor;\r\n        if (!anchor) {\r\n          return;\r\n        }\r\n        const pt: Point = {\r\n          id: s8(),\r\n          x: anchor.x,\r\n          y: anchor.y,\r\n        };\r\n        this.drawingLine = this.createDrawingLine(pt);\r\n        let _pt = getFromAnchor(this.drawingLine);\r\n        this.drawingLine.calculative.activeAnchor = _pt;\r\n        connectLine(this.store.hover, anchor, this.drawingLine, pt);\r\n        this.drawline();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Translate\r\n    if (\r\n      this.hotkeyType === HotkeyType.Translate ||\r\n      (this.mouseRight === MouseRight.Down &&\r\n        !this.store.options.mouseRightActive)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // 正在连线\r\n    if (this.drawingLine) {\r\n      // 单击在锚点上，完成绘画\r\n      if (this.store.hoverAnchor) {\r\n        const to = getToAnchor(this.drawingLine);\r\n        if (this.store.hoverAnchor.type === PointType.Line) {\r\n          getDistance(to, this.store.hoverAnchor, this.store);\r\n        } else {\r\n          to.x = this.store.hoverAnchor.x;\r\n          to.y = this.store.hoverAnchor.y;\r\n        }\r\n        connectLine(\r\n          this.store.hover,\r\n          this.store.hoverAnchor,\r\n          this.drawingLine,\r\n          to\r\n        );\r\n        this.drawline();\r\n        this.finishDrawline(true);\r\n        return;\r\n      }\r\n\r\n      //shift快捷添加锚点并完成连线\r\n      if (!this.store.options.autoAnchor) {\r\n        if (e.shiftKey && e.altKey && e.ctrlKey) {\r\n          this.setAnchor(this.store.pointAt);\r\n          const to = getToAnchor(this.drawingLine);\r\n          const anchor = this.store.activeAnchor;\r\n          if (!anchor) {\r\n            return;\r\n          }\r\n          to.x = anchor.x;\r\n          to.y = anchor.y;\r\n          connectLine(this.store.hover, anchor, this.drawingLine, to);\r\n          this.drawline();\r\n          this.finishDrawline(true);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // 右键，完成绘画\r\n      if (\r\n        e.buttons === 2 ||\r\n        (this.drawingLineName === 'mind' &&\r\n          this.drawingLine?.calculative.worldAnchors.length > 1) ||\r\n        (this.store.options.drawingLineLength &&\r\n          this.drawingLine?.calculative.worldAnchors.length >\r\n            this.store.options.drawingLineLength)\r\n      ) {\r\n        this.finishDrawline(true);\r\n        if (this.store.active[0]?.anchors[0].connectTo || this.store.active.length == 0) {\r\n          this.drawingLineName = '';\r\n        } else {\r\n          this.drawingLineName = this.store.options.drawingLineName;\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 自动锚点（单击节点），完成绘画\r\n      if (this.store.options.autoAnchor && this.hoverType === HoverType.Node) {\r\n        const to = getToAnchor(this.drawingLine);\r\n        const anchor = nearestAnchor(this.store.hover, e);\r\n        to.x = anchor.x;\r\n        to.y = anchor.y;\r\n        this.drawingLine.autoTo = true;\r\n        connectLine(this.store.hover, anchor, this.drawingLine, to);\r\n        this.drawline();\r\n        this.finishDrawline(true);\r\n\r\n        return;\r\n      }\r\n\r\n      // 添加点\r\n      const to = getToAnchor(this.drawingLine);\r\n\r\n      if (to.isTemp) {\r\n        this.drawingLine.calculative.activeAnchor =\r\n          this.drawingLine.calculative.worldAnchors[\r\n            this.drawingLine.calculative.worldAnchors.length - 2\r\n          ];\r\n        to.isTemp = undefined;\r\n      } else {\r\n        this.drawingLine.calculative.activeAnchor = to;\r\n        this.drawingLine.calculative.worldAnchors.push({\r\n          x: to.x,\r\n          y: to.y,\r\n          penId: to.penId,\r\n        });\r\n      }\r\n      this.drawingLine.calculative.drawlineH = undefined;\r\n      this.drawingLineName !== 'polyline' && this.drawline();\r\n    }\r\n\r\n    // 单击在节点上，通过自动锚点连线\r\n    if (this.drawingLineName) {\r\n      if (this.hoverType === HoverType.Node) {\r\n        if (this.store.options.autoAnchor) {\r\n          this.inactive(true);\r\n          const anchor = nearestAnchor(this.store.hover, e);\r\n          this.store.hoverAnchor = anchor;\r\n          const pt: Point = { id: s8(), x: anchor.x, y: anchor.y };\r\n          this.drawingLine = this.createDrawingLine(pt);\r\n          this.drawingLine.autoFrom = true;\r\n          connectLine(this.store.hover, anchor, this.drawingLine, pt);\r\n        } else {\r\n          this.inactive();\r\n          this.hoverType = HoverType.None;\r\n        }\r\n      } else if (this.hoverType === HoverType.NodeAnchor) {\r\n        //钢笔模式下 可以连节点锚点\r\n        this.drawingLineName = this.store.options.drawingLineName;\r\n        const pt: Point = {\r\n          id: s8(),\r\n          x: this.store.hoverAnchor.x,\r\n          y: this.store.hoverAnchor.y,\r\n        };\r\n        this.drawingLine = this.createDrawingLine(pt);\r\n        this.drawingLine.calculative.activeAnchor = pt;\r\n        connectLine(\r\n          this.store.hover,\r\n          this.store.hoverAnchor,\r\n          this.drawingLine,\r\n          pt\r\n        );\r\n\r\n        // this.drawline();\r\n      } else if (!this.drawingLine && this.drawingLineName !== 'curve') {\r\n        this.inactive(true);\r\n        const pt: Point = { id: s8(), x: e.x, y: e.y };\r\n        this.drawingLine = this.createDrawingLine(pt);\r\n        this.drawingLine.calculative.activeAnchor = pt;\r\n      }\r\n    } else if (this.pencil) {\r\n      this.inactive(true);\r\n      const penId = s8();\r\n      const pt: Point = { x: e.x, y: e.y, id: s8(), penId };\r\n      this.pencilLine = this.getInitPencilLine(pt);\r\n    } else {\r\n      switch (this.hoverType) {\r\n        case HoverType.None:\r\n          (this.store.data.rule || this.store.options.rule) &&\r\n            !this.store.options.disableRuleLine &&\r\n            this.addRuleLine(e);\r\n          if (this.store.options.resizeMode) {\r\n            this.hotkeyType = HotkeyType.None;\r\n          }\r\n          this.inactive();\r\n          break;\r\n        case HoverType.Node:\r\n        case HoverType.Line:\r\n          if (this.store.hover) {\r\n            if(this.store.active?.length && this.store.active.length === 1){\r\n              if(this.store.hover.id === this.store.active[0].id){\r\n                //准备移动子图元\r\n                this.calcActiveRect();\r\n                break;\r\n              }\r\n            }\r\n            const parentPen = getParent(this.store.hover, true);\r\n            let pen = parentPen || this.store.hover;\r\n            if(parentPen && (parentPen.container || this.store.options.containerShapes?.includes(parentPen.name))){\r\n              pen = this.store.hover;\r\n            }\r\n            // const pen = getParent(this.store.hover, true) || this.store.hover;\r\n            if (e.ctrlKey && !e.shiftKey) {\r\n              if (pen.calculative.active) {\r\n                this.willInactivePen = pen;\r\n              } else {\r\n                if(this.store.active.length > 0){\r\n                  pen.calculative.active = true;\r\n                  setChildrenActive(pen); // 子节点也设置为active\r\n                  this.store.active.push(pen);\r\n                  this.store.emitter.emit('active', this.store.active);\r\n                }\r\n              }\r\n              this.patchFlags = true;\r\n            } else if (e.ctrlKey && e.shiftKey && this.store.hover.parentId) {\r\n              this.active([this.store.hover]);\r\n            } else {\r\n              if(!(this.activeRect && pointInRect({x:e.x,y:e.y},this.activeRect)) || this.store.active.length == 1){ \r\n                if (!pen.calculative.active) {\r\n                  this.active([pen]);\r\n                  if (this.store.options.resizeMode) {\r\n                    this.hotkeyType = HotkeyType.Resize;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n\r\n            this.calcActiveRect();\r\n          }\r\n          break;\r\n        case HoverType.LineAnchor:\r\n          this.store.activeAnchor = this.store.hoverAnchor;\r\n          this.store.hover.calculative.activeAnchor = this.store.hoverAnchor;\r\n          this.active([this.store.hover]);\r\n          break;\r\n        case HoverType.LineAnchorPrev:\r\n        case HoverType.LineAnchorNext:\r\n          if (this.store.activeAnchor) {\r\n            // 备份，方便移动锚点方向\r\n            this.prevAnchor = { ...this.store.activeAnchor.prev };\r\n            this.nextAnchor = { ...this.store.activeAnchor.next };\r\n          }\r\n          break;\r\n        case HoverType.Resize:\r\n          this.activeInitPos = [];\r\n          this.store.active.forEach((pen) => {\r\n            this.activeInitPos.push({\r\n              x:\r\n                (pen.calculative.worldRect.x - this.activeRect.x) /\r\n                this.activeRect.width,\r\n              y:\r\n                (pen.calculative.worldRect.y - this.activeRect.y) /\r\n                this.activeRect.height,\r\n            });\r\n          });\r\n          break;\r\n      }\r\n      if(this.store.hover){\r\n        this.store.hover.calculative.mouseDown = true;\r\n      }\r\n      this.store.emitter.emit('mousedown', {\r\n        x: e.x,\r\n        y: e.y,\r\n        pen: this.store.hover,\r\n      });\r\n    }\r\n\r\n    this.render();\r\n  };\r\n\r\n  onMouseMove = (e: {\r\n    x: number;\r\n    y: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    buttons?: number;\r\n    ctrlKey?: boolean;\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n  }) => {\r\n    if (this.store.data.locked === LockState.Disable) {\r\n      this.hoverType = HoverType.None;\r\n      return;\r\n    }\r\n\r\n    // 防止异常情况导致mouseup事件没有触发\r\n    if (\r\n      this.mouseDown &&\r\n      !this.mouseDown.restore &&\r\n      e.buttons !== 1 &&\r\n      e.buttons !== 2\r\n    ) {\r\n      this.onMouseUp(e);\r\n      return;\r\n    }\r\n\r\n    // 避免鼠标点击和移动一起触发，误抖动\r\n    if (this.lastMouseTime) {\r\n      const now = performance.now();\r\n      if (now - this.lastMouseTime < 50) {\r\n        this.lastMouseTime = 0;\r\n        return;\r\n      }\r\n      this.lastMouseTime = 0;\r\n    }\r\n\r\n    this.calibrateMouse(e);\r\n    this.mousePos.x = e.x;\r\n    this.mousePos.y = e.y;\r\n    if (this.magnifierCanvas.magnifier) {\r\n      this.render();\r\n      return;\r\n    }\r\n    if(this.canvasImage.fitFlag){\r\n      if(this.canvasImage.activeFit){\r\n        const now = performance.now();\r\n        if (now - this.fitTimer > 100) {\r\n          if (this.mouseDown) {\r\n            // 容器大小变化\r\n            this.updateFit(e);\r\n          } else {\r\n            this.inFitBorder(this.mousePos);\r\n          }\r\n          this.fitTimer = now;\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (this.mouseDown && !this.store.options.disableTranslate && !this.store.data.disableTranslate) {\r\n      // 画布平移前提\r\n      if (this.mouseRight === MouseRight.Down) {\r\n        this.mouseRight = MouseRight.Translate;\r\n      }\r\n      // Translate\r\n      if (\r\n        this.store.data.locked === LockState.DisableEdit ||\r\n        this.store.data.locked === LockState.DisableScale ||\r\n        this.hotkeyType === HotkeyType.Translate ||\r\n        this.mouseRight === MouseRight.Translate\r\n      ) {\r\n        const { scale } = this.store.data;\r\n        // if (Math.abs(e.x - this.mouseDown.x) > 30) {\r\n        //   return;\r\n        // }\r\n        let x = (e.x - this.mouseDown.x) / scale;\r\n        let y = (e.y - this.mouseDown.y) / scale;\r\n        e.shiftKey && !e.ctrlKey && (y = 0);\r\n        e.ctrlKey && (x = 0);\r\n        this.translate(x, y);\r\n        return;\r\n      }\r\n\r\n      if (this.store.data.locked) {\r\n        return;\r\n      }\r\n\r\n      if (!this.drawingLine && !this.pencil) {\r\n        if (!this.drawingLineName && !this.movingAnchor) {\r\n          // 在锚点上开始连线\r\n          if (this.hoverType === HoverType.NodeAnchor) {\r\n            if(!this.store.hoverAnchor){\r\n              return;\r\n            }\r\n            this.drawingLineName = this.store.options.drawingLineName;\r\n            const pt: Point = {\r\n              id: s8(),\r\n              x: this.store.hoverAnchor.x,\r\n              y: this.store.hoverAnchor.y,\r\n            };\r\n            this.drawingLine = this.createDrawingLine(pt);\r\n            this.drawingLine.calculative.activeAnchor = pt;\r\n            connectLine(\r\n              this.store.hover,\r\n              this.store.hoverAnchor,\r\n              this.drawingLine,\r\n              pt\r\n            );\r\n\r\n            this.drawline();\r\n\r\n            return;\r\n          }\r\n        }\r\n        // 钢笔画线\r\n        else if (this.drawingLineName && this.hoverType === HoverType.None) {\r\n          const pt: Point = { id: s8(), x: e.x, y: e.y };\r\n          this.drawingLine = this.createDrawingLine(pt);\r\n          this.drawingLine.calculative.activeAnchor = pt;\r\n          this.drawline();\r\n          return;\r\n        }\r\n\r\n        // 框选\r\n        if (e.buttons === 1 &&( e.ctrlKey || !this.hoverType && !this.hotkeyType) && !( e.ctrlKey && (this.store.activeAnchor || this.store.active?.length))) {\r\n          this.dragRect = {\r\n            x: Math.min(this.mouseDown.x, e.x),\r\n            y: Math.min(this.mouseDown.y, e.y),\r\n            ex: Math.max(this.mouseDown.x, e.x),\r\n            ey: Math.max(this.mouseDown.y, e.y),\r\n            width: Math.abs(e.x - this.mouseDown.x),\r\n            height: Math.abs(e.y - this.mouseDown.y),\r\n          };\r\n          this.render();\r\n          return;\r\n        }\r\n\r\n        // 移动节点锚点\r\n        if (this.movingAnchor) {\r\n          const x = e.x - this.movingAnchor.x;\r\n          const y = e.y - this.movingAnchor.y;\r\n          this.translateAnchor(x, y);\r\n          this.render();\r\n          return;\r\n        } else if (!this.store.active[0]?.locked) {\r\n          const pt = { x: e.x, y: e.y };\r\n          // Move line anchor\r\n          if (this.hoverType === HoverType.LineAnchor) {\r\n            if (\r\n              (this.dockInAnchor(e) || this.store.active[0]?.lineName === 'line') &&\r\n              !this.store.options.disableDock &&\r\n              !this.store.options.disableLineDock\r\n            ) {\r\n              this.clearDock();\r\n\r\n              this.dock = calcAnchorDock(\r\n                this.store,\r\n                pt,\r\n                this.store.activeAnchor\r\n              );\r\n              this.dock?.xDock && (pt.x += this.dock.xDock.step);\r\n              this.dock?.yDock && (pt.y += this.dock.yDock.step);\r\n            }\r\n            this.moveLineAnchor(pt, e);\r\n            return;\r\n          }\r\n\r\n          // Move line anchor prev\r\n          if (this.hoverType === HoverType.LineAnchorPrev) {\r\n            this.moveLineAnchorPrev(e);\r\n            return;\r\n          }\r\n\r\n          // Move line anchor next\r\n          if (this.hoverType === HoverType.LineAnchorNext) {\r\n            this.moveLineAnchorNext(e);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Rotate\r\n        if (this.hoverType === HoverType.Rotate) {\r\n          this.rotatePens({ x: e.x, y: e.y });\r\n          return;\r\n        }\r\n\r\n        // Resize\r\n        if (this.hoverType === HoverType.Resize) {\r\n          this.resizePens(e);\r\n          return;\r\n        }\r\n\r\n        // Move\r\n        if (\r\n          this.hoverType === HoverType.Node ||\r\n          this.hoverType === HoverType.Line\r\n        ) {\r\n          const x = e.x - this.mouseDown.x;\r\n          const y = e.y - this.mouseDown.y;\r\n          const shake = 20;\r\n          if (\r\n            e.ctrlKey &&\r\n            !e.shiftKey &&\r\n            (Math.abs(x) >= shake || Math.abs(y) >= shake)\r\n          ) {\r\n            this.willInactivePen = undefined;\r\n          }\r\n          if (this.store.active.length === 1) {\r\n            const activePen = this.store.active[0];\r\n            if (activePen.locked === undefined || activePen.locked < LockState.DisableMove) {\r\n              activePen?.onMouseMove?.(activePen, this.mousePos);\r\n            }\r\n            if(activePen.calculative.focus){\r\n              //执行图元的操作\r\n              return;\r\n            }\r\n          }\r\n          this.movePens(e);\r\n          //图元是否进入容器图元\r\n          this.getContainerHover(e);\r\n          return;\r\n        }\r\n      } else if (this.pencil) {\r\n        const {x,y} = e;\r\n        const pt: Point = {x,y};\r\n        pt.id = s8();\r\n        pt.penId = this.pencilLine.id;\r\n        this.pencilLine.calculative.worldAnchors.push(pt);\r\n        this.store.path2dMap.set(\r\n          this.pencilLine,\r\n          globalStore.path2dDraws[this.pencilLine.name](this.pencilLine)\r\n        );\r\n        this.patchFlags = true;\r\n      }\r\n    }\r\n\r\n    if (this.drawingLine) {\r\n      const {x,y} = e;\r\n      const pt: Point = {x,y};\r\n      pt.id = s8();\r\n      pt.penId = this.drawingLine.id;\r\n\r\n      // dock\r\n      if (\r\n        !this.store.options.disableDock &&\r\n        !this.store.options.disableLineDock\r\n      ) {\r\n        this.clearDock();\r\n        this.dock = calcAnchorDock(this.store, pt);\r\n        this.dock?.xDock && (pt.x += this.dock.xDock.step);\r\n        this.dock?.yDock && (pt.y += this.dock.yDock.step);\r\n      }\r\n      if (\r\n        this.mouseDown &&\r\n        this.drawingLineName === 'curve' &&\r\n        !this.drawingLine.calculative.worldAnchors[0].connectTo\r\n      ) {\r\n        this.drawline(pt);\r\n      } else {\r\n        let to: Point;\r\n        if (this.drawingLine.calculative.worldAnchors.length > 1) {\r\n          to = getToAnchor(this.drawingLine);\r\n        }\r\n\r\n        if (to) {\r\n          to.prev = undefined;\r\n          to.next = undefined;\r\n          if (!to.id) {\r\n            to.id = s8();\r\n          }\r\n          to.x = pt.x;\r\n          to.y = pt.y;\r\n          to.connectTo = undefined;\r\n        } else {\r\n          to = { ...pt };\r\n          this.drawingLine.calculative.worldAnchors.push(to);\r\n        }\r\n        if (\r\n          this.hoverType === HoverType.NodeAnchor ||\r\n          this.hoverType === HoverType.LineAnchor\r\n        ) {\r\n          if (this.store.hoverAnchor.type !== PointType.Line) {\r\n            to.x = this.store.hoverAnchor.x;\r\n            to.y = this.store.hoverAnchor.y;\r\n          }\r\n          to.connectTo = this.store.hoverAnchor.penId;\r\n          if (this.drawingLineName === 'polyline') {\r\n            to.isTemp = false;\r\n          }\r\n        }\r\n\r\n        if (this.drawingLineName === 'line') {\r\n          if (e.ctrlKey && !e.shiftKey) {\r\n            to.x =\r\n              this.drawingLine.calculative.worldAnchors[\r\n                this.drawingLine.calculative.worldAnchors.length - 2\r\n              ].x;\r\n          } else if (e.shiftKey && !e.ctrlKey) {\r\n            to.y =\r\n              this.drawingLine.calculative.worldAnchors[\r\n                this.drawingLine.calculative.worldAnchors.length - 2\r\n              ].y;\r\n          } else if (e.shiftKey && e.ctrlKey) {\r\n            let last =\r\n              this.drawingLine.calculative.worldAnchors[\r\n                this.drawingLine.calculative.worldAnchors.length - 2\r\n              ];\r\n            this.getSpecialAngle(to, last);\r\n          }\r\n        }\r\n\r\n        this.drawline();\r\n      }\r\n    }\r\n\r\n    globalThis.debug && console.time('hover');\r\n    const now = performance.now();\r\n    if (now - this.hoverTimer > 50) {\r\n      this.hoverTimer = now;\r\n      this.getHover(e);\r\n    }\r\n    globalThis.debug && console.timeEnd('hover');\r\n    if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n      this.patchFlags = true;\r\n    }\r\n    this.render(false);\r\n  };\r\n\r\n  onMouseUp = (e: {\r\n    x: number;\r\n    y: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    buttons?: number;\r\n    ctrlKey?: boolean;\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n    button?: number;\r\n  }) => {\r\n    if (this.store.data.locked === LockState.Disable) {\r\n      this.hoverType = HoverType.None;\r\n      return;\r\n    }\r\n\r\n    if (!this.mouseDown) {\r\n      return;\r\n    }\r\n\r\n    if (this.mouseRight === MouseRight.Down) {\r\n      if(this.store.hover && this.store.hover.onContextmenu){\r\n        this.store.hover.onContextmenu(this.store.hover, e);\r\n      }else{\r\n        this.store.emitter.emit('contextmenu', {\r\n          e,\r\n          clientRect: this.clientRect,\r\n          pen: this.store.hover,\r\n        });\r\n      }\r\n    }\r\n    this.mouseRight = MouseRight.None;\r\n\r\n    this.calibrateMouse(e);\r\n    this.mousePos.x = e.x;\r\n    this.mousePos.y = e.y;\r\n    this.pencil && this.finishPencil();\r\n\r\n    if (this.drawingLine) {\r\n      // 在锚点上，完成绘画\r\n      if (this.store.hoverAnchor) {\r\n        const to = getToAnchor(this.drawingLine);\r\n        if (this.store.hoverAnchor.type === PointType.Line) {\r\n          getDistance(to, this.store.hoverAnchor, this.store);\r\n        } else {\r\n          to.x = this.store.hoverAnchor.x;\r\n          to.y = this.store.hoverAnchor.y;\r\n        }\r\n        connectLine(\r\n          this.store.hover,\r\n          this.store.hoverAnchor,\r\n          this.drawingLine,\r\n          to\r\n        );\r\n        this.drawline();\r\n        this.finishDrawline(true);\r\n\r\n        return;\r\n      }\r\n\r\n      // 自动锚点（单击节点），完成绘画\r\n      if (this.store.options.autoAnchor && this.hoverType === HoverType.Node) {\r\n        const to = getToAnchor(this.drawingLine);\r\n        const anchor = nearestAnchor(this.store.hover, e);\r\n        to.x = anchor.x;\r\n        to.y = anchor.y;\r\n        this.drawingLine.autoTo = true;\r\n        connectLine(this.store.hover, anchor, this.drawingLine, to);\r\n        this.drawline();\r\n        this.finishDrawline(true);\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    // 拖拽连线锚点\r\n    if (\r\n      this.hoverType === HoverType.LineAnchor &&\r\n      this.store.hover &&\r\n      this.store.active[0] &&\r\n      this.store.active[0].name === 'line' &&\r\n      this.store.active[0] !== this.store.hover\r\n    ) {\r\n      const line = this.store.active[0];\r\n      const from = getFromAnchor(line);\r\n      const to = getToAnchor(line);\r\n      if (this.store.hoverAnchor) {\r\n        const hover = this.store.hover;\r\n        const isHoverFrom = getFromAnchor(hover) === this.store.hoverAnchor;\r\n        const isHoverTo = getToAnchor(hover) === this.store.hoverAnchor;\r\n        const isActiveFrom = from === this.store.activeAnchor;\r\n        const isActiveTo = to === this.store.activeAnchor;\r\n        if (\r\n          (e.ctrlKey || e.altKey) &&\r\n          hover.type === PenType.Line &&\r\n          (isHoverFrom || isHoverTo) &&\r\n          (isActiveFrom || isActiveTo)\r\n        ) {\r\n          // 合并连线\r\n          const hoverAnchors: Point[] = hover.calculative.worldAnchors.map(\r\n            (anchor) => {\r\n              return {\r\n                ...anchor,\r\n                penId: line.id,\r\n              };\r\n            }\r\n          );\r\n          if (isHoverFrom) {\r\n            hoverAnchors.shift();\r\n          } else if (isHoverTo) {\r\n            hoverAnchors.pop();\r\n          }\r\n          if ((isHoverFrom && isActiveFrom) || (isHoverTo && isActiveTo)) {\r\n            hoverAnchors.reverse();\r\n          }\r\n          if (isActiveFrom) {\r\n            line.calculative.worldAnchors[0].connectTo = undefined;\r\n            line.calculative.worldAnchors.unshift(...hoverAnchors);\r\n          } else if (isActiveTo) {\r\n            line.calculative.worldAnchors[\r\n              line.calculative.worldAnchors.length - 1\r\n            ].connectTo = undefined;\r\n            line.calculative.worldAnchors.push(...hoverAnchors);\r\n          }\r\n          this.delete([hover]);\r\n          // TODO: 历史记录\r\n\r\n          this.render();\r\n        } else {\r\n          // 连接连线\r\n          if (this.store.activeAnchor) {\r\n            /**\r\n             * 线的锚点需要存所连接锚点的位置\r\n             */\r\n            if (this.store.hoverAnchor.type === PointType.Line) {\r\n              getDistance(\r\n                this.store.activeAnchor,\r\n                this.store.hoverAnchor,\r\n                this.store\r\n              );\r\n            } else {\r\n              this.store.activeAnchor.x = this.store.hoverAnchor.x;\r\n              this.store.activeAnchor.y = this.store.hoverAnchor.y;\r\n            }\r\n            connectLine(\r\n              this.store.hover,\r\n              this.store.hoverAnchor,\r\n              line,\r\n              this.store.activeAnchor\r\n            );\r\n          }\r\n        }\r\n        if (this[line.lineName] && line.lineName !== 'polyline') {\r\n          this[line.lineName](this.store, line);\r\n        }\r\n        this.store.path2dMap.set(line, globalStore.path2dDraws.line(line));\r\n        this.initLineRect(line);\r\n      } else {\r\n        // 连线起始点自动关联 到 pen\r\n        if (from === this.store.activeAnchor && line.autoFrom) {\r\n          this.calcAutoAnchor(line, from, this.store.hover);\r\n        } else if (to === this.store.activeAnchor && line.autoTo) {\r\n          this.calcAutoAnchor(line, to, this.store.hover);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add pen\r\n    if (this.addCaches && this.addCaches.length) {\r\n      if (!this.store.data.locked) {\r\n        if (this.dragRect) {\r\n          // 只存在一个缓存图元\r\n          if (this.addCaches.length === 1) {\r\n            const target = this.addCaches[0];\r\n            target.width = this.dragRect.width / this.store.data.scale;\r\n            target.height = this.dragRect.height / this.store.data.scale;\r\n            e.x = (this.dragRect.x + this.dragRect.ex) / 2;\r\n            e.y = (this.dragRect.y + this.dragRect.ey) / 2;\r\n          }\r\n        }\r\n        this.dropPens(this.addCaches, e);\r\n      }\r\n      this.addCaches = undefined;\r\n    }\r\n\r\n    // Rotate\r\n    if (this.hoverType === HoverType.Rotate) {\r\n      this.getSizeCPs();\r\n      this.store.active.forEach((pen) => {\r\n        pen.rotate = pen.calculative.rotate;\r\n      });\r\n    }\r\n\r\n    this.patchFlagsLines.forEach((pen) => {\r\n      if (pen.type) {\r\n        this.initLineRect(pen);\r\n      }\r\n    });\r\n    this.patchFlagsLines.clear();\r\n\r\n    if (this.dragRect) {\r\n      if(this.canvasImage.fitFlag){\r\n        this.makeFit();\r\n      }else{\r\n        const pens = this.store.data.pens.filter((pen) => {\r\n          if (\r\n            pen.visible === false ||\r\n            pen.locked >= LockState.DisableMove ||\r\n            pen.parentId || pen.isRuleLine\r\n          ) {\r\n            return false;\r\n          }\r\n          if (\r\n            rectInRect(\r\n              pen.calculative.worldRect,\r\n              this.dragRect,\r\n              e.ctrlKey || this.store.options.dragAllIn\r\n            )\r\n          ) {\r\n            // 先判断在区域内，若不在区域内，则锚点肯定不在框选区域内，避免每条连线过度计算\r\n            if (pen.type === PenType.Line && !this.store.options.dragAllIn) {\r\n              return lineInRect(pen, this.dragRect);\r\n            }\r\n            return true;\r\n          }\r\n        });\r\n        //框选\r\n        this.active(pens);\r\n      }\r\n    }\r\n\r\n    if (e.button !== 2) {\r\n      if (distance(this.mouseDown, e) < 2) {\r\n        if (this.store.hover && this.store.hover.input) {\r\n          this.showInput(this.store.hover);\r\n        }\r\n        this.store.emitter.emit('click', {\r\n          x: e.x,\r\n          y: e.y,\r\n          pen: this.store.hover,\r\n        });\r\n      }\r\n\r\n      if(this.store.hover){\r\n        this.store.hover.calculative.mouseDown = false;\r\n      }\r\n      if(this.store.hover != this.store.hoverContainer) {\r\n        this.store.emitter.emit('mouseup', {\r\n          x: e.x,\r\n          y: e.y,\r\n          pen: this.store.hover,\r\n        });\r\n      } \r\n      this.store.emitter.emit('mouseup', {\r\n        x: e.x,\r\n        y: e.y,\r\n        pen: this.store.hoverContainer,\r\n      });\r\n    }\r\n\r\n    if (this.willInactivePen) {\r\n      this.willInactivePen.calculative.active = undefined;\r\n      setChildrenActive(this.willInactivePen, false); // 子节点取消激活\r\n      const index = this.store.active.findIndex((p) => p === this.willInactivePen);\r\n      if(index >= 0) {\r\n        this.store.active.splice(index,1);\r\n      }\r\n      this.calcActiveRect();\r\n      this.willInactivePen = undefined;\r\n      this.store.emitter.emit('inactive', [this.willInactivePen]);\r\n      this.render();\r\n    }\r\n\r\n    if (this.movingPens) {\r\n      if (e.altKey && !e.shiftKey) {\r\n        this.copyMovedPens();\r\n      } else {\r\n        this.movedActivePens(e.ctrlKey && e.shiftKey);\r\n      }\r\n      this.getAllByPens(this.movingPens).forEach((pen) => {\r\n        this.store.pens[pen.id] = undefined;\r\n      });\r\n      this.movingPens = undefined;\r\n    }\r\n\r\n    if (this.store.active && this.store.active[0]) {\r\n      this.store.active[0].calculative.h = undefined;\r\n    }\r\n\r\n    this.mouseDown = undefined;\r\n    this.lastOffsetX = 0;\r\n    this.lastOffsetY = 0;\r\n    this.clearDock();\r\n    this.dragRect = undefined;\r\n    this.initActiveRect = undefined;\r\n    this.render();\r\n  };\r\n\r\n  private addRuleLine(e: { x: number; y: number; ctrlKey?: boolean }) {\r\n    const { x: offsetX, y: offsetY, scale, origin } = this.store.data;\r\n    // 靠近左上角的 x ，y\r\n    const x = e.x + offsetX;\r\n    const y = e.y + offsetY;\r\n    let lineX = e.x;\r\n    let lineY = e.y;\r\n    let width = 0;\r\n    let height = 0;\r\n    let otherPX = 0;\r\n    let otherPY = 0;\r\n    if (x <= y && x < 20) {\r\n      // 绘制一条水平线\r\n      lineX = -offsetX;\r\n      width = this.width;\r\n      otherPX = 1;\r\n      if (!e.ctrlKey) {\r\n        //找最近的标尺线\r\n        lineY =\r\n          Math.round((lineY - origin.y) / (scale * 10)) * (scale * 10) +\r\n          origin.y;\r\n      }\r\n    } else if (y < x && y < 20) {\r\n      // 绘制一条垂直线\r\n      lineY = -offsetY;\r\n      height = this.height;\r\n      otherPY = 1;\r\n      if (!e.ctrlKey) {\r\n        //找最近的标尺线\r\n        lineX =\r\n          Math.round((lineX - origin.x) / (scale * 10)) * (scale * 10) +\r\n          origin.x;\r\n      }\r\n    } else {\r\n      return;\r\n    }\r\n    this.addPen({\r\n      isRuleLine: true,\r\n      // locked: LockState.DisableMove,\r\n      type: PenType.Line,\r\n      name: 'line',\r\n      lineName: 'line',\r\n      x: lineX,\r\n      y: lineY,\r\n      width,\r\n      height,\r\n      color: this.store.options.ruleLineColor,\r\n      anchors: [\r\n        {\r\n          x: 0,\r\n          y: 0,\r\n        },\r\n        {\r\n          x: otherPX,\r\n          y: otherPY,\r\n        },\r\n      ],\r\n    });\r\n  }\r\n\r\n  clearRuleLines() {\r\n    this.delete(this.ruleLines);\r\n  }\r\n\r\n  get ruleLines (){\r\n    return this.store.data.pens.filter(p =>p.isRuleLine);\r\n  }\r\n  /**\r\n   * @description 调整pen的坐标，让pen按照网格自动对齐\r\n   * @author Joseph Ho\r\n   * @date 14/11/2023\r\n   * @memberof Canvas\r\n   */\r\n  alignPenToGrid(pen: Pen) {\r\n    const autoAlignGrid =\r\n      this.store.options.autoAlignGrid && this.store.data.grid;\r\n    // 如果开启了自动网格,并且不是连线，则使pen对齐网格\r\n    if (autoAlignGrid && !pen.type) {\r\n      const gridSize = this.store.data.gridSize || this.store.options.gridSize;\r\n      const { origin, scale } = this.store.data;\r\n      const { x, y } = pen;\r\n      const obj = { x, y };\r\n      const rect = this.getPenRect(pen);\r\n      // 算出偏移了多少个网格\r\n      const m = parseInt((rect.x / gridSize).toFixed());\r\n      const n = parseInt((rect.y / gridSize).toFixed());\r\n      const x1 = m * gridSize;\r\n      const y1 = n * gridSize;\r\n      // 算出最终的偏移坐标\r\n      obj.x = origin.x + x1 * scale;\r\n      obj.y = origin.y + y1 * scale;\r\n      Object.assign(pen, obj);\r\n      pen.onMove?.(pen);\r\n      this.updatePenRect(pen);\r\n      this.calcActiveRect();\r\n      this.getSizeCPs();\r\n    }\r\n  }\r\n  /**\r\n   * 拖拽结束，数据更新到 active.pens\r\n   */\r\n  private movedActivePens(readyConnect?: boolean) {\r\n    // 鼠标松手才更新，此处是更新前的值\r\n    //follower\r\n    let movedPens:Pen[] = this.getAllFollowersByPens(this.store.active,false);\r\n    const initPens = deepClone(movedPens, true);\r\n    // const pens = deepClone(this.store.active, true);\r\n    const gridSize = this.store.data.gridSize || this.store.options.gridSize;\r\n    const { origin, scale } = this.store.data;\r\n    const autoAlignGrid =\r\n      this.store.options.autoAlignGrid && this.store.data.grid;\r\n      movedPens.forEach((pen) => {\r\n      const i = this.movingPens.findIndex((item) => item.id === pen.id+movingSuffix);\r\n      if(i<0){\r\n        return;\r\n      }\r\n      const { x, y } = this.movingPens[i];\r\n      const obj = { x, y };\r\n      // 根据是否开启了自动网格对齐，来修正坐标\r\n      if (autoAlignGrid && !this.movingPens[i].type) {\r\n        const rect = this.getPenRect(this.movingPens[i]);\r\n        // 算出偏移了多少个网格\r\n        const m = parseInt((rect.x / gridSize).toFixed());\r\n        const n = parseInt((rect.y / gridSize).toFixed());\r\n        const x1 = m * gridSize;\r\n        const y1 = n * gridSize;\r\n        // 算出最终的偏移坐标\r\n        obj.x = origin.x + x1 * scale;\r\n        obj.y = origin.y + y1 * scale;\r\n      }\r\n      Object.assign(pen, obj);\r\n      pen.onMove?.(pen);\r\n      this.updatePenRect(pen);\r\n      this.updateLines(pen);\r\n      this.store.emitter.emit('updateLines', pen);\r\n      // TODO: mouseup 中重复执行 patchFlagsLines\r\n      this.patchFlagsLines.forEach((pen) => {\r\n        if (pen.type) {\r\n          this.initLineRect(pen);\r\n        }\r\n      });\r\n      this.patchFlagsLines.clear();\r\n      pen.calculative.x = pen.x;\r\n      pen.calculative.y = pen.y;\r\n      if (pen.calculative.initRect) {\r\n        pen.calculative.initRect.x = pen.calculative.x;\r\n        pen.calculative.initRect.y = pen.calculative.y;\r\n        pen.calculative.initRect.ex = pen.calculative.x + pen.calculative.width;\r\n        pen.calculative.initRect.ey =\r\n          pen.calculative.y + pen.calculative.height;\r\n      }\r\n      calcChildrenInitRect(pen);\r\n      if(pen.parentId){\r\n        //移动子图元，更新整个组件\r\n        this.parent.updateRectbyChild(pen.calculative.worldRect,pen,this.store.pens[pen.parentId]);\r\n      }\r\n    });\r\n    // active 消息表示拖拽结束\r\n    // this.store.emitter.emit('active', this.store.active);\r\n    this.initImageCanvas(this.store.active);\r\n    this.initTemplateCanvas(this.store.active);\r\n    // 避免选中图元的出错情况，this.dock为undefined\r\n    if (!this.dock) return;\r\n    const { xDock, yDock } = this.dock;\r\n    let dockPen: Pen;\r\n    if (xDock) {\r\n      dockPen = this.store.pens[xDock.penId];\r\n    }\r\n    if (!dockPen && yDock) {\r\n      dockPen = this.store.pens[yDock.penId];\r\n    }\r\n    const pens = deepClone(this.store.active, true);\r\n    // 移动到连线端点，自动连线\r\n    if (\r\n      readyConnect &&\r\n      this.store.active.length === 1 &&\r\n      dockPen?.type === 1 &&\r\n      (xDock?.anchorId || yDock?.anchorId)\r\n    ) {\r\n      const from = getFromAnchor(dockPen);\r\n      const to = getToAnchor(dockPen);\r\n\r\n      if (xDock?.anchorId) {\r\n        const anchor = this.store.pens[\r\n          this.store.active[0].id + movingSuffix\r\n        ].calculative.worldAnchors.find((item) => item.id === xDock.anchorId);\r\n        if (anchor.x === from.x && anchor.y === from.y) {\r\n          initPens.push(deepClone(dockPen, true));\r\n          connectLine(this.store.active[0], anchor, dockPen, from);\r\n          pens.push(deepClone(dockPen, true));\r\n        } else if (anchor.x === to.x && anchor.y === to.y) {\r\n          initPens.push(deepClone(dockPen, true));\r\n          connectLine(this.store.active[0], anchor, dockPen, to);\r\n          pens.push(deepClone(dockPen, true));\r\n        }\r\n      } else if (yDock?.anchorId) {\r\n        const anchor = this.store.pens[\r\n          this.store.active[0].id + movingSuffix\r\n        ].calculative.worldAnchors.find((item) => item.id === yDock.anchorId);\r\n\r\n        if (anchor.x === from.x && anchor.y === from.y) {\r\n          initPens.push(deepClone(dockPen, true));\r\n          connectLine(this.store.active[0], anchor, dockPen, from);\r\n          pens.push(deepClone(dockPen, true));\r\n        } else if (anchor.x === to.x && anchor.y === to.y) {\r\n          initPens.push(deepClone(dockPen, true));\r\n          connectLine(this.store.active[0], anchor, dockPen, to);\r\n          pens.push(deepClone(dockPen, true));\r\n        }\r\n      }\r\n    }\r\n    // 如果开启自动网格对齐，则需要重算activeRect和sizeCPs\r\n    if (autoAlignGrid) {\r\n      this.calcActiveRect();\r\n      this.getSizeCPs();\r\n    }\r\n    // 此处是更新后的值\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      pens,\r\n      initPens,\r\n    });\r\n    this.store.emitter.emit('translatePens', pens);\r\n  }\r\n\r\n  /**\r\n   * 复制移动后的笔\r\n   */\r\n  private copyMovedPens() {\r\n    // 复制行为\r\n    this.copy(\r\n      this.store.active.map((pen, i: number) => {\r\n        // TODO: 移动只更改 x,y 值，不更新其他属性\r\n        // 若需要更改 anchors ，注意 anchors connectTo 问题\r\n        // const { x, y, width, height, anchors } = this.movingPens[i];\r\n        /**\r\n         * TODO: line 类型无法取到移动后的 x，y 值\r\n         * 所以 patchFlagsLines 需要放到 copyMovedPens 前\r\n         * */\r\n        const { x, y } = this.movingPens[i];\r\n        this.updateLines(pen); //复制前更新被复制节点的连接关系\r\n        return {\r\n          ...pen,\r\n          x,\r\n          y,\r\n        };\r\n      })\r\n    );\r\n    // 偏移量 0\r\n    this.pasteOffset = false;\r\n    this.paste();\r\n  }\r\n\r\n  /**\r\n   * 若本次改变的画笔存在图片，并且在上层 or 下层，需要擦除上层 or 下层\r\n   * 子节点中包含图片，也需要重绘\r\n   * @param pens 本次改变的 pens\r\n   */\r\n  initImageCanvas(pens: Pen[]) {\r\n    pens.some((pen) => this.hasImage(pen, false)) && this.canvasImage.init();\r\n    pens.some((pen) => this.hasImage(pen, true)) &&\r\n      this.canvasImageBottom.init();\r\n  }\r\n\r\n  initTemplateCanvas(pens: Pen[]) {\r\n    // pens.some((pen) => pen.template !== undefined) &&\r\n    //   this.canvasTemplate.init();\r\n    pens.some((pen) => pen.canvasLayer === CanvasLayer.CanvasTemplate) &&\r\n      this.canvasTemplate.init();\r\n  }\r\n\r\n  private hasImage(pen: Pen, isBottom: boolean): boolean {\r\n    // if (pen.image && pen.name !== 'gif' && !pen.isBottom == !isBottom) {\r\n    //   return true;\r\n    // }\r\n    if (pen.image && pen.name !== 'gif') {\r\n      if (isBottom) {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasImageBottom) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasImage) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return pen.children?.some((childId: string) => {\r\n      const child = this.store.pens[childId];\r\n      return child && this.hasImage(child, isBottom);\r\n    });\r\n  }\r\n\r\n  private clearDock = () => {\r\n    const xPenId = this.dock?.xDock?.penId;\r\n    const yPenId = this.dock?.yDock?.penId;\r\n    const xPen = this.store.pens[xPenId];\r\n    if (xPen) {\r\n      xPen.calculative.isDock = false;\r\n    }\r\n    const yPen = this.store.pens[yPenId];\r\n    if (yPen) {\r\n      yPen.calculative.isDock = false;\r\n    }\r\n    this.dock = undefined;\r\n  };\r\n\r\n  inactive(drawing?: boolean) {\r\n    if (!this.store.active.length) {\r\n      return;\r\n    }\r\n    this.initTemplateCanvas(this.store.active);\r\n    this.store.active.forEach((pen) => {\r\n      pen.calculative.active = undefined;\r\n      pen.calculative.activeAnchor = undefined;\r\n      pen.calculative.hover = false;\r\n      setChildrenActive(pen, false);\r\n    });\r\n    !drawing && this.store.emitter.emit('inactive', this.store.active);\r\n    this.store.active = [];\r\n    this.activeRect = undefined;\r\n    this.sizeCPs = undefined;\r\n    this.store.activeAnchor = undefined;\r\n    this.patchFlags = true;\r\n  }\r\n\r\n  active(pens: Pen[], emit = true) {\r\n    if (this.store.active) {\r\n      emit && this.store.emitter.emit('inactive', this.store.active);\r\n      for (const pen of this.store.active) {\r\n        pen.calculative.active = undefined;\r\n        pen.calculative.hover = false;\r\n        setChildrenActive(pen, false);\r\n      }\r\n    }\r\n    this.store.active = [];\r\n    pens.forEach((pen) => {\r\n      pen.calculative.active = true;\r\n      setChildrenActive(pen);\r\n    });\r\n    this.store.active.push(...pens);\r\n    this.activeRect = undefined;\r\n    this.calcActiveRect();\r\n    this.initTemplateCanvas(pens);\r\n    this.patchFlags = true;\r\n    emit && this.store.emitter.emit('active', this.store.active);\r\n  }\r\n\r\n  getSizeCPs() {\r\n    this.sizeCPs = rectToPoints(this.activeRect);\r\n    // 正上 正右 正下 正左\r\n    const pts = [\r\n      { x: 0.5, y: 0 },\r\n      { x: 1, y: 0.5 },\r\n      { x: 0.5, y: 1 },\r\n      { x: 0, y: 0.5 },\r\n    ] as const;\r\n    const { x, y, width, height, rotate, center } = this.activeRect;\r\n    pts.forEach((pt) => {\r\n      const p = {\r\n        x: pt.x * width + x,\r\n        y: pt.y * height + y,\r\n      };\r\n      rotatePoint(p, rotate, center);\r\n      this.sizeCPs.push(p);\r\n    });\r\n  }\r\n\r\n  getSpecialAngle(to: Point, last: Point) {\r\n    //快捷定位到特殊角度\r\n    let angle = 0;\r\n    let angleArr = [0, 30, 45, 60, 90, 120, 150, 135, 180];\r\n    //获取实际角度\r\n    if (to.x - last.x !== 0) {\r\n      angle = (Math.atan((last.y - to.y) / (to.x - last.x)) * 180) / Math.PI;\r\n      if (to.x < last.x) {\r\n        if (angle > 0) {\r\n          angle -= 180;\r\n        } else {\r\n          angle += 180;\r\n        }\r\n      }\r\n    } else {\r\n      if (last.y > to.y) {\r\n        angle = 90;\r\n      } else if (last.y < to.y) {\r\n        angle = -90;\r\n      }\r\n    }\r\n    //取最近角度\r\n    // let _min = 999;\r\n    // let index = -1;\r\n    // for (let i = 0; i < angleArr.length; i++) {\r\n    //   if (angle < 0) {\r\n    //     if (Math.abs(angle + angleArr[i]) < _min) {\r\n    //       index = i;\r\n    //       _min = Math.abs(angle + angleArr[i]);\r\n    //     }\r\n    //   } else {\r\n    //     if (Math.abs(angle - angleArr[i]) < _min) {\r\n    //       index = i;\r\n    //       _min = Math.abs(angle - angleArr[i]);\r\n    //     }\r\n    //   }\r\n    // }\r\n    // if (angle < 0) {\r\n    //   angle = -angleArr[index];\r\n    // } else {\r\n    //   angle = angleArr[index];\r\n    // }\r\n    angle = Math.round(angle / 15) * 15;\r\n    let length = Math.sqrt(\r\n      (last.x - to.x) * (last.x - to.x) + (last.y - to.y) * (last.y - to.y)\r\n    );\r\n    to.x = last.x + Math.cos((angle / 180) * Math.PI) * length;\r\n    to.y = last.y - Math.sin((angle / 180) * Math.PI) * length;\r\n  }\r\n\r\n  onResize = () => {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.resize();\r\n      this.timer = undefined;\r\n    }, 100);\r\n  };\r\n\r\n  onScroll = () => {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.clientRect = this.canvas.getBoundingClientRect();\r\n      this.timer = undefined;\r\n    }, 100);\r\n  };\r\n\r\n  calibrateMouse = (pt: Point) => {\r\n    pt.x -= this.store.data.x;\r\n    pt.y -= this.store.data.y;\r\n    return pt;\r\n  };\r\n\r\n  clearHover() {\r\n    this.hoverType = HoverType.None;\r\n    this.store.hover = null;\r\n    this.store.hoverAnchor = null;\r\n  }\r\n\r\n  private getContainerHover = (pt: Point) => {\r\n    if (this.dragRect) {\r\n      return;\r\n    }\r\n    this.store.hoverContainer = undefined;\r\n    const containerPens:Pen[] = this.store.data.pens.filter((pen)=>pen.container||this.store.options.containerShapes?.includes(pen.name));\r\n    if(containerPens.length){\r\n      for(let i=containerPens.length-1;i>=0;--i){\r\n        const pen = containerPens[i];\r\n        if (\r\n          pen.visible == false ||\r\n          pen.calculative.inView == false ||\r\n          pen.locked === LockState.Disable\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        if (\r\n          pointInRect(pt, pen.calculative.worldRect)\r\n        ) {\r\n          this.store.hoverContainer = pen;\r\n          pen?.onMouseMove?.(pen, pt);\r\n          if (this.store.lastHoverContainer !== this.store.hoverContainer) {\r\n            this.patchFlags = true;\r\n            if (this.store.lastHoverContainer) {\r\n              this.store.lastHoverContainer.calculative.containerHover = false;\r\n              this.store.emitter.emit('leave', this.store.lastHoverContainer);\r\n            }\r\n            if (this.store.hoverContainer) {\r\n              this.store.hoverContainer.calculative.containerHover = true;\r\n              this.store.emitter.emit('enter', this.store.hoverContainer);\r\n            }\r\n            this.store.lastHoverContainer = this.store.hoverContainer;\r\n          }\r\n        }else{\r\n          if(pen === this.store.hoverContainer){\r\n            this.store.hoverContainer = undefined;\r\n            if(this.store.lastHoverContainer !== this.store.hoverContainer){\r\n              this.patchFlags = true;\r\n              const movingPen =\r\n              this.store.lastHoverContainer.calculative.canvas.store.pens[this.store.lastHoverContainer.id + movingSuffix];\r\n              if (this.store.lastHoverContainer && !movingPen) {\r\n                this.store.lastHoverContainer.calculative.containerHover = false;\r\n                this.store.emitter.emit('leave', this.store.lastHoverContainer);\r\n              }\r\n              this.store.lastHoverContainer = this.store.hoverContainer;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private getHover = (pt: Point) => {\r\n    if (this.dragRect) {\r\n      return;\r\n    }\r\n    if(this.canvasImage.fitFlag){\r\n      return;\r\n    }\r\n    let hoverType = HoverType.None;\r\n    this.store.hover = undefined;\r\n    this.store.hoverAnchor = undefined;\r\n    this.title.hide();\r\n    this.store.pointAt = undefined;\r\n    this.store.pointAtIndex = undefined;\r\n    const activeLine =\r\n      this.store.active.length === 1 && this.store.active[0].type;\r\n    if (\r\n      !this.drawingLineName &&\r\n      this.hotkeyType !== HotkeyType.AddAnchor &&\r\n      this.activeRect &&\r\n      !activeLine &&\r\n      !this.store.data.locked\r\n    ) {\r\n      const activePensLock = getPensLock(this.store.active);\r\n      const activePensDisableRotate =\r\n        getPensDisableRotate(this.store.active) ||\r\n        this.store.options.disableRotate;\r\n      const activePensDisableResize =\r\n        getPensDisableResize(this.store.active) ||\r\n        this.store.options.disableSize;\r\n      if (!activePensLock && !activePensDisableRotate) {\r\n        const rotatePt = {\r\n          x: this.activeRect.center.x,\r\n          y: this.activeRect.y - 30,\r\n        };\r\n        if (this.activeRect.rotate) {\r\n          rotatePoint(rotatePt, this.activeRect.rotate, this.activeRect.pivot || this.activeRect.center);\r\n        }\r\n        // 旋转控制点\r\n        if (!this.hotkeyType && hitPoint(pt, rotatePt, this.pointSize)) {\r\n          hoverType = HoverType.Rotate;\r\n          this.externalElements.style.cursor = `url(\"${this.store.options.rotateCursor}\"), auto`;\r\n        }\r\n      }\r\n\r\n      // 大小控制点\r\n      if (!activePensLock && !activePensDisableResize) {\r\n        for (let i = 0; i < 8; i++) {\r\n          const firstFour = i < 4;\r\n          const hotKeyIsResize =\r\n            this.hotkeyType === HotkeyType.Resize ||\r\n            (firstFour && !this.hotkeyType);\r\n          if (hotKeyIsResize && hitPoint(pt, this.sizeCPs[i], this.pointSize)) {\r\n            let cursors = firstFour ? defaultCursors : rotatedCursors;\r\n            let offset = 0;\r\n            if (Math.abs((this.activeRect.rotate % 90) - 45) < 25) {\r\n              cursors = firstFour ? rotatedCursors : defaultCursors;\r\n              offset =\r\n                Math.round((this.activeRect.rotate - 45) / 90) +\r\n                (firstFour ? 0 : 1);\r\n            } else {\r\n              offset = Math.round(this.activeRect.rotate / 90);\r\n            }\r\n            hoverType = HoverType.Resize;\r\n            this.resizeIndex = i;\r\n            this.externalElements.style.cursor = cursors[(i + offset) % 4];\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (hoverType === HoverType.None) {\r\n      hoverType = this.inPens(pt, this.store.data.pens);\r\n    }\r\n\r\n    if (!hoverType && !activeLine && pointInRect(pt, this.activeRect)) {\r\n      hoverType = HoverType.Node;\r\n      this.externalElements.style.cursor = 'move';\r\n    }\r\n    this.hoverType = hoverType;\r\n    if (hoverType === HoverType.None) {\r\n      if (this.drawingLineName || this.pencil) {\r\n        this.externalElements.style.cursor = 'crosshair';\r\n      } else if (!this.mouseDown) {\r\n        this.externalElements.style.cursor = 'default';\r\n      }\r\n      this.store.hover = undefined;\r\n    }\r\n\r\n    if (this.store.lastHover !== this.store.hover) {\r\n      this.patchFlags = true;\r\n      if (this.store.lastHover) {\r\n        this.store.lastHover.calculative.hover = false;\r\n        setHover(\r\n          getParent(this.store.lastHover, true) || this.store.lastHover,\r\n          false\r\n        );\r\n        this.store.emitter.emit('leave', this.store.lastHover);\r\n        this.tooltip.hide();\r\n      }\r\n      if (this.store.hover) {\r\n        this.store.hover.calculative.hover = true;\r\n        setHover(getParent(this.store.hover, true) || this.store.hover);\r\n        this.store.emitter.emit('enter', this.store.hover);\r\n        this.tooltip.show(this.store.hover, pt);\r\n      }\r\n      this.store.lastHover = this.store.hover;\r\n    }\r\n\r\n    this.store.hover?.onMouseMove?.(this.store.hover, this.mousePos);\r\n  };\r\n\r\n  private inPens = (pt: Point, pens: Pen[]) => {\r\n    let hoverType = HoverType.None;\r\n    outer: for (let i = pens.length - 1; i >= 0; --i) {\r\n      const pen = pens[i];\r\n      if (\r\n        pen.visible == false ||\r\n        pen.calculative.inView == false ||\r\n        pen.locked === LockState.Disable\r\n      ) {\r\n        continue;\r\n      }\r\n\r\n      const r = getLineR(pen);\r\n      if (\r\n        !pen.calculative.active &&\r\n        !pointInSimpleRect(pt, pen.calculative.worldRect, r) &&\r\n        !pointInRect(pt, pen.calculative.worldRect)\r\n      ) {\r\n        continue;\r\n      }\r\n      //anchor title\r\n      // if (this.store.data.locked) {\r\n      //   // locked>0\r\n      //   if (pen.calculative.worldAnchors) {\r\n      //     for (const anchor of pen.calculative.worldAnchors) {\r\n      //       if (\r\n      //         hitPoint(\r\n      //           pt,\r\n      //           anchor,\r\n      //           this.pointSize,\r\n      //           anchor.penId ? this.store.pens[anchor.penId] : undefined\r\n      //         )\r\n      //       ) {\r\n      //         this.title.show(anchor, pen);\r\n      //         if (anchor.title) {\r\n      //           break outer;\r\n      //         }\r\n      //       }\r\n      //     }\r\n      //   }\r\n      // }\r\n      // 锚点\r\n      if (!this.store.data.locked && this.hotkeyType !== HotkeyType.Resize) {\r\n        if (pen.calculative.worldAnchors) {\r\n          for (const anchor of pen.calculative.worldAnchors) {\r\n            hoverType = this.inAnchor(pt, pen, anchor);\r\n            if (hoverType) {\r\n              //title显示\r\n              let _anchor = deepClone(anchor);\r\n              Object.assign(_anchor, pt);\r\n              this.title.show(_anchor, pen);\r\n              break outer;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // 图形\r\n      if (pen.type) {\r\n        if (pen.isRuleLine) {\r\n          let ruleH = this.store.options.ruleOptions?.height || 20;\r\n          if (\r\n            pt.x + this.store.data.x > ruleH &&\r\n            pt.y + this.store.data.y > ruleH\r\n          ) {\r\n            break;\r\n          }\r\n        }\r\n        const pos = pointInLine(pt, pen);\r\n        if (pos) {\r\n          if (!this.store.data.locked && !pen.locked) {\r\n            if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n              this.externalElements.style.cursor = 'pointer';\r\n            } else {\r\n              this.externalElements.style.cursor = 'move';\r\n            }\r\n          } else {\r\n            this.externalElements.style.cursor = this.store.options.hoverCursor;\r\n          }\r\n          if(pen.calculative.disabled){\r\n            this.externalElements.style.cursor = 'not-allowed';\r\n          }\r\n\r\n          this.store.hover = pen;\r\n          this.store.pointAt = pos.point;\r\n          this.store.pointAtIndex = pos.i;\r\n          this.initTemplateCanvas([this.store.hover]);\r\n          hoverType = HoverType.Line;\r\n          break;\r\n        }\r\n      } else {\r\n        if (pen.children) {\r\n          const pens = []; // TODO: 只考虑了一级子\r\n          pen.children.forEach((id) => {\r\n            this.store.pens[id] && pens.push(this.store.pens[id]);\r\n          });\r\n          hoverType = this.inPens(pt, pens);\r\n          if (hoverType) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        let isIn = false;\r\n        if (pen.name === 'line') {\r\n          isIn = pointInSimpleRect(\r\n            pt,\r\n            pen.calculative.worldRect,\r\n            pen.lineWidth\r\n          );\r\n        } else {\r\n          isIn = pointInRect(pt, pen.calculative.worldRect);\r\n        }\r\n        if (isIn) {\r\n          if(pen.type === PenType.Node && pen.name==='line'){\r\n            let pIn =  pointInPolygon(pt,pen.calculative.worldAnchors);\r\n            if(!pIn){\r\n              continue;\r\n            }\r\n          }\r\n          if (!this.store.data.locked && !pen.locked) {\r\n            if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n              this.externalElements.style.cursor = 'pointer';\r\n            } else {\r\n              this.externalElements.style.cursor = 'move';\r\n            }\r\n          } else {\r\n            this.externalElements.style.cursor = this.store.options.hoverCursor;\r\n          }\r\n          if(pen.calculative.disabled){\r\n            this.externalElements.style.cursor = 'not-allowed';\r\n          }\r\n\r\n          this.store.hover = pen;\r\n          this.initTemplateCanvas([this.store.hover]);\r\n          hoverType = HoverType.Node;\r\n          this.store.pointAt = pt;\r\n          // 锚点贴边吸附\r\n          if (!(pt as any).ctrlKey) {\r\n            let { x, y, ex, ey, rotate, center } =\r\n              this.store.hover.calculative.worldRect;\r\n            if (rotate) {\r\n              const pts: Point[] = [\r\n                { x, y },\r\n                { x: ex, y: y },\r\n                { x: ex, y: ey },\r\n                { x: x, y: ey },\r\n              ];\r\n              pts.forEach((item: Point) => {\r\n                rotatePoint(item, rotate, center);\r\n              });\r\n              let last = pts[pts.length - 1];\r\n              for (const item of pts) {\r\n                if (last.y > pt.y !== item.y > pt.y) {\r\n                  const tempx =\r\n                    item.x +\r\n                    ((pt.y - item.y) * (last.x - item.x)) / (last.y - item.y);\r\n                  if (Math.abs(tempx - this.store.pointAt.x) < 10) {\r\n                    this.store.pointAt.x = tempx;\r\n                  }\r\n                }\r\n                last = item;\r\n              }\r\n            } else {\r\n              if (this.store.pointAt.x - 10 < x) {\r\n                this.store.pointAt.x = x;\r\n              } else if (this.store.pointAt.x + 10 > ex) {\r\n                this.store.pointAt.x = ex;\r\n              }\r\n              if (this.store.pointAt.y - 10 < y) {\r\n                this.store.pointAt.y = y;\r\n              } else if (this.store.pointAt.y + 10 > ey) {\r\n                this.store.pointAt.y = ey;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return hoverType;\r\n  };\r\n\r\n  private dockInAnchor = (pt: Point) => {\r\n    this.store.hover = undefined;\r\n\r\n    for (let i = this.store.data.pens.length - 1; i >= 0; --i) {\r\n      const pen = this.store.data.pens[i];\r\n      if (\r\n        pen.visible == false ||\r\n        pen.locked === LockState.Disable ||\r\n        pen === this.store.active[0]\r\n      ) {\r\n        continue;\r\n      }\r\n\r\n      let r = getLineR(pen);\r\n      r += 2 * this.store.options.anchorRadius;\r\n      if (!pointInSimpleRect(pt, pen.calculative.worldRect, r)) {\r\n        continue;\r\n      }\r\n\r\n      this.store.hover = pen;\r\n      // 锚点\r\n      if (this.hotkeyType !== HotkeyType.Resize) {\r\n        if (pen.calculative.worldAnchors) {\r\n          for (const anchor of pen.calculative.worldAnchors) {\r\n            if (anchor.twoWay === TwoWay.In) {\r\n              const to = getToAnchor(this.store.active[0]);\r\n              if (this.store.activeAnchor.id !== to.id) {\r\n                continue;\r\n              }\r\n            }\r\n            if (anchor.twoWay === TwoWay.Out) {\r\n              const from = getFromAnchor(this.store.active[0]);\r\n              if (this.store.activeAnchor.id !== from.id) {\r\n                continue;\r\n              }\r\n            }\r\n\r\n            if (\r\n              anchor.twoWay === TwoWay.DisableConnected ||\r\n              anchor.twoWay === TwoWay.Disable ||\r\n              this.store.activeAnchor?.twoWay === TwoWay.DisableConnectTo ||\r\n              this.store.activeAnchor?.twoWay === TwoWay.Disable\r\n            ) {\r\n              continue;\r\n            }\r\n            this.title.hide();\r\n            if (this.inAnchor(pt, pen, anchor)) {\r\n              let _anchor = deepClone(anchor);\r\n              Object.assign(_anchor, pt);\r\n              this.title.show(_anchor, pen);\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  inAnchor(pt: Point, pen: Pen, anchor: Point): HoverType {\r\n    this.store.hoverAnchor = undefined;\r\n    this.movingAnchor = undefined;\r\n    if (!anchor || anchor.locked > LockState.DisableEdit) {\r\n      return HoverType.None;\r\n    }\r\n\r\n    if (\r\n      (!(pen.type && pen.calculative.active) &&\r\n        this.store.options.disableAnchor) ||\r\n      pen.disableAnchor\r\n    ) {\r\n      return HoverType.None;\r\n    }\r\n\r\n    if (\r\n      (this.mouseDown || this.drawingLine) &&\r\n      pen.name === 'line' &&\r\n      anchor.connectTo\r\n    ) {\r\n      const connectPen = this.findOne(anchor.connectTo);\r\n      if (connectPen?.calculative && !connectPen?.calculative.active) {\r\n        pen = connectPen;\r\n        const connectAnchor = connectPen.calculative.worldAnchors.find(\r\n          (item) => item.id === anchor.anchorId\r\n        );\r\n        connectAnchor && (anchor = connectAnchor);\r\n      }\r\n    }\r\n\r\n    if (anchor.twoWay === TwoWay.Disable && pen.name !== 'line') {\r\n      return HoverType.None;\r\n    }\r\n    if (pen.name === 'line' && anchor.connectTo) {\r\n      let _anchor = this.findOne(anchor.connectTo)?.anchors.find(\r\n        (item) => item.id === anchor.anchorId\r\n      );\r\n      if (_anchor && _anchor.twoWay) {\r\n        return HoverType.None;\r\n      }\r\n    }\r\n    if (this.drawingLine) {\r\n      if (anchor.twoWay === TwoWay.Out) {\r\n        return HoverType.None;\r\n      }\r\n    } else {\r\n      if (this.mouseDown && this.hoverType === HoverType.LineAnchor) {\r\n      } else if (anchor.twoWay === TwoWay.In) {\r\n        return HoverType.None;\r\n      }\r\n    }\r\n    if (\r\n      hitPoint(\r\n        pt,\r\n        anchor,\r\n        this.pointSize,\r\n        anchor.penId ? this.store.pens[anchor.penId] : undefined\r\n      )\r\n    ) {\r\n      if (anchor !== this.store.hoverAnchor) {\r\n        this.patchFlags = true;\r\n      }\r\n      this.store.hoverAnchor = anchor;\r\n      this.store.hover = pen;\r\n\r\n      if (pen.type) {\r\n        if (anchor.connectTo && !pen.calculative.active) {\r\n          this.store.hover = this.store.pens[anchor.connectTo];\r\n          if (this.store.hover) {\r\n            this.store.hoverAnchor =\r\n              this.store.hover.calculative.worldAnchors.find(\r\n                (a) => a.id === anchor.anchorId\r\n              );\r\n            if (!this.store.hoverAnchor) {\r\n              return HoverType.None;\r\n            }\r\n            this.externalElements.style.cursor = 'crosshair';\r\n            return HoverType.NodeAnchor;\r\n          }\r\n        }\r\n        if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n          this.externalElements.style.cursor = 'vertical-text';\r\n        } else {\r\n          this.externalElements.style.cursor = 'pointer';\r\n        }\r\n\r\n        return HoverType.LineAnchor;\r\n      }\r\n\r\n      if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n        this.externalElements.style.cursor = 'vertical-text';\r\n      } else {\r\n        this.externalElements.style.cursor = 'crosshair';\r\n      }\r\n\r\n      return HoverType.NodeAnchor;\r\n    }\r\n\r\n    if (!this.mouseDown && pen.type) {\r\n      if (\r\n        pen.calculative.active &&\r\n        anchor.prev &&\r\n        hitPoint(pt, anchor.prev, this.pointSize)\r\n      ) {\r\n        this.store.hoverAnchor = anchor;\r\n        this.store.hover = pen;\r\n        this.externalElements.style.cursor = 'pointer';\r\n        return HoverType.LineAnchorPrev;\r\n      }\r\n\r\n      if (\r\n        pen.calculative.active &&\r\n        anchor.next &&\r\n        hitPoint(pt, anchor.next, this.pointSize)\r\n      ) {\r\n        this.store.hoverAnchor = anchor;\r\n        this.store.hover = pen;\r\n        this.externalElements.style.cursor = 'pointer';\r\n        return HoverType.LineAnchorNext;\r\n      }\r\n    }\r\n\r\n    return HoverType.None;\r\n  }\r\n\r\n  resize(w?: number, h?: number) {\r\n    w = w || this.parentElement.clientWidth;\r\n    h = h || this.parentElement.clientHeight;\r\n\r\n    this.width = w;\r\n    this.height = h;\r\n\r\n    this.canvasRect = {\r\n      x: 0,\r\n      y: 0,\r\n      width: w,\r\n      height: h,\r\n    };\r\n    calcRightBottom(this.canvasRect);\r\n\r\n    this.canvas.style.width = w + 'px';\r\n    this.canvas.style.height = h + 'px';\r\n\r\n    this.externalElements.style.width = w + 'px';\r\n    this.externalElements.style.height = h + 'px';\r\n\r\n    this.canvasTemplate.resize(w, h);\r\n    this.canvasImage.resize(w, h);\r\n    this.canvasImageBottom.resize(w, h);\r\n    this.magnifierCanvas.resize(w, h);\r\n\r\n    w = (w * this.store.dpiRatio) | 0;\r\n    h = (h * this.store.dpiRatio) | 0;\r\n\r\n    this.canvas.width = w;\r\n    this.canvas.height = h;\r\n\r\n    this.offscreen.width = w;\r\n    this.offscreen.height = h;\r\n\r\n    this.clientRect = this.externalElements.getBoundingClientRect();\r\n\r\n    this.canvas\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .scale(this.store.dpiRatio, this.store.dpiRatio);\r\n    this.offscreen.getContext('2d').textBaseline = 'middle';\r\n\r\n    // TODO 窗口大小变化没有刷新图纸\r\n    for (const pen of this.store.data.pens) {\r\n      if(pen.isRuleLine){\r\n        if (!pen.width) {\r\n          pen.height = this.height;\r\n        } else if (!pen.height) {\r\n          pen.width = this.width;\r\n        }\r\n      }\r\n      calcInView(pen);\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  clearCanvas() {\r\n    this.activeRect = undefined;\r\n    this.sizeCPs = undefined;\r\n    this.canvas\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.offscreen\r\n      .getContext('2d')\r\n      .clearRect(0, 0, this.offscreen.width, this.offscreen.height);\r\n    if (!this.store.data.template) {\r\n      this.canvasTemplate.clear();\r\n    }\r\n    this.canvasImage.clear();\r\n    this.canvasImageBottom.clear();\r\n  }\r\n\r\n  async addPen(pen: Pen, history?: boolean, emit?: boolean, abs?:boolean): Promise<Pen> {\r\n    if (this.beforeAddPens && (await this.beforeAddPens([pen])) != true) {\r\n      return;\r\n    }\r\n\r\n    if (this.beforeAddPen && this.beforeAddPen(pen) != true) {\r\n      return;\r\n    }\r\n    if(abs) {\r\n      pen.x = pen.x * this.store.data.scale + this.store.data.origin.x;\r\n      pen.y = pen.y * this.store.data.scale + this.store.data.origin.y;\r\n      pen.width = pen.width * this.store.data.scale;\r\n      pen.height = pen.height * this.store.data.scale;\r\n    }\r\n    this.makePen(pen);\r\n    this.active([pen]);\r\n    this.render();\r\n    emit && this.store.emitter.emit('add', [pen]);\r\n\r\n    if (history) {\r\n      this.pushHistory({ type: EditType.Add, pens: [pen] });\r\n    }\r\n\r\n    return pen;\r\n  }\r\n\r\n  pushHistory(action: EditAction) {\r\n    if (this.store.data.locked) {\r\n      return;\r\n    }\r\n\r\n    const { origin, scale } = this.store.data;\r\n    action.origin = deepClone(origin);\r\n    action.scale = scale;\r\n\r\n    if (action.type !== EditType.Update && action.pens) {\r\n      action.pens.forEach((pen) => {\r\n        pen.calculative &&\r\n          (pen.calculative.layer = this.store.data.pens.findIndex(\r\n            (p) => p.id === pen.id\r\n          ));\r\n      });\r\n    }\r\n\r\n    if (this.store.historyIndex < this.store.histories.length - 1) {\r\n      this.store.histories.splice(\r\n        this.store.historyIndex + 1,\r\n        this.store.histories.length - this.store.historyIndex - 1\r\n      );\r\n    }\r\n    action.pens?.forEach((pen) => {\r\n      let found: any;\r\n      if (action.initPens) {\r\n        for (const p of action.initPens) {\r\n          if (p.id === pen.id) {\r\n            found = p;\r\n          }\r\n        }\r\n      }\r\n      if (found) {\r\n        for (const k in pen) {\r\n          if (found[k] == undefined) {\r\n            found[k] = undefined;\r\n          }\r\n        }\r\n      }\r\n    });\r\n    this.store.histories.push(action);\r\n    this.store.historyIndex = this.store.histories.length - 1;\r\n    this.store.emitter.emit('update', {\r\n      previous: action.initPens,\r\n      current: action.pens,\r\n    });\r\n  }\r\n\r\n  undo() {\r\n    if (\r\n      this.store.data.locked ||\r\n      this.store.historyIndex == null ||\r\n      this.store.historyIndex < 0\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const action = this.store.histories[this.store.historyIndex--];\r\n    this.doEditAction(action, true);\r\n    let step = action.step;\r\n    while (step > 1) {\r\n      const action = this.store.histories[this.store.historyIndex--];\r\n      this.doEditAction(action, true);\r\n      step--;\r\n    }\r\n    if (action.type == EditType.Add || action.type == EditType.Delete || action.type == EditType.Update) {\r\n      this.activeHistory();\r\n    }\r\n  }\r\n\r\n  redo() {\r\n    if (\r\n      this.store.data.locked ||\r\n      this.store.historyIndex == null ||\r\n      this.store.historyIndex > this.store.histories.length - 2\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const action = this.store.histories[++this.store.historyIndex];\r\n    this.doEditAction(action, false);\r\n    let step = action.step;\r\n    while (step > 1) {\r\n      const action = this.store.histories[++this.store.historyIndex];\r\n      this.doEditAction(action, false);\r\n      step--;\r\n    }\r\n    if (action.type == EditType.Add || action.type == EditType.Delete || action.type == EditType.Update) {\r\n      this.activeHistory();\r\n    }\r\n  }\r\n\r\n  activeHistory() {\r\n    let now = this.store.histories[this.store.historyIndex + 1];\r\n    const pens = [];\r\n    if(now && (now.type === EditType.Update)){\r\n      now.pens.forEach((pen) => {\r\n        pens.push(this.store.pens[pen.id]);\r\n      });\r\n      this.active(pens);\r\n      return;\r\n    }\r\n    let before = this.store.histories[this.store.historyIndex];\r\n    if (before && (before.type === EditType.Add || before.type === EditType.Delete)) {\r\n      before.pens.forEach((pen) => {\r\n        pens.push(this.store.pens[pen.id]);\r\n      });\r\n      this.active(pens);\r\n    }\r\n  }\r\n\r\n  doEditAction(action: EditAction, undo: boolean) {\r\n    this.inactive();\r\n    this.store.hoverAnchor = undefined;\r\n    this.store.hover = undefined;\r\n\r\n    switch (action.type) {\r\n      case EditType.Add:\r\n        action.pens.forEach((aPen) => {\r\n          const pen: Pen = deepClone(aPen, true);\r\n          const i = this.store.data.pens.findIndex(\r\n            (item) => item.id === pen.id\r\n          );\r\n          if (i > -1) {\r\n            pen.onDestroy?.(this.store.pens[pen.id]);\r\n            this.store.data.pens.splice(i, 1);\r\n            this.store.pens[pen.id] = undefined;\r\n            if (!pen.calculative) {\r\n              pen.calculative = {};\r\n            }\r\n            pen.calculative.canvas = this;\r\n            this.store.animates.delete(pen);\r\n            this.store.animateMap.delete(pen);\r\n          }\r\n        });\r\n        action.type = EditType.Delete;\r\n        break;\r\n      case EditType.Update:\r\n        const pens = undo ? action.initPens : action.pens;\r\n        const unPens = undo ? action.pens : action.initPens;\r\n        pens.forEach((p) => {\r\n          const pen: Pen = deepClone(p, true);\r\n          const i = this.store.data.pens.findIndex(\r\n            (item) => item.id === pen.id\r\n          );\r\n          if (i > -1) {\r\n            pen.calculative = this.store.data.pens[i].calculative;\r\n            if (\r\n              this.store.data.pens[i].type &&\r\n              this.store.data.pens[i].lastConnected\r\n            ) {\r\n              for (let key in this.store.data.pens[i].lastConnected) {\r\n                if(this.store.pens[key]){\r\n                  let connected = deepClone(this.store.data.pens[i].lastConnected[key]);\r\n                  this.store.pens[key].connectedLines = connected;\r\n                  pen.anchors.forEach((anchor) => {\r\n                    connected.forEach((item) => {\r\n                      if(anchor.id === item.lineAnchor){\r\n                        anchor.connectTo = key;\r\n                      }\r\n                    });\r\n                  });\r\n                }\r\n              }\r\n            }\r\n            this.store.data.pens[i] = pen;\r\n            this.store.pens[pen.id] = pen;\r\n            for (const k in pen) {\r\n              if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n                pen.calculative[k] = pen[k];\r\n              }\r\n            }\r\n            pen.calculative.image = undefined;\r\n            const rect = this.getPenRect(pen, action.origin, action.scale);\r\n            this.setPenRect(pen, rect, false);\r\n            this.updateLines(pen, true);\r\n            if (pen.calculative.canvas.parent.isCombine(pen)) {\r\n              let unPen: Pen = unPens.find((item) => item.id === pen.id);\r\n              inheritanceProps.forEach((key) => {\r\n                if (pen[key] !== unPen[key]) {\r\n                  this.parent.setValue(\r\n                    { id: pen.id, [key]: pen[key] },\r\n                    { render: true, doEvent: false }\r\n                  );\r\n                }\r\n              });\r\n            }\r\n          }\r\n        });\r\n        break;\r\n      case EditType.Delete:\r\n        action.pens.reverse().forEach((aPen) => {\r\n          const pen = deepClone(aPen, true);\r\n          if (!pen.calculative) {\r\n            pen.calculative = {};\r\n          }\r\n          this.store.data.pens.splice(\r\n            pen.calculative?.layer !== -1\r\n              ? pen.calculative?.layer\r\n              : this.store.data.pens.length,\r\n            0,\r\n            pen\r\n          );\r\n          // 先放进去，pens 可能是子节点在前，而父节点在后\r\n          this.store.pens[pen.id] = pen;\r\n          if (pen.type && pen.lastConnected) {\r\n            for (let key in pen.lastConnected) {\r\n              this.store.pens[key]&&(this.store.pens[key].connectedLines = pen.lastConnected[key]);\r\n            }\r\n          }\r\n          pen.calculative.canvas = this;\r\n        });\r\n        action.pens.reverse().forEach((aPen) => {\r\n          const pen = this.store.pens[aPen.id];\r\n          const rect = this.getPenRect(pen, action.origin, action.scale);\r\n          this.setPenRect(pen, rect, false);\r\n          pen.calculative.image = undefined;\r\n          pen.calculative.backgroundImage = undefined;\r\n          pen.calculative.strokeImage = undefined;\r\n          this.loadImage(pen);\r\n        });\r\n        action.type = EditType.Add;\r\n        break;\r\n      case EditType.Replace: {\r\n        // undo pens则为新的pen\r\n        const pens = undo ? action.initPens : action.pens;\r\n        const unPens = undo ? action.pens : action.initPens;\r\n\r\n        // 删除旧的\r\n        unPens.forEach((aPen) => {\r\n          const pen: Pen = deepClone(aPen, true);\r\n          const i = this.store.data.pens.findIndex(\r\n            (item) => item.id === pen.id\r\n          );\r\n          if (i > -1) {\r\n            pen.onDestroy?.(this.store.data.pens.find(i=>i.id === pen.id));\r\n            const i = this.store.data.pens.findIndex(\r\n              (item) => item.id === pen.id\r\n            );\r\n            this.store.data.pens.splice(i, 1);\r\n            this.store.pens[pen.id] = undefined;\r\n            if (!pen.calculative) {\r\n              pen.calculative = {};\r\n            }\r\n            pen.calculative.canvas = this;\r\n            this.store.animates.delete(pen);\r\n            this.store.animateMap.delete(pen);\r\n          }\r\n        });\r\n\r\n        // 放置新的\r\n        pens.reverse().forEach((aPen) => {\r\n          const pen = deepClone(aPen, true);\r\n          if (!pen.calculative) {\r\n            pen.calculative = {};\r\n          }\r\n          this.store.data.pens.splice(\r\n            pen.calculative?.layer !== -1\r\n              ? pen.calculative?.layer\r\n              : this.store.data.pens.length,\r\n            0,\r\n            pen\r\n          );\r\n          // 先放进去，pens 可能是子节点在前，而父节点在后\r\n          this.store.pens[pen.id] = pen;\r\n          if(pen.type&&pen.lastConnected){\r\n            for(let key  in pen.lastConnected){\r\n              this.store.pens[key]&&(this.store.pens[key].connectedLines = pen.lastConnected[key]);\r\n            }\r\n          }\r\n          pen.calculative.canvas = this;\r\n        });\r\n        pens.reverse().forEach((aPen) => {\r\n          const pen = this.store.data.pens.find(i=>i.id === aPen.id);\r\n          const rect = this.getPenRect(pen, action.origin, action.scale);\r\n          this.setPenRect(pen, rect, false);\r\n          pen.calculative.image = undefined;\r\n          pen.calculative.backgroundImage = undefined;\r\n          pen.calculative.strokeImage = undefined;\r\n          this.loadImage(pen);\r\n        });\r\n        action.type = EditType.Replace;\r\n        break;\r\n      }\r\n    }\r\n    if (action.type === EditType.Update) {\r\n      let pens = [...action.pens, ...action.initPens];\r\n      this.initImageCanvas(pens);\r\n      this.initTemplateCanvas(pens);\r\n    } else {\r\n      this.initImageCanvas(action.pens);\r\n      this.initTemplateCanvas(action.pens);\r\n    }\r\n    this.parent.onSizeUpdate();\r\n    this.render();\r\n\r\n    this.store.emitter.emit(undo ? 'undo' : 'redo', action);\r\n  }\r\n\r\n  makePen(pen: Pen) {\r\n    if (!pen.id) {\r\n      pen.id = s8();\r\n    }\r\n    if (\r\n      Math.abs(this.store.lastScale - this.store.data.scale) < 0.0001 &&\r\n      this.store.sameTemplate &&\r\n      this.store.templatePens[pen.id] &&\r\n      // pen.template\r\n      pen.canvasLayer === CanvasLayer.CanvasTemplate\r\n    ) {\r\n      pen = this.store.templatePens[pen.id];\r\n      this.store.data.pens.push(pen);\r\n      this.updatePenRect(pen);\r\n      return;\r\n    }\r\n    this.store.data.pens.push(pen);\r\n    this.store.pens[pen.id] = pen;\r\n    // 集中存储path，避免数据冗余过大\r\n    if (pen.path) {\r\n      !pen.pathId && (pen.pathId = s8());\r\n      const paths = this.store.data.paths;\r\n      !paths[pen.pathId] && (paths[pen.pathId] = pen.path);\r\n\r\n      pen.path = undefined;\r\n    }\r\n    // end\r\n\r\n    if (pen.lineWidth == undefined) {\r\n      pen.lineWidth = 1;\r\n    }\r\n    const { fontSize, lineHeight } = this.store.options;\r\n    if (!pen.fontSize) {\r\n      pen.fontSize = fontSize >= 0 ? fontSize : 12;\r\n    } else if(pen.fontSize < 0) {\r\n      pen.fontSize = 0;\r\n    }\r\n    if (!pen.lineHeight) {\r\n      pen.lineHeight = lineHeight;\r\n    }\r\n    if (pen.image && pen.name !== 'gif' && pen.canvasLayer === undefined) {\r\n      if (pen.isBottom) {\r\n        pen.canvasLayer = CanvasLayer.CanvasImageBottom;\r\n      } else {\r\n        pen.canvasLayer = CanvasLayer.CanvasImage;\r\n      }\r\n      delete pen.isBottom;\r\n    }\r\n    if (pen.template) {\r\n      pen.canvasLayer = CanvasLayer.CanvasTemplate;\r\n    }\r\n    pen.calculative = { canvas: this, singleton: pen.calculative?.singleton };\r\n    if (pen.video || pen.audio) {\r\n      pen.calculative.onended = (pen: Pen) => {\r\n        this.nextAnimate(pen);\r\n      };\r\n    }\r\n    for (const k in pen) {\r\n      if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n        pen.calculative[k] = pen[k];\r\n      }\r\n    }\r\n    pen.calculative.image = undefined;\r\n    pen.calculative.backgroundImage = undefined;\r\n    pen.calculative.strokeImage = undefined;\r\n    if (!pen.anchors && globalStore.anchors[pen.name]) {\r\n      if (!pen.anchors) {\r\n        pen.anchors = [];\r\n      }\r\n      globalStore.anchors[pen.name](pen);\r\n    }\r\n    if(!pen.anchors){\r\n      const anchors = deepClone(this.store.options.defaultAnchors)\r\n      anchors.forEach((item,index)=>{item.id = `${index}`;item.penId = pen.id});\r\n      pen.anchors = anchors;\r\n    }\r\n    this.updatePenRect(pen);\r\n    if (!pen.anchors && pen.calculative.worldAnchors) {\r\n      pen.anchors = pen.calculative.worldAnchors.map((pt) => {\r\n        return calcRelativePoint(pt, pen.calculative.worldRect);\r\n      });\r\n    }\r\n    !pen.rotate && (pen.rotate = 0);\r\n    this.loadImage(pen);\r\n    this.parent.penNetwork(pen);\r\n  }\r\n\r\n  drawline(mouse?: Point) {\r\n    if (!this.drawingLine) {\r\n      return;\r\n    }\r\n\r\n    this[this.drawingLineName]?.(this.store, this.drawingLine, mouse);\r\n    this.store.path2dMap.set(\r\n      this.drawingLine,\r\n      globalStore.path2dDraws.line(this.drawingLine)\r\n    );\r\n    this.patchFlags = true;\r\n  }\r\n\r\n  initLineRect(pen: Pen) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    if (!pen.calculative.worldAnchors?.length) {\r\n      this._del([pen]);\r\n      return;\r\n    }\r\n    if (!isFinite(pen.x) || !isFinite(pen.x)) {\r\n      return;\r\n    }\r\n    if (pen.x == null || pen.y == null) {\r\n      return;\r\n    }\r\n    const rect = getLineRect(pen);\r\n    if (!pen.parentId) {\r\n      Object.assign(pen, rect);\r\n    }\r\n    const { fontSize, lineHeight } = this.store.options;\r\n    if (!pen.fontSize) {\r\n      pen.fontSize = fontSize >= 0 ? fontSize : 12;\r\n      pen.calculative.fontSize = pen.fontSize * this.store.data.scale;\r\n    }\r\n    if (!pen.lineHeight) {\r\n      pen.lineHeight = lineHeight;\r\n      pen.calculative.lineHeight = pen.lineHeight;\r\n    }\r\n    calcCenter(rect);\r\n    pen.calculative.worldRect = rect;\r\n    calcPadding(pen, rect);\r\n    calcTextRect(pen);\r\n    calcInView(pen);\r\n    pen.calculative &&\r\n    (pen.calculative.gradientAnimatePath = undefined);\r\n    this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n    if (pen.calculative.worldAnchors) {\r\n      pen.anchors = pen.calculative.worldAnchors.map((pt) => {\r\n        return calcRelativePoint(pt, pen.calculative.worldRect);\r\n      });\r\n    }\r\n  }\r\n\r\n  drawingPencil() {\r\n    lockedError(this.store);\r\n    this.pencil = true;\r\n    this.externalElements.style.cursor = 'crosshair';\r\n  }\r\n\r\n  stopPencil() {\r\n    this.pencil = false;\r\n    this.pencilLine = undefined;\r\n    this.externalElements.style.cursor = 'default';\r\n  }\r\n\r\n  async finishDrawline(end?: boolean) {\r\n    if (!this.drawingLine) {\r\n      return;\r\n    }\r\n    const from = getFromAnchor(this.drawingLine);\r\n    let to = getToAnchor(this.drawingLine);\r\n    if (to.isTemp) {\r\n      this.drawingLine.calculative.worldAnchors.pop();\r\n      to = getToAnchor(this.drawingLine);\r\n    }\r\n    if (!end) {\r\n      !to.connectTo && this.drawingLine.calculative.worldAnchors.pop();\r\n      if (\r\n        getFromAnchor(this.drawingLine) ===\r\n        this.drawingLine.calculative.activeAnchor\r\n      ) {\r\n        this.drawingLine = undefined;\r\n        this.render();\r\n        return;\r\n      }\r\n    }\r\n    if (!from.connectTo || !to.connectTo) {\r\n      if (this.store.options.disableEmptyLine) {\r\n        // 有一端未连线，且 禁止创建空线条\r\n        if(from.connectTo) {\r\n          this.store.pens[from.connectTo].connectedLines = this.store.pens[from.connectTo].connectedLines.filter((item) =>item.lineId !== this.drawingLine.id);\r\n        }\r\n        this.drawingLine = undefined;\r\n        this.render();\r\n        return;\r\n      }\r\n    } else {\r\n      if (this.store.options.disableRepeatLine) {\r\n        // 两边都连上了锚点，且 禁止创建重复连线\r\n        const line = this.store.data.pens.find((pen) => {\r\n          if (pen.type) {\r\n            const penFrom = getFromAnchor(pen);\r\n            const penTo = getToAnchor(pen);\r\n            return samePoint(penFrom, from) && samePoint(penTo, to);\r\n          }\r\n        });\r\n        if (line) {\r\n          // 存在重复连线\r\n          this.drawingLine = undefined;\r\n          this.render();\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    const rect = getLineRect(this.drawingLine);\r\n    Object.assign(this.drawingLine, rect);\r\n    this.drawingLine.calculative.worldRect = rect;\r\n    this.drawingLine.calculative.activeAnchor = getToAnchor(this.drawingLine);\r\n    this.store.activeAnchor = this.drawingLine.calculative.activeAnchor;\r\n    const allowAdd =\r\n      (!this.beforeAddPens || (await this.beforeAddPens([this.drawingLine]))) &&\r\n      (!this.beforeAddPen || this.beforeAddPen(this.drawingLine));\r\n    if (allowAdd) {\r\n      this.initLineRect(this.drawingLine);\r\n      this.store.data.pens.push(this.drawingLine);\r\n      this.store.pens[this.drawingLine.id] = this.drawingLine;\r\n      this.store.emitter.emit('add', [this.drawingLine]);\r\n      this.active([this.drawingLine]);\r\n      this.pushHistory({\r\n        type: EditType.Add,\r\n        pens: deepClone([this.drawingLine], true),\r\n      });\r\n    }\r\n\r\n    this.store.path2dMap.set(\r\n      this.drawingLine,\r\n      globalStore.path2dDraws[this.drawingLine.name](this.drawingLine)\r\n    );\r\n    this.drawingLine = undefined;\r\n    this.drawingLineName = undefined;\r\n    this.render();\r\n  }\r\n\r\n  async finishPencil() {\r\n    if (this.pencilLine) {\r\n      const anchors: Point[] = simplify(\r\n        this.pencilLine.calculative.worldAnchors,\r\n        10,\r\n        0,\r\n        this.pencilLine.calculative.worldAnchors.length - 1\r\n      );\r\n      let p = getFromAnchor(this.pencilLine);\r\n      anchors.unshift({ id: p.id, penId: p.penId, x: p.x, y: p.y });\r\n      p = getToAnchor(this.pencilLine);\r\n      anchors.push({ id: p.id, penId: p.penId, x: p.x, y: p.y });\r\n      this.pencilLine.calculative.worldAnchors = smoothLine(anchors);\r\n      if (this.pencilLine.calculative.worldAnchors.length > 1) {\r\n        this.pencilLine.calculative.pencil = false;\r\n        this.store.path2dMap.set(\r\n          this.pencilLine,\r\n          globalStore.path2dDraws[this.pencilLine.name](this.pencilLine)\r\n        );\r\n        const allowAdd =\r\n          (!this.beforeAddPens ||\r\n            (await this.beforeAddPens([this.pencilLine]))) &&\r\n          (!this.beforeAddPen || this.beforeAddPen(this.pencilLine));\r\n        if (allowAdd) {\r\n          this.initLineRect(this.pencilLine);\r\n          this.store.data.pens.push(this.pencilLine);\r\n          this.store.pens[this.pencilLine.id] = this.pencilLine;\r\n          this.store.emitter.emit('add', [this.pencilLine]);\r\n          this.active([this.pencilLine]);\r\n          this.pushHistory({\r\n            type: EditType.Add,\r\n            pens: deepClone([this.pencilLine], true),\r\n          });\r\n        }\r\n      }\r\n      this.pencilLine = undefined;\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 火狐浏览器无法绘制 svg 不存在 width height 的问题\r\n   * 此方法手动添加 width 和 height 解决火狐浏览器绘制 svg\r\n   * @param pen\r\n   */\r\n  private firefoxLoadSvg(pen: Pen) {\r\n    const img = new Image();\r\n    // request the XML of your svg file\r\n    const request = new XMLHttpRequest();\r\n    request.open('GET', pen.image, true);\r\n\r\n    request.onload = () => {\r\n      // once the request returns, parse the response and get the SVG\r\n      const parser = new DOMParser();\r\n      const result = parser.parseFromString(request.responseText, 'text/xml');\r\n      const inlineSVG = result.getElementsByTagName('svg')[0];\r\n\r\n      const { width, height } = pen.calculative.worldRect;\r\n      // add the attributes Firefox needs. These should be absolute values, not relative\r\n      inlineSVG.setAttribute('width', `${width}px`);\r\n      inlineSVG.setAttribute('height', `${height}px`);\r\n\r\n      // convert the SVG to a data uri\r\n      const svg64 = btoa(\r\n        unescape(\r\n          encodeURIComponent(new XMLSerializer().serializeToString(inlineSVG))\r\n        )\r\n      );\r\n      const image64 = 'data:image/svg+xml;base64,' + svg64;\r\n\r\n      // set that as your image source\r\n      img.src = image64;\r\n\r\n      // do your canvas work\r\n      img.onload = () => {\r\n        pen.calculative.img = img;\r\n        pen.calculative.imgNaturalWidth = img.naturalWidth || pen.iconWidth;\r\n        pen.calculative.imgNaturalHeight = img.naturalHeight || pen.iconHeight;\r\n        globalStore.htmlElements[pen.image] = img;\r\n        this.imageLoaded();\r\n        // if (pen.template) {\r\n        if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n          this.templateImageLoaded();\r\n        }\r\n      };\r\n    };\r\n    // send the request\r\n    request.send();\r\n  }\r\n\r\n  loadImage(pen: Pen) {\r\n    if (pen.image !== pen.calculative.image || !pen.calculative.img) {\r\n      pen.calculative.img = undefined;\r\n      if (pen.image) {\r\n        if (globalStore.htmlElements[pen.image]) {\r\n          const img = globalStore.htmlElements[pen.image];\r\n          pen.calculative.img = img;\r\n          pen.calculative.imgNaturalWidth = img.naturalWidth || pen.iconWidth;\r\n          pen.calculative.imgNaturalHeight =\r\n            img.naturalHeight || pen.iconHeight;\r\n          this.imageLoaded(); // TODO: 重绘图片层 有延时器，可能卡顿\r\n          // if (pen.template) {\r\n          if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n            this.templateImageLoaded();\r\n          }\r\n        } else {\r\n          if (\r\n            navigator.userAgent.includes('Firefox') &&\r\n            pen.image.endsWith('.svg')\r\n          ) {\r\n            // 火狐浏览器 svg 图片需要特殊处理\r\n            this.firefoxLoadSvg(pen);\r\n          } else {\r\n            const img = new Image();\r\n            img.crossOrigin =\r\n              pen.crossOrigin === 'undefined'\r\n                ? undefined\r\n                : pen.crossOrigin || 'anonymous';\r\n            img.src = pen.image;\r\n            if (\r\n              this.store.options.cdn &&\r\n              !(\r\n                pen.image.startsWith('http') ||\r\n                pen.image.startsWith('//') ||\r\n                pen.image.startsWith('data:image')\r\n              )\r\n            ) {\r\n              img.src = this.store.options.cdn + pen.image;\r\n            }\r\n            img.onload = () => {\r\n              // TODO: 连续的加载两张图片，若后开始加载 的图片先加载完成，可能会导致展示的是 先开始加载的图片\r\n              pen.calculative.img = img;\r\n              pen.calculative.imgNaturalWidth =\r\n                img.naturalWidth || pen.iconWidth;\r\n              pen.calculative.imgNaturalHeight =\r\n                img.naturalHeight || pen.iconHeight;\r\n              globalStore.htmlElements[pen.image] = img;\r\n              this.imageLoaded();\r\n              // if (pen.template) {\r\n              if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n                this.templateImageLoaded();\r\n              }\r\n            };\r\n          }\r\n        }\r\n      }\r\n      pen.calculative.image = pen.image;\r\n    }\r\n\r\n    if (pen.backgroundImage !== pen.calculative.backgroundImage) {\r\n      pen.calculative.backgroundImg = undefined;\r\n      if (pen.backgroundImage) {\r\n        if (globalStore.htmlElements[pen.backgroundImage]) {\r\n          const img = globalStore.htmlElements[pen.backgroundImage];\r\n          pen.calculative.backgroundImg = img;\r\n        } else {\r\n          const img = new Image();\r\n          img.crossOrigin = 'anonymous';\r\n          img.src = pen.backgroundImage;\r\n          if (\r\n            this.store.options.cdn &&\r\n            !(\r\n              pen.backgroundImage.startsWith('http') ||\r\n              pen.backgroundImage.startsWith('//') ||\r\n              pen.backgroundImage.startsWith('data:image')\r\n            )\r\n          ) {\r\n            img.src = this.store.options.cdn + pen.backgroundImage;\r\n          }\r\n          img.onload = () => {\r\n            pen.calculative.backgroundImg = img;\r\n            globalStore.htmlElements[pen.backgroundImage] = img;\r\n            this.imageLoaded();\r\n            // if (pen.template) {\r\n            if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n              this.templateImageLoaded();\r\n            }\r\n          };\r\n        }\r\n      }\r\n      pen.calculative.backgroundImage = pen.backgroundImage;\r\n    }\r\n\r\n    if (pen.strokeImage !== pen.calculative.strokeImage) {\r\n      pen.calculative.strokeImg = undefined;\r\n      if (pen.strokeImage) {\r\n        if (globalStore.htmlElements[pen.strokeImage]) {\r\n          const img = globalStore.htmlElements[pen.strokeImage];\r\n          pen.calculative.strokeImg = img;\r\n        } else {\r\n          const img = new Image();\r\n          img.crossOrigin = 'anonymous';\r\n          img.src = pen.strokeImage;\r\n          if (\r\n            this.store.options.cdn &&\r\n            !(\r\n              pen.strokeImage.startsWith('http') ||\r\n              pen.strokeImage.startsWith('//') ||\r\n              pen.strokeImage.startsWith('data:image')\r\n            )\r\n          ) {\r\n            img.src = this.store.options.cdn + pen.strokeImage;\r\n          }\r\n          img.onload = () => {\r\n            pen.calculative.strokeImg = img;\r\n            globalStore.htmlElements[pen.strokeImage] = img;\r\n            this.imageLoaded();\r\n            if (\r\n              // pen.template\r\n              pen.canvasLayer === CanvasLayer.CanvasTemplate &&\r\n              pen.name !== 'gif'\r\n            ) {\r\n              this.templateImageLoaded();\r\n            }\r\n          };\r\n        }\r\n      }\r\n      pen.calculative.strokeImage = pen.strokeImage;\r\n    }\r\n  }\r\n  private imageTimer: any;\r\n  // 避免初始化图片加载重复调用 render，此处防抖\r\n  imageLoaded() {\r\n    this.imageTimer && clearTimeout(this.imageTimer);\r\n    this.imageTimer = setTimeout(() => {\r\n      // 加载完图片，重新渲染一次图片层\r\n      this.canvasImage.init();\r\n      this.canvasImageBottom.init();\r\n      this.render();\r\n    }, 100);\r\n  }\r\n\r\n  private templateImageTimer: any;\r\n  // 避免初始化图片加载重复调用 render，此处防抖\r\n  templateImageLoaded() {\r\n    this.templateImageTimer && clearTimeout(this.templateImageTimer);\r\n    this.templateImageTimer = setTimeout(() => {\r\n      // 加载完图片，重新渲染一次图片层\r\n      this.canvasTemplate.init();\r\n      this.render();\r\n    }, 100);\r\n  }\r\n\r\n  setCalculativeByScale(pen: Pen) {\r\n    const scale = this.store.data.scale;\r\n    pen.calculative.lineWidth = pen.lineWidth * scale;\r\n    pen.calculative.fontSize = pen.fontSize * scale;\r\n    if (pen.fontSize < 1 && pen.fontSize > 0) {\r\n      pen.calculative.fontSize =\r\n        pen.fontSize * pen.calculative.worldRect.height;\r\n    }\r\n    pen.calculative.iconSize = pen.iconSize * scale;\r\n    pen.calculative.iconWidth = pen.iconWidth * scale;\r\n    pen.calculative.iconHeight = pen.iconHeight * scale;\r\n    pen.calculative.iconLeft =\r\n      pen.iconLeft < 1 && pen.iconLeft > -1\r\n        ? pen.iconLeft\r\n        : pen.iconLeft * scale;\r\n    pen.calculative.iconTop =\r\n      pen.iconTop < 1 && pen.iconTop > -1 ? pen.iconTop : pen.iconTop * scale;\r\n    pen.calculative.textWidth =\r\n      pen.textWidth < 1 && pen.textWidth > -1\r\n        ? pen.textWidth\r\n        : pen.textWidth * scale;\r\n    pen.calculative.textHeight =\r\n      pen.textHeight < 1 && pen.textHeight > -1\r\n        ? pen.textHeight\r\n        : pen.textHeight * scale;\r\n    pen.calculative.textLeft =\r\n      pen.textLeft < 1 && pen.textLeft > -1\r\n        ? pen.textLeft * pen.calculative.worldRect.width\r\n        : pen.textLeft * scale;\r\n    pen.calculative.textTop =\r\n      pen.textTop < 1 && pen.textTop > -1 ? pen.textTop * pen.calculative.worldRect.height : pen.textTop * scale;\r\n\r\n    if (pen.type === PenType.Line && pen.borderWidth) {\r\n      pen.calculative.borderWidth = pen.borderWidth * scale;\r\n    }\r\n  }\r\n\r\n  updatePenRect(\r\n    pen: Pen,\r\n    {\r\n      worldRectIsReady,\r\n      playingAnimate,\r\n    }: {\r\n      worldRectIsReady?: boolean;\r\n      playingAnimate?: boolean;\r\n      noChildren?: boolean;\r\n    } = {}\r\n  ) {\r\n    if (worldRectIsReady) {\r\n      calcPenRect(pen);\r\n    } else {\r\n      calcWorldRects(pen);\r\n    }\r\n\r\n    if (!playingAnimate) {\r\n      this.setCalculativeByScale(pen);\r\n    }\r\n    calcWorldAnchors(pen);\r\n    calcIconRect(this.store.pens, pen);\r\n    calcTextRect(pen);\r\n    calcInView(pen);\r\n    globalStore.path2dDraws[pen.name] &&\r\n      this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n    pen.calculative.patchFlags = true;\r\n    this.patchFlags = true;\r\n\r\n    if (pen.children) {\r\n      pen.children.forEach((id) => {\r\n        const child: Pen = this.store.pens[id];\r\n        child && this.updatePenRect(child, { worldRectIsReady: false });\r\n      });\r\n    }\r\n    pen.type && this.initLineRect(pen);\r\n    if (pen.calculative.gradientTimer) {\r\n      clearTimeout(pen.calculative.gradientTimer);\r\n    }\r\n    pen.calculative.gradientTimer = setTimeout(() => {\r\n      if (pen.calculative.lineGradient) {\r\n        pen.calculative.lineGradient = null;\r\n      }\r\n      if (pen.calculative.gradient) {\r\n        pen.calculative.gradient = null;\r\n      }\r\n      if (pen.calculative.radialGradient) {\r\n        pen.calculative.radialGradient = null;\r\n      }\r\n      this.patchFlags = true;\r\n      pen.calculative.gradientTimer = undefined;\r\n    }, 50);\r\n  }\r\n\r\n  render = (patchFlags?: number | boolean) => {\r\n    if (patchFlags) {\r\n      this.opening = false;\r\n    }\r\n    if (this.opening) {\r\n      return;\r\n    }\r\n    let now: number;\r\n    if (patchFlags == null || patchFlags === true || patchFlags === Infinity) {\r\n      now = performance.now();\r\n      this.patchFlags = true;\r\n    } else if ((patchFlags as number) > 1) {\r\n      now = patchFlags as number;\r\n    } else {\r\n      now = performance.now();\r\n    }\r\n    if (!this.patchFlags) {\r\n      return;\r\n    }\r\n\r\n    if (now - this.lastRender < this.store.options.interval) {\r\n      if (this.renderTimer) {\r\n        cancelAnimationFrame(this.renderTimer);\r\n      }\r\n      this.renderTimer = requestAnimationFrame(this.render);\r\n\r\n      return;\r\n    }\r\n    this.renderTimer = undefined;\r\n    this.lastRender = now;\r\n    const offscreenCtx = this.offscreen.getContext('2d');\r\n    offscreenCtx.clearRect(0, 0, this.offscreen.width, this.offscreen.height);\r\n    offscreenCtx.save();\r\n    offscreenCtx.translate(this.store.data.x, this.store.data.y);\r\n    globalThis.debugRender && console.time('renderPens');\r\n    this.renderPens();\r\n    globalThis.debugRender && console.timeEnd('renderPens');\r\n    this.renderBorder();\r\n    this.renderHoverPoint();\r\n    offscreenCtx.restore();\r\n    this.magnifierCanvas.render();\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    ctx.drawImage(this.offscreen, 0, 0, this.width, this.height);\r\n    this.canvasTemplate.render();\r\n    this.canvasImageBottom.render();\r\n    this.canvasImage.render();\r\n    this.patchFlags = false;\r\n  };\r\n\r\n  renderPens = () => {\r\n    const ctx = this.offscreen.getContext('2d') as CanvasRenderingContext2D;\r\n    ctx.strokeStyle = getGlobalColor(this.store);\r\n\r\n    for (const pen of this.store.data.pens) {\r\n      if (!isFinite(pen.x)) {\r\n        continue;\r\n      }\r\n      // if (pen.template) {\r\n      if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n        continue;\r\n      }\r\n      if (pen.name === 'combine' && !pen.draw){\r\n        continue;\r\n      }\r\n      if (pen.calculative.inView) {\r\n        if (\r\n          pen.canvasLayer === CanvasLayer.CanvasMain &&\r\n          pen.name !== 'gif' &&\r\n          pen.image &&\r\n          pen.calculative.img\r\n        ) {\r\n          ctx.save();\r\n          ctxFlip(ctx, pen);\r\n          if (pen.calculative.rotate) {\r\n            ctxRotate(ctx, pen);\r\n          }\r\n          setGlobalAlpha(ctx, pen);\r\n          drawImage(ctx, pen);\r\n          ctx.restore();\r\n        }\r\n        renderPen(ctx, pen);\r\n      }\r\n    }\r\n\r\n    if (this.drawingLine) {\r\n      renderPen(ctx, this.drawingLine);\r\n    }\r\n    if (this.pencilLine) {\r\n      renderPen(ctx, this.pencilLine);\r\n    }\r\n    if (this.movingPens) {\r\n      this.movingPens.forEach((pen) => {\r\n        this.renderPenContainChild(ctx, pen);\r\n      });\r\n    }\r\n  };\r\n\r\n  private renderPenContainChild = (ctx: CanvasRenderingContext2D, pen: Pen) => {\r\n    pen.calculative.inView && renderPen(ctx, pen); // 可见才绘制，组合为状态只显示其中一个\r\n    pen.children?.forEach((id) => {\r\n      const child = this.store.pens[id];\r\n      child && this.renderPenContainChild(ctx, child);\r\n    });\r\n  };\r\n\r\n  renderBorder = () => {\r\n    if (!this.store.data.locked) {\r\n      // Occupied territory.\r\n      if (\r\n        this.activeRect &&\r\n        !(this.store.active.length === 1 && this.store.active[0].type) &&\r\n        !this.movingPens\r\n      ) {\r\n        const ctx = this.offscreen.getContext('2d');\r\n        ctx.save();\r\n        ctx.translate(0.5, 0.5);\r\n        const pivot = this.activeRect.pivot || this.activeRect.center;\r\n        if (this.activeRect.rotate) {\r\n          ctx.translate( pivot.x, pivot.y);\r\n          ctx.rotate((this.activeRect.rotate * Math.PI) / 180);\r\n          ctx.translate(-pivot.x, -pivot.y);\r\n        }\r\n        ctx.strokeStyle = this.store.options.activeColor;\r\n\r\n        ctx.globalAlpha = this.store.options.activeGlobalAlpha === undefined ? 0.3 : this.store.options.activeGlobalAlpha;\r\n        ctx.beginPath();\r\n        ctx.lineWidth = this.store.options.activeLineWidth || 1;\r\n        ctx.setLineDash(this.store.options.activeLineDash || []);\r\n        ctx.strokeRect(\r\n          this.activeRect.x,\r\n          this.activeRect.y,\r\n          this.activeRect.width,\r\n          this.activeRect.height\r\n        );\r\n        ctx.setLineDash([]);\r\n        ctx.lineWidth = 1;\r\n\r\n        ctx.globalAlpha = 1;\r\n        if (\r\n          getPensLock(this.store.active) ||\r\n          getPensDisableRotate(this.store.active) ||\r\n          this.store.options.disableRotate\r\n        ) {\r\n          ctx.restore();\r\n          return;\r\n        }\r\n        // Draw rotate control line.\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.activeRect.center.x, this.activeRect.y);\r\n        ctx.lineTo(this.activeRect.center.x, this.activeRect.y - 30);\r\n        ctx.stroke();\r\n\r\n        // Draw rotate control points.\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = this.store.options.activeColor;\r\n        ctx.fillStyle = '#ffffff';\r\n        ctx.arc(\r\n          this.activeRect.center.x,\r\n          this.activeRect.y - 30,\r\n          5,\r\n          0,\r\n          Math.PI * 2\r\n        );\r\n        ctx.fill();\r\n        ctx.stroke();\r\n\r\n        ctx.restore();\r\n      }\r\n    }\r\n  };\r\n\r\n  renderHoverPoint = () => {\r\n    if (this.store.data.locked) {\r\n      return;\r\n    }\r\n    const ctx = this.offscreen.getContext('2d');\r\n    ctx.save();\r\n    ctx.translate(0.5, 0.5);\r\n\r\n    if (\r\n      !this.store.options.disableAnchor &&\r\n      this.store.hover &&\r\n      !this.store.hover.disableAnchor &&\r\n      (this.hotkeyType !== HotkeyType.Resize ||\r\n        this.store.active.length !== 1 ||\r\n        this.store.active[0] !== this.store.hover)\r\n    ) {\r\n      const anchors = [...this.store.hover.calculative.worldAnchors];\r\n\r\n      if (this.store.pointAt && this.hotkeyType === HotkeyType.AddAnchor) {\r\n        anchors.push(this.store.pointAt);\r\n      }\r\n      if (anchors) {\r\n        ctx.strokeStyle =\r\n          this.store.hover.anchorColor || this.store.options.anchorColor;\r\n        ctx.fillStyle =\r\n          this.store.hover.anchorBackground ||\r\n          this.store.options.anchorBackground;\r\n        anchors.forEach((anchor) => {\r\n          if (anchor.hidden && anchor.locked > LockState.DisableEdit) {\r\n            return;\r\n          }\r\n          if (anchor === this.store.hoverAnchor) {\r\n            ctx.save();\r\n            const hoverAnchorColor =\r\n              this.store.hover.hoverAnchorColor ||\r\n              this.store.options.hoverAnchorColor;\r\n            ctx.strokeStyle = hoverAnchorColor;\r\n            ctx.fillStyle = hoverAnchorColor;\r\n          }\r\n          ctx.beginPath();\r\n          let size =\r\n            anchor.radius ||\r\n            this.store.hover.anchorRadius ||\r\n            this.store.options.anchorRadius;\r\n          if (\r\n            this.store.hover.type &&\r\n            !anchor.radius &&\r\n            !this.store.hover.anchorRadius\r\n          ) {\r\n            size = 3;\r\n            if (this.store.hover.calculative.lineWidth > 3) {\r\n              size = this.store.hover.calculative.lineWidth;\r\n            }\r\n          }\r\n          if (anchor.type === PointType.Line) {\r\n            //旋转的情况\r\n            let _rotate = this.store.pens[anchor.penId].rotate || 0;\r\n            if (this.store.pens[anchor.penId].calculative.flipX) {\r\n              _rotate *= -1;\r\n            }\r\n            if (this.store.pens[anchor.penId].calculative.flipY) {\r\n              _rotate *= -1;\r\n            }\r\n            let rotate = anchor.rotate + _rotate;\r\n            if (this.store.pens[anchor.penId].calculative.flipX) {\r\n              rotate *= -1;\r\n            }\r\n            if (this.store.pens[anchor.penId].calculative.flipY) {\r\n              rotate *= -1;\r\n            }\r\n            ctx.save();\r\n            ctx.translate(anchor.x, anchor.y);\r\n            ctx.rotate((rotate * Math.PI) / 180);\r\n            ctx.translate(-anchor.x, -anchor.y);\r\n            ctx.rect(\r\n              anchor.x - (anchor.length * this.store.data.scale) / 2,\r\n              anchor.y - size,\r\n              anchor.length * this.store.data.scale,\r\n              size * 2\r\n            );\r\n            ctx.restore();\r\n          } else {\r\n            ctx.arc(anchor.x, anchor.y, size, 0, Math.PI * 2);\r\n          }\r\n          if (this.store.hover.type && this.store.hoverAnchor === anchor) {\r\n            ctx.save();\r\n            ctx.strokeStyle =\r\n              this.store.hover.activeColor || this.store.options.activeColor;\r\n            ctx.fillStyle = ctx.strokeStyle;\r\n          } else if (anchor.color || anchor.background) {\r\n            ctx.save();\r\n            ctx.strokeStyle = anchor.color;\r\n            ctx.fillStyle = anchor.background;\r\n          }\r\n          ctx.fill();\r\n          ctx.stroke();\r\n          if (anchor === this.store.hoverAnchor) {\r\n            ctx.restore();\r\n          }\r\n\r\n          if (this.store.hover.type && this.store.hoverAnchor === anchor) {\r\n            ctx.restore();\r\n          } else if (anchor.color || anchor.background) {\r\n            ctx.restore();\r\n          }\r\n          //根父节点\r\n          if (\r\n            !this.store.hover.parentId &&\r\n            this.store.hover.children &&\r\n            this.store.hover.children.length > 0\r\n          ) {\r\n            if (anchor === this.store.hoverAnchor) {\r\n              ctx.save();\r\n              ctx.beginPath();\r\n              ctx.lineWidth = 3;\r\n              const hoverAnchorColor =\r\n                this.store.hover.hoverAnchorColor ||\r\n                this.store.options.hoverAnchorColor;\r\n              if ((globalThis as any).pSBC) {\r\n                ctx.strokeStyle = (globalThis as any).pSBC(\r\n                  0.5,\r\n                  hoverAnchorColor\r\n                );\r\n              }\r\n              ctx.arc(anchor.x, anchor.y, size + 1.5, 0, Math.PI * 2);\r\n              ctx.stroke();\r\n              ctx.restore();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // Draw size control points.\r\n    if (\r\n      this.hotkeyType !== HotkeyType.AddAnchor &&\r\n      !this.movingPens && // 不在移动中\r\n      this.activeRect &&\r\n      !(this.store.active.length === 1 && this.store.active[0].type)\r\n    ) {\r\n      if (\r\n        !getPensLock(this.store.active) &&\r\n        !getPensDisableResize(this.store.active) &&\r\n        !this.store.options.disableSize\r\n      ) {\r\n        ctx.strokeStyle = this.store.options.activeColor;\r\n        ctx.fillStyle = '#ffffff';\r\n        this.sizeCPs.forEach((pt, i) => {\r\n          if (this.activeRect.rotate) {\r\n            ctx.save();\r\n            ctx.translate(pt.x, pt.y);\r\n            ctx.rotate((this.activeRect.rotate * Math.PI) / 180);\r\n            ctx.translate(-pt.x, -pt.y);\r\n          }\r\n          if (i < 4 || this.hotkeyType === HotkeyType.Resize) {\r\n            ctx.beginPath();\r\n            ctx.fillRect(pt.x - 4.5, pt.y - 4.5, 8, 8);\r\n            ctx.strokeRect(pt.x - 5.5, pt.y - 5.5, 10, 10);\r\n          }\r\n          if (this.activeRect.rotate) {\r\n            ctx.restore();\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    if (!this.store.data.locked && this.dragRect) {\r\n      ctx.save();\r\n      ctx.fillStyle = rgba(this.store.options.dragColor, 0.2);\r\n      ctx.strokeStyle = this.store.options.dragColor;\r\n      ctx.beginPath();\r\n      ctx.strokeRect(\r\n        this.dragRect.x,\r\n        this.dragRect.y,\r\n        this.dragRect.width,\r\n        this.dragRect.height\r\n      );\r\n      ctx.fillRect(\r\n        this.dragRect.x,\r\n        this.dragRect.y,\r\n        this.dragRect.width,\r\n        this.dragRect.height\r\n      );\r\n      ctx.restore();\r\n    }\r\n\r\n    if (this.dock) {\r\n      ctx.strokeStyle = this.store.options.dockColor;\r\n      if (this.dock.xDock) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.dock.xDock.x, this.dock.xDock.y);\r\n        ctx.lineTo(this.dock.xDock.x, this.dock.xDock.prev.y);\r\n        ctx.stroke();\r\n      }\r\n\r\n      if (this.dock.yDock) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.dock.yDock.x, this.dock.yDock.y);\r\n        ctx.lineTo(this.dock.yDock.prev.x, this.dock.yDock.y);\r\n        ctx.stroke();\r\n      }\r\n    }\r\n    ctx.restore();\r\n  };\r\n\r\n  translate(x: number = 0, y: number = 0) {\r\n    this.store.data.x += x * this.store.data.scale;\r\n    this.store.data.y += y * this.store.data.scale;\r\n    this.store.data.x = Math.round(this.store.data.x);\r\n    this.store.data.y = Math.round(this.store.data.y);\r\n    if (this.store.options.padding) {\r\n      let p = formatPadding(this.store.options.padding);\r\n      const width = this.store.data.width || this.store.options.width;\r\n      const height = this.store.data.height || this.store.options.height;\r\n      if (this.width < (width + p[1] + p[3]) * this.store.data.scale) {\r\n        if (\r\n          this.store.data.x + this.store.data.origin.x >\r\n          p[3] * this.store.data.scale\r\n        ) {\r\n          this.store.data.x =\r\n            p[3] * this.store.data.scale - this.store.data.origin.x;\r\n        }\r\n\r\n        if (\r\n          this.store.data.x +\r\n            this.store.data.origin.x +\r\n            width * this.store.data.scale <\r\n          this.width - p[1] * this.store.data.scale\r\n        ) {\r\n          this.store.data.x =\r\n            this.width -\r\n            p[1] * this.store.data.scale -\r\n            (this.store.data.origin.x + width * this.store.data.scale);\r\n        }\r\n      }\r\n      if (this.height < (height + p[0] + p[2]) * this.store.data.scale) {\r\n        if (\r\n          this.store.data.y + this.store.data.origin.y >\r\n          p[0] * this.store.data.scale\r\n        ) {\r\n          this.store.data.y =\r\n            p[0] * this.store.data.scale - this.store.data.origin.y;\r\n        }\r\n        if (\r\n          this.store.data.y +\r\n            this.store.data.origin.y +\r\n            height * this.store.data.scale <\r\n          this.height - p[2] * this.store.data.scale\r\n        ) {\r\n          this.store.data.y =\r\n            this.height -\r\n            p[2] * this.store.data.scale -\r\n            (this.store.data.origin.y + height * this.store.data.scale);\r\n        }\r\n      }\r\n    }\r\n    //TODO 当初为什么加异步\r\n    // setTimeout(() => {\r\n      this.canvasTemplate.init();\r\n      this.canvasImage.init();\r\n      this.canvasImageBottom.init();\r\n      this.render();\r\n    // });\r\n    this.store.emitter.emit('translate', {\r\n      x: this.store.data.x,\r\n      y: this.store.data.y,\r\n    });\r\n    this.tooltip.translate(x, y);\r\n    if (this.scroll && this.scroll.isShow) {\r\n      this.scroll.translate(x, y);\r\n    }\r\n    this.onMovePens();\r\n  }\r\n\r\n  onMovePens() {\r\n    const map = this.parent.map;\r\n    if (map && map.isShow) {\r\n      map.setView();\r\n    }\r\n    // 有移动操作的 画笔 需要执行移动\r\n    for (const pen of this.store.data.pens) {\r\n      calcInView(pen);\r\n      pen.onMove?.(pen);\r\n      if (pen.isRuleLine) {\r\n        if (!pen.width) {\r\n          // 垂直线，移动 y 即可\r\n          pen.y = -this.store.data.y;\r\n        } else if (!pen.height) {\r\n          // 水平线\r\n          pen.x = -this.store.data.x;\r\n        }\r\n        this.updatePenRect(pen);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 缩放整个画布\r\n   * @param scale 缩放比例，最终的 data.scale\r\n   * @param center 中心点，引用类型，存在副作用，会更改原值\r\n   */\r\n  scale(scale: number, center = { x: 0, y: 0 }) {\r\n    const minScale = this.store.data.minScale || this.store.options.minScale;\r\n    const maxScale = this.store.data.maxScale || this.store.options.maxScale;\r\n    if (!(scale >= minScale && scale <= maxScale)) {\r\n      return;\r\n    }\r\n\r\n    this.calibrateMouse(center);\r\n    const s = scale / this.store.data.scale;\r\n    this.store.data.scale = scale;\r\n    this.store.data.center = center;\r\n\r\n    if (this.store.clipboard?.pos) {\r\n      scalePoint(this.store.clipboard.pos, s, center);\r\n    }\r\n    scalePoint(this.store.data.origin, s, center);\r\n    this.store.data.pens.forEach((pen) => {\r\n      if (pen.parentId) {\r\n        return;\r\n      }\r\n      scalePen(pen, s, center);\r\n      pen.onScale && pen.onScale(pen);\r\n      if (pen.isRuleLine) {\r\n        // 扩大线的比例，若是放大，即不缩小，若是缩小，会放大\r\n        const lineScale = 1 / s; //s > 1 ? 1 : 1 / s / s;\r\n        // 中心点即为线的中心\r\n        const lineCenter = pen.calculative.worldRect.center;\r\n        if (!pen.width) {\r\n          // 垂直线\r\n          scalePen(pen, lineScale, lineCenter);\r\n        } else if (!pen.height) {\r\n          // 水平线\r\n          scalePen(pen, lineScale, lineCenter);\r\n        }\r\n      }\r\n      this.updatePenRect(pen, { worldRectIsReady: true });\r\n      this.execPenResize(pen);\r\n    });\r\n    this.onMovePens();\r\n    this.calcActiveRect();\r\n    // setTimeout(() => {\r\n      this.canvasTemplate.init();\r\n      this.canvasImage.init();\r\n      this.canvasImageBottom.init();\r\n      const map = this.parent.map;\r\n      if (map && map.isShow) {\r\n        map.setView();\r\n      }\r\n      this.render();\r\n      this.store.emitter.emit('scale', this.store.data.scale);\r\n    // });\r\n  }\r\n\r\n  templateScale(scale: number, center = { x: 0, y: 0 }) {\r\n    const { minScale, maxScale } = this.store.options;\r\n    if (!(scale >= minScale && scale <= maxScale)) {\r\n      return;\r\n    }\r\n    const s = scale / this.store.data.scale;\r\n    this.store.data.scale = scale;\r\n    this.store.data.center = { x: 0, y: 0 };\r\n    this.store.data.origin = { x: 0, y: 0 };\r\n    this.store.data.pens.forEach((pen) => {\r\n      if (pen.parentId) {\r\n        return;\r\n      }\r\n      scalePen(pen, s, center);\r\n      pen.onScale && pen.onScale(pen);\r\n      if (pen.isRuleLine) {\r\n        // 扩大线的比例，若是放大，即不缩小，若是缩小，会放大\r\n        const lineScale = s > 1 ? 1 : 1 / s / s;\r\n        // 中心点即为线的中心\r\n        const lineCenter = pen.calculative.worldRect.center;\r\n        if (!pen.width) {\r\n          // 垂直线\r\n          scalePen(pen, lineScale, lineCenter);\r\n        } else if (!pen.height) {\r\n          // 水平线\r\n          scalePen(pen, lineScale, lineCenter);\r\n        }\r\n      }\r\n      // this.updatePenRect(pen, { worldRectIsReady: true });\r\n      this.execPenResize(pen);\r\n    });\r\n    this.calcActiveRect();\r\n  }\r\n\r\n  rotatePens(e: Point) {\r\n    if (!this.initPens) {\r\n      this.initPens = deepClone(this.getAllByPens(this.store.active));\r\n    }\r\n\r\n    this.activeRect.rotate = calcRotate(e, this.activeRect.center);\r\n    if (this.activeRect.rotate % 90 < 10) {\r\n      this.activeRect.rotate -= this.activeRect.rotate % 90;\r\n    }\r\n    if (this.activeRect.rotate % 90 > 80) {\r\n      this.activeRect.rotate += 90 - (this.activeRect.rotate % 90);\r\n    }\r\n    if (this.store.active.length === 1) {\r\n      this.lastRotate = this.store.active[0].rotate || 0;\r\n    }\r\n    const angle = this.activeRect.rotate - this.lastRotate;\r\n    for (const pen of this.store.active) {\r\n      if (pen.parentId) {\r\n        return;\r\n      }\r\n      this.rotatePen(pen, angle, this.activeRect);\r\n      pen.onRotate && pen.onRotate(pen);\r\n      this.updateLines(pen);\r\n    }\r\n    this.lastRotate = this.activeRect.rotate;\r\n    this.getSizeCPs();\r\n    this.initImageCanvas(this.store.active);\r\n    this.initTemplateCanvas(this.store.active);\r\n    this.render();\r\n    this.store.emitter.emit('rotatePens', this.store.active);\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.timer = undefined;\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(this.getAllByPens(this.store.active)),\r\n        initPens: this.initPens,\r\n      });\r\n      this.initPens = undefined;\r\n    }, 200);\r\n  }\r\n\r\n  resizePens(e: Point) {\r\n    if (!this.initPens) {\r\n      this.initPens = deepClone(this.store.active, true);\r\n    }\r\n\r\n    if (!this.initActiveRect) {\r\n      this.initActiveRect = deepClone(this.activeRect);\r\n      return;\r\n    }\r\n\r\n    const p1 = { x: this.mouseDown.x, y: this.mouseDown.y };\r\n    const p2 = { x: e.x, y: e.y };\r\n    // rotatePoint(p1, -this.activeRect.rotate, this.activeRect.center);\r\n    // rotatePoint(p2, -this.activeRect.rotate, this.activeRect.center);\r\n\r\n    let x = p2.x - p1.x;\r\n    let y = p2.y - p1.y;\r\n\r\n    const rect = deepClone(this.initActiveRect);\r\n    // 得到最准确的 rect 即 resize 后的\r\n    resizeRect(rect, x, y, this.resizeIndex);\r\n    calcCenter(rect);\r\n    if (!this.store.options.disableDock) {\r\n      this.clearDock();\r\n      const resizeDock = this.customResizeDock || calcResizeDock;\r\n      this.dock = resizeDock(\r\n        this.store,\r\n        rect,\r\n        this.store.active,\r\n        this.resizeIndex\r\n      );\r\n      const { xDock, yDock } = this.dock;\r\n      if (xDock) {\r\n        x += xDock.step;\r\n        const dockPen = this.store.pens[xDock.penId];\r\n        dockPen.calculative.isDock = true;\r\n      }\r\n      if (yDock) {\r\n        y += yDock.step;\r\n        const dockPen = this.store.pens[yDock.penId];\r\n        dockPen.calculative.isDock = true;\r\n      }\r\n    }\r\n\r\n    const w = this.activeRect.width;\r\n    const h = this.activeRect.height;\r\n    let offsetX = x - this.lastOffsetX;\r\n    let offsetY = y - this.lastOffsetY;\r\n    this.lastOffsetX = x;\r\n    this.lastOffsetY = y;\r\n    if (\r\n      (e as any).ctrlKey ||\r\n      (this.initPens.length === 1 && this.initPens[0].ratio)\r\n    ) {\r\n      // 1，3 是右上角和左上角的点，此时的 offsetY 符号与 offsetX 是相反的\r\n      const sign = [1, 3].includes(this.resizeIndex) ? -1 : 1;\r\n      offsetY = (sign * (offsetX * h)) / w;\r\n    }\r\n    (this.activeRect as any).ratio = this.initPens[0].ratio;\r\n    resizeRect(this.activeRect, offsetX, offsetY, this.resizeIndex);\r\n    //大屏区域\r\n    if (this.store.options.strictScope) {\r\n      const width = this.store.data.width || this.store.options.width;\r\n      const height = this.store.data.height || this.store.options.height;\r\n      if (width && height) {\r\n        let vRect: Rect = {\r\n          x: this.store.data.origin.x,\r\n          y: this.store.data.origin.y,\r\n          width: width * this.store.data.scale,\r\n          height: height * this.store.data.scale,\r\n        };\r\n\r\n        if (this.activeRect.x < vRect.x) {\r\n          this.activeRect.width =\r\n            this.activeRect.width - (vRect.x - this.activeRect.x);\r\n          this.activeRect.x = vRect.x;\r\n        }\r\n        if (this.activeRect.y < vRect.y) {\r\n          this.activeRect.height =\r\n            this.activeRect.height - (vRect.y - this.activeRect.y);\r\n          this.activeRect.y = vRect.y;\r\n        }\r\n        if (this.activeRect.x + this.activeRect.width > vRect.x + vRect.width) {\r\n          this.activeRect.width =\r\n            this.activeRect.width -\r\n            (this.activeRect.x +\r\n              this.activeRect.width -\r\n              (vRect.x + vRect.width));\r\n          this.activeRect.x = vRect.x + vRect.width - this.activeRect.width;\r\n          this.activeRect.ex = this.activeRect.x + this.activeRect.width;\r\n        }\r\n        if (\r\n          this.activeRect.y + this.activeRect.height >\r\n          vRect.y + vRect.height\r\n        ) {\r\n          this.activeRect.height =\r\n            this.activeRect.height -\r\n            (this.activeRect.y +\r\n              this.activeRect.height -\r\n              (vRect.y + vRect.height));\r\n          this.activeRect.y = vRect.y + vRect.height - this.activeRect.height;\r\n          this.activeRect.ey = this.activeRect.y + this.activeRect.height;\r\n        }\r\n      }\r\n    }\r\n    calcCenter(this.activeRect);\r\n\r\n    const scaleX = this.activeRect.width / w;\r\n    const scaleY = this.activeRect.height / h;\r\n    this.store.active.forEach((pen, i) => {\r\n      pen.calculative.worldRect.x =\r\n        this.activeInitPos[i].x * this.activeRect.width + this.activeRect.x;\r\n      pen.calculative.worldRect.y =\r\n        this.activeInitPos[i].y * this.activeRect.height + this.activeRect.y;\r\n      pen.calculative.worldRect.width *= scaleX;\r\n      pen.calculative.iconWidth && (pen.calculative.iconWidth *= scaleX);\r\n      pen.calculative.worldRect.height *= scaleY;\r\n      pen.calculative.iconHeight && (pen.calculative.iconHeight *= scaleY);\r\n      calcRightBottom(pen.calculative.worldRect);\r\n      calcCenter(pen.calculative.worldRect);\r\n      this.updatePenRect(pen, { worldRectIsReady: true });\r\n      this.execPenResize(pen);\r\n      this.updateLines(pen);\r\n    });\r\n    this.getSizeCPs();\r\n    this.initImageCanvas(this.store.active);\r\n    this.initTemplateCanvas(this.store.active);\r\n    this.render();\r\n    this.store.emitter.emit('resizePens', this.store.active);\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.timer = undefined;\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(this.store.active, true),\r\n        initPens: this.initPens,\r\n      });\r\n      this.initPens = undefined;\r\n    }, 200);\r\n  }\r\n\r\n  movePens(e: {\r\n    x: number;\r\n    y: number;\r\n    ctrlKey?: boolean;\r\n    shiftKey?: boolean;\r\n    altKey?: boolean;\r\n  }) {\r\n    if (!this.activeRect || this.store.data.locked) {\r\n      return;\r\n    }\r\n\r\n    if (!this.initActiveRect) {\r\n      this.initActiveRect = deepClone(this.activeRect);\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !this.store.options.moveConnectedLine &&\r\n      !this.canMoveLine &&\r\n      this.store.active.length === 1 &&\r\n      (this.store.active[0].anchors[0]?.connectTo ||\r\n        this.store.active[0].anchors[this.store.active[0].anchors.length - 1]\r\n          ?.connectTo)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.movingPens) {\r\n      this.initMovingPens();\r\n      this.store.active.forEach((pen) => {\r\n        setHover(pen, false);\r\n      });\r\n      this.store.hover = undefined;\r\n    }\r\n    if (!this.mouseDown) {\r\n      return;\r\n    }\r\n\r\n    let x = e.x - this.mouseDown.x;\r\n    let y = e.y - this.mouseDown.y;\r\n    e.shiftKey && !e.ctrlKey && (y = 0);\r\n    e.ctrlKey && (x = 0);\r\n    const rect = deepClone(this.initActiveRect);\r\n    translateRect(rect, x, y);\r\n    let vFlag = false;\r\n    if (this.store.options.strictScope) {\r\n      const width = this.store.data.width || this.store.options.width;\r\n      const height = this.store.data.height || this.store.options.height;\r\n      if (width && height) {\r\n        let vRect: Rect = {\r\n          x: this.store.data.origin.x,\r\n          y: this.store.data.origin.y,\r\n          width: width * this.store.data.scale,\r\n          height: height * this.store.data.scale,\r\n        };\r\n\r\n        if (rect.x < vRect.x) {\r\n          rect.x = vRect.x;\r\n          vFlag = true;\r\n        }\r\n        if (rect.y < vRect.y) {\r\n          rect.y = vRect.y;\r\n          vFlag = true;\r\n        }\r\n        if (rect.x + rect.width > vRect.x + vRect.width) {\r\n          rect.x = vRect.x + vRect.width - rect.width;\r\n          vFlag = true;\r\n        }\r\n        if (rect.y + rect.height > vRect.y + vRect.height) {\r\n          rect.y = vRect.y + vRect.height - rect.height;\r\n          vFlag = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    const offset: Point = {\r\n      x: rect.x - this.activeRect.x,\r\n      y: rect.y - this.activeRect.y,\r\n    };\r\n    if (!this.store.options.disableDock && !vFlag) {\r\n      this.clearDock();\r\n      const moveDock = this.customMoveDock || calcMoveDock;\r\n      this.dock = moveDock(this.store, rect, this.movingPens, offset);\r\n      const { xDock, yDock } = this.dock;\r\n      let dockPen: Pen;\r\n      if (xDock) {\r\n        offset.x += xDock.step;\r\n        dockPen = this.store.pens[xDock.penId];\r\n        dockPen.calculative.isDock = true;\r\n      }\r\n      if (yDock) {\r\n        offset.y += yDock.step;\r\n        dockPen = this.store.pens[yDock.penId];\r\n        dockPen.calculative.isDock = true;\r\n      }\r\n    }\r\n\r\n    this.translatePens(this.movingPens, offset.x, offset.y, true);\r\n  }\r\n\r\n  /**\r\n   * 初始化移动，更改画笔的 id parentId 等关联关系\r\n   * @param pen 要修改的画笔\r\n   * @param pens 本次操作的画笔们，包含子画笔\r\n   */\r\n  private changeIdsByMoving(pen: Pen, pens: Pen[]) {\r\n    pen.id += movingSuffix;\r\n    if (pen.parentId && pens.find((p) => p.id === pen.parentId)) {\r\n      pen.parentId += movingSuffix;\r\n    }\r\n    if (pen.children) {\r\n      pen.children = pen.children.map((child) => child + movingSuffix);\r\n    }\r\n    // 连接关系也需要变，用在 updateLines 中\r\n    if (pen.connectedLines) {\r\n      pen.connectedLines = pen.connectedLines.map((line) => {\r\n        if (pens.find((p) => p.id === line.lineId)) {\r\n          line.lineId += movingSuffix;\r\n        }\r\n        return line;\r\n      });\r\n    }\r\n    if (pen.type && pen.calculative.worldAnchors) {\r\n      pen.calculative.worldAnchors = pen.calculative.worldAnchors.map(\r\n        (anchor) => {\r\n          if (anchor.connectTo && pens.find((p) => p.id === anchor.connectTo)) {\r\n            anchor.connectTo += movingSuffix;\r\n          }\r\n          return anchor;\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 初始化 this.movingPens\r\n   * 修改 ids （id parentId children 等）\r\n   * 半透明，去图片\r\n   */\r\n  initMovingPens() {\r\n    if (!this.store.options.moveConnectedLine && !this.canMoveLine) {\r\n      for (let i = 0; i < this.store.active.length; i++) {\r\n        const pen = this.store.active[i];\r\n        if (\r\n          pen.anchors[0]?.connectTo ||\r\n          pen.anchors[pen.anchors.length - 1]?.connectTo\r\n        ) {\r\n          this.store.active.splice(i, 1);\r\n          pen.calculative.active = undefined;\r\n          --i;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.movingPens = deepClone(this.store.active, true);\r\n    this.movingPens = this.getAllFollowersByPens(this.movingPens);\r\n    const containChildPens = this.getAllByPens(this.movingPens);\r\n    const copyContainChildPens = deepClone(containChildPens, true);\r\n    // 考虑父子关系，修改 id\r\n    containChildPens.forEach((pen) => {\r\n      this.changeIdsByMoving(pen, copyContainChildPens);\r\n      this.store.pens[pen.id] = pen; // updatePenRect 时需要计算\r\n      pen.calculative.canvas = this;\r\n      const value: Pen = {\r\n        globalAlpha: 0.5,\r\n      };\r\n      // 线宽为 0 ，看不到外边框，拖动过程中给个外边框\r\n      pen.lineWidth === 0 && (value.lineWidth = 1);\r\n      // TODO: 例如 pen.name = 'triangle' 的情况，但有图片，是否还需要变成矩形呢？\r\n      if (\r\n        pen.name.endsWith('Dom') ||\r\n        isDomShapes.includes(pen.name) ||\r\n        this.store.options.domShapes.includes(pen.name) ||\r\n        pen.image\r\n      ) {\r\n        // 修改名称会执行 onDestroy ，清空它\r\n        value.name = 'rectangle';\r\n        value.onDestroy = undefined;\r\n      }\r\n      this.updateValue(pen, value);\r\n      pen.calculative.image = undefined;\r\n    });\r\n  }\r\n\r\n  moveLineAnchor(\r\n    pt: { x: number; y: number },\r\n    keyOptions: { ctrlKey?: boolean; shiftKey?: boolean; altKey?: boolean }\r\n  ) {\r\n    if (!this.activeRect || this.store.data.locked) {\r\n      return;\r\n    }\r\n    if (!this.initPens) {\r\n      this.initPens = deepClone(this.store.active, true);\r\n    }\r\n\r\n    if (this.store.activeAnchor?.connectTo) {\r\n      const pen = this.store.pens[this.store.activeAnchor.connectTo];\r\n      disconnectLine(\r\n        pen,\r\n        getAnchor(pen, this.store.activeAnchor.anchorId),\r\n        this.store.pens[this.store.activeAnchor.penId],\r\n        this.store.activeAnchor\r\n      );\r\n    }\r\n    let anchorId = this.store.activeAnchor?.id;\r\n    let connectedLine = this.store.pens[\r\n      this.store.activeAnchor.penId\r\n    ]?.connectedLines?.filter((item) => item.anchor === anchorId);\r\n    if (connectedLine && connectedLine.length > 0) {\r\n      connectedLine.forEach((connected) => {\r\n        const pen = this.store.pens[connected.lineId];\r\n        disconnectLine(\r\n          this.store.pens[this.store.activeAnchor.penId],\r\n          this.store.activeAnchor,\r\n          pen,\r\n          getAnchor(pen, connected.lineAnchor)\r\n        );\r\n      });\r\n    }\r\n\r\n    const line = this.store.active[0];\r\n    const from = getFromAnchor(line);\r\n    const to = getToAnchor(line);\r\n\r\n    if (line.lineName === 'polyline' && !keyOptions.shiftKey) {\r\n      translatePolylineAnchor(line, this.store.activeAnchor, pt);\r\n    } else {\r\n      let offsetX = 0;\r\n      let offsetY = 0;\r\n      if (\r\n        line.lineName === 'line'\r\n      ) {\r\n        let index = line.calculative.worldAnchors.findIndex(\r\n          (anchor) => anchor.id === this.store.activeAnchor.id\r\n        );\r\n        if (index === 0) {\r\n          index = 2;\r\n        }\r\n        let relativePt = line.calculative.worldAnchors[index - 1];\r\n        if (keyOptions.ctrlKey && keyOptions.shiftKey) {\r\n          let _pt = deepClone(pt);\r\n          this.getSpecialAngle(\r\n            _pt,\r\n            relativePt\r\n          );\r\n          offsetX = _pt.x - this.store.activeAnchor.x;\r\n          offsetY = _pt.y - this.store.activeAnchor.y;\r\n        } else if (!keyOptions.ctrlKey && keyOptions.shiftKey) {\r\n          let _pt = {\r\n            x: pt.x,\r\n            y: relativePt.y,\r\n          };\r\n          offsetX = _pt.x - this.store.activeAnchor.x;\r\n          offsetY = _pt.y - this.store.activeAnchor.y;\r\n        } else if (keyOptions.ctrlKey && !keyOptions.shiftKey) {\r\n          let _pt = {\r\n            x: relativePt.x,\r\n            y: pt.y,\r\n          };\r\n          offsetX = _pt.x - this.store.activeAnchor.x;\r\n          offsetY = _pt.y - this.store.activeAnchor.y;\r\n        } else {\r\n          offsetX = pt.x - this.store.activeAnchor.x;\r\n          offsetY = pt.y - this.store.activeAnchor.y;\r\n        }\r\n      } else {\r\n        if(!keyOptions.ctrlKey && keyOptions.shiftKey){\r\n          offsetX = pt.x - this.store.activeAnchor.x;\r\n          offsetY = 0;\r\n        }else if(keyOptions.ctrlKey && !keyOptions.shiftKey){\r\n          offsetX = 0;\r\n          offsetY = pt.y - this.store.activeAnchor.y;\r\n        }else{\r\n          offsetX = pt.x - this.store.activeAnchor.x;\r\n          offsetY = pt.y - this.store.activeAnchor.y;\r\n        }\r\n      }\r\n      translatePoint(this.store.activeAnchor, offsetX, offsetY);\r\n      if (\r\n        this.store.hover &&\r\n        this.store.hoverAnchor &&\r\n        this.store.hoverAnchor.penId !== this.store.activeAnchor.penId\r\n      ) {\r\n        if (this.store.hoverAnchor.type === PointType.Line) {\r\n          offsetX = pt.x - this.store.activeAnchor.x;\r\n          offsetY = pt.y - this.store.activeAnchor.y;\r\n          getDistance(\r\n            this.store.activeAnchor,\r\n            this.store.hoverAnchor,\r\n            this.store\r\n          );\r\n        } else {\r\n          offsetX = this.store.hoverAnchor.x - this.store.activeAnchor.x;\r\n          offsetY = this.store.hoverAnchor.y - this.store.activeAnchor.y;\r\n        }\r\n        translatePoint(this.store.activeAnchor, offsetX, offsetY);\r\n\r\n        to.prev = undefined;\r\n        // 重新自动计算连线\r\n        if (line.lineName !== 'polyline') {\r\n          this[line.lineName]?.(this.store, line);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.patchFlagsLines.add(line);\r\n    this.store.path2dMap.set(line, globalStore.path2dDraws[line.name](line));\r\n    this.render();\r\n    this.store.active[0].calculative &&\r\n      (this.store.active[0].calculative.gradientAnimatePath = undefined);\r\n    this.store.emitter.emit('moveLineAnchor', {\r\n      pen: this.store.active[0],\r\n      anchor: this.store.activeAnchor,\r\n    });\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.timer = undefined;\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(this.store.active, true),\r\n        initPens: this.initPens,\r\n      });\r\n      this.initPens = undefined;\r\n    }, 500);\r\n  }\r\n\r\n  moveLineAnchorPrev(e: { x: number; y: number }) {\r\n    if (\r\n      !this.activeRect ||\r\n      this.store.data.locked ||\r\n      !this.store.activeAnchor\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (!this.initPens) {\r\n      this.initPens = deepClone(this.store.active, true);\r\n    }\r\n\r\n    this.store.activeAnchor.prev.x = e.x;\r\n    this.store.activeAnchor.prev.y = e.y;\r\n    if (this.store.activeAnchor.next) {\r\n      if (!this.store.activeAnchor.prevNextType) {\r\n        this.store.activeAnchor.next.x = e.x;\r\n        this.store.activeAnchor.next.y = e.y;\r\n        rotatePoint(this.store.activeAnchor.next, 180, this.store.activeAnchor);\r\n      } else if (\r\n        this.store.activeAnchor.prevNextType === PrevNextType.Bilateral &&\r\n        this.prevAnchor\r\n      ) {\r\n        const rotate = calcRotate(e, this.store.activeAnchor);\r\n        const prevRotate = calcRotate(this.prevAnchor, this.store.activeAnchor);\r\n        this.store.activeAnchor.next.x = this.nextAnchor.x;\r\n        this.store.activeAnchor.next.y = this.nextAnchor.y;\r\n        rotatePoint(\r\n          this.store.activeAnchor.next,\r\n          rotate - prevRotate,\r\n          this.store.activeAnchor\r\n        );\r\n      }\r\n    }\r\n    const line = this.store.active[0];\r\n    this.patchFlagsLines.add(line);\r\n    this.store.path2dMap.set(line, globalStore.path2dDraws[line.name](line));\r\n    this.render();\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.timer = undefined;\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(this.store.active, true),\r\n        initPens: this.initPens,\r\n      });\r\n      this.initPens = undefined;\r\n    }, 200);\r\n  }\r\n\r\n  moveLineAnchorNext(e: { x: number; y: number }) {\r\n    if (\r\n      !this.activeRect ||\r\n      this.store.data.locked ||\r\n      !this.store.activeAnchor\r\n    ) {\r\n      return;\r\n    }\r\n    if (!this.initPens) {\r\n      this.initPens = deepClone(this.store.active, true);\r\n    }\r\n\r\n    this.store.activeAnchor.next.x = e.x;\r\n    this.store.activeAnchor.next.y = e.y;\r\n    if (this.store.activeAnchor.prev) {\r\n      if (!this.store.activeAnchor.prevNextType) {\r\n        this.store.activeAnchor.prev.x = e.x;\r\n        this.store.activeAnchor.prev.y = e.y;\r\n        rotatePoint(this.store.activeAnchor.prev, 180, this.store.activeAnchor);\r\n      } else if (\r\n        this.store.activeAnchor.prevNextType === PrevNextType.Bilateral &&\r\n        this.nextAnchor\r\n      ) {\r\n        const rotate = calcRotate(e, this.store.activeAnchor);\r\n        const nextRotate = calcRotate(this.nextAnchor, this.store.activeAnchor);\r\n        this.store.activeAnchor.prev.x = this.prevAnchor.x;\r\n        this.store.activeAnchor.prev.y = this.prevAnchor.y;\r\n        rotatePoint(\r\n          this.store.activeAnchor.prev,\r\n          rotate - nextRotate,\r\n          this.store.activeAnchor\r\n        );\r\n      }\r\n    }\r\n\r\n    const line = this.store.active[0];\r\n    this.patchFlagsLines.add(line);\r\n    this.store.path2dMap.set(line, globalStore.path2dDraws[line.name](line));\r\n    this.render();\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n    this.timer = setTimeout(() => {\r\n      this.timer = undefined;\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(this.store.active, true),\r\n        initPens: this.initPens,\r\n      });\r\n      this.initPens = undefined;\r\n    }, 200);\r\n  }\r\n\r\n  async setAnchor(e: { x: number; y: number }) {\r\n    const initPens = [deepClone(this.store.hover, true)];\r\n    const hoverPen = this.store.hover;\r\n\r\n    if (this.store.hoverAnchor) {\r\n      if (\r\n        this.beforeRemoveAnchor &&\r\n        !(await this.beforeRemoveAnchor(hoverPen, this.store.hoverAnchor))\r\n      ) {\r\n        return;\r\n      }\r\n      if (\r\n        hoverPen.type === PenType.Line &&\r\n        hoverPen.calculative.worldAnchors?.length <= 2\r\n      ) {\r\n        this.delete([hoverPen]);\r\n      } else {\r\n        removePenAnchor(hoverPen, this.store.hoverAnchor);\r\n        if (hoverPen.type === PenType.Line) {\r\n          this.initLineRect(hoverPen);\r\n        }\r\n      }\r\n      this.store.hoverAnchor = undefined;\r\n      this.store.activeAnchor = undefined;\r\n      this.externalElements.style.cursor = 'default';\r\n    } else if (hoverPen) {\r\n      if (\r\n        this.beforeAddAnchor &&\r\n        !(await this.beforeAddAnchor(hoverPen, this.store.pointAt))\r\n      ) {\r\n        return;\r\n      }\r\n      if (hoverPen.type === PenType.Line) {\r\n        this.store.activeAnchor = addLineAnchor(\r\n          hoverPen,\r\n          this.store.pointAt,\r\n          this.store.pointAtIndex\r\n        );\r\n        this.initLineRect(hoverPen);\r\n\r\n        const pt = { x: e.x, y: e.y };\r\n        this.getHover(pt);\r\n      } else {\r\n        const pt = { id: s8(), x: e.x, y: e.y };\r\n        this.store.activeAnchor = pushPenAnchor(hoverPen, pt);\r\n      }\r\n    }\r\n    this.hotkeyType = HotkeyType.None;\r\n    this.render();\r\n    if (hoverPen) {\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: [deepClone(hoverPen, true)],\r\n        initPens,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 连线允许移动，若与其它图形有连接，但其它图形不在此次移动中，会断开连接\r\n   * @param line 连线\r\n   * @param pens 本次移动的全部图形，包含子节点\r\n   */\r\n  private checkDisconnect(line: Pen, pens: Pen[]) {\r\n    if (line.id.indexOf(movingSuffix) > 0) {\r\n      const id = line.id;\r\n      line = this.store.pens[id.replace(movingSuffix, '')];\r\n    }\r\n    // 连接\r\n    line.anchors.forEach((anchor) => {\r\n      if (\r\n        anchor.connectTo &&\r\n        !pens.find(\r\n          (p) =>\r\n            p.id === anchor.connectTo ||\r\n            p.id === anchor.connectTo + movingSuffix\r\n        )\r\n      ) {\r\n        const pen = this.store.pens[anchor.connectTo];\r\n        if (!pen || pen.type) {\r\n          return;\r\n        }\r\n        disconnectLine(pen, getAnchor(pen, anchor.anchorId), line, anchor);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 移动 画笔们\r\n   * @param pens 画笔们，不包含子节点\r\n   * @param x 偏移 x\r\n   * @param y 偏移 y\r\n   * @param doing 是否持续移动\r\n   */\r\n  translatePens(\r\n    pens = this.store.active,\r\n    x: number,\r\n    y: number,\r\n    doing?: boolean\r\n  ) {\r\n    if (!pens || !pens.length) {\r\n      return;\r\n    }\r\n    let hasLocked = pens.some((item: Pen) => {\r\n      if (item.locked >= LockState.DisableMove) return true;\r\n    });\r\n    if (hasLocked) {\r\n      return;\r\n    }\r\n    const initPens = !doing && deepClone(pens, true);\r\n    this.activeRect && translateRect(this.activeRect, x, y);\r\n\r\n    const containChildPens = this.getAllByPens(pens);\r\n    pens.forEach((pen) => {\r\n      if (pen.locked >= LockState.DisableMove) {\r\n        return;\r\n      }\r\n\r\n      if (pen.type === PenType.Line) {\r\n        if (!this.store.options.moveConnectedLine && !this.canMoveLine) {\r\n          return;\r\n        }\r\n        if(pen.isRuleLine){\r\n          return;\r\n        }\r\n        translateLine(pen, x, y);\r\n        this.checkDisconnect(pen, containChildPens);\r\n        this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n        if (!doing) {\r\n          this.initLineRect(pen);\r\n          pen.connectedLines?.forEach((item) => {\r\n            const line = this.store.pens[item.lineId];\r\n            this.initLineRect(line);\r\n          });\r\n        }\r\n      } else {\r\n        translateRect(pen.calculative.worldRect, x, y);\r\n        this.updatePenRect(pen, { worldRectIsReady: true });\r\n        pen.calculative.x = pen.x;\r\n        pen.calculative.y = pen.y;\r\n        if (pen.calculative.initRect) {\r\n          pen.calculative.initRect.x = pen.calculative.x;\r\n          pen.calculative.initRect.y = pen.calculative.y;\r\n          pen.calculative.initRect.ex =\r\n            pen.calculative.x + pen.calculative.width;\r\n          pen.calculative.initRect.ey =\r\n            pen.calculative.y + pen.calculative.height;\r\n        }\r\n      }\r\n      this.updateLines(pen);\r\n      pen.onMove?.(pen);\r\n    });\r\n    this.activeRect && this.getSizeCPs();\r\n    this.render();\r\n    this.tooltip.translate(x, y);\r\n\r\n    if (!doing) {\r\n      // 单次的移动需要记历史记录\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: deepClone(pens, true),\r\n        initPens,\r\n      });\r\n      this.initImageCanvas(pens);\r\n      this.initTemplateCanvas(pens);\r\n      this.store.emitter.emit('translatePens', pens);\r\n    }\r\n    this.store.emitter.emit('translatingPens', pens);\r\n  }\r\n\r\n  /**\r\n   * 移动 画笔们\r\n   * @param pens 画笔们，不包含子节点\r\n   * @param x 偏移 x\r\n   * @param y 偏移 y\r\n   * @param doing 是否持续移动\r\n   */\r\n  templateTranslatePens(pens = this.store.active, x: number, y: number) {\r\n    if (!pens || !pens.length) {\r\n      return;\r\n    }\r\n    const containChildPens = this.getAllByPens(pens);\r\n    pens.forEach((pen) => {\r\n      if (pen.type === PenType.Line) {\r\n        if (!this.store.options.moveConnectedLine && !this.canMoveLine) {\r\n          return;\r\n        }\r\n        translateLine(pen, x, y);\r\n        this.checkDisconnect(pen, containChildPens);\r\n        this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n      } else {\r\n        translateRect(pen.calculative.worldRect, x, y);\r\n        this.updatePenRect(pen, { worldRectIsReady: true });\r\n        pen.calculative.x = pen.x;\r\n        pen.calculative.y = pen.y;\r\n        if (pen.calculative.initRect) {\r\n          pen.calculative.initRect.x = pen.calculative.x;\r\n          pen.calculative.initRect.y = pen.calculative.y;\r\n          pen.calculative.initRect.ex =\r\n            pen.calculative.x + pen.calculative.width;\r\n          pen.calculative.initRect.ey =\r\n            pen.calculative.y + pen.calculative.height;\r\n        }\r\n      }\r\n      pen.onMove?.(pen);\r\n    });\r\n  }\r\n\r\n  private calcAutoAnchor(\r\n    line: Pen,\r\n    lineAnchor: Point,\r\n    pen: Pen,\r\n    penConnection?: ConnectLine\r\n  ) {\r\n    const from = getFromAnchor(line);\r\n    const to = getToAnchor(line);\r\n    const newAnchor = nearestAnchor(pen, lineAnchor === from ? to : from);\r\n    if (!newAnchor) {\r\n      return;\r\n    }\r\n    lineAnchor.x = newAnchor.x;\r\n    lineAnchor.y = newAnchor.y;\r\n    lineAnchor.prev = undefined;\r\n    lineAnchor.next = undefined;\r\n    if (penConnection) {\r\n      penConnection.anchor = newAnchor.id;\r\n    } else {\r\n      connectLine(pen, newAnchor, line, lineAnchor);\r\n    }\r\n\r\n    if (this[line.lineName]) {\r\n      this[line.lineName](this.store, line);\r\n    }\r\n\r\n    this.store.path2dMap.set(line, globalStore.path2dDraws.line(line));\r\n    this.initLineRect(line);\r\n  }\r\n\r\n  restoreNodeAnimate(pen: Pen) {\r\n    if (pen.calculative.initRect) {\r\n      if (pen.keepAnimateState) {\r\n        for (const k in pen) {\r\n          if (pen.calculative[k] === undefined) {\r\n            continue;\r\n          }\r\n          if (\r\n            k !== 'x' &&\r\n            k !== 'y' &&\r\n            k !== 'width' &&\r\n            k !== 'height' &&\r\n            k !== 'initRect' &&\r\n            (typeof pen[k] !== 'object' || k === 'lineDash')\r\n          ) {\r\n            if (k === 'fontSize' || k === 'lineWidth') {\r\n              pen[k] =\r\n                pen.calculative[k] / pen.calculative.canvas.store.data.scale;\r\n            } else {\r\n              pen[k] = pen.calculative[k];\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        const rotate = pen.calculative.initRect.rotate - pen.calculative.rotate;\r\n        for (const k in pen) {\r\n          if (\r\n            k !== 'x' &&\r\n            k !== 'y' &&\r\n            k !== 'width' &&\r\n            k !== 'height' &&\r\n            k !== 'initRect' &&\r\n            k !== 'rotate' &&\r\n            (typeof pen[k] !== 'object' || k === 'lineDash')\r\n          ) {\r\n            pen.calculative[k] = pen[k];\r\n          }\r\n        }\r\n        if (pen.children?.length) {\r\n          if (rotate) {\r\n            rotatePen(pen, rotate, pen.calculative.worldRect);\r\n          }\r\n        } else {\r\n          pen.calculative.rotate = pen.rotate;\r\n        }\r\n        //其他回到最初始状态\r\n        const originStatus = deepClone(this.store.animateMap.get(pen));\r\n        if (originStatus) {\r\n          originStatus.id = pen.id;\r\n          this.parent.setValue(originStatus, {\r\n            doEvent: false,\r\n            render: true,\r\n            history: false,\r\n          });\r\n        }\r\n        pen.calculative.worldRect = pen.calculative.initRect;\r\n      }\r\n      this.updatePenRect(pen, { worldRectIsReady: true });\r\n      this.updateLines(pen);\r\n      if (pen.image && pen.name !== 'gif') {\r\n        this.canvasImage.init();\r\n        this.canvasImageBottom.init();\r\n      }\r\n      if (pen.calculative.text !== pen.text) {\r\n        pen.calculative.text = pen.text;\r\n        calcTextLines(pen);\r\n      }\r\n      if (this.store.active?.length) {\r\n        this.calcActiveRect();\r\n      }\r\n      pen.calculative.initRect = undefined;\r\n    }\r\n  }\r\n\r\n  updateLines(pen: Pen, change?: boolean) {\r\n    pen.children?.forEach((child: string) => {\r\n      const childPen = this.store.pens[child];\r\n      if (childPen) {\r\n        // 每个子节点都会更新 line，包括子节点是 type 1 的情况\r\n        this.updateLines(childPen, change);\r\n      }\r\n    });\r\n    if (!pen.connectedLines) {\r\n      return;\r\n    }\r\n    pen.connectedLines.forEach((item,index) => {\r\n      const line = this.store.pens[item.lineId];\r\n      // 活动层的线不需要更新，会在活动层处理\r\n      if (!line || line.calculative.active) {\r\n        return;\r\n      }\r\n\r\n      const lineAnchor = getAnchor(line, item.lineAnchor);\r\n      if (!lineAnchor) {\r\n        return;\r\n      }\r\n      if(!lineAnchor.connectTo){\r\n        // 如果pen有连接关系但连线中没有连接关系，删除pen的连接关系\r\n        pen.connectedLines.splice(index,1);\r\n        return;\r\n      }\r\n\r\n      if (line.autoFrom) {\r\n        const from = getFromAnchor(line);\r\n        if (from.id === lineAnchor.id) {\r\n          this.calcAutoAnchor(line, from, pen, item);\r\n        }\r\n      }\r\n\r\n      if (line.autoTo) {\r\n        const to = getToAnchor(line);\r\n        if (to.id === lineAnchor.id) {\r\n          this.calcAutoAnchor(line, to, pen, item);\r\n        }\r\n      }\r\n\r\n      const penAnchor = getAnchor(pen, item.anchor);\r\n      if (!penAnchor) {\r\n        return;\r\n      }\r\n      let rotate = pen.rotate;\r\n      if (pen.flipX) {\r\n        rotate *= -1;\r\n      }\r\n      if (pen.flipY) {\r\n        rotate *= -1;\r\n      }\r\n      let offsetX =\r\n        lineAnchor.distance *\r\n          this.store.data.scale *\r\n          Math.cos(((rotate + penAnchor.rotate) / 180) * Math.PI) || 0;\r\n      let offsetY =\r\n        lineAnchor.distance *\r\n          this.store.data.scale *\r\n          Math.sin(((rotate + penAnchor.rotate) / 180) * Math.PI) || 0;\r\n      if (pen.flipX) {\r\n        offsetX = -offsetX;\r\n      }\r\n      if (pen.flipY) {\r\n        offsetY = -offsetY;\r\n      }\r\n      translatePoint(\r\n        lineAnchor,\r\n        penAnchor.x - lineAnchor.x + offsetX,\r\n        penAnchor.y - lineAnchor.y + offsetY\r\n      );\r\n      if (\r\n        this.store.options.autoPolyline &&\r\n        !this.autoPolylineFlag &&\r\n        line.autoPolyline !== false &&\r\n        line.lineName === 'polyline'\r\n      ) {\r\n        let from = getFromAnchor(line);\r\n        let to = getToAnchor(line);\r\n\r\n        let found = false;\r\n\r\n        if (from.id === lineAnchor.id) {\r\n          from = lineAnchor;\r\n          found = true;\r\n        } else if (to.id === lineAnchor.id) {\r\n          to = lineAnchor;\r\n          found = true;\r\n        }\r\n        if (found) {\r\n          line.calculative.worldAnchors = [from, to];\r\n          line.calculative.activeAnchor = from;\r\n          this.polyline(this.store, line, to);\r\n          this.initLineRect(line);\r\n        }\r\n      }\r\n\r\n      this.store.path2dMap.set(line, globalStore.path2dDraws[line.name](line));\r\n      this.patchFlagsLines.add(line);\r\n      if (line.calculative.gradientSmooth) {\r\n        line.calculative.gradientAnimatePath = getGradientAnimatePath(line);\r\n      }\r\n\r\n      change && getLineLength(line);\r\n    });\r\n  }\r\n\r\n  calcActiveRect() {\r\n    // TODO: visible 不可见， 目前只是不计算 activeRect，考虑它是否进入活动层 store.active\r\n    const canMovePens = this.store.active.filter(\r\n      (pen: Pen) =>\r\n        (!pen.locked || pen.locked < LockState.DisableMove) &&\r\n        pen.visible != false\r\n    );\r\n    if (!canMovePens.length) {\r\n      return;\r\n    } else if (canMovePens.length === 1) {\r\n      this.activeRect = deepClone(canMovePens[0].calculative.worldRect);\r\n      this.activeRect.rotate = canMovePens[0].calculative.rotate || 0;\r\n      calcCenter(this.activeRect);\r\n    } else {\r\n      this.activeRect = getRect(canMovePens);\r\n      this.activeRect.rotate = 0;\r\n    }\r\n    this.lastRotate = 0;\r\n    this.getSizeCPs();\r\n  }\r\n\r\n  /**\r\n   * 旋转当前画笔包括子节点\r\n   * @param pen 旋转的画笔\r\n   * @param angle 本次的旋转值，加到 pen.calculative.rotate 上\r\n   */\r\n  rotatePen(pen: Pen, angle: number, rect: Rect) {\r\n    if (pen.type) {\r\n      pen.calculative.worldAnchors.forEach((anchor) => {\r\n        rotatePoint(anchor, angle, rect.center);\r\n      });\r\n      this.initLineRect(pen);\r\n      calcPenRect(pen);\r\n    } else {\r\n      if (pen.calculative.rotate) {\r\n        pen.calculative.rotate += angle;\r\n      } else {\r\n        pen.calculative.rotate = angle;\r\n      }\r\n      rotatePoint(pen.calculative.worldRect.center, angle, rect.center);\r\n      if (pen.parentId) {\r\n        pen.calculative.worldRect.x =\r\n          pen.calculative.worldRect.center.x -\r\n          pen.calculative.worldRect.width / 2;\r\n        pen.calculative.worldRect.y =\r\n          pen.calculative.worldRect.center.y -\r\n          pen.calculative.worldRect.height / 2;\r\n        pen.x = (pen.calculative.worldRect.x - rect.x) / rect.width;\r\n        pen.y = (pen.calculative.worldRect.y - rect.y) / rect.height;\r\n      } else {\r\n        pen.x = pen.calculative.worldRect.center.x - pen.width / 2;\r\n        pen.y = pen.calculative.worldRect.center.y - pen.height / 2;\r\n      }\r\n      pen.rotate = pen.calculative.rotate;\r\n      this.updatePenRect(pen);\r\n\r\n      if (pen.children) {\r\n        pen.children.forEach((id) => {\r\n          const child = this.store.pens[id];\r\n          this.rotatePen(child, angle, pen.calculative.worldRect);\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  nextAnimate(pen: Pen) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    this.store.emitter.emit('animateEnd', pen);\r\n\r\n    let pens: Pen[];\r\n    if (pen.nextAnimate) {\r\n      pens = this.store.data.pens.filter((p) => {\r\n        return (\r\n          p.id === pen.nextAnimate ||\r\n          (p.tags && p.tags.indexOf(pen.nextAnimate) > -1)\r\n        );\r\n      });\r\n    }\r\n\r\n    if (!pens) {\r\n      return;\r\n    }\r\n\r\n    pens.forEach((pen) => {\r\n      if (pen.calculative.pause) {\r\n        const d = Date.now() - pen.calculative.pause;\r\n        pen.calculative.pause = undefined;\r\n        pen.calculative.frameStart += d;\r\n        pen.calculative.frameEnd += d;\r\n      } else {\r\n        if (pen.name === 'video') {\r\n          pen.calculative.media.currentTime = 0;\r\n          pen.calculative.media?.play();\r\n          pen.onStartVideo?.(pen);\r\n        } else if (\r\n          pen.type ||\r\n          pen.frames?.length ||\r\n          (pen.animations && pen.animations.length)\r\n        ) {\r\n          //存储动画初始状态\r\n          if (!pen.type) {\r\n            if (!pen.frames && pen.animations && pen.animations.length) {\r\n              //无活动动画\r\n              let autoIndex = pen.animations?.findIndex((i) => i.autoPlay);\r\n              let index = autoIndex === -1 ? 0 : autoIndex;\r\n              const animate = deepClone(pen.animations[index]);\r\n              delete animate.name;\r\n              animate.currentAnimation = index;\r\n              if (!pen.type && animate.frames) {\r\n                animate.showDuration = this.parent.calcAnimateDuration(animate);\r\n              }\r\n              this.parent.setValue(\r\n                {\r\n                  id: pen.id,\r\n                  ...animate,\r\n                },\r\n                {\r\n                  doEvent: false,\r\n                  history: false,\r\n                }\r\n              );\r\n            }\r\n            this.store.animateMap.set(pen, this.getFrameProps(pen));\r\n          } else {\r\n            if (pen.animations?.length) {\r\n              //默认执行line的第一个动画\r\n              const animate = deepClone(pen.animations[0]);\r\n              delete animate.name;\r\n              animate.currentAnimation = 0;\r\n              this.parent.setValue(\r\n                {\r\n                  id: pen.id,\r\n                  ...animate,\r\n                },\r\n                {\r\n                  doEvent: false,\r\n                  history: false,\r\n                }\r\n              );\r\n            }\r\n          }\r\n          this.store.animates.add(pen);\r\n        }\r\n      }\r\n    });\r\n    this.animate();\r\n  }\r\n\r\n  getFrameProps(pen: Pen) {\r\n    let initProps = {};\r\n    pen.frames &&\r\n      pen.frames.forEach((frame) => {\r\n        for (let key in frame) {\r\n          if (\r\n            !['duration', 'x', 'y', 'width', 'height', 'rotate'].includes(\r\n              key\r\n            ) &&\r\n            !initProps[key]\r\n          ) {\r\n            initProps[key] = pen[key];\r\n          }\r\n        }\r\n      });\r\n    return initProps;\r\n  }\r\n\r\n  animate() {\r\n    if (this.animateRendering) {\r\n      return;\r\n    }\r\n\r\n    requestAnimationFrame(() => {\r\n      const now = Date.now();\r\n\r\n      if (now - this.lastAnimateRender < this.store.options.animateInterval) {\r\n        if (this.store.animates.size > 0) {\r\n          this.animate();\r\n        }\r\n        return;\r\n      }\r\n      this.lastAnimateRender = now;\r\n      this.animateRendering = true;\r\n      const dels: Pen[] = [];\r\n      let active = false;\r\n      for (const pen of this.store.animates) {\r\n        if (pen.calculative.pause) {\r\n          continue;\r\n        }\r\n        if (pen.calculative.active && !pen.type && !this.movingPens) {\r\n          // 存在节点在活动层，并且不在移动中\r\n          active = true;\r\n        }\r\n        if (!pen.type) {\r\n          if (setNodeAnimate(pen, now)) {\r\n            if (pen.calculative.patchFlags) {\r\n              calcCenter(pen.calculative.worldRect);\r\n              this.updatePenRect(pen, {\r\n                worldRectIsReady: true,\r\n                playingAnimate: true,\r\n              });\r\n            }\r\n          } else {\r\n            // 避免未到绘画帧，用户点击了停止动画，产生了时间差数据\r\n            requestAnimationFrame(() => {\r\n              this.restoreNodeAnimate(pen);\r\n            });\r\n\r\n            dels.push(pen);\r\n            this.nextAnimate(pen);\r\n          }\r\n          this.updateLines(pen, true);\r\n        } else {\r\n          if (!setLineAnimate(pen, now)) {\r\n            if (pen.keepAnimateState) {\r\n              for (const k in pen) {\r\n                if (pen.calculative[k] === undefined) {\r\n                  continue;\r\n                }\r\n                if(k === 'length'){\r\n                  continue;\r\n                }\r\n                if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n                  if (k === 'lineWidth') {\r\n                    pen[k] =\r\n                      pen.calculative[k] /\r\n                      pen.calculative.canvas.store.data.scale;\r\n                  } else {\r\n                    pen[k] = pen.calculative[k];\r\n                  }\r\n                }\r\n              }\r\n              calcPenRect(pen);\r\n            } else {\r\n              for (const k in pen) {\r\n                if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n                  if (k === 'lineWidth') {\r\n                    pen.calculative[k] =\r\n                      pen[k] * pen.calculative.canvas.store.data.scale;\r\n                  } else {\r\n                    pen.calculative[k] = pen[k];\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            dels.push(pen);\r\n            this.nextAnimate(pen);\r\n          }\r\n        }\r\n\r\n        this.patchFlags = true;\r\n      }\r\n      if (active) {\r\n        this.calcActiveRect();\r\n      }\r\n      dels.forEach((pen) => {\r\n        this.store.animates.delete(pen);\r\n      });\r\n      this.render(false);\r\n      this.animateRendering = false;\r\n      this.animate();\r\n    });\r\n  }\r\n\r\n  get clipboardName(): string {\r\n    return 'meta2d-clipboard';\r\n  }\r\n\r\n  async copy(pens?: Pen[], emit = true) {\r\n    const page = s8();\r\n    // 得到当前活动层的，包括子节点\r\n    const { origin, scale } = this.store.data;\r\n    this.store.clipboard = undefined;\r\n    localStorage.removeItem(this.clipboardName);\r\n    sessionStorage.setItem('page', page);\r\n\r\n    let copyPens: Pen[] = this.getAllByPens(\r\n      deepClone(pens || this.store.active, true)\r\n    );\r\n    //根据pens顺序复制\r\n    copyPens.forEach((activePen: any) => {\r\n      activePen.copyIndex = this.store.data.pens.findIndex(\r\n        (pen) => pen.id === activePen.id\r\n      );\r\n      if(activePen.pathId){\r\n        //复制svgpath\r\n        activePen.path = this.store.data.paths[activePen.pathId];\r\n      }\r\n    });\r\n    copyPens.sort((a: any, b: any) => {\r\n      return a.copyIndex - b.copyIndex;\r\n    });\r\n    copyPens.forEach((activePen: any) => {\r\n      delete activePen.copyIndex;\r\n    });\r\n    const clipboard = {\r\n      meta2d: true,\r\n      pens: copyPens,\r\n      origin: deepClone(origin),\r\n      scale,\r\n      page,\r\n      initRect: deepClone(this.activeRect),\r\n      offset: 10,\r\n    };\r\n\r\n    if (\r\n      navigator.clipboard &&\r\n      !this.store.options.disableClipboard &&\r\n      !navigator.userAgent.includes('Firefox')\r\n    ) {\r\n      try {\r\n        await navigator.clipboard.writeText(JSON.stringify(clipboard));\r\n      } catch {\r\n        localStorage.setItem(this.clipboardName, JSON.stringify(clipboard));\r\n      }\r\n    } else {\r\n      localStorage.setItem(this.clipboardName, JSON.stringify(clipboard));\r\n    }\r\n\r\n    emit && this.store.emitter.emit('copy', clipboard.pens);\r\n  }\r\n\r\n  cut(pens?: Pen[]) {\r\n    this.copy(pens, false);\r\n    this.delete(pens);\r\n\r\n    this.store.emitter.emit('cut', pens);\r\n  }\r\n\r\n  async paste() {\r\n    let clipboardText: string;\r\n    let clipboard: Meta2dClipboard;\r\n\r\n    if (\r\n      navigator.clipboard &&\r\n      !this.store.options.disableClipboard &&\r\n      !navigator.userAgent.includes('Firefox')\r\n    ) {\r\n      try {\r\n        clipboardText = await navigator.clipboard?.readText();\r\n      } catch {\r\n        clipboardText = localStorage.getItem(this.clipboardName);\r\n      }\r\n    } else {\r\n      clipboardText = localStorage.getItem(this.clipboardName);\r\n    }\r\n    if (clipboardText) {\r\n      try {\r\n        clipboard = JSON.parse(clipboardText);\r\n      } catch (e) {\r\n        console.warn('剪切板数据不是json', e.message);\r\n        return;\r\n      }\r\n      if (!clipboard || !clipboard.meta2d) {\r\n        return;\r\n      }\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      this.beforeAddPens &&\r\n      (await this.beforeAddPens(clipboard.pens)) != true\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let offset: any;\r\n    let pos: any;\r\n    if (this.store.clipboard) {\r\n      offset = this.store.clipboard.offset + 10;\r\n      pos = this.store.clipboard.pos;\r\n    }\r\n    this.store.clipboard = deepClone(clipboard);\r\n\r\n    const curPage = sessionStorage.getItem('page');\r\n    if (curPage !== clipboard.page) {\r\n      this.store.clipboard.pos = { x: this.mousePos.x, y: this.mousePos.y };\r\n      this.store.clipboard.offset = 0;\r\n    } else if (!this.pasteOffset) {\r\n      this.store.clipboard.offset = 0;\r\n      this.pasteOffset = true;\r\n    } else {\r\n      offset && (this.store.clipboard.offset = offset);\r\n      pos && (this.store.clipboard.pos = pos);\r\n    }\r\n\r\n    const rootPens = this.store.clipboard.pens.filter((pen) => !pen.parentId);\r\n    for (const pen of rootPens) {\r\n      this.pastePen(pen, undefined);\r\n    }\r\n    sessionStorage.setItem('page', clipboard.page);\r\n    this.active(rootPens);\r\n    this.pushHistory({ type: EditType.Add, pens: this.store.clipboard.pens });\r\n    this.render();\r\n    this.store.emitter.emit('add', this.store.clipboard.pens);\r\n    this.store.emitter.emit('paste', this.store.clipboard.pens);\r\n  }\r\n\r\n  /**\r\n   * 获取 pens 列表中的所有节点（包含子节点）\r\n   * @param pens 不包含子节点\r\n   */\r\n  getAllByPens(pens: Pen[]): Pen[] {\r\n    const retPens: Pen[] = [];\r\n    for (const pen of pens) {\r\n      retPens.push(...deepClone(getAllChildren(pen, this.store), true));\r\n    }\r\n    return retPens.concat(pens);\r\n  }\r\n\r\n  getAllFollowersByPens(pens: Pen[], deep:boolean = true): Pen[] {\r\n    const retPens: Pen[] = pens;\r\n    for (const pen of pens) {\r\n      let followers = getAllFollowers(pen, this.store);\r\n      if(deep){\r\n        followers = deepClone(followers,true);\r\n      }\r\n      for(const follower of followers){\r\n        if(!retPens.find(p=>p.id === follower.id)){\r\n          retPens.push(follower);\r\n        }\r\n      }\r\n    }\r\n    return retPens\r\n  }\r\n\r\n  setFollowers(pens: Pen[] = this.store.active){\r\n    if (!pens) {\r\n      return;\r\n    }\r\n    if(pens.length < 2){\r\n      pens[0].followers = [];\r\n    }else{\r\n      //以最后一个\r\n      let ids = pens.map((pen)=>pen.id);\r\n      ids.pop();\r\n      const lastPen = pens[pens.length-1];\r\n      if(!lastPen.followers){\r\n        lastPen.followers = ids;\r\n      }else{\r\n        ids.forEach((id)=>{\r\n          if(!lastPen.followers.includes(id)){\r\n            lastPen.followers.push(id);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n\r\n  /**\r\n   *\r\n   * @param pen 当前复制的画笔\r\n   * @param parentId 父节点 id\r\n   * @param clipboard 本次复制的全部画笔，包含子节点, 以及 origin 和 scale\r\n   * @returns 复制后的画笔\r\n   */\r\n  private pastePen = (pen: Pen, parentId?: string) => {\r\n    const oldId = pen.id;\r\n    randomId(pen);\r\n    pen.parentId = parentId;\r\n\r\n    if (pen.type === PenType.Line) {\r\n      this.changeNodeConnectedLine(oldId, pen, this.store.clipboard.pens);\r\n    } else {\r\n      this.changeLineAnchors(oldId, pen, this.store.clipboard.pens);\r\n    }\r\n\r\n    if (!pen.parentId) {\r\n      const rect = this.getPenRect(\r\n        pen,\r\n        this.store.clipboard.origin,\r\n        this.store.clipboard.scale\r\n      );\r\n\r\n      const initRect: Rect = this.getPenRect(\r\n        this.store.clipboard.initRect,\r\n        this.store.clipboard.origin,\r\n        this.store.clipboard.scale\r\n      );\r\n\r\n      const { origin, scale } = this.store.data;\r\n      pen.x = origin.x + rect.x * scale;\r\n      pen.y = origin.y + rect.y * scale;\r\n      pen.width = rect.width * scale;\r\n      pen.height = rect.height * scale;\r\n\r\n      initRect.x = origin.x + initRect.x * scale;\r\n      initRect.y = origin.y + initRect.y * scale;\r\n      calcCenter(initRect);\r\n\r\n      if (this.store.clipboard.pos) {\r\n        pen.x -= initRect.center.x - this.store.clipboard.pos.x;\r\n        pen.y -= initRect.center.y - this.store.clipboard.pos.y;\r\n      }\r\n      if(this.keyOptions && this.keyOptions.altKey && (this.keyOptions.ctrlKey || this.keyOptions.metaKey)){\r\n        pen.x =-this.store.data.x+ this.width / 2 - pen.width / 2;\r\n        pen.y =-this.store.data.y+ this.height / 2 - pen.height / 2;\r\n      }else if(this.keyOptions && this.keyOptions.shiftKey && (this.keyOptions.ctrlKey || this.keyOptions.metaKey)){\r\n\r\n      }else{\r\n        pen.x += this.store.clipboard.offset * this.store.data.scale;\r\n        pen.y += this.store.clipboard.offset * this.store.data.scale;\r\n      }\r\n    }\r\n    this.makePen(pen);\r\n    const newChildren = [];\r\n    if (Array.isArray(pen.children)) {\r\n      for (const childId of pen.children) {\r\n        const childPen = this.store.clipboard.pens.find(\r\n          (pen) => pen.id === childId\r\n        );\r\n        childPen && newChildren.push(this.pastePen(childPen, pen.id).id);\r\n      }\r\n    }\r\n    pen.children = newChildren;\r\n    calcInView(pen,true);\r\n    return pen;\r\n  };\r\n  /**\r\n   * 修改对应连线的 anchors\r\n   * @param oldId 老 id\r\n   * @param pen 节点\r\n   * @param pastePens 本次复制的 pens 包含子节点\r\n   */\r\n  changeLineAnchors(oldId: string, pen: Pen, pastePens: Pen[]) {\r\n    if (!Array.isArray(pen.connectedLines)) {\r\n      return;\r\n    }\r\n    for (let index = 0; index < pen.connectedLines.length; index++) {\r\n      const { lineId } = pen.connectedLines[index];\r\n      const line = pastePens.find((pen) => pen.id === lineId);\r\n      if (line) {\r\n        const from = line.anchors[0];\r\n        const to = line.anchors[line.anchors.length - 1];\r\n        from.connectTo === oldId && (from.connectTo = pen.id);\r\n        to.connectTo === oldId && (to.connectTo = pen.id);\r\n      } else {\r\n        // 说明它的连接线不在本次复制的范围内\r\n        pen.connectedLines.splice(index, 1);\r\n        index--;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 复制连线的过程，修改 与 此线连接 node 的 connectedLines\r\n   * @param oldId 线原 id\r\n   * @param line 线\r\n   * @param pastePens 此处复制的全部 pens (包含子节点)\r\n   */\r\n  changeNodeConnectedLine(oldId: string, line: Pen, pastePens: Pen[]) {\r\n    const from = line.anchors[0];\r\n    const to = line.anchors[line.anchors.length - 1];\r\n    // 修改对应节点的 connectedLines\r\n    const anchors = [from, to];\r\n    for (const anchor of anchors) {\r\n      const nodeId = anchor.connectTo;\r\n      if (nodeId) {\r\n        const node = pastePens.find((pen) => pen.id === nodeId);\r\n        if (node) {\r\n          node.connectedLines?.forEach((cl) => {\r\n            if (cl.lineId === oldId) {\r\n              cl.lineId = line.id;\r\n              cl.lineAnchor = anchor.id;\r\n            }\r\n          });\r\n        } else {\r\n          // 节点不在本次复制的范围内\r\n          anchor.connectTo = undefined;\r\n          if (anchor.prev) {\r\n            anchor.prev.connectTo = undefined;\r\n          }\r\n          if (anchor.next) {\r\n            anchor.next.connectTo = undefined;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async delete(pens = this.store.active, canDelLocked = false, history = true) {\r\n    if (!pens || !pens.length) {\r\n      return;\r\n    }\r\n    if (this.beforeRemovePens && (await this.beforeRemovePens(pens)) != true) {\r\n      return;\r\n    }\r\n    if (!canDelLocked) {\r\n      pens = pens.filter((pen) => !pen.locked);\r\n    }\r\n    if (!pens || !pens.length) {\r\n      return;\r\n    }\r\n    const deletePens: Pen[] = [];\r\n    this._del(pens, deletePens, canDelLocked);\r\n    this.initImageCanvas(deletePens);\r\n    this.initTemplateCanvas(deletePens);\r\n    this.inactive();\r\n    this.clearHover();\r\n    this.render();\r\n    // TODO: 连线的删除 ，连接的 node 的 connectLines 会变化（删除 node ，line 的 anchors 类似），未记历史记录\r\n    if (history) {\r\n      if(deletePens.length === 0)return;\r\n      this.pushHistory({ type: EditType.Delete, pens: deletePens });\r\n    }\r\n    this.store.emitter.emit('delete', pens);\r\n  }\r\n\r\n  private _del(pens: Pen[], delPens?: Pen[], canDelLocked?: boolean) {\r\n    if (!pens) {\r\n      return;\r\n    }\r\n    pens.forEach((pen) => {\r\n      if (pen.type) {\r\n        pen.lastConnected = {};\r\n      }\r\n      if (!pen.parentId) {\r\n        if (!canDelLocked && pen.locked) {\r\n          return;\r\n        } else {\r\n          if (delPens) {\r\n            this.getDelPens(pen, delPens);\r\n          }\r\n          this.delForce(pen);\r\n        }\r\n      } else {\r\n        const lockedParent = this.getLockedParent(pen);\r\n        if (lockedParent) {\r\n          console.warn('父节点锁定');\r\n          return;\r\n        } else {\r\n          const parentPen = getParent(pen);\r\n          const _index = parentPen.children.indexOf(pen.id);\r\n          parentPen.children.splice(_index, 1);\r\n          if (delPens) {\r\n            this.getDelPens(pen, delPens);\r\n          }\r\n          this.delForce(pen);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  getDelPens(pen: Pen, delPens: Pen[]) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    const i = this.store.data.pens.findIndex((item) => item.id === pen.id);\r\n    if (i > -1) {\r\n      const delPen = this.store.pens[pen.id];\r\n      delPen.calculative.active = undefined;\r\n      delPens.push(delPen);\r\n    }\r\n    if (pen.children) {\r\n      pen.children.forEach((id) => {\r\n        this.getDelPens(this.store.pens[id], delPens);\r\n      });\r\n    }\r\n  }\r\n\r\n  private getLockedParent(pen: Pen) {\r\n    if (!pen.parentId) {\r\n      return false;\r\n    }\r\n    const parentPen = getParent(pen);\r\n    if (parentPen.locked) {\r\n      return parentPen;\r\n    } else {\r\n      this.getLockedParent(parentPen);\r\n    }\r\n  }\r\n\r\n  delForce(pen: Pen) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    const i = this.store.data.pens.findIndex((item) => item.id === pen.id);\r\n    if (i > -1) {\r\n      this.delConnectedLines(this.store.data.pens[i]);\r\n      this.store.data.pens.splice(i, 1);\r\n      this.store.pens[pen.id] = undefined;\r\n      delete this.store.pens[pen.id];\r\n      // 删除svgpath的数据\r\n      if(pen.pathId){\r\n        delete this.store.data.paths[pen.pathId];\r\n      }\r\n    }\r\n    this.store.animates.delete(pen);\r\n    this.store.animateMap.delete(pen);\r\n    if (pen.children) {\r\n      pen.children.forEach((id) => {\r\n        this.delForce(this.store.pens[id]);\r\n      });\r\n    }\r\n\r\n    pen.onDestroy?.(pen);\r\n  }\r\n\r\n  private delConnectedLines(pen: Pen) {\r\n    if (pen.connectedLines) {\r\n      for (let i = 0; i < pen.connectedLines.length; i++) {\r\n        const { lineId, lineAnchor } = pen.connectedLines[i];\r\n        const line = this.store.pens[lineId];\r\n        if (line) {\r\n          let anchor = line.anchors.find((anchor) => anchor.id === lineAnchor);\r\n          if (anchor?.connectTo === pen.id) {\r\n            anchor.connectTo = undefined;\r\n            anchor.anchorId = undefined;\r\n            anchor.prev && (anchor.prev.connectTo = undefined);\r\n            anchor.next && (anchor.next.connectTo = undefined);\r\n          }\r\n          anchor = getAnchor(line, lineAnchor);\r\n          if (anchor) {\r\n            anchor.connectTo = undefined;\r\n            anchor.anchorId = undefined;\r\n            anchor.prev && (anchor.prev.connectTo = undefined);\r\n            anchor.next && (anchor.next.connectTo = undefined);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!pen.type) {\r\n      return;\r\n    }\r\n\r\n    pen.calculative.worldAnchors?.forEach((lineAnchor, index) => {\r\n      if (!lineAnchor.connectTo) {\r\n        return;\r\n      }\r\n      const connectTo = this.store.pens[lineAnchor.connectTo];\r\n      if (connectTo) {\r\n        connectTo.calculative.worldAnchors?.forEach((anchor) => {\r\n          disconnectLine(connectTo, anchor, pen, lineAnchor);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private ondblclick = (e: MouseEvent) => {\r\n    if (\r\n      this.store.hover &&\r\n      (!this.store.data.locked || this.store.hover.dbInput) &&\r\n      !this.store.options.disableInput\r\n    ) {\r\n      if (this.store.hover.onShowInput) {\r\n        this.store.hover.onShowInput(this.store.hover, e as any);\r\n      } else {\r\n        if(this.store.hover && this.store.hover.parentId){\r\n          if(this.store.active?.length===1 && this.store.active[0].id === this.store.hover.id){\r\n            this.showInput(this.store.hover);\r\n          }else{\r\n            this.store.pens[this.store.hover.parentId].children.forEach((id)=>{\r\n              this.store.pens[id].calculative.active = false;\r\n              this.store.pens[id].calculative.hover = false;\r\n            });\r\n            this.active([this.store.hover]);\r\n          }\r\n        }else{\r\n          this.showInput(this.store.hover);\r\n        }\r\n      }\r\n    }\r\n    this.store.emitter.emit('dblclick', {\r\n      x: e.x,\r\n      y: e.y,\r\n      pen: this.store.hover,\r\n    });\r\n  };\r\n\r\n  showInput = (pen: Pen, rect?: Rect, background = 'transparent') => {\r\n    if (\r\n      !window ||\r\n      !this.store.hover ||\r\n      this.store.hover.locked ||\r\n      this.store.hover.externElement ||\r\n      this.store.hover.disableInput ||\r\n      this.store.hover.disabled\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (this.inputDiv.dataset.penId === pen.id) {\r\n      this.inputDiv.dataset.isInput = 'true';\r\n      this.inputDiv.contentEditable = 'true';\r\n      this.inputDiv.focus();\r\n      const range = window.getSelection(); //创建range\r\n      range.selectAllChildren(this.inputDiv); //range 选择obj下所有子内容\r\n      range.collapseToEnd(); //光标移至最后\r\n      this.inputDiv.scrollTop = this.inputDiv.scrollHeight;\r\n      this.inputDiv.scrollLeft = this.inputDiv.scrollWidth;\r\n\r\n      return;\r\n    }\r\n    //过滤table2图元\r\n    if (!rect && !pen.dbInput) {\r\n      this.setInputStyle(pen);\r\n    } else {\r\n      this.inputDiv.style.width = '100%';\r\n      this.inputDiv.style.height = '100%';\r\n    }\r\n    const textRect = rect || pen.calculative.worldTextRect;\r\n\r\n    //value和innerText问题\r\n    const preInputText = pen.calculative.tempText === undefined? (pen.text + '' || '') : pen.calculative.tempText;\r\n    const textArr = preInputText.replace(/\\x20/g, '&nbsp;').split(/[\\s\\n]/);\r\n    const finalText = `${textArr.join('</div><div>')}</div>`\r\n      .replace('</div>', '')\r\n      .replace(/\\<div\\>\\<\\/div\\>/g, '<div><br></div>');\r\n    this.inputDiv.innerHTML = finalText;\r\n    // this.inputDiv.style.fontSize = pen.calculative.fontSize + 'px';\r\n    // this.inputDiv.style.color = getTextColor(pen, this.store);\r\n    this.inputParent.style.left =\r\n      textRect.x + this.store.data.x - (pen.textLeft || 0) + 'px'; //+ 5\r\n    this.inputParent.style.top =\r\n      textRect.y + this.store.data.y - (pen.textTop || 0) + 'px'; //+ 5\r\n    let _width = textRect.width ;//+ (pen.textLeft || 0);\r\n    this.inputParent.style.width = (_width < 0 ? 12 : _width) + 'px'; //(textRect.width < pen.width ? 0 : 10)\r\n    this.inputParent.style.height = textRect.height + (pen.textTop || 0) + 'px'; //   (textRect.height < pen.height ? 0 : 10)\r\n    this.inputParent.style.zIndex = '9999';\r\n    this.inputParent.style.background = background;\r\n    if (pen.rotate % 360) {\r\n      this.inputParent.style.transform = `rotate(${pen.rotate}deg)`;\r\n    } else {\r\n      this.inputParent.style.transform = null;\r\n    }\r\n    this.inputParent.style.display = 'flex';\r\n    this.inputDiv.dataset.penId = pen.id;\r\n    this.inputDiv.contentEditable =\r\n      pen.disableInput == undefined ? 'true' : pen.disableInput.toString();\r\n\r\n    if (pen.dropdownList && this.dropdown.style.display !== 'block') {\r\n      // if (!this.store.data.locked) {\r\n      //   this.inputRight.style.display = 'none';\r\n      // }\r\n      this.dropdown.style.background = pen.dropdownBackground || '#fff';\r\n      this.dropdown.style.color = pen.dropdownColor || '#bdc7db';\r\n      this.setDropdownList();\r\n    } else {\r\n      // this.inputRight.style.display = 'none';\r\n    }\r\n    this.inputDiv.contentEditable = 'true';\r\n    this.inputDiv.focus();\r\n    const range = window.getSelection(); //创建range\r\n    range.selectAllChildren(this.inputDiv); //range 选择obj下所有子内容\r\n    range.collapseToEnd(); //光标移至最后\r\n    this.inputDiv.scrollTop = this.inputDiv.scrollHeight;\r\n    this.inputDiv.scrollLeft = this.inputDiv.scrollWidth;\r\n    pen.calculative.text = undefined;\r\n    this.initTemplateCanvas([pen]);\r\n    this.render();\r\n  };\r\n\r\n  setInputStyle = (pen: Pen) => {\r\n    if (!pen.text) {\r\n      pen.text = '';\r\n    }\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n    let style = 'overflow: scroll;';\r\n    let div_style = '';\r\n    let font_scale = 1;\r\n    const { scale } = this.store.data;\r\n    if (pen.fontSize < 12) {\r\n      font_scale = 12 / pen.fontSize;\r\n    }\r\n    if (pen.textAlign) {\r\n      style += `text-align: ${pen.textAlign};`;\r\n    } else {\r\n      style += 'text-align: center;';\r\n    }\r\n    if (pen.textAlign && pen.whiteSpace === 'pre-line') {\r\n      let textAlign = {\r\n        left: 'start',\r\n        center: 'center',\r\n        right: 'end',\r\n      };\r\n      style += `align-items: ${textAlign[pen.textAlign]};`;\r\n    }\r\n\r\n    if (pen.textBaseline) {\r\n      let baseLine = {\r\n        top: 'start',\r\n        middle: 'center',\r\n        bottom: 'end',\r\n      };\r\n      style += `justify-content: ${baseLine[pen.textBaseline]};`;\r\n    } else {\r\n      // if (pen.textWidth < pen.calculative.) {\r\n      //   style += 'justify-content: start;';\r\n      // } else {\r\n      //文字高度超出整个rect高度时\r\n      style += 'justify-content: center;';\r\n      // }\r\n    }\r\n    if (pen.fontFamily) {\r\n      style += `font-family: ${pen.fontFamily};`;\r\n    }\r\n    if (pen.fontSize) {\r\n      if (pen.fontSize * scale < 12) {\r\n        style += `font-size:${pen.fontSize}px;`;\r\n        style += `zoom:${(pen.fontSize / 12) * scale};`;\r\n      } else {\r\n        style += `font-size:${pen.fontSize * scale}px;`;\r\n      }\r\n    }\r\n    style += `color:${getTextColor(pen, this.store)};`;\r\n    if (pen.fontStyle) {\r\n      style += `font-style: ${pen.fontStyle};`;\r\n    }\r\n    if (pen.fontWeight) {\r\n      style += `font-weight: ${pen.fontWeight};`;\r\n    }\r\n    if (pen.textLeft) {\r\n      style += `margin-left:${\r\n        scale > 1\r\n          ? pen.textLeft * font_scale\r\n          : (pen.textLeft * font_scale) / scale\r\n      }px;`;\r\n    }\r\n    if (pen.textTop) {\r\n      style += `margin-top:${\r\n        scale > 1\r\n          ? pen.textTop * font_scale\r\n          : (pen.textTop * font_scale) / scale\r\n      }px;`;\r\n    }\r\n    if (pen.lineHeight) {\r\n      style += `line-height:${\r\n        scale > 1\r\n          ? pen.fontSize * pen.lineHeight * scale\r\n          : pen.fontSize * pen.lineHeight * font_scale\r\n      }px;`;\r\n    }\r\n    if (pen.textHeight) {\r\n      style += `height:${\r\n        scale > 1\r\n          ? pen.textHeight * font_scale * scale\r\n          : pen.textHeight * font_scale\r\n      }px;`;\r\n    } else {\r\n      let tem = pen.calculative.worldRect.height / scale;\r\n      if (tem < 0) {\r\n        tem = 0;\r\n      }\r\n      let height =\r\n        pen.fontSize * scale < 12 ? tem * font_scale : tem * scale * font_scale;\r\n      if (height < pen.fontSize * pen.lineHeight * scale) {\r\n        height = pen.fontSize * pen.lineHeight * scale;\r\n        style += `top:-${height / 2}px;`;\r\n      }\r\n      style += `height:${height}px;`;\r\n    }\r\n\r\n    let _textWidth = null;\r\n    if (pen.textWidth) {\r\n      _textWidth =\r\n        pen.textWidth < 1 && pen.textWidth > -1\r\n          ? pen.textWidth * pen.calculative.worldRect.width\r\n          : pen.textWidth;\r\n      if (pen.whiteSpace !== 'pre-line') {\r\n        if (_textWidth < pen.fontSize) {\r\n          style += `width:${pen.fontSize * 1.2 * font_scale}px;`;\r\n        } else {\r\n          style += `width:${\r\n            scale > 1\r\n              ? _textWidth * font_scale * scale\r\n              : _textWidth * font_scale\r\n          }px;`;\r\n        }\r\n      }\r\n    } else {\r\n      if (pen.whiteSpace === undefined || pen.whiteSpace === 'break-all') {\r\n        let tem = (pen.calculative.worldTextRect.width || 12) / scale; //pen.width / scale - ( pen.textLeft || 0);\r\n        if (tem < 0) {\r\n          tem = 0;\r\n        }\r\n        style += `width:${\r\n          pen.fontSize * scale < 12 ? tem * font_scale : tem * scale\r\n        }px;`;\r\n      }\r\n      // if (pen.whiteSpace === 'pre-line') {\r\n      //   //回车换行\r\n      //   style += `overflow: visible;`;\r\n      // }\r\n    }\r\n    if (pen.whiteSpace) {\r\n      if (pen.whiteSpace === 'pre-line') {\r\n        style += `white-space:pre;`;\r\n        // if (!pen.textAlign) {\r\n        //   style += `align-items: center;`;\r\n        // }\r\n      } else {\r\n        style += `white-space:${pen.whiteSpace};`;\r\n        if (pen.whiteSpace === 'nowrap') {\r\n          div_style += 'display:contents;';\r\n        }\r\n      }\r\n    }\r\n    if (pen.whiteSpace !== 'nowrap') {\r\n      let textWidth = pen.fontSize * 1.2 * pen.text.length;\r\n      let contentWidth =\r\n        (_textWidth || pen.calculative.worldRect.width / scale) *\r\n        Math.floor(\r\n          pen.calculative.worldRect.height /\r\n            scale /\r\n            (pen.lineHeight * pen.fontSize)\r\n        );\r\n      if (textWidth > contentWidth) {\r\n        style += 'justify-content: start;';\r\n      }\r\n    }\r\n    sheet.deleteRule(0);\r\n    sheet.deleteRule(0);\r\n    sheet.insertRule(\r\n      `.meta2d-input\r\n      .input-div{\r\n        resize:none;border:none;outline:none;background:transparent;position:absolute;flex-grow:1;height:100%;width: 100%;position:absolute;left:0;top:0;display:flex;flex-direction: column;cursor: text;${style}}`\r\n    );\r\n    sheet.insertRule(`.input-div div{${div_style}}`);\r\n\r\n    // sheet.insertRule(`.meta2d-input .input-div-font{${style_font}}`);\r\n  };\r\n\r\n  convertSpecialCharacter(str) {\r\n    var arrEntities = { lt: '<', gt: '>', nbsp: ' ', amp: '&', quot: '\"' };\r\n    return str.replace(/&(lt|gt|nbsp|amp|quot);/gi, function (all, t) {\r\n      return arrEntities[t];\r\n    });\r\n  }\r\n\r\n  hideInput = () => {\r\n    if (this.inputParent.style.display === 'flex') {\r\n      this.inputParent.style.display = 'none';\r\n      const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n      if (!pen) {\r\n        return;\r\n      }\r\n      pen.calculative.text = pen.text;\r\n      this.inputDiv.dataset.value = this.inputDiv.innerHTML\r\n        .replace(/\\<div\\>/g, '\\n')\r\n        .replace(/\\<\\/div\\>/g, '')\r\n        .replace(/\\<br\\>/g, '')\r\n        .replace(/&nbsp;/g, ' ')\r\n        .replace(/(<([^>]+)>)/gi, '');\r\n      this.inputDiv.dataset.value = this.convertSpecialCharacter(\r\n        this.inputDiv.dataset.value\r\n      );\r\n      if (pen.onInput) {\r\n        pen.onInput(pen, this.inputDiv.dataset.value);\r\n      } else if (pen.text !== this.inputDiv.dataset.value) {\r\n        const initPens = [deepClone(pen, true)];\r\n        pen.text = this.inputDiv.dataset.value;\r\n        pen.calculative.text = pen.text;\r\n        this.inputDiv.dataset.penId = undefined;\r\n        if (pen.text && pen.textAutoAdjust) {\r\n          calcTextAutoWidth(pen);\r\n        }\r\n        calcTextRect(pen);\r\n        this.patchFlags = true;\r\n        this.pushHistory({\r\n          type: EditType.Update,\r\n          pens: [deepClone(pen, true)],\r\n          initPens,\r\n        });\r\n        this.store.emitter.emit('change', pen);\r\n        this.store.emitter.emit('valueUpdate', pen);\r\n      } else if(pen.text === this.inputDiv.dataset.value && pen.calculative.textLines.length == 0) {\r\n        calcTextRect(pen);\r\n      }\r\n      this.initTemplateCanvas([pen]);\r\n    }\r\n    this.inputDiv.dataset.penId = undefined;\r\n    this.dropdown.style.display = 'none';\r\n    this.inputDiv.dataset.isInput = 'false';\r\n    this.inputDiv.contentEditable = 'false';\r\n    this.render();\r\n  };\r\n\r\n  private createInput() {\r\n    this.inputParent.classList.add('meta2d-input');\r\n    // this.inputRight.classList.add('right');\r\n    this.inputDiv.classList.add('input-div');\r\n    this.inputParent.appendChild(this.inputDiv);\r\n    // this.inputParent.appendChild(this.inputRight);\r\n    this.dropdown.onmouseleave = () => {\r\n      this.store.hover = null;\r\n    };\r\n    this.inputParent.appendChild(this.dropdown);\r\n    this.externalElements.appendChild(this.inputParent);\r\n    this.inputParent.onmousedown = this.stopPropagation;\r\n    this.inputDiv.onmousedown = this.stopPropagation;\r\n    this.inputDiv.contentEditable = 'false';\r\n    // this.inputRight.onmousedown = this.stopPropagation;\r\n    this.dropdown.onmousedown = this.stopPropagation;\r\n    // this.inputRight.style.transform = 'rotate(135deg)';\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n    if (!sheet) {\r\n      const style = document.createElement('style');\r\n      style.title = 'le5le.com';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        '.meta2d-input{display:none;position:absolute;outline:none;align-items: center;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-input textarea{resize:none;border:none;outline:none;background:transparent;flex-grow:1;height:100%;left:0;top:0}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-input .right{width:10px;height:10px;flex-shrink:0;border-top: 1px solid;border-right: 1px solid;margin-right: 5px;transition: all .3s cubic-bezier(.645,.045,.355,1);position:absolute;right:1px;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-input ul{position:absolute;top:100%;left:-5px;width:calc(100% + 10px);min-height:30px;border-radius: 2px;box-shadow: 0 2px 8px #00000026;list-style-type: none;background-color: #fff;padding: 4px 0;max-height: 105px;overflow-y: auto;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-input ul li{padding: 5px 12px;line-height: 22px;white-space: nowrap;cursor: pointer;}'\r\n      );\r\n      sheet.insertRule('.meta2d-input ul li:hover{background: #eeeeee;}');\r\n      sheet.insertRule(`.input-div::-webkit-scrollbar {display:none}`);\r\n      sheet.insertRule(`.input-div{scrollbar-width: none;}`);\r\n      sheet.insertRule(\r\n        '.meta2d-input .input-div{resize:none;border:none;outline:none;background:transparent;flex-grow:1;height:100%;width: 100%;left:0;top:0;display:flex;text-align: center;justify-content: center;flex-direction: column;}'\r\n      );\r\n      sheet.insertRule(`.input-div div{}`);\r\n    }\r\n    this.inputDiv.onfocus = (e: any) => {\r\n      if (navigator.userAgent.includes('Firefox')) {\r\n        if (!e.target.innerText) {\r\n          let left = this.inputDiv.offsetWidth / 2;\r\n          let inputDivStyle = window.getComputedStyle(this.inputDiv, null);\r\n          if (inputDivStyle.textAlign !== 'center') {\r\n            left = 0;\r\n          }\r\n          this.inputDiv.innerHTML = `<br style=\"margin-left:${left}px;margin-top:4px;\" />`;\r\n        }\r\n      } else {\r\n        //无文本时，光标确保居中\r\n        if (!e.target.innerText) {\r\n          let inputDivStyle = window.getComputedStyle(this.inputDiv, null);\r\n          if (inputDivStyle.justifyContent === 'center') {\r\n            this.inputDiv.style.paddingTop = ` ${\r\n              this.inputDiv.offsetHeight / 2 -\r\n              parseFloat(inputDivStyle.lineHeight) / 2\r\n            }px`;\r\n          }\r\n        } else {\r\n          this.inputDiv.style.paddingTop = '';\r\n        }\r\n      }\r\n    };\r\n    this.inputDiv.onblur = ()=>{\r\n      setTimeout(()=> {\r\n        this.hideInput()\r\n      },300)\r\n    }\r\n    this.inputDiv.oninput = (e: any) => {\r\n      const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n      if(pen && pen.inputType === 'number'){\r\n        const value = e.target.innerText;\r\n        const numericValue = value.replace(/[^0-9]/g, ''); // 移除非数字字符\r\n        // 如果输入的值不是纯数字，则替换为纯数字\r\n        if (value !== numericValue) {\r\n            e.preventDefault();\r\n            e.target.innerText = numericValue;\r\n        } \r\n      }\r\n      // //无文本时，光标确保居中\r\n      if (navigator.userAgent.includes('Firefox')) {\r\n        if (!e.target.innerText.trim()) {\r\n          let left = this.inputDiv.offsetWidth / 2;\r\n          let inputDivStyle = window.getComputedStyle(this.inputDiv, null);\r\n          if (inputDivStyle.textAlign !== 'center') {\r\n            left = 0;\r\n          }\r\n          this.inputDiv.innerHTML = `<br style=\"margin-left:${left}px;margin-top:4px;\" />`;\r\n        }\r\n      } else {\r\n        if (!e.target.innerText) {\r\n          let inputDivStyle = window.getComputedStyle(this.inputDiv, null);\r\n          if (inputDivStyle.justifyContent === 'center') {\r\n            this.inputDiv.style.paddingTop = ` ${\r\n              this.inputDiv.offsetHeight / 2 -\r\n              parseFloat(inputDivStyle.lineHeight) / 2\r\n            }px`;\r\n          }\r\n        } else {\r\n          this.inputDiv.style.paddingTop = '';\r\n        }\r\n      }\r\n      this.store.emitter.emit('input',pen);\r\n    };\r\n    this.inputDiv.onclick = (e) => {\r\n      e.stopPropagation();\r\n      const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n      if (this.dropdown.style.display === 'block') {\r\n        this.dropdown.style.display = 'none';\r\n        // this.inputRight.style.transform = 'rotate(135deg)';\r\n      } else if (pen?.dropdownList && this.store.data.locked) {\r\n        this.dropdown.style.display = 'block';\r\n        // this.inputRight.style.transform = 'rotate(315deg)';\r\n      }\r\n      this.store.emitter.emit('clickInput', pen);\r\n    };\r\n    this.inputDiv.onkeyup = (e: KeyboardEvent) => {\r\n      this.setDropdownList(true);\r\n      const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n      this.store.emitter.emit('input', { pen, text: e.key });\r\n      e.stopPropagation();\r\n    };\r\n    this.inputDiv.onkeydown = (e: KeyboardEvent) => {\r\n      e.stopPropagation();\r\n    };\r\n    this.inputDiv.onmousedown = this.stopPropagation;\r\n    this.inputDiv.onwheel = (e) => {\r\n      e.stopPropagation();\r\n    };\r\n    this.inputDiv.onpaste = (e) => {\r\n      e.preventDefault();\r\n      let text = '';\r\n      if (e.clipboardData && e.clipboardData.getData) {\r\n        text = e.clipboardData.getData('text/plain');\r\n      }\r\n      document.execCommand('insertHTML', false, text);\r\n    };\r\n  }\r\n\r\n  clearDropdownList() {\r\n    if (this.dropdown.hasChildNodes()) {\r\n      for (let i = 0; i < this.dropdown.childNodes.length; i++) {\r\n        this.dropdown.childNodes[i].remove();\r\n        --i;\r\n      }\r\n    }\r\n  }\r\n\r\n  private setDropdownList = (search?: boolean) => {\r\n    this.clearDropdownList();\r\n    const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n    if (!this.store.data.locked&&!['tablePlus'].includes(pen.name)) {\r\n      return;\r\n    }\r\n    this.dropdown.style.display = 'block';\r\n    // this.inputRight.style.display = 'block';\r\n    // setTimeout(() => {\r\n    //   this.inputRight.style.transform = 'rotate(315deg)';\r\n    //   (this.inputRight.style as any).zoom = this.store.data.scale;\r\n    // });\r\n    if (!pen || !pen.dropdownList) {\r\n      this.dropdown.style.display = 'none';\r\n      // this.inputRight.style.display = 'none';\r\n      // this.inputRight.style.transform = 'rotate(135deg)';\r\n      return;\r\n    }\r\n    if (!pen.dropdownList.length) {\r\n      const none = document.createElement('div');\r\n      none.innerText = 'None';\r\n      none.style.padding = '5px 12px';\r\n      none.style.color = '#ddd';\r\n      this.dropdown.appendChild(none);\r\n      return;\r\n    }\r\n    const text = this.inputDiv.innerHTML\r\n      .replace(/\\<div\\>/g, '\\n')\r\n      .replace(/\\<\\/div\\>/g, '')\r\n      .replace(/\\<br\\>/g, '');\r\n    let i = 0;\r\n    for (const item of pen.dropdownList) {\r\n      const t = typeof item === 'string' ? item : item.text;\r\n      if (search && text) {\r\n        if (t.includes(text)) {\r\n          // 过滤\r\n          this.dropdownAppendOption(t, i);\r\n        }\r\n      } else {\r\n        this.dropdownAppendOption(t, i);\r\n      }\r\n      ++i;\r\n    }\r\n\r\n    if (!this.dropdown.hasChildNodes()) {\r\n      const none = document.createElement('div');\r\n      none.innerText = 'None';\r\n      none.style.padding = '5px 12px';\r\n      none.style.color = '#ddd';\r\n      this.dropdown.appendChild(none);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 添加一个选项到 dropdown dom 中\r\n   * @param text 选项文字\r\n   * @param index 选项索引\r\n   */\r\n  private dropdownAppendOption(text: string, index: number) {\r\n    const li = document.createElement('li');\r\n    li.onwheel = this.stopPropagation;\r\n    li.innerText = text;\r\n    li.style.overflow = 'hidden';\r\n    li.style.textOverflow = 'ellipsis';\r\n    li.title = text;\r\n    (li.style as any).zoom = this.store.data.scale;\r\n    li.onmousedown = this.stopPropagation;\r\n    li.dataset.i = index + '';\r\n    li.onclick = this.selectDropdown;\r\n    const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n    li.onmouseenter = () => {\r\n      li.style.background = pen.dropdownHoverBackground || '#eee';\r\n      li.style.color = pen.dropdownHoverColor || '#bdc7db';\r\n    };\r\n    li.onmouseleave = () => {\r\n      li.style.background = pen.dropdownBackground || '#fff';\r\n      li.style.color = pen.dropdownColor || '#bdc7db';\r\n    };\r\n    this.dropdown.appendChild(li);\r\n  }\r\n\r\n  private selectDropdown = (e: MouseEvent) => {\r\n    const li = e.target as HTMLElement;\r\n    const pen = this.store.pens[this.inputDiv.dataset.penId];\r\n    if (!li || !pen || !pen.dropdownList) {\r\n      return;\r\n    }\r\n\r\n    const index = +li.dataset.i;\r\n    const dropdown = pen.dropdownList[index];\r\n    if (!dropdown) {\r\n      return;\r\n    }\r\n\r\n    const initPens = [deepClone(pen, true)];\r\n\r\n    if (typeof dropdown === 'object') {\r\n      this.updateValue(pen, { ...dropdown });\r\n      pen.calculative.text = undefined;\r\n      this.calcActiveRect();\r\n    } else {\r\n      pen.text = dropdown + '';\r\n    }\r\n    this.inputDiv.innerText = pen.text;\r\n    // this.dropdown.style.display = 'none';\r\n    // this.inputRight.style.transform = 'rotate(135deg)';\r\n    this.hideInput();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      pens: [deepClone(pen, true)],\r\n      initPens,\r\n    });\r\n    this.render();\r\n    this.store.emitter.emit('change', pen);\r\n    this.store.emitter.emit('valueUpdate', pen);\r\n  };\r\n\r\n  find(idOrTag: string) {\r\n    return this.store.data.pens.filter((pen) => {\r\n      return pen.id == idOrTag || (pen.tags && pen.tags.indexOf(idOrTag) > -1);\r\n    });\r\n  }\r\n\r\n  findOne(idOrTag: string): Pen | undefined {\r\n    return this.store.data.pens.find((pen) => {\r\n      return pen.id == idOrTag || (pen.tags && pen.tags.indexOf(idOrTag) > -1);\r\n    });\r\n  }\r\n\r\n  changePenId(oldId: string, newId: string): void {\r\n    if (oldId === newId) {\r\n      return;\r\n    }\r\n    const pen = this.store.pens[oldId];\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    if (this.store.pens[newId]) {\r\n      return;\r\n    }\r\n    // 若新画笔不存在\r\n    pen.id = newId;\r\n    this.store.pens[newId] = this.store.pens[oldId];\r\n    // dom 节点，需要更改 id\r\n    pen.onChangeId?.(pen, oldId, newId);\r\n    delete this.store.pens[oldId];\r\n    // 父子\r\n    if (pen.parentId) {\r\n      const parent = this.store.pens[pen.parentId];\r\n      const index = parent.children?.findIndex((id) => id === oldId);\r\n      index !== -1 && parent.children?.splice(index, 1, newId);\r\n    }\r\n    pen.children?.forEach((childId) => {\r\n      const child = this.store.pens[childId];\r\n      child.parentId = newId;\r\n    });\r\n    // 连接关系\r\n    if (pen.type === PenType.Line) {\r\n      // TODO: 仍然存在 节点类型的 连线，此处判断需要更改\r\n      this.changeNodeConnectedLine(oldId, pen, this.store.data.pens);\r\n    } else {\r\n      this.changeLineAnchors(oldId, pen, this.store.data.pens);\r\n      pen.connectedLines?.forEach(({ lineId }) => {\r\n        const line = this.store.pens[lineId];\r\n        calcWorldAnchors(line);\r\n      });\r\n    }\r\n    //锚点\r\n    pen.anchors?.forEach((anchor) => anchor.penId = newId);\r\n    pen.calculative.worldAnchors?.forEach((anchor) => anchor.penId = newId);\r\n  }\r\n\r\n  updateValue(pen: Pen, data: IValue): void {\r\n    const penRect = this.getPenRect(pen);\r\n    const oldName = pen.name;\r\n    Object.assign(pen, data);\r\n    // data 可能没有 name 属性\r\n    const isChangedName = oldName !== pen.name; // name changed\r\n    data.newId && this.changePenId(pen.id, data.newId);\r\n    let willUpdatePath = false;\r\n    let willCalcTextRect = false;\r\n    let willPatchFlagsPenRect = false; // 是否需要重新计算世界坐标\r\n    let willCalcIconRect = false; // 是否需要重现计算 icon 区域\r\n    let willSetPenRect = false; // 是否重新 setPenRect\r\n    let containIsBottom = false; // 是否包含 isBottom 属性修改\r\n    let oldRotate: number = undefined;\r\n    let willRenderImage = false; // 是否需要重新渲染图片\r\n    for (const k in data) {\r\n      // 单属性\r\n      if (k.indexOf('.') === -1) {\r\n        if (k === 'rotate') {\r\n          if(pen.disableRotate) { //当图元禁止旋转时不重新设置旋转角度\r\n            pen.rotate = pen.calculative.rotate || 0;\r\n          } else {\r\n            oldRotate = pen.calculative.rotate || 0;\r\n          }\r\n        } else if (k === 'canvasLayer' || k === 'isBottom' || k === 'showChild') {\r\n          containIsBottom = true;\r\n        } else if (k === 'image') {\r\n          willRenderImage = true;\r\n        }\r\n        if (typeof pen[k] !== 'object' || k === 'lineDash') {\r\n          if(!pen.disableRotate || k !== 'rotate'){//当图元禁止旋转时不重新设置旋转角度\r\n            pen.calculative[k] = data[k];\r\n          }\r\n        }\r\n        if (needCalcTextRectProps.includes(k)) {\r\n          willCalcTextRect = true;\r\n        }\r\n        if (['name', 'borderRadius','lineSmooth', 'close'].includes(k)) {\r\n          willUpdatePath = true;\r\n        }\r\n        if (needSetPenProps.includes(k)) {\r\n          willSetPenRect = true;\r\n        }\r\n        if (needPatchFlagsPenRectProps.includes(k)) {\r\n          willPatchFlagsPenRect = true;\r\n        }\r\n        if (needCalcIconRectProps.includes(k)) {\r\n          willCalcIconRect = true;\r\n        }\r\n        if(pen.image && pen.name !== 'gif' && ['globalAlpha', 'flipY', 'flipX', 'x', 'y', 'width', 'height','iconWidth', 'iconHeight', 'imageRatio', 'iconLeft','iconTop', 'iconAlign', 'rotate'].includes(k)){\r\n          willRenderImage = true;\r\n        }\r\n      } else {\r\n        // 复合属性，如abc.def.ghi\r\n        delete pen[k];\r\n        setter(pen, k, data[k]);\r\n      }\r\n      // anchors 或者 anchors.x都去执行\r\n      if (k.split('.')[0] === 'anchors') {\r\n        calcWorldAnchors(pen);\r\n      }\r\n    }\r\n    this.setCalculativeByScale(pen); // 该方法计算量并不大，所以每次修改都计算一次\r\n    if (isChangedName) {\r\n      pen.onDestroy?.(pen);\r\n      clearLifeCycle(pen);\r\n      // 后续代码会重算 path2D\r\n    }\r\n    if (willSetPenRect) {\r\n      const rect: Rect = {\r\n        x: data.x ?? penRect.x,\r\n        y: data.y ?? penRect.y,\r\n        width: data.width ?? penRect.width,\r\n        height: data.height ?? penRect.height,\r\n      };\r\n      this.setPenRect(pen, rect, false);\r\n      this.updateLines(pen, true);\r\n      if (\r\n        this.store.active &&\r\n        this.store.active.length &&\r\n        pen.id === this.store.active[0].id\r\n      ) {\r\n        this.calcActiveRect();\r\n      }\r\n    } else if (willPatchFlagsPenRect) {\r\n      this.updatePenRect(pen);\r\n    } else {\r\n      willCalcTextRect && calcTextRect(pen);\r\n      willCalcIconRect && calcIconRect(this.store.pens, pen);\r\n      if (willUpdatePath) {\r\n        globalStore.path2dDraws[pen.name] &&\r\n          this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n      }\r\n    }\r\n    // 若同时设置 x,y,width,height 与 rotate ，先 setPenRect ，再计算 rotate\r\n    if (oldRotate !== undefined) {\r\n      const currentRotate = pen.calculative.rotate;\r\n      pen.calculative.rotate = oldRotate;\r\n      // TODO: rotatePen 会执行 updatePenRect ，上面已经执行 updatePenRect\r\n      this.rotatePen(pen, currentRotate - oldRotate, pen.calculative.worldRect);\r\n    }\r\n    if (data.image || data.backgroundImage || data.strokeImage) {\r\n      pen.calculative.image = undefined;\r\n      pen.calculative.backgroundImage = undefined;\r\n      pen.calculative.strokeImage = undefined;\r\n      this.loadImage(pen);\r\n    }\r\n    if (data.lineGradientColors) {\r\n      pen.calculative.lineGradient = undefined;\r\n      pen.calculative.gradientColorStop = undefined;\r\n    }\r\n    if (data.gradientColors) {\r\n      pen.calculative.gradient = undefined;\r\n      pen.calculative.radialGradient = undefined;\r\n    }\r\n    if (data.gradientRadius) {\r\n      pen.calculative.gradient = undefined;\r\n      pen.calculative.radialGradient = undefined;\r\n    }\r\n    if (data.animateLineWidth) {\r\n      pen.calculative.gradientAnimatePath = undefined;\r\n    }\r\n    if (data.gradientSmooth) {\r\n      pen.calculative.gradientAnimatePath = undefined;\r\n    }\r\n    if (containIsBottom) {\r\n      this.canvasImage.init();\r\n      this.canvasImageBottom.init();\r\n    } else if (willRenderImage) {\r\n      // 存在先有 image 后无 image 的情况\r\n      // if (pen.isBottom) {\r\n      //   this.canvasImageBottom.init();\r\n      // } else {\r\n      //   this.canvasImage.init();\r\n      // }\r\n      if (pen.canvasLayer === undefined) {\r\n        pen.canvasLayer = CanvasLayer.CanvasImageBottom;\r\n        pen.calculative.canvasLayer = CanvasLayer.CanvasImageBottom;\r\n      }\r\n      if (pen.canvasLayer === CanvasLayer.CanvasImageBottom) {\r\n        this.canvasImageBottom.init();\r\n      } else if (pen.canvasLayer === CanvasLayer.CanvasImage) {\r\n        this.canvasImage.init();\r\n      }\r\n    } \r\n    // else {\r\n    //   this.initImageCanvas([pen]);\r\n    // }\r\n    // if (data.template !== undefined || pen.template) {\r\n    //   this.initTemplateCanvas([pen]);\r\n    // }\r\n    if (\r\n      data.canvasLayer !== undefined ||\r\n      pen.canvasLayer === CanvasLayer.CanvasTemplate\r\n    ) {\r\n      this.initTemplateCanvas([pen]);\r\n    }\r\n    if(data.zIndex !== undefined){\r\n      pen.calculative.singleton?.div &&\r\n      setElemPosition(pen, pen.calculative.singleton.div);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 执行 pen ，以及 pen 的子孙节点的 onResize 生命周期函数\r\n   */\r\n  private execPenResize(pen: Pen) {\r\n    pen.onResize?.(pen);\r\n    pen.children?.forEach((chlidId) => {\r\n      const child = this.store.pens[chlidId];\r\n      child && this.execPenResize(child);\r\n    });\r\n  }\r\n\r\n  setPenRect(pen: Pen, rect: Rect, render = true) {\r\n    if (pen.parentId) {\r\n      // 子节点的 rect 值，一定得是比例值\r\n      Object.assign(pen, rect);\r\n    } else {\r\n      const { origin, scale } = this.store.data;\r\n      pen.x = origin.x + rect.x * scale;\r\n      pen.y = origin.y + rect.y * scale;\r\n      pen.width = rect.width * scale;\r\n      pen.height = rect.height * scale;\r\n    }\r\n    this.updatePenRect(pen);\r\n    this.execPenResize(pen);\r\n\r\n    render && this.render();\r\n  }\r\n\r\n  getPenRect(\r\n    pen: Pen,\r\n    origin = this.store.data.origin,\r\n    scale = this.store.data.scale\r\n  ) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n\r\n    if (pen.parentId) {\r\n      // 子节点的 rect 只与父节点 rect 有关\r\n      return {\r\n        x: pen.x,\r\n        y: pen.y,\r\n        width: pen.width,\r\n        height: pen.height,\r\n      };\r\n    }\r\n\r\n    return {\r\n      x: (pen.x - origin.x) / scale,\r\n      y: (pen.y - origin.y) / scale,\r\n      width: pen.width / scale,\r\n      height: pen.height / scale,\r\n    };\r\n  }\r\n\r\n  toPng(\r\n    padding: Padding = 2,\r\n    callback?: BlobCallback,\r\n    containBkImg = false,\r\n    maxWidth?: number\r\n  ) {\r\n    const rect = getRect(this.store.data.pens);\r\n    const _scale = this.store.data.scale;\r\n    if (!isFinite(rect.width)) {\r\n      throw new Error('can not to png, because width is not finite');\r\n    }\r\n    const oldRect = deepClone(rect);\r\n    const storeData = this.store.data;\r\n    // TODO: 目前背景颜色优先级更高\r\n    const isDrawBkImg =\r\n      containBkImg && !storeData.background && this.store.bkImg;\r\n    // 主体在背景的右侧，下侧\r\n    let isRight = false,\r\n      isBottom = false;\r\n    if (isDrawBkImg) {\r\n      rect.x += storeData.x;\r\n      rect.y += storeData.y;\r\n      calcRightBottom(rect);\r\n      if (rectInRect(rect, this.canvasRect, true)) {\r\n        // 全部在区域内，那么 rect 就是 canvasRect\r\n        Object.assign(rect, this.canvasRect);\r\n      } else {\r\n        // 合并区域\r\n        const mergeArea = getRectOfPoints([\r\n          ...rectToPoints(rect),\r\n          ...rectToPoints(this.canvasRect),\r\n        ]);\r\n        Object.assign(rect, mergeArea);\r\n      }\r\n      isRight = rect.x === 0;\r\n      isBottom = rect.y === 0;\r\n    }\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    //大屏\r\n    let isV = false;\r\n    if (width && height && !this.store.data.component) {\r\n      isV = true;\r\n    }\r\n    if (isV) {\r\n      rect.x = this.store.data.origin.x;\r\n      rect.y = this.store.data.origin.y;\r\n      rect.width = width * this.store.data.scale;\r\n      rect.height = height * this.store.data.scale;\r\n    }\r\n    const vRect = deepClone(rect);\r\n\r\n    // 有背景图，也添加 padding\r\n    const p = formatPadding(padding);\r\n    rect.x -= p[3] * _scale;\r\n    rect.y -= p[0] * _scale;\r\n    rect.width += (p[3] + p[1]) * _scale;\r\n    rect.height += (p[0] + p[2]) * _scale;\r\n    // 扩大图\r\n    // const scale =\r\n    //   rect.width > rect.height ? longSide / rect.width : longSide / rect.height;\r\n    const scale = (maxWidth || 1920) / rect.width;\r\n    rect.width *= scale;\r\n    rect.height *= scale;\r\n\r\n    calcRightBottom(rect);\r\n\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = rect.width;\r\n    canvas.height = rect.height;\r\n    if (\r\n      canvas.width > 32767 ||\r\n      canvas.height > 32767 ||\r\n      (!navigator.userAgent.includes('Firefox') &&\r\n        canvas.height * canvas.width > 268435456) ||\r\n      (navigator.userAgent.includes('Firefox') &&\r\n        canvas.height * canvas.width > 472907776)\r\n    ) {\r\n      throw new Error(\r\n        'can not to png, because the size exceeds the browser limit'\r\n      );\r\n    }\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    // if (window.devicePixelRatio > 1) {\r\n    //   canvas.width *= window.devicePixelRatio;\r\n    //   canvas.height *= window.devicePixelRatio;\r\n    //   canvas.style.width = `${canvas.width / window.devicePixelRatio}`;\r\n    //   canvas.style.height = `${canvas.height / window.devicePixelRatio}`;\r\n\r\n    //   ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\r\n    // }\r\n\r\n    ctx.textBaseline = 'middle'; // 默认垂直居中\r\n    ctx.scale(scale, scale);\r\n\r\n    const background =\r\n      this.store.data.background || this.store.options.background;\r\n    if (background) {\r\n      // 绘制背景颜色\r\n      ctx.save();\r\n      ctx.fillStyle = background;\r\n      if (isV) {\r\n        ctx.fillRect(\r\n          0,\r\n          0,\r\n          vRect.width + (p[1] + p[3]) * _scale,\r\n          vRect.height + (p[0] + p[2]) * _scale\r\n        );\r\n      } else {\r\n        ctx.fillRect(\r\n          0,\r\n          0,\r\n          oldRect.width + (p[3] + p[1]) * _scale,\r\n          oldRect.height + (p[0] + p[2]) * _scale\r\n        );\r\n      }\r\n      ctx.restore();\r\n    }\r\n\r\n    if (isDrawBkImg) {\r\n      if (isV) {\r\n        ctx.drawImage(\r\n          this.store.bkImg,\r\n          p[3] * _scale || 0,\r\n          p[0] * _scale || 0,\r\n          vRect.width,\r\n          vRect.height\r\n        );\r\n      } else {\r\n        const x = rect.x < 0 ? -rect.x : 0;\r\n        const y = rect.y < 0 ? -rect.y : 0;\r\n        ctx.drawImage(\r\n          this.store.bkImg,\r\n          x,\r\n          y,\r\n          this.canvasRect.width,\r\n          this.canvasRect.height\r\n        );\r\n      }\r\n    }\r\n    if (!isDrawBkImg) {\r\n      ctx.translate(-rect.x, -rect.y);\r\n    } else {\r\n      // 平移画布，画笔的 worldRect 不变化\r\n      if (isV) {\r\n        ctx.translate(\r\n          -oldRect.x + p[3] * _scale || 0,\r\n          -oldRect.y + p[0] * _scale || 0\r\n        );\r\n      } else {\r\n        ctx.translate(\r\n          (isRight ? storeData.x : -oldRect.x) + p[3] * _scale || 0,\r\n          (isBottom ? storeData.y : -oldRect.y) + p[0] * _scale || 0\r\n        );\r\n      }\r\n    }\r\n    for (const pen of this.store.data.pens) {\r\n      // 不使用 calculative.inView 的原因是，如果 pen 在 view 之外，那么它的 calculative.inView 为 false，但是它的绘制还是需要的\r\n      if (!isShowChild(pen, this.store) || pen.visible == false) {\r\n        continue;\r\n      }\r\n      // TODO: hover 待考虑，若出现再补上\r\n      const { active } = pen.calculative;\r\n      pen.calculative.active = false;\r\n      if (pen.calculative.img) {\r\n        renderPenRaw(ctx, pen);\r\n      } else {\r\n        renderPen(ctx, pen, true);\r\n      }\r\n      pen.calculative.active = active;\r\n    }\r\n    if (callback) {\r\n      canvas.toBlob(callback);\r\n      return;\r\n    }\r\n    return canvas.toDataURL();\r\n  }\r\n\r\n  activeToPng(padding: Padding = 2, maxWidth?: number) {\r\n    return this.pensToPng(this.store.active,padding, maxWidth);\r\n  }\r\n\r\n  pensToPng(pens:Pen[] = this.store.active, padding:Padding=2, maxWidth?: number){\r\n    if(pens.length === 0){\r\n      return;\r\n    }\r\n    const allPens = this.getAllByPens(pens);\r\n    let ids = allPens.map((pen) => pen.id);\r\n    const rect = getRect(allPens);\r\n    if (!isFinite(rect.width)) {\r\n      throw new Error('can not to png, because width is not finite');\r\n    }\r\n    const oldRect = deepClone(rect);\r\n    const p = formatPadding(padding);\r\n    rect.x -= p[3];\r\n    rect.y -= p[0];\r\n    rect.width += p[3] + p[1];\r\n    rect.height += p[0] + p[2];\r\n    calcRightBottom(rect);\r\n\r\n    const scale = (maxWidth || rect.width) / rect.width;\r\n    rect.width *= scale;\r\n    rect.height *= scale;\r\n    \r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = rect.width;\r\n    canvas.height = rect.height;\r\n    if (\r\n      canvas.width > 32767 ||\r\n      canvas.height > 32767 ||\r\n      (!navigator.userAgent.includes('Firefox') &&\r\n        canvas.height * canvas.width > 268435456) ||\r\n      (navigator.userAgent.includes('Firefox') &&\r\n        canvas.height * canvas.width > 472907776)\r\n    ) {\r\n      throw new Error(\r\n        'can not to png, because the size exceeds the browser limit'\r\n      );\r\n    }\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.textBaseline = 'middle'; // 默认垂直居中\r\n    ctx.scale(scale, scale);\r\n\r\n    const background =\r\n    this.store.data.background || this.store.options.background;\r\n    if (background) {\r\n      // 绘制背景颜色\r\n      ctx.save();\r\n      ctx.fillStyle = background;\r\n      ctx.fillRect(\r\n        0,\r\n        0,\r\n        oldRect.width + (p[3] + p[1]),\r\n        oldRect.height + (p[0] + p[2]) \r\n      );\r\n      ctx.restore();\r\n    }\r\n    // // 平移画布，画笔的 worldRect 不变化\r\n    ctx.translate(-oldRect.x + p[3], -oldRect.y + p[0]);\r\n\r\n    for (const pen of this.store.data.pens) {\r\n      if (ids.includes(pen.id)) {\r\n        // 不使用 calculative.inView 的原因是，如果 pen 在 view 之外，那么它的 calculative.inView 为 false，但是它的绘制还是需要的\r\n        if (!isShowChild(pen, this.store) || pen.visible == false) {\r\n          continue;\r\n        }\r\n        const { active } = pen.calculative;\r\n        pen.calculative.active = false;\r\n        if (pen.calculative.img) {\r\n          renderPenRaw(ctx, pen);\r\n        } else {\r\n          renderPen(ctx, pen);\r\n        }\r\n        pen.calculative.active = active;\r\n      }\r\n    }\r\n\r\n    return canvas.toDataURL();\r\n  }\r\n\r\n  toggleAnchorMode() {\r\n    if (!this.hotkeyType) {\r\n      if (this.store.options.disableAnchor || this.store.hover?.disableAnchor) {\r\n        return;\r\n      }\r\n      this.hotkeyType = HotkeyType.AddAnchor;\r\n      if (this.store.hover) {\r\n        this.externalElements.style.cursor = 'pointer';\r\n      }\r\n    } else if (this.hotkeyType === HotkeyType.AddAnchor) {\r\n      this.hotkeyType = HotkeyType.None;\r\n      if (this.store.hoverAnchor) {\r\n        this.externalElements.style.cursor = 'vertical-text';\r\n      } else if (this.store.hover) {\r\n        this.externalElements.style.cursor = 'move';\r\n      }\r\n    }\r\n    this.patchFlags = true;\r\n  }\r\n\r\n  addAnchorHand() {\r\n    if (\r\n      this.store.activeAnchor &&\r\n      this.store.active &&\r\n      this.store.active.length === 1 &&\r\n      this.store.active[0].type\r\n    ) {\r\n      const initPens = [deepClone(this.store.active[0], true)];\r\n\r\n      if (!this.store.activeAnchor.prev) {\r\n        if (!this.store.activeAnchor.next) {\r\n          this.store.activeAnchor.next = {\r\n            penId: this.store.activeAnchor.penId,\r\n            x: this.store.activeAnchor.x + 50,\r\n            y: this.store.activeAnchor.y,\r\n          };\r\n        }\r\n        this.store.activeAnchor.prev = { ...this.store.activeAnchor.next };\r\n        rotatePoint(this.store.activeAnchor.prev, 180, this.store.activeAnchor);\r\n        this.initLineRect(this.store.active[0]);\r\n        this.patchFlags = true;\r\n      } else if (!this.store.activeAnchor.next) {\r\n        this.store.activeAnchor.next = { ...this.store.activeAnchor.prev };\r\n        rotatePoint(this.store.activeAnchor.next, 180, this.store.activeAnchor);\r\n        this.initLineRect(this.store.active[0]);\r\n        this.patchFlags = true;\r\n      }\r\n\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: [deepClone(this.store.active[0], true)],\r\n        initPens,\r\n      });\r\n    }\r\n  }\r\n\r\n  removeAnchorHand() {\r\n    if (\r\n      this.store.activeAnchor &&\r\n      this.store.active &&\r\n      this.store.active.length === 1 &&\r\n      this.store.active[0].type\r\n    ) {\r\n      const initPens = [deepClone(this.store.active[0], true)];\r\n\r\n      if (this.hoverType === HoverType.LineAnchorPrev) {\r\n        this.store.activeAnchor.prev = undefined;\r\n        this.initLineRect(this.store.active[0]);\r\n        this.patchFlags = true;\r\n      } else if (this.hoverType === HoverType.LineAnchorNext) {\r\n        this.store.activeAnchor.next = undefined;\r\n        this.initLineRect(this.store.active[0]);\r\n        this.patchFlags = true;\r\n      } else {\r\n        this.store.activeAnchor.prev = undefined;\r\n        this.store.activeAnchor.next = undefined;\r\n        this.initLineRect(this.store.active[0]);\r\n        this.patchFlags = true;\r\n      }\r\n\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        pens: [deepClone(this.store.active[0])],\r\n        initPens,\r\n      });\r\n    }\r\n  }\r\n\r\n  toggleAnchorHand() {\r\n    if (\r\n      this.store.active.length === 1 &&\r\n      this.store.active[0].type &&\r\n      this.store.activeAnchor\r\n    ) {\r\n      if (!this.store.activeAnchor.prevNextType) {\r\n        this.store.activeAnchor.prevNextType = PrevNextType.Mirror;\r\n      }\r\n      this.store.activeAnchor.prevNextType =\r\n        (this.store.activeAnchor.prevNextType + 1) % 3;\r\n    }\r\n  }\r\n\r\n  gotoView(x: number, y: number) {\r\n    let rect = getRect(this.store.data.pens);\r\n    if (!isFinite(rect.width)) {\r\n      throw new Error('can not move view, because width is not finite');\r\n    }\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    if (width && height) {\r\n      //大屏\r\n      rect = {\r\n        x: this.store.data.origin.x,\r\n        y: this.store.data.origin.y,\r\n        width: width * this.store.data.scale,\r\n        height: height * this.store.data.scale,\r\n      };\r\n    }\r\n    this.store.data.x = this.canvas.clientWidth / 2 - x * rect.width - rect.x;\r\n    this.store.data.y = this.canvas.clientHeight / 2 - y * rect.height - rect.y;\r\n    this.onMovePens();\r\n    this.canvasTemplate.init();\r\n    this.canvasImage.init();\r\n    this.canvasImageBottom.init();\r\n    this.render();\r\n  }\r\n\r\n  showMagnifier() {\r\n    this.magnifierCanvas.canvas.style.zIndex = '100';\r\n    this.externalElements.style.zIndex = '101';\r\n    this.magnifierCanvas.magnifier = true;\r\n    this.magnifierCanvas.updateDomOffscreen();\r\n    this.externalElements.style.cursor = 'default';\r\n    this.render();\r\n  }\r\n\r\n  hideMagnifier() {\r\n    this.magnifierCanvas.canvas.style.zIndex = '5';\r\n    this.externalElements.style.zIndex = '5';\r\n    this.magnifierCanvas.magnifier = false;\r\n    this.externalElements.style.cursor = 'default';\r\n    this.render();\r\n  }\r\n  \r\n  private inFitBorder = (pt: Point) => {\r\n    let current = undefined;\r\n    const width = (this.store.data.width || this.store.options.width);\r\n    const height = (this.store.data.height || this.store.options.height);\r\n    let point = {\r\n      x: (pt.x - this.store.data.origin.x) / this.store.data.scale,\r\n      y: (pt.y - this.store.data.origin.y) / this.store.data.scale,\r\n    }\r\n    const fit = this.canvasImage.activeFit;\r\n    // if (pointInRect(point, { x:fit.x-0.01, y:0, width, height })) {\r\n      this.externalElements.style.cursor = 'default';\r\n      if (point.y > height * fit.y - 10 && point.y < height * fit.y + 10) {\r\n        current = 'top';\r\n        this.externalElements.style.cursor = 'row-resize';\r\n      }\r\n      if (point.y > height * (fit.y + fit.height) - 10 && point.y < height * (fit.y + fit.height) + 10) {\r\n        current = 'bottom';\r\n        this.externalElements.style.cursor = 'row-resize';\r\n  \r\n      }\r\n      if (point.x > width * fit.x - 10 && point.x < width * fit.x) {\r\n        current = 'left';\r\n        this.externalElements.style.cursor = 'col-resize';\r\n  \r\n      }\r\n      if (point.x > width * (fit.x + fit.width) - 10 && point.x < width * (fit.x + fit.width) + 10) {\r\n        current = 'right';\r\n        this.externalElements.style.cursor = 'col-resize';\r\n  \r\n      }\r\n    // }\r\n    this.canvasImage.currentFit = current;\r\n  }\r\n\r\n  showFit() {\r\n    this.store.data.locked = 0;\r\n    this.canvasImage.fitFlag = true;\r\n    this.canvasImage.activeFit = undefined;\r\n    this.canvasImage.currentFit = undefined;\r\n    if(!this.store.data.fits){\r\n      this.store.data.fits =[];\r\n    }\r\n    this.store.data.fits.forEach((fit) => fit.active = false);\r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n  }\r\n\r\n  hideFit() {\r\n    this.canvasImage.fitFlag = false;\r\n    this.canvasImage.activeFit = undefined;\r\n    this.canvasImage.currentFit = undefined;\r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n  }\r\n\r\n  makeFit(){\r\n    if(this.dragRect.width<100 && this.dragRect.height<100){\r\n      return;\r\n    }\r\n    //将所有当前框选的图元设置到该容器中\r\n    const pens = this.store.data.pens.filter((pen)=>{\r\n      if (\r\n        // pen.locked >= LockState.DisableMove || \r\n        pen.parentId || pen.isRuleLine\r\n      ) {\r\n        return false;\r\n      }\r\n      if (\r\n        rectInRect(\r\n          pen.calculative.worldRect,\r\n          this.dragRect,\r\n          true\r\n        )\r\n      ) {\r\n        // 先判断在区域内，若不在区域内，则锚点肯定不在框选区域内，避免每条连线过度计算\r\n        if (pen.type === PenType.Line && !this.store.options.dragAllIn) {\r\n          return lineInRect(pen, this.dragRect);\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n    if(!pens.length){\r\n      return;\r\n    }\r\n    const _rect = this.parent.getRect(pens);\r\n    const scale = this.store.data.scale;\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    let x = (Math.floor(_rect.x) - this.store.data.origin.x) / scale / width;\r\n    let y = (Math.floor(_rect.y) - this.store.data.origin.y) / scale / height;\r\n    let rect:Fit = {\r\n      x,\r\n      y,\r\n      width: (Math.ceil(_rect.width) + 1) / scale / width,\r\n      height: (Math.ceil(_rect.height) + 1) / scale / height,\r\n      children:pens.map(pen=>pen.id),\r\n      id:s8(),\r\n      active:true\r\n    }\r\n    if(rect.x < -0.1){\r\n      rect.x = -0.1;\r\n    }\r\n    if(rect.y < -0.1){\r\n      rect.y = -0.1;\r\n    }\r\n    if(rect.width > 0.5){\r\n      rect.left = true;\r\n      rect.right = true;\r\n      rect.leftValue = (rect.x-0)*scale*width;\r\n      rect.rightValue = (1 - (rect.x+rect.width))*scale*width;\r\n    }else{\r\n      if(rect.x < 0.5){\r\n        rect.left = true;\r\n        rect.leftValue = (rect.x-0)*scale*width;\r\n      }else{\r\n        rect.right = true;\r\n        rect.rightValue = (1 - (rect.x+rect.width))*scale*width;\r\n      }\r\n    }\r\n    if(rect.leftValue < 1){\r\n      rect.leftValue = 0;\r\n    }\r\n    if(rect.rightValue < 1){\r\n      rect.rightValue = 0;\r\n    }\r\n    if(rect.height > 0.5){\r\n      rect.top = true;\r\n      rect.bottom = true;\r\n      rect.topValue = (rect.y-0)*scale*height;\r\n      rect.bottomValue = (1 - (rect.y+rect.height))*scale*height;\r\n    }else{\r\n      if(rect.y < 0.5){\r\n        rect.top = true;\r\n        rect.topValue = (rect.y-0)*scale*height;\r\n      }else{\r\n        rect.bottom = true;\r\n        rect.bottomValue = (1 - (rect.y+rect.height))*scale*height;\r\n      }\r\n    }\r\n    if(rect.topValue < 1){\r\n      rect.topValue = 0;\r\n    }\r\n    if(rect.bottomValue < 1){\r\n      rect.bottomValue = 0;\r\n    }\r\n\r\n    if(!this.store.data.fits){\r\n      this.store.data.fits = [];\r\n    }\r\n    this.store.data.fits.forEach((fit)=>{fit.active = false});\r\n    this.store.data.fits.push(rect);\r\n    this.canvasImage.activeFit = rect;\r\n    this.store.emitter.emit('fit', rect);\r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n  }\r\n\r\n  updateFit(e:any){\r\n    const scale = this.store.data.scale;\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    let x = (e.x - this.store.data.origin.x) / scale / width;\r\n    let y = (e.y - this.store.data.origin.y) / scale / height;\r\n    if (this.canvasImage.currentFit) {\r\n      const fit = this.canvasImage.activeFit;\r\n      if (this.canvasImage.currentFit === 'top') {\r\n        if (y < -0.1) {\r\n          y = -0.1;\r\n        }\r\n        let gap = y - fit.y;\r\n        fit.height -= gap;\r\n        if (fit.height < 0.01) {\r\n          fit.height = 0.01 ;\r\n          return;\r\n        }\r\n        fit.y = y;\r\n      }\r\n      if (this.canvasImage.currentFit === 'bottom') {\r\n        if (y > 1.1) {\r\n          y = 1.1;\r\n        }\r\n        fit.height = y - fit.y;\r\n        if (fit.height <= 0.01) {\r\n          fit.height = 0.01;\r\n        }\r\n      }\r\n      if (this.canvasImage.currentFit === 'left') {\r\n        if (x < - 0.1) {\r\n          x = - 0.1;\r\n        }\r\n        let gap = x - fit.x;\r\n        fit.width -= gap;\r\n        if (fit.width < 0.01) {\r\n          fit.width = 0.01;\r\n          return;\r\n        }\r\n        fit.x = x;\r\n      }\r\n      if (this.canvasImage.currentFit === 'right') {\r\n        if (x > 1.1) {\r\n          x = 1.1;\r\n        }\r\n        fit.width = x - fit.x;\r\n        if (fit.width <= 0.01) {\r\n          fit.width = 0.01;\r\n        }\r\n      }    \r\n      let rect = {\r\n        x:fit.x * width * scale + this.store.data.origin.x,\r\n        y:fit.y * height * scale + this.store.data.origin.y,\r\n        width:fit.width* width * scale,\r\n        height:fit.height * height * scale,\r\n      };\r\n      calcRightBottom(rect);\r\n      const pens = this.store.data.pens.filter((pen)=>{\r\n        if (\r\n          // pen.locked >= LockState.DisableMove || \r\n          pen.parentId || pen.isRuleLine\r\n        ) {\r\n          return false;\r\n        }\r\n        if (\r\n          rectInRect(\r\n            pen.calculative.worldRect,\r\n            rect,\r\n            true\r\n          )\r\n        ) {\r\n          if (pen.type === PenType.Line && !this.store.options.dragAllIn) {\r\n            return lineInRect(pen, rect);\r\n          }\r\n          return true;\r\n        }\r\n      });\r\n      fit.left = undefined;\r\n      fit.leftValue = undefined;\r\n      fit.right = undefined;\r\n      fit.rightValue = undefined;\r\n      fit.top = undefined;\r\n      fit.topValue = undefined;\r\n      fit.bottom = undefined;\r\n      fit.bottomValue = undefined;\r\n\r\n      if(fit.width > 0.5){\r\n        fit.left = true;\r\n        fit.right = true;\r\n        fit.leftValue =  (fit.x-0)*scale*width;\r\n        fit.rightValue = ((1 - (fit.x+fit.width))*scale*width);\r\n      }else{\r\n        if(fit.x < 0.5){\r\n          fit.left = true;\r\n          fit.leftValue = (fit.x-0)*scale*width;\r\n        }else{\r\n          fit.right = true;\r\n          fit.rightValue =  ((1 - (fit.x+fit.width))*scale*width);\r\n        }\r\n      }\r\n      if( Math.abs(fit.leftValue) < 1){\r\n        fit.leftValue = 0;\r\n      }\r\n      if(Math.abs(fit.rightValue) < 1){\r\n        fit.rightValue = 0;\r\n      }\r\n      if(fit.height > 0.5){\r\n        fit.top = true;\r\n        fit.bottom = true;\r\n        fit.topValue =  (fit.y-0)*scale*height;\r\n        fit.bottomValue = (1 - (fit.y+fit.height))*scale*height;\r\n      }else{\r\n        if(fit.y < 0.5){\r\n          fit.top = true;\r\n          fit.topValue =  (fit.y-0)*scale*height;\r\n        }else{\r\n          fit.bottom = true;\r\n          fit.bottomValue = (1 - (fit.y+fit.height))*scale*height;\r\n        }\r\n      }\r\n\r\n      if(Math.abs(fit.topValue) < 1){\r\n        fit.topValue = 0;\r\n      }\r\n      if(Math.abs(fit.bottomValue) < 1){\r\n        fit.bottomValue = 0;\r\n      }\r\n      fit.children = pens.map(pen=>pen.id);\r\n      this.store.emitter.emit('fit', fit);\r\n      this.mouseDown.x = e.x;\r\n      this.mouseDown.y = e.y;\r\n      this.canvasImage.init();\r\n      this.canvasImage.render();\r\n    }\r\n  }\r\n\r\n  updateFitRect(fit:Fit = this.canvasImage.activeFit){\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    if(fit.left){\r\n      if(fit.leftValue){\r\n        fit.x =  Math.abs(fit.leftValue)<1?fit.leftValue:fit.leftValue/width;\r\n      }else{\r\n        fit.x = 0;\r\n      }\r\n    }\r\n    if(fit.right){\r\n      if(fit.rightValue){\r\n        fit.width = 1 - (Math.abs(fit.rightValue)<1?fit.rightValue:fit.rightValue/width) - fit.x;\r\n      }else{\r\n        fit.width = 1 - fit.x;\r\n      }\r\n    }\r\n    if(fit.top){\r\n      if(fit.topValue){\r\n        fit.y =  Math.abs(fit.topValue)<1?fit.topValue:fit.topValue/height;\r\n      }else{\r\n        fit.y = 0;\r\n      }\r\n    }\r\n    if(fit.bottom){\r\n      if(fit.bottomValue){\r\n        fit.height = 1 - (Math.abs(fit.bottomValue)<1?fit.bottomValue:fit.bottomValue/height) - fit.y;\r\n      }else{\r\n        fit.height = 1 - fit.y;\r\n      }\r\n    } \r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n  }\r\n\r\n  deleteFit(fit = this.canvasImage.activeFit){\r\n    if(!fit){\r\n      return;\r\n    }\r\n    const index = this.store.data.fits.findIndex(item=>item.id===fit.id);\r\n\r\n    this.store.data.fits.splice(index, 1);\r\n    this.canvasImage.activeFit = undefined;\r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n    this.store.emitter.emit('fit',undefined);\r\n  }\r\n\r\n  calcuActiveFit(){\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    let downX = (this.mouseDown.x - this.store.data.origin.x) / this.store.data.scale / width;\r\n    let downY = (this.mouseDown.y - this.store.data.origin.y) / this.store.data.scale / height;\r\n   \r\n    let idx = -1;\r\n    let lastActiveIdx = -1;\r\n    this.store.data.fits?.forEach((fit,index)=>{\r\n      fit.ex = null;\r\n      fit.ey = null;\r\n      if(pointInRect({x: downX, y: downY}, fit)){\r\n        idx = index;\r\n      };\r\n      if(fit.active){\r\n        lastActiveIdx = index;\r\n      }\r\n    });\r\n    if(idx !== -1 && idx !== lastActiveIdx){\r\n      this.canvasImage.activeFit = this.store.data.fits[idx];\r\n      this.store.data.fits[idx].active = true;\r\n      if(lastActiveIdx !== -1){\r\n        this.store.data.fits[lastActiveIdx].active = false;\r\n      }\r\n      this.store.emitter.emit('fit', this.store.data.fits[idx]);\r\n    }else if(idx === -1&&lastActiveIdx !== -1){\r\n      this.store.data.fits[lastActiveIdx].active = false;\r\n      this.store.emitter.emit('fit', undefined);\r\n      this.canvasImage.activeFit = null;\r\n    }\r\n    this.inactive();\r\n    this.canvasImage.init();\r\n    this.canvasImage.render();\r\n  }\r\n\r\n  toggleMagnifier() {\r\n    this.magnifierCanvas.magnifier = !this.magnifierCanvas.magnifier;\r\n    if (this.magnifierCanvas.magnifier) {\r\n      this.externalElements.style.cursor = 'default';\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  destroy() {\r\n    this.scroll && this.scroll.destroy();\r\n    this.tooltip?.destroy();\r\n    this.dialog?.destroy();\r\n    this.title?.destroy();\r\n    this.popconfirm?.destroy();\r\n\r\n    // ios\r\n    this.externalElements.removeEventListener(\r\n      'gesturestart',\r\n      this.onGesturestart\r\n    );\r\n\r\n    this.externalElements.ondragover = (e) => e.preventDefault();\r\n    this.externalElements.ondrop = undefined;\r\n    this.externalElements.ontouchstart = undefined;\r\n    this.externalElements.ontouchmove = undefined;\r\n    this.externalElements.ontouchend = undefined;\r\n    this.externalElements.onmousedown = undefined;\r\n    this.externalElements.onmousemove = undefined;\r\n    this.externalElements.onmouseup = undefined;\r\n    this.externalElements.onmouseleave = undefined;\r\n    this.externalElements.ondblclick = undefined;\r\n    switch (this.store.options.keydown) {\r\n      case KeydownType.Document:\r\n        document.removeEventListener('keydown', this.onkeydown);\r\n        document.removeEventListener('keyup', this.onkeyup);\r\n        break;\r\n      case KeydownType.Canvas:\r\n        this.externalElements.removeEventListener('keydown', this.onkeydown);\r\n        this.externalElements.removeEventListener('keyup', this.onkeyup);\r\n        break;\r\n    }\r\n    document.removeEventListener('copy', this.onCopy);\r\n    document.removeEventListener('cut', this.onCut);\r\n    document.removeEventListener('paste', this.onPaste);\r\n    window && window.removeEventListener('message', this.onMessage);\r\n    window && window.removeEventListener('resize', this.onResize);\r\n    window && window.removeEventListener('scroll', this.onScroll);\r\n    this.parentElement.innerHTML = '';\r\n  }\r\n}\r\n","import { movingSuffix } from '../canvas';\r\nimport { Pen } from '../pen';\r\nimport { Point } from '../point';\r\nimport { rectInRect } from '../rect';\r\nimport { deepClone } from '../utils';\r\n\r\nexport function panel(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = destory;\r\n    pen.onMove = move;\r\n    pen.onRotate = move;\r\n    pen.onMouseEnter = mouseEnter;\r\n    pen.onMouseLeave = mouseLeave;\r\n    pen.onMouseMove = mouseMove;\r\n    pen.onMouseUp = mouseUp;\r\n    pen.onInput = input;\r\n  }\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  const { x, y, width, height, ex, ey } = pen.calculative.worldRect;\r\n  const { x: textX } = pen.calculative.worldTextRect;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * hr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  const textWidth = getTextWidth(pen.text, pen.calculative.fontSize);\r\n  path.moveTo(x + r, y);\r\n  path.lineTo(textX - 5, y);\r\n  path.moveTo(textX + textWidth + 5, y);\r\n  path.lineTo(textX + textWidth + 5, y);\r\n  path.arcTo(ex, y, ex, ey, r);\r\n  path.arcTo(ex, ey, x, ey, r);\r\n  path.arcTo(x, ey, x, y, r);\r\n  path.arcTo(x, y, ex, y, r);\r\n  if (path instanceof Path2D) {\r\n    return path;\r\n  }\r\n}\r\n\r\nfunction getTextWidth(text: string, fontSize: number) {\r\n  // 近似计算\r\n  const chinese = text.match(/[^\\x00-\\xff]/g) || '';\r\n  const chineseWidth = chinese.length * fontSize; // 中文占用的宽度\r\n  const spaces = text.match(/\\s/g) || '';\r\n  const spaceWidth = spaces.length * fontSize * 0.3; // 空格占用的宽度\r\n  const otherWidth =\r\n    (text.length - chinese.length - spaces.length) * fontSize * 0.6; // 其他字符占用的宽度\r\n  const currentWidth = chineseWidth + spaceWidth + otherWidth;\r\n  return currentWidth;\r\n}\r\n\r\nfunction input(pen: Pen, text: string) {\r\n  pen.text = text;\r\n  pen.calculative.text = pen.text;\r\n  // this.inputDiv.dataset.penId = undefined;\r\n  pen.calculative.canvas.updatePenRect(pen);\r\n  // this.patchFlags = true;\r\n  // this.store.emitter.emit('valueUpdate', pen);\r\n}\r\n\r\nfunction destory(pen: Pen) {}\r\n\r\nfunction move(pen: Pen) {}\r\n\r\nfunction mouseEnter(pen: Pen) {\r\n  // const activePens = pen.calculative.canvas.store.active;\r\n  // if(activePens&&activePens.length){\r\n  //   activePens.forEach((activePen:Pen)=>{\r\n  //     if(rectInRect(activePen.calculative.worldRect,pen.calculative.worldRect,true)){\r\n  //       if(!pen.followers){\r\n  //         pen.followers =[];\r\n  //       }\r\n  //       if(!pen.followers.includes(activePen.id)){\r\n  //         pen.followers.push(activePen.id);\r\n  //       }\r\n  //     }\r\n  //   })\r\n  // }\r\n}\r\n\r\nfunction mouseLeave(pen: Pen) {\r\n  const activePens = pen.calculative.canvas.store.active;\r\n  if (activePens && activePens.length) {\r\n    activePens.forEach((activePen: Pen) => {\r\n      // if(!rectInRect(activePen.calculative.worldRect,pen.calculative.worldRect,true)){\r\n      //   if(!pen.followers){\r\n      //     pen.followers =[];\r\n      //   }\r\n      //   if(!pen.followers.includes(activePen.id)){\r\n      //     pen.followers.push(activePen.id);\r\n      //   }\r\n      // }\r\n      if (pen.followers) {\r\n        let idx = pen.followers.findIndex((id: string) => id === activePen.id);\r\n        if (idx !== -1) {\r\n          const movingPen =\r\n            pen.calculative.canvas.store.pens[activePen.id + movingSuffix];\r\n          if (movingPen && movingPen.calculative) {\r\n            let isIn = rectInRect(\r\n              movingPen.calculative.worldRect,\r\n              pen.calculative.worldRect,\r\n              true\r\n            );\r\n            if (!isIn) {\r\n              pen.followers.splice(idx, 1);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction mouseUp(pen: Pen) {\r\n  const activePens = pen.calculative.canvas.store.active;\r\n  if (activePens && activePens.length) {\r\n    activePens.forEach((activePen: Pen) => {\r\n      const movingPen =\r\n        pen.calculative.canvas.store.pens[activePen.id + movingSuffix];\r\n      if (movingPen && movingPen.calculative) {\r\n        let inRect = deepClone(pen.calculative.worldRect);\r\n        inRect.x -= 1;\r\n        inRect.y -= 1;\r\n        inRect.width += 2;\r\n        inRect.height += 2;\r\n        if (rectInRect(movingPen.calculative.worldRect, inRect, true)) {\r\n          if (!pen.followers) {\r\n            pen.followers = [];\r\n          }\r\n          if (!pen.followers.includes(activePen.id)) {\r\n            pen.followers.push(activePen.id);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction mouseMove(pen: Pen, e: Point) {\r\n  //  console.log(e,pen.calculative.canvas.store.active);\r\n}\r\n","import { Pen, setElemPosition } from '../pen';\r\n\r\nexport const gifsList: {\r\n  [key: string]: HTMLImageElement;\r\n} = {};\r\n\r\nexport function gif(pen: Pen): Path2D {\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = destory;\r\n    pen.onMove = move;\r\n    pen.onResize = resize;\r\n    pen.onRotate = move;\r\n    pen.onValue = value;\r\n    pen.onChangeId = changeId;\r\n  }\r\n\r\n  const path = new Path2D();\r\n  if (!pen.image) {\r\n    return;\r\n  }\r\n\r\n  if (!gifsList[pen.id]) {\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.src = pen.image;\r\n    if (\r\n      pen.calculative.canvas.parent.store.options.cdn &&\r\n      !(\r\n        pen.image.startsWith('http') ||\r\n        pen.image.startsWith('//') ||\r\n        pen.image.startsWith('data:image')\r\n      )\r\n    ) {\r\n      img.src = pen.calculative.canvas.parent.store.options.cdn + pen.image;\r\n    }\r\n    gifsList[pen.id] = img; // 提前赋值，避免重复创建\r\n    img.onload = () => {\r\n      if (gifsList[pen.id] !== img) {\r\n        return;\r\n      }\r\n      pen.calculative.img = img;\r\n      pen.calculative.imgNaturalWidth = img.naturalWidth || pen.iconWidth;\r\n      pen.calculative.imgNaturalHeight = img.naturalHeight || pen.iconHeight;\r\n      // pen.calculative.canvas.externalElements?.appendChild(img);\r\n      pen.calculative.canvas.externalElements?.parentElement.appendChild(img);\r\n      setImagePosition(pen, img);\r\n    };\r\n  }\r\n\r\n  if (pen.calculative.patchFlags && gifsList[pen.id]) {\r\n    setImagePosition(pen, gifsList[pen.id]);\r\n  }\r\n  return path;\r\n}\r\n\r\nfunction destory(pen: Pen) {\r\n  if (gifsList[pen.id]) {\r\n    gifsList[pen.id].remove();\r\n    gifsList[pen.id] = undefined;\r\n  }\r\n}\r\n\r\nfunction move(pen: Pen) {\r\n  if (!gifsList[pen.id]) {\r\n    return;\r\n  }\r\n  setImagePosition(pen, gifsList[pen.id]);\r\n}\r\n\r\nfunction resize(pen: Pen) {\r\n  if (!gifsList[pen.id]) {\r\n    return;\r\n  }\r\n  setImagePosition(pen, gifsList[pen.id]);\r\n}\r\n\r\nfunction value(pen: Pen) {\r\n  if (!gifsList[pen.id]) {\r\n    return;\r\n  }\r\n  setImagePosition(pen, gifsList[pen.id]);\r\n  if (gifsList[pen.id].getAttribute('src') !== pen.image) {\r\n    gifsList[pen.id].src = pen.image;\r\n  }\r\n}\r\n\r\nfunction changeId(pen: Pen, oldId: string, newId: string) {\r\n  if (!gifsList[oldId]) {\r\n    return;\r\n  }\r\n  gifsList[newId] = gifsList[oldId];\r\n  delete gifsList[oldId];\r\n}\r\n\r\n/**\r\n * gif 保持比例，除了更改 position ，还需要是否可保持比例\r\n * @param pen 画笔\r\n * @param elem 图片 dom\r\n */\r\nfunction setImagePosition(pen: Pen, elem: HTMLImageElement) {\r\n  // meta2d canvas 绘制图片 drawImage 保持比例，是短边填充\r\n  elem.style.objectFit = pen.imageRatio ? 'contain' : 'fill';\r\n  // elem.style.opacity = pen.globalAlpha + '';\r\n  setElemPosition(pen, elem);\r\n}\r\n","import { calcWorldAnchors, Pen } from '../pen';\r\nimport { Point } from '../point';\r\nimport { rectangle } from '.';\r\n\r\nexport function mindNode(pen: Pen, ctx?: CanvasRenderingContext2D) {\r\n  if (!pen.onResize) {\r\n    pen.onResize = resize;\r\n    pen.onValue = value;\r\n  }\r\n\r\n  return rectangle(pen, ctx);\r\n}\r\n\r\nfunction resize(pen: Pen) {\r\n  // 过滤出非默认锚点，即自定义锚点\r\n  const manualPoints = pen.anchors.filter((point: Point) => point.flag !== 1);\r\n  mindNodeAnchors(pen);\r\n  pen.anchors = pen.anchors.concat(...manualPoints);\r\n}\r\n\r\nfunction value(pen: Pen) {\r\n  resize(pen);\r\n  calcWorldAnchors(pen);\r\n}\r\n\r\nexport function mindNodeAnchors(pen: Pen) {\r\n  // TODO: 组合状态下的 width height 成了固定的百分比\r\n  const anchors: Point[] = [];\r\n  const { x: rectX, y: rectY, width, height } = pen;\r\n  const r = borderRadius(pen);\r\n  // 上四\r\n  const topN = 5; // 上方节点个数，控制位置，实际节点数依然是 4 个\r\n  for (let i = 0; i < topN; i++) {\r\n    if (i === 2) {\r\n      continue;\r\n    }\r\n    let x = rectX + (width * (i + 1)) / (topN + 1);\r\n    let y = rectY;\r\n    if (x < rectX + r) {\r\n      // 在左侧圆角\r\n      y = getYByCircle(rectX + r, y + r, x, r, -1);\r\n    } else if (x > rectX + width - r) {\r\n      // 在右侧圆角\r\n      y = getYByCircle(rectX + width - r, y + r, x, r, -1);\r\n    }\r\n    anchors.push({\r\n      id: String(anchors.length),\r\n      flag: 1,\r\n      penId: pen.id,\r\n      x: (x - rectX) / width,\r\n      y: (y - rectY) / height,\r\n    });\r\n  }\r\n  // 右三\r\n  const rightN = 3; // 右侧节点数\r\n  for (let i = 0; i < rightN; i++) {\r\n    let y = rectY + (height * (i + 1)) / (rightN + 1);\r\n    let x = rectX + width;\r\n    if (y < rectY + r) {\r\n      // 在上侧圆角以内\r\n      x = getXByCircle(x - r, rectY + r, y, r);\r\n    } else if (y > rectY + height - r) {\r\n      // 下侧圆角\r\n      x = getXByCircle(x - r, rectY + height - r, y, r);\r\n    }\r\n    anchors.push({\r\n      id: String(anchors.length),\r\n      flag: 1,\r\n      penId: pen.id,\r\n      x: (x - rectX) / width,\r\n      y: (y - rectY) / height,\r\n    });\r\n  }\r\n  // 下四\r\n  const bottomN = 5; // 下侧节点数\r\n  for (let i = 0; i < bottomN; i++) {\r\n    if (i === 2) {\r\n      continue;\r\n    }\r\n    let x = rectX + (width * (i + 1)) / (bottomN + 1);\r\n    let y = rectY + height;\r\n    if (x < rectX + r) {\r\n      // 在左侧圆角\r\n      y = getYByCircle(rectX + r, y - r, x, r);\r\n    } else if (x > rectX + width - r) {\r\n      // 在右侧圆角\r\n      y = getYByCircle(rectX + width - r, y - r, x, r);\r\n    }\r\n    anchors.push({\r\n      id: String(anchors.length),\r\n      flag: 1,\r\n      penId: pen.id,\r\n      x: (x - rectX) / width,\r\n      y: (y - rectY) / height,\r\n    });\r\n  }\r\n  // 左三\r\n  const leftN = 3; // 左侧节点数\r\n  for (let i = 0; i < leftN; i++) {\r\n    let y = rectY + (height * (i + 1)) / (leftN + 1);\r\n    let x = rectX;\r\n    if (y < rectY + r) {\r\n      // 在上侧圆角以内\r\n      x = getXByCircle(x + r, rectY + r, y, r, -1);\r\n    } else if (y > rectY + height - r) {\r\n      // 下侧圆角\r\n      x = getXByCircle(x + r, rectY + height - r, y, r, -1);\r\n    }\r\n    anchors.push({\r\n      id: String(anchors.length),\r\n      flag: 1,\r\n      penId: pen.id,\r\n      x: (x - rectX) / width,\r\n      y: (y - rectY) / height,\r\n    });\r\n  }\r\n  pen.anchors = anchors;\r\n}\r\n\r\n/**\r\n * 得到元素实际计算半径\r\n * @param node 元素\r\n * @returns 元素实际半径\r\n */\r\nfunction borderRadius(pen: Pen): number {\r\n  let wr = pen.calculative.borderRadius || 0;\r\n  let hr = pen.calculative.borderRadius || 0;\r\n  const { width, height } = pen;\r\n  if (pen.calculative.borderRadius < 1) {\r\n    wr = width * pen.calculative.borderRadius;\r\n    hr = height * pen.calculative.borderRadius;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  return r;\r\n}\r\n\r\n/**\r\n * 获取圆的 x 坐标\r\n * @param ox 圆心x\r\n * @param oy 圆心y\r\n * @param y y\r\n * @param r 半径\r\n * @param sqrt 点可能在左侧，左侧填-1，右侧1（默认值）\r\n */\r\nfunction getXByCircle(\r\n  ox: number,\r\n  oy: number,\r\n  y: number,\r\n  r: number,\r\n  sqrt: number = 1\r\n): number {\r\n  return sqrt * Math.sqrt(r ** 2 - (y - oy) ** 2) + ox;\r\n}\r\n\r\n/**\r\n * 获取圆的 y 坐标\r\n * @param ox 圆心x\r\n * @param oy 圆心y\r\n * @param y y\r\n * @param r 半径\r\n * @param sqrt 点可以在上侧，也可能在下侧，上侧-1，下侧1（默认）\r\n */\r\nfunction getYByCircle(\r\n  ox: number,\r\n  oy: number,\r\n  x: number,\r\n  r: number,\r\n  sqrt: number = 1\r\n): number {\r\n  return sqrt * Math.sqrt(r ** 2 - (x - ox) ** 2) + oy;\r\n}\r\n","import { Pen } from '../pen';\r\n\r\nexport function mindLine(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.moveTo(x, y + height);\r\n  path.lineTo(x + width, y + height);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function mindLineAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: index + '',\r\n      x,\r\n      y,\r\n      penId: pen.id,\r\n    };\r\n  });\r\n}\r\n","export * from './rectangle';\r\nexport * from './circle';\r\nexport * from './svgPath';\r\nexport * from './diamond';\r\nexport * from './triangle';\r\nexport * from './pentagon';\r\nexport * from './pentagram';\r\nexport * from './hexagon';\r\nexport * from './arrow';\r\nexport * from './message';\r\nexport * from './cloud';\r\nexport * from './file';\r\nexport * from './cube';\r\nexport * from './people';\r\nexport * from './line';\r\nexport * from './iframe';\r\nexport * from './video';\r\nexport * from './panel';\r\n\r\nimport { rectangle, square } from './rectangle';\r\nimport { circle } from './circle';\r\nimport { svgPath } from './svgPath';\r\nimport { diamond } from './diamond';\r\nimport { triangle, triangleAnchors } from './triangle';\r\nimport { pentagon, pentagonAnchors } from './pentagon';\r\nimport { pentagram, pentagramAnchors } from './pentagram';\r\nimport { hexagon } from './hexagon';\r\nimport { leftArrow, rightArrow, twowayArrow } from './arrow';\r\nimport { message } from './message';\r\nimport { cloud } from './cloud';\r\nimport { file } from './file';\r\n// import { cube } from './cube';\r\nimport { people } from './people';\r\nimport { line } from './line';\r\nimport { iframe } from './iframe';\r\nimport { video } from './video';\r\nimport { gif } from './gif';\r\nimport { mindNode, mindNodeAnchors } from './mindNode';\r\nimport { mindLine, mindLineAnchors } from './mindLine';\r\nimport { panel } from './panel';\r\n\r\nexport function commonPens() {\r\n  return {\r\n    rectangle,\r\n    square,\r\n    circle,\r\n    svgPath,\r\n    diamond,\r\n    triangle,\r\n    pentagon,\r\n    pentagram,\r\n    hexagon,\r\n    leftArrow,\r\n    rightArrow,\r\n    twowayArrow,\r\n    message,\r\n    cloud,\r\n    file,\r\n    people,\r\n    line,\r\n    iframe,\r\n    video,\r\n    gif,\r\n    mindNode,\r\n    mindLine,\r\n    mindNode2:rectangle,\r\n    panel,\r\n    combine:rectangle,\r\n  };\r\n}\r\n\r\nexport function commonAnchors() {\r\n  return {\r\n    triangle: triangleAnchors,\r\n    pentagon: pentagonAnchors,\r\n    pentagram: pentagramAnchors,\r\n    mindNode: mindNodeAnchors,\r\n    mindLine: mindLineAnchors,\r\n  };\r\n}\r\n","import { Meta2d } from '../core';\r\nimport { IValue, Pen } from '../pen';\r\nimport { Network } from '../store';\r\n\r\nexport type EventValue = string | IValue | undefined | null;\r\n// 事件行为\r\nexport type EventName =\r\n  | 'enter'\r\n  | 'leave'\r\n  | 'active'\r\n  | 'inactive'\r\n  | 'click'\r\n  | 'mousedown'\r\n  | 'mouseup'\r\n  | 'dblclick'\r\n  | 'valueUpdate'\r\n  | 'message'\r\n  | 'contextmenu'\r\n  | 'input'\r\n  | 'change';\r\n\r\nexport interface Event {\r\n  name: EventName;\r\n  action: EventAction; // 事件动作\r\n  where?: Where; // 若无条件，必须为 undefined or null，不可为空对象\r\n  value?: EventValue; // 不同 action 下，该值含义不同，例如：动画相关的，即为 节点 tag; Function 类型即为 字符串函数\r\n  params?: string;\r\n  extend?: any;\r\n  fn?: (\r\n    pen: Pen,\r\n    params: string,\r\n    context?: { meta2d: Meta2d; eventName: string }\r\n  ) => void;\r\n  targetType?: string;\r\n  network?: Network;\r\n  actions?: Event[];\r\n  conditions?: TriggerCondition[];\r\n  conditionType?: string;\r\n  message?: string; //消息名称\r\n  callback?: string; //回调函数 仅http\r\n  list?:{ \r\n    params?: string;\r\n    value?: EventValue; \r\n  }[] //多个图元对象\r\n  timeout?: number; //延时执行\r\n  confirm?: string; //确认提示\r\n  confirmTitle?: string; //确认提示标题\r\n}\r\n\r\nexport enum EventAction {\r\n  Link,\r\n  SetProps,\r\n  StartAnimate,\r\n  PauseAnimate,\r\n  StopAnimate,\r\n  JS, //Function\r\n  GlobalFn,\r\n  Emit,\r\n  StartVideo,\r\n  PauseVideo,\r\n  StopVideo,\r\n  SendPropData,\r\n  SendVarData,\r\n  Navigator,\r\n  Dialog,\r\n  SendData, //数据源选择\r\n  PostMessage, //发送场景数据\r\n  PostMessageToParent, //向父窗口发送消息\r\n  Message, //消息提示\r\n}\r\n\r\nexport interface Where {\r\n  type?: string | 'comparison';\r\n  key?: string;\r\n  comparison?: Comparison;\r\n  value?: unknown;\r\n  fn?: (\r\n    pen: Pen,\r\n    context?: {\r\n      meta2d: Meta2d;\r\n    }\r\n  ) => boolean;\r\n  fnJs?: string;\r\n}\r\n\r\n/**\r\n * 触发器中的符号\r\n */\r\nexport type Comparison =\r\n  | '='\r\n  | '=='\r\n  | '!='\r\n  | '>'\r\n  | '<'\r\n  | '>='\r\n  | '<='\r\n  | '[)' // 介于，数学中的开闭区间\r\n  | '![)' // 非介于，与上一个相反\r\n  /**\r\n   * 属于，类似于 数组的 includes\r\n   * .. 属于范围语法，30..50 等价于 介于的 [30, 50]\r\n   * [1, 2, 3]  2 // true  1.5 // false\r\n   * [1,20,30..50,65] 1 // true 20 // true 30 // true 30.1 // true\r\n   */\r\n  | '[]'\r\n  | '![]'; // 非属于，与上一个相反\r\n\r\nexport interface TriggerCondition {\r\n  type?: string; //'fn'|''\r\n  operator?: Comparison;\r\n  valueType?: string; //'prop'|''\r\n  value?: string;\r\n  target?: string;\r\n  label?: string;\r\n  fnJs?: string;\r\n  fn?: (\r\n    pen: Pen,\r\n    context?: {\r\n      meta2d: Meta2d;\r\n    }\r\n  ) => boolean;\r\n  key?: string;\r\n  source?:string;\r\n}\r\n\r\nexport interface Trigger {\r\n  name?: string;\r\n  conditionType?: string; //'and'/'or'\r\n  conditions?: TriggerCondition[];\r\n  actions?: Event[];\r\n  status?: Trigger[]; //所有状态\r\n}\r\n\r\nexport interface Bind {\r\n  case?: string;\r\n  id?: string;\r\n  label?: string;\r\n}\r\n\r\nexport interface RealTime {\r\n  label?: string;\r\n  key?: string;\r\n  type?: string;\r\n  keywords?: true;\r\n  triggers?: Trigger[];\r\n  bind?: Bind;\r\n  value?: string;\r\n  enableMock?: boolean;\r\n  mock?: any;\r\n  productId?: string;\r\n  deviceId?: string;\r\n  propertyId?: string;\r\n}\r\n","import { Canvas } from '../canvas';\r\nimport { calcRightBottom, getRect, translateRect } from '../rect';\r\n\r\nexport class ViewMap {\r\n  box: HTMLElement;\r\n  readonly boxWidth = 320;\r\n  readonly boxHeight = 180;\r\n  readonly ratio = this.boxWidth / this.boxHeight;\r\n  readonly padding = 5;\r\n  img: HTMLImageElement;\r\n  isShow: boolean;\r\n  isDown: boolean;\r\n  view: HTMLElement; // 可视区域外框\r\n  constructor(public parent: Canvas) {\r\n    this.box = document.createElement('div');\r\n    this.img = new Image();\r\n    this.view = document.createElement('div');\r\n\r\n    this.box.appendChild(this.img);\r\n    this.box.appendChild(this.view);\r\n    this.parent.externalElements?.parentElement.appendChild(this.box);\r\n\r\n    this.box.className = 'meta2d-map';\r\n    this.box.onmousedown = this.onMouseDown;\r\n    this.box.onmousemove = this.onMouseMove;\r\n    this.box.onmouseup = this.onMouseUp;\r\n    this.box.onwheel = this.onWheel;\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le/map') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/map';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        `.meta2d-map{display:flex;width:${\r\n          this.boxWidth + 2 * this.padding\r\n        }px;height:${this.boxHeight + 2 * this.padding}px;padding:${\r\n          this.padding\r\n        }px;background:#f4f4f4;border:1px solid #ffffff;box-shadow: 0px 0px 14px 0px rgba(0,10,38,0.30);border-radius:8px;position:absolute;z-index:9999;right:0;bottom:0;justify-content:center;align-items:center;cursor:default;user-select:none;overflow: hidden;}`\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-map img{max-width:100%;max-height:100%;pointer-events: none;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-map div{pointer-events: none;border:1px solid #1890ff;position:absolute}'\r\n      );\r\n    }\r\n  }\r\n\r\n  show() {\r\n    this.box.style.display = 'flex';\r\n\r\n    const data = this.parent.store.data;\r\n    if (data.pens.length) {\r\n      this.img.style.display = 'block';\r\n      this.img.src = this.parent.toPng();\r\n      this.setView();\r\n    } else {\r\n      this.img.style.display = 'none';\r\n    }\r\n    this.isShow = true;\r\n  }\r\n\r\n  hide() {\r\n    this.box.style.display = 'none';\r\n    this.isShow = false;\r\n  }\r\n\r\n  setView() {\r\n    const data = this.parent.store.data;\r\n    if (data.pens.length) {\r\n      let rect = getRect(data.pens);\r\n      const vW =\r\n        this.parent.store.data.width || this.parent.store.options.width;\r\n      const vH =\r\n        this.parent.store.data.height || this.parent.store.options.height;\r\n      if (vW && vH) {\r\n        //大屏\r\n        rect = {\r\n          x: this.parent.store.data.origin.x,\r\n          y: this.parent.store.data.origin.y,\r\n          width: vW * this.parent.store.data.scale,\r\n          height: vH * this.parent.store.data.scale,\r\n        };\r\n      }\r\n      // rect += data.x y 得到相对坐标\r\n      translateRect(rect, data.x, data.y);\r\n      const rectRatio = rect.width / rect.height;\r\n      if (rectRatio > this.ratio) {\r\n        // 上下留白，扩大高度\r\n        const height = rect.width / this.ratio;\r\n        rect.y -= (height - rect.height) / 2;\r\n        rect.height = height;\r\n        calcRightBottom(rect);\r\n      } else {\r\n        // 左右留白，扩大宽度\r\n        const width = rect.height * this.ratio;\r\n        rect.x -= (width - rect.width) / 2;\r\n        rect.width = width;\r\n        calcRightBottom(rect);\r\n      }\r\n      const canvasRect = this.parent.canvasRect;\r\n      let left = 0,\r\n        top = 0;\r\n      if (rect.x < 0) {\r\n        left = -rect.x / rect.width;\r\n      } else if (rect.x + rect.width > canvasRect.width) {\r\n        let space = 0;\r\n        if (canvasRect.width > rect.width) {\r\n          // 均已左上角为起点，这种场景需要剪掉一个留白\r\n          space = canvasRect.width - rect.width;\r\n        }\r\n        left = (-rect.x + space) / rect.width;\r\n      }\r\n\r\n      if (rect.y < 0) {\r\n        top = -rect.y / rect.height;\r\n      } else if (rect.y + rect.height > canvasRect.height) {\r\n        let space = 0;\r\n        if (canvasRect.height > rect.height) {\r\n          space = canvasRect.height - rect.height;\r\n        }\r\n        top = (-rect.y + space) / rect.height;\r\n      }\r\n\r\n      const width =\r\n        canvasRect.width > rect.width ? 1 : canvasRect.width / rect.width;\r\n      const height =\r\n        canvasRect.height > rect.height ? 1 : canvasRect.height / rect.height;\r\n      this.view.style.left = this.padding + left * this.boxWidth + 'px';\r\n      this.view.style.width = width * this.boxWidth + 'px';\r\n      this.view.style.top = this.padding + top * this.boxHeight + 'px';\r\n      this.view.style.height = height * this.boxHeight + 'px';\r\n    }\r\n  }\r\n\r\n  private onMouseDown = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.isDown = true;\r\n  };\r\n\r\n  private onMouseMove = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    if (this.isDown) {\r\n      try {\r\n        this.parent.gotoView(\r\n          e.offsetX / this.box.clientWidth,\r\n          e.offsetY / this.box.clientHeight\r\n        );\r\n      } catch (e) {\r\n        console.warn(e.message);\r\n        this.isDown = false;\r\n      }\r\n    }\r\n  };\r\n\r\n  private onMouseUp = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    try {\r\n      this.parent.gotoView(\r\n        e.offsetX / this.box.clientWidth,\r\n        e.offsetY / this.box.clientHeight\r\n      );\r\n    } catch (e) {\r\n      console.warn(e.message);\r\n    } finally {\r\n      this.isDown = false;\r\n    }\r\n  };\r\n\r\n  private onWheel = (e: WheelEvent) => {\r\n    //放大镜缩放\r\n    let scaleOff = 0.015;\r\n    if (this.parent.store.options.scaleOff) {\r\n      scaleOff = this.parent.store.options.scaleOff;\r\n      if (e.deltaY > 0) {\r\n        scaleOff = -this.parent.store.options.scaleOff;\r\n      }\r\n    } else {\r\n      let isMac = /mac os /i.test(navigator.userAgent);\r\n      if (isMac) {\r\n        if (!e.ctrlKey) {\r\n          scaleOff *= (e as any).wheelDeltaY / 240;\r\n        } else if (e.deltaY > 0) {\r\n          scaleOff *= -1;\r\n        }\r\n      } else {\r\n        let offset = 0.2;\r\n        if (e.deltaY.toString().indexOf('.') !== -1) {\r\n          offset = 0.01;\r\n        }\r\n        if (e.deltaY > 0) {\r\n          scaleOff = -offset;\r\n        } else {\r\n          scaleOff = offset;\r\n        }\r\n      }\r\n    }\r\n    let { offsetX: x, offsetY: y } = e;\r\n\r\n    const width =\r\n      this.parent.store.data.width || this.parent.store.options.width;\r\n    const height =\r\n      this.parent.store.data.height || this.parent.store.options.height;\r\n    if (width && height) {\r\n      //大屏\r\n      x =\r\n        (x / this.boxWidth) * width * this.parent.store.data.scale +\r\n        this.parent.store.data.origin.x +\r\n        this.parent.store.data.x;\r\n      y =\r\n        (y / this.boxHeight) * height * this.parent.store.data.scale +\r\n        this.parent.store.data.origin.y +\r\n        this.parent.store.data.y;\r\n    } else {\r\n      const rect = this.parent.parent.getRect();\r\n      x = (x / this.boxWidth) * rect.width + rect.x + this.parent.store.data.x;\r\n      y =\r\n        (y / this.boxHeight) * rect.height + rect.y + this.parent.store.data.y;\r\n    }\r\n    this.parent.scale(this.parent.store.data.scale + scaleOff, { x, y });\r\n  };\r\n}\r\n","!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this).mqtt=e()}}(function(){return function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var l=\"function\"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error(\"Cannot find module '\"+s+\"'\");throw u.code=\"MODULE_NOT_FOUND\",u}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){return i(t[s][1][e]||e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var o=\"function\"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(e,t,r){(function(r,n){(function(){\"use strict\";const i=e(\"events\").EventEmitter,o=e(\"./store\"),s=e(\"./topic-alias-recv\"),a=e(\"./topic-alias-send\"),l=e(\"mqtt-packet\"),u=e(\"./default-message-id-provider\"),c=e(\"readable-stream\").Writable,h=e(\"inherits\"),f=e(\"reinterval\"),p=e(\"rfdc/default\"),d=e(\"./validations\"),g=e(\"xtend\"),y=e(\"debug\")(\"mqttjs:client\"),b=r?r.nextTick:function(e){setTimeout(e,0)},m=n.setImmediate||function(e){b(e)},v={keepalive:60,reschedulePings:!0,protocolId:\"MQTT\",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},w={0:\"\",1:\"Unacceptable protocol version\",2:\"Identifier rejected\",3:\"Server unavailable\",4:\"Bad username or password\",5:\"Not authorized\",16:\"No matching subscribers\",17:\"No subscription existed\",128:\"Unspecified error\",129:\"Malformed Packet\",130:\"Protocol Error\",131:\"Implementation specific error\",132:\"Unsupported Protocol Version\",133:\"Client Identifier not valid\",134:\"Bad User Name or Password\",135:\"Not authorized\",136:\"Server unavailable\",137:\"Server busy\",138:\"Banned\",139:\"Server shutting down\",140:\"Bad authentication method\",141:\"Keep Alive timeout\",142:\"Session taken over\",143:\"Topic Filter invalid\",144:\"Topic Name invalid\",145:\"Packet identifier in use\",146:\"Packet Identifier not found\",147:\"Receive Maximum exceeded\",148:\"Topic Alias invalid\",149:\"Packet too large\",150:\"Message rate too high\",151:\"Quota exceeded\",152:\"Administrative action\",153:\"Payload format invalid\",154:\"Retain not supported\",155:\"QoS not supported\",156:\"Use another server\",157:\"Server moved\",158:\"Shared Subscriptions not supported\",159:\"Connection rate exceeded\",160:\"Maximum connect time\",161:\"Subscription Identifiers not supported\",162:\"Wildcard Subscriptions not supported\"};function _(e,t){let r;t.properties&&(r=t.properties.topicAlias);let n=t.topic.toString();if(0===n.length){if(void 0===r)return new Error(\"Unregistered Topic Alias\");if(void 0===(n=e.topicAliasSend.getTopicByAlias(r)))return new Error(\"Unregistered Topic Alias\");t.topic=n}r&&delete t.properties.topicAlias}function k(e,t,r){y(\"sendPacket :: packet: %O\",t),y(\"sendPacket :: emitting `packetsend`\"),e.emit(\"packetsend\",t),y(\"sendPacket :: writing to stream\");const n=l.writeToStream(t,e.stream,e.options);y(\"sendPacket :: writeToStream result %s\",n),!n&&r&&r!==E?(y(\"sendPacket :: handle events on `drain` once through callback.\"),e.stream.once(\"drain\",r)):r&&(y(\"sendPacket :: invoking cb\"),r())}function S(e,t,r,n){y(\"storeAndSend :: store packet with cmd %s to outgoingStore\",t.cmd);let i,o=t;if(\"publish\"===o.cmd&&(o=p(t),i=_(e,o)))return r&&r(i);e.outgoingStore.put(o,function(i){if(i)return r&&r(i);n(),k(e,t,r)})}function E(e){y(\"nop ::\",e)}function C(e,t){let r;const n=this;if(!(this instanceof C))return new C(e,t);for(r in this.options=t||{},v)void 0===this.options[r]?this.options[r]=v[r]:this.options[r]=t[r];y(\"MqttClient :: options.protocol\",t.protocol),y(\"MqttClient :: options.protocolVersion\",t.protocolVersion),y(\"MqttClient :: options.username\",t.username),y(\"MqttClient :: options.keepalive\",t.keepalive),y(\"MqttClient :: options.reconnectPeriod\",t.reconnectPeriod),y(\"MqttClient :: options.rejectUnauthorized\",t.rejectUnauthorized),y(\"MqttClient :: options.topicAliasMaximum\",t.topicAliasMaximum),this.options.clientId=\"string\"==typeof t.clientId?t.clientId:\"mqttjs_\"+Math.random().toString(16).substr(2,8),y(\"MqttClient :: clientId\",this.options.clientId),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.messageIdProvider=void 0===this.options.messageIdProvider?new u:this.options.messageIdProvider,this.outgoingStore=t.outgoingStore||new o,this.incomingStore=t.incomingStore||new o,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,t.topicAliasMaximum>0&&(t.topicAliasMaximum>65535?y(\"MqttClient :: options.topicAliasMaximum is out of range\"):this.topicAliasRecv=new s(t.topicAliasMaximum)),this.on(\"connect\",function(){const e=this.queue;y(\"connect :: sending queued packets\"),function t(){const r=e.shift();y(\"deliver :: entry %o\",r);let i=null;if(!r)return void n._resubscribe();i=r.packet,y(\"deliver :: call _sendPacket for %o\",i);let o=!0;i.messageId&&0!==i.messageId&&(n.messageIdProvider.register(i.messageId)||(o=!1)),o?n._sendPacket(i,function(e){r.cb&&r.cb(e),t()}):(y(\"messageId: %d has already used. The message is skipped and removed.\",i.messageId),t())}()}),this.on(\"close\",function(){y(\"close :: connected set to `false`\"),this.connected=!1,y(\"close :: clearing connackTimer\"),clearTimeout(this.connackTimer),y(\"close :: clearing ping timer\"),null!==n.pingTimer&&(n.pingTimer.clear(),n.pingTimer=null),this.topicAliasRecv&&this.topicAliasRecv.clear(),y(\"close :: calling _setupReconnect\"),this._setupReconnect()}),i.call(this),y(\"MqttClient :: setting up stream\"),this._setupStream()}h(C,i),C.prototype._setupStream=function(){const e=this,t=new c,r=l.parser(this.options);let n=null;const i=[];function o(){if(i.length)b(s);else{const e=n;n=null,e()}}function s(){y(\"work :: getting next packet in queue\");const t=i.shift();if(t)y(\"work :: packet pulled from queue\"),e._handlePacket(t,o);else{y(\"work :: no packets in queue\");const e=n;n=null,y(\"work :: done flag is %s\",!!e),e&&e()}}y(\"_setupStream :: calling method to clear reconnect\"),this._clearReconnect(),y(\"_setupStream :: using streamBuilder provided to client to create stream\"),this.stream=this.streamBuilder(this),r.on(\"packet\",function(e){y(\"parser :: on packet push to packets array.\"),i.push(e)}),t._write=function(e,t,i){n=i,y(\"writable stream :: parsing buffer\"),r.parse(e),s()},y(\"_setupStream :: pipe stream to writable stream\"),this.stream.pipe(t),this.stream.on(\"error\",function(t){y(\"streamErrorHandler :: error\",t.message),t.code?(y(\"streamErrorHandler :: emitting error\"),e.emit(\"error\",t)):E(t)}),this.stream.on(\"close\",function(){var t;y(\"(%s)stream :: on close\",e.options.clientId),(t=e.outgoing)&&(y(\"flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function\"),Object.keys(t).forEach(function(e){t[e].volatile&&\"function\"==typeof t[e].cb&&(t[e].cb(new Error(\"Connection closed\")),delete t[e])})),y(\"stream: emit close to MqttClient\"),e.emit(\"close\")}),y(\"_setupStream: sending packet `connect`\");const a=Object.create(this.options);if(a.cmd=\"connect\",this.topicAliasRecv&&(a.properties||(a.properties={}),this.topicAliasRecv&&(a.properties.topicAliasMaximum=this.topicAliasRecv.max)),k(this,a),r.on(\"error\",this.emit.bind(this,\"error\")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return e.end(()=>this.emit(\"error\",new Error(\"Packet has no Authentication Method\"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&\"object\"==typeof this.options.authPacket){k(this,g({cmd:\"auth\",reasonCode:0},this.options.authPacket))}}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){y(\"!!connectTimeout hit!! Calling _cleanUp with force `true`\"),e._cleanUp(!0)},this.options.connectTimeout)},C.prototype._handlePacket=function(e,t){const r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<e.length)return this.emit(\"error\",new Error(\"exceeding packets size \"+e.cmd)),this.end({reasonCode:149,properties:{reasonString:\"Maximum packet size was exceeded\"}}),this;switch(y(\"_handlePacket :: emitting packetreceive\"),this.emit(\"packetreceive\",e),e.cmd){case\"publish\":this._handlePublish(e,t);break;case\"puback\":case\"pubrec\":case\"pubcomp\":case\"suback\":case\"unsuback\":this._handleAck(e),t();break;case\"pubrel\":this._handlePubrel(e,t);break;case\"connack\":this._handleConnack(e),t();break;case\"auth\":this._handleAuth(e),t();break;case\"pingresp\":this._handlePingresp(e),t();break;case\"disconnect\":this._handleDisconnect(e),t()}},C.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e&&e!==E?e(new Error(\"client disconnecting\")):this.emit(\"error\",new Error(\"client disconnecting\"))),this.disconnecting},C.prototype.publish=function(e,t,r,n){y(\"publish :: message `%s` to topic `%s`\",t,e);const i=this.options;\"function\"==typeof r&&(n=r,r=null);if(r=g({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;const o=this,s=function(){let s=0;if((1===r.qos||2===r.qos)&&null===(s=o._nextId()))return y(\"No messageId left\"),!1;const a={cmd:\"publish\",topic:e,payload:t,qos:r.qos,retain:r.retain,messageId:s,dup:r.dup};switch(5===i.protocolVersion&&(a.properties=r.properties),y(\"publish :: qos\",r.qos),r.qos){case 1:case 2:o.outgoing[a.messageId]={volatile:!1,cb:n||E},y(\"MqttClient:publish: packet cmd: %s\",a.cmd),o._sendPacket(a,void 0,r.cbStorePut);break;default:y(\"MqttClient:publish: packet cmd: %s\",a.cmd),o._sendPacket(a,n,r.cbStorePut)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!s())&&this._storeProcessingQueue.push({invoke:s,cbStorePut:r.cbStorePut,callback:n}),this},C.prototype.subscribe=function(){const e=this,t=new Array(arguments.length);for(let e=0;e<arguments.length;e++)t[e]=arguments[e];const r=[];let n=t.shift();const i=n.resubscribe;let o=t.pop()||E,s=t.pop();const a=this.options.protocolVersion;delete n.resubscribe,\"string\"==typeof n&&(n=[n]),\"function\"!=typeof o&&(s=o,o=E);const l=d.validateTopics(n);if(null!==l)return m(o,new Error(\"Invalid topic \"+l)),this;if(this._checkDisconnecting(o))return y(\"subscribe: discconecting true\"),this;const u={qos:0};if(5===a&&(u.nl=!1,u.rap=!1,u.rh=0),s=g(u,s),Array.isArray(n)?n.forEach(function(t){if(y(\"subscribe: array topic %s\",t),!Object.prototype.hasOwnProperty.call(e._resubscribeTopics,t)||e._resubscribeTopics[t].qos<s.qos||i){const e={topic:t,qos:s.qos};5===a&&(e.nl=s.nl,e.rap=s.rap,e.rh=s.rh,e.properties=s.properties),y(\"subscribe: pushing topic `%s` and qos `%s` to subs list\",e.topic,e.qos),r.push(e)}}):Object.keys(n).forEach(function(t){if(y(\"subscribe: object topic %s\",t),!Object.prototype.hasOwnProperty.call(e._resubscribeTopics,t)||e._resubscribeTopics[t].qos<n[t].qos||i){const e={topic:t,qos:n[t].qos};5===a&&(e.nl=n[t].nl,e.rap=n[t].rap,e.rh=n[t].rh,e.properties=s.properties),y(\"subscribe: pushing `%s` to subs list\",e),r.push(e)}}),!r.length)return o(null,[]),this;const c=function(){const t=e._nextId();if(null===t)return y(\"No messageId left\"),!1;const n={cmd:\"subscribe\",subscriptions:r,qos:1,retain:!1,dup:!1,messageId:t};if(s.properties&&(n.properties=s.properties),e.options.resubscribe){y(\"subscribe :: resubscribe true\");const t=[];r.forEach(function(r){if(e.options.reconnectPeriod>0){const n={qos:r.qos};5===a&&(n.nl=r.nl||!1,n.rap=r.rap||!1,n.rh=r.rh||0,n.properties=r.properties),e._resubscribeTopics[r.topic]=n,t.push(r.topic)}}),e.messageIdToTopic[n.messageId]=t}return e.outgoing[n.messageId]={volatile:!0,cb:function(e,t){if(!e){const e=t.granted;for(let t=0;t<e.length;t+=1)r[t].qos=e[t]}o(e,r)}},y(\"subscribe :: call _sendPacket\"),e._sendPacket(n),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!c())&&this._storeProcessingQueue.push({invoke:c,callback:o}),this},C.prototype.unsubscribe=function(){const e=this,t=new Array(arguments.length);for(let e=0;e<arguments.length;e++)t[e]=arguments[e];let r=t.shift(),n=t.pop()||E,i=t.pop();\"string\"==typeof r&&(r=[r]),\"function\"!=typeof n&&(i=n,n=E);const o=d.validateTopics(r);if(null!==o)return m(n,new Error(\"Invalid topic \"+o)),this;if(e._checkDisconnecting(n))return this;const s=function(){const t=e._nextId();if(null===t)return y(\"No messageId left\"),!1;const o={cmd:\"unsubscribe\",qos:1,messageId:t};return\"string\"==typeof r?o.unsubscriptions=[r]:Array.isArray(r)&&(o.unsubscriptions=r),e.options.resubscribe&&o.unsubscriptions.forEach(function(t){delete e._resubscribeTopics[t]}),\"object\"==typeof i&&i.properties&&(o.properties=i.properties),e.outgoing[o.messageId]={volatile:!0,cb:n},y(\"unsubscribe: call _sendPacket\"),e._sendPacket(o),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!s())&&this._storeProcessingQueue.push({invoke:s,callback:n}),this},C.prototype.end=function(e,t,r){const n=this;function i(){y(\"end :: (%s) :: finish :: calling _cleanUp with force %s\",n.options.clientId,e),n._cleanUp(e,()=>{y(\"end :: finish :: calling process.nextTick on closeStores\"),b(function(){y(\"end :: closeStores: closing incoming and outgoing stores\"),n.disconnected=!0,n.incomingStore.close(function(e){n.outgoingStore.close(function(t){if(y(\"end :: closeStores: emitting end\"),n.emit(\"end\"),r){const n=e||t;y(\"end :: closeStores: invoking callback with args\"),r(n)}})}),n._deferredReconnect&&n._deferredReconnect()}.bind(n))},t)}return y(\"end :: (%s)\",this.options.clientId),null!=e&&\"boolean\"==typeof e||(r=t||E,t=e,e=!1,\"object\"!=typeof t&&(r=t,t=null,\"function\"!=typeof r&&(r=E))),\"object\"!=typeof t&&(r=t,t=null),y(\"end :: cb? %s\",!!r),r=r||E,this.disconnecting?(r(),this):(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?(y(\"end :: (%s) :: calling finish in 10ms once outgoing is empty\",n.options.clientId),this.once(\"outgoingEmpty\",setTimeout.bind(null,i,10))):(y(\"end :: (%s) :: immediately calling finish\",n.options.clientId),i()),this)},C.prototype.removeOutgoingMessage=function(e){const t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},function(){t(new Error(\"Message removed\"))}),this},C.prototype.reconnect=function(e){y(\"client reconnect\");const t=this,r=function(){e?(t.options.incomingStore=e.incomingStore,t.options.outgoingStore=e.outgoingStore):(t.options.incomingStore=null,t.options.outgoingStore=null),t.incomingStore=t.options.incomingStore||new o,t.outgoingStore=t.options.outgoingStore||new o,t.disconnecting=!1,t.disconnected=!1,t._deferredReconnect=null,t._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},C.prototype._reconnect=function(){y(\"_reconnect: emitting reconnect to client\"),this.emit(\"reconnect\"),this.connected?(this.end(()=>{this._setupStream()}),y(\"client already connected. disconnecting first.\")):(y(\"_reconnect: calling _setupStream\"),this._setupStream())},C.prototype._setupReconnect=function(){const e=this;!e.disconnecting&&!e.reconnectTimer&&e.options.reconnectPeriod>0?(this.reconnecting||(y(\"_setupReconnect :: emit `offline` state\"),this.emit(\"offline\"),y(\"_setupReconnect :: set `reconnecting` to `true`\"),this.reconnecting=!0),y(\"_setupReconnect :: setting reconnectTimer for %d ms\",e.options.reconnectPeriod),e.reconnectTimer=setInterval(function(){y(\"reconnectTimer :: reconnect triggered!\"),e._reconnect()},e.options.reconnectPeriod)):y(\"_setupReconnect :: doing nothing...\")},C.prototype._clearReconnect=function(){y(\"_clearReconnect : clearing reconnect timer\"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},C.prototype._cleanUp=function(e,t){const r=arguments[2];if(t&&(y(\"_cleanUp :: done callback provided for on stream close\"),this.stream.on(\"close\",t)),y(\"_cleanUp :: forced? %s\",e),e)0===this.options.reconnectPeriod&&this.options.clean&&(n=this.outgoing)&&(y(\"flush: queue exists? %b\",!!n),Object.keys(n).forEach(function(e){\"function\"==typeof n[e].cb&&(n[e].cb(new Error(\"Connection closed\")),delete n[e])})),y(\"_cleanUp :: (%s) :: destroying stream\",this.options.clientId),this.stream.destroy();else{const e=g({cmd:\"disconnect\"},r);y(\"_cleanUp :: (%s) :: call _sendPacket with disconnect packet\",this.options.clientId),this._sendPacket(e,m.bind(null,this.stream.end.bind(this.stream)))}var n;this.disconnecting||(y(\"_cleanUp :: client not disconnecting. Clearing and resetting reconnect.\"),this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(y(\"_cleanUp :: clearing pingTimer\"),this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(y(\"_cleanUp :: (%s) :: removing stream `done` callback `close` listener\",this.options.clientId),this.stream.removeListener(\"close\",t),t())},C.prototype._sendPacket=function(e,t,r){y(\"_sendPacket :: (%s) ::  start\",this.options.clientId),r=r||E,t=t||E;const n=function(e,t){if(5===e.options.protocolVersion&&\"publish\"===t.cmd){let r;t.properties&&(r=t.properties.topicAlias);const n=t.topic.toString();if(e.topicAliasSend)if(r){if(0!==n.length&&(y(\"applyTopicAlias :: register topic: %s - alias: %d\",n,r),!e.topicAliasSend.put(n,r)))return y(\"applyTopicAlias :: error out of range. topic: %s - alias: %d\",n,r),new Error(\"Sending Topic Alias out of range\")}else 0!==n.length&&(e.options.autoAssignTopicAlias?(r=e.topicAliasSend.getAliasByTopic(n))?(t.topic=\"\",t.properties={...t.properties,topicAlias:r},y(\"applyTopicAlias :: auto assign(use) topic: %s - alias: %d\",n,r)):(r=e.topicAliasSend.getLruAlias(),e.topicAliasSend.put(n,r),t.properties={...t.properties,topicAlias:r},y(\"applyTopicAlias :: auto assign topic: %s - alias: %d\",n,r)):e.options.autoUseTopicAlias&&(r=e.topicAliasSend.getAliasByTopic(n))&&(t.topic=\"\",t.properties={...t.properties,topicAlias:r},y(\"applyTopicAlias :: auto use topic: %s - alias: %d\",n,r)));else if(r)return y(\"applyTopicAlias :: error out of range. topic: %s - alias: %d\",n,r),new Error(\"Sending Topic Alias out of range\")}}(this,e);if(n)t(n);else{if(!this.connected)return\"auth\"===e.cmd?(this._shiftPingInterval(),void k(this,e,t)):(y(\"_sendPacket :: client not connected. Storing packet offline.\"),void this._storePacket(e,t,r));switch(this._shiftPingInterval(),e.cmd){case\"publish\":break;case\"pubrel\":return void S(this,e,t,r);default:return void k(this,e,t)}switch(e.qos){case 2:case 1:S(this,e,t,r);break;case 0:default:k(this,e,t)}y(\"_sendPacket :: (%s) ::  end\",this.options.clientId)}},C.prototype._storePacket=function(e,t,r){y(\"_storePacket :: packet: %o\",e),y(\"_storePacket :: cb? %s\",!!t),r=r||E;let n=e;if(\"publish\"===n.cmd){const r=_(this,n=p(e));if(r)return t&&t(r)}0===(n.qos||0)&&this.queueQoSZero||\"publish\"!==n.cmd?this.queue.push({packet:n,cb:t}):n.qos>0?(t=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,function(e){if(e)return t&&t(e);r()})):t&&t(new Error(\"No connection to broker\"))},C.prototype._setupPingTimer=function(){y(\"_setupPingTimer :: keepalive %d (seconds)\",this.options.keepalive);const e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=f(function(){e._checkPing()},1e3*this.options.keepalive))},C.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},C.prototype._checkPing=function(){y(\"_checkPing :: checking ping...\"),this.pingResp?(y(\"_checkPing :: ping response received. Clearing flag and sending `pingreq`\"),this.pingResp=!1,this._sendPacket({cmd:\"pingreq\"})):(y(\"_checkPing :: calling _cleanUp with force true\"),this._cleanUp(!0))},C.prototype._handlePingresp=function(){this.pingResp=!0},C.prototype._handleConnack=function(e){y(\"_handleConnack\");const t=this.options,r=5===t.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(this.connackTimer),delete this.topicAliasSend,e.properties){if(e.properties.topicAliasMaximum){if(e.properties.topicAliasMaximum>65535)return void this.emit(\"error\",new Error(\"topicAliasMaximum from broker is out of range\"));e.properties.topicAliasMaximum>0&&(this.topicAliasSend=new a(e.properties.topicAliasMaximum))}e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize)}if(0===r)this.reconnecting=!1,this._onConnect(e);else if(r>0){const e=new Error(\"Connection refused: \"+w[r]);e.code=r,this.emit(\"error\",e)}},C.prototype._handleAuth=function(e){const t=this.options.protocolVersion,r=5===t?e.reasonCode:e.returnCode;if(5!==t){const e=new Error(\"Protocol error: Auth packets are only supported in MQTT 5. Your version:\"+t);return e.code=r,void this.emit(\"error\",e)}const n=this;this.handleAuth(e,function(e,t){if(e)n.emit(\"error\",e);else if(24===r)n.reconnecting=!1,n._sendPacket(t);else{const t=new Error(\"Connection refused: \"+w[r]);e.code=r,n.emit(\"error\",t)}})},C.prototype.handleAuth=function(e,t){t()},C.prototype._handlePublish=function(e,t){y(\"_handlePublish: packet %o\",e),t=void 0!==t?t:E;let r=e.topic.toString();const n=e.payload,i=e.qos,o=e.messageId,s=this,a=this.options,l=[0,16,128,131,135,144,145,151,153];if(5===this.options.protocolVersion){let t;if(e.properties&&(t=e.properties.topicAlias),void 0!==t)if(0===r.length){if(!(t>0&&t<=65535))return y(\"_handlePublish :: topic alias out of range. alias: %d\",t),void this.emit(\"error\",new Error(\"Received Topic Alias is out of range\"));{const e=this.topicAliasRecv.getTopicByAlias(t);if(!e)return y(\"_handlePublish :: unregistered topic alias. alias: %d\",t),void this.emit(\"error\",new Error(\"Received unregistered Topic Alias\"));y(\"_handlePublish :: topic complemented by alias. topic: %s - alias: %d\",r=e,t)}}else{if(!this.topicAliasRecv.put(r,t))return y(\"_handlePublish :: topic alias out of range. alias: %d\",t),void this.emit(\"error\",new Error(\"Received Topic Alias is out of range\"));y(\"_handlePublish :: registered topic: %s - alias: %d\",r,t)}}switch(y(\"_handlePublish: qos %d\",i),i){case 2:a.customHandleAcks(r,n,e,function(r,n){return r instanceof Error||(n=r,r=null),r?s.emit(\"error\",r):-1===l.indexOf(n)?s.emit(\"error\",new Error(\"Wrong reason code for pubrec\")):void(n?s._sendPacket({cmd:\"pubrec\",messageId:o,reasonCode:n},t):s.incomingStore.put(e,function(){s._sendPacket({cmd:\"pubrec\",messageId:o},t)}))});break;case 1:a.customHandleAcks(r,n,e,function(i,a){return i instanceof Error||(a=i,i=null),i?s.emit(\"error\",i):-1===l.indexOf(a)?s.emit(\"error\",new Error(\"Wrong reason code for puback\")):(a||s.emit(\"message\",r,n,e),void s.handleMessage(e,function(e){if(e)return t&&t(e);s._sendPacket({cmd:\"puback\",messageId:o,reasonCode:a},t)}))});break;case 0:this.emit(\"message\",r,n,e),this.handleMessage(e,t);break;default:y(\"_handlePublish: unknown QoS. Doing nothing.\")}},C.prototype.handleMessage=function(e,t){t()},C.prototype._handleAck=function(e){const t=e.messageId,r=e.cmd;let n=null;const i=this.outgoing[t]?this.outgoing[t].cb:null,o=this;let s;if(i){switch(y(\"_handleAck :: packet type\",r),r){case\"pubcomp\":case\"puback\":{const r=e.reasonCode;r&&r>0&&16!==r&&((s=new Error(\"Publish error: \"+w[r])).code=r,i(s,e)),delete this.outgoing[t],this.outgoingStore.del(e,i),this.messageIdProvider.deallocate(t),this._invokeStoreProcessingQueue();break}case\"pubrec\":{n={cmd:\"pubrel\",qos:2,messageId:t};const r=e.reasonCode;r&&r>0&&16!==r?((s=new Error(\"Publish error: \"+w[r])).code=r,i(s,e)):this._sendPacket(n);break}case\"suback\":delete this.outgoing[t],this.messageIdProvider.deallocate(t);for(let r=0;r<e.granted.length;r++)if(0!=(128&e.granted[r])){const e=this.messageIdToTopic[t];e&&e.forEach(function(e){delete o._resubscribeTopics[e]})}this._invokeStoreProcessingQueue(),i(null,e);break;case\"unsuback\":delete this.outgoing[t],this.messageIdProvider.deallocate(t),this._invokeStoreProcessingQueue(),i(null);break;default:o.emit(\"error\",new Error(\"unrecognized packet type\"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit(\"outgoingEmpty\")}else y(\"_handleAck :: Server sent an ack in error. Ignoring.\")},C.prototype._handlePubrel=function(e,t){y(\"handling pubrel packet\"),t=void 0!==t?t:E;const r=this,n={cmd:\"pubcomp\",messageId:e.messageId};r.incomingStore.get(e,function(e,i){e?r._sendPacket(n,t):(r.emit(\"message\",i.topic,i.payload,i),r.handleMessage(i,function(e){if(e)return t(e);r.incomingStore.del(i,E),r._sendPacket(n,t)}))})},C.prototype._handleDisconnect=function(e){this.emit(\"disconnect\",e)},C.prototype._nextId=function(){return this.messageIdProvider.allocate()},C.prototype.getLastMessageId=function(){return this.messageIdProvider.getLastAllocated()},C.prototype._resubscribe=function(){y(\"_resubscribe\");const e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!this.connackPacket.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion){y(\"_resubscribe: protocolVersion 5\");for(let t=0;t<e.length;t++){const r={};r[e[t]]=this._resubscribeTopics[e[t]],r.resubscribe=!0,this.subscribe(r,{properties:r[e[t]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},C.prototype._onConnect=function(e){if(this.disconnected)return void this.emit(\"connect\",e);const t=this;this.connackPacket=e,this.messageIdProvider.clear(),this._setupPingTimer(),this.connected=!0,function r(){let n=t.outgoingStore.createStream();function i(){t._storeProcessing=!1,t._packetIdsDuringStoreProcessing={}}function o(){n.destroy(),n=null,t._flushStoreProcessingQueue(),i()}t.once(\"close\",o),n.on(\"error\",function(e){i(),t._flushStoreProcessingQueue(),t.removeListener(\"close\",o),t.emit(\"error\",e)}),n.on(\"end\",function(){let n=!0;for(const e in t._packetIdsDuringStoreProcessing)if(!t._packetIdsDuringStoreProcessing[e]){n=!1;break}n?(i(),t.removeListener(\"close\",o),t._invokeAllStoreProcessingQueue(),t.emit(\"connect\",e)):r()}),function e(){if(!n)return;t._storeProcessing=!0;const r=n.read(1);let i;r?t._packetIdsDuringStoreProcessing[r.messageId]?e():t.disconnecting||t.reconnectTimer?n.destroy&&n.destroy():(i=t.outgoing[r.messageId]?t.outgoing[r.messageId].cb:null,t.outgoing[r.messageId]={volatile:!1,cb:function(t,r){i&&i(t,r),e()}},t._packetIdsDuringStoreProcessing[r.messageId]=!0,t.messageIdProvider.register(r.messageId)?t._sendPacket(r):y(\"messageId: %d has already used.\",r.messageId)):n.once(\"readable\",e)}()}()},C.prototype._invokeStoreProcessingQueue=function(){if(this._storeProcessingQueue.length>0){const e=this._storeProcessingQueue[0];if(e&&e.invoke())return this._storeProcessingQueue.shift(),!0}return!1},C.prototype._invokeAllStoreProcessingQueue=function(){for(;this._invokeStoreProcessingQueue(););},C.prototype._flushStoreProcessingQueue=function(){for(const e of this._storeProcessingQueue)e.cbStorePut&&e.cbStorePut(new Error(\"Connection closed\")),e.callback&&e.callback(new Error(\"Connection closed\"));this._storeProcessingQueue.splice(0)},t.exports=C}).call(this)}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./default-message-id-provider\":7,\"./store\":8,\"./topic-alias-recv\":9,\"./topic-alias-send\":10,\"./validations\":11,_process:50,debug:18,events:22,inherits:24,\"mqtt-packet\":40,\"readable-stream\":69,reinterval:70,\"rfdc/default\":71,xtend:81}],2:[function(e,t,r){\"use strict\";const{Buffer:n}=e(\"buffer\"),i=e(\"readable-stream\").Transform,o=e(\"duplexify\");let s,a,l,u=!1;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error(\"Could not determine host. Specify host manually.\");const r=\"MQIsdp\"===t.protocolId&&3===t.protocolVersion?\"mqttv3.1\":\"mqtt\";!function(e){e.hostname||(e.hostname=\"localhost\"),e.path||(e.path=\"/\"),e.wsOptions||(e.wsOptions={})}(t);const c=function(e,t){const r=\"alis\"===e.protocol?\"wss\":\"ws\";let n=r+\"://\"+e.hostname+e.path;return e.port&&80!==e.port&&443!==e.port&&(n=r+\"://\"+e.hostname+\":\"+e.port+e.path),\"function\"==typeof e.transformWsUrl&&(n=e.transformWsUrl(n,e,t)),n}(t,e);return(s=t.my).connectSocket({url:c,protocols:r}),a=function(){const e=new i;return e._write=function(e,t,r){s.sendSocketMessage({data:e.buffer,success:function(){r()},fail:function(){r(new Error)}})},e._flush=function(e){s.closeSocket({success:function(){e()}})},e}(),l=o.obj(),u||(u=!0,s.onSocketOpen(function(){l.setReadable(a),l.setWritable(a),l.emit(\"connect\")}),s.onSocketMessage(function(e){if(\"string\"==typeof e.data){const t=n.from(e.data,\"base64\");a.push(t)}else{const t=new FileReader;t.addEventListener(\"load\",function(){let e=t.result;e=e instanceof ArrayBuffer?n.from(e):n.from(e,\"utf8\"),a.push(e)}),t.readAsArrayBuffer(e.data)}}),s.onSocketClose(function(){l.end(),l.destroy()}),s.onSocketError(function(e){l.destroy(e)})),l}},{buffer:17,duplexify:20,\"readable-stream\":69}],3:[function(e,t,r){\"use strict\";const n=e(\"net\"),i=e(\"debug\")(\"mqttjs:tcp\");t.exports=function(e,t){t.port=t.port||1883,t.hostname=t.hostname||t.host||\"localhost\";const r=t.port,o=t.hostname;return i(\"port %d and host %s\",r,o),n.createConnection(r,o)}},{debug:18,net:16}],4:[function(e,t,r){\"use strict\";const n=e(\"tls\"),i=e(\"net\"),o=e(\"debug\")(\"mqttjs:tls\");t.exports=function(e,t){t.port=t.port||8883,t.host=t.hostname||t.host||\"localhost\",0===i.isIP(t.host)&&(t.servername=t.host),t.rejectUnauthorized=!1!==t.rejectUnauthorized,delete t.path,o(\"port %d host %s rejectUnauthorized %b\",t.port,t.host,t.rejectUnauthorized);const r=n.connect(t);function s(n){t.rejectUnauthorized&&e.emit(\"error\",n),r.end()}return r.on(\"secureConnect\",function(){t.rejectUnauthorized&&!r.authorized?r.emit(\"error\",new Error(\"TLS not authorized\")):r.removeListener(\"error\",s)}),r.on(\"error\",s),r}},{debug:18,net:16,tls:16}],5:[function(e,t,r){(function(r){(function(){\"use strict\";const{Buffer:n}=e(\"buffer\"),i=e(\"ws\"),o=e(\"debug\")(\"mqttjs:ws\"),s=e(\"duplexify\"),a=e(\"readable-stream\").Transform,l=[\"rejectUnauthorized\",\"ca\",\"cert\",\"key\",\"pfx\",\"passphrase\"],u=void 0!==r&&\"browser\"===r.title||\"function\"==typeof __webpack_require__;function c(e,t){let r=e.protocol+\"://\"+e.hostname+\":\"+e.port+e.path;return\"function\"==typeof e.transformWsUrl&&(r=e.transformWsUrl(r,e,t)),r}function h(e){const t=e;return e.hostname||(t.hostname=\"localhost\"),e.port||(\"wss\"===e.protocol?t.port=443:t.port=80),e.path||(t.path=\"/\"),e.wsOptions||(t.wsOptions={}),u||\"wss\"!==e.protocol||l.forEach(function(r){Object.prototype.hasOwnProperty.call(e,r)&&!Object.prototype.hasOwnProperty.call(e.wsOptions,r)&&(t.wsOptions[r]=e[r])}),t}t.exports=u?function(e,t){let r;o(\"browserStreamBuilder\");const i=function(e){const t=h(e);if(t.hostname||(t.hostname=t.host),!t.hostname){if(\"undefined\"==typeof document)throw new Error(\"Could not determine host. Specify host manually.\");const e=new URL(document.URL);t.hostname=e.hostname,t.port||(t.port=e.port)}return void 0===t.objectMode&&(t.objectMode=!(!0===t.binary||void 0===t.binary)),t}(t).browserBufferSize||524288,l=t.browserBufferTimeout||1e3,u=!t.objectMode,f=function(e,t){const r=\"MQIsdp\"===t.protocolId&&3===t.protocolVersion?\"mqttv3.1\":\"mqtt\",n=c(t,e),i=new WebSocket(n,[r]);return i.binaryType=\"arraybuffer\",i}(e,t),p=function(e,t,r){const n=new a({objectModeMode:e.objectMode});return n._write=t,n._flush=r,n}(t,function e(t,r,o){f.bufferedAmount>i&&setTimeout(e,l,t,r,o),u&&\"string\"==typeof t&&(t=n.from(t,\"utf8\"));try{f.send(t)}catch(e){return o(e)}o()},function(e){f.close(),e()});t.objectMode||(p._writev=v),p.on(\"close\",()=>{f.close()});const d=void 0!==f.addEventListener;function g(){r.setReadable(p),r.setWritable(p),r.emit(\"connect\")}function y(){r.end(),r.destroy()}function b(e){r.destroy(e)}function m(e){let t=e.data;t=t instanceof ArrayBuffer?n.from(t):n.from(t,\"utf8\"),p.push(t)}function v(e,t){const r=new Array(e.length);for(let t=0;t<e.length;t++)\"string\"==typeof e[t].chunk?r[t]=n.from(e[t],\"utf8\"):r[t]=e[t].chunk;this._write(n.concat(r),\"binary\",t)}return f.readyState===f.OPEN?r=p:(r=r=s(void 0,void 0,t),t.objectMode||(r._writev=v),d?f.addEventListener(\"open\",g):f.onopen=g),r.socket=f,d?(f.addEventListener(\"close\",y),f.addEventListener(\"error\",b),f.addEventListener(\"message\",m)):(f.onclose=y,f.onerror=b,f.onmessage=m),r}:function(e,t){o(\"streamBuilder\");const r=h(t),n=c(r,e),s=function(e,t,r){o(\"createWebSocket\"),o(\"protocol: \"+r.protocolId+\" \"+r.protocolVersion);const n=\"MQIsdp\"===r.protocolId&&3===r.protocolVersion?\"mqttv3.1\":\"mqtt\";return o(\"creating new Websocket for url: \"+t+\" and protocol: \"+n),new i(t,[n],r.wsOptions)}(0,n,r),a=i.createWebSocketStream(s,r.wsOptions);return a.url=n,s.on(\"close\",()=>{a.destroy()}),a}}).call(this)}).call(this,e(\"_process\"))},{_process:50,buffer:17,debug:18,duplexify:20,\"readable-stream\":69,ws:80}],6:[function(e,t,r){\"use strict\";const{Buffer:n}=e(\"buffer\"),i=e(\"readable-stream\").Transform,o=e(\"duplexify\");let s,a,l;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error(\"Could not determine host. Specify host manually.\");const r=\"MQIsdp\"===t.protocolId&&3===t.protocolVersion?\"mqttv3.1\":\"mqtt\";!function(e){e.hostname||(e.hostname=\"localhost\"),e.path||(e.path=\"/\"),e.wsOptions||(e.wsOptions={})}(t);const u=function(e,t){const r=\"wxs\"===e.protocol?\"wss\":\"ws\";let n=r+\"://\"+e.hostname+e.path;return e.port&&80!==e.port&&443!==e.port&&(n=r+\"://\"+e.hostname+\":\"+e.port+e.path),\"function\"==typeof e.transformWsUrl&&(n=e.transformWsUrl(n,e,t)),n}(t,e);s=wx.connectSocket({url:u,protocols:[r]}),a=function(){const e=new i;return e._write=function(e,t,r){s.send({data:e.buffer,success:function(){r()},fail:function(e){r(new Error(e))}})},e._flush=function(e){s.close({success:function(){e()}})},e}(),(l=o.obj())._destroy=function(e,t){s.close({success:function(){t&&t(e)}})};const c=l.destroy;return l.destroy=function(){l.destroy=c;const e=this;setTimeout(function(){s.close({fail:function(){e._destroy(new Error)}})},0)}.bind(l),s.onOpen(function(){l.setReadable(a),l.setWritable(a),l.emit(\"connect\")}),s.onMessage(function(e){let t=e.data;t=t instanceof ArrayBuffer?n.from(t):n.from(t,\"utf8\"),a.push(t)}),s.onClose(function(){l.end(),l.destroy()}),s.onError(function(e){l.destroy(new Error(e.errMsg))}),l}},{buffer:17,duplexify:20,\"readable-stream\":69}],7:[function(e,t,r){\"use strict\";function n(){if(!(this instanceof n))return new n;this.nextId=Math.max(1,Math.floor(65535*Math.random()))}n.prototype.allocate=function(){const e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},n.prototype.getLastAllocated=function(){return 1===this.nextId?65535:this.nextId-1},n.prototype.register=function(e){return!0},n.prototype.deallocate=function(e){},n.prototype.clear=function(){},t.exports=n},{}],8:[function(e,t,r){\"use strict\";const n=e(\"xtend\"),i=e(\"readable-stream\").Readable,o={objectMode:!0},s={clean:!0};function a(e){if(!(this instanceof a))return new a(e);this.options=e||{},this.options=n(s,e),this._inflights=new Map}a.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},a.prototype.createStream=function(){const e=new i(o),t=[];let r=!1,n=0;return this._inflights.forEach(function(e,r){t.push(e)}),e._read=function(){!r&&n<t.length?this.push(t[n++]):this.push(null)},e.destroy=function(){if(r)return;const e=this;r=!0,setTimeout(function(){e.emit(\"close\")},0)},e},a.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error(\"missing packet\")),this},a.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error(\"missing packet\")),this},a.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},t.exports=a},{\"readable-stream\":69,xtend:81}],9:[function(e,t,r){\"use strict\";function n(e){if(!(this instanceof n))return new n(e);this.aliasToTopic={},this.max=e}n.prototype.put=function(e,t){return!(0===t||t>this.max)&&(this.aliasToTopic[t]=e,this.length=Object.keys(this.aliasToTopic).length,!0)},n.prototype.getTopicByAlias=function(e){return this.aliasToTopic[e]},n.prototype.clear=function(){this.aliasToTopic={}},t.exports=n},{}],10:[function(e,t,r){\"use strict\";const n=e(\"lru-cache\"),i=e(\"number-allocator\").NumberAllocator;function o(e){if(!(this instanceof o))return new o(e);e>0&&(this.aliasToTopic=new n({max:e}),this.topicToAlias={},this.numberAllocator=new i(1,e),this.max=e,this.length=0)}o.prototype.put=function(e,t){if(0===t||t>this.max)return!1;const r=this.aliasToTopic.get(t);return r&&delete this.topicToAlias[r],this.aliasToTopic.set(t,e),this.topicToAlias[e]=t,this.numberAllocator.use(t),this.length=this.aliasToTopic.length,!0},o.prototype.getTopicByAlias=function(e){return this.aliasToTopic.get(e)},o.prototype.getAliasByTopic=function(e){const t=this.topicToAlias[e];return void 0!==t&&this.aliasToTopic.get(t),t},o.prototype.clear=function(){this.aliasToTopic.reset(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0},o.prototype.getLruAlias=function(){const e=this.numberAllocator.firstVacant();return e||this.aliasToTopic.keys()[this.aliasToTopic.length-1]},t.exports=o},{\"lru-cache\":37,\"number-allocator\":46}],11:[function(e,t,r){\"use strict\";function n(e){const t=e.split(\"/\");for(let e=0;e<t.length;e++)if(\"+\"!==t[e]){if(\"#\"===t[e])return e===t.length-1;if(-1!==t[e].indexOf(\"+\")||-1!==t[e].indexOf(\"#\"))return!1}return!0}t.exports={validateTopics:function(e){if(0===e.length)return\"empty_topic_list\";for(let t=0;t<e.length;t++)if(!n(e[t]))return e[t];return null}}},{}],12:[function(e,t,r){(function(r){(function(){\"use strict\";const n=e(\"../client\"),i=e(\"../store\"),o=e(\"url\"),s=e(\"xtend\"),a=e(\"debug\")(\"mqttjs\"),l={};function u(e,t){if(a(\"connecting to an MQTT broker...\"),\"object\"!=typeof e||t||(t=e,e=null),t=t||{},e){const r=o.parse(e,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(t=s(r,t)).protocol)throw new Error(\"Missing protocol\");t.protocol=t.protocol.replace(/:$/,\"\")}if(function(e){let t;e.auth&&((t=e.auth.match(/^(.+):(.+)$/))?(e.username=t[1],e.password=t[2]):e.username=e.auth)}(t),t.query&&\"string\"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error(\"Missing secure protocol key\");if(-1===[\"mqtts\",\"wss\",\"wxs\",\"alis\"].indexOf(t.protocol))switch(t.protocol){case\"mqtt\":t.protocol=\"mqtts\";break;case\"ws\":t.protocol=\"wss\";break;case\"wx\":t.protocol=\"wxs\";break;case\"ali\":t.protocol=\"alis\";break;default:throw new Error('Unknown protocol for secure connection: \"'+t.protocol+'\"!')}}if(!l[t.protocol]){const e=-1!==[\"mqtts\",\"wss\"].indexOf(t.protocol);t.protocol=[\"mqtt\",\"mqtts\",\"ws\",\"wss\",\"wx\",\"wxs\",\"ali\",\"alis\"].filter(function(t,r){return(!e||r%2!=0)&&\"function\"==typeof l[t]})[0]}if(!1===t.clean&&!t.clientId)throw new Error(\"Missing clientId for unclean clients\");t.protocol&&(t.defaultProtocol=t.protocol);const r=new n(function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),a(\"calling streambuilder for\",t.protocol),l[t.protocol](e,t)},t);return r.on(\"error\",function(){}),r}void 0!==r&&\"browser\"!==r.title||\"function\"!=typeof __webpack_require__?(l.mqtt=e(\"./tcp\"),l.tcp=e(\"./tcp\"),l.ssl=e(\"./tls\"),l.tls=e(\"./tls\"),l.mqtts=e(\"./tls\")):(l.wx=e(\"./wx\"),l.wxs=e(\"./wx\"),l.ali=e(\"./ali\"),l.alis=e(\"./ali\")),l.ws=e(\"./ws\"),l.wss=e(\"./ws\"),t.exports=u,t.exports.connect=u,t.exports.MqttClient=n,t.exports.Store=i}).call(this)}).call(this,e(\"_process\"))},{\"../client\":1,\"../store\":8,\"./ali\":2,\"./tcp\":3,\"./tls\":4,\"./ws\":5,\"./wx\":6,_process:50,debug:18,url:76,xtend:81}],13:[function(e,t,r){\"use strict\";r.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){var t,r,n=u(e),s=n[0],a=n[1],l=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),c=0,h=a>0?s-4:s;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===a&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[c++]=255&t);1===a&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(c(e,s,s+16383>a?a:s+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+\"==\")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+\"=\"));return o.join(\"\")};for(var n=[],i=[],o=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,s=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",a=0,l=s.length;a<l;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error(\"Invalid string. Length must be a multiple of 4\");var r=e.indexOf(\"=\");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join(\"\")}i[\"-\".charCodeAt(0)]=62,i[\"_\".charCodeAt(0)]=63},{}],14:[function(e,t,r){\"use strict\";const{Buffer:n}=e(\"buffer\"),i=Symbol.for(\"BufferList\");function o(e){if(!(this instanceof o))return new o(e);o._init.call(this,e)}o._init=function(e){Object.defineProperty(this,i,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},o.prototype._new=function(e){return new o(e)},o.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},o.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},o.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},o.prototype.slice=function(e,t){return\"number\"==typeof e&&e<0&&(e+=this.length),\"number\"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},o.prototype.copy=function(e,t,r,i){if((\"number\"!=typeof r||r<0)&&(r=0),(\"number\"!=typeof i||i>this.length)&&(i=this.length),r>=this.length)return e||n.alloc(0);if(i<=0)return e||n.alloc(0);const o=!!e,s=this._offset(r),a=i-r;let l=a,u=o&&t||0,c=s[1];if(0===r&&i===this.length){if(!o)return 1===this._bufs.length?this._bufs[0]:n.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(l<=this._bufs[s[0]].length-c)return o?this._bufs[s[0]].copy(e,t,c,c+l):this._bufs[s[0]].slice(c,c+l);o||(e=n.allocUnsafe(a));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(l>r)){this._bufs[t].copy(e,u,c,c+l),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,l-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},o.prototype.shallowSlice=function(e,t){if(e=e||0,t=\"number\"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},o.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},o.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},o.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},o.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(n.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else\"number\"==typeof e&&(e=e.toString()),this._appendBuffer(n.from(e));return this},o.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},o.prototype.indexOf=function(e,t,r){if(void 0===r&&\"string\"==typeof t&&(r=t,t=void 0),\"function\"==typeof e||Array.isArray(e))throw new TypeError('The \"value\" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(\"number\"==typeof e?e=n.from([e]):\"string\"==typeof e?e=n.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=n.from(e.buffer,e.byteOffset,e.byteLength):n.isBuffer(e)||(e=n.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const i=this._offset(t);let o=i[0],s=i[1];for(;o<this._bufs.length;o++){const t=this._bufs[o];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([o,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([o,s]);if(this._match(t,e))return t;s++}}s=0}return-1},o.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){o.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),o.prototype._isBufferList=function(e){return e instanceof o||o.isBufferList(e)},o.isBufferList=function(e){return null!=e&&e[i]},t.exports=o},{buffer:17}],15:[function(e,t,r){\"use strict\";const n=e(\"readable-stream\").Duplex,i=e(\"inherits\"),o=e(\"./BufferList\");function s(e){if(!(this instanceof s))return new s(e);if(\"function\"==typeof e){this._callback=e;const t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on(\"pipe\",function(e){e.on(\"error\",t)}),this.on(\"unpipe\",function(e){e.removeListener(\"error\",t)}),e=null}o._init.call(this,e),n.call(this)}i(s,n),Object.assign(s.prototype,o.prototype),s.prototype._new=function(e){return new s(e)},s.prototype._write=function(e,t,r){this._appendBuffer(e),\"function\"==typeof r&&r()},s.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},s.prototype.end=function(e){n.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(e,t){this._bufs.length=0,this.length=0,t(e)},s.prototype._isBufferList=function(e){return e instanceof s||e instanceof o||s.isBufferList(e)},s.isBufferList=o.isBufferList,t.exports=s,t.exports.BufferListStream=s,t.exports.BufferList=o},{\"./BufferList\":14,inherits:24,\"readable-stream\":69}],16:[function(e,t,r){},{}],17:[function(e,t,r){(function(t){(function(){\"use strict\";var t=e(\"base64-js\"),n=e(\"ieee754\");r.Buffer=s,r.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},r.INSPECT_MAX_BYTES=50;var i=2147483647;function o(e){if(e>i)throw new RangeError('The value \"'+e+'\" is invalid for option \"size\"');var t=new Uint8Array(e);return t.__proto__=s.prototype,t}function s(e,t,r){if(\"number\"==typeof e){if(\"string\"==typeof t)throw new TypeError('The \"string\" argument must be of type string. Received type number');return u(e)}return a(e,t,r)}function a(e,t,r){if(\"string\"==typeof e)return function(e,t){\"string\"==typeof t&&\"\"!==t||(t=\"utf8\");if(!s.isEncoding(t))throw new TypeError(\"Unknown encoding: \"+t);var r=0|f(e,t),n=o(r),i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError(\"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \"+typeof e);if(q(e,ArrayBuffer)||e&&q(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('\"offset\" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('\"length\" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=s.prototype,n}(e,t,r);if(\"number\"==typeof e)throw new TypeError('The \"value\" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,r);var i=function(e){if(s.isBuffer(e)){var t=0|h(e.length),r=o(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(void 0!==e.length)return\"number\"!=typeof e.length||D(e.length)?o(0):c(e);if(\"Buffer\"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(i)return i;if(\"undefined\"!=typeof Symbol&&null!=Symbol.toPrimitive&&\"function\"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive](\"string\"),t,r);throw new TypeError(\"The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type \"+typeof e)}function l(e){if(\"number\"!=typeof e)throw new TypeError('\"size\" argument must be of type number');if(e<0)throw new RangeError('The value \"'+e+'\" is invalid for option \"size\"')}function u(e){return l(e),o(e<0?0:0|h(e))}function c(e){for(var t=e.length<0?0:0|h(e.length),r=o(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e){if(e>=i)throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+i.toString(16)+\" bytes\");return 0|e}function f(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||q(e,ArrayBuffer))return e.byteLength;if(\"string\"!=typeof e)throw new TypeError('The \"string\" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case\"ascii\":case\"latin1\":case\"binary\":return r;case\"utf8\":case\"utf-8\":return L(e).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*r;case\"hex\":return r>>>1;case\"base64\":return j(e).length;default:if(i)return n?-1:L(e).length;t=(\"\"+t).toLowerCase(),i=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function d(e,t,r,n,i){if(0===e.length)return-1;if(\"string\"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),D(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if(\"string\"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if(\"number\"==typeof t)return t&=255,\"function\"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError(\"val must be string, number or Buffer\")}function g(e,t,r,n,i){var o,s=1,a=e.length,l=t.length;if(void 0!==n&&(\"ucs2\"===(n=String(n).toLowerCase())||\"ucs-2\"===n||\"utf16le\"===n||\"utf-16le\"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var c=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){for(var h=!0,f=0;f<l;f++)if(u(e,o+f)!==u(t,f)){h=!1;break}if(h)return o}return-1}function y(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(D(a))return s;e[r+s]=a}return s}function b(e,t,r,n){return U(L(t,e.length-r),e,r,n)}function m(e,t,r,n){return U(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function v(e,t,r,n){return m(e,t,r,n)}function w(e,t,r,n){return U(j(t),e,r,n)}function _(e,t,r,n){return U(function(e,t){for(var r,n,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function k(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function S(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,s,a,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(l=(15&u)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);var r=\"\",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=E));return r}(n)}r.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||\"undefined\"==typeof console||\"function\"!=typeof console.error||console.error(\"This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.\"),Object.defineProperty(s.prototype,\"parent\",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,\"offset\",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),\"undefined\"!=typeof Symbol&&null!=Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),s.poolSize=8192,s.from=function(e,t,r){return a(e,t,r)},s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,s.alloc=function(e,t,r){return function(e,t,r){return l(e),e<=0?o(e):void 0!==t?\"string\"==typeof r?o(e).fill(t,r):o(e).fill(t):o(e)}(e,t,r)},s.allocUnsafe=function(e){return u(e)},s.allocUnsafeSlow=function(e){return u(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(q(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),q(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The \"buf1\", \"buf2\" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"latin1\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=s.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(q(o,Uint8Array)&&(o=s.from(o)),!s.isBuffer(o))throw new TypeError('\"list\" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},s.byteLength=f,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError(\"Buffer size must be a multiple of 64-bits\");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?\"\":0===arguments.length?S(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return\"\";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return\"\";if((r>>>=0)<=(t>>>=0))return\"\";for(e||(e=\"utf8\");;)switch(e){case\"hex\":return x(this,t,r);case\"utf8\":case\"utf-8\":return S(this,t,r);case\"ascii\":return C(this,t,r);case\"latin1\":case\"binary\":return T(this,t,r);case\"base64\":return k(this,t,r);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return A(this,t,r);default:if(n)throw new TypeError(\"Unknown encoding: \"+e);e=(e+\"\").toLowerCase(),n=!0}}.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError(\"Argument must be a Buffer\");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e=\"\",t=r.INSPECT_MAX_BYTES;return e=this.toString(\"hex\",0,t).replace(/(.{2})/g,\"$1 \").trim(),this.length>t&&(e+=\" ... \"),\"<Buffer \"+e+\">\"},s.prototype.compare=function(e,t,r,n,i){if(q(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The \"target\" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError(\"out of range index\");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,a=r-t,l=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r),h=0;h<l;++h)if(u[h]!==c[h]){o=u[h],a=c[h];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return d(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return d(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n=\"utf8\",r=this.length,t=0;else if(void 0===r&&\"string\"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n=\"utf8\")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");n||(n=\"utf8\");for(var o=!1;;)switch(n){case\"hex\":return y(this,e,t,r);case\"utf8\":case\"utf-8\":return b(this,e,t,r);case\"ascii\":return m(this,e,t,r);case\"latin1\":case\"binary\":return v(this,e,t,r);case\"base64\":return w(this,e,t,r);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return _(this,e,t,r);default:if(o)throw new TypeError(\"Unknown encoding: \"+n);n=(\"\"+n).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function C(e,t,r){var n=\"\";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){var n=\"\";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function x(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i=\"\",o=t;o<r;++o)i+=N(e[o]);return i}function A(e,t,r){for(var n=e.slice(t,r),i=\"\",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError(\"offset is not uint\");if(e+t>r)throw new RangeError(\"Trying to access beyond buffer length\")}function P(e,t,r,n,i,o){if(!s.isBuffer(e))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('\"value\" argument is out of bounds');if(r+n>e.length)throw new RangeError(\"Index out of range\")}function O(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError(\"Index out of range\");if(r<0)throw new RangeError(\"Index out of range\")}function B(e,t,r,i,o){return t=+t,r>>>=0,o||O(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function R(e,t,r,i,o){return t=+t,r>>>=0,o||O(e,0,r,8),n.write(e,t,r,i,52,8),r+8}s.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=s.prototype,n},s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||I(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),n.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),n.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),n.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),n.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||P(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},s.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||P(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);P(this,e,t,r,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);P(this,e,t,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,r){return B(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return B(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw new TypeError(\"argument should be a Buffer\");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError(\"targetStart out of bounds\");if(r<0||r>=this.length)throw new RangeError(\"Index out of range\");if(n<0)throw new RangeError(\"sourceEnd out of bounds\");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&\"function\"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;o>=0;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},s.prototype.fill=function(e,t,r,n){if(\"string\"==typeof e){if(\"string\"==typeof t?(n=t,t=0,r=this.length):\"string\"==typeof r&&(n=r,r=this.length),void 0!==n&&\"string\"!=typeof n)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof n&&!s.isEncoding(n))throw new TypeError(\"Unknown encoding: \"+n);if(1===e.length){var i=e.charCodeAt(0);(\"utf8\"===n&&i<128||\"latin1\"===n)&&(e=i)}}else\"number\"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError(\"Out of range index\");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),\"number\"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=s.isBuffer(e)?e:s.from(e,n),l=a.length;if(0===l)throw new TypeError('The value \"'+e+'\" is invalid for argument \"value\"');for(o=0;o<r-t;++o)this[o+t]=a[o%l]}return this};var M=/[^+/0-9A-Za-z-_]/g;function N(e){return e<16?\"0\"+e.toString(16):e.toString(16)}function L(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error(\"Invalid code point\");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function j(e){return t.toByteArray(function(e){if((e=(e=e.split(\"=\")[0]).trim().replace(M,\"\")).length<2)return\"\";for(;e.length%4!=0;)e+=\"=\";return e}(e))}function U(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function D(e){return e!=e}}).call(this)}).call(this,e(\"buffer\").Buffer)},{\"base64-js\":13,buffer:17,ieee754:23}],18:[function(e,t,r){(function(n){(function(){r.formatArgs=function(e){if(e[0]=(this.useColors?\"%c\":\"\")+this.namespace+(this.useColors?\" %c\":\" \")+e[0]+(this.useColors?\"%c \":\" \")+\"+\"+t.exports.humanize(this.diff),!this.useColors)return;const r=\"color: \"+this.color;e.splice(1,0,r,\"color: inherit\");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{\"%%\"!==e&&\"%c\"===e&&(i=++n)}),e.splice(i,0,r)},r.save=function(e){try{e?r.storage.setItem(\"debug\",e):r.storage.removeItem(\"debug\")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem(\"debug\")}catch(e){}!e&&void 0!==n&&\"env\"in n&&(e=n.env.DEBUG);return e},r.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&(\"renderer\"===window.process.type||window.process.__nwjs))return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\"))}})(),r.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],r.log=console.debug||console.log||(()=>{}),t.exports=e(\"./common\")(r);const{formatters:i}=t.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}}}).call(this)}).call(this,e(\"_process\"))},{\"./common\":19,_process:50}],19:[function(e,t,r){t.exports=function(t){function r(e){let t,i,o,s=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),o=i-(t||i);n.diff=o,n.prev=t,n.curr=i,t=i,e[0]=r.coerce(e[0]),\"string\"!=typeof e[0]&&e.unshift(\"%O\");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if(\"%%\"===t)return\"%\";s++;const o=r.formatters[i];if(\"function\"==typeof o){const r=e[s];t=o.call(n,r),e.splice(s,1),s--}return t}),r.formatArgs.call(n,e),(n.log||r.log).apply(n,e)}return a.namespace=e,a.useColors=r.useColors(),a.color=r.selectColor(e),a.extend=n,a.destroy=r.destroy,Object.defineProperty(a,\"enabled\",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==r.namespaces&&(i=r.namespaces,o=r.enabled(e)),o),set:e=>{s=e}}),\"function\"==typeof r.init&&r.init(a),a}function n(e,t){const n=r(this.namespace+(void 0===t?\":\":t)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\\.\\*\\?$/,\"*\")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(i),...r.skips.map(i).map(e=>\"-\"+e)].join(\",\");return r.enable(\"\"),e},r.enable=function(e){let t;r.save(e),r.namespaces=e,r.names=[],r.skips=[];const n=(\"string\"==typeof e?e:\"\").split(/[\\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&(\"-\"===(e=n[t].replace(/\\*/g,\".*?\"))[0]?r.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):r.names.push(new RegExp(\"^\"+e+\"$\")))},r.enabled=function(e){if(\"*\"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e(\"ms\"),r.destroy=function(){console.warn(\"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.\")},Object.keys(t).forEach(e=>{r[e]=t[e]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return r.colors[Math.abs(t)%r.colors.length]},r.enable(r.load()),r}},{ms:45}],20:[function(e,t,r){(function(r,n){(function(){var i=e(\"readable-stream\"),o=e(\"end-of-stream\"),s=e(\"inherits\"),a=e(\"stream-shift\"),l=n.from&&n.from!==Uint8Array.from?n.from([0]):new n([0]),u=function(e,t){e._corked?e.once(\"uncork\",t):t()},c=function(e,t){return function(r){r?function(e,t){e._autoDestroy&&e.destroy(t)}(e,\"premature close\"===r.message?null:r):t&&!e._ended&&e.end()}},h=function(){},f=function(e,t,r){if(!(this instanceof f))return new f(e,t,r);i.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};s(f,i.Duplex),f.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new f(e,t,r)},f.prototype.cork=function(){1==++this._corked&&this.emit(\"cork\")},f.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit(\"uncork\")},f.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,n=o(e,{writable:!0,readable:!1},c(this,this._forwardEnd)),i=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&r.nextTick(i),this._writable=e,this._writable.on(\"drain\",i),this._unwrite=function(){t._writable.removeListener(\"drain\",i),n()},this.uncork()}else this.end()},f.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,r=this,n=o(e,{writable:!1,readable:!0},c(this)),s=function(){r._forward()},a=function(){r.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new i.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on(\"readable\",s),this._readable2.on(\"end\",a),this._unread=function(){r._readable2.removeListener(\"readable\",s),r._readable2.removeListener(\"end\",a),n()},this._forward()}},f.prototype._read=function(){this._drained=!0,this._forward()},f.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=a(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},f.prototype.destroy=function(e,t){if(t||(t=h),this.destroyed)return t(null);this.destroyed=!0;var n=this;r.nextTick(function(){n._destroy(e),t(null)})},f.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit(\"error\",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit(\"close\")},f.prototype._write=function(e,t,r){if(!this.destroyed)return this._corked?u(this,this._write.bind(this,e,t,r)):e===l?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:this.destroyed||r()):r()},f.prototype._finish=function(e){var t=this;this.emit(\"preend\"),u(this,function(){var r,n;r=t._forwardEnd&&t._writable,n=function(){!1===t._writableState.prefinished&&(t._writableState.prefinished=!0),t.emit(\"prefinish\"),u(t,e)},r?r._writableState&&r._writableState.finished?n():r._writableState?r.end(n):(r.end(),n()):n()})},f.prototype.end=function(e,t,r){return\"function\"==typeof e?this.end(null,null,e):\"function\"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this._writableState.destroyed||this.write(l),i.Writable.prototype.end.call(this,r))},t.exports=f}).call(this)}).call(this,e(\"_process\"),e(\"buffer\").Buffer)},{_process:50,buffer:17,\"end-of-stream\":21,inherits:24,\"readable-stream\":69,\"stream-shift\":74}],21:[function(e,t,r){(function(r){(function(){var n=e(\"once\"),i=function(){},o=function(e,t,s){if(\"function\"==typeof t)return o(e,null,t);t||(t={}),s=n(s||i);var a=e._writableState,l=e._readableState,u=t.readable||!1!==t.readable&&e.readable,c=t.writable||!1!==t.writable&&e.writable,h=!1,f=function(){e.writable||p()},p=function(){c=!1,u||s.call(e)},d=function(){u=!1,c||s.call(e)},g=function(t){s.call(e,t?new Error(\"exited with error code: \"+t):null)},y=function(t){s.call(e,t)},b=function(){r.nextTick(m)},m=function(){if(!h)return(!u||l&&l.ended&&!l.destroyed)&&(!c||a&&a.ended&&!a.destroyed)?void 0:s.call(e,new Error(\"premature close\"))},v=function(){e.req.on(\"finish\",p)};return!function(e){return e.setHeader&&\"function\"==typeof e.abort}(e)?c&&!a&&(e.on(\"end\",f),e.on(\"close\",f)):(e.on(\"complete\",p),e.on(\"abort\",b),e.req?v():e.on(\"request\",v)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(e)&&e.on(\"exit\",g),e.on(\"end\",d),e.on(\"finish\",p),!1!==t.error&&e.on(\"error\",y),e.on(\"close\",b),function(){h=!0,e.removeListener(\"complete\",p),e.removeListener(\"abort\",b),e.removeListener(\"request\",v),e.req&&e.req.removeListener(\"finish\",p),e.removeListener(\"end\",f),e.removeListener(\"close\",f),e.removeListener(\"finish\",p),e.removeListener(\"exit\",g),e.removeListener(\"end\",d),e.removeListener(\"error\",y),e.removeListener(\"close\",b)}};t.exports=o}).call(this)}).call(this,e(\"_process\"))},{_process:50,once:48}],22:[function(e,t,r){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,\"_events\")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,l=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,\"x\",{value:0}),a=0===u.x}catch(e){a=!1}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function h(e,t,r,i){var o,s,a;if(\"function\"!=typeof r)throw new TypeError('\"listener\" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit(\"newListener\",t,r.listener?r.listener:r),s=e._events),a=s[t]):(s=e._events=n(null),e._eventsCount=0),a){if(\"function\"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(o=c(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error(\"Possible EventEmitter memory leak detected. \"+a.length+' \"'+String(t)+'\" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name=\"MaxListenersExceededWarning\",l.emitter=e,l.type=t,l.count=a.length,\"object\"==typeof console&&console.warn&&console.warn(\"%s: %s\",l.name,l.message)}}else a=s[t]=r,++e._eventsCount;return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=o.call(f,n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(!n)return[];var i=n[t];return i?\"function\"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):y(i,i.length):[]}function g(e){var t=this._events;if(t){var r=t[e];if(\"function\"==typeof r)return 1;if(r)return r.length}return 0}function y(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}a?Object.defineProperty(s,\"defaultMaxListeners\",{enumerable:!0,get:function(){return l},set:function(e){if(\"number\"!=typeof e||e<0||e!=e)throw new TypeError('\"defaultMaxListeners\" must be a positive number');l=e}}):s.defaultMaxListeners=l,s.prototype.setMaxListeners=function(e){if(\"number\"!=typeof e||e<0||isNaN(e))throw new TypeError('\"n\" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){var t,r,n,i,o,s,a=\"error\"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled \"error\" event. ('+t+\")\");throw l.context=t,l}if(!(r=s[e]))return!1;var u=\"function\"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=y(e,n),o=0;o<n;++o)i[o].call(r)}(r,u,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=y(e,i),s=0;s<i;++s)o[s].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,s=y(e,o),a=0;a<o;++a)s[a].call(r,n,i)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var s=e.length,a=y(e,s),l=0;l<s;++l)a[l].call(r,n,i,o)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=y(e,i),s=0;s<i;++s)o[s].apply(r,n)}(r,u,this,i)}return!0},s.prototype.addListener=function(e,t){return h(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return h(this,e,t,!0)},s.prototype.once=function(e,t){if(\"function\"!=typeof t)throw new TypeError('\"listener\" argument must be a function');return this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if(\"function\"!=typeof t)throw new TypeError('\"listener\" argument must be a function');return this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,o,s,a;if(\"function\"!=typeof t)throw new TypeError('\"listener\" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete i[e],i.removeListener&&this.emit(\"removeListener\",e,r.listener||t));else if(\"function\"!=typeof r){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,o=s;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(i[e]=r[0]),i.removeListener&&this.emit(\"removeListener\",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,r,o;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var s,a=i(r);for(o=0;o<a.length;++o)\"removeListener\"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners(\"removeListener\"),this._events=n(null),this._eventsCount=0,this}if(\"function\"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(e,t,r){r.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=a;c>0;o=256*o+e[t+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(t*l-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+p]=255&s,p+=d,s/=256,u-=8);e[r+p-d]|=128*g}},{}],24:[function(e,t,r){\"function\"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},{}],25:[function(e,t,r){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=function(){function e(e,t){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=e,this.value=t}return e.prototype.rotateLeft=function(){var e=this.parent,t=this.brother,r=this.leftChild,n=this.rightChild;if(!n)throw new Error(\"unknown error\");var i=n.leftChild,o=n.rightChild;return e&&(e.leftChild===this?e.leftChild=n:e.rightChild===this&&(e.rightChild=n)),n.parent=e,n.brother=t,n.leftChild=this,n.rightChild=o,t&&(t.brother=n),this.parent=n,this.brother=o,this.leftChild=r,this.rightChild=i,o&&(o.parent=n,o.brother=this),r&&(r.parent=this,r.brother=i),i&&(i.parent=this,i.brother=r),n},e.prototype.rotateRight=function(){var e=this.parent,t=this.brother,r=this.leftChild;if(!r)throw new Error(\"unknown error\");var n=this.rightChild,i=r.leftChild,o=r.rightChild;return e&&(e.leftChild===this?e.leftChild=r:e.rightChild===this&&(e.rightChild=r)),r.parent=e,r.brother=t,r.leftChild=i,r.rightChild=this,t&&(t.brother=r),i&&(i.parent=r,i.brother=this),this.parent=r,this.brother=i,this.leftChild=o,this.rightChild=n,o&&(o.parent=this,o.brother=n),n&&(n.parent=this,n.brother=o),r},e.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error(\"can only remove leaf node\");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},e.TreeNodeColorType={red:!0,black:!1},e}();Object.freeze(n),r.default=n},{}],26:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};function i(e){var t=this;void 0===e&&(e=[]);var r=[],o=0,s=0,a=0,l=0,u=0,c=0;this.size=function(){return c},this.empty=function(){return 0===c},this.clear=function(){o=a=s=l=u=c=0,f.call(this,i.bucketSize),c=0},this.front=function(){return r[o][s]},this.back=function(){return r[a][l]},this.forEach=function(e){if(!this.empty()){var t=0;if(o!==a){for(u=s;u<i.bucketSize;++u)e(r[o][u],t++);for(u=o+1;u<a;++u)for(var n=0;n<i.bucketSize;++n)e(r[u][n],t++);for(u=0;u<=l;++u)e(r[a][u],t++)}else for(var u=s;u<=l;++u)e(r[o][u],t++)}};var h=function(e){var t=o*i.bucketSize+s,r=t+e,n=a*i.bucketSize+l;if(r<t||r>n)throw new Error(\"pos should more than 0 and less than queue's size\");return{curNodeBucketIndex:Math.floor(r/i.bucketSize),curNodePointerIndex:r%i.bucketSize}};this.getElementByPos=function(e){var t=h(e),n=t.curNodeBucketIndex,i=t.curNodePointerIndex;return r[n][i]},this.eraseElementByPos=function(e){var t=this;if(e<0||e>c)throw new Error(\"pos should more than 0 and less than queue's size\");if(0===e)this.popFront();else if(e===this.size())this.popBack();else{for(var r=[],n=e+1;n<c;++n)r.push(this.getElementByPos(n));this.cut(e),this.popBack(),r.forEach(function(e){return t.pushBack(e)})}},this.eraseElementByValue=function(e){if(!this.empty()){var t=[];this.forEach(function(r){r!==e&&t.push(r)});for(var r=t.length,n=0;n<r;++n)this.setElementByPos(n,t[n]);this.cut(r-1)}};var f=function(e){for(var t=[],n=e*i.sigma,h=Math.max(Math.ceil(n/i.bucketSize),2),f=0;f<h;++f)t.push(new Array(i.bucketSize));var p=Math.ceil(e/i.bucketSize),d=Math.floor(h/2)-Math.floor(p/2),g=d,y=0;if(this.size())for(f=0;f<p;++f){for(var b=0;b<i.bucketSize;++b)if(t[d+f][b]=this.front(),this.popFront(),this.empty()){g=d+f,y=b;break}if(this.empty())break}r=t,o=d,s=0,a=g,l=y,u=h,c=e};this.pushBack=function(e){this.empty()||(a===u-1&&l===i.bucketSize-1&&f.call(this,this.size()),l<i.bucketSize-1?++l:a<u-1&&(++a,l=0)),++c,r[a][l]=e},this.popBack=function(){this.empty()||(1!==this.size()&&(l>0?--l:o<a&&(--a,l=i.bucketSize-1)),c>0&&--c)},this.setElementByPos=function(e,t){var n=h(e),i=n.curNodeBucketIndex,o=n.curNodePointerIndex;r[i][o]=t},this.insert=function(e,t,r){var n=this;if(void 0===r&&(r=1),0===e)for(;r--;)this.pushFront(t);else if(e===this.size())for(;r--;)this.pushBack(t);else{for(var i=[],o=e;o<c;++o)i.push(this.getElementByPos(o));this.cut(e-1);for(o=0;o<r;++o)this.pushBack(t);i.forEach(function(e){return n.pushBack(e)})}},this.find=function(e){if(o===a){for(var t=s;t<=l;++t)if(r[o][t]===e)return!0;return!1}for(t=s;t<i.bucketSize;++t)if(r[o][t]===e)return!0;for(t=o+1;t<a;++t)for(var n=0;n<i.bucketSize;++n)if(r[t][n]===e)return!0;for(t=0;t<=l;++t)if(r[a][t]===e)return!0;return!1},this.reverse=function(){for(var e=0,t=c-1;e<t;){var r=this.getElementByPos(e);this.setElementByPos(e,this.getElementByPos(t)),this.setElementByPos(t,r),++e,--t}},this.unique=function(){if(!this.empty()){var e=[],t=this.front();this.forEach(function(r,n){0!==n&&r===t||(e.push(r),t=r)});for(var r=0;r<c;++r)this.setElementByPos(r,e[r]);this.cut(e.length-1)}},this.sort=function(e){var t=[];this.forEach(function(e){t.push(e)}),t.sort(e);for(var r=0;r<c;++r)this.setElementByPos(r,t[r])},this.pushFront=function(e){this.empty()||(0===o&&0===s&&f.call(this,this.size()),s>0?--s:o>0&&(--o,s=i.bucketSize-1)),++c,r[o][s]=e},this.popFront=function(){this.empty()||(1!==this.size()&&(s<i.bucketSize-1?++s:o<a&&(++o,s=0)),c>0&&--c)},this.shrinkToFit=function(){var e=this,t=[];this.forEach(function(e){t.push(e)});var n=t.length;r=[];for(var o=Math.ceil(n/i.bucketSize),s=0;s<o;++s)r.push(new Array(i.bucketSize));this.clear(),t.forEach(function(t){return e.pushBack(t)})},this.cut=function(e){if(e<0)this.clear();else{var t=h(e),r=t.curNodeBucketIndex,n=t.curNodePointerIndex;a=r,l=n,c=e+1}},this[Symbol.iterator]=function(){return function(){var e,t;return n(this,function(n){switch(n.label){case 0:if(0===c)return[2];if(o!==a)return[3,5];t=s,n.label=1;case 1:return t<=l?[4,r[o][t]]:[3,4];case 2:n.sent(),n.label=3;case 3:return++t,[3,1];case 4:return[2];case 5:t=s,n.label=6;case 6:return t<i.bucketSize?[4,r[o][t]]:[3,9];case 7:n.sent(),n.label=8;case 8:return++t,[3,6];case 9:t=o+1,n.label=10;case 10:if(!(t<a))return[3,15];e=0,n.label=11;case 11:return e<i.bucketSize?[4,r[t][e]]:[3,14];case 12:n.sent(),n.label=13;case 13:return++e,[3,11];case 14:return++t,[3,10];case 15:t=0,n.label=16;case 16:return t<=l?[4,r[a][t]]:[3,19];case 17:n.sent(),n.label=18;case 18:return++t,[3,16];case 19:return[2]}})}()},function(){var n=i.bucketSize;e.size?n=e.size():e.length&&(n=e.length);var s=n*i.sigma;u=Math.ceil(s/i.bucketSize),u=Math.max(u,3);for(var l=0;l<u;++l)r.push(new Array(i.bucketSize));var c=Math.ceil(n/i.bucketSize);o=Math.floor(u/2)-Math.floor(c/2),a=o,e.forEach(function(e){return t.pushBack(e)})}(),Object.freeze(this)}Object.defineProperty(r,\"__esModule\",{value:!0}),i.sigma=3,i.bucketSize=5e3,Object.freeze(i),r.default=i},{}],27:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=this&&this.__values||function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(r,\"__esModule\",{value:!0});var o=e(\"../LinkList/LinkList\"),s=e(\"../Map/Map\");function a(e,t,r){var l=this;if(void 0===e&&(e=[]),void 0===t&&(t=a.initSize),r=r||function(e){var t,r,n=0,o=\"\";if(\"number\"==typeof e)n=((n=Math.floor(e))<<5)-n,n&=n;else{o=\"string\"!=typeof e?JSON.stringify(e):e;try{for(var s=i(o),a=s.next();!a.done;a=s.next()){n=(n<<5)-n+a.value.charCodeAt(0),n&=n}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}return n^=n>>>16},0!=(t&t-1))throw new Error(\"initBucketNum must be 2 to the power of n\");var u=0,c=[],h=Math.max(a.initSize,Math.min(a.maxSize,t));this.size=function(){return u},this.empty=function(){return 0===u},this.clear=function(){u=0,h=t,c=[]},this.forEach=function(e){var t=0;c.forEach(function(r){r.forEach(function(r){e(r,t++)})})};this.setElement=function(e,t){var n,l;if(null===e||void 0===e)throw new Error(\"to avoid some unnecessary errors, we don't suggest you insert null or undefined here\");if(null!==t&&void 0!==t){var f=r(e)&h-1;if(c[f]){var p=c[f].size();if(c[f]instanceof o.default){try{for(var d=i(c[f]),g=d.next();!g.done;g=d.next()){var y=g.value;if(y.key===e)return void(y.value=t)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(l=d.return)&&l.call(d)}finally{if(n)throw n.error}}c[f].pushBack({key:e,value:t}),c[f].size()>=a.treeifyThreshold&&(c[f]=new s.default(c[f]))}else c[f].setElement(e,t);var b=c[f].size();u+=b-p}else++u,c[f]=new o.default([{key:e,value:t}]);u>h*a.sigma&&function(e){if(!(e>=a.maxSize)){h=2*e;var t=[];c.forEach(function(n,i){if(!n.empty()){if(n instanceof o.default&&1===n.size()){var l=n.front(),u=l.key,f=l.value;t[r(u)&h-1]=new o.default([{key:u,value:f}])}else if(n instanceof s.default){var p=new o.default,d=new o.default;n.forEach(function(t){0==(r(t.key)&e)?p.pushBack(t):d.pushBack(t)}),p.size()>a.untreeifyThreshold?t[i]=new s.default(p):p.size()&&(t[i]=p),d.size()>a.untreeifyThreshold?t[i+e]=new s.default(d):d.size()&&(t[i+e]=d)}else{var g=new o.default,y=new o.default;n.forEach(function(t){0==(r(t.key)&e)?g.pushBack(t):y.pushBack(t)}),g.size()&&(t[i]=g),y.size()&&(t[i+e]=y)}c[i].clear()}}),c=t}}.call(this,h)}else this.eraseElementByKey(e)},this.getElementByKey=function(e){var t,n,o=r(e)&h-1;if(c[o]){if(c[o]instanceof s.default)return c[o].getElementByKey(e);try{for(var a=i(c[o]),l=a.next();!l.done;l=a.next()){var u=l.value;if(u.key===e)return u.value}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},this.eraseElementByKey=function(e){var t,n,l=r(e)&h-1;if(c[l]){var f=c[l].size();if(c[l]instanceof s.default)c[l].eraseElementByKey(e),c[l].size()<=a.untreeifyThreshold&&(c[l]=new o.default(c[l]));else{var p=-1;try{for(var d=i(c[l]),g=d.next();!g.done;g=d.next()){if(++p,g.value.key===e){c[l].eraseElementByPos(p);break}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}}var y=c[l].size();u+=y-f}},this.find=function(e){var t,n,o=r(e)&h-1;if(!c[o])return!1;if(c[o]instanceof s.default)return c[o].find(e);try{for(var a=i(c[o]),l=a.next();!l.done;l=a.next()){if(l.value.key===e)return!0}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},this[Symbol.iterator]=function(){return function(){var e,t,r,o,s,a;return n(this,function(n){switch(n.label){case 0:e=0,n.label=1;case 1:if(!(e<h))return[3,10];for(;e<h&&!c[e];)++e;if(e>=h)return[3,10];n.label=2;case 2:n.trys.push([2,7,8,9]),s=void 0,t=i(c[e]),r=t.next(),n.label=3;case 3:return r.done?[3,6]:[4,r.value];case 4:n.sent(),n.label=5;case 5:return r=t.next(),[3,3];case 6:return[3,9];case 7:return o=n.sent(),s={error:o},[3,9];case 8:try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 9:return++e,[3,1];case 10:return[2]}})}()},e.forEach(function(e){var t=e.key,r=e.value;return l.setElement(t,r)}),Object.freeze(this)}a.initSize=16,a.maxSize=1<<30,a.sigma=.75,a.treeifyThreshold=8,a.untreeifyThreshold=6,a.minTreeifySize=64,Object.freeze(a),r.default=a},{\"../LinkList/LinkList\":29,\"../Map/Map\":30}],28:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=this&&this.__values||function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(r,\"__esModule\",{value:!0});var o=e(\"../Set/Set\"),s=e(\"../LinkList/LinkList\");function a(e,t,r){var l=this;if(void 0===e&&(e=[]),void 0===t&&(t=a.initSize),r=r||function(e){var t=0,r=\"\";if(\"number\"==typeof e)t=((t=Math.floor(e))<<5)-t,t&=t;else{r=\"string\"!=typeof e?JSON.stringify(e):e;for(var n=0;n<r.length;n++){t=(t<<5)-t+r.charCodeAt(n),t&=t}}return t^=t>>>16},0!=(t&t-1))throw new Error(\"initBucketNum must be 2 to the power of n\");var u=0,c=[],h=Math.max(a.initSize,Math.min(a.maxSize,t));this.size=function(){return u},this.empty=function(){return 0===u},this.clear=function(){u=0,h=t,c=[]},this.forEach=function(e){var t=0;c.forEach(function(r){r.forEach(function(r){e(r,t++)})})};this.insert=function(e){if(null===e||void 0===e)throw new Error(\"to avoid some unnecessary errors, we don't suggest you insert null or undefined here\");var t=r(e)&h-1;if(c[t]){var n=c[t].size();if(c[t]instanceof s.default){if(c[t].find(e))return;c[t].pushBack(e),c[t].size()>=a.treeifyThreshold&&(c[t]=new o.default(c[t]))}else c[t].insert(e);var i=c[t].size();u+=i-n}else c[t]=new s.default([e]),++u;u>h*a.sigma&&function(e){if(!(e>=a.maxSize)){h=2*e;var t=[];c.forEach(function(n,i){if(!n.empty()){if(n instanceof s.default&&1===n.size()){var l=n.front();if(void 0===l)throw new Error(\"unknown error\");t[r(l)&h-1]=new s.default([l])}else if(n instanceof o.default){var u=new s.default,f=new s.default;n.forEach(function(t){0==(r(t)&e)?u.pushBack(t):f.pushBack(t)}),u.size()>a.untreeifyThreshold?t[i]=new o.default(u):u.size()&&(t[i]=u),f.size()>a.untreeifyThreshold?t[i+e]=new o.default(f):f.size()&&(t[i+e]=f)}else{var p=new s.default,d=new s.default;n.forEach(function(t){0==(r(t)&e)?p.pushBack(t):d.pushBack(t)}),p.size()&&(t[i]=p),d.size()&&(t[i+e]=d)}c[i].clear()}}),c=t}}.call(this,h)},this.eraseElementByValue=function(e){var t=r(e)&h-1;if(c[t]){var n=c[t].size();c[t].eraseElementByValue(e),c[t]instanceof o.default&&c[t].size()<=a.untreeifyThreshold&&(c[t]=new s.default(c[t]));var i=c[t].size();u+=i-n}},this.find=function(e){var t=r(e)&h-1;return!!c[t]&&c[t].find(e)},this[Symbol.iterator]=function(){return function(){var e,t,r,o,s,a;return n(this,function(n){switch(n.label){case 0:e=0,n.label=1;case 1:if(!(e<h))return[3,10];for(;e<h&&!c[e];)++e;if(e>=h)return[3,10];n.label=2;case 2:n.trys.push([2,7,8,9]),s=void 0,t=i(c[e]),r=t.next(),n.label=3;case 3:return r.done?[3,6]:[4,r.value];case 4:n.sent(),n.label=5;case 5:return r=t.next(),[3,3];case 6:return[3,9];case 7:return o=n.sent(),s={error:o},[3,9];case 8:try{r&&!r.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 9:return++e,[3,1];case 10:return[2]}})}()},e.forEach(function(e){return l.insert(e)}),Object.freeze(this)}a.initSize=16,a.maxSize=1<<30,a.sigma=.75,a.treeifyThreshold=8,a.untreeifyThreshold=6,a.minTreeifySize=64,Object.freeze(a),r.default=a},{\"../LinkList/LinkList\":29,\"../Set/Set\":33}],29:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(r,\"__esModule\",{value:!0});var i=function(){return function(e){this.value=void 0,this.pre=void 0,this.next=void 0,this.value=e}}();function o(e){var t=this;void 0===e&&(e=[]);var r=0,o=void 0,s=void 0;this.size=function(){return r},this.empty=function(){return 0===r},this.clear=function(){o=s=void 0,r=0},this.front=function(){return null===o||void 0===o?void 0:o.value},this.back=function(){return null===s||void 0===s?void 0:s.value},this.forEach=function(e){for(var t=o,r=0;t;){if(void 0===t.value)throw new Error(\"unknown error\");e(t.value,r++),t=t.next}},this.getElementByPos=function(e){if(e<0||e>=r)throw new Error(\"pos must more then 0 and less then the list length\");for(var t=o;e--&&t;)t=t.next;if(!t||void 0===t.value)throw new Error(\"unknown error\");return t.value},this.eraseElementByPos=function(e){if(e<0||e>=r)throw new Error(\"erase pos must more then 0 and less then the list length\");if(0===e)this.popFront();else if(e===r-1)this.popBack();else{for(var t=o;e--;){if(!(null===t||void 0===t?void 0:t.next))throw new Error(\"unknown error\");t=t.next}if(!t||!t.pre||!t.next)throw new Error(\"unknown error\");var n=t.pre,i=t.next;i.pre=n,n.next=i,r>0&&--r}},this.eraseElementByValue=function(e){for(;o&&o.value===e;)this.popFront();for(;s&&s.value===e;)this.popBack();if(o)for(var t=o;t;){if(t.value===e){var n=t.pre,i=t.next;i&&(i.pre=n),n&&(n.next=i),r>0&&--r}t=t.next}},this.pushBack=function(e){if(null===e||void 0===e)throw new Error(\"you can't push null or undefined here\");++r;var t=new i(e);s?(s.next=t,t.pre=s,s=t):o=s=t},this.popBack=function(){s&&(r>0&&--r,s&&(o===s?o=s=void 0:(s=s.pre)&&(s.next=void 0)))},this.setElementByPos=function(e,t){if(null===t||void 0===t)throw new Error(\"you can't set null or undefined here\");if(e<0||e>=r)throw new Error(\"pos must more then 0 and less then the list length\");for(var n=o;e--;){if(!n)throw new Error(\"unknown error\");n=n.next}n&&(n.value=t)},this.insert=function(e,t,n){if(void 0===n&&(n=1),null===t||void 0===t)throw new Error(\"you can't insert null or undefined here\");if(e<0||e>r)throw new Error(\"insert pos must more then 0 and less then or equal to the list length\");if(n<0)throw new Error(\"insert size must more than 0\");if(0===e)for(;n--;)this.pushFront(t);else if(e===r)for(;n--;)this.pushBack(t);else{for(var s=o,a=1;a<e;++a){if(!(null===s||void 0===s?void 0:s.next))throw new Error(\"unknown error\");s=null===s||void 0===s?void 0:s.next}if(!s)throw new Error(\"unknown error\");var l=s.next;for(r+=n;n--;)s.next=new i(t),s.next.pre=s,s=s.next;s.next=l,l&&(l.pre=s)}},this.find=function(e){for(var t=o;t;){if(t.value===e)return!0;t=t.next}return!1},this.reverse=function(){for(var e=o,t=s,n=0;e&&t&&2*n<r;){var i=e.value;e.value=t.value,t.value=i,e=e.next,t=t.pre,++n}},this.unique=function(){for(var e=o;e;){for(var t=e;t&&t.next&&t.value===t.next.value;)t=t.next,r>0&&--r;e.next=t.next,e.next&&(e.next.pre=e),e=e.next}},this.sort=function(e){var t=[];this.forEach(function(e){t.push(e)}),t.sort(e);var r=o;t.forEach(function(e){r&&(r.value=e,r=r.next)})},this.pushFront=function(e){if(null===e||void 0===e)throw new Error(\"you can't push null or undefined here\");++r;var t=new i(e);o?(t.next=o,o.pre=t,o=t):o=s=t},this.popFront=function(){o&&(r>0&&--r,o&&(o===s?o=s=void 0:(o=o.next)&&(o.pre=void 0)))},this.merge=function(e){var t=this,n=o;e.forEach(function(e){for(;n&&void 0!==n.value&&n.value<=e;)n=n.next;if(void 0===n)t.pushBack(e),n=s;else if(n===o)t.pushFront(e),n=o;else{++r;var a=n.pre;a&&(a.next=new i(e),a.next.pre=a,a.next.next=n,n&&(n.pre=a.next))}})},this[Symbol.iterator]=function(){return function(){var e;return n(this,function(t){switch(t.label){case 0:e=o,t.label=1;case 1:if(void 0===e)return[3,3];if(!e.value)throw new Error(\"unknown error\");return[4,e.value];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}})}()},e.forEach(function(e){return t.pushBack(e)}),Object.freeze(this)}Object.freeze(o),r.default=o},{}],30:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=this&&this.__values||function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(r,\"__esModule\",{value:!0});var o=e(\"../Base/TreeNode\");function s(e,t){var r=this;void 0===e&&(e=[]),t=t||function(e,t){return e<t?-1:e>t?1:0};var s=0,a=new o.default;a.color=o.default.TreeNodeColorType.black,this.size=function(){return s},this.empty=function(){return 0===s},this.clear=function(){s=0,a.key=a.value=void 0,a.leftChild=a.rightChild=a.brother=void 0};var l=function(e){if(!e||void 0===e.key)throw new Error(\"unknown error\");return e.leftChild?l(e.leftChild):e},u=function(e){if(!e||void 0===e.key)throw new Error(\"unknown error\");return e.rightChild?u(e.rightChild):e};this.front=function(){if(!this.empty()){var e=l(a);if(void 0===e.key||void 0===e.value)throw new Error(\"unknown error\");return{key:e.key,value:e.value}}},this.back=function(){if(!this.empty()){var e=u(a);if(void 0===e.key||void 0===e.value)throw new Error(\"unknown error\");return{key:e.key,value:e.value}}},this.forEach=function(e){var t,r,n=0;try{for(var o=i(this),s=o.next();!s.done;s=o.next()){e(s.value,n++)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},this.getElementByPos=function(e){var t,r;if(e<0||e>=this.size())throw new Error(\"pos must more than 0 and less than set's size\");var n=0;try{for(var o=i(this),s=o.next();!s.done;s=o.next()){var a=s.value;if(n===e)return a;++n}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}throw new Error(\"unknown Error\")};var c=function(e,r){if(e&&void 0!==e.key&&void 0!==e.value){var n=t(e.key,r);return 0===n?{key:e.key,value:e.value}:n<0?c(e.rightChild,r):c(e.leftChild,r)||{key:e.key,value:e.value}}};this.lowerBound=function(e){return c(a,e)};var h=function(e,r){if(e&&void 0!==e.key&&void 0!==e.value)return t(e.key,r)<=0?h(e.rightChild,r):h(e.leftChild,r)||{key:e.key,value:e.value}};this.upperBound=function(e){return h(a,e)};var f=function(e,r){if(e&&void 0!==e.key&&void 0!==e.value){var n=t(e.key,r);return 0===n?{key:e.key,value:e.value}:n>0?f(e.leftChild,r):f(e.rightChild,r)||{key:e.key,value:e.value}}};this.reverseLowerBound=function(e){return f(a,e)};var p=function(e,r){if(e&&void 0!==e.key&&void 0!==e.value)return t(e.key,r)>=0?p(e.leftChild,r):p(e.rightChild,r)||{key:e.key,value:e.value}};this.reverseUpperBound=function(e){return p(a,e)};var d=function(e){var t=e.parent;if(!t){if(e===a)return;throw new Error(\"unknown error\")}if(e.color!==o.default.TreeNodeColorType.red){var r=e.brother;if(!r)throw new Error(\"unknown error\");if(e===t.leftChild){if(r.color===o.default.TreeNodeColorType.red){r.color=o.default.TreeNodeColorType.black,t.color=o.default.TreeNodeColorType.red;var n=t.rotateLeft();a===t&&(a=n),d(e)}else if(r.color===o.default.TreeNodeColorType.black)if(r.rightChild&&r.rightChild.color===o.default.TreeNodeColorType.red){r.color=t.color,t.color=o.default.TreeNodeColorType.black,r.rightChild&&(r.rightChild.color=o.default.TreeNodeColorType.black);n=t.rotateLeft();a===t&&(a=n),e.color=o.default.TreeNodeColorType.black}else if(r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||!r.leftChild||r.leftChild.color!==o.default.TreeNodeColorType.red)r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||(r.color=o.default.TreeNodeColorType.red,d(t));else{r.color=o.default.TreeNodeColorType.red,r.leftChild&&(r.leftChild.color=o.default.TreeNodeColorType.black);n=r.rotateRight();a===r&&(a=n),d(e)}}else if(e===t.rightChild)if(r.color===o.default.TreeNodeColorType.red){r.color=o.default.TreeNodeColorType.black,t.color=o.default.TreeNodeColorType.red;n=t.rotateRight();a===t&&(a=n),d(e)}else if(r.color===o.default.TreeNodeColorType.black)if(r.leftChild&&r.leftChild.color===o.default.TreeNodeColorType.red){r.color=t.color,t.color=o.default.TreeNodeColorType.black,r.leftChild&&(r.leftChild.color=o.default.TreeNodeColorType.black);n=t.rotateRight();a===t&&(a=n),e.color=o.default.TreeNodeColorType.black}else if(r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||!r.rightChild||r.rightChild.color!==o.default.TreeNodeColorType.red)r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||(r.color=o.default.TreeNodeColorType.red,d(t));else{r.color=o.default.TreeNodeColorType.red,r.rightChild&&(r.rightChild.color=o.default.TreeNodeColorType.black);n=r.rotateLeft();a===r&&(a=n),d(e)}}else e.color=o.default.TreeNodeColorType.black},g=function(e){for(var t=e;t.leftChild||t.rightChild;){if(t.rightChild){t=l(t.rightChild);var r=e.key;e.key=t.key,t.key=r;var n=e.value;e.value=t.value,t.value=n,e=t}if(t.leftChild){t=u(t.leftChild);r=e.key;e.key=t.key,t.key=r;n=e.value;e.value=t.value,t.value=n,e=t}}d(t),t&&t.remove(),--s,a.color=o.default.TreeNodeColorType.black},y=function(e,t){return!(!e||void 0===e.key)&&(!!y(e.leftChild,t)||(!!t(e)||y(e.rightChild,t)))};this.eraseElementByPos=function(e){if(e<0||e>=s)throw new Error(\"pos must more than 0 and less than set's size\");var t=0;y(a,function(r){return e===t?(g(r),!0):(++t,!1)})},this.eraseElementByKey=function(e){if(!this.empty()){var r=v(a,e);void 0!==r&&void 0!==r.key&&0===t(r.key,e)&&g(r)}};var b=function(e,r){if(!e||void 0===e.key)throw new Error(\"unknown error\");var n=t(r,e.key);return n<0?e.leftChild?b(e.leftChild,r):(e.leftChild=new o.default,e.leftChild.parent=e,e.leftChild.brother=e.rightChild,e.rightChild&&(e.rightChild.brother=e.leftChild),e.leftChild):n>0?e.rightChild?b(e.rightChild,r):(e.rightChild=new o.default,e.rightChild.parent=e,e.rightChild.brother=e.leftChild,e.leftChild&&(e.leftChild.brother=e.rightChild),e.rightChild):e},m=function(e){var t=e.parent;if(!t){if(e===a)return;throw new Error(\"unknown error\")}if(t.color!==o.default.TreeNodeColorType.black&&t.color===o.default.TreeNodeColorType.red){var r=t.brother,n=t.parent;if(!n)throw new Error(\"unknown error\");if(r&&r.color===o.default.TreeNodeColorType.red)r.color=t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red,m(n);else if(!r||r.color===o.default.TreeNodeColorType.black)if(t===n.leftChild){if(e===t.leftChild){t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red;var i=n.rotateRight();n===a&&(a=i)}else if(e===t.rightChild){i=t.rotateLeft();n===a&&(a=i),m(t)}}else if(t===n.rightChild)if(e===t.leftChild){i=t.rotateRight();n===a&&(a=i),m(t)}else if(e===t.rightChild){t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red;i=n.rotateLeft();n===a&&(a=i)}}};this.setElement=function(e,r){if(null===e||void 0===e)throw new Error(\"to avoid some unnecessary errors, we don't suggest you insert null or undefined here\");if(null!==r&&void 0!==r){if(this.empty())return++s,a.key=e,a.value=r,void(a.color=o.default.TreeNodeColorType.black);var n=b(a,e);void 0===n.key||0!==t(n.key,e)?(++s,n.key=e,n.value=r,m(n),a.color=o.default.TreeNodeColorType.black):n.value=r}else this.eraseElementByKey(e)};var v=function(e,r){if(e&&void 0!==e.key){var n=t(r,e.key);return n<0?v(e.leftChild,r):n>0?v(e.rightChild,r):e}};this.find=function(e){return!!v(a,e)},this.getElementByKey=function(e){var t=v(a,e);if(void 0===(null===t||void 0===t?void 0:t.key)||void 0===(null===t||void 0===t?void 0:t.value))throw new Error(\"unknown error\");return t.value},this.union=function(e){var t=this;e.forEach(function(e){var r=e.key,n=e.value;return t.setElement(r,n)})},this.getHeight=function(){if(this.empty())return 0;var e=function(t){return t?Math.max(e(t.leftChild),e(t.rightChild))+1:1};return e(a)};var w=function(e){return n(this,function(t){switch(t.label){case 0:return e&&void 0!==e.key&&void 0!==e.value?[5,i(w(e.leftChild))]:[2];case 1:return t.sent(),[4,{key:e.key,value:e.value}];case 2:return t.sent(),[5,i(w(e.rightChild))];case 3:return t.sent(),[2]}})};this[Symbol.iterator]=function(){return w(a)},e.forEach(function(e){var t=e.key,n=e.value;return r.setElement(t,n)}),Object.freeze(this)}Object.freeze(s),r.default=s},{\"../Base/TreeNode\":25}],31:[function(e,t,r){\"use strict\";function n(e,t){void 0===e&&(e=[]),t=t||function(e,t){return e>t?-1:e<t?1:0};var r=[];e.forEach(function(e){return r.push(e)});var n=r.length,i=function(e,t){if(e<0||e>=n)throw new Error(\"unknown error\");if(t<0||t>=n)throw new Error(\"unknown error\");var i=r[e];r[e]=r[t],r[t]=i},o=function(e){if(e<0||e>=n)throw new Error(\"unknown error\");var o=2*e+1,s=2*e+2;o<n&&t(r[e],r[o])>0&&i(e,o),s<n&&t(r[e],r[s])>0&&i(e,s)};!function(){for(var e=Math.floor((n-1)/2);e>=0;--e)for(var o=e,s=2*o+1;s<n;){var a=s+1,l=s;if(a<n&&t(r[s],r[a])>0&&(l=a),t(r[o],r[l])<=0)break;i(o,l),s=2*(o=l)+1}}(),this.size=function(){return n},this.empty=function(){return 0===n},this.clear=function(){n=0,r.length=0},this.push=function(e){if(r.push(e),1!==++n)for(var i=n-1;i>0;){var s=Math.floor((i-1)/2);if(t(r[s],e)<=0)break;o(s),i=s}},this.pop=function(){if(!this.empty())if(1!==this.size()){var e=r[n-1];--n;for(var i=0;i<this.size();){var o=2*i+1,s=2*i+2;if(o>=this.size())break;var a=o;if(s<this.size()&&t(r[o],r[s])>0&&(a=s),t(r[a],e)>=0)break;r[i]=r[a],i=a}r[i]=e}else--n},this.top=function(){return r[0]},Object.freeze(this)}Object.defineProperty(r,\"__esModule\",{value:!0}),Object.freeze(n),r.default=n},{}],32:[function(e,t,r){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=e(\"../LinkList/LinkList\");function i(e){void 0===e&&(e=[]);var t=new n.default(e);this.size=function(){return t.size()},this.empty=function(){return t.empty()},this.clear=function(){t.clear()},this.push=function(e){t.pushBack(e)},this.pop=function(){t.popFront()},this.front=function(){return t.front()},Object.freeze(this)}Object.freeze(i),r.default=i},{\"../LinkList/LinkList\":29}],33:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=this&&this.__values||function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(r,\"__esModule\",{value:!0});var o=e(\"../Base/TreeNode\");function s(e,t){var r=this;void 0===e&&(e=[]),t=t||function(e,t){return e<t?-1:e>t?1:0};var s=0,a=new o.default;a.color=o.default.TreeNodeColorType.black,this.size=function(){return s},this.empty=function(){return 0===s},this.clear=function(){s=0,a.key=void 0,a.leftChild=a.rightChild=a.brother=a.parent=void 0,a.color=o.default.TreeNodeColorType.black};var l=function(e){if(!e||void 0===e.key)throw new Error(\"unknown error\");return e.leftChild?l(e.leftChild):e},u=function(e){if(!e||void 0===e.key)throw new Error(\"unknown error\");return e.rightChild?u(e.rightChild):e};this.front=function(){if(!this.empty())return l(a).key},this.back=function(){if(!this.empty())return u(a).key},this.forEach=function(e){var t,r,n=0;try{for(var o=i(this),s=o.next();!s.done;s=o.next()){e(s.value,n++)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},this.getElementByPos=function(e){var t,r;if(e<0||e>=this.size())throw new Error(\"pos must more than 0 and less than set's size\");var n=0;try{for(var o=i(this),s=o.next();!s.done;s=o.next()){var a=s.value;if(n===e)return a;++n}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}throw new Error(\"unknown error\")};var c=function(e){var t=e.parent;if(!t){if(e===a)return;throw new Error(\"unknown error\")}if(e.color!==o.default.TreeNodeColorType.red){var r=e.brother;if(!r)throw new Error(\"unknown error\");if(e===t.leftChild){if(r.color===o.default.TreeNodeColorType.red){r.color=o.default.TreeNodeColorType.black,t.color=o.default.TreeNodeColorType.red;var n=t.rotateLeft();a===t&&(a=n),c(e)}else if(r.color===o.default.TreeNodeColorType.black)if(r.rightChild&&r.rightChild.color===o.default.TreeNodeColorType.red){r.color=t.color,t.color=o.default.TreeNodeColorType.black,r.rightChild&&(r.rightChild.color=o.default.TreeNodeColorType.black);n=t.rotateLeft();a===t&&(a=n),e.color=o.default.TreeNodeColorType.black}else if(r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||!r.leftChild||r.leftChild.color!==o.default.TreeNodeColorType.red)r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||(r.color=o.default.TreeNodeColorType.red,c(t));else{r.color=o.default.TreeNodeColorType.red,r.leftChild&&(r.leftChild.color=o.default.TreeNodeColorType.black);n=r.rotateRight();a===r&&(a=n),c(e)}}else if(e===t.rightChild)if(r.color===o.default.TreeNodeColorType.red){r.color=o.default.TreeNodeColorType.black,t.color=o.default.TreeNodeColorType.red;n=t.rotateRight();a===t&&(a=n),c(e)}else if(r.color===o.default.TreeNodeColorType.black)if(r.leftChild&&r.leftChild.color===o.default.TreeNodeColorType.red){r.color=t.color,t.color=o.default.TreeNodeColorType.black,r.leftChild&&(r.leftChild.color=o.default.TreeNodeColorType.black);n=t.rotateRight();a===t&&(a=n),e.color=o.default.TreeNodeColorType.black}else if(r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||!r.rightChild||r.rightChild.color!==o.default.TreeNodeColorType.red)r.leftChild&&r.leftChild.color!==o.default.TreeNodeColorType.black||r.rightChild&&r.rightChild.color!==o.default.TreeNodeColorType.black||(r.color=o.default.TreeNodeColorType.red,c(t));else{r.color=o.default.TreeNodeColorType.red,r.rightChild&&(r.rightChild.color=o.default.TreeNodeColorType.black);n=r.rotateLeft();a===r&&(a=n),c(e)}}else e.color=o.default.TreeNodeColorType.black},h=function(e){for(var t=e;t.leftChild||t.rightChild;){if(t.rightChild){t=l(t.rightChild);var r=e.key;e.key=t.key,t.key=r,e=t}if(t.leftChild){t=u(t.leftChild);r=e.key;e.key=t.key,t.key=r,e=t}}c(t),t&&t.remove(),--s,a.color=o.default.TreeNodeColorType.black},f=function(e,t){return!(!e||void 0===e.key)&&(!!f(e.leftChild,t)||(!!t(e)||f(e.rightChild,t)))};this.eraseElementByPos=function(e){if(e<0||e>=s)throw new Error(\"pos must more than 0 and less than set's size\");var t=0;f(a,function(r){return e===t?(h(r),!0):(++t,!1)})},this.eraseElementByValue=function(e){if(!this.empty()){var r=g(a,e);void 0!==r&&void 0!==r.key&&0===t(r.key,e)&&h(r)}};var p=function(e,r){if(!e||void 0===e.key)throw new Error(\"unknown error\");var n=t(r,e.key);return n<0?e.leftChild?p(e.leftChild,r):(e.leftChild=new o.default,e.leftChild.parent=e,e.leftChild.brother=e.rightChild,e.rightChild&&(e.rightChild.brother=e.leftChild),e.leftChild):n>0?e.rightChild?p(e.rightChild,r):(e.rightChild=new o.default,e.rightChild.parent=e,e.rightChild.brother=e.leftChild,e.leftChild&&(e.leftChild.brother=e.rightChild),e.rightChild):e},d=function(e){var t=e.parent;if(!t){if(e===a)return;throw new Error(\"unknown error\")}if(t.color!==o.default.TreeNodeColorType.black&&t.color===o.default.TreeNodeColorType.red){var r=t.brother,n=t.parent;if(!n)throw new Error(\"unknown error\");if(r&&r.color===o.default.TreeNodeColorType.red)r.color=t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red,d(n);else if(!r||r.color===o.default.TreeNodeColorType.black)if(t===n.leftChild){if(e===t.leftChild){t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red;var i=n.rotateRight();n===a&&(a=i)}else if(e===t.rightChild){i=t.rotateLeft();n===a&&(a=i),d(t)}}else if(t===n.rightChild)if(e===t.leftChild){i=t.rotateRight();n===a&&(a=i),d(t)}else if(e===t.rightChild){t.color=o.default.TreeNodeColorType.black,n.color=o.default.TreeNodeColorType.red;i=n.rotateLeft();n===a&&(a=i)}}};this.insert=function(e){if(null===e||void 0===e)throw new Error(\"to avoid some unnecessary errors, we don't suggest you insert null or undefined here\");if(this.empty())return++s,a.key=e,void(a.color=o.default.TreeNodeColorType.black);var r=p(a,e);void 0!==r.key&&0===t(r.key,e)||(++s,r.key=e,d(r),a.color=o.default.TreeNodeColorType.black)};var g=function(e,r){if(e&&void 0!==e.key){var n=t(r,e.key);return n<0?g(e.leftChild,r):n>0?g(e.rightChild,r):e}};this.find=function(e){var r=g(a,e);return void 0!==r&&void 0!==r.key&&0===t(r.key,e)};var y=function(e,r){if(e&&void 0!==e.key){var n=t(e.key,r);if(0===n)return e.key;if(n<0)return y(e.rightChild,r);var i=y(e.leftChild,r);return void 0!==i?i:e.key}};this.lowerBound=function(e){return y(a,e)};var b=function(e,r){if(e&&void 0!==e.key){if(t(e.key,r)<=0)return b(e.rightChild,r);var n=b(e.leftChild,r);return void 0!==n?n:e.key}};this.upperBound=function(e){return b(a,e)};var m=function(e,r){if(e&&void 0!==e.key){var n=t(e.key,r);if(0===n)return e.key;if(n>0)return m(e.leftChild,r);var i=m(e.rightChild,r);return void 0!==i?i:e.key}};this.reverseLowerBound=function(e){return m(a,e)};var v=function(e,r){if(e&&void 0!==e.key){if(t(e.key,r)>=0)return v(e.leftChild,r);var n=v(e.rightChild,r);return void 0!==n?n:e.key}};this.reverseUpperBound=function(e){return v(a,e)},this.union=function(e){var t=this;e.forEach(function(e){return t.insert(e)})},this.getHeight=function(){if(this.empty())return 0;var e=function(t){return t?Math.max(e(t.leftChild),e(t.rightChild))+1:1};return e(a)};var w=function(e){return n(this,function(t){switch(t.label){case 0:return e&&void 0!==e.key?[5,i(w(e.leftChild))]:[2];case 1:return t.sent(),[4,e.key];case 2:return t.sent(),[5,i(w(e.rightChild))];case 3:return t.sent(),[2]}})};this[Symbol.iterator]=function(){return w(a)},e.forEach(function(e){return r.insert(e)}),Object.freeze(this)}Object.freeze(s),r.default=s},{\"../Base/TreeNode\":25}],34:[function(e,t,r){\"use strict\";function n(e){var t=this;void 0===e&&(e=[]);var r=0,n=[];this.size=function(){return r},this.empty=function(){return 0===r},this.clear=function(){r=0,n.length=0},this.push=function(e){n.push(e),++r},this.pop=function(){n.pop(),r>0&&--r},this.top=function(){return n[r-1]},e.forEach(function(e){return t.push(e)}),Object.freeze(this)}Object.defineProperty(r,\"__esModule\",{value:!0}),Object.freeze(n),r.default=n},{}],35:[function(e,t,r){\"use strict\";var n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},\"function\"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError(\"Generator is already executing.\");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=this&&this.__read||function(e,t){var r=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},s=this&&this.__values||function(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};function a(e){var t=this;void 0===e&&(e=[]);var r=0,a=[];this.size=function(){return r},this.empty=function(){return 0===r},this.clear=function(){r=0,a.length=0},this.front=function(){if(!this.empty())return a[0]},this.back=function(){if(!this.empty())return a[r-1]},this.forEach=function(e){a.forEach(e)},this.getElementByPos=function(e){if(e<0||e>=r)throw new Error(\"pos must more than 0 and less than vector's size\");return a[e]},this.eraseElementByPos=function(e){if(e<0||e>=r)throw new Error(\"pos must more than 0 and less than vector's size\");for(var t=e;t<r-1;++t)a[t]=a[t+1];this.popBack()},this.eraseElementByValue=function(e){var t=[];this.forEach(function(r){r!==e&&t.push(r)}),t.forEach(function(e,t){a[t]=e});for(var n=t.length;r>n;)this.popBack()},this.pushBack=function(e){a.push(e),++r},this.popBack=function(){a.pop(),r>0&&--r},this.setElementByPos=function(e,t){if(e<0||e>=r)throw new Error(\"pos must more than 0 and less than vector's size\");a[e]=t},this.insert=function(e,t,n){if(void 0===n&&(n=1),e<0||e>r)throw new Error(\"pos must more than 0 and less than or equal to vector's size\");a.splice.apply(a,o([e,0],i(new Array(n).fill(t)),!1)),r+=n},this.find=function(e){return a.includes(e)},this.reverse=function(){a.reverse()},this.unique=function(){var e,t=[];this.forEach(function(r,n){0!==n&&r===e||(t.push(r),e=r)}),t.forEach(function(e,t){a[t]=e});for(var n=t.length;r>n;)this.popBack()},this.sort=function(e){a.sort(e)},this[Symbol.iterator]=function(){return function(){return n(this,function(e){switch(e.label){case 0:return[5,s(a)];case 1:return[2,e.sent()]}})}()},e.forEach(function(e){return t.pushBack(e)}),Object.freeze(this)}Object.defineProperty(r,\"__esModule\",{value:!0}),Object.freeze(a),r.default=a},{}],36:[function(e,t,r){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.HashMap=r.HashSet=r.Map=r.Set=r.PriorityQueue=r.Deque=r.LinkList=r.Queue=r.Stack=r.Vector=void 0;var n=e(\"./Vector/Vector\");r.Vector=n.default;var i=e(\"./Stack/Stack\");r.Stack=i.default;var o=e(\"./Queue/Queue\");r.Queue=o.default;var s=e(\"./LinkList/LinkList\");r.LinkList=s.default;var a=e(\"./Deque/Deque\");r.Deque=a.default;var l=e(\"./PriorityQueue/PriorityQueue\");r.PriorityQueue=l.default;var u=e(\"./Set/Set\");r.Set=u.default;var c=e(\"./Map/Map\");r.Map=c.default;var h=e(\"./HashSet/HashSet\");r.HashSet=h.default;var f=e(\"./HashMap/HashMap\");r.HashMap=f.default},{\"./Deque/Deque\":26,\"./HashMap/HashMap\":27,\"./HashSet/HashSet\":28,\"./LinkList/LinkList\":29,\"./Map/Map\":30,\"./PriorityQueue/PriorityQueue\":31,\"./Queue/Queue\":32,\"./Set/Set\":33,\"./Stack/Stack\":34,\"./Vector/Vector\":35}],37:[function(e,t,r){\"use strict\";const n=e(\"yallist\"),i=Symbol(\"max\"),o=Symbol(\"length\"),s=Symbol(\"lengthCalculator\"),a=Symbol(\"allowStale\"),l=Symbol(\"maxAge\"),u=Symbol(\"dispose\"),c=Symbol(\"noDisposeOnSet\"),h=Symbol(\"lruList\"),f=Symbol(\"cache\"),p=Symbol(\"updateAgeOnGet\"),d=()=>1;const g=(e,t,r)=>{const n=e[f].get(t);if(n){const t=n.value;if(y(e,t)){if(m(e,n),!e[a])return}else r&&(e[p]&&(n.value.now=Date.now()),e[h].unshiftNode(n));return t.value}},y=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[l]&&r>e[l]},b=e=>{if(e[o]>e[i])for(let t=e[h].tail;e[o]>e[i]&&null!==t;){const r=t.prev;m(e,t),t=r}},m=(e,t)=>{if(t){const r=t.value;e[u]&&e[u](r.key,r.value),e[o]-=r.length,e[f].delete(r.key),e[h].removeNode(t)}};class v{constructor(e,t,r,n,i){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=i||0}}const w=(e,t,r,n)=>{let i=r.value;y(e,i)&&(m(e,r),e[a]||(i=void 0)),i&&t.call(n,i.value,i.key,e)};t.exports=class{constructor(e){if(\"number\"==typeof e&&(e={max:e}),e||(e={}),e.max&&(\"number\"!=typeof e.max||e.max<0))throw new TypeError(\"max must be a non-negative number\");this[i]=e.max||1/0;const t=e.length||d;if(this[s]=\"function\"!=typeof t?d:t,this[a]=e.stale||!1,e.maxAge&&\"number\"!=typeof e.maxAge)throw new TypeError(\"maxAge must be a number\");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(\"number\"!=typeof e||e<0)throw new TypeError(\"max must be a non-negative number\");this[i]=e||1/0,b(this)}get max(){return this[i]}set allowStale(e){this[a]=!!e}get allowStale(){return this[a]}set maxAge(e){if(\"number\"!=typeof e)throw new TypeError(\"maxAge must be a non-negative number\");this[l]=e,b(this)}get maxAge(){return this[l]}set lengthCalculator(e){\"function\"!=typeof e&&(e=d),e!==this[s]&&(this[s]=e,this[o]=0,this[h].forEach(e=>{e.length=this[s](e.value,e.key),this[o]+=e.length})),b(this)}get lengthCalculator(){return this[s]}get length(){return this[o]}get itemCount(){return this[h].length}rforEach(e,t){t=t||this;for(let r=this[h].tail;null!==r;){const n=r.prev;w(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[h].head;null!==r;){const n=r.next;w(this,e,r,t),r=n}}keys(){return this[h].toArray().map(e=>e.key)}values(){return this[h].toArray().map(e=>e.value)}reset(){this[u]&&this[h]&&this[h].length&&this[h].forEach(e=>this[u](e.key,e.value)),this[f]=new Map,this[h]=new n,this[o]=0}dump(){return this[h].map(e=>!y(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[h]}set(e,t,r){if((r=r||this[l])&&\"number\"!=typeof r)throw new TypeError(\"maxAge must be a number\");const n=r?Date.now():0,a=this[s](t,e);if(this[f].has(e)){if(a>this[i])return m(this,this[f].get(e)),!1;const s=this[f].get(e).value;return this[u]&&(this[c]||this[u](e,s.value)),s.now=n,s.maxAge=r,s.value=t,this[o]+=a-s.length,s.length=a,this.get(e),b(this),!0}const p=new v(e,t,a,n,r);return p.length>this[i]?(this[u]&&this[u](e,t),!1):(this[o]+=p.length,this[h].unshift(p),this[f].set(e,this[h].head),b(this),!0)}has(e){if(!this[f].has(e))return!1;const t=this[f].get(e).value;return!y(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[h].tail;return e?(m(this,e),e.value):null}del(e){m(this,this[f].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r],i=n.e||0;if(0===i)this.set(n.k,n.v);else{const e=i-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[f].forEach((e,t)=>g(this,t,!1))}}},{yallist:83}],38:[function(e,t,r){(function(e){(function(){const r=t.exports;r.types={0:\"reserved\",1:\"connect\",2:\"connack\",3:\"publish\",4:\"puback\",5:\"pubrec\",6:\"pubrel\",7:\"pubcomp\",8:\"subscribe\",9:\"suback\",10:\"unsubscribe\",11:\"unsuback\",12:\"pingreq\",13:\"pingresp\",14:\"disconnect\",15:\"auth\"},r.codes={};for(const e in r.types){const t=r.types[e];r.codes[t]=e}r.CMD_SHIFT=4,r.CMD_MASK=240,r.DUP_MASK=8,r.QOS_MASK=3,r.QOS_SHIFT=1,r.RETAIN_MASK=1,r.VARBYTEINT_MASK=127,r.VARBYTEINT_FIN_MASK=128,r.VARBYTEINT_MAX=268435455,r.SESSIONPRESENT_MASK=1,r.SESSIONPRESENT_HEADER=e.from([r.SESSIONPRESENT_MASK]),r.CONNACK_HEADER=e.from([r.codes.connack<<r.CMD_SHIFT]),r.USERNAME_MASK=128,r.PASSWORD_MASK=64,r.WILL_RETAIN_MASK=32,r.WILL_QOS_MASK=24,r.WILL_QOS_SHIFT=3,r.WILL_FLAG_MASK=4,r.CLEAN_SESSION_MASK=2,r.CONNECT_HEADER=e.from([r.codes.connect<<r.CMD_SHIFT]),r.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},r.propertiesCodes={};for(const e in r.properties){const t=r.properties[e];r.propertiesCodes[t]=e}function n(t){return[0,1,2].map(n=>[0,1].map(i=>[0,1].map(o=>{const s=e.alloc(1);return s.writeUInt8(r.codes[t]<<r.CMD_SHIFT|(i?r.DUP_MASK:0)|n<<r.QOS_SHIFT|o,0,!0),s})))}r.propertiesTypes={sessionExpiryInterval:\"int32\",willDelayInterval:\"int32\",receiveMaximum:\"int16\",maximumPacketSize:\"int32\",topicAliasMaximum:\"int16\",requestResponseInformation:\"byte\",requestProblemInformation:\"byte\",userProperties:\"pair\",authenticationMethod:\"string\",authenticationData:\"binary\",payloadFormatIndicator:\"byte\",messageExpiryInterval:\"int32\",contentType:\"string\",responseTopic:\"string\",correlationData:\"binary\",maximumQoS:\"int8\",retainAvailable:\"byte\",assignedClientIdentifier:\"string\",reasonString:\"string\",wildcardSubscriptionAvailable:\"byte\",subscriptionIdentifiersAvailable:\"byte\",sharedSubscriptionAvailable:\"byte\",serverKeepAlive:\"int16\",responseInformation:\"string\",serverReference:\"string\",topicAlias:\"int16\",subscriptionIdentifier:\"var\"},r.PUBLISH_HEADER=n(\"publish\"),r.SUBSCRIBE_HEADER=n(\"subscribe\"),r.SUBSCRIBE_OPTIONS_QOS_MASK=3,r.SUBSCRIBE_OPTIONS_NL_MASK=1,r.SUBSCRIBE_OPTIONS_NL_SHIFT=2,r.SUBSCRIBE_OPTIONS_RAP_MASK=1,r.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,r.SUBSCRIBE_OPTIONS_RH_MASK=3,r.SUBSCRIBE_OPTIONS_RH_SHIFT=4,r.SUBSCRIBE_OPTIONS_RH=[0,16,32],r.SUBSCRIBE_OPTIONS_NL=4,r.SUBSCRIBE_OPTIONS_RAP=8,r.SUBSCRIBE_OPTIONS_QOS=[0,1,2],r.UNSUBSCRIBE_HEADER=n(\"unsubscribe\"),r.ACKS={unsuback:n(\"unsuback\"),puback:n(\"puback\"),pubcomp:n(\"pubcomp\"),pubrel:n(\"pubrel\"),pubrec:n(\"pubrec\")},r.SUBACK_HEADER=e.from([r.codes.suback<<r.CMD_SHIFT]),r.VERSION3=e.from([3]),r.VERSION4=e.from([4]),r.VERSION5=e.from([5]),r.VERSION131=e.from([131]),r.VERSION132=e.from([132]),r.QOS=[0,1,2].map(t=>e.from([t])),r.EMPTY={pingreq:e.from([r.codes.pingreq<<4,0]),pingresp:e.from([r.codes.pingresp<<4,0]),disconnect:e.from([r.codes.disconnect<<4,0])}}).call(this)}).call(this,e(\"buffer\").Buffer)},{buffer:17}],39:[function(e,t,r){(function(r){(function(){const n=e(\"./writeToStream\"),i=e(\"events\");class o extends i{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e=0;const t=new Array(this._array.length),n=this._array;let i,o=0;for(i=0;i<n.length&&void 0!==n[i];i++)\"string\"!=typeof n[i]?t[i]=n[i].length:t[i]=r.byteLength(n[i]),e+=t[i];const s=r.allocUnsafe(e);for(i=0;i<n.length&&void 0!==n[i];i++)\"string\"!=typeof n[i]?(n[i].copy(s,o),o+=t[i]):(s.write(n[i],o),o+=t[i]);return s}}t.exports=function(e,t){const r=new o;return n(e,r,t),r.concat()}}).call(this)}).call(this,e(\"buffer\").Buffer)},{\"./writeToStream\":44,buffer:17,events:22}],40:[function(e,t,r){r.parser=e(\"./parser\").parser,r.generate=e(\"./generate\"),r.writeToStream=e(\"./writeToStream\")},{\"./generate\":39,\"./parser\":43,\"./writeToStream\":44}],41:[function(e,t,r){(function(e){(function(){const r=65536,n={},i=e.isBuffer(e.from([1,2]).subarray(0,1));function o(t){const r=e.allocUnsafe(2);return r.writeUInt8(t>>8,0),r.writeUInt8(255&t,1),r}t.exports={cache:n,generateCache:function(){for(let e=0;e<r;e++)n[e]=o(e)},generateNumber:o,genBufVariableByteInt:function(t){let r=0,n=0;const o=e.allocUnsafe(4);do{r=t%128|0,(t=t/128|0)>0&&(r|=128),o.writeUInt8(r,n++)}while(t>0&&n<4);return t>0&&(n=0),i?o.subarray(0,n):o.slice(0,n)},generate4ByteBuffer:function(t){const r=e.allocUnsafe(4);return r.writeUInt32BE(t,0),r}}}).call(this)}).call(this,e(\"buffer\").Buffer)},{buffer:17}],42:[function(e,t,r){t.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}},{}],43:[function(e,t,r){const n=e(\"bl\"),i=e(\"events\"),o=e(\"./packet\"),s=e(\"./constants\"),a=e(\"debug\")(\"mqtt-packet:parser\");class l extends i{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof l?(this.settings=e||{},this._states=[\"_parseHeader\",\"_parseLength\",\"_parsePayload\",\"_newPacket\"],this._resetState(),this):(new l).parser(e)}_resetState(){a(\"_resetState: resetting packet, error, _list, and _stateCounter\"),this.packet=new o,this.error=null,this._list=n(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),a(\"parse: current state: %s\",this._states[this._stateCounter]);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,a(\"parse: state complete. _stateCounter is now: %d\",this._stateCounter),a(\"parse: packet.length: %d, buffer list length: %d\",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return a(\"parse: exited while loop. packet: %d, buffer list length: %d\",this.packet.length,this._list.length),this._list.length}_parseHeader(){const e=this._list.readUInt8(0);return this.packet.cmd=s.types[e>>s.CMD_SHIFT],this.packet.retain=0!=(e&s.RETAIN_MASK),this.packet.qos=e>>s.QOS_SHIFT&s.QOS_MASK,this.packet.dup=0!=(e&s.DUP_MASK),a(\"_parseHeader: packet: %o\",this.packet),this._list.consume(1),!0}_parseLength(){const e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),a(\"_parseLength %d\",e.value),!!e}_parsePayload(){a(\"_parsePayload: payload %O\",this._list);let e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case\"connect\":this._parseConnect();break;case\"connack\":this._parseConnack();break;case\"publish\":this._parsePublish();break;case\"puback\":case\"pubrec\":case\"pubrel\":case\"pubcomp\":this._parseConfirmation();break;case\"subscribe\":this._parseSubscribe();break;case\"suback\":this._parseSuback();break;case\"unsubscribe\":this._parseUnsubscribe();break;case\"unsuback\":this._parseUnsuback();break;case\"pingreq\":case\"pingresp\":break;case\"disconnect\":this._parseDisconnect();break;case\"auth\":this._parseAuth();break;default:this._emitError(new Error(\"Not supported\"))}e=!0}return a(\"_parsePayload complete result: %s\",e),e}_parseConnect(){let e,t,r,n;a(\"_parseConnect\");const i={},o=this.packet,l=this._parseString();if(null===l)return this._emitError(new Error(\"Cannot parse protocolId\"));if(\"MQTT\"!==l&&\"MQIsdp\"!==l)return this._emitError(new Error(\"Invalid protocolId\"));if(o.protocolId=l,this._pos>=this._list.length)return this._emitError(new Error(\"Packet too short\"));if(o.protocolVersion=this._list.readUInt8(this._pos),o.protocolVersion>=128&&(o.bridgeMode=!0,o.protocolVersion=o.protocolVersion-128),3!==o.protocolVersion&&4!==o.protocolVersion&&5!==o.protocolVersion)return this._emitError(new Error(\"Invalid protocol version\"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error(\"Packet too short\"));if(i.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,i.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,i.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK,i.will&&(o.will={},o.will.retain=0!=(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),o.will.qos=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT),o.clean=0!=(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK),this._pos++,o.keepalive=this._parseNum(),-1===o.keepalive)return this._emitError(new Error(\"Packet too short\"));if(5===o.protocolVersion){const e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(o.properties=e)}const u=this._parseString();if(null===u)return this._emitError(new Error(\"Packet too short\"));if(o.clientId=u,a(\"_parseConnect: packet.clientId: %s\",o.clientId),i.will){if(5===o.protocolVersion){const e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(o.will.properties=e)}if(null===(e=this._parseString()))return this._emitError(new Error(\"Cannot parse will topic\"));if(o.will.topic=e,a(\"_parseConnect: packet.will.topic: %s\",o.will.topic),null===(t=this._parseBuffer()))return this._emitError(new Error(\"Cannot parse will payload\"));o.will.payload=t,a(\"_parseConnect: packet.will.paylaod: %s\",o.will.payload)}if(i.username){if(null===(n=this._parseString()))return this._emitError(new Error(\"Cannot parse username\"));o.username=n,a(\"_parseConnect: packet.username: %s\",o.username)}if(i.password){if(null===(r=this._parseBuffer()))return this._emitError(new Error(\"Cannot parse password\"));o.password=r}return this.settings=o,a(\"_parseConnect: complete\"),o}_parseConnack(){a(\"_parseConnack\");const e=this.packet;if(this._list.length<1)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&s.SESSIONPRESENT_MASK),5===this.settings.protocolVersion)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error(\"Cannot parse return code\"));if(5===this.settings.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}a(\"_parseConnack: complete\")}_parsePublish(){a(\"_parsePublish\");const e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error(\"Cannot parse topic\"));if(!(e.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length),a(\"_parsePublish: payload from buffer list: %o\",e.payload)}}_parseSubscribe(){a(\"_parseSubscribe\");const e=this.packet;let t,r,n,i,o,l,u;if(1!==e.qos)return this._emitError(new Error(\"Wrong subscribe header\"));if(e.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){if(null===(t=this._parseString()))return this._emitError(new Error(\"Cannot parse topic\"));if(this._pos>=e.length)return this._emitError(new Error(\"Malformed Subscribe Payload\"));n=(r=this._parseByte())&s.SUBSCRIBE_OPTIONS_QOS_MASK,l=0!=(r>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK),o=0!=(r>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK),i=r>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,u={topic:t,qos:n},5===this.settings.protocolVersion?(u.nl=l,u.rap=o,u.rh=i):this.settings.bridgeMode&&(u.rh=0,u.rap=!0,u.nl=!0),a(\"_parseSubscribe: push subscription `%s` to subscription\",u),e.subscriptions.push(u)}}}_parseSuback(){a(\"_parseSuback\");const e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){a(\"_parseUnsubscribe\");const e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){const t=this._parseString();if(null===t)return this._emitError(new Error(\"Cannot parse topic\"));a(\"_parseUnsubscribe: push topic `%s` to unsubscriptions\",t),e.unsubscriptions.push(t)}}}_parseUnsuback(){a(\"_parseUnsuback\");const e=this.packet;if(!this._parseMessageId())return this._emitError(new Error(\"Cannot parse messageId\"));if(5===this.settings.protocolVersion){const t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){a(\"_parseConfirmation: packet.cmd: `%s`\",this.packet.cmd);const e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&(e.length>2?(e.reasonCode=this._parseByte(),a(\"_parseConfirmation: packet.reasonCode `%d`\",e.reasonCode)):e.reasonCode=0,e.length>3)){const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0}_parseDisconnect(){const e=this.packet;if(a(\"_parseDisconnect\"),5===this.settings.protocolVersion){this._list.length>0?e.reasonCode=this._parseByte():e.reasonCode=0;const t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return a(\"_parseDisconnect result: true\"),!0}_parseAuth(){a(\"_parseAuth\");const e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error(\"Not supported auth packet for this version MQTT\"));e.reasonCode=this._parseByte();const t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),a(\"_parseAuth: result: true\"),!0}_parseMessageId(){const e=this.packet;return e.messageId=this._parseNum(),null===e.messageId?(this._emitError(new Error(\"Cannot parse messageId\")),!1):(a(\"_parseMessageId: packet.messageId %d\",e.messageId),!0)}_parseString(e){const t=this._parseNum(),r=t+this._pos;if(-1===t||r>this._list.length||r>this.packet.length)return null;const n=this._list.toString(\"utf8\",this._pos,r);return this._pos+=t,a(\"_parseString: result: %s\",n),n}_parseStringPair(){return a(\"_parseStringPair\"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){const e=this._parseNum(),t=e+this._pos;if(-1===e||t>this._list.length||t>this.packet.length)return null;const r=this._list.slice(this._pos,t);return this._pos+=e,a(\"_parseBuffer: result: %o\",r),r}_parseNum(){if(this._list.length-this._pos<2)return-1;const e=this._list.readUInt16BE(this._pos);return this._pos+=2,a(\"_parseNum: result: %s\",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;const e=this._list.readUInt32BE(this._pos);return this._pos+=4,a(\"_parse4ByteNum: result: %s\",e),e}_parseVarByteNum(e){a(\"_parseVarByteNum\");let t,r=0,n=1,i=0,o=!1;const l=this._pos?this._pos:0;for(;r<4&&l+r<this._list.length;){if(i+=n*((t=this._list.readUInt8(l+r++))&s.VARBYTEINT_MASK),n*=128,0==(t&s.VARBYTEINT_FIN_MASK)){o=!0;break}if(this._list.length<=r)break}return!o&&4===r&&this._list.length>=r&&this._emitError(new Error(\"Invalid variable byte integer\")),l&&(this._pos+=r),a(\"_parseVarByteNum: result: %o\",o=!!o&&(e?{bytes:r,value:i}:i)),o}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),a(\"_parseByte: result: %o\",e),e}_parseByType(e){switch(a(\"_parseByType: type: %s\",e),e){case\"byte\":return 0!==this._parseByte();case\"int8\":return this._parseByte();case\"int16\":return this._parseNum();case\"int32\":return this._parse4ByteNum();case\"var\":return this._parseVarByteNum();case\"string\":return this._parseString();case\"pair\":return this._parseStringPair();case\"binary\":return this._parseBuffer()}}_parseProperties(){a(\"_parseProperties\");const e=this._parseVarByteNum(),t=this._pos+e,r={};for(;this._pos<t;){const e=this._parseByte();if(!e)return this._emitError(new Error(\"Cannot parse property code type\")),!1;const t=s.propertiesCodes[e];if(!t)return this._emitError(new Error(\"Unknown property\")),!1;if(\"userProperties\"!==t)r[t]?Array.isArray(r[t])?r[t].push(this._parseByType(s.propertiesTypes[t])):(r[t]=[r[t]],r[t].push(this._parseByType(s.propertiesTypes[t]))):r[t]=this._parseByType(s.propertiesTypes[t]);else{r[t]||(r[t]=Object.create(null));const e=this._parseByType(s.propertiesTypes[t]);if(r[t][e.name])if(Array.isArray(r[t][e.name]))r[t][e.name].push(e.value);else{const n=r[t][e.name];r[t][e.name]=[n],r[t][e.name].push(e.value)}else r[t][e.name]=e.value}}return r}_newPacket(){return a(\"_newPacket\"),this.packet&&(this._list.consume(this.packet.length),a(\"_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d\",this.packet.cmd,this.packet.payload,this.packet.length),this.emit(\"packet\",this.packet)),a(\"_newPacket: new packet\"),this.packet=new o,this._pos=0,!0}_emitError(e){a(\"_emitError\"),this.error=e,this.emit(\"error\",e)}}t.exports=l},{\"./constants\":38,\"./packet\":42,bl:15,debug:18,events:22}],44:[function(e,t,r){(function(r){(function(){const n=e(\"./constants\"),i=r.allocUnsafe(0),o=r.from([0]),s=e(\"./numbers\"),a=e(\"process-nextick-args\").nextTick,l=e(\"debug\")(\"mqtt-packet:writeToStream\"),u=s.cache,c=s.generateNumber,h=s.generateCache,f=s.genBufVariableByteInt,p=s.generate4ByteBuffer;let d=k,g=!0;function y(e,t,s){switch(l(\"generate called\"),t.cork&&(t.cork(),a(b,t)),g&&(g=!1,h()),l(\"generate: packet.cmd: %s\",e.cmd),e.cmd){case\"connect\":return function(e,t,i){const o=e||{},s=o.protocolId||\"MQTT\";let a=o.protocolVersion||4;const l=o.will;let u=o.clean;const c=o.keepalive||0,h=o.clientId||\"\",f=o.username,p=o.password,g=o.properties;void 0===u&&(u=!0);let y=0;if(!s||\"string\"!=typeof s&&!r.isBuffer(s))return t.emit(\"error\",new Error(\"Invalid protocolId\")),!1;y+=s.length+2;if(3!==a&&4!==a&&5!==a)return t.emit(\"error\",new Error(\"Invalid protocol version\")),!1;y+=1;if((\"string\"==typeof h||r.isBuffer(h))&&(h||a>=4)&&(h||u))y+=r.byteLength(h)+2;else{if(a<4)return t.emit(\"error\",new Error(\"clientId must be supplied before 3.1.1\")),!1;if(1*u==0)return t.emit(\"error\",new Error(\"clientId must be given if cleanSession set to 0\")),!1}if(\"number\"!=typeof c||c<0||c>65535||c%1!=0)return t.emit(\"error\",new Error(\"Invalid keepalive\")),!1;y+=2;if(y+=1,5===a){var b=C(t,g);if(!b)return!1;y+=b.length}if(l){if(\"object\"!=typeof l)return t.emit(\"error\",new Error(\"Invalid will\")),!1;if(!l.topic||\"string\"!=typeof l.topic)return t.emit(\"error\",new Error(\"Invalid will topic\")),!1;if(y+=r.byteLength(l.topic)+2,y+=2,l.payload){if(!(l.payload.length>=0))return t.emit(\"error\",new Error(\"Invalid will payload\")),!1;\"string\"==typeof l.payload?y+=r.byteLength(l.payload):y+=l.payload.length}var m={};if(5===a){if(!(m=C(t,l.properties)))return!1;y+=m.length}}let _=!1;if(null!=f){if(!P(f))return t.emit(\"error\",new Error(\"Invalid username\")),!1;_=!0,y+=r.byteLength(f)+2}if(null!=p){if(!_)return t.emit(\"error\",new Error(\"Username is required to use password\")),!1;if(!P(p))return t.emit(\"error\",new Error(\"Invalid password\")),!1;y+=I(p)+2}t.write(n.CONNECT_HEADER),v(t,y),E(t,s),o.bridgeMode&&(a+=128);t.write(131===a?n.VERSION131:132===a?n.VERSION132:4===a?n.VERSION4:5===a?n.VERSION5:n.VERSION3);let k=0;k|=null!=f?n.USERNAME_MASK:0,k|=null!=p?n.PASSWORD_MASK:0,k|=l&&l.retain?n.WILL_RETAIN_MASK:0,k|=l&&l.qos?l.qos<<n.WILL_QOS_SHIFT:0,k|=l?n.WILL_FLAG_MASK:0,k|=u?n.CLEAN_SESSION_MASK:0,t.write(r.from([k])),d(t,c),5===a&&b.write();E(t,h),l&&(5===a&&m.write(),w(t,l.topic),E(t,l.payload));null!=f&&E(t,f);null!=p&&E(t,p);return!0}(e,t);case\"connack\":return function(e,t,i){const s=i?i.protocolVersion:4,a=e||{},l=5===s?a.reasonCode:a.returnCode,u=a.properties;let c=2;if(\"number\"!=typeof l)return t.emit(\"error\",new Error(\"Invalid return code\")),!1;let h=null;if(5===s){if(!(h=C(t,u)))return!1;c+=h.length}t.write(n.CONNACK_HEADER),v(t,c),t.write(a.sessionPresent?n.SESSIONPRESENT_HEADER:o),t.write(r.from([l])),null!=h&&h.write();return!0}(e,t,s);case\"publish\":return function(e,t,o){l(\"publish: packet: %o\",e);const s=o?o.protocolVersion:4,a=e||{},u=a.qos||0,c=a.retain?n.RETAIN_MASK:0,h=a.topic,f=a.payload||i,p=a.messageId,g=a.properties;let y=0;if(\"string\"==typeof h)y+=r.byteLength(h)+2;else{if(!r.isBuffer(h))return t.emit(\"error\",new Error(\"Invalid topic\")),!1;y+=h.length+2}r.isBuffer(f)?y+=f.length:y+=r.byteLength(f);if(u&&\"number\"!=typeof p)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;u&&(y+=2);let b=null;if(5===s){if(!(b=C(t,g)))return!1;y+=b.length}t.write(n.PUBLISH_HEADER[u][a.dup?1:0][c?1:0]),v(t,y),d(t,I(h)),t.write(h),u>0&&d(t,p);null!=b&&b.write();return l(\"publish: payload: %o\",f),t.write(f)}(e,t,s);case\"puback\":case\"pubrec\":case\"pubrel\":case\"pubcomp\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.cmd||\"puback\",l=s.messageId,u=s.dup&&\"pubrel\"===a?n.DUP_MASK:0;let c=0;const h=s.reasonCode,f=s.properties;let p=5===o?3:2;\"pubrel\"===a&&(c=1);if(\"number\"!=typeof l)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;let g=null;if(5===o&&\"object\"==typeof f){if(!(g=T(t,f,i,p)))return!1;p+=g.length}t.write(n.ACKS[a][c][u][0]),v(t,p),d(t,l),5===o&&t.write(r.from([h]));null!==g&&g.write();return!0}(e,t,s);case\"subscribe\":return function(e,t,i){l(\"subscribe: packet: \");const o=i?i.protocolVersion:4,s=e||{},a=s.dup?n.DUP_MASK:0,u=s.messageId,c=s.subscriptions,h=s.properties;let f=0;if(\"number\"!=typeof u)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;f+=2;let p=null;if(5===o){if(!(p=C(t,h)))return!1;f+=p.length}if(\"object\"!=typeof c||!c.length)return t.emit(\"error\",new Error(\"Invalid subscriptions\")),!1;for(let e=0;e<c.length;e+=1){const n=c[e].topic,i=c[e].qos;if(\"string\"!=typeof n)return t.emit(\"error\",new Error(\"Invalid subscriptions - invalid topic\")),!1;if(\"number\"!=typeof i)return t.emit(\"error\",new Error(\"Invalid subscriptions - invalid qos\")),!1;if(5===o){const r=c[e].nl||!1;if(\"boolean\"!=typeof r)return t.emit(\"error\",new Error(\"Invalid subscriptions - invalid No Local\")),!1;const n=c[e].rap||!1;if(\"boolean\"!=typeof n)return t.emit(\"error\",new Error(\"Invalid subscriptions - invalid Retain as Published\")),!1;const i=c[e].rh||0;if(\"number\"!=typeof i||i>2)return t.emit(\"error\",new Error(\"Invalid subscriptions - invalid Retain Handling\")),!1}f+=r.byteLength(n)+2+1}l(\"subscribe: writing to stream: %o\",n.SUBSCRIBE_HEADER),t.write(n.SUBSCRIBE_HEADER[1][a?1:0][0]),v(t,f),d(t,u),null!==p&&p.write();let g=!0;for(const e of c){const i=e.topic,s=e.qos,a=+e.nl,l=+e.rap,u=e.rh;let c;w(t,i),c=n.SUBSCRIBE_OPTIONS_QOS[s],5===o&&(c|=a?n.SUBSCRIBE_OPTIONS_NL:0,c|=l?n.SUBSCRIBE_OPTIONS_RAP:0,c|=u?n.SUBSCRIBE_OPTIONS_RH[u]:0),g=t.write(r.from([c]))}return g}(e,t,s);case\"suback\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.granted,u=s.properties;let c=0;if(\"number\"!=typeof a)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;c+=2;if(\"object\"!=typeof l||!l.length)return t.emit(\"error\",new Error(\"Invalid qos vector\")),!1;for(let e=0;e<l.length;e+=1){if(\"number\"!=typeof l[e])return t.emit(\"error\",new Error(\"Invalid qos vector\")),!1;c+=1}let h=null;if(5===o){if(!(h=T(t,u,i,c)))return!1;c+=h.length}t.write(n.SUBACK_HEADER),v(t,c),d(t,a),null!==h&&h.write();return t.write(r.from(l))}(e,t,s);case\"unsubscribe\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.dup?n.DUP_MASK:0,u=s.unsubscriptions,c=s.properties;let h=0;if(\"number\"!=typeof a)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;h+=2;if(\"object\"!=typeof u||!u.length)return t.emit(\"error\",new Error(\"Invalid unsubscriptions\")),!1;for(let e=0;e<u.length;e+=1){if(\"string\"!=typeof u[e])return t.emit(\"error\",new Error(\"Invalid unsubscriptions\")),!1;h+=r.byteLength(u[e])+2}let f=null;if(5===o){if(!(f=C(t,c)))return!1;h+=f.length}t.write(n.UNSUBSCRIBE_HEADER[1][l?1:0][0]),v(t,h),d(t,a),null!==f&&f.write();let p=!0;for(let e=0;e<u.length;e++)p=w(t,u[e]);return p}(e,t,s);case\"unsuback\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.dup?n.DUP_MASK:0,u=s.granted,c=s.properties,h=s.cmd;let f=2;if(\"number\"!=typeof a)return t.emit(\"error\",new Error(\"Invalid messageId\")),!1;if(5===o){if(\"object\"!=typeof u||!u.length)return t.emit(\"error\",new Error(\"Invalid qos vector\")),!1;for(let e=0;e<u.length;e+=1){if(\"number\"!=typeof u[e])return t.emit(\"error\",new Error(\"Invalid qos vector\")),!1;f+=1}}let p=null;if(5===o){if(!(p=T(t,c,i,f)))return!1;f+=p.length}t.write(n.ACKS[h][0][l][0]),v(t,f),d(t,a),null!==p&&p.write();5===o&&t.write(r.from(u));return!0}(e,t,s);case\"pingreq\":case\"pingresp\":return function(e,t,r){return t.write(n.EMPTY[e.cmd])}(e,t);case\"disconnect\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.reasonCode,l=s.properties;let u=5===o?1:0,c=null;if(5===o){if(!(c=T(t,l,i,u)))return!1;u+=c.length}t.write(r.from([n.codes.disconnect<<4])),v(t,u),5===o&&t.write(r.from([a]));null!==c&&c.write();return!0}(e,t,s);case\"auth\":return function(e,t,i){const o=i?i.protocolVersion:4,s=e||{},a=s.reasonCode,l=s.properties;let u=5===o?1:0;5!==o&&t.emit(\"error\",new Error(\"Invalid mqtt version for auth packet\"));const c=T(t,l,i,u);if(!c)return!1;u+=c.length,t.write(r.from([n.codes.auth<<4])),v(t,u),t.write(r.from([a])),null!==c&&c.write();return!0}(e,t,s);default:return t.emit(\"error\",new Error(\"Unknown command\")),!1}}function b(e){e.uncork()}Object.defineProperty(y,\"cacheNumbers\",{get:()=>d===k,set(e){e?(u&&0!==Object.keys(u).length||(g=!0),d=k):(g=!1,d=S)}});const m={};function v(e,t){if(t>n.VARBYTEINT_MAX)return e.emit(\"error\",new Error(`Invalid variable byte integer: ${t}`)),!1;let r=m[t];return r||(r=f(t),t<16384&&(m[t]=r)),l(\"writeVarByteInt: writing to stream: %o\",r),e.write(r)}function w(e,t){const n=r.byteLength(t);return d(e,n),l(\"writeString: %s\",t),e.write(t,\"utf8\")}function _(e,t,r){w(e,t),w(e,r)}function k(e,t){return l(\"writeNumberCached: number: %d\",t),l(\"writeNumberCached: %o\",u[t]),e.write(u[t])}function S(e,t){const r=c(t);return l(\"writeNumberGenerated: %o\",r),e.write(r)}function E(e,t){\"string\"==typeof t?w(e,t):t?(d(e,t.length),e.write(t)):d(e,0)}function C(e,t){if(\"object\"!=typeof t||null!=t.length)return{length:1,write(){A(e,{},0)}};let i=0;function o(t,i){let o=0;switch(n.propertiesTypes[t]){case\"byte\":if(\"boolean\"!=typeof i)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=2;break;case\"int8\":if(\"number\"!=typeof i||i<0||i>255)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=2;break;case\"binary\":if(i&&null===i)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=1+r.byteLength(i)+2;break;case\"int16\":if(\"number\"!=typeof i||i<0||i>65535)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=3;break;case\"int32\":if(\"number\"!=typeof i||i<0||i>4294967295)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=5;break;case\"var\":if(\"number\"!=typeof i||i<0||i>268435455)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=1+r.byteLength(f(i));break;case\"string\":if(\"string\"!=typeof i)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=3+r.byteLength(i.toString());break;case\"pair\":if(\"object\"!=typeof i)return e.emit(\"error\",new Error(`Invalid ${t}: ${i}`)),!1;o+=Object.getOwnPropertyNames(i).reduce((e,t)=>{const n=i[t];return Array.isArray(n)?e+=n.reduce((e,n)=>e+=3+r.byteLength(t.toString())+2+r.byteLength(n.toString()),0):e+=3+r.byteLength(t.toString())+2+r.byteLength(i[t].toString()),e},0);break;default:return e.emit(\"error\",new Error(`Invalid property ${t}: ${i}`)),!1}return o}if(t)for(const e in t){let r=0,n=0;const s=t[e];if(Array.isArray(s))for(let t=0;t<s.length;t++){if(!(n=o(e,s[t])))return!1;r+=n}else{if(!(n=o(e,s)))return!1;r=n}if(!r)return!1;i+=r}return{length:r.byteLength(f(i))+i,write(){A(e,t,i)}}}function T(e,t,r,n){const i=[\"reasonString\",\"userProperties\"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0;let s=C(e,t);if(o)for(;n+s.length>o;){const r=i.shift();if(!r||!t[r])return!1;delete t[r],s=C(e,t)}return s}function x(e,t,i){switch(n.propertiesTypes[t]){case\"byte\":e.write(r.from([n.properties[t]])),e.write(r.from([+i]));break;case\"int8\":e.write(r.from([n.properties[t]])),e.write(r.from([i]));break;case\"binary\":e.write(r.from([n.properties[t]])),E(e,i);break;case\"int16\":e.write(r.from([n.properties[t]])),d(e,i);break;case\"int32\":e.write(r.from([n.properties[t]])),function(e,t){const r=p(t);l(\"write4ByteNumber: %o\",r),e.write(r)}(e,i);break;case\"var\":e.write(r.from([n.properties[t]])),v(e,i);break;case\"string\":e.write(r.from([n.properties[t]])),w(e,i);break;case\"pair\":Object.getOwnPropertyNames(i).forEach(o=>{const s=i[o];Array.isArray(s)?s.forEach(i=>{e.write(r.from([n.properties[t]])),_(e,o.toString(),i.toString())}):(e.write(r.from([n.properties[t]])),_(e,o.toString(),s.toString()))});break;default:return e.emit(\"error\",new Error(`Invalid property ${t} value: ${i}`)),!1}}function A(e,t,r){v(e,r);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&null!==t[r]){const n=t[r];if(Array.isArray(n))for(let t=0;t<n.length;t++)x(e,r,n[t]);else x(e,r,n)}}function I(e){return e?e instanceof r?e.length:r.byteLength(e):0}function P(e){return\"string\"==typeof e||e instanceof r}t.exports=y}).call(this)}).call(this,e(\"buffer\").Buffer)},{\"./constants\":38,\"./numbers\":41,buffer:17,debug:18,\"process-nextick-args\":49}],45:[function(e,t,r){var n=1e3,i=60*n,o=60*i,s=24*o,a=7*s,l=365.25*s;function u(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+\" \"+n+(i?\"s\":\"\")}t.exports=function(e,t){t=t||{};var r=typeof e;if(\"string\"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return r*l;case\"weeks\":case\"week\":case\"w\":return r*a;case\"days\":case\"day\":case\"d\":return r*s;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return r*o;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return r*i;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return r*n;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return r;default:return}}(e);if(\"number\"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return u(e,t,s,\"day\");if(t>=o)return u(e,t,o,\"hour\");if(t>=i)return u(e,t,i,\"minute\");if(t>=n)return u(e,t,n,\"second\");return e+\" ms\"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+\"d\";if(t>=o)return Math.round(e/o)+\"h\";if(t>=i)return Math.round(e/i)+\"m\";if(t>=n)return Math.round(e/n)+\"s\";return e+\"ms\"}(e);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(e))}},{}],46:[function(e,t,r){const n=e(\"./lib/number-allocator.js\");t.exports.NumberAllocator=n},{\"./lib/number-allocator.js\":47}],47:[function(e,t,r){\"use strict\";const n=e(\"js-sdsl\").Set,i=e(\"debug\")(\"number-allocator:trace\"),o=e(\"debug\")(\"number-allocator:error\");function s(e,t){this.low=e,this.high=t}function a(e,t){if(!(this instanceof a))return new a(e,t);this.min=e,this.max=t,this.ss=new n([],(e,t)=>e.compare(t)),i(\"Create\"),this.clear()}s.prototype.equals=function(e){return this.low===e.low&&this.high===e.high},s.prototype.compare=function(e){return this.low<e.low&&this.high<e.low?-1:e.low<this.low&&e.high<this.low?1:0},a.prototype.firstVacant=function(){return 0===this.ss.size()?null:this.ss.front().low},a.prototype.alloc=function(){if(0===this.ss.size())return i(\"alloc():empty\"),null;const e=this.ss.front(),t=e.low;return t+1<=e.high?++e.low:this.ss.eraseElementByPos(0),i(\"alloc():\"+t),t},a.prototype.use=function(e){const t=new s(e,e),r=this.ss.lowerBound(t);if(r){if(r.equals(t))return this.ss.eraseElementByValue(r),i(\"use():\"+e),!0;if(r.low>e)return!1;if(r.low===e)return++r.low,i(\"use():\"+e),!0;if(r.high===e)return--r.high,i(\"use():\"+e),!0;const n=r.low;return r.low=e+1,this.ss.insert(new s(n,e-1)),i(\"use():\"+e),!0}return i(\"use():failed\"),!1},a.prototype.free=function(e){if(e<this.min||e>this.max)return void o(\"free():\"+e+\" is out of range\");const t=new s(e,e),r=this.ss.lowerBound(t);if(r){if(r.low<=e&&e<=r.high)return void o(\"free():\"+e+\" has already been vacant\");if(r===this.ss.front())e+1===r.low?--r.low:this.ss.insert(t);else{const n=this.ss.reverseLowerBound(t);n.high+1===e?e+1===r.low?(this.ss.eraseElementByValue(n),r.low=n.low):n.high=e:e+1===r.low?r.low=e:this.ss.insert(t)}}else{if(r===this.ss.front())return void this.ss.insert(t);const n=this.ss.reverseLowerBound(t);n.high+1===e?n.high=e:this.ss.insert(t)}i(\"free():\"+e)},a.prototype.clear=function(){i(\"clear()\"),this.ss.clear(),this.ss.insert(new s(this.min,this.max))},a.prototype.intervalCount=function(){return this.ss.size()},a.prototype.dump=function(){console.log(\"length:\"+this.ss.size());for(const e of this.ss)console.log(e)},t.exports=a},{debug:18,\"js-sdsl\":36}],48:[function(e,t,r){var n=e(\"wrappy\");function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||\"Function wrapped with `once`\";return t.onceError=r+\" shouldn't be called more than once\",t.called=!1,t}t.exports=n(i),t.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,\"once\",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,\"onceStrict\",{value:function(){return o(this)},configurable:!0})})},{wrappy:79}],49:[function(e,t,r){(function(e){(function(){\"use strict\";void 0===e||!e.version||0===e.version.indexOf(\"v0.\")||0===e.version.indexOf(\"v1.\")&&0!==e.version.indexOf(\"v1.8.\")?t.exports={nextTick:function(t,r,n,i){if(\"function\"!=typeof t)throw new TypeError('\"callback\" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,r)});case 3:return e.nextTick(function(){t.call(null,r,n)});case 4:return e.nextTick(function(){t.call(null,r,n,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this)}).call(this,e(\"_process\"))},{_process:50}],50:[function(e,t,r){var n,i,o=t.exports={};function s(){throw new Error(\"setTimeout has not been defined\")}function a(){throw new Error(\"clearTimeout has not been defined\")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i=\"function\"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var u,c=[],h=!1,f=-1;function p(){h&&u&&(h=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!h){var e=l(p);h=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new g(e,t)),1!==c.length||h||l(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title=\"browser\",o.browser=!0,o.env={},o.argv=[],o.version=\"\",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error(\"process.binding is not supported\")},o.cwd=function(){return\"/\"},o.chdir=function(e){throw new Error(\"process.chdir is not supported\")},o.umask=function(){return 0}},{}],51:[function(e,t,r){(function(e){(function(){!function(n){var i=\"object\"==typeof r&&r&&!r.nodeType&&r,o=\"object\"==typeof t&&t&&!t.nodeType&&t,s=\"object\"==typeof e&&e;s.global!==s&&s.window!==s&&s.self!==s||(n=s);var a,l,u=2147483647,c=36,h=1,f=26,p=38,d=700,g=72,y=128,b=\"-\",m=/^xn--/,v=/[^\\x20-\\x7E]/,w=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,_={overflow:\"Overflow: input needs wider integers to process\",\"not-basic\":\"Illegal input >= 0x80 (not a basic code point)\",\"invalid-input\":\"Invalid input\"},k=c-h,S=Math.floor,E=String.fromCharCode;function C(e){throw new RangeError(_[e])}function T(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function x(e,t){var r=e.split(\"@\"),n=\"\";return r.length>1&&(n=r[0]+\"@\",e=r[1]),n+T((e=e.replace(w,\".\")).split(\".\"),t).join(\".\")}function A(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function I(e){return T(e,function(e){var t=\"\";return e>65535&&(t+=E((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=E(e)}).join(\"\")}function P(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function O(e,t,r){var n=0;for(e=r?S(e/d):e>>1,e+=S(e/t);e>k*f>>1;n+=c)e=S(e/k);return S(n+(k+1)*e/(e+p))}function B(e){var t,r,n,i,o,s,a,l,p,d,m,v=[],w=e.length,_=0,k=y,E=g;for((r=e.lastIndexOf(b))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&C(\"not-basic\"),v.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<w;){for(o=_,s=1,a=c;i>=w&&C(\"invalid-input\"),((l=(m=e.charCodeAt(i++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:c)>=c||l>S((u-_)/s))&&C(\"overflow\"),_+=l*s,!(l<(p=a<=E?h:a>=E+f?f:a-E));a+=c)s>S(u/(d=c-p))&&C(\"overflow\"),s*=d;E=O(_-o,t=v.length+1,0==o),S(_/t)>u-k&&C(\"overflow\"),k+=S(_/t),_%=t,v.splice(_++,0,k)}return I(v)}function R(e){var t,r,n,i,o,s,a,l,p,d,m,v,w,_,k,T=[];for(v=(e=A(e)).length,t=y,r=0,o=g,s=0;s<v;++s)(m=e[s])<128&&T.push(E(m));for(n=i=T.length,i&&T.push(b);n<v;){for(a=u,s=0;s<v;++s)(m=e[s])>=t&&m<a&&(a=m);for(a-t>S((u-r)/(w=n+1))&&C(\"overflow\"),r+=(a-t)*w,t=a,s=0;s<v;++s)if((m=e[s])<t&&++r>u&&C(\"overflow\"),m==t){for(l=r,p=c;!(l<(d=p<=o?h:p>=o+f?f:p-o));p+=c)k=l-d,_=c-d,T.push(E(P(d+k%_,0))),l=S(k/_);T.push(E(P(l,0))),o=O(r,w,n==i),r=0,++n}++r,++t}return T.join(\"\")}if(a={version:\"1.4.1\",ucs2:{decode:A,encode:I},decode:B,encode:R,toASCII:function(e){return x(e,function(e){return v.test(e)?\"xn--\"+R(e):e})},toUnicode:function(e){return x(e,function(e){return m.test(e)?B(e.slice(4).toLowerCase()):e})}},i&&o)if(t.exports==i)o.exports=a;else for(l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);else n.punycode=a}(this)}).call(this)}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],52:[function(e,t,r){\"use strict\";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,o){t=t||\"&\",r=r||\"=\";var s={};if(\"string\"!=typeof e||0===e.length)return s;var a=/\\+/g;e=e.split(t);var l=1e3;o&&\"number\"==typeof o.maxKeys&&(l=o.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,f,p,d,g=e[c].replace(a,\"%20\"),y=g.indexOf(r);y>=0?(h=g.substr(0,y),f=g.substr(y+1)):(h=g,f=\"\"),p=decodeURIComponent(h),d=decodeURIComponent(f),n(s,p)?i(s[p])?s[p].push(d):s[p]=[s[p],d]:s[p]=d}return s};var i=Array.isArray||function(e){return\"[object Array]\"===Object.prototype.toString.call(e)}},{}],53:[function(e,t,r){\"use strict\";var n=function(e){switch(typeof e){case\"string\":return e;case\"boolean\":return e?\"true\":\"false\";case\"number\":return isFinite(e)?e:\"\";default:return\"\"}};t.exports=function(e,t,r,a){return t=t||\"&\",r=r||\"=\",null===e&&(e=void 0),\"object\"==typeof e?o(s(e),function(s){var a=encodeURIComponent(n(s))+r;return i(e[s])?o(e[s],function(e){return a+encodeURIComponent(n(e))}).join(t):a+encodeURIComponent(n(e[s]))}).join(t):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(e)):\"\"};var i=Array.isArray||function(e){return\"[object Array]\"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],54:[function(e,t,r){\"use strict\";r.decode=r.parse=e(\"./decode\"),r.encode=r.stringify=e(\"./encode\")},{\"./decode\":52,\"./encode\":53}],55:[function(e,t,r){\"use strict\";var n={};function i(e,t,r){r||(r=Error);var i=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return\"string\"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);i.prototype.name=r.name,i.prototype.code=e,n[e]=i}function o(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(e){return String(e)}),r>2?\"one of \".concat(t,\" \").concat(e.slice(0,r-1).join(\", \"),\", or \")+e[r-1]:2===r?\"one of \".concat(t,\" \").concat(e[0],\" or \").concat(e[1]):\"of \".concat(t,\" \").concat(e[0])}return\"of \".concat(t,\" \").concat(String(e))}i(\"ERR_INVALID_OPT_VALUE\",function(e,t){return'The value \"'+t+'\" is invalid for option \"'+e+'\"'},TypeError),i(\"ERR_INVALID_ARG_TYPE\",function(e,t,r){var n,i,s,a;if(\"string\"==typeof t&&(i=\"not \",t.substr(!s||s<0?0:+s,i.length)===i)?(n=\"must not be\",t=t.replace(/^not /,\"\")):n=\"must be\",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e,\" argument\"))a=\"The \".concat(e,\" \").concat(n,\" \").concat(o(t,\"type\"));else{var l=function(e,t,r){return\"number\"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}(e,\".\")?\"property\":\"argument\";a='The \"'.concat(e,'\" ').concat(l,\" \").concat(n,\" \").concat(o(t,\"type\"))}return a+=\". Received type \".concat(typeof r)},TypeError),i(\"ERR_STREAM_PUSH_AFTER_EOF\",\"stream.push() after EOF\"),i(\"ERR_METHOD_NOT_IMPLEMENTED\",function(e){return\"The \"+e+\" method is not implemented\"}),i(\"ERR_STREAM_PREMATURE_CLOSE\",\"Premature close\"),i(\"ERR_STREAM_DESTROYED\",function(e){return\"Cannot call \"+e+\" after a stream was destroyed\"}),i(\"ERR_MULTIPLE_CALLBACK\",\"Callback called multiple times\"),i(\"ERR_STREAM_CANNOT_PIPE\",\"Cannot pipe, not readable\"),i(\"ERR_STREAM_WRITE_AFTER_END\",\"write after end\"),i(\"ERR_STREAM_NULL_VALUES\",\"May not write null values to stream\",TypeError),i(\"ERR_UNKNOWN_ENCODING\",function(e){return\"Unknown encoding: \"+e},TypeError),i(\"ERR_STREAM_UNSHIFT_AFTER_END_EVENT\",\"stream.unshift() after end event\"),t.exports.codes=n},{}],56:[function(e,t,r){(function(r){(function(){\"use strict\";var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=u;var i=e(\"./_stream_readable\"),o=e(\"./_stream_writable\");e(\"inherits\")(u,i);for(var s=n(o.prototype),a=0;a<s.length;a++){var l=s[a];u.prototype[l]||(u.prototype[l]=o.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once(\"end\",c)))}function c(){this._writableState.ended||r.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(u.prototype,\"writableHighWaterMark\",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,\"writableBuffer\",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,\"writableLength\",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,\"destroyed\",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e(\"_process\"))},{\"./_stream_readable\":58,\"./_stream_writable\":60,_process:50,inherits:24}],57:[function(e,t,r){\"use strict\";t.exports=i;var n=e(\"./_stream_transform\");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}e(\"inherits\")(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},{\"./_stream_transform\":59,inherits:24}],58:[function(e,t,r){(function(r,n){(function(){\"use strict\";var i;t.exports=C,C.ReadableState=E;e(\"events\").EventEmitter;var o=function(e,t){return e.listeners(t).length},s=e(\"./internal/streams/stream\"),a=e(\"buffer\").Buffer,l=n.Uint8Array||function(){};var u,c=e(\"util\");u=c&&c.debuglog?c.debuglog(\"stream\"):function(){};var h,f,p,d=e(\"./internal/streams/buffer_list\"),g=e(\"./internal/streams/destroy\"),y=e(\"./internal/streams/state\").getHighWaterMark,b=e(\"../errors\").codes,m=b.ERR_INVALID_ARG_TYPE,v=b.ERR_STREAM_PUSH_AFTER_EOF,w=b.ERR_METHOD_NOT_IMPLEMENTED,_=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e(\"inherits\")(C,s);var k=g.errorOrDestroy,S=[\"error\",\"close\",\"destroy\",\"pause\",\"resume\"];function E(t,r,n){i=i||e(\"./_stream_duplex\"),t=t||{},\"boolean\"!=typeof n&&(n=r instanceof i),this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=y(this,t,\"readableHighWaterMark\",n),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||\"utf8\",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(h||(h=e(\"string_decoder/\").StringDecoder),this.decoder=new h(t.encoding),this.encoding=t.encoding)}function C(t){if(i=i||e(\"./_stream_duplex\"),!(this instanceof C))return new C(t);var r=this instanceof i;this._readableState=new E(t,this,r),this.readable=!0,t&&(\"function\"==typeof t.read&&(this._read=t.read),\"function\"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function T(e,t,r,n,i){u(\"readableAddChunk\",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(u(\"onEofChunk\"),t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}(e,s);else if(i||(o=function(e,t){var r;n=t,a.isBuffer(n)||n instanceof l||\"string\"==typeof t||void 0===t||e.objectMode||(r=new m(\"chunk\",[\"string\",\"Buffer\",\"Uint8Array\"],t));var n;return r}(s,t)),o)k(e,o);else if(s.objectMode||t&&t.length>0)if(\"string\"==typeof t||s.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),n)s.endEmitted?k(e,new _):x(e,s,t,!0);else if(s.ended)k(e,new v);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!r?(t=s.decoder.write(t),s.objectMode||0!==t.length?x(e,s,t,!1):B(e,s)):x(e,s,t,!1)}else n||(s.reading=!1,B(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function x(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit(\"data\",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&P(e)),B(e,t)}Object.defineProperty(C.prototype,\"destroyed\",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),C.prototype.destroy=g.destroy,C.prototype._undestroy=g.undestroy,C.prototype._destroy=function(e,t){t(e)},C.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:\"string\"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=a.from(e,t),t=\"\"),r=!0),T(this,e,t,!1,r)},C.prototype.unshift=function(e){return T(this,e,null,!0,!1)},C.prototype.isPaused=function(){return!1===this._readableState.flowing},C.prototype.setEncoding=function(t){h||(h=e(\"string_decoder/\").StringDecoder);var r=new h(t);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i=\"\";null!==n;)i+=r.write(n.data),n=n.next;return this._readableState.buffer.clear(),\"\"!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var A=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;u(\"emitReadable\",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(u(\"emitReadable\",t.flowing),t.emittedReadable=!0,r.nextTick(O,e))}function O(e){var t=e._readableState;u(\"emitReadable_\",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit(\"readable\"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,j(e)}function B(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(R,e,t))}function R(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(u(\"maybeReadMore read 0\"),e.read(0),r===t.length)break}t.readingMore=!1}function M(e){var t=e._readableState;t.readableListening=e.listenerCount(\"readable\")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount(\"data\")>0&&e.resume()}function N(e){u(\"readable nexttick read 0\"),e.read(0)}function L(e,t){u(\"resume\",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit(\"resume\"),j(e),t.flowing&&!t.reading&&e.read(0)}function j(e){var t=e._readableState;for(u(\"flow\",t.flowing);t.flowing&&null!==e.read(););}function U(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(\"\"):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function q(e){var t=e._readableState;u(\"endReadable\",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(D,t,e))}function D(e,t){if(u(\"endReadableNT\",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit(\"end\"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function z(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}C.prototype.read=function(e){u(\"read\",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u(\"read: emitReadable\",t.length,t.ended),0===t.length&&t.ended?q(this):P(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&q(this),null;var n,i=t.needReadable;return u(\"need readable\",i),(0===t.length||t.length-e<t.highWaterMark)&&u(\"length less than watermark\",i=!0),t.ended||t.reading?u(\"reading or ended\",i=!1):i&&(u(\"do read\"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(r,t))),null===(n=e>0?U(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&q(this)),null!==n&&this.emit(\"data\",n),n},C.prototype._read=function(e){k(this,new w(\"_read()\"))},C.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,u(\"pipe count=%d opts=%j\",i.pipesCount,t);var s=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?l:y;function a(t,r){u(\"onunpipe\"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,u(\"cleanup\"),e.removeListener(\"close\",d),e.removeListener(\"finish\",g),e.removeListener(\"drain\",c),e.removeListener(\"error\",p),e.removeListener(\"unpipe\",a),n.removeListener(\"end\",l),n.removeListener(\"end\",y),n.removeListener(\"data\",f),h=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}function l(){u(\"onend\"),e.end()}i.endEmitted?r.nextTick(s):n.once(\"end\",s),e.on(\"unpipe\",a);var c=function(e){return function(){var t=e._readableState;u(\"pipeOnDrain\",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,\"data\")&&(t.flowing=!0,j(e))}}(n);e.on(\"drain\",c);var h=!1;function f(t){u(\"ondata\");var r=e.write(t);u(\"dest.write\",r),!1===r&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==z(i.pipes,e))&&!h&&(u(\"false write response, pause\",i.awaitDrain),i.awaitDrain++),n.pause())}function p(t){u(\"onerror\",t),y(),e.removeListener(\"error\",p),0===o(e,\"error\")&&k(e,t)}function d(){e.removeListener(\"finish\",g),y()}function g(){u(\"onfinish\"),e.removeListener(\"close\",d),y()}function y(){u(\"unpipe\"),n.unpipe(e)}return n.on(\"data\",f),function(e,t,r){if(\"function\"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,\"error\",p),e.once(\"close\",d),e.once(\"finish\",g),e.emit(\"pipe\",n),i.flowing||(u(\"pipe resume\"),n.resume()),e},C.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit(\"unpipe\",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit(\"unpipe\",this,{hasUnpiped:!1});return this}var s=z(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit(\"unpipe\",this,r),this)},C.prototype.on=function(e,t){var n=s.prototype.on.call(this,e,t),i=this._readableState;return\"data\"===e?(i.readableListening=this.listenerCount(\"readable\")>0,!1!==i.flowing&&this.resume()):\"readable\"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,u(\"on readable\",i.length,i.reading),i.length?P(this):i.reading||r.nextTick(N,this))),n},C.prototype.addListener=C.prototype.on,C.prototype.removeListener=function(e,t){var n=s.prototype.removeListener.call(this,e,t);return\"readable\"===e&&r.nextTick(M,this),n},C.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return\"readable\"!==e&&void 0!==e||r.nextTick(M,this),t},C.prototype.resume=function(){var e=this._readableState;return e.flowing||(u(\"resume\"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(L,e,t))}(this,e)),e.paused=!1,this},C.prototype.pause=function(){return u(\"call pause flowing=%j\",this._readableState.flowing),!1!==this._readableState.flowing&&(u(\"pause\"),this._readableState.flowing=!1,this.emit(\"pause\")),this._readableState.paused=!0,this},C.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on(\"end\",function(){if(u(\"wrapped end\"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on(\"data\",function(i){(u(\"wrapped data\"),r.decoder&&(i=r.decoder.write(i)),!r.objectMode||null!==i&&void 0!==i)&&((r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause())))}),e)void 0===this[i]&&\"function\"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<S.length;o++)e.on(S[o],this.emit.bind(this,S[o]));return this._read=function(t){u(\"wrapped _read\",t),n&&(n=!1,e.resume())},this},\"function\"==typeof Symbol&&(C.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=e(\"./internal/streams/async_iterator\")),f(this)}),Object.defineProperty(C.prototype,\"readableHighWaterMark\",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(C.prototype,\"readableBuffer\",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(C.prototype,\"readableFlowing\",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),C._fromList=U,Object.defineProperty(C.prototype,\"readableLength\",{enumerable:!1,get:function(){return this._readableState.length}}),\"function\"==typeof Symbol&&(C.from=function(t,r){return void 0===p&&(p=e(\"./internal/streams/from\")),p(C,t,r)})}).call(this)}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../errors\":55,\"./_stream_duplex\":56,\"./internal/streams/async_iterator\":61,\"./internal/streams/buffer_list\":62,\"./internal/streams/destroy\":63,\"./internal/streams/from\":65,\"./internal/streams/state\":67,\"./internal/streams/stream\":68,_process:50,buffer:17,events:22,inherits:24,\"string_decoder/\":75,util:16}],59:[function(e,t,r){\"use strict\";t.exports=u;var n=e(\"../errors\").codes,i=n.ERR_METHOD_NOT_IMPLEMENTED,o=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,l=e(\"./_stream_duplex\");function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit(\"error\",new o);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(\"function\"==typeof e.transform&&(this._transform=e.transform),\"function\"==typeof e.flush&&(this._flush=e.flush)),this.on(\"prefinish\",c)}function c(){var e=this;\"function\"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush(function(t,r){h(e,t,r)})}function h(e,t,r){if(t)return e.emit(\"error\",t);if(null!=r&&e.push(r),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}e(\"inherits\")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,r){r(new i(\"_transform()\"))},u.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},{\"../errors\":55,\"./_stream_duplex\":56,inherits:24}],60:[function(e,t,r){(function(r,n){(function(){\"use strict\";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=C,C.WritableState=E;var s={deprecate:e(\"util-deprecate\")},a=e(\"./internal/streams/stream\"),l=e(\"buffer\").Buffer,u=n.Uint8Array||function(){};var c,h=e(\"./internal/streams/destroy\"),f=e(\"./internal/streams/state\").getHighWaterMark,p=e(\"../errors\").codes,d=p.ERR_INVALID_ARG_TYPE,g=p.ERR_METHOD_NOT_IMPLEMENTED,y=p.ERR_MULTIPLE_CALLBACK,b=p.ERR_STREAM_CANNOT_PIPE,m=p.ERR_STREAM_DESTROYED,v=p.ERR_STREAM_NULL_VALUES,w=p.ERR_STREAM_WRITE_AFTER_END,_=p.ERR_UNKNOWN_ENCODING,k=h.errorOrDestroy;function S(){}function E(t,n,s){o=o||e(\"./_stream_duplex\"),t=t||{},\"boolean\"!=typeof s&&(s=n instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=f(this,t,\"writableHighWaterMark\",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||\"utf8\",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if(\"function\"!=typeof o)throw new y;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,o){--t.pendingcb,n?(r.nextTick(o,i),r.nextTick(O,e,t),e._writableState.errorEmitted=!0,k(e,i)):(o(i),e._writableState.errorEmitted=!0,k(e,i),O(e,t))}(e,n,i,t,o);else{var s=I(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||A(e,n),i?r.nextTick(x,e,n,s,o):x(e,n,s,o)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function C(t){var r=this instanceof(o=o||e(\"./_stream_duplex\"));if(!r&&!c.call(C,this))return new C(t);this._writableState=new E(t,this,r),this.writable=!0,t&&(\"function\"==typeof t.write&&(this._write=t.write),\"function\"==typeof t.writev&&(this._writev=t.writev),\"function\"==typeof t.destroy&&(this._destroy=t.destroy),\"function\"==typeof t.final&&(this._final=t.final)),a.call(this)}function T(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new m(\"write\")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function x(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit(\"drain\"))}(e,t),t.pendingcb--,n(),O(e,t)}function A(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var a=0,l=!0;r;)o[a]=r,r.isBuf||(l=!1),r=r.next,a+=1;o.allBuffers=l,T(e,t,!0,t.length,o,\"\",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,h=r.callback;if(T(e,t,!1,t.objectMode?1:u.length,u,c,h),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final(function(r){t.pendingcb--,r&&k(e,r),t.prefinished=!0,e.emit(\"prefinish\"),O(e,t)})}function O(e,t){var n=I(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||(\"function\"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit(\"prefinish\")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit(\"finish\"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}e(\"inherits\")(C,a),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,\"buffer\",{get:s.deprecate(function(){return this.getBuffer()},\"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.\",\"DEP0003\")})}catch(e){}}(),\"function\"==typeof Symbol&&Symbol.hasInstance&&\"function\"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(C,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===C&&(e&&e._writableState instanceof E)}})):c=function(e){return e instanceof this},C.prototype.pipe=function(){k(this,new b)},C.prototype.write=function(e,t,n){var i,o=this._writableState,s=!1,a=!o.objectMode&&(i=e,l.isBuffer(i)||i instanceof u);return a&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),\"function\"==typeof t&&(n=t,t=null),a?t=\"buffer\":t||(t=o.defaultEncoding),\"function\"!=typeof n&&(n=S),o.ending?function(e,t){var n=new w;k(e,n),r.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var o;return null===n?o=new v:\"string\"==typeof n||t.objectMode||(o=new d(\"chunk\",[\"string\",\"Buffer\"],n)),!o||(k(e,o),r.nextTick(i,o),!1)}(this,o,e,n))&&(o.pendingcb++,s=function(e,t,r,n,i,o){if(!r){var s=function(e,t,r){e.objectMode||!1===e.decodeStrings||\"string\"!=typeof t||(t=l.from(t,r));return t}(t,n,i);n!==s&&(r=!0,i=\"buffer\",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,a,n,i,o);return u}(this,o,a,e,t,n)),s},C.prototype.cork=function(){this._writableState.corked++},C.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},C.prototype.setDefaultEncoding=function(e){if(\"string\"==typeof e&&(e=e.toLowerCase()),!([\"hex\",\"utf8\",\"utf-8\",\"ascii\",\"binary\",\"base64\",\"ucs2\",\"ucs-2\",\"utf16le\",\"utf-16le\",\"raw\"].indexOf((e+\"\").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(C.prototype,\"writableBuffer\",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(C.prototype,\"writableHighWaterMark\",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),C.prototype._write=function(e,t,r){r(new g(\"_write()\"))},C.prototype._writev=null,C.prototype.end=function(e,t,n){var i=this._writableState;return\"function\"==typeof e?(n=e,e=null,t=null):\"function\"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,O(e,t),n&&(t.finished?r.nextTick(n):e.once(\"finish\",n));t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(C.prototype,\"writableLength\",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(C.prototype,\"destroyed\",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),C.prototype.destroy=h.destroy,C.prototype._undestroy=h.undestroy,C.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e(\"_process\"),\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../errors\":55,\"./_stream_duplex\":56,\"./internal/streams/destroy\":63,\"./internal/streams/state\":67,\"./internal/streams/stream\":68,_process:50,buffer:17,inherits:24,\"util-deprecate\":78}],61:[function(e,t,r){(function(r){(function(){\"use strict\";var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=e(\"./end-of-stream\"),s=Symbol(\"lastResolve\"),a=Symbol(\"lastReject\"),l=Symbol(\"error\"),u=Symbol(\"ended\"),c=Symbol(\"lastPromise\"),h=Symbol(\"handlePromise\"),f=Symbol(\"stream\");function p(e,t){return{value:e,done:t}}function d(e){var t=e[s];if(null!==t){var r=e[f].read();null!==r&&(e[c]=null,e[s]=null,e[a]=null,t(p(r,!1)))}}var g=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((i(n={get stream(){return this[f]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise(function(t,n){r.nextTick(function(){e[l]?n(e[l]):t(p(void 0,!0))})});var n,i=this[c];if(i)n=new Promise(function(e,t){return function(r,n){e.then(function(){t[u]?r(p(void 0,!0)):t[h](r,n)},n)}}(i,this));else{var o=this[f].read();if(null!==o)return Promise.resolve(p(o,!1));n=new Promise(this[h])}return this[c]=n,n}},Symbol.asyncIterator,function(){return this}),i(n,\"return\",function(){var e=this;return new Promise(function(t,r){e[f].destroy(null,function(e){e?r(e):t(p(void 0,!0))})})}),n),g);t.exports=function(e){var t,n=Object.create(y,(i(t={},f,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,a,{value:null,writable:!0}),i(t,l,{value:null,writable:!0}),i(t,u,{value:e._readableState.endEmitted,writable:!0}),i(t,h,{value:function(e,t){var r=n[f].read();r?(n[c]=null,n[s]=null,n[a]=null,e(p(r,!1))):(n[s]=e,n[a]=t)},writable:!0}),t));return n[c]=null,o(e,function(e){if(e&&\"ERR_STREAM_PREMATURE_CLOSE\"!==e.code){var t=n[a];return null!==t&&(n[c]=null,n[s]=null,n[a]=null,t(e)),void(n[l]=e)}var r=n[s];null!==r&&(n[c]=null,n[s]=null,n[a]=null,r(p(void 0,!0))),n[u]=!0}),e.on(\"readable\",function(e){r.nextTick(d,e)}.bind(null,n)),n}}).call(this)}).call(this,e(\"_process\"))},{\"./end-of-stream\":64,_process:50}],62:[function(e,t,r){\"use strict\";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e(\"buffer\").Buffer,a=e(\"util\").inspect,l=a&&a.custom||\"inspect\";t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),this.head=null,this.tail=null,this.length=0}var t,r,u;return t=e,(r=[{key:\"push\",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:\"unshift\",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:\"shift\",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:\"clear\",value:function(){this.head=this.tail=null,this.length=0}},{key:\"join\",value:function(e){if(0===this.length)return\"\";for(var t=this.head,r=\"\"+t.data;t=t.next;)r+=e+t.data;return r}},{key:\"concat\",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,n,i=s.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,r=i,n=a,s.prototype.copy.call(t,r,n),a+=o.data.length,o=o.next;return i}},{key:\"consume\",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:\"first\",value:function(){return this.head.data}},{key:\"_getString\",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0===(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:\"_getBuffer\",value:function(e){var t=s.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0===(e-=o)){o===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(o));break}++n}return this.length-=n,t}},{key:l,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t,{depth:0,customInspect:!1}))}}])&&o(t.prototype,r),u&&o(t,u),e}()},{buffer:17,util:16}],63:[function(e,t,r){(function(e){(function(){\"use strict\";function r(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit(\"close\")}function i(e,t){e.emit(\"error\",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(i,this,t)):e.nextTick(i,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(n,s):(s._writableState.errorEmitted=!0,e.nextTick(r,s,t)):e.nextTick(r,s,t):o?(e.nextTick(n,s),o(t)):e.nextTick(n,s)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit(\"error\",t)}}}).call(this)}).call(this,e(\"_process\"))},{_process:50}],64:[function(e,t,r){\"use strict\";var n=e(\"../../../errors\").codes.ERR_STREAM_PREMATURE_CLOSE;function i(){}t.exports=function e(t,r,o){if(\"function\"==typeof r)return e(t,null,r);r||(r={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||i);var s=r.readable||!1!==r.readable&&t.readable,a=r.writable||!1!==r.writable&&t.writable,l=function(){t.writable||c()},u=t._writableState&&t._writableState.finished,c=function(){a=!1,u=!0,s||o.call(t)},h=t._readableState&&t._readableState.endEmitted,f=function(){s=!1,h=!0,a||o.call(t)},p=function(e){o.call(t,e)},d=function(){var e;return s&&!h?(t._readableState&&t._readableState.ended||(e=new n),o.call(t,e)):a&&!u?(t._writableState&&t._writableState.ended||(e=new n),o.call(t,e)):void 0},g=function(){t.req.on(\"finish\",c)};return function(e){return e.setHeader&&\"function\"==typeof e.abort}(t)?(t.on(\"complete\",c),t.on(\"abort\",d),t.req?g():t.on(\"request\",g)):a&&!t._writableState&&(t.on(\"end\",l),t.on(\"close\",l)),t.on(\"end\",f),t.on(\"finish\",c),!1!==r.error&&t.on(\"error\",p),t.on(\"close\",d),function(){t.removeListener(\"complete\",c),t.removeListener(\"abort\",d),t.removeListener(\"request\",g),t.req&&t.req.removeListener(\"finish\",c),t.removeListener(\"end\",l),t.removeListener(\"close\",l),t.removeListener(\"finish\",c),t.removeListener(\"end\",f),t.removeListener(\"error\",p),t.removeListener(\"close\",d)}}},{\"../../../errors\":55}],65:[function(e,t,r){t.exports=function(){throw new Error(\"Readable.from is not available in the browser\")}},{}],66:[function(e,t,r){\"use strict\";var n;var i=e(\"../../../errors\").codes,o=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(e){e()}function u(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var c,h=function(e){return e.length?\"function\"!=typeof e[e.length-1]?a:e.pop():a}(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o(\"streams\");var f=r.map(function(t,i){var o=i<r.length-1;return function(t,r,i,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;t.on(\"close\",function(){a=!0}),void 0===n&&(n=e(\"./end-of-stream\")),n(t,{readable:r,writable:i},function(e){if(e)return o(e);a=!0,o()});var l=!1;return function(e){if(!a&&!l)return l=!0,function(e){return e.setHeader&&\"function\"==typeof e.abort}(t)?t.abort():\"function\"==typeof t.destroy?t.destroy():void o(e||new s(\"pipe\"))}}(t,o,i>0,function(e){c||(c=e),e&&f.forEach(l),o||(f.forEach(l),h(c))})});return r.reduce(u)}},{\"../../../errors\":55,\"./end-of-stream\":64}],67:[function(e,t,r){\"use strict\";var n=e(\"../../../errors\").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,r,i){var o=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(i?r:\"highWaterMark\",o);return Math.floor(o)}return e.objectMode?16:16384}}},{\"../../../errors\":55}],68:[function(e,t,r){t.exports=e(\"events\").EventEmitter},{events:22}],69:[function(e,t,r){(r=t.exports=e(\"./lib/_stream_readable.js\")).Stream=r,r.Readable=r,r.Writable=e(\"./lib/_stream_writable.js\"),r.Duplex=e(\"./lib/_stream_duplex.js\"),r.Transform=e(\"./lib/_stream_transform.js\"),r.PassThrough=e(\"./lib/_stream_passthrough.js\"),r.finished=e(\"./lib/internal/streams/end-of-stream.js\"),r.pipeline=e(\"./lib/internal/streams/pipeline.js\")},{\"./lib/_stream_duplex.js\":56,\"./lib/_stream_passthrough.js\":57,\"./lib/_stream_readable.js\":58,\"./lib/_stream_transform.js\":59,\"./lib/_stream_writable.js\":60,\"./lib/internal/streams/end-of-stream.js\":64,\"./lib/internal/streams/pipeline.js\":66}],70:[function(e,t,r){\"use strict\";t.exports=function(){if(\"function\"!=typeof arguments[0])throw new Error(\"callback needed\");if(\"number\"!=typeof arguments[1])throw new Error(\"interval needed\");var e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new function(e,t,r){var n=this;this._callback=e,this._args=r,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,e,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}(arguments[0],arguments[1],e)}},{}],71:[function(e,t,r){\"use strict\";t.exports=e(\"./index.js\")()},{\"./index.js\":72}],72:[function(e,t,r){(function(e){(function(){\"use strict\";function r(t){return t instanceof e?e.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}t.exports=function(e){return(e=e||{}).circles?function(e){var t=[],n=[];return e.proto?function e(o){if(\"object\"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return i(o,e);if(o instanceof Map)return new Map(i(Array.from(o),e));if(o instanceof Set)return new Set(i(Array.from(o),e));var s={};for(var a in t.push(o),n.push(s),o){var l=o[a];if(\"object\"!=typeof l||null===l)s[a]=l;else if(l instanceof Date)s[a]=new Date(l);else if(l instanceof Map)s[a]=new Map(i(Array.from(l),e));else if(l instanceof Set)s[a]=new Set(i(Array.from(l),e));else if(ArrayBuffer.isView(l))s[a]=r(l);else{var u=t.indexOf(l);s[a]=-1!==u?n[u]:e(l)}}return t.pop(),n.pop(),s}:function e(o){if(\"object\"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return i(o,e);if(o instanceof Map)return new Map(i(Array.from(o),e));if(o instanceof Set)return new Set(i(Array.from(o),e));var s={};for(var a in t.push(o),n.push(s),o)if(!1!==Object.hasOwnProperty.call(o,a)){var l=o[a];if(\"object\"!=typeof l||null===l)s[a]=l;else if(l instanceof Date)s[a]=new Date(l);else if(l instanceof Map)s[a]=new Map(i(Array.from(l),e));else if(l instanceof Set)s[a]=new Set(i(Array.from(l),e));else if(ArrayBuffer.isView(l))s[a]=r(l);else{var u=t.indexOf(l);s[a]=-1!==u?n[u]:e(l)}}return t.pop(),n.pop(),s};function i(e,i){for(var o=Object.keys(e),s=new Array(o.length),a=0;a<o.length;a++){var l=o[a],u=e[l];if(\"object\"!=typeof u||null===u)s[l]=u;else if(u instanceof Date)s[l]=new Date(u);else if(ArrayBuffer.isView(u))s[l]=r(u);else{var c=t.indexOf(u);s[l]=-1!==c?n[c]:i(u)}}return s}}(e):e.proto?function e(n){if(\"object\"!=typeof n||null===n)return n;if(n instanceof Date)return new Date(n);if(Array.isArray(n))return t(n,e);if(n instanceof Map)return new Map(t(Array.from(n),e));if(n instanceof Set)return new Set(t(Array.from(n),e));var i={};for(var o in n){var s=n[o];\"object\"!=typeof s||null===s?i[o]=s:s instanceof Date?i[o]=new Date(s):s instanceof Map?i[o]=new Map(t(Array.from(s),e)):s instanceof Set?i[o]=new Set(t(Array.from(s),e)):ArrayBuffer.isView(s)?i[o]=r(s):i[o]=e(s)}return i}:function e(n){if(\"object\"!=typeof n||null===n)return n;if(n instanceof Date)return new Date(n);if(Array.isArray(n))return t(n,e);if(n instanceof Map)return new Map(t(Array.from(n),e));if(n instanceof Set)return new Set(t(Array.from(n),e));var i={};for(var o in n)if(!1!==Object.hasOwnProperty.call(n,o)){var s=n[o];\"object\"!=typeof s||null===s?i[o]=s:s instanceof Date?i[o]=new Date(s):s instanceof Map?i[o]=new Map(t(Array.from(s),e)):s instanceof Set?i[o]=new Set(t(Array.from(s),e)):ArrayBuffer.isView(s)?i[o]=r(s):i[o]=e(s)}return i};function t(e,t){for(var n=Object.keys(e),i=new Array(n.length),o=0;o<n.length;o++){var s=n[o],a=e[s];\"object\"!=typeof a||null===a?i[s]=a:a instanceof Date?i[s]=new Date(a):ArrayBuffer.isView(a)?i[s]=r(a):i[s]=t(a)}return i}}}).call(this)}).call(this,e(\"buffer\").Buffer)},{buffer:17}],73:[function(e,t,r){var n=e(\"buffer\"),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(o(n,r),r.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if(\"number\"==typeof e)throw new TypeError(\"Argument must not be a number\");return i(e,t,r)},s.alloc=function(e,t,r){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");var n=i(e);return void 0!==t?\"string\"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");return i(e)},s.allocUnsafeSlow=function(e){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");return n.SlowBuffer(e)}},{buffer:17}],74:[function(e,t,r){t.exports=function(e){var t=e._readableState;return t?t.objectMode||\"number\"==typeof e._duplexState?e.read():e.read((r=t,r.buffer.length?r.buffer.head?r.buffer.head.data.length:r.buffer[0].length:r.length)):null;var r}},{}],75:[function(e,t,r){\"use strict\";var n=e(\"safe-buffer\").Buffer,i=n.isEncoding||function(e){switch((e=\"\"+e)&&e.toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":case\"raw\":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return\"utf8\";for(var t;;)switch(e){case\"utf8\":case\"utf-8\":return\"utf8\";case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return\"utf16le\";case\"latin1\":case\"binary\":return\"latin1\";case\"base64\":case\"ascii\":case\"hex\":return e;default:if(t)return;e=(\"\"+e).toLowerCase(),t=!0}}(e);if(\"string\"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error(\"Unknown encoding: \"+e);return t||e}(e),this.encoding){case\"utf16le\":this.text=l,this.end=u,t=4;break;case\"utf8\":this.fillLast=a,t=4;break;case\"base64\":this.text=c,this.end=h,t=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,\"�\";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,\"�\";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,\"�\"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString(\"utf16le\",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString(\"utf16le\",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):\"\";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString(\"utf16le\",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString(\"base64\",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString(\"base64\",t,e.length-r))}function h(e){var t=e&&e.length?this.write(e):\"\";return this.lastNeed?t+this.lastChar.toString(\"base64\",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):\"\"}r.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return\"\";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return\"\";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||\"\"},o.prototype.end=function(e){var t=e&&e.length?this.write(e):\"\";return this.lastNeed?t+\"�\":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=s(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString(\"utf8\",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString(\"utf8\",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{\"safe-buffer\":73}],76:[function(e,t,r){\"use strict\";var n=e(\"punycode\"),i=e(\"./util\");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=v,r.resolve=function(e,t){return v(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?v(e,!1,!0).resolveObject(t):t},r.format=function(e){i.isString(e)&&(e=v(e));return e instanceof o?e.format():o.prototype.format.call(e)},r.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,u=[\"{\",\"}\",\"|\",\"\\\\\",\"^\",\"`\"].concat([\"<\",\">\",'\"',\"`\",\" \",\"\\r\",\"\\n\",\"\\t\"]),c=[\"'\"].concat(u),h=[\"%\",\"/\",\"?\",\";\",\"#\"].concat(c),f=[\"/\",\"?\",\"#\"],p=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,\"javascript:\":!0},y={javascript:!0,\"javascript:\":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,\"http:\":!0,\"https:\":!0,\"ftp:\":!0,\"gopher:\":!0,\"file:\":!0},m=e(\"querystring\");function v(e,t,r){if(e&&i.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,r),n}o.prototype.parse=function(e,t,r){if(!i.isString(e))throw new TypeError(\"Parameter 'url' must be a string, not \"+typeof e);var o=e.indexOf(\"?\"),a=-1!==o&&o<e.indexOf(\"#\")?\"?\":\"#\",u=e.split(a);u[0]=u[0].replace(/\\\\/g,\"/\");var v=e=u.join(a);if(v=v.trim(),!r&&1===e.split(\"#\").length){var w=l.exec(v);if(w)return this.path=v,this.href=v,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?m.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search=\"\",this.query={}),this}var _=s.exec(v);if(_){var k=(_=_[0]).toLowerCase();this.protocol=k,v=v.substr(_.length)}if(r||_||v.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)){var S=\"//\"===v.substr(0,2);!S||_&&y[_]||(v=v.substr(2),this.slashes=!0)}if(!y[_]&&(S||_&&!b[_])){for(var E,C,T=-1,x=0;x<f.length;x++){-1!==(A=v.indexOf(f[x]))&&(-1===T||A<T)&&(T=A)}-1!==(C=-1===T?v.lastIndexOf(\"@\"):v.lastIndexOf(\"@\",T))&&(E=v.slice(0,C),v=v.slice(C+1),this.auth=decodeURIComponent(E)),T=-1;for(x=0;x<h.length;x++){var A;-1!==(A=v.indexOf(h[x]))&&(-1===T||A<T)&&(T=A)}-1===T&&(T=v.length),this.host=v.slice(0,T),v=v.slice(T),this.parseHost(),this.hostname=this.hostname||\"\";var I=\"[\"===this.hostname[0]&&\"]\"===this.hostname[this.hostname.length-1];if(!I)for(var P=this.hostname.split(/\\./),O=(x=0,P.length);x<O;x++){var B=P[x];if(B&&!B.match(p)){for(var R=\"\",M=0,N=B.length;M<N;M++)B.charCodeAt(M)>127?R+=\"x\":R+=B[M];if(!R.match(p)){var L=P.slice(0,x),j=P.slice(x+1),U=B.match(d);U&&(L.push(U[1]),j.unshift(U[2])),j.length&&(v=\"/\"+j.join(\".\")+v),this.hostname=L.join(\".\");break}}}this.hostname.length>255?this.hostname=\"\":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var q=this.port?\":\"+this.port:\"\",D=this.hostname||\"\";this.host=D+q,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),\"/\"!==v[0]&&(v=\"/\"+v))}if(!g[k])for(x=0,O=c.length;x<O;x++){var z=c[x];if(-1!==v.indexOf(z)){var F=encodeURIComponent(z);F===z&&(F=escape(z)),v=v.split(z).join(F)}}var V=v.indexOf(\"#\");-1!==V&&(this.hash=v.substr(V),v=v.slice(0,V));var H=v.indexOf(\"?\");if(-1!==H?(this.search=v.substr(H),this.query=v.substr(H+1),t&&(this.query=m.parse(this.query)),v=v.slice(0,H)):t&&(this.search=\"\",this.query={}),v&&(this.pathname=v),b[k]&&this.hostname&&!this.pathname&&(this.pathname=\"/\"),this.pathname||this.search){q=this.pathname||\"\";var W=this.search||\"\";this.path=q+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||\"\";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,\":\"),e+=\"@\");var t=this.protocol||\"\",r=this.pathname||\"\",n=this.hash||\"\",o=!1,s=\"\";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(\":\")?this.hostname:\"[\"+this.hostname+\"]\"),this.port&&(o+=\":\"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=m.stringify(this.query));var a=this.search||s&&\"?\"+s||\"\";return t&&\":\"!==t.substr(-1)&&(t+=\":\"),this.slashes||(!t||b[t])&&!1!==o?(o=\"//\"+(o||\"\"),r&&\"/\"!==r.charAt(0)&&(r=\"/\"+r)):o||(o=\"\"),n&&\"#\"!==n.charAt(0)&&(n=\"#\"+n),a&&\"?\"!==a.charAt(0)&&(a=\"?\"+a),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace(\"#\",\"%23\"))+n},o.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,\"\"===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];\"protocol\"!==c&&(r[c]=e[c])}return b[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname=\"/\"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!b[e.protocol]){for(var h=Object.keys(e),f=0;f<h.length;f++){var p=h[f];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||y[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||\"\").split(\"/\");d.length&&!(e.host=d.shift()););e.host||(e.host=\"\"),e.hostname||(e.hostname=\"\"),\"\"!==d[0]&&d.unshift(\"\"),d.length<2&&d.unshift(\"\"),r.pathname=d.join(\"/\")}if(r.search=e.search,r.query=e.query,r.host=e.host||\"\",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||\"\",m=r.search||\"\";r.path=g+m}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&\"/\"===r.pathname.charAt(0),w=e.host||e.pathname&&\"/\"===e.pathname.charAt(0),_=w||v||r.host&&e.pathname,k=_,S=r.pathname&&r.pathname.split(\"/\")||[],E=(d=e.pathname&&e.pathname.split(\"/\")||[],r.protocol&&!b[r.protocol]);if(E&&(r.hostname=\"\",r.port=null,r.host&&(\"\"===S[0]?S[0]=r.host:S.unshift(r.host)),r.host=\"\",e.protocol&&(e.hostname=null,e.port=null,e.host&&(\"\"===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),_=_&&(\"\"===d[0]||\"\"===S[0])),w)r.host=e.host||\"\"===e.host?e.host:r.host,r.hostname=e.hostname||\"\"===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,S=d;else if(d.length)S||(S=[]),S.pop(),S=S.concat(d),r.search=e.search,r.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(E)r.hostname=r.host=S.shift(),(I=!!(r.host&&r.host.indexOf(\"@\")>0)&&r.host.split(\"@\"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift());return r.search=e.search,r.query=e.query,i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:\"\")+(r.search?r.search:\"\")),r.href=r.format(),r}if(!S.length)return r.pathname=null,r.search?r.path=\"/\"+r.search:r.path=null,r.href=r.format(),r;for(var C=S.slice(-1)[0],T=(r.host||e.host||S.length>1)&&(\".\"===C||\"..\"===C)||\"\"===C,x=0,A=S.length;A>=0;A--)\".\"===(C=S[A])?S.splice(A,1):\"..\"===C?(S.splice(A,1),x++):x&&(S.splice(A,1),x--);if(!_&&!k)for(;x--;x)S.unshift(\"..\");!_||\"\"===S[0]||S[0]&&\"/\"===S[0].charAt(0)||S.unshift(\"\"),T&&\"/\"!==S.join(\"/\").substr(-1)&&S.push(\"\");var I,P=\"\"===S[0]||S[0]&&\"/\"===S[0].charAt(0);E&&(r.hostname=r.host=P?\"\":S.length?S.shift():\"\",(I=!!(r.host&&r.host.indexOf(\"@\")>0)&&r.host.split(\"@\"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift()));return(_=_||r.host&&S.length)&&!P&&S.unshift(\"\"),S.length?r.pathname=S.join(\"/\"):(r.pathname=null,r.path=null),i.isNull(r.pathname)&&i.isNull(r.search)||(r.path=(r.pathname?r.pathname:\"\")+(r.search?r.search:\"\")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(\":\"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{\"./util\":77,punycode:51,querystring:54}],77:[function(e,t,r){\"use strict\";t.exports={isString:function(e){return\"string\"==typeof e},isObject:function(e){return\"object\"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],78:[function(e,t,r){(function(e){(function(){function r(t){try{if(!e.localStorage)return!1}catch(e){return!1}var r=e.localStorage[t];return null!=r&&\"true\"===String(r).toLowerCase()}t.exports=function(e,t){if(r(\"noDeprecation\"))return e;var n=!1;return function(){if(!n){if(r(\"throwDeprecation\"))throw new Error(t);r(\"traceDeprecation\")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this)}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],79:[function(e,t,r){t.exports=function e(t,r){if(t&&r)return e(t)(r);if(\"function\"!=typeof t)throw new TypeError(\"need wrapper function\");Object.keys(t).forEach(function(e){n[e]=t[e]});return n;function n(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var n=t.apply(this,e),i=e[e.length-1];return\"function\"==typeof n&&n!==i&&Object.keys(i).forEach(function(e){n[e]=i[e]}),n}}},{}],80:[function(e,t,r){\"use strict\";t.exports=function(){throw new Error(\"ws does not work in the browser. Browser clients must use the native WebSocket object\")}},{}],81:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var i in r)n.call(r,i)&&(e[i]=r[i])}return e};var n=Object.prototype.hasOwnProperty},{}],82:[function(e,t,r){\"use strict\";t.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},{}],83:[function(e,t,r){\"use strict\";function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&\"function\"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,i=arguments.length;r<i;r++)t.push(arguments[r]);return t}function i(e,t,r){var n=t===e.head?new a(r,null,t,e):new a(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}function o(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function s(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,r,n){if(!(this instanceof a))return new a(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}t.exports=n,n.Node=a,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error(\"removing node which does not belong to this list\");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)s(this,arguments[e]);return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},n.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},n.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,i=this.head;null!==i;)r.push(e.call(t,i.value,this)),i=i.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,i=this.tail;null!==i;)r.push(e.call(t,i.value,this)),i=i.prev;return r},n.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else{if(!this.head)throw new TypeError(\"Reduce of empty list with no initial value\");n=this.head.next,r=this.head.value}for(var i=0;null!==n;i++)r=e(r,n.value,i),n=n.next;return r},n.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else{if(!this.tail)throw new TypeError(\"Reduce of empty list with no initial value\");n=this.tail.prev,r=this.tail.value}for(var i=this.length-1;null!==n;i--)r=e(r,n.value,i),n=n.prev;return r},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)r.push(o.value);return r},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)r.push(o.value);return r},n.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,o=this.head;null!==o&&n<e;n++)o=o.next;var s=[];for(n=0;o&&n<t;n++)s.push(o.value),o=this.removeNode(o);null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev);for(n=0;n<r.length;n++)o=i(this,o,r[n]);return s},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{e(\"./iterator.js\")(n)}catch(e){}},{\"./iterator.js\":82}]},{},[12])(12)});","import { s8 } from '../utils';\r\n\r\nconst status = {\r\n  success: {\r\n    color: '#2ba471',\r\n    icon: '<svg fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 23a11 11 0 100-22 11 11 0 000 22zM7.5 10.59l3 3 6-6L17.91 9l-7.41 7.41L6.09 12l1.41-1.41z\"></path></svg>',\r\n  },\r\n  info: {\r\n    color: '#0052d9',\r\n    icon: '<svg fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 23a11 11 0 100-22 11 11 0 000 22zM11 8.5v-2h2v2h-2zm2 1.5v7.5h-2V10h2z\"></path></svg>',\r\n  },\r\n  warning: {\r\n    color: '#e37318',\r\n    icon: '<svg fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 1a11 11 0 110 22 11 11 0 010-22zm-1 13h2V6.5h-2V14zm2 1.5h-2v2h2v-2z\"></path></svg>',\r\n  },\r\n  error: {\r\n    color: '#d54941',\r\n    icon: '<svg fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 1a11 11 0 110 22 11 11 0 010-22zm-1 13h2V6.5h-2V14zm2 1.5h-2v2h2v-2z\"></path></svg>',\r\n  },\r\n  question: {\r\n    color: '#0052d9',\r\n    icon: '<svg fill=\"none\" viewBox=\"0 0 24 24\"><path d=\"M12 23a11 11 0 100-22 11 11 0 000 22zm-.17-11.11c.43-.53.97-.97 1.4-1.32A2 2 0 0012 7a2 2 0 00-1.89 1.33l-.33.95L7.9 8.6l.34-.94a4 4 0 116.24 4.47 7 7 0 00-1.1 1.01c-.27.34-.37.61-.37.85v1.25h-2V14c0-.87.39-1.57.83-2.11zM11 18.25v-2h2v2h-2z\"></path></svg>',\r\n  },\r\n};\r\n\r\nexport type Theme = 'success' | 'info' | 'warning' | 'error' | 'question';\r\n\r\nexport interface MessageOptions {\r\n  id?: string; //唯一标识\r\n  content?: string;\r\n  theme?: Theme; //主题\r\n  placement?: string; //位置\r\n  duration?: number; //定时销毁时间 为0时不销毁\r\n  closeBtn?: boolean; //是否显示关闭按钮\r\n}\r\n\r\nexport const messageList: {\r\n  [key: string]: Message;\r\n} = {};\r\n\r\nexport class Message {\r\n  box: HTMLElement;\r\n  icon: HTMLElement;\r\n  text: HTMLElement;\r\n  closeBtn: HTMLElement;\r\n  duration: number; //定时销毁时间\r\n  content: string;\r\n  theme: Theme; //主题\r\n  placement: string; //位置\r\n  id: string;\r\n  constructor(public parentElement: HTMLElement, options: MessageOptions) {\r\n    this.box = document.createElement('div');\r\n    this.icon = document.createElement('div');\r\n    this.text = document.createElement('div');\r\n\r\n    this.box.className = 'meta2d-message';\r\n    this.icon.className = 'icon';\r\n    this.text.className = 'text';\r\n    this.icon.innerHTML = status[options.theme || 'info'].icon;\r\n    this.text.innerHTML = options.content;\r\n\r\n    this.box.appendChild(this.icon);\r\n    this.box.appendChild(this.text);\r\n\r\n    if (options.closeBtn) {\r\n      this.closeBtn = document.createElement('div');\r\n      this.closeBtn.className = 'close';\r\n      this.closeBtn.innerHTML = 'x';\r\n      this.closeBtn.onclick = () => {\r\n        this.close();\r\n      };\r\n      this.box.appendChild(this.closeBtn);\r\n    }\r\n\r\n    parentElement.appendChild(this.box);\r\n\r\n    let sheet: any;\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].title === 'le5le.com/message') {\r\n        sheet = document.styleSheets[i];\r\n      }\r\n    }\r\n\r\n    if (!sheet) {\r\n      let style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      style.title = 'le5le.com/message';\r\n      document.head.appendChild(style);\r\n\r\n      style = document.createElement('style');\r\n      style.type = 'text/css';\r\n      document.head.appendChild(style);\r\n      sheet = style.sheet;\r\n      sheet.insertRule(\r\n        `.meta2d-message{\r\n           position:absolute;\r\n           z-index:999;\r\n           transform: translateX(-50%); \r\n           padding:12px 16px;\r\n           max-width:400px;\r\n           background:#fff;\r\n           border-radius:6px;\r\n           box-shadow:0 3px 14px 2px rgba(0, 0, 0, .05),0 8px 10px 1px rgba(0, 0, 0, 6%),0 5px 5px -3px rgba(0, 0, 0, 10%);\r\n           display:flex;\r\n           animation: fadein .5s;}`\r\n      );\r\n      sheet.insertRule(\r\n        `\r\n        @keyframes fadein {\r\n          0% {\r\n              transform: translate(-50%, -100%);\r\n          }\r\n          100% {\r\n              transform: translate(-50%,0);\r\n          }\r\n      }`\r\n      );\r\n      sheet.insertRule('.meta2d-message .icon{width:20px;height:20px;}');\r\n      sheet.insertRule(\r\n        '.meta2d-message .text{color:rgba(0, 0, 0, 0.9);font-size:12px;margin-left:8px;line-height:20px;}'\r\n      );\r\n      sheet.insertRule(\r\n        '.meta2d-message .close{width:20px;height:20px;padding-left: 16px; cursor: pointer;}'\r\n      );\r\n    }\r\n\r\n    this.id = options.id || s8();\r\n    this.duration = options.duration ?? 3000;\r\n    this.placement = options.placement || 'top';\r\n    this.theme = options.theme || 'info';\r\n    // this.init();\r\n  }\r\n\r\n  init() {\r\n    messageList[this.id] = this;\r\n    if (this.duration) {\r\n      setTimeout(() => {\r\n        this.close();\r\n      }, this.duration);\r\n    }\r\n    let idx = -1;\r\n    Object.keys(messageList).forEach((key) => {\r\n      if (messageList[key]?.placement === this.placement) {\r\n        idx++;\r\n      }\r\n    });\r\n    this.setPosition(this.placement, idx);\r\n    (this.icon.children[0] as HTMLElement).style.fill =\r\n      status[this.theme].color;\r\n  }\r\n\r\n  setPosition(placement: string, index: number = 0) {\r\n    switch (placement) {\r\n      case 'top':\r\n        this.box.style.top = `${30 + index * 60}px`;\r\n        this.box.style.left = '50%';\r\n        break;\r\n      case 'bottom':\r\n        this.box.style.bottom = `${30 + index * 60}px`;\r\n        this.box.style.left = '50%';\r\n        break;\r\n      case 'left':\r\n        this.box.style.top = `${30 + index * 60}px`;\r\n        this.box.style.left = '30px';\r\n        break;\r\n      case 'right':\r\n        this.box.style.top = `${30 + index * 60}px`;\r\n        this.box.style.right = '30px';\r\n        break;\r\n    }\r\n  }\r\n\r\n  close() {\r\n    Object.keys(messageList).forEach((key) => {\r\n      if (messageList[key]?.placement === this.placement) {\r\n        switch (this.placement) {\r\n          case 'top':\r\n          case 'left':\r\n          case 'right':\r\n            messageList[key].box.style.top =\r\n              parseInt(messageList[key].box.style.top) - 60 + 'px';\r\n            break;\r\n          case 'bottom':\r\n            messageList[key].box.style.bottom =\r\n              parseInt(messageList[key].box.style.bottom) - 60 + 'px';\r\n            break;\r\n        }\r\n      }\r\n    });\r\n    messageList[this.id] = null;\r\n    delete messageList[this.id];\r\n    this.box.remove();\r\n  }\r\n}\r\n","import { commonAnchors, commonPens, cube } from './diagrams';\r\nimport { EventType, Handler, WildcardHandler } from 'mitt';\r\nimport { Canvas } from './canvas';\r\nimport {Options, PenPlugin, PluginOptions} from './options';\r\nimport {\r\n  calcInView,\r\n  calcTextDrawRect,\r\n  calcTextLines,\r\n  calcTextRect,\r\n  ChartData,\r\n  facePen,\r\n  formatAttrs,\r\n  getAllChildren,\r\n  getFromAnchor,\r\n  getParent,\r\n  getToAnchor,\r\n  getWords,\r\n  LockState,\r\n  Pen,\r\n  PenType,\r\n  renderPenRaw,\r\n  IValue,\r\n  setElemPosition,\r\n  connectLine,\r\n  nearestAnchor,\r\n  setChildValue,\r\n  FormItem,\r\n  BindId,\r\n  isAncestor,\r\n  isShowChild,\r\n  CanvasLayer,\r\n  validationPlugin,\r\n  setLifeCycleFunc,\r\n  getAllFollowers,\r\n  isInteraction,\r\n  calcWorldAnchors\r\n} from './pen';\r\nimport { Point, rotatePoint } from './point';\r\nimport {\r\n  clearStore,\r\n  EditAction,\r\n  EditType,\r\n  globalStore,\r\n  register,\r\n  registerAnchors,\r\n  registerCanvasDraw,\r\n  Meta2dData,\r\n  Meta2dStore,\r\n  useStore,\r\n  Network,\r\n  HttpOptions,\r\n} from './store';\r\nimport {\r\n  formatPadding,\r\n  loadCss,\r\n  Padding,\r\n  s8,\r\n  valueInArray,\r\n  valueInRange,\r\n} from './utils';\r\nimport {\r\n  calcCenter,\r\n  calcRelativeRect,\r\n  calcRightBottom,\r\n  getRect,\r\n  Rect,\r\n  rectInRect,\r\n} from './rect';\r\nimport { deepClone } from './utils/clone';\r\nimport { Event, EventAction, EventName, TriggerCondition } from './event';\r\nimport { ViewMap } from './map';\r\n// TODO: 这种引入方式，引入 connect， webpack 5 报错\r\nimport { MqttClient } from 'mqtt';\r\nimport * as mqtt from 'mqtt/dist/mqtt.min.js';\r\n\r\nimport pkg from '../package.json';\r\nimport { lockedError } from './utils/error';\r\nimport { Scroll } from './scroll';\r\nimport { getter } from './utils/object';\r\nimport { queryURLParams } from './utils/url';\r\nimport { HotkeyType } from './data';\r\nimport { Message, MessageOptions, messageList } from './message';\r\n\r\nexport class Meta2d {\r\n  store: Meta2dStore;\r\n  canvas: Canvas;\r\n  websocket: WebSocket;\r\n  mqttClient: MqttClient;\r\n  websockets: WebSocket[];\r\n  mqttClients: MqttClient[];\r\n  penPluginMap: Map<PenPlugin,{\r\n    tag?:string,\r\n    name?:string,\r\n    id?:string,\r\n    option:Object\r\n  }[]> = new Map();\r\n  socketFn: (\r\n    e: string,\r\n    // topic: string,\r\n    context?: {\r\n      meta2d?: Meta2d;\r\n      type?: string;\r\n      topic?: string;\r\n      url?: string;\r\n      method?: string;\r\n    }\r\n  ) => boolean | string;\r\n  events: Record<number, (pen: Pen, e: Event, params?:any) => void> = {};\r\n  map: ViewMap;\r\n  mapTimer: any;\r\n  constructor(parent: string | HTMLElement, opts: Options = {}) {\r\n    this.store = useStore(s8());\r\n    this.setOptions(opts);\r\n    this.setDatabyOptions(opts);\r\n    this.init(parent);\r\n    this.register(commonPens());\r\n    this.registerCanvasDraw({ cube });\r\n    this.registerAnchors(commonAnchors());\r\n    globalThis.meta2d = this;\r\n    this.initEventFns();\r\n    this.store.emitter.on('*', this.onEvent);\r\n  }\r\n\r\n  facePen = facePen;\r\n  getWords = getWords;\r\n  calcTextLines = calcTextLines;\r\n  calcTextRect = calcTextRect;\r\n  calcTextDrawRect = calcTextDrawRect;\r\n\r\n  /**\r\n   * @deprecated 改用 beforeAddPens\r\n   */\r\n  get beforeAddPen() {\r\n    return this.canvas.beforeAddPen;\r\n  }\r\n  /**\r\n   * @deprecated 改用 beforeAddPens\r\n   */\r\n  set beforeAddPen(fn: (pen: Pen) => boolean) {\r\n    this.canvas.beforeAddPen = fn;\r\n  }\r\n  get beforeAddPens() {\r\n    return this.canvas.beforeAddPens;\r\n  }\r\n  set beforeAddPens(fn: (pens: Pen[]) => Promise<boolean>) {\r\n    this.canvas.beforeAddPens = fn;\r\n  }\r\n  get beforeAddAnchor() {\r\n    return this.canvas.beforeAddAnchor;\r\n  }\r\n  set beforeAddAnchor(fn: (pen: Pen, anchor: Point) => Promise<boolean>) {\r\n    this.canvas.beforeAddAnchor = fn;\r\n  }\r\n  get beforeRemovePens() {\r\n    return this.canvas.beforeRemovePens;\r\n  }\r\n  set beforeRemovePens(fn: (pens: Pen[]) => Promise<boolean>) {\r\n    this.canvas.beforeRemovePens = fn;\r\n  }\r\n  get beforeRemoveAnchor() {\r\n    return this.canvas.beforeRemoveAnchor;\r\n  }\r\n  set beforeRemoveAnchor(fn: (pen: Pen, anchor: Point) => Promise<boolean>) {\r\n    this.canvas.beforeRemoveAnchor = fn;\r\n  }\r\n\r\n  setOptions(opts: Options = {}) {\r\n    if (\r\n      opts.grid !== undefined ||\r\n      opts.gridColor !== undefined ||\r\n      opts.gridSize !== undefined\r\n    ) {\r\n      // this.setGrid({\r\n      //   grid: opts.grid,\r\n      //   gridColor: opts.gridColor,\r\n      //   gridSize: opts.gridSize,\r\n      // });\r\n      this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n    }\r\n    if (opts.rule !== undefined || opts.ruleColor !== undefined ||opts.ruleOptions !==undefined) {\r\n      // this.setRule({\r\n      //   rule: opts.rule,\r\n      //   ruleColor: opts.ruleColor,\r\n      // });\r\n      this.store.patchFlagsTop = true;\r\n      if(opts.ruleOptions){\r\n        if(this.store.options?.ruleOptions){\r\n          Object.assign(this.store.options.ruleOptions,opts.ruleOptions);\r\n          opts.ruleOptions = this.store.options.ruleOptions;\r\n        }\r\n      }\r\n    }\r\n    if(opts.background !== undefined){\r\n      this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n    }\r\n    if (opts.resizeMode !== undefined) {\r\n      if (!opts.resizeMode) {\r\n        this.canvas.hotkeyType = HotkeyType.None;\r\n      }\r\n    }\r\n    if (opts.width !== undefined || opts.height !== undefined) {\r\n      this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n      if(this.canvas && this.canvas.canvasTemplate.canvas.style.backgroundImage) {\r\n        this.canvas.canvasTemplate.canvas.style.backgroundImage = '';\r\n      }\r\n    }\r\n    this.store.options = Object.assign(this.store.options, opts);\r\n    if (this.canvas && opts.scroll !== undefined) {\r\n      if (opts.scroll) {\r\n        !this.canvas.scroll && (this.canvas.scroll = new Scroll(this.canvas));\r\n        this.canvas.scroll.show();\r\n      } else {\r\n        this.canvas.scroll && this.canvas.scroll.hide();\r\n      }\r\n    }\r\n  }\r\n\r\n  getOptions() {\r\n    return this.store.options;\r\n  }\r\n\r\n  setTheme(theme:string){\r\n    this.store.data.theme = theme;\r\n    this.setBackgroundColor(this.store.theme[theme].background);\r\n    this.canvas.parentElement.style.background = this.store.theme[theme].parentBackground;\r\n    this.store.data.color = this.store.theme[theme].color;\r\n    this.setOptions({\r\n      ruleColor:this.store.theme[theme].ruleColor,\r\n      ruleOptions:this.store.theme[theme].ruleOptions\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  setDatabyOptions(options: Options = {}) {\r\n    const {\r\n      color,\r\n      activeColor,\r\n      activeBackground,\r\n      grid,\r\n      gridColor,\r\n      gridSize,\r\n      fromArrow,\r\n      toArrow,\r\n      rule,\r\n      ruleColor,\r\n      textColor,\r\n      x = 0,\r\n      y = 0,\r\n    } = options;\r\n    this.setRule({ rule, ruleColor });\r\n    this.setGrid({\r\n      grid,\r\n      gridColor,\r\n      gridSize,\r\n    });\r\n    this.store.data = Object.assign(this.store.data, {\r\n      textColor,\r\n      color,\r\n      activeColor,\r\n      activeBackground,\r\n      fromArrow,\r\n      toArrow,\r\n      x,\r\n      y\r\n    });\r\n  }\r\n\r\n  private init(parent: string | HTMLElement) {\r\n    if (typeof parent === 'string') {\r\n      this.canvas = new Canvas(\r\n        this,\r\n        document.getElementById(parent),\r\n        this.store\r\n      );\r\n    } else {\r\n      this.canvas = new Canvas(this, parent, this.store);\r\n    }\r\n\r\n    this.resize();\r\n    this.canvas.listen();\r\n  }\r\n\r\n  initEventFns() {\r\n    this.events[EventAction.Link] = (pen: Pen, e: Event) => {\r\n      if (window && e.value && typeof e.value === 'string') {\r\n        window.open(e.value, e.params ?? '_blank');\r\n        return;\r\n      }\r\n      console.warn('[meta2d] Link param is not a string');\r\n    };\r\n    this.events[EventAction.SetProps] = (pen: Pen, e: Event) => {\r\n      // TODO: 若频繁地触发，重复 render 可能带来性能问题，待考虑\r\n      const value = e.value;\r\n      if (value && typeof value === 'object') {\r\n        const pens = e.params ? this.find(e.params) : this.find(pen.id);\r\n        pens.forEach((pen: Pen) => {\r\n          if (value.hasOwnProperty('visible')) {\r\n            if(pen.visible !== value.visible) {\r\n              this.setVisible(pen, value.visible);\r\n            }\r\n          }\r\n          this.setValue(\r\n            { id: pen.id, ...value },\r\n            { render: false, doEvent: false }\r\n          );\r\n        });\r\n        this.render();\r\n        return;\r\n      }\r\n      console.warn('[meta2d] SetProps value is not an object');\r\n    };\r\n    this.events[EventAction.StartAnimate] = (pen: Pen, e: Event) => {\r\n      let _pen = pen;\r\n      if(e.value){\r\n        _pen = this.findOne((e.value as string));\r\n      }\r\n      if(this.store.animates.has(_pen)&&!_pen.calculative.pause&&_pen.animateName===e.params){\r\n        return;\r\n      }\r\n      if (e.targetType && e.params) {\r\n        this.startAnimate((e.value as string) || [pen], e.params);\r\n        return;\r\n      }\r\n      if (!e.value || typeof e.value === 'string') {\r\n        this.startAnimate((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] StartAnimate value is not a string');\r\n    };\r\n    this.events[EventAction.PauseAnimate] = (pen: Pen, e: Event) => {\r\n      if (!e.value || typeof e.value === 'string') {\r\n        this.pauseAnimate((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] PauseAnimate value is not a string');\r\n    };\r\n    this.events[EventAction.StopAnimate] = (pen: Pen, e: Event) => {\r\n      if (!e.value || typeof e.value === 'string') {\r\n        if(e.value){\r\n          let _pen = this.findOne((e.value as string));\r\n          if(!this.store.animates.has(_pen)){\r\n            return;\r\n          }\r\n        }else{\r\n          if(!this.store.animates.has(pen)){\r\n            return;\r\n          }\r\n        }\r\n        this.stopAnimate((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] StopAnimate event value is not a string');\r\n    };\r\n    this.events[EventAction.StartVideo] = (pen: Pen, e: Event) => {\r\n      if (!e.value || typeof e.value === 'string') {\r\n        this.startVideo((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] StartVideo value is not a string');\r\n    };\r\n    this.events[EventAction.PauseVideo] = (pen: Pen, e: Event) => {\r\n      if (!e.value || typeof e.value === 'string') {\r\n        this.pauseVideo((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] PauseVideo value is not a string');\r\n    };\r\n    this.events[EventAction.StopVideo] = (pen: Pen, e: Event) => {\r\n      if (!e.value || typeof e.value === 'string') {\r\n        this.stopVideo((e.value as string) || [pen]);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] StopVideo event value is not a string');\r\n    };\r\n    this.events[EventAction.JS] = (pen: Pen, e: Event, params?:any) => {\r\n      if (e.value && !e.fn) {\r\n        try {\r\n          if (typeof e.value !== 'string') {\r\n            throw new Error('[meta2d] Function value must be string');\r\n          }\r\n          const fnJs = e.value;\r\n          e.fn = new Function('pen', 'params', 'context', fnJs) as (\r\n            pen: Pen,\r\n            params: string,\r\n            context?: { meta2d: Meta2d; eventName: string }\r\n          ) => void;\r\n        } catch (err) {\r\n          console.error('[meta2d]: Error on make a function:', err);\r\n        }\r\n      }\r\n      e.fn?.(pen, params || e.params, { meta2d: this, eventName: e.name });\r\n    };\r\n    this.events[EventAction.GlobalFn] = (pen: Pen, e: Event) => {\r\n      if (typeof e.value !== 'string') {\r\n        console.warn('[meta2d] GlobalFn value must be a string');\r\n        return;\r\n      }\r\n      if (globalThis[e.value]) {\r\n        globalThis[e.value](pen, e.params);\r\n      }\r\n    };\r\n    this.events[EventAction.Emit] = (pen: Pen, e: Event) => {\r\n      if (typeof e.value !== 'string') {\r\n        console.warn('[meta2d] Emit value must be a string');\r\n        return;\r\n      }\r\n      this.store.emitter.emit(e.value, {\r\n        pen,\r\n        params: e.params,\r\n        eventName: e.name,\r\n      });\r\n    };\r\n    this.events[EventAction.SendPropData] = (pen: Pen, e: Event) => {\r\n      const value = deepClone(e.value);\r\n      if (value && typeof value === 'object') {\r\n        const _pen = e.params ? this.findOne(e.params) : pen;\r\n        for (let key in value) {\r\n          if (value[key] === undefined || value[key] === '') {\r\n            value[key] = _pen[key];\r\n          }\r\n        }\r\n        value.id = _pen.id;\r\n        this.doSendDataEvent(value, e.extend);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] SendPropData value is not an object');\r\n    };\r\n    this.events[EventAction.SendVarData] = (pen: Pen, e: Event) => {\r\n      const value = deepClone(e.value);\r\n      if (value && typeof value === 'object') {\r\n        const _pen = e.params ? this.findOne(e.params) : pen;\r\n        let array = [];\r\n        for (let key in value) {\r\n          let obj = {\r\n            dataId: key,\r\n            value: value[key],\r\n          };\r\n          if (!obj.value) {\r\n            let oneForm = _pen.form.find(\r\n              (_item) =>\r\n                (_item.dataIds as BindId) &&\r\n                (_item.dataIds as BindId).dataId === obj.dataId\r\n            );\r\n            if (oneForm) {\r\n              obj.value = _pen[oneForm.key];\r\n            }\r\n          }\r\n          array.push(obj);\r\n        }\r\n        this.doSendDataEvent(array, e.extend);\r\n        return;\r\n      }\r\n      console.warn('[meta2d] SendVarData value is not an object');\r\n    };\r\n    this.events[EventAction.Navigator] = (pen: Pen, e: Event) => {\r\n      if (e.value && typeof e.value === 'string') {\r\n        this.navigatorTo(e.value);\r\n      }\r\n    };\r\n    this.events[EventAction.Dialog] = (pen: Pen, e: Event) => {\r\n      if (\r\n        e.params &&\r\n        typeof e.params === 'string'\r\n      ) {\r\n        let url = e.params;\r\n        if(e.params.includes('${')){\r\n          let keys = e.params.match(/(?<=\\$\\{).*?(?=\\})/g);\r\n          if(keys){\r\n            keys?.forEach((key)=>{\r\n              url = url.replace(`\\${${key}}`,pen[key]);\r\n            })\r\n          }\r\n        }\r\n        this.canvas.dialog.show(e.value as any, url, e.extend);\r\n      }\r\n    };\r\n    this.events[EventAction.SendData] = (pen: Pen, e: Event) => {\r\n      if(e.list?.length){\r\n        // if (e.targetType === 'id') {\r\n          if(e.network&&e.network.protocol === \"jetLinks\"){\r\n            const list:any = [];\r\n            e.list.forEach((item:any,index)=>{\r\n              const _pen = item.params ? this.findOne(item.params) : pen;\r\n              list[index] = {\r\n                deviceId:_pen.deviceId,\r\n                productId:_pen.productId,\r\n                properties:{}\r\n              };\r\n              for (let key in item.value) {\r\n                if (item.value[key] === undefined || item.value[key] === '') {\r\n                  //找到绑定了这个设备属性的图元属性\r\n                  const realTime = _pen.realTimes?.find((item:any)=>item.propertyId === key);\r\n                  if(realTime){\r\n                    list[index].properties[key] = _pen[realTime.key];\r\n                  }\r\n                }else if(typeof item.value[key]=== 'string' && item.value[key]?.indexOf('${') > -1){\r\n                  let keys = item.value[key].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n                  if(keys?.length){\r\n                    list[index].properties[key] = _pen[keys[0]]\r\n                  }\r\n                }else{\r\n                  list[index].properties[key] = item.value[key];\r\n                }\r\n              }\r\n            });\r\n            if(this.jetLinksClient && list.length){\r\n              list.forEach((item)=>{\r\n                this.jetLinksClient.send(JSON.stringify({\r\n                    \"type\": \"sub\", \r\n                    \"topic\": `/device-message-sender/${item.productId}/${item.deviceId}`, \r\n                    \"parameter\": {\r\n                        \"messageType\":\"WRITE_PROPERTY\",\r\n                        \"properties\":item.properties,\r\n                        \"headers\":{\r\n                          \"async\":false \r\n                        }\r\n                    },\r\n                    \"id\": item.productId+'/'+item.deviceId+'-'+s8()\r\n                }));\r\n              })\r\n            }\r\n            return;\r\n          }\r\n          const value:any = {};\r\n          e.list.forEach((item:any)=>{\r\n            const _pen = item.params ? this.findOne(item.params) : pen;\r\n            for (let key in item.value) {\r\n              if (item.value[key] === undefined || item.value[key] === '') {\r\n                value[key] = _pen[key];\r\n              }else if(typeof item.value[key]=== 'string' && item.value[key]?.indexOf('${') > -1){\r\n                let keys = item.value[key].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n                if(keys?.length){\r\n                  value[key] = _pen[keys[0]]\r\n                }\r\n              }else{\r\n                value[key] = item.value[key];\r\n              }\r\n            }\r\n          });\r\n          if(pen.deviceId){\r\n            value.deviceId = pen.deviceId;\r\n          }\r\n          this.sendDataToNetWork(value, pen, e);\r\n          return;\r\n        // }\r\n      }\r\n      const value = deepClone(e.value);\r\n      if (value && typeof value === 'object') {\r\n        if (e.targetType === 'id') {\r\n          const _pen = e.params ? this.findOne(e.params) : pen;\r\n          for (let key in value) {\r\n            if (value[key] === undefined || value[key] === '') {\r\n              value[key] = _pen[key];\r\n            }else if(typeof value[key]=== 'string' && value[key]?.indexOf('${') > -1){\r\n              let keys = value[key].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n              if(keys?.length){\r\n                value[key] = _pen[keys[0]]\r\n              }\r\n            }\r\n          }\r\n          // value.id = _pen.id;\r\n          if(_pen.deviceId){\r\n            value.deviceId = _pen.deviceId;\r\n          }\r\n          this.sendDataToNetWork(value, pen, e);\r\n          return;\r\n        }\r\n      }\r\n    };\r\n    this.events[EventAction.PostMessage] = (pen: Pen, e: Event) => {\r\n      if (typeof e.value !== 'string') {\r\n        console.warn('[meta2d] Emit value must be a string');\r\n        return;\r\n      }\r\n      const _pen = e.params ? this.findOne(e.params) : pen;\r\n      if (_pen.name !== 'iframe' || !_pen.iframe) {\r\n        console.warn('不是嵌入页面');\r\n        return;\r\n      }\r\n      let params = queryURLParams(_pen.iframe.split('?')[1]);\r\n      const value:any = {};\r\n      if(e.list?.length){\r\n        e.list.forEach((item:any)=>{\r\n          const _pen = item.params ? this.findOne(item.params) : pen;\r\n          for (let key in item.value) {\r\n            if (item.value[key] === undefined || item.value[key] === '') {\r\n              value[key] = _pen[key];\r\n            }else if(typeof item.value[key]=== 'string' && item.value[key]?.indexOf('${') > -1){\r\n              let keys = item.value[key].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n              if(keys?.length){\r\n                value[key] = _pen[keys[0]]\r\n              }\r\n            }else{\r\n              value[key] = item.value[key];\r\n            }\r\n          }\r\n        });\r\n      }\r\n      (\r\n        _pen.calculative.singleton.div.children[0] as HTMLIFrameElement\r\n      ).contentWindow.postMessage(\r\n        JSON.stringify({\r\n          name: e.value,\r\n          id: params.id,\r\n          value\r\n        }),\r\n        '*'\r\n      );\r\n      return;\r\n    };\r\n    this.events[EventAction.PostMessageToParent] = (pen: Pen, e: Event) => {\r\n      if (typeof e.value !== 'string') {\r\n        console.warn('[meta2d] Emit value must be a string');\r\n        return;\r\n      }\r\n      const value:any = {};\r\n      if(e.list?.length){\r\n        e.list.forEach((item:any)=>{\r\n          const _pen = item.params ? this.findOne(item.params) : pen;\r\n          for (let key in item.value) {\r\n            if (item.value[key] === undefined || item.value[key] === '') {\r\n              value[key] = _pen[key];\r\n            }else if(typeof item.value[key]=== 'string' && item.value[key]?.indexOf('${') > -1){\r\n              let keys = item.value[key].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n              if(keys?.length){\r\n                value[key] = _pen[keys[0]]\r\n              }\r\n            }else{\r\n              value[key] = item.value[key];\r\n            }\r\n          }\r\n        });\r\n      }\r\n      window.parent.postMessage(JSON.stringify({name:e.value,value}), '*');\r\n      return;\r\n    };\r\n    this.events[EventAction.Message] = (pen: Pen, e: Event) => {\r\n      this.message({\r\n        theme: e.params as any,\r\n        content: e.value as any,\r\n        ...e.extend\r\n      });\r\n    }\r\n  }\r\n\r\n  message(options:MessageOptions){\r\n    const message = new Message(this.canvas.parentElement, options);\r\n    message.init();\r\n  }\r\n\r\n  closeAll(){\r\n    for(let key in messageList){\r\n      messageList[key].close();\r\n    }\r\n  }\r\n\r\n  async navigatorTo(id: string) {\r\n    if (!id) {\r\n      return;\r\n    }\r\n    // let href = window.location.href;\r\n    // let arr: string[] = href.split('id=');\r\n    // if (arr.length > 1) {\r\n    //   let idx = arr[1].indexOf('&');\r\n    //   if (idx === -1) {\r\n    //     window.location.href = arr[0] + 'id=' + id;\r\n    //   } else {\r\n    //     window.location.href = arr[0] + 'id=' + id + arr[1].slice(idx);\r\n    //   }\r\n    // }\r\n    //路径参数更新\r\n    const url = new URL(window.location as any);\r\n    url.searchParams.set('id', id);\r\n    history.pushState({}, '', url);\r\n    //图纸更新\r\n    const netWork = this.store.options.navigatorNetWork;\r\n    const collection = (location.href.includes('2d.')||location.href.includes('/2d'))?'2d':'v';\r\n    const res: Response = await fetch((netWork?.url||`/api/data/${collection}/get`) + (netWork?.method==='GET'?`?id=${id}`:''), {\r\n      headers: {\r\n        Authorization: `Bearer ${this.getCookie('token') || localStorage.getItem('token')|| new URLSearchParams(location.search).get('token') || ''}`,\r\n      },\r\n      method: netWork?.method || 'POST',\r\n      body: netWork?.method === 'GET' ?undefined : JSON.stringify({id:id}) as any,\r\n    });\r\n    if(res.ok){\r\n      let data:any = await res.text();\r\n      if (data.constructor === Object || data.constructor === Array) {\r\n        data = JSON.parse(JSON.stringify(data));\r\n      } else if (typeof data === 'string') {\r\n        data = JSON.parse(data);\r\n      }\r\n      if(data.data){\r\n        data = data.data;\r\n      }\r\n      this.open(data);\r\n    }else{\r\n      this.store.emitter.emit('error', { type: 'http', error: res });\r\n    }\r\n  }\r\n\r\n  doSendDataEvent(value: any, topics?: string) {\r\n    let data = JSON.stringify(value);\r\n    if (this.mqttClient && this.mqttClient.connected) {\r\n      if (topics) {\r\n        topics.split(',').forEach((topic) => {\r\n          this.mqttClient.publish(topic, data);\r\n        });\r\n      } else {\r\n        this.store.data.mqttTopics &&\r\n          this.store.data.mqttTopics.split(',').forEach((topic) => {\r\n            this.mqttClient.publish(topic, data);\r\n          });\r\n      }\r\n    }\r\n    if (this.websocket && this.websocket.readyState === 1) {\r\n      this.websocket.send(data);\r\n    }\r\n    if (this.store.data.https || this.store.data.http) {\r\n      this.sendDatabyHttp(data);\r\n    }\r\n    this.store.emitter.emit('sendData', data);\r\n  }\r\n\r\n  async sendDataToNetWork(value: any, pen: Pen, e: any) {\r\n    const network = deepClone(e.network);\r\n    if(network.data){\r\n      Object.assign(network,network.data);\r\n      delete network.data;\r\n    }\r\n    if (!network.url) {\r\n      return;\r\n    }\r\n    if (network.protocol === 'http') {\r\n      if (typeof network.headers === 'object') {\r\n        for (let i in network.headers) {\r\n          if(typeof network.headers[i] === 'string'){\r\n            let keys = network.headers[i].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n            if (keys) {\r\n              network.headers[i] = network.headers[i].replace(\r\n                `\\${${keys[0]}}`,\r\n                this.getDynamicParam(keys[0])\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n      let params = undefined;\r\n      let url = network.url;\r\n      if (network.method === 'GET') {\r\n        params =\r\n          '?' +\r\n          Object.keys(value)\r\n            .map((key) => key + '=' + value[key])\r\n            .join('&');\r\n      }\r\n      if(network.method === 'POST'){\r\n        if(url.indexOf('${') > -1){\r\n          let keys = url.match(/(?<=\\$\\{).*?(?=\\})/g);\r\n          if(keys){\r\n            keys.forEach((key) => {\r\n              url = url.replace(`\\${${key}}`, getter(pen, key) || this.getDynamicParam(key));\r\n            });\r\n          }\r\n        }\r\n      }\r\n      const res: Response = await fetch(url + (params ? params : ''), {\r\n        headers: network.headers || {},\r\n        method: network.method,\r\n        body: network.method === 'POST' ? JSON.stringify(value) : undefined,\r\n      });\r\n      if (res.ok) {\r\n        if(e.callback){\r\n          const data = await res.text();\r\n          if(!e.fn){\r\n            try {\r\n              if (typeof e.callback !== 'string') {\r\n                throw new Error('[meta2d] Function callback must be string');\r\n              }\r\n              const fnJs = e.callback;\r\n              e.fn = new Function('pen', 'data', 'context', fnJs) as (\r\n                pen: Pen,\r\n                data: string,\r\n                context?: { meta2d: Meta2d; e:any }\r\n              ) => void;\r\n            } catch (err) {\r\n              console.error('[meta2d]: Error on make a function:', err);\r\n            }\r\n          }\r\n          e.fn?.(pen, data, { meta2d: this, e });\r\n        }\r\n        console.info('http消息发送成功');\r\n      }\r\n    } else if (network.protocol === 'mqtt') {\r\n      const clients = this.mqttClients.filter(\r\n        (client) => (client.options as any).href === network.url\r\n      );\r\n      if (clients && clients.length) {\r\n        if (clients[0].connected) {\r\n          network.topics.split(',').forEach((topic) => {\r\n            clients[0].publish(topic, value);\r\n          });\r\n        }\r\n      } else {\r\n        //临时建立连接\r\n        let mqttClient = mqtt.connect(network.url, network.options);\r\n        mqttClient.on('connect', () => {\r\n          console.info('mqtt连接成功');\r\n          network.topics.split(',').forEach((topic) => {\r\n            mqttClient.publish(topic, value);\r\n            mqttClient?.end();\r\n          });\r\n        });\r\n      }\r\n    } else if (network.protocol === 'websocket') {\r\n      const websockets = this.websockets.filter(\r\n        (socket) => socket.url === network.url\r\n      );\r\n      if (websockets && websockets.length) {\r\n        if (websockets[0].readyState === 1) {\r\n          websockets[0].send(value);\r\n        }\r\n      } else {\r\n        //临时建立连接\r\n        let websocket = new WebSocket(\r\n          network.url,\r\n          network.protocols || undefined\r\n        );\r\n        websocket.onopen = function () {\r\n          console.info('websocket连接成功');\r\n          websocket.send(value);\r\n          setTimeout(() => {\r\n            websocket.close();\r\n          }, 100);\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  resize(width?: number, height?: number) {\r\n    this.canvas.resize(width, height);\r\n    this.render();\r\n    this.store.emitter.emit('resize', { width, height });\r\n\r\n    if (this.canvas.scroll && this.canvas.scroll.isShow) {\r\n      this.canvas.scroll.init();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param emit 是否发送消息\r\n   */\r\n  async addPen(pen: Pen, history?: boolean, emit = true, abs = false) {\r\n    return await this.canvas.addPen(pen, history, emit, abs);\r\n  }\r\n\r\n  async addPens(pens: Pen[], history?: boolean, abs = false) {\r\n    return await this.canvas.addPens(pens, history, abs);\r\n  }\r\n\r\n  render(patchFlags?: boolean | number) {\r\n    this.canvas?.render(patchFlags);\r\n  }\r\n\r\n  async setBackgroundImage(url: string, data?: any) {\r\n    let that = this;\r\n    async function loadImage(url: string) {\r\n      return new Promise<HTMLImageElement>((resolve) => {\r\n        const img = new Image();\r\n        img.src = url;\r\n        if (\r\n          that.store.options.cdn &&\r\n          !(\r\n            url.startsWith('http') ||\r\n            url.startsWith('//') ||\r\n            url.startsWith('data:image')\r\n          )\r\n        ) {\r\n          img.src = that.store.options.cdn + url;\r\n        }\r\n        img.crossOrigin = 'anonymous';\r\n        img.onload = () => {\r\n          resolve(img);\r\n        };\r\n      });\r\n    }\r\n\r\n    this.store.data.bkImage = url;\r\n    const width =\r\n      data?.width || this.store.data?.width || this.store.options?.width;\r\n    const height =\r\n      data?.height || this.store.data?.height || this.store.options?.height;\r\n    if (width && height) {\r\n      this.canvas.canvasTemplate.canvas.style.backgroundImage = null;\r\n      this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n    } else {\r\n      this.canvas.canvasTemplate.canvas.style.backgroundImage = url\r\n        ? `url('${url}')`\r\n        : '';\r\n    }\r\n    if (url) {\r\n      const img = await loadImage(url);\r\n      // 用作 toPng 的绘制\r\n      this.store.bkImg = img;\r\n      if (width && height) {\r\n        if (this.canvas) {\r\n          this.canvas.canvasTemplate.init();\r\n          this.render();\r\n        }\r\n      }\r\n    } else {\r\n      this.store.bkImg = null;\r\n    }\r\n  }\r\n\r\n  setBackgroundColor(color: string = this.store.data.background) {\r\n    this.store.data.background = color;\r\n    // this.store.patchFlagsBackground = true;\r\n    this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n  }\r\n\r\n  setGrid({\r\n    grid = this.store.data.grid,\r\n    gridColor = this.store.data.gridColor,\r\n    gridSize = this.store.data.gridSize,\r\n    gridRotate = this.store.data.gridRotate,\r\n  }: {\r\n    grid?: boolean;\r\n    gridColor?: string;\r\n    gridSize?: number;\r\n    gridRotate?: number;\r\n  } = {}) {\r\n    this.store.data.grid = grid;\r\n    this.store.data.gridColor = gridColor;\r\n    this.store.data.gridSize = gridSize < 0 ? 0 : gridSize;\r\n    this.store.data.gridRotate = gridRotate;\r\n    // this.store.patchFlagsBackground = true;\r\n    this.canvas && (this.canvas.canvasTemplate.bgPatchFlags = true);\r\n  }\r\n\r\n  setRule({\r\n    rule = this.store.data.rule,\r\n    ruleColor = this.store.data.ruleColor,\r\n  }: {\r\n    rule?: boolean;\r\n    ruleColor?: string;\r\n  } = {}) {\r\n    this.store.data.rule = rule;\r\n    this.store.data.ruleColor = ruleColor;\r\n    this.store.patchFlagsTop = true;\r\n  }\r\n\r\n  open(data?: Meta2dData, render: boolean = true) {\r\n    this.clear(false, data?.template);\r\n    this.canvas.autoPolylineFlag = true;\r\n    if (data) {\r\n      this.setBackgroundImage(data.bkImage, data);\r\n      Object.assign(this.store.data, data);\r\n      this.store.data.pens = [];\r\n      // 第一遍赋初值\r\n      for (const pen of data.pens) {\r\n        if (!pen.id) {\r\n          pen.id = s8();\r\n        }\r\n        !pen.calculative && (pen.calculative = { canvas: this.canvas });\r\n        this.store.pens[pen.id] = pen;\r\n      }\r\n      for (const pen of data.pens) {\r\n        this.canvas.makePen(pen);\r\n      }\r\n      //首次计算连线bug\r\n      // for (const pen of data.pens) {\r\n      //   this.canvas.updateLines(pen);\r\n      // }\r\n    }\r\n\r\n    this.canvas.patchFlagsLines.forEach((pen) => {\r\n      if (pen.type) {\r\n        this.canvas.initLineRect(pen);\r\n      }\r\n    });\r\n\r\n    if (!this.store.data.template) {\r\n      this.store.data.template = s8();\r\n    }\r\n\r\n    if (!render) {\r\n      this.canvas.opening = true;\r\n    }\r\n    this.initBindDatas();\r\n    this.initBinds();\r\n    this.initMessageEvents();\r\n    this.initGlobalTriggers();\r\n    this.render();\r\n    this.listenSocket();\r\n    this.connectSocket();\r\n    this.connectNetwork();\r\n    this.startDataMock();\r\n    this.startAnimate();\r\n    this.startVideo();\r\n    this.doInitJS();\r\n    this.doInitFn();\r\n    setTimeout(()=>{\r\n      const pen =  this.store.data.pens.find((pen)=>pen.autofocus);\r\n      if(pen){\r\n        this.focus(pen.id);\r\n      }     \r\n    },100);\r\n    if (this.store.data.iconUrls) {\r\n      for (const item of this.store.data.iconUrls) {\r\n        loadCss(item, () => {\r\n          this.render();\r\n        });\r\n      }\r\n    }\r\n    this.canvas.autoPolylineFlag = false;\r\n    this.store.emitter.emit('opened');\r\n\r\n    if (this.canvas.scroll && this.canvas.scroll.isShow) {\r\n      this.canvas.scroll.init();\r\n    }\r\n  }\r\n\r\n  cacheData(id: string) {\r\n    if (id && this.store.options.cacheLength) {\r\n      let index = this.store.cacheDatas.findIndex(\r\n        (item) => item.data && item.data._id === id\r\n      );\r\n      if (index === -1) {\r\n        this.store.cacheDatas.push({\r\n          data: deepClone(this.store.data, true),\r\n          // offscreen: new Array(2),\r\n          // flag: new Array(2)\r\n        });\r\n        if (this.store.cacheDatas.length > this.store.options.cacheLength) {\r\n          this.store.cacheDatas.shift();\r\n        }\r\n      } else {\r\n        let cacheDatas = this.store.cacheDatas.splice(index, 1)[0];\r\n        this.store.cacheDatas.push(cacheDatas);\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCacheData(id: string) {\r\n    let index = this.store.cacheDatas.findIndex(\r\n      (item) => item.data && item.data._id === id\r\n    );\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n    // const ctx = this.canvas.canvas.getContext('2d');\r\n    // ctx.clearRect(0, 0, this.canvas.canvas.width, this.canvas.canvas.height);\r\n    // for (let offs of this.store.cacheDatas[index].offscreen) {\r\n    //   if (offs) {\r\n    //     ctx.drawImage(offs, 0, 0, this.canvas.width, this.canvas.height);\r\n    //   }\r\n    // }\r\n    // ctx.clearRect(0, 0, this.canvas.canvas.width, this.canvas.canvas.height);\r\n    this.store.data = this.store.cacheDatas[index].data;\r\n    this.setBackgroundImage(this.store.data.bkImage);\r\n    this.store.pens = {};\r\n    this.store.data.pens.forEach((pen) => {\r\n      pen.calculative.canvas = this.canvas;\r\n      this.store.pens[pen.id] = pen;\r\n      globalStore.path2dDraws[pen.name] &&\r\n        this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n\r\n      pen.type &&\r\n        this.store.path2dMap.set(pen, globalStore.path2dDraws[pen.name](pen));\r\n\r\n      if (pen.image) {\r\n        pen.calculative.imageDrawed = false;\r\n        this.canvas.loadImage(pen);\r\n      }\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  initBindDatas() {\r\n    this.store.bindDatas = {};\r\n    this.store.data.pens.forEach((pen) => {\r\n      pen.form?.forEach((formItem) => {\r\n        let dataIds: BindId[];\r\n        if (formItem.dataIds) {\r\n          if (Array.isArray(formItem.dataIds)) {\r\n            dataIds = formItem.dataIds;\r\n          } else {\r\n            dataIds = [formItem.dataIds];\r\n          }\r\n        }\r\n        dataIds?.forEach((item) => {\r\n          if (!this.store.bindDatas[item.dataId]) {\r\n            this.store.bindDatas[item.dataId] = [];\r\n          }\r\n          this.store.bindDatas[item.dataId].push({\r\n            id: pen.id,\r\n            formItem,\r\n          });\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  jetLinksList: any[] = [];\r\n  jetLinksClient: any;\r\n  \r\n  initBinds() {\r\n    this.jetLinksList = [];\r\n    this.store.bind = {};\r\n    this.store.data.pens.forEach((pen) => {\r\n      pen.realTimes?.forEach((realTime) => {\r\n        if (realTime.bind && realTime.bind.id) {\r\n          if (!this.store.bind[realTime.bind.id]) {\r\n            this.store.bind[realTime.bind.id] = [];\r\n          }\r\n          this.store.bind[realTime.bind.id].push({\r\n            id: pen.id,\r\n            key: realTime.key,\r\n          });\r\n\r\n          //JetLinks\r\n          const productId = realTime.productId || pen.productId;\r\n          const deviceId = realTime.deviceId || pen.deviceId;\r\n          const propertyId = realTime.propertyId;\r\n          if(productId && deviceId && propertyId){\r\n            const index = this.jetLinksList.findIndex((item)=>item.topic.startsWith(`/${productId}/${deviceId}`));\r\n            if(index>-1){\r\n              const properties = this.jetLinksList[index].properties;\r\n              if(!properties.includes(realTime.propertyId)){\r\n                this.jetLinksList[index].properties.push(realTime.propertyId);\r\n              }\r\n            }else{\r\n              this.jetLinksList.push({\r\n                topic:`/${productId}/${deviceId}`,\r\n                deviceId,\r\n                properties:[realTime.propertyId]\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  connectSocket() {\r\n    this.connectWebsocket();\r\n    this.connectMqtt();\r\n    this.connectHttp();\r\n  }\r\n\r\n  /**\r\n   * open 后执行初始化 Js ，每个图纸可配置一个初始化 js\r\n   */\r\n  private doInitJS() {\r\n    const initJs = this.store.data.initJs;\r\n    if (initJs && initJs.trim()) {\r\n      try {\r\n        const fn = new Function('context', initJs) as (context?: {\r\n          meta2d: Meta2d;\r\n        }) => void;\r\n        fn({ meta2d: this });\r\n      } catch (e) {\r\n        console.warn('initJs error', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  doInitFn() {\r\n    let params = queryURLParams();\r\n    let binds = [];\r\n    for (let key in params) {\r\n      if (params.hasOwnProperty(key)) {\r\n        if(key.startsWith('bind-')){\r\n          binds.push({\r\n            id:key.replace('bind-',''),\r\n            dataId:key.replace('bind-',''),\r\n            value:params[key]\r\n          })\r\n        }\r\n      }\r\n    }\r\n    if(binds.length){\r\n      this.setDatas(binds,{history:false});\r\n    }\r\n  }\r\n\r\n  drawLine(lineName?: string) {\r\n    lineName && lockedError(this.store);\r\n    this.canvas.drawingLineName = lineName;\r\n  }\r\n  alignPenToGrid(pen: Pen) {\r\n    this.canvas.alignPenToGrid(pen);\r\n  }\r\n  drawingPencil() {\r\n    this.canvas.drawingPencil();\r\n  }\r\n\r\n  stopPencil() {\r\n    this.canvas.stopPencil();\r\n  }\r\n\r\n  lock(lock: LockState) {\r\n    this.store.data.locked = lock;\r\n    this.finishDrawLine(true);\r\n    this.canvas.drawingLineName = '';\r\n    this.stopPencil();\r\n    //恢复可选状态\r\n    this.store.data.pens.forEach((pen) => {\r\n      if (pen.externElement === true) {\r\n        // pen.onMove && pen.onMove(pen);\r\n        pen.calculative.singleton?.div && setElemPosition(pen, pen.calculative.singleton.div);\r\n      }\r\n    });\r\n    if (lock > 0) {\r\n      this.initMessageEvents();\r\n    }\r\n  }\r\n\r\n  // end  - 当前鼠标位置，是否作为终点\r\n  async finishDrawLine(end?: boolean) {\r\n    await this.canvas.finishDrawline(end);\r\n  }\r\n\r\n  async finishPencil() {\r\n    await this.canvas.finishPencil();\r\n  }\r\n\r\n  updateLineType(pen: Pen, lineName: string) {\r\n    if (!pen || pen.name != 'line' || !lineName || !this.canvas[lineName]) {\r\n      return;\r\n    }\r\n\r\n    pen.lineName = lineName;\r\n    const from = getFromAnchor(pen);\r\n    const to = getToAnchor(pen);\r\n    from.prev = undefined;\r\n    from.next = undefined;\r\n    to.prev = undefined;\r\n    to.next = undefined;\r\n    pen.calculative.worldAnchors = [from, to];\r\n    pen.calculative.activeAnchor = from;\r\n    this.canvas[lineName](this.store, pen, to);\r\n    if (pen.lineName === 'curve') {\r\n      from.prev = {\r\n        penId: from.penId,\r\n        x: from.x - 50,\r\n        y: from.y,\r\n      };\r\n      from.next = {\r\n        penId: from.penId,\r\n        x: from.x + 50,\r\n        y: from.y,\r\n      };\r\n      to.prev = {\r\n        penId: to.penId,\r\n        x: to.x - 50,\r\n        y: to.y,\r\n      };\r\n      to.next = {\r\n        penId: to.penId,\r\n        x: to.x + 50,\r\n        y: to.y,\r\n      };\r\n    }\r\n    pen.calculative.activeAnchor = undefined;\r\n    this.canvas.initLineRect(pen);\r\n    this.render();\r\n  }\r\n\r\n  addDrawLineFn(fnName: string, fn: Function) {\r\n    this.canvas[fnName] = fn;\r\n    this.canvas.drawLineFns.push(fnName);\r\n  }\r\n\r\n  removeDrawLineFn(fnName: string) {\r\n    const index = this.canvas.drawLineFns.indexOf(fnName);\r\n    if (index > -1) {\r\n      this.canvas.drawLineFns.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  showMagnifier() {\r\n    this.canvas.showMagnifier();\r\n  }\r\n\r\n  hideMagnifier() {\r\n    this.canvas.hideMagnifier();\r\n  }\r\n\r\n  toggleMagnifier() {\r\n    this.canvas.toggleMagnifier();\r\n  }\r\n\r\n  /**\r\n   * 擦除画布，释放 store 上的 pens\r\n   * @param render 是否重绘\r\n   */\r\n  clear(render = true, template?: string) {\r\n    for (const pen of this.store.data.pens) {\r\n      pen.onDestroy?.(pen);\r\n    }\r\n    clearStore(this.store, template);\r\n    this.hideInput();\r\n    this.canvas.tooltip.hide();\r\n    if (this.map && this.map.isShow) {\r\n      this.map.show();\r\n      this.map.setView();\r\n    }\r\n    this.canvas.clearCanvas();\r\n    sessionStorage.removeItem('page');\r\n    this.store.clipboard = undefined;\r\n\r\n  \r\n    if (!this.store.sameTemplate) {\r\n      this.canvas.canvasTemplate.bgPatchFlags = true;\r\n    }\r\n    this.store.patchFlagsBackground = true;\r\n    this.store.patchFlagsTop = true;\r\n    this.setBackgroundImage(undefined);\r\n    render && this.render();\r\n  }\r\n\r\n  emit<T = any>(type: EventType, event?: T): void;\r\n  emit(type: '*', event?: any): void;\r\n  emit(type: EventType | '*', event: unknown) {\r\n    this.store.emitter.emit(type, event);\r\n  }\r\n\r\n  on<T = any>(type: EventType, handler: Handler<T>): Meta2d;\r\n  on(type: '*', handler: WildcardHandler): Meta2d;\r\n  on(type: EventType | '*', handler: WildcardHandler | Handler) {\r\n    this.store.emitter.on(type, handler);\r\n    return this;\r\n  }\r\n\r\n  off<T = any>(type: EventType, handler: Handler<T>): Meta2d;\r\n  off(type: '*', handler: WildcardHandler): Meta2d;\r\n  off(type: EventType | '*', handler: WildcardHandler | Handler) {\r\n    this.store.emitter.off(type, handler);\r\n    return this;\r\n  }\r\n\r\n  register = register;\r\n\r\n  registerCanvasDraw = registerCanvasDraw;\r\n\r\n  registerAnchors = registerAnchors;\r\n\r\n  // customeDock = (store, rect, pens, offset) => {xDock, yDock}\r\n  // customDock return:\r\n  // {\r\n  //   xDock: {x, y, step, prev, penId},\r\n  //   yDock: {x, y, step, prev, penId},\r\n  // }\r\n  // xDock，yDock - 水平或垂直方向的参考线\r\n  // prev - 参考线的起点\r\n  // x,y - 参考线的终点\r\n  // step - 自动吸附需要的偏移量\r\n  // penId - 参考线的笔\r\n  registerMoveDock(\r\n    dock: (\r\n      store: Meta2dStore,\r\n      rect: Rect,\r\n      pens: Pen[],\r\n      offset: Point\r\n    ) => { xDock: Point; yDock: Point }\r\n  ) {\r\n    this.canvas.customMoveDock = dock;\r\n  }\r\n\r\n  /**\r\n   * 参数同方法 registerMoveDock ，最后一个参数由 offset 偏移修改成了当前 resize 的点\r\n   */\r\n  registerResizeDock(\r\n    dock: (\r\n      store: Meta2dStore,\r\n      rect: Rect,\r\n      pens: Pen[],\r\n      resizeIndex: number\r\n    ) => { xDock: Point; yDock: Point }\r\n  ) {\r\n    this.canvas.customResizeDock = dock;\r\n  }\r\n\r\n  find(id: string): Pen[];\r\n  find(tag: string): Pen[];\r\n  find(idOrTag: string): Pen[] {\r\n    return this.canvas.find(idOrTag);\r\n  }\r\n\r\n  /**\r\n   * 使用 Array.find 找到即返回，否则返回 undefined\r\n   */\r\n  findOne(id: string): Pen | undefined;\r\n  findOne(tag: string): Pen | undefined;\r\n  findOne(idOrTag: string): Pen | undefined {\r\n    return this.canvas.findOne(idOrTag);\r\n  }\r\n\r\n  getPenRect(pen: Pen) {\r\n    return this.canvas.getPenRect(pen);\r\n  }\r\n\r\n  setPenRect(pen: Pen, rect: Rect, render = true) {\r\n    this.canvas.setPenRect(pen, rect, render);\r\n  }\r\n\r\n  startAnimate(idOrTagOrPens?: string | Pen[], params?: number | string): void {\r\n    this.stopAnimate(idOrTagOrPens);\r\n    let pens: Pen[];\r\n    // 没有参数 则播放有自动播放属性的动画\r\n    if (!idOrTagOrPens) {\r\n      pens = this.store.data.pens.filter((pen) => {\r\n        return (\r\n          ((pen.type || pen.frames) && pen.autoPlay) ||\r\n          (pen.animations &&\r\n            pen.animations.length &&\r\n            pen.animations.findIndex((i) => i.autoPlay) !== -1)\r\n        );\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n    if(!pens.length){\r\n      return;\r\n    }\r\n    pens.forEach((pen) => {\r\n      if (pen.calculative.pause) {\r\n        const d = Date.now() - pen.calculative.pause;\r\n        pen.calculative.pause = undefined;\r\n        pen.calculative.frameStart += d;\r\n        pen.calculative.frameEnd += d;\r\n      } else {\r\n        let index = -1;\r\n        if (params !== undefined && pen.animations) {\r\n          if (typeof params === 'string') {\r\n            index = pen.animations.findIndex(\r\n              (animation) => animation.name === params\r\n            );\r\n            if (index === -1) {\r\n              return;\r\n            }\r\n          } else if (typeof params === 'number') {\r\n            if (pen.animations.length > params) {\r\n              index = params;\r\n            } else {\r\n              return;\r\n            }\r\n          }\r\n        } else if (params === undefined) {\r\n          index = pen.animations?.findIndex((i) => i.autoPlay);\r\n          if (index === -1 && pen.animations?.length) {\r\n            //默认执行第0个动画\r\n            index = 0;\r\n          }\r\n        }\r\n        if (index !== -1 && index !== undefined) {\r\n          const animate = deepClone(pen.animations[index]);\r\n          animate.animateName = animate.name;\r\n          delete animate.name;\r\n          animate.currentAnimation = index;\r\n          if (!pen.type && animate.frames) {\r\n            animate.showDuration = this.calcAnimateDuration(animate);\r\n          }\r\n          //animations成立\r\n          this.setValue(\r\n            {\r\n              id: pen.id,\r\n              ...animate,\r\n            },\r\n            {\r\n              doEvent: false,\r\n              history: false,\r\n            }\r\n          );\r\n        }\r\n        this.store.animates.add(pen);\r\n        if (!pen.type) {\r\n          this.store.animateMap.set(\r\n            pen,\r\n            pen.calculative.canvas.getFrameProps(pen)\r\n          );\r\n        }\r\n      }\r\n    });\r\n    // this.canvas.canvasImage.init();\r\n    // this.canvas.canvasImageBottom.init();\r\n    this.initImageCanvas(pens);\r\n    this.canvas.animate();\r\n  }\r\n\r\n  pauseAnimate(idOrTagOrPens?: string | Pen[]) {\r\n    let pens: Pen[] = [];\r\n    if (!idOrTagOrPens) {\r\n      this.store.animates.forEach((pen) => {\r\n        pens.push(pen);\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n    pens.forEach((pen) => {\r\n      if (!pen.calculative.pause) {\r\n        pen.calculative.pause = Date.now();\r\n      }\r\n    });\r\n  }\r\n\r\n  stopAnimate(idOrTagOrPens?: string | Pen[]) {\r\n    let pens: Pen[] = [];\r\n    if (!idOrTagOrPens) {\r\n      this.store.animates.forEach((pen) => {\r\n        pens.push(pen);\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n    pens.forEach((pen) => {\r\n      pen.currentAnimation = undefined;\r\n      pen.calculative.pause = undefined;\r\n      pen.calculative.start = undefined;\r\n      pen.calculative.duration = undefined;\r\n      pen.calculative.animatePos = 0;\r\n      this.store.animates.delete(pen);\r\n      this.canvas.restoreNodeAnimate(pen);\r\n      this.canvas.updateLines(pen);\r\n      this.store.animateMap.delete(pen);\r\n    });\r\n    this.initImageCanvas(pens);\r\n    setTimeout(() => {\r\n      this.canvas?.calcActiveRect();\r\n      this.render();\r\n    }, 20);\r\n  }\r\n\r\n  startVideo(idOrTagOrPens?: string | Pen[]): void {\r\n    let pens: Pen[];\r\n    if (!idOrTagOrPens) {\r\n      pens = this.store.data.pens.filter((pen) => {\r\n        return (pen.video || pen.audio) && pen.autoPlay;\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n    pens.forEach((pen) => {\r\n      pen.calculative.media?.play();\r\n      pen.onStartVideo?.(pen);\r\n    });\r\n  }\r\n\r\n  pauseVideo(idOrTagOrPens?: string | Pen[]) {\r\n    let pens: Pen[] = [];\r\n    if (!idOrTagOrPens) {\r\n      //TODO 寻找所有 而不是正在播放的\r\n      pens = this.store.data.pens.filter((pen) => {\r\n        return (pen.video || pen.audio) && pen.autoPlay;\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n    pens.forEach((pen) => {\r\n      pen.calculative.media?.pause();\r\n      pen.onPauseVideo?.(pen);\r\n    });\r\n  }\r\n\r\n  stopVideo(idOrTagOrPens?: string | Pen[]) {\r\n    let pens: Pen[] = [];\r\n    if (!idOrTagOrPens) {\r\n      pens = this.store.data.pens.filter((pen) => {\r\n        return (pen.video || pen.audio) && pen.autoPlay;\r\n      });\r\n    } else if (typeof idOrTagOrPens === 'string') {\r\n      pens = this.find(idOrTagOrPens);\r\n    } else {\r\n      pens = idOrTagOrPens;\r\n    }\r\n\r\n    pens.forEach((pen) => {\r\n      if (pen.calculative.media) {\r\n        pen.calculative.media.currentTime = 0;\r\n        pen.calculative.media.pause();\r\n      }\r\n      pen.onStopVideo?.(pen);\r\n    });\r\n  }\r\n\r\n  calcAnimateDuration(pen: Pen) {\r\n    return pen.frames.reduce((prev, frame) => prev + frame.duration, 0);\r\n  }\r\n\r\n  /**\r\n   * 组合\r\n   * @param pens 组合的画笔们\r\n   * @param showChild 组合后展示第几个孩子\r\n   */\r\n  combine(pens: Pen[] = this.store.active, showChild?: number):any {\r\n    if (!pens || !pens.length) {\r\n      return;\r\n    }\r\n\r\n    const initPens = deepClone(pens);\r\n    if (pens.length === 1 && pens[0].type) {\r\n      pens[0].type = PenType.Node;\r\n      this.canvas.active(pens);\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        initPens,\r\n        pens: deepClone(pens, true),\r\n      });\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    const rect = getRect(pens);\r\n    let parent: Pen = {\r\n      id: s8(),\r\n      name: 'combine',\r\n      ...rect,\r\n      children: [],\r\n      showChild,\r\n    };\r\n    // const p = pens.find((pen) => {\r\n    //   // TODO: js 计算误差，可能导致包含着其它的 pens 的最大 pen 无法计算出来\r\n    //   return pen.width === rect.width && pen.height === rect.height;\r\n    // });\r\n    // // 其中一个认为是父节点\r\n    // const oneIsParent = p && showChild == undefined;\r\n    // if (oneIsParent) {\r\n    //   if (!p.children) {\r\n    //     p.children = [];\r\n    //   }\r\n    //   parent = p;\r\n    // } else {\r\n    // 若组合为状态，那么 parent 一定是 combine\r\n    this.canvas.makePen(parent);\r\n    // }\r\n    const initParent = deepClone(parent);\r\n    let minIndex = Infinity;\r\n    pens.forEach((pen) => {\r\n      const index = this.store.data.pens.findIndex(\r\n        (_pen) => _pen.id === pen.id\r\n      );\r\n      if (index < minIndex) {\r\n        minIndex = index;\r\n      }\r\n      if (pen === parent || pen.parentId === parent.id || pen.id === parent.id) {\r\n        return;\r\n      }\r\n      // pen 来自于 store.active ，不存在有 parentId 的情况\r\n      parent.children.push(pen.id);\r\n      pen.parentId = parent.id;\r\n      const childRect = calcRelativeRect(pen.calculative.worldRect, rect);\r\n      Object.assign(pen, childRect);\r\n      pen.locked = pen.lockedOnCombine ?? LockState.None;\r\n      pen.locked = (pen.interaction || isInteraction.includes(pen.name)) ? 0 : pen.locked;\r\n    });\r\n    //将组合后的父节点置底\r\n    this.store.data.pens.splice(minIndex, 0, parent);\r\n    this.store.data.pens.pop();\r\n    this.canvas.active([parent]);\r\n    let step = 1;\r\n    // if (!oneIsParent) {\r\n    //   step = 2;\r\n    //   this.pushHistory({\r\n    //     type: EditType.Add,\r\n    //     pens: [parent],\r\n    //     step,\r\n    //   });\r\n    //   this.store.emitter.emit('add', [parent]);\r\n    // }\r\n    this.pushHistory({\r\n      type: EditType.Add,\r\n      pens: [initParent],\r\n      step: 3,\r\n    });\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens: [initParent],\r\n      pens: [parent],\r\n      step: 3,\r\n    });\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n      step: 3,\r\n    });\r\n    if (showChild != undefined) {\r\n      pens.forEach((pen) => {\r\n        calcInView(pen, true);\r\n      });\r\n      this.initImageCanvas([parent]);\r\n    }\r\n    this.store.emitter.emit('combine', [parent]);\r\n    this.render();\r\n    return parent;\r\n  }\r\n\r\n  uncombine(pen?: Pen) {\r\n    if (!pen && this.store.active) {\r\n      pen = this.store.active[0];\r\n    }\r\n    if (!pen || !pen.children) {\r\n      return;\r\n    }\r\n\r\n    const children = pen.children.map((childId) => this.store.pens[childId]);\r\n    let initPens = deepClone(children);\r\n    children.forEach((child) => {\r\n      child.parentId = undefined;\r\n      child.x = child.calculative.worldRect.x;\r\n      child.y = child.calculative.worldRect.y;\r\n      child.width = child.calculative.worldRect.width;\r\n      child.height = child.calculative.worldRect.height;\r\n      child.locked = LockState.None;\r\n      child.calculative.active = undefined;\r\n      child.calculative.hover = false;\r\n      this.setVisible(child, true); // 子节点的 visible 属性已经改变，需要恢复\r\n    });\r\n    const step = this.isCombine(pen) ? 3 : 2;\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens: children,\r\n      step,\r\n    });\r\n    initPens = [deepClone(pen)];\r\n    pen.children = undefined;\r\n    // 保存修改 children 的历史记录\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens: [pen],\r\n      step,\r\n    });\r\n    if (this.isCombine(pen)) {\r\n      this.delete([pen]);\r\n      // delete 会记录 history , 更改 step 即可\r\n      this.store.histories[this.store.histories.length - 1].step = step;\r\n    }\r\n    this.inactive();\r\n  }\r\n\r\n  appendChild(pens: Pen[] = this.store.active){\r\n    if(!pens){\r\n      return;\r\n    }\r\n    if(pens.length < 2){\r\n      return;\r\n    }\r\n    const pIdx = pens.findIndex(pen=>pen.name === 'combine'&&pen.showChild !== undefined);\r\n    if(pIdx !== -1){\r\n      let parent = pens[pIdx];\r\n      // this.pushChildren(parent,[...pens.slice(0, pIdx), ...pens.slice(pIdx + 1)]);\r\n      const rect = getRect(pens);\r\n      Object.assign(parent, rect);\r\n      Object.assign(parent.calculative.worldRect, rect);\r\n      calcWorldAnchors(parent);\r\n      parent.children.forEach(penId => {\r\n        const pen = this.store.pens[penId];\r\n        const childRect = calcRelativeRect(pen.calculative.worldRect, rect);\r\n        Object.assign(pen, childRect);\r\n      });\r\n      pens.forEach((pen) => {\r\n        if(pen.id !== parent.id){\r\n          parent.children.push(pen.id);\r\n          pen.parentId = parent.id;\r\n          const childRect = calcRelativeRect(pen.calculative.worldRect, rect);\r\n          Object.assign(pen, childRect);\r\n          pen.locked = pen.lockedOnCombine ?? LockState.DisableMove;\r\n          pen.locked = (pen.interaction || isInteraction.includes(pen.name)) ? 0 : pen.locked;\r\n          calcInView(pen, true);\r\n        }\r\n      });\r\n      this.initImageCanvas(pens);\r\n      this.render();\r\n    }else{\r\n      console.warn('Invalid operation!');\r\n    }\r\n  }\r\n\r\n  /***\r\n   * 修改子图元大小，更新整个组合图元\r\n   * @param rect 新的大小 世界坐标\r\n   * @param child 待更新子图元\r\n   * @param parent 父图元\r\n   */\r\n  updateRectbyChild(rect:Rect, child:Pen, parent:Pen){\r\n    calcRightBottom(rect);\r\n    calcCenter(rect);\r\n    child.calculative.worldRect = rect;\r\n    if(rectInRect(rect, parent.calculative.worldRect,true)){\r\n      const childRect = calcRelativeRect(rect, parent.calculative.worldRect);\r\n      Object.assign(child, childRect);\r\n    }else{\r\n      let x = Math.min(rect.x,parent.calculative.worldRect.x);\r\n      let y = Math.min(rect.y,parent.calculative.worldRect.y);\r\n      let ex = Math.max(rect.ex,parent.calculative.worldRect.ex);\r\n      let ey = Math.max(rect.ey,parent.calculative.worldRect.ey);\r\n      parent.calculative.worldRect = {\r\n        x:x,\r\n        y:y,\r\n        width:ex-x,\r\n        height:ey-y,\r\n        ex,\r\n        ey\r\n      }\r\n      if(!parent.parentId){\r\n        Object.assign(parent,parent.calculative.worldRect);\r\n      }\r\n      calcCenter(parent.calculative.worldRect);\r\n      parent.children.forEach((cid)=>{\r\n      const cPen = this.store.pens[cid];\r\n      const childRect = calcRelativeRect(cPen.calculative.worldRect, parent.calculative.worldRect);\r\n        Object.assign(cPen, childRect);\r\n      });\r\n      if(parent.parentId){\r\n       this.updateRectbyChild(parent.calculative.worldRect,parent,this.store.pens[parent.parentId]);\r\n      }\r\n    }\r\n    this.canvas.updatePenRect(parent);\r\n    this.render();\r\n  }\r\n\r\n  isCombine(pen: Pen) {\r\n    if (pen.name === 'combine') {\r\n      return true;\r\n    }\r\n    if (pen.children && pen.children.length > 0) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  active(pens: Pen[], emit = true) {\r\n    this.canvas.active(pens, emit);\r\n  }\r\n\r\n  inactive() {\r\n    this.canvas.inactive();\r\n  }\r\n\r\n  activeAll() {\r\n    this.canvas.active(\r\n      this.store.data.pens.filter(\r\n        (pen) => !pen.parentId && pen.locked !== LockState.Disable\r\n      )\r\n    );\r\n    this.render();\r\n  }\r\n\r\n  focus(id:string){\r\n    const pen = this.findOne(id);\r\n    if(pen){\r\n      this.store.hover = pen;\r\n      this.store.hover.calculative.hover = true;\r\n      this.showInput(pen);\r\n    }\r\n  }\r\n  /**\r\n   * 删除画笔\r\n   * @param pens 需要删除的画笔们\r\n   * @param canDelLocked 是否删除已经锁住的画笔\r\n   */\r\n  delete(pens?: Pen[], canDelLocked = false, history = true) {\r\n    this.canvas.delete(pens, canDelLocked, history);\r\n  }\r\n\r\n  scale(scale: number, center = { x: 0, y: 0 }) {\r\n    this.canvas.scale(scale, center);\r\n  }\r\n\r\n  translate(x: number, y: number) {\r\n    this.canvas.translate(x, y);\r\n  }\r\n\r\n  translatePens(pens: Pen[], x: number, y: number) {\r\n    this.canvas.translatePens(pens, x, y);\r\n  }\r\n\r\n  getParent(pen: Pen, root?: boolean) {\r\n    return getParent(pen, root);\r\n  }\r\n\r\n  getAllChildren(pen: Pen) {\r\n    return getAllChildren(pen, this.store);\r\n  }\r\n\r\n  getAllFollowers(pen: Pen) {\r\n    return getAllFollowers(pen, this.store);\r\n  }\r\n\r\n  data(): Meta2dData {\r\n    const data: Meta2dData = deepClone(this.store.data);\r\n    const { pens, paths } = this.store.data;\r\n    data.version = pkg.version;\r\n    // TODO: 未在 delete 时清除，避免撤销等操作。\r\n    // 清除一些未使用到的 paths\r\n    data.paths = {};\r\n    for (const pathId in paths) {\r\n      if (Object.prototype.hasOwnProperty.call(paths, pathId)) {\r\n        if (pens.find((pen) => pen.pathId === pathId)) {\r\n          data.paths[pathId] = paths[pathId];\r\n        }\r\n      }\r\n    }\r\n    data.dataPoints = [...Object.keys(this.store.bind),...Object.keys(this.store.bindDatas)];\r\n    return data;\r\n  }\r\n\r\n  copy(pens?: Pen[]) {\r\n    this.canvas.copy(pens);\r\n  }\r\n\r\n  cut(pens?: Pen[]) {\r\n    this.canvas.cut(pens);\r\n  }\r\n\r\n  paste() {\r\n    this.canvas.paste();\r\n  }\r\n\r\n  undo() {\r\n    this.canvas.undo();\r\n  }\r\n\r\n  redo() {\r\n    this.canvas.redo();\r\n  }\r\n\r\n  listenSocket() {\r\n    try {\r\n      let socketFn: (\r\n        e: string,\r\n        context?: {\r\n          meta2d?: Meta2d;\r\n          type?: string;\r\n          topic?: string;\r\n          url?: string;\r\n        }\r\n      ) => boolean;\r\n      const socketCbJs = this.store.data.socketCbJs;\r\n      if (socketCbJs) {\r\n        socketFn = new Function('e', 'context', socketCbJs) as (\r\n          e: string,\r\n          context?: {\r\n            meta2d?: Meta2d;\r\n            type?: string;\r\n            topic?: string;\r\n            url?: string;\r\n          }\r\n        ) => boolean;\r\n      }\r\n      if (!socketFn) {\r\n        this.socketFn = null;\r\n        return false;\r\n      }\r\n      this.socketFn = socketFn;\r\n    } catch (e) {\r\n      console.error('Create the function for socket:', e);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  websocketTimes = 0;\r\n  connectWebsocket(websocket?: string) {\r\n    this.closeWebsocket();\r\n    if (websocket) {\r\n      this.store.data.websocket = websocket;\r\n    }\r\n    if (this.store.data.websocket) {\r\n      this.websocket = new WebSocket(\r\n        this.store.data.websocket,\r\n        this.store.data.websocketProtocols || undefined\r\n      );\r\n      this.websocket.onmessage = (e) => {\r\n        this.socketCallback(e.data, {\r\n          type: 'websocket',\r\n          url: this.store.data.websocket,\r\n        });\r\n      };\r\n\r\n      this.websocket.onerror = (error) => {\r\n        this.store.emitter.emit('error', { type: 'websocket', error });\r\n      }\r\n\r\n      this.websocket.onclose = () => {\r\n        if (this.store.options.reconnetTimes) {\r\n          this.websocketTimes++;\r\n          if (this.websocketTimes >= this.store.options.reconnetTimes) {\r\n            this.websocketTimes = 0;\r\n            this.closeWebsocket();\r\n            return;\r\n          }\r\n        }\r\n        console.info('Canvas websocket closed and reconneting...');\r\n        this.connectWebsocket();\r\n      };\r\n    }\r\n  }\r\n\r\n  closeWebsocket() {\r\n    if (this.websocket) {\r\n      this.websocket.onclose = undefined;\r\n      this.websocket.close();\r\n      this.websocket = undefined;\r\n    }\r\n  }\r\n\r\n  mqttTimes = 0;\r\n  connectMqtt(params?: {\r\n    mqtt: string;\r\n    mqttTopics: string;\r\n    mqttOptions?: {\r\n      clientId?: string;\r\n      username?: string;\r\n      password?: string;\r\n      customClientId?: boolean;\r\n    };\r\n  }) {\r\n    this.closeMqtt();\r\n    if (params) {\r\n      this.store.data.mqtt = params.mqtt;\r\n      this.store.data.mqttTopics = params.mqttTopics;\r\n      this.store.data.mqttOptions = params.mqttOptions;\r\n    }\r\n    if (this.store.data.mqtt) {\r\n      if (\r\n        this.store.data.mqttOptions.clientId &&\r\n        !this.store.data.mqttOptions.customClientId\r\n      ) {\r\n        this.store.data.mqttOptions.clientId = s8();\r\n      }\r\n      const mqttOptions = {...this.store.data.mqttOptions};\r\n      // 如果没有username/password或为空字符串则删除username/password\r\n      if(!mqttOptions.username) {\r\n        delete mqttOptions.username;\r\n      }\r\n      if(!mqttOptions.password) {\r\n        delete mqttOptions.password;\r\n      }\r\n      const {username, password} = mqttOptions;\r\n      // username 和 password 必须同时存在或者同时不存在才去建立mqtt连接\r\n      if ((username && password)|| (!username && !password)) {\r\n        this.mqttClient = mqtt.connect(\r\n          this.store.data.mqtt,\r\n          mqttOptions\r\n        );\r\n        this.mqttClient.on('message', (topic: string, message: Buffer) => {\r\n          this.socketCallback(message.toString(), {\r\n            topic,\r\n            type: 'mqtt',\r\n            url: this.store.data.mqtt,\r\n          });\r\n        });\r\n        \r\n        this.mqttClient.on('error', (error) => {\r\n          this.store.emitter.emit('error', { type: 'mqtt', error });\r\n        });\r\n\r\n        this.mqttClient.on('close', () => {\r\n          if (this.store.options.reconnetTimes) {\r\n            this.mqttTimes++;\r\n            if (this.mqttTimes >= this.store.options.reconnetTimes) {\r\n              this.mqttTimes = 0;\r\n              this.closeMqtt();\r\n            }\r\n          }\r\n        });\r\n\r\n        if (this.store.data.mqttTopics) {\r\n          this.mqttClient.subscribe(this.store.data.mqttTopics.split(','));\r\n        }\r\n      } else {\r\n        console.warn('缺少用户名或密码');\r\n      }\r\n    }\r\n  }\r\n\r\n  closeMqtt() {\r\n    this.mqttClient?.end();\r\n  }\r\n\r\n  httpTimer: any;\r\n  httpTimerList: any[] = [];\r\n  connectHttp() {\r\n    this.closeHttp();\r\n    const { https } = this.store.data;\r\n    if (https) {\r\n      if (!this.store.data.cancelFirstConnect) {\r\n        https.forEach(async (item) => {\r\n          this.oldRequestHttp(item);\r\n        });\r\n      }\r\n      https.forEach((item, index) => {\r\n        if (item.http) {\r\n          item.times = 0;\r\n          this.httpTimerList[index] = setInterval(async () => {\r\n            // 默认每一秒请求一次\r\n            this.oldRequestHttp(item);\r\n            if (this.store.options.reconnetTimes) {\r\n              item.times++;\r\n              if (item.times >= this.store.options.reconnetTimes) {\r\n                item.times = 0;\r\n                clearInterval(this.httpTimerList[index]);\r\n                this.httpTimerList[index] = undefined;\r\n              }\r\n            }\r\n          }, item.httpTimeInterval || 1000);\r\n        }\r\n      });\r\n    } else {\r\n      const { http, httpTimeInterval, httpHeaders } = this.store.data;\r\n      if (http) {\r\n        this.httpTimer = setInterval(async () => {\r\n          // 默认每一秒请求一次\r\n          const res: Response = await fetch(http, {\r\n            headers: httpHeaders,\r\n          });\r\n          if (res.ok) {\r\n            const data = await res.text();\r\n            this.socketCallback(data, { type: 'http', url: http });\r\n          }\r\n        }, httpTimeInterval || 1000);\r\n      }\r\n    }\r\n  }\r\n\r\n  async oldRequestHttp(_req: HttpOptions) {\r\n    let req = deepClone(_req);\r\n    if (req.http) {\r\n      const res: Response = await fetch(req.http, {\r\n        headers: req.httpHeaders,\r\n        method: req.method || 'GET',\r\n        body: req.method === 'POST' ? JSON.stringify(req.body) : undefined,\r\n      });\r\n      if (res.ok) {\r\n        const data = await res.text();\r\n        this.socketCallback(data, { type: 'http', url: req.http });\r\n      } else {\r\n        this.store.emitter.emit('error', { type: 'http', error: res });\r\n      }\r\n    }\r\n  }\r\n\r\n  async sendDatabyHttp(data: string) {\r\n    const { https } = this.store.data;\r\n    if (https) {\r\n      https.forEach(async (item) => {\r\n        if (item.http) {\r\n          const res: Response = await fetch(item.http, {\r\n            method: 'post',\r\n            body: data,\r\n            headers: item.httpHeaders,\r\n          });\r\n          if (res.ok) {\r\n            console.info('http消息发送成功');\r\n          }\r\n        }\r\n      });\r\n    } else {\r\n      const { http, httpHeaders } = this.store.data;\r\n      if (http) {\r\n        // 默认每一秒请求一次\r\n        const res: Response = await fetch(http, {\r\n          method: 'post',\r\n          body: data,\r\n          headers: httpHeaders,\r\n        });\r\n        if (res.ok) {\r\n          console.info('http消息发送成功');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  closeHttp() {\r\n    clearInterval(this.httpTimer);\r\n    this.httpTimer = undefined;\r\n    this.httpTimerList &&\r\n      this.httpTimerList.forEach((_httpTimer) => {\r\n        clearInterval(_httpTimer);\r\n        _httpTimer = undefined;\r\n      });\r\n  }\r\n\r\n  updateTimer: any;\r\n  updateTimerList: any[] = [];\r\n  sqlTimerList: any[] = [];\r\n  connectNetwork() {\r\n    this.closeNetwork();\r\n    const { networks } = this.store.data;\r\n    const https = [];\r\n    if (networks) {\r\n      let mqttIndex = 0;\r\n      this.mqttClients = [];\r\n      let websocketIndex = 0;\r\n      let sqlIndex = 0;\r\n      this.websockets = [];\r\n      networks.forEach(async (net) => {\r\n        // if (net.type === 'subscribe') {\r\n          if (net.protocol === 'mqtt') {\r\n            net.index = mqttIndex;\r\n            if (net.options.clientId && !net.options.customClientId) {\r\n              net.options.clientId = s8();\r\n            }\r\n            net.times = 0;\r\n            this.mqttClients[mqttIndex] = mqtt.connect(net.url, net.options);\r\n            this.mqttClients[mqttIndex].on(\r\n              'message',\r\n              (topic: string, message: Buffer) => {\r\n                this.socketCallback(message.toString(), {\r\n                  topic,\r\n                  type: 'mqtt',\r\n                  url: net.url,\r\n                });\r\n              }\r\n            );\r\n            this.mqttClients[mqttIndex].on('error', (error) => {\r\n              this.store.emitter.emit('error', { type: 'mqtt', error });\r\n            });\r\n\r\n            this.mqttClients[mqttIndex].on('close', () => {\r\n              if (this.store.options.reconnetTimes) {\r\n                net.times++;\r\n                if (net.times >= this.store.options.reconnetTimes) {\r\n                  net.times = 0;\r\n                  this.mqttClients && this.mqttClients[net.index]?.end();\r\n                }\r\n              }\r\n            });\r\n            if (net.topics) {\r\n              this.mqttClients[mqttIndex].subscribe(net.topics.split(','));\r\n            }\r\n            mqttIndex += 1;\r\n          } else if (net.protocol === 'websocket') {\r\n            net.index = websocketIndex;\r\n            this.connectNetWebSocket(net);\r\n            // this.websockets[websocketIndex] = new WebSocket(\r\n            //   net.url,\r\n            //   net.protocols || undefined\r\n            // );\r\n            // this.websockets[websocketIndex].onmessage = (e) => {\r\n            //   this.socketCallback(e.data, { type: 'websocket', url: net.url });\r\n            // };\r\n            // this.websockets[websocketIndex].onerror = (error) => {\r\n            //   this.store.emitter.emit('error', { type: 'websocket', error });\r\n            // };\r\n            // this.websockets[websocketIndex].onclose = () => {\r\n            //   if (this.store.options.reconnetTimes) {\r\n            //     net.times++;\r\n            //     if (net.times >= this.store.options.reconnetTimes) {\r\n            //       net.times = 0;\r\n            //       this.websockets[net.index]?.close();\r\n            //       return;\r\n            //     }\r\n            //   }\r\n              // console.info('Canvas websocket closed and reconneting...');\r\n            // };\r\n\r\n            websocketIndex += 1;\r\n          } else if (net.protocol === 'http') {\r\n            https.push({\r\n              url: net.url,\r\n              interval: net.interval,\r\n              headers: net.headers || undefined,\r\n              method: net.method,\r\n              body: net.body,\r\n            });\r\n          }else if(net.protocol === 'iot'){\r\n            const token = await this.getIotToken(net.devices);\r\n            //物联网设备\r\n            if(net.method === 'mqtt'){\r\n              net.index = mqttIndex;\r\n              this.mqttClients[mqttIndex] = mqtt.connect(net.url);\r\n              this.mqttClients[mqttIndex].on('message', (topic: string, message: Buffer) => {\r\n                this.socketCallback(message.toString(), {\r\n                  topic:`le5le-iot/properties/${token}`,\r\n                  type: 'iot',\r\n                  url: net.url,\r\n                  method: 'mqtt'\r\n                });\r\n              })\r\n              this.mqttClients[mqttIndex].on('error', (error) => {\r\n                this.store.emitter.emit('error', { type: 'mqtt', error });\r\n              });\r\n              this.mqttClients[mqttIndex].subscribe(`le5le-iot/properties/${token}`);\r\n              mqttIndex += 1;\r\n            }else if(net.method === 'websocket'){\r\n              net.index = websocketIndex;\r\n              this.websockets[websocketIndex] = new WebSocket(\r\n                `${location.protocol === 'https:'?'wss':'ws'}://${location.host}/api/ws/iot/properties`,\r\n                token\r\n              );\r\n              this.websockets[websocketIndex].onmessage = (e) => {\r\n                this.socketCallback(e.data, { type: 'iot', method: 'websocket' });   \r\n              };\r\n              this.websockets[websocketIndex].onerror = (error) => {\r\n                this.store.emitter.emit('error', { type: 'websocket', error });\r\n              };\r\n              websocketIndex += 1;\r\n            }\r\n          }else if(net.protocol === 'sql'){\r\n            await this.doSqlCode('list',net.dbId,net.sql);\r\n            if(net.interval){\r\n              net.index = sqlIndex;\r\n              this.sqlTimerList[sqlIndex] = setInterval(async () => {\r\n                await this.doSqlCode('list',net.dbId,net.sql);\r\n              }, net.interval);\r\n              sqlIndex += 1;\r\n            }\r\n          }else if(net.protocol === 'jetLinks'){\r\n            if(this.jetLinksList.length){\r\n              this.jetLinksClient = new WebSocket(\r\n                `${net.url}/${localStorage.getItem('X-Access-Token') || this.getCookie('X-Access-Token') ||  new URLSearchParams(location.search).get('X-Access-Token') || ''}`,\r\n                // 'ws://8.134.86.52:29000/api/messaging/961d8b395298d3ec3a021df70d6b6ca4'\r\n              );\r\n              //消息接收\r\n              this.jetLinksClient.onmessage = (e) => {\r\n                const mess = JSON.parse(e.data);\r\n                if(mess.payload&&mess.payload.success&&mess.payload?.properties){\r\n                  const data = [];\r\n                  for(let key in mess.payload.properties){\r\n                    if(!key.startsWith('_')){\r\n                      data.push({\r\n                        id:`${mess.payload.headers.productId}#${mess.payload.deviceId}#${key}`,\r\n                        value:mess.payload.properties[key]\r\n                      })\r\n                    }\r\n                  }\r\n                  this.setDatas(data,{history:false});\r\n                }\r\n              }\r\n              this.jetLinksClient.onopen = ()=>{\r\n                this.jetLinksList.forEach((item)=>{\r\n                  this.jetLinksClient.send(JSON.stringify({\r\n                      \"type\": \"sub\",\r\n                      \"topic\": `/device${item.topic}/message/property/report`,\r\n                      \"parameter\": {\r\n                        \"deviceId\":item.deviceId,\r\n                        \"properties\":item.properties,\r\n                        \"history\":1\r\n                      },\r\n                      \"id\": item.topic+'-'+s8()\r\n                    }));\r\n                })\r\n              }\r\n            }\r\n          }\r\n      });\r\n    }\r\n    this.onNetworkConnect(https);\r\n  }\r\n  \r\n  connectNetWebSocket(net:Network){\r\n    if(this.websockets[net.index]){\r\n      this.websockets[net.index].onclose = undefined;\r\n      this.websockets[net.index]?.close();\r\n      this.websockets[net.index] = undefined;\r\n    }\r\n    this.websockets[net.index] = new WebSocket(\r\n      net.url,\r\n      net.protocols || undefined\r\n    );\r\n    this.websockets[net.index].onmessage = (e) => {\r\n      this.socketCallback(e.data, { type: 'websocket', url: net.url });\r\n    };\r\n    this.websockets[net.index].onerror = (error) => {\r\n      this.store.emitter.emit('error', { type: 'websocket', error });\r\n    };\r\n    this.websockets[net.index].onclose = () => {\r\n      if (this.store.options.reconnetTimes) {\r\n        net.times++;\r\n        if (net.times >= this.store.options.reconnetTimes) {\r\n          net.times = 0;\r\n          this.websockets[net.index].onclose = undefined;\r\n          this.websockets[net.index]?.close();\r\n          this.websockets[net.index] = undefined;\r\n          return;\r\n        }\r\n      }\r\n      setTimeout(() => {\r\n        console.info('Canvas websocket closed and reconneting...');\r\n        this.connectNetWebSocket(net);\r\n      },2000);\r\n    };\r\n  }\r\n\r\n  async getIotToken(devices:any){\r\n    const res: Response = await fetch('/api/iot/subscribe/properties', {\r\n      method: 'POST',\r\n      body:JSON.stringify({devices: devices}),\r\n    });\r\n    if (res.ok) {\r\n      const data = await res.text();\r\n      return JSON.parse(data).token;\r\n    }\r\n  }\r\n\r\n    \r\n  async doSqlCode(type:string, dbid:string,sql:string){\r\n    const res: Response = await fetch( `/api/iot/data/sql/${type}`, {\r\n      method: 'POST',\r\n      body:JSON.stringify({ dbid,sql,}),\r\n    });\r\n    if (res.ok) {\r\n      const data = await res.text();\r\n      if(data){\r\n        this.socketCallback(data, { type: 'sql', url: `/api/iot/data/sql/${type}` });\r\n      }\r\n    }\r\n  }  \r\n\r\n  randomString(e: number) {\r\n    e = e || 32;\r\n    let t = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678',\r\n      a = t.length,\r\n      n = '';\r\n    for (let i = 0; i < e; i++) {\r\n      n += t.charAt(Math.floor(Math.random() * a));\r\n    }\r\n    return n;\r\n  }\r\n  \r\n  mockValue(data){\r\n    let value = undefined;\r\n    if (data.enableMock && data.mock !== undefined) {\r\n      if (data.type === 'float') {\r\n        if (data.mock && data.mock.indexOf(',') !== -1) {\r\n          let arr = data.mock.split(',');\r\n          let rai = Math.floor(Math.random() * arr.length);\r\n          value = parseFloat(arr[rai]);\r\n        } else if (data.mock && data.mock.indexOf('-') !== -1) {\r\n          let max;\r\n          let min;\r\n          let len;\r\n          let arr = data.mock.split('-');\r\n          if (data.mock.charAt(0) === '-') {\r\n            //负数\r\n            if (arr.length === 4) {\r\n              max = -parseFloat(arr[3]);\r\n              min = -parseFloat(arr[1]);\r\n              len = arr[3];\r\n            } else {\r\n              max = parseFloat(arr[2]);\r\n              min = -parseFloat(arr[1]);\r\n              len = arr[2];\r\n            }\r\n          } else {\r\n            max = parseFloat(arr[1]);\r\n            min = parseFloat(arr[0]);\r\n            len = arr[1];\r\n          }\r\n          if ((len + '').indexOf('.') !== -1) {\r\n            let length = (len + '').split('.')[1].length;\r\n            value = (Math.random() * (max - min) + min).toFixed(\r\n              length\r\n            );\r\n          } else {\r\n            value = Math.random() * (max - min) + min;\r\n          }\r\n        } else {\r\n          value = parseFloat(data.mock);\r\n        }\r\n      } else if (data.type === 'integer') {\r\n        if (data.mock && data.mock.indexOf(',') !== -1) {\r\n          let arr = data.mock.split(',');\r\n          let rai = Math.floor(Math.random() * arr.length);\r\n          value = parseInt(arr[rai]);\r\n        } else if (data.mock && data.mock.indexOf('-') !== -1) {\r\n          let max;\r\n          let min;\r\n          let arr = data.mock.split('-');\r\n          if (data.mock.charAt(0) === '-') {\r\n            if (arr.length === 4) {\r\n              max = -parseFloat(arr[3]);\r\n              min = -parseFloat(arr[1]);\r\n            } else {\r\n              max = parseFloat(arr[2]);\r\n              min = -parseFloat(arr[1]);\r\n            }\r\n          } else {\r\n            max = parseInt(arr[1]);\r\n            min = parseInt(arr[0]);\r\n          }\r\n          value= parseInt(\r\n            Math.random() * (max - min) + min + ''\r\n          );\r\n        } else {\r\n          value = parseInt(data.mock);\r\n        }\r\n      } else if (data.type === 'bool') {\r\n        if (typeof data.mock === 'boolean') {\r\n          value = data.mock;\r\n        } else if ('true' === data.mock) {\r\n          value = true;\r\n        } else if ('false' === data.mock) {\r\n          value = false;\r\n        } else {\r\n          value = Math.random() < 0.5;\r\n        }\r\n      } else if (data.type === 'object' || data.type === 'array') {\r\n        if (data.mock) {\r\n          //对象or数组 不mock\r\n          // _d[realTime.key] = realTime.value;\r\n        }\r\n      } else {\r\n        //if (realTime.type === 'string')\r\n        if (data.mock && data.mock.indexOf(',') !== -1) {\r\n          let str = data.mock.substring(1, data.mock.length - 1);\r\n          let arr = str.split(',');\r\n          let rai = Math.floor(Math.random() * arr.length);\r\n          value = arr[rai];\r\n        } else if (\r\n          data.mock &&\r\n          data.mock.startsWith('[') &&\r\n          data.mock.endsWith(']')\r\n        ) {\r\n          let len = parseInt(\r\n            data.mock.substring(1, data.mock.length - 1)\r\n          );\r\n          value = this.randomString(len);\r\n        } else {\r\n          value = data.mock;\r\n        }\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n\r\n  //数据模拟\r\n  dataMock(){\r\n    let arr = [];\r\n    this.store.data.dataset?.devices?.forEach((data)=>{\r\n      let value = this.mockValue(data);\r\n      if(value!==undefined){\r\n        arr.push({\r\n          id: data.id,\r\n          value\r\n        })\r\n      }\r\n    });\r\n    if(arr.length){\r\n      this.setDatas(arr, {\r\n        render:true,\r\n        doEvent:true,\r\n        history:false,\r\n      });\r\n    }\r\n  }\r\n\r\n  startDataMock(){\r\n    let enable = this.store.data.enableMock;\r\n    if(enable){\r\n      this.stopDataMock();\r\n      this.initBinds();\r\n      this.updateTimer = setInterval(() => {\r\n        //本地调试\r\n        this.store.data.pens.forEach((pen) => {\r\n          this.penMock(pen);\r\n        });\r\n        this.dataMock();\r\n        this.render();\r\n      }, this.store.data.networkInterval || 1000);\r\n    }\r\n  }\r\n\r\n  stopDataMock(){\r\n    clearInterval(this.updateTimer);\r\n    this.updateTimer = undefined;\r\n  }\r\n\r\n  penMock(pen: Pen) {\r\n    if (pen.realTimes) {\r\n      let _d: any = {};\r\n      pen.realTimes.forEach((realTime) => {\r\n        let value = this.mockValue(realTime);\r\n        if(value !== undefined){\r\n          _d[realTime.key] = value;\r\n        }\r\n      });\r\n      if (Object.keys(_d).length) {\r\n        let data = pen.onBeforeValue ? pen.onBeforeValue(pen, _d) : _d;\r\n        this.canvas.updateValue(pen, data);\r\n        // this.store.emitter.emit('valueUpdate', pen);\r\n        pen.onValue?.(pen);\r\n        this.store.emitter.emit('valueUpdate', pen);\r\n      }\r\n    }\r\n  }\r\n\r\n  penNetwork(pen: Pen) {\r\n    const penNetwork: Network = {\r\n      url: pen.apiUrl,\r\n      method: pen.apiMethod,\r\n      headers: pen.apiHeaders,\r\n      body: pen.apiBody,\r\n    };\r\n    //临时请求一次\r\n    this.requestHttp(penNetwork);\r\n    if (pen.apiEnable) {\r\n      if (!this.store.pensNetwork) {\r\n        this.store.pensNetwork = {};\r\n      }\r\n      this.store.pensNetwork[pen.id] = penNetwork;\r\n    }else{\r\n      delete this.store.pensNetwork[pen.id];\r\n    }\r\n  }\r\n\r\n  getCookie(name: string) {\r\n    let arr: RegExpMatchArray | null;\r\n    const reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)');\r\n    if ((arr = document.cookie.match(reg))) {\r\n      return decodeURIComponent(arr[2]);\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  //获取动态参数\r\n  getDynamicParam(key: string) {\r\n    let params = queryURLParams();\r\n    let value = params[key] || localStorage[key] || this.getCookie(key) || '';\r\n    return value;\r\n  }\r\n\r\n  onNetworkConnect(https: Network[]) {\r\n    // let enable = this.store.data.enableMock;\r\n    if (!(https && https.length)) {\r\n      return;\r\n    }\r\n    if (this.store.pensNetwork) {\r\n      for (let key in this.store.pensNetwork) {\r\n        https.push(this.store.pensNetwork[key]);\r\n      }\r\n    }\r\n    if (!this.store.data.cancelFirstConnect) {\r\n      https.forEach(async (_item) => {\r\n        this.requestHttp(_item);\r\n      });\r\n    }\r\n    // if( enable ){\r\n    //   this.updateTimer = setInterval(() => {\r\n    //     //模拟数据\r\n      \r\n    //     this.store.data.pens.forEach((pen) => {\r\n    //       this.penMock(pen);\r\n    //     });\r\n\r\n    //     // https.forEach(async (_item) => {\r\n    //     //   this.requestHttp(_item);\r\n    //     // });\r\n    //     this.render();\r\n    //   }, this.store.data.networkInterval || 1000);\r\n    // }\r\n\r\n    https.forEach((_item,index) => {\r\n      _item.times = 0;\r\n      this.updateTimerList[index] = setInterval(async () => {\r\n        this.requestHttp(_item);\r\n        if (this.store.options.reconnetTimes) {\r\n          _item.times++;\r\n          if (_item.times >= this.store.options.reconnetTimes) {\r\n            _item.times = 0;\r\n            clearInterval(this.updateTimerList[index]);\r\n            this.updateTimerList[index] = undefined;\r\n          }\r\n        }\r\n      }, _item.interval || 1000);\r\n    });\r\n  }\r\n\r\n  async requestHttp(_req: Network) {\r\n    let req = deepClone(_req);\r\n    if (req.url) {\r\n      if (typeof req.headers === 'object') {\r\n        for (let i in req.headers) {\r\n          if(typeof req.headers[i] === 'string'){\r\n            let keys = req.headers[i].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n            if (keys) {\r\n              req.headers[i] = req.headers[i].replace(\r\n                `\\${${keys[0]}}`,\r\n                this.getDynamicParam(keys[0])\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (typeof req.body === 'object') {\r\n        for (let i in req.body) {\r\n          if(typeof req.body[i] === 'string'){\r\n            let keys = req.body[i].match(/(?<=\\$\\{).*?(?=\\})/g);\r\n            if (keys) {\r\n              req.body[i] = req.body[i].replace(\r\n                `\\${${keys[0]}}`,\r\n                this.getDynamicParam(keys[0])\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // 默认每一秒请求一次\r\n      const res: Response = await fetch(req.url, {\r\n        headers: req.headers,\r\n        method: req.method,\r\n        body: req.method === 'GET' ? undefined : JSON.stringify(req.body),\r\n      });\r\n      if (res.ok) {\r\n        const data = await res.text();\r\n        this.socketCallback(data, { type: 'http', url: req.url });\r\n      } else {\r\n        this.store.emitter.emit('error', { type: 'http', error: res });\r\n      }\r\n    }\r\n  }\r\n\r\n  closeNetwork() {\r\n    this.mqttClients &&\r\n      this.mqttClients.forEach((mqttClient) => {\r\n        mqttClient.end();\r\n      });\r\n    this.websockets &&\r\n      this.websockets.forEach((websocket) => {\r\n        if(websocket){\r\n          websocket.onclose = undefined;\r\n          websocket.close();\r\n          websocket = undefined;\r\n        }\r\n      });\r\n    this.mqttClients = undefined;\r\n    this.websockets = undefined;\r\n    // clearInterval(this.updateTimer);\r\n    // this.updateTimer = undefined;\r\n    this.updateTimerList &&\r\n    this.updateTimerList.forEach((_updateTimer) => {\r\n      clearInterval(_updateTimer);\r\n      _updateTimer = undefined;\r\n    });\r\n    this.sqlTimerList &&\r\n    this.sqlTimerList.forEach((_sqlTimer) => {\r\n      clearInterval(_sqlTimer);\r\n      _sqlTimer = undefined\r\n    });\r\n  }\r\n\r\n  socketCallback(\r\n    message: string,\r\n    context?: { type?: string; topic?: string; url?: string, method?: string }\r\n  ) {\r\n    this.store.emitter.emit('socket', { message, context });\r\n    let _message:any = message;\r\n    if (\r\n      this.socketFn\r\n    ) {\r\n      _message =  this.socketFn(message, {\r\n        meta2d: this,\r\n        type: context.type,\r\n        topic: context.topic,\r\n        url: context.url,\r\n        method: context.method\r\n      })\r\n      if(!_message){\r\n        return;\r\n      }\r\n    }\r\n    if(_message===true){\r\n      _message = message;\r\n    }\r\n    let data: any;\r\n    if (_message.constructor === Object || _message.constructor === Array) {\r\n      data = _message;\r\n    } else if (typeof _message === 'string') {\r\n      try {\r\n        data = JSON.parse(_message);\r\n      } catch (error) {\r\n        console.warn('Invalid socket data:', data, error);\r\n      }\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    if (!data) {\r\n      return;\r\n    }\r\n\r\n    if (!Array.isArray(data)) {\r\n      data = [data];\r\n    }\r\n    if (!data.length) {\r\n      return;\r\n    }\r\n    if (data[0].dataId) {\r\n      this.setDatas(data);\r\n    } else {\r\n      data.forEach((_data: IValue) => {\r\n        this.setValue(_data);\r\n      });\r\n    }\r\n  }\r\n\r\n  // 绑定变量方式更新组件数据\r\n  setDatas(\r\n    datas: { dataId?: string; id?: string; value: any }[],\r\n    {\r\n      render = true,\r\n      doEvent = true,\r\n      history,\r\n    }: {\r\n      render?: boolean;\r\n      doEvent?: boolean;\r\n      history?: boolean;\r\n    } = {}\r\n  ) {\r\n    // 把{dataId: string; value: any}转成setValue格式数据\r\n    const penValues: Map<Pen, IValue> = new Map();\r\n    datas.forEach((v: any) => {\r\n      this.store.bindDatas[v.dataId]?.forEach(\r\n        (p: { id: string; formItem: FormItem }) => {\r\n          const pen = this.store.pens[p.id];\r\n          if (!pen) {\r\n            return;\r\n          }\r\n\r\n          let penValue = penValues.get(pen);\r\n\r\n          if (!pen.noOnBinds && typeof pen.onBinds === 'function') {\r\n            // 已经计算了\r\n            if (penValue) {\r\n              return;\r\n            }\r\n            penValues.set(pen, pen.onBinds(pen, datas, p.formItem));\r\n            return;\r\n          }\r\n\r\n          if (penValue) {\r\n            penValue[p.formItem.key] = v.value;\r\n          } else {\r\n            penValue = {\r\n              id: p.id,\r\n              [p.formItem.key]: v.value,\r\n            };\r\n            penValues.set(pen, penValue);\r\n          }\r\n        }\r\n      );\r\n      this.store.bind[v.id || v.dataId]?.forEach((p: { id: string; key: string }) => {\r\n        const pen = this.store.pens[p.id];\r\n        if (!pen) {\r\n          return;\r\n        }\r\n        let penValue = penValues.get(pen);\r\n\r\n        // if (typeof pen.onBinds === 'function') {\r\n        //   // 已经计算了\r\n        //   if (penValue) {\r\n        //     return;\r\n        //   }\r\n        //   //TODO onBinds的情况\r\n        //   penValues.set(pen, pen.onBinds(pen, datas));\r\n        //   return;\r\n        // }\r\n        if (penValue) {\r\n          penValue[p.key] = v.value;\r\n        } else {\r\n          penValue = {\r\n            id: p.id,\r\n            [p.key]: v.value,\r\n          };\r\n          penValues.set(pen, penValue);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.store.data.locked && this.doDataEvent(datas);\r\n    let initPens: Pen[];\r\n    let pens: Pen[];\r\n    if (history) {\r\n      initPens = [];\r\n    }\r\n    penValues.forEach((value, pen) => {\r\n      this.setValue(value, { render: false, doEvent, history: false });\r\n      if (history) {\r\n        initPens.push(deepClone(pen, true));\r\n        pens.push(pen);\r\n      }\r\n    });\r\n    render && this.render();\r\n\r\n    if (history) {\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        initPens,\r\n        pens,\r\n      });\r\n    }\r\n  }\r\n\r\n  setValue(\r\n    data: IValue,\r\n    {\r\n      render = true,\r\n      doEvent = true,\r\n      history,\r\n    }: {\r\n      render?: boolean;\r\n      doEvent?: boolean;\r\n      history?: boolean;\r\n    } = {}\r\n  ) {\r\n    let pens: Pen[] = [];\r\n    if(!data){\r\n      return;\r\n    }\r\n    if (data.id) {\r\n      if (data.id === this.store.data.id) {\r\n        this.setDatabyOptions(data);\r\n        if (data.bkImage) {\r\n          this.setBackgroundImage(data.bkImage);\r\n        }\r\n        if (data.background) {\r\n          this.setBackgroundColor(data.background);\r\n        }\r\n        this.render();\r\n        return;\r\n      }\r\n      const pen = this.store.pens[data.id];\r\n      if (pen) {\r\n        pens = [pen];\r\n      } else {\r\n        //bind 绑定变量的情况\r\n        let bindArr = this.store.bind[data.id];\r\n        if (bindArr && bindArr.length) {\r\n          pens = [];\r\n          this.setDatas([data] as any, {\r\n            render,\r\n            doEvent,\r\n            history,\r\n          });\r\n          return;\r\n        }\r\n      }\r\n    } else if (data.dataId) {\r\n      pens = [];\r\n      this.setDatas([data] as any, {\r\n        render,\r\n        doEvent,\r\n        history,\r\n      });\r\n      return;\r\n    } else if (data.tag) {\r\n      pens = this.find(data.tag);\r\n    } else {\r\n      let binds = [];\r\n      for (let key in data) {\r\n        binds.push({\r\n          dataId:key,\r\n          id:key,\r\n          value:data[key]\r\n        })\r\n      };\r\n      if(binds.length){\r\n        this.setDatas(binds as any, {\r\n          render,\r\n          doEvent,\r\n          history,\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    history = history && !this.store.data.locked;\r\n    let initPens: Pen[];\r\n    if (history) {\r\n      initPens = deepClone(pens);\r\n    }\r\n    pens.forEach((pen) => {\r\n      const afterData: IValue = pen.onBeforeValue\r\n        ? pen.onBeforeValue(pen, data as ChartData)\r\n        : data;\r\n      if (data.frames) {\r\n        this.stopAnimate([pen]);\r\n        if (!data.showDuration) {\r\n          data.showDuration = data.frames.reduce((total, item) => {\r\n            return total + item.duration;\r\n          }, 0);\r\n        }\r\n      }\r\n\r\n      setChildValue(pen, afterData);\r\n      this.canvas.updateValue(pen, afterData);\r\n      pen.onValue?.(pen);\r\n    });\r\n\r\n    if (\r\n      !this.store.data.locked &&\r\n      this.store.active.length &&\r\n      !this.canvas.movingPens\r\n    ) {\r\n      // 移动过程中，不重算 activeRect\r\n      this.canvas.calcActiveRect();\r\n    }\r\n\r\n    if (history) {\r\n      let _pens = deepClone(pens);\r\n      this.pushHistory({\r\n        type: EditType.Update,\r\n        initPens,\r\n        pens: _pens,\r\n      });\r\n    }\r\n    doEvent &&\r\n      pens.forEach((pen) => {\r\n        this.store.emitter.emit('valueUpdate', pen);\r\n      });\r\n    render && this.render();\r\n  }\r\n\r\n  /**\r\n   * @deprecated 改用 setValue\r\n   */\r\n  _setValue(data: IValue, history = false) {\r\n    this.setValue(data, { history, render: false, doEvent: false });\r\n  }\r\n\r\n  pushHistory(action: EditAction) {\r\n    this.canvas.pushHistory(action);\r\n  }\r\n\r\n  showInput(pen: Pen, rect?: Rect) {\r\n    this.canvas.showInput(pen, rect);\r\n  }\r\n\r\n  hideInput() {\r\n    this.canvas.hideInput();\r\n  }\r\n\r\n  clearDropdownList() {\r\n    this.canvas.clearDropdownList();\r\n  }\r\n\r\n  clearRuleLines(){\r\n    this.canvas.clearRuleLines();\r\n  }\r\n\r\n  private onEvent = (eventName: string, e: any) => {\r\n    switch (eventName) {\r\n      case 'add':\r\n        {\r\n          e.forEach((pen: Pen) => {\r\n            pen.onAdd?.(pen);\r\n          });\r\n        }\r\n        this.onSizeUpdate();\r\n        break;\r\n      case 'enter':\r\n        e && e.onMouseEnter && e.onMouseEnter(e, this.canvas.mousePos);\r\n        this.store.data.locked && this.doEvent(e, eventName);\r\n        break;\r\n      case 'leave':\r\n        e && e.onMouseLeave && e.onMouseLeave(e, this.canvas.mousePos);\r\n        this.store.data.locked && this.doEvent(e, eventName);\r\n        break;\r\n      case 'active':\r\n      case 'inactive':\r\n        {\r\n          this.store.data.locked &&\r\n            e.forEach((pen: Pen) => {\r\n              this.doEvent(pen, eventName);\r\n            });\r\n        }\r\n        break;\r\n      case 'click':\r\n        if(this.store.data.locked && e.pen && (!e.pen.disabled)){\r\n          if(e.pen.switch){\r\n            e.pen.checked =  !e.pen.checked;\r\n            e.pen.calculative.checked = e.pen.checked;\r\n            e.pen.calculative.gradient = undefined;\r\n            e.pen.calculative.radialGradient = undefined;\r\n          }\r\n        }\r\n        e.pen && e.pen.onClick && (!e.pen.disabled) && e.pen.onClick(e.pen, this.canvas.mousePos);\r\n        this.store.data.locked && e.pen && (!e.pen.disabled) && this.doEvent(e.pen, eventName);\r\n        break;\r\n      case 'contextmenu':\r\n        e.pen &&\r\n          e.pen.onContextmenu && (!e.pen.disabled) &&\r\n          e.pen.onContextmenu(e.pen, this.canvas.mousePos);\r\n        this.store.data.locked && e.pen && (!e.pen.disabled) && this.doEvent(e.pen, eventName);\r\n        break;\r\n      case 'mousedown':\r\n        e.pen &&\r\n          e.pen.onMouseDown && (!e.pen.disabled) &&\r\n          e.pen.onMouseDown(e.pen, this.canvas.mousePos);\r\n        this.store.data.locked && e.pen && (!e.pen.disabled) && this.doEvent(e.pen, eventName);\r\n        break;\r\n      case 'mouseup':\r\n        e.pen &&\r\n          e.pen.onMouseUp && (!e.pen.disabled) && \r\n          e.pen.onMouseUp(e.pen, this.canvas.mousePos);\r\n        this.store.data.locked && e.pen && (!e.pen.disabled) && this.doEvent(e.pen, eventName);\r\n        break;\r\n      case 'dblclick':\r\n        this.store.data.locked && e.pen && (!e.pen.disabled) && this.doEvent(e.pen, eventName);\r\n        break;\r\n      case 'valueUpdate':\r\n        this.store.data.locked && this.doEvent(e, eventName);\r\n        this.canvas.tooltip.updateText(e as Pen);\r\n        break;\r\n      case 'update':\r\n      case 'delete':\r\n      case 'translatePens':\r\n      case 'rotatePens':\r\n      case 'resizePens':\r\n        this.onSizeUpdate();\r\n        break;\r\n      case 'navigator':\r\n        if(!this.store.data.id){\r\n          console.warn('请先保存当前图纸');\r\n        }\r\n        this.navigatorTo(e.params);\r\n        break;\r\n      case 'input':\r\n        this.store.data.locked && e && (!e.disabled) && this.doEvent(e, eventName);\r\n        break;\r\n      case 'change':\r\n        this.store.data.locked && e && (!e.disabled) && this.doEvent(e, eventName);\r\n        break;\r\n    }\r\n\r\n    this.doMessageEvent(eventName);\r\n  };\r\n\r\n  private doEvent = (pen: Pen, eventName: EventName) => {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    let old = false; //是否是旧的事件\r\n    let indexArr = []; //事件条件成立的索引\r\n    pen.events?.forEach((event,index) => {\r\n      if (event.actions && event.actions.length) {\r\n        if (event.name === eventName) {\r\n          //条件成立\r\n          let flag = false;\r\n          if (event.conditions && event.conditions.length) {\r\n            if (event.conditionType === 'and') {\r\n              flag = event.conditions.every((condition) => {\r\n                return this.judgeCondition(pen, condition.key, condition);\r\n              });\r\n            } else if (event.conditionType === 'or') {\r\n              flag = event.conditions.some((condition) => {\r\n                return this.judgeCondition(pen, condition.key, condition);\r\n              });\r\n            }\r\n          } else {\r\n            flag = true;\r\n          }\r\n          if (flag) {\r\n            // event.actions.forEach((action) => {\r\n            //   if (this.events[action.action]) {\r\n            //     this.events[action.action](pen, action);\r\n            //   }\r\n            // });\r\n            indexArr.push(index);\r\n          }\r\n        }\r\n      } else {\r\n        old = true;\r\n        if (this.events[event.action] && event.name === eventName) {\r\n          let can = !event.where?.type;\r\n          if (event.where) {\r\n            const { fn, fnJs, comparison, key, value } = event.where;\r\n            if (fn) {\r\n              can = fn(pen, { meta2d: this });\r\n            } else if (fnJs) {\r\n              try {\r\n                event.where.fn = new Function('pen', 'context', fnJs) as (\r\n                  pen: Pen,\r\n                  context?: {\r\n                    meta2d: Meta2d;\r\n                  }\r\n                ) => boolean;\r\n              } catch (err) {\r\n                console.error('Error: make function:', err);\r\n              }\r\n              if (event.where.fn) {\r\n                can = event.where.fn(pen, { meta2d: this });\r\n              }\r\n            } else {\r\n              let pValue = pen[key];\r\n              if(['x','y','width','height'].includes(key)){\r\n                pValue = this.getPenRect(pen)[key];\r\n              }\r\n              switch (comparison) {\r\n                case '>':\r\n                  can = pValue > +value;\r\n                  break;\r\n                case '>=':\r\n                  can = pValue >= +value;\r\n                  break;\r\n                case '<':\r\n                  can = pValue < +value;\r\n                  break;\r\n                case '<=':\r\n                  can = pValue <= +value;\r\n                  break;\r\n                case '=':\r\n                case '==':\r\n                  can = pValue == value;\r\n                  break;\r\n                case '!=':\r\n                  can = pValue != value;\r\n                  break;\r\n                case '[)':\r\n                  can = valueInRange(+pValue, value);\r\n                  break;\r\n                case '![)':\r\n                  can = !valueInRange(+pValue, value);\r\n                  break;\r\n                case '[]':\r\n                  can = valueInArray(pValue, value);\r\n                  break;\r\n                case '![]':\r\n                  can = !valueInArray(pValue, value);\r\n                  break;\r\n              }\r\n            }\r\n          }\r\n          // can && this.events[event.action](pen, event);\r\n          if(can){\r\n            indexArr.push(index);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    \r\n    //所有的条件判断后，再统一执行条件成立的事件\r\n    if(old){\r\n      pen.events?.forEach((event,index) => {\r\n        if(indexArr.includes(index)){\r\n          this.events[event.action](pen, event);\r\n        }\r\n      });\r\n    }else{\r\n      pen.events?.forEach(async(event,index) => {\r\n        if(indexArr.includes(index)){\r\n          if(event.confirm){\r\n            if(!await this.canvas.popconfirm.showModal(pen,this.canvas.mousePos,event.confirmTitle)){\r\n              return;\r\n            }\r\n          }\r\n          event.actions.forEach((action) => {\r\n            if(action.timeout){\r\n              let timer = setTimeout(()=>{\r\n                if (this.events[action.action]) {\r\n                  this.events[action.action](pen, action);\r\n                  clearTimeout(timer);\r\n                  timer = null;\r\n                }\r\n              },action.timeout);\r\n            }else{\r\n              if (this.events[action.action]) {\r\n                this.events[action.action](pen, action);\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n    \r\n    if(eventName === 'valueUpdate'){\r\n      pen.realTimes?.forEach((realTime) => {\r\n        let indexArr = [];\r\n        realTime.triggers?.forEach((trigger,index) => {\r\n          let flag = false;\r\n          if(trigger.conditions?.length){\r\n            if (trigger.conditionType === 'and') {\r\n              flag = trigger.conditions.every((condition) => {\r\n                return this.judgeCondition(pen, realTime.key, condition);\r\n              });\r\n            } else if (trigger.conditionType === 'or') {\r\n              flag = trigger.conditions.some((condition) => {\r\n                return this.judgeCondition(pen, realTime.key, condition);\r\n              });\r\n            }\r\n          }else {\r\n            //无条件\r\n            flag = true;\r\n          }\r\n          if (flag) {\r\n            indexArr.push(index);\r\n            // trigger.actions?.forEach((event) => {\r\n            //   this.events[event.action](pen, event);\r\n            // });\r\n          }\r\n        });\r\n\r\n        //执行\r\n        realTime.triggers?.forEach((trigger,index) => {\r\n          if(indexArr.includes(index)){\r\n            trigger.actions?.forEach((event) => {\r\n              if(event.timeout){\r\n                let timer = setTimeout(()=>{\r\n                  if (this.events[event.action]) {\r\n                    this.events[event.action](pen, event);\r\n                    clearTimeout(timer);\r\n                    timer = null;\r\n                  }\r\n                },event.timeout);\r\n              }else{\r\n                this.events[event.action](pen, event);\r\n              }\r\n            });\r\n          }\r\n        });\r\n      });\r\n\r\n      //全局\r\n      let indexArr = [];\r\n      this.store.globalTriggers[pen.id]?.forEach((trigger,index) => {\r\n        let flag = false;\r\n        if(trigger.conditions?.length){\r\n          if (trigger.conditionType === 'and') {\r\n            flag = trigger.conditions.every((condition) => {\r\n              return this.judgeCondition(this.store.pens[condition.source], condition.key, condition);\r\n            });\r\n          } else if (trigger.conditionType === 'or') {\r\n            flag = trigger.conditions.some((condition) => {\r\n              return this.judgeCondition(this.store.pens[condition.source], condition.key, condition);\r\n            });\r\n          }\r\n        }else{\r\n          //无条件\r\n          flag = true;\r\n        }\r\n        if (flag) {\r\n          indexArr.push(index);\r\n        }\r\n      });\r\n      this.store.globalTriggers[pen.id]?.forEach((trigger,index) => {\r\n        if(indexArr.includes(index)){\r\n          trigger.actions?.forEach((event) => {\r\n            if(event.timeout){\r\n              let timer = setTimeout(()=>{\r\n                if (this.events[event.action]) {\r\n                  this.events[event.action](pen, event);\r\n                  clearTimeout(timer);\r\n                  timer = null;\r\n                }\r\n              },event.timeout);\r\n            }else{\r\n              this.events[event.action](pen, event);\r\n            }\r\n          });\r\n        }\r\n      });\r\n\r\n      //triggers\r\n      if( pen.triggers?.length ){\r\n        for(let trigger of pen.triggers){\r\n          if(trigger.status?.length){\r\n            for(let state of trigger.status){\r\n              let flag = false;\r\n              if(state.conditions?.length){\r\n                if (state.conditionType === 'and') {\r\n                  flag = state.conditions.every((condition) => {\r\n                    return this.judgeCondition(pen, condition.key, condition);\r\n                  });\r\n                } else if (state.conditionType === 'or') {\r\n                  flag = state.conditions.some((condition) => {\r\n                    return this.judgeCondition(pen, condition.key, condition);\r\n                  });\r\n                }\r\n              }else{\r\n                //无条件\r\n                flag = true;\r\n              }\r\n              if (flag) {\r\n                state.actions?.forEach((event) => {\r\n                  if(event.timeout){\r\n                    let timer = setTimeout(()=>{\r\n                      if (this.events[event.action]) {\r\n                        this.events[event.action](pen, event);\r\n                        clearTimeout(timer);\r\n                        timer = null;\r\n                      }\r\n                    },event.timeout);\r\n                  }else{\r\n                    this.events[event.action](pen, event);\r\n                  }\r\n                });\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // 事件冒泡，子执行完，父执行\r\n    this.doEvent(this.store.pens[pen.parentId], eventName);\r\n  };\r\n\r\n  doMessageEvent(eventName: string, data?:any) {\r\n    if (this.store.messageEvents[eventName]) {\r\n      this.store.messageEvents[eventName].forEach((item) => {\r\n        let flag = false;\r\n        if (item.event.conditions && item.event.conditions.length) {\r\n          if (item.event.conditionType === 'and') {\r\n            flag = item.event.conditions.every((condition) => {\r\n              return this.judgeCondition(item.pen, condition.key, condition);\r\n            });\r\n          } else if (item.event.conditionType === 'or') {\r\n            flag = item.event.conditions.some((condition) => {\r\n              return this.judgeCondition(item.pen, condition.key, condition);\r\n            });\r\n          }\r\n        } else {\r\n          flag = true;\r\n        }\r\n        if (flag) {\r\n          item.event.actions.forEach((action) => {\r\n            this.events[action.action](item.pen, action);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  doDataEvent = ( datas: { dataId?: string; id?: string; value: any }[]) => {\r\n    if(!(this.store.data.dataEvents?.length)) {\r\n      return;\r\n    }\r\n    const data = datas.reduce((accumulator,{dataId,id,value}) => {\r\n      accumulator[id||dataId] = value;\r\n      return accumulator;\r\n    }, {});\r\n    let indexArr = [];\r\n    this.store.data.dataEvents?.forEach((event,index)=>{\r\n      let flag = false;\r\n      if (event.conditions && event.conditions.length) {\r\n        if (event.conditionType === 'and') {\r\n          flag = event.conditions.every((condition) => {\r\n            return this.dataJudegeCondition(data, condition.key, condition);\r\n          });\r\n        } else if (event.conditionType === 'or') {\r\n          flag = event.conditions.some((condition) => {\r\n            return this.dataJudegeCondition(data, condition.key, condition);\r\n          });\r\n        }\r\n      } else {\r\n        flag = true;\r\n      }\r\n      if (flag) {\r\n        indexArr.push(index);\r\n      }\r\n    });\r\n\r\n    this.store.data.dataEvents?.forEach((event,index) => {\r\n      if(indexArr.includes(index)){\r\n        event.actions?.forEach((action) => {\r\n          this.events[action.action](data, action);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  initGlobalTriggers(){\r\n    this.store.globalTriggers = {};\r\n    this.store.data.triggers?.forEach((trigger) => {\r\n      trigger.conditions.forEach((condition) => {\r\n        if(condition.source){\r\n          if(!this.store.globalTriggers[condition.source]){\r\n            this.store.globalTriggers[condition.source] = [];\r\n          }\r\n          if(!this.store.globalTriggers[condition.source].includes(trigger)){\r\n            this.store.globalTriggers[condition.source].push(trigger);\r\n          }\r\n        }\r\n      })\r\n    });\r\n  }\r\n\r\n  initMessageEvents() {\r\n    this.store.messageEvents = {};\r\n    this.store.data.pens.forEach((pen) => {\r\n      pen.events?.forEach((event) => {\r\n        if (event.name === 'message' && event.message) {\r\n          if (!this.store.messageEvents[event.message]) {\r\n            this.store.messageEvents[event.message] = [];\r\n          }\r\n          this.store.messageEvents[event.message].push({\r\n            pen: pen,\r\n            event: event,\r\n          });\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  dataJudegeCondition(data: any, key: string, condition: TriggerCondition) {\r\n    const { type, target, fnJs, fn, operator, valueType } = condition;\r\n    let can = false;\r\n    if (type === 'fn') {\r\n      //方法\r\n      if (fn) {\r\n        can = fn(data, { meta2d: this });\r\n      } else if (fnJs) {\r\n        try {\r\n          condition.fn = new Function('data', 'context', fnJs) as (\r\n            data: any,\r\n            context?: {\r\n              meta2d: Meta2d;\r\n            }\r\n          ) => boolean;\r\n        } catch (err) {\r\n          console.error('Error: make function:', err);\r\n        }\r\n        if (condition.fn) {\r\n          can = condition.fn(data, { meta2d: this });\r\n        }\r\n      }\r\n    } else {\r\n      //TODO boolean类型 数字类型\r\n      let value = condition.value;\r\n      if (valueType === 'prop') {\r\n        value = data[condition.value];\r\n      }\r\n      let compareValue = data[key];\r\n      switch (operator) {\r\n        case '>':\r\n          can = compareValue > +value;\r\n          break;\r\n        case '>=':\r\n          can = compareValue >= +value;\r\n          break;\r\n        case '<':\r\n          can = compareValue < +value;\r\n          break;\r\n        case '<=':\r\n          can = compareValue <= +value;\r\n          break;\r\n        case '=':\r\n        case '==':\r\n          can = compareValue == value;\r\n          break;\r\n        case '!=':\r\n          can = compareValue != value;\r\n          break;\r\n        case '[)':\r\n          can = valueInRange(+compareValue, value);\r\n          break;\r\n        case '![)':\r\n          can = !valueInRange(+compareValue, value);\r\n          break;\r\n        case '[]':\r\n          can = valueInArray(compareValue, value);\r\n          break;\r\n        case '![]':\r\n          can = !valueInArray(compareValue, value);\r\n          break;\r\n      }\r\n    }\r\n    return can;\r\n  }\r\n\r\n  judgeCondition(pen: Pen, key: string, condition: TriggerCondition) {\r\n    const { type, target, fnJs, fn, operator, valueType } = condition;\r\n    let can = false;\r\n    if (type === 'fn') {\r\n      //方法\r\n      if (fn) {\r\n        can = fn(pen, { meta2d: this });\r\n      } else if (fnJs) {\r\n        try {\r\n          condition.fn = new Function('pen', 'context', fnJs) as (\r\n            pen: Pen,\r\n            context?: {\r\n              meta2d: Meta2d;\r\n            }\r\n          ) => boolean;\r\n        } catch (err) {\r\n          console.error('Error: make function:', err);\r\n        }\r\n        if (condition.fn) {\r\n          can = condition.fn(pen, { meta2d: this });\r\n        }\r\n      }\r\n    } else {\r\n      //TODO boolean类型 数字类型\r\n      let value = condition.value;\r\n      if (valueType === 'prop') {\r\n        value = this.store.pens[target][condition.value];\r\n      }\r\n      let compareValue = getter(pen, key);\r\n      if(['x','y','width','height'].includes(key)){\r\n        compareValue = this.getPenRect(pen)[key];\r\n      }\r\n      switch (operator) {\r\n        case '>':\r\n          can = compareValue > +value;\r\n          break;\r\n        case '>=':\r\n          can = compareValue >= +value;\r\n          break;\r\n        case '<':\r\n          can = compareValue < +value;\r\n          break;\r\n        case '<=':\r\n          can = compareValue <= +value;\r\n          break;\r\n        case '=':\r\n        case '==':\r\n          can = compareValue == value;\r\n          break;\r\n        case '!=':\r\n          can = compareValue != value;\r\n          break;\r\n        case '[)':\r\n          can = valueInRange(+compareValue, value);\r\n          break;\r\n        case '![)':\r\n          can = !valueInRange(+compareValue, value);\r\n          break;\r\n        case '[]':\r\n          can = valueInArray(compareValue, value);\r\n          break;\r\n        case '![]':\r\n          can = !valueInArray(compareValue, value);\r\n          break;\r\n      }\r\n    }\r\n    return can;\r\n  }\r\n\r\n  pushChildren(parent: Pen, children: Pen[]) {\r\n    const initUpdatePens: Pen[] = [deepClone(parent, true)];\r\n    const addPens: Pen[] = [];\r\n    if (!parent.children) {\r\n      parent.children = [];\r\n    }\r\n    const updatePens: Pen[] = [];\r\n    children.forEach((pen) => {\r\n      let oldPen: Pen = deepClone(pen, true);\r\n      if (!pen.id || !this.store.pens[pen.id]) {\r\n        // 不存在于 store 中\r\n        this.canvas.makePen(pen);\r\n        oldPen = null; // 添加操作\r\n      }\r\n      if (pen.parentId) {\r\n        const oldParent = this.store.pens[pen.parentId];\r\n        const i = oldParent.children.findIndex((id) => id === pen.id);\r\n        initUpdatePens.push(deepClone(oldParent, true));\r\n        oldParent.children.splice(i, 1);\r\n        updatePens.push(deepClone(oldParent, true));\r\n      }\r\n      parent.children.push(pen.id);\r\n      pen.parentId = parent.id;\r\n      const childRect = calcRelativeRect(\r\n        pen.calculative.worldRect,\r\n        parent.calculative.worldRect\r\n      );\r\n      Object.assign(pen, childRect);\r\n      pen.locked = pen.lockedOnCombine ?? LockState.DisableMove;\r\n      pen.locked = (pen.interaction || isInteraction.includes(pen.name)) ? 0 : pen.locked;\r\n      if (!oldPen) {\r\n        addPens.push(deepClone(pen, true));\r\n      } else {\r\n        initUpdatePens.push(oldPen);\r\n        updatePens.push(deepClone(pen, true));\r\n      }\r\n    });\r\n    updatePens.push(deepClone(parent, true));\r\n    let step = 1;\r\n    if (addPens.length) {\r\n      step = 2;\r\n      this.pushHistory({\r\n        type: EditType.Add,\r\n        pens: addPens,\r\n        step,\r\n      });\r\n    }\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens: initUpdatePens,\r\n      pens: updatePens,\r\n      step,\r\n    });\r\n  }\r\n\r\n  renderPenRaw = renderPenRaw;\r\n\r\n  toPng(\r\n    padding?: Padding,\r\n    callback?: BlobCallback,\r\n    containBkImg = false,\r\n    maxWidth?: number\r\n  ) {\r\n    return this.canvas.toPng(padding, callback, containBkImg, maxWidth);\r\n  }\r\n\r\n  activeToPng(padding?: Padding, maxWidth?: number) {\r\n    return this.canvas.activeToPng(padding, maxWidth);\r\n  }\r\n\r\n  pensToPng(pens: Pen[] = this.store.active, padding?: Padding, maxWidth?: number) {\r\n    return this.canvas.pensToPng(pens, padding, maxWidth);\r\n  }\r\n\r\n  /**\r\n   * 下载 png\r\n   * @param name 传入参数自带文件后缀名 例如：'test.png'\r\n   * @param padding 上右下左的内边距\r\n   */\r\n  downloadPng(name?: string, padding?: Padding, maxWidth?: number) {\r\n    for (const pen of this.store.data.pens) {\r\n      if (pen.calculative.img || ['iframe'].includes(pen.name)) {\r\n        //重新生成绘制图片\r\n        pen.onRenderPenRaw?.(pen);\r\n      }\r\n    }\r\n    setTimeout(() => {\r\n      const a = document.createElement('a');\r\n      a.setAttribute(\r\n        'download',\r\n        (name || this.store.data.name || 'le5le.meta2d') + '.png'\r\n      );\r\n      a.setAttribute('href', this.toPng(padding, undefined, true, maxWidth));\r\n      const evt = document.createEvent('MouseEvents');\r\n      evt.initEvent('click', true, true);\r\n      a.dispatchEvent(evt);\r\n    }, 1000);\r\n  }\r\n\r\n  downloadSvg() {\r\n    if (!(window as any).C2S) {\r\n      console.error(\r\n        '请先加载乐吾乐官网下的canvas2svg.js',\r\n        'https://assets.le5lecdn.com/2d/canvas2svg.js'\r\n      );\r\n      throw new Error('请先加载乐吾乐官网下的canvas2svg.js');\r\n    }\r\n\r\n    const rect = this.getRect();\r\n    rect.x -= 10;\r\n    rect.y -= 10;\r\n    const ctx = new (window as any).C2S(rect.width + 20, rect.height + 20);\r\n    ctx.textBaseline = 'middle';\r\n    for (const pen of this.store.data.pens) {\r\n      if (pen.visible == false || !isShowChild(pen, this.store)) {\r\n        continue;\r\n      }\r\n      renderPenRaw(ctx, pen, rect, true);\r\n    }\r\n\r\n    let mySerializedSVG = ctx.getSerializedSvg();\r\n    if (this.store.data.background) {\r\n      mySerializedSVG = mySerializedSVG.replace('{{bk}}', '');\r\n      mySerializedSVG = mySerializedSVG.replace(\r\n        '{{bkRect}}',\r\n        `<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"${this.store.data.background}\"></rect>`\r\n      );\r\n    } else {\r\n      mySerializedSVG = mySerializedSVG.replace('{{bk}}', '');\r\n      mySerializedSVG = mySerializedSVG.replace('{{bkRect}}', '');\r\n    }\r\n\r\n    mySerializedSVG = mySerializedSVG.replace(/--le5le--/g, '&#x');\r\n\r\n    const urlObject = window.URL;\r\n    const export_blob = new Blob([mySerializedSVG]);\r\n    const url = urlObject.createObjectURL(export_blob);\r\n\r\n    const a = document.createElement('a');\r\n    a.setAttribute('download', `${this.store.data.name || 'le5le.meta2d'}.svg`);\r\n    a.setAttribute('href', url);\r\n    const evt = document.createEvent('MouseEvents');\r\n    evt.initEvent('click', true, true);\r\n    a.dispatchEvent(evt);\r\n  }\r\n\r\n  getRect(pens: Pen[] = this.store.data.pens) {\r\n    return getRect(pens);\r\n  }\r\n\r\n  hiddenTemplate() {\r\n    this.canvas.canvasTemplate.hidden();\r\n  }\r\n\r\n  showTemplate() {\r\n    this.canvas.canvasTemplate.show();\r\n  }\r\n\r\n  lockTemplate(lock: LockState) {\r\n    //锁定\r\n    this.store.data.pens.forEach((pen) => {\r\n      // if (pen.template) {\r\n      //   pen.locked = lock;\r\n      // }\r\n      if (pen.canvasLayer === CanvasLayer.CanvasTemplate) {\r\n        pen.locked = lock;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 放大到屏幕尺寸，并居中\r\n   * @param fit true，填满但完整展示；false，填满，但长边可能截取（即显示不完整）\r\n   */\r\n  fitView(fit: boolean = true, viewPadding: Padding = 10) {\r\n    // 默认垂直填充，两边留白\r\n    if (!this.hasView()) return;\r\n    // 1. 重置画布尺寸为容器尺寸\r\n    const { canvas } = this.canvas;\r\n    const { offsetWidth: width, offsetHeight: height } = canvas;\r\n    this.resize(width, height);\r\n    // 2. 获取设置的留白值\r\n    const padding = formatPadding(viewPadding);\r\n\r\n    // 3. 获取图形尺寸\r\n    const rect = this.getRect();\r\n\r\n    // 4. 计算缩放比例\r\n    const w = (width - padding[1] - padding[3]) / rect.width;\r\n    const h = (height - padding[0] - padding[2]) / rect.height;\r\n    let ratio = w;\r\n    if (fit) {\r\n      // 完整显示取小的\r\n      ratio = w > h ? h : w;\r\n    } else {\r\n      ratio = w > h ? w : h;\r\n    }\r\n    if(this.store.data.fits?.length){\r\n      this.canvas.opening = true;\r\n    }\r\n    // 该方法直接更改画布的 scale 属性，所以比率应该乘以当前 scale\r\n    this.scale(ratio * this.store.data.scale);\r\n\r\n    // 5. 居中\r\n    this.centerView();\r\n    if(this.store.data.fits?.length){\r\n      this.fillView();\r\n    }\r\n  }\r\n\r\n  fillView(){\r\n    const rect = this.getRect();\r\n    const wGap = this.canvas.width - rect.width;\r\n    const hGap = this.canvas.height - rect.height;\r\n    //宽度拉伸\r\n    if (Math.abs(wGap) > 10) {\r\n      this.store.data.fits?.forEach((fit)=>{\r\n        let pens = [];\r\n        fit.children.forEach((id)=>{\r\n          this.store.pens[id].locked = LockState.None;\r\n          pens.push(this.store.pens[id]);\r\n        });\r\n        let r = wGap/2;\r\n        if(fit.left&&fit.right){\r\n          //整体拉伸\r\n          let left = fit.leftValue;\r\n          let right = fit.rightValue;\r\n          if(left){\r\n            left = Math.abs(left)<1?left*this.canvas.width:left;\r\n          }else{\r\n            left = 0;\r\n          }\r\n          if(right){\r\n            right = Math.abs(right)<1?right*this.canvas.width:right;\r\n          }else{\r\n            right = 0;\r\n          }\r\n          let ratio = (this.canvas.width - left - right)/(rect.width- left - right);\r\n          pens.forEach((pen)=>{  \r\n            if(pen.image && pen.imageRatio){\r\n              if(pen.calculative.worldRect.width/this.canvas.width>0.1){\r\n                pen.imageRatio = false;\r\n              }\r\n            }\r\n            pen.calculative.worldRect.x  = rect.x - wGap/2 + left + (pen.calculative.worldRect.x-rect.x)*ratio;//(fit.leftValue || 0)+ (pen.calculative.worldRect.x + pen.calculative.worldRect.width/2)-( pen.calculative.worldRect.width*ratio)*(range/2- (fit.rightValue || 0))/(range- (fit.leftValue || 0)-(fit.rightValue || 0));\r\n            pen.calculative.worldRect.width *= ratio\r\n            pen.calculative.worldRect.ex = pen.calculative.worldRect.x + pen.calculative.worldRect.width;\r\n            pen.calculative.width = pen.calculative.worldRect.width;\r\n            pen.calculative.x = pen.calculative.worldRect.x;\r\n            pen.width = pen.calculative.worldRect.width;\r\n            pen.x = pen.calculative.worldRect.x;\r\n            this.canvas.updatePenRect(pen, { worldRectIsReady: false });\r\n            if(pen.externElement){\r\n              pen.onResize?.(pen);\r\n            }\r\n          });\r\n        \r\n        }else if(fit.left){\r\n          //左移\r\n          r = -r\r\n          if(fit.leftValue){\r\n            r += (Math.abs(fit.leftValue)<1?fit.leftValue*this.canvas.width:fit.leftValue);\r\n          }\r\n          this.translatePens(pens, r, 0); \r\n        }else if(fit.right){\r\n          //右移\r\n          if(fit.rightValue){\r\n            r = r - (Math.abs(fit.rightValue)<1?fit.rightValue*this.canvas.width:fit.rightValue);\r\n          }\r\n          this.translatePens(pens, r, 0); \r\n        }\r\n      });\r\n      const iframePens = this.store.data.pens.filter((pen) => pen.name === 'iframe');\r\n      iframePens?.forEach((pen)=>{\r\n        const worldRect = pen.calculative.worldRect;\r\n        if(worldRect.width/this.store.data.scale>rect.width*0.8){\r\n          let bfW = worldRect.width;\r\n          pen.calculative.worldRect.x = worldRect.x - wGap/2;\r\n          pen.calculative.worldRect.width =\r\n            worldRect.width + wGap;\r\n          pen.calculative.worldRect.ex = worldRect.ex + wGap;\r\n          pen.operationalRect.x =\r\n            (pen.operationalRect.x * bfW) / pen.calculative.worldRect.width;\r\n          pen.operationalRect.width =\r\n            (pen.calculative.worldRect.width -\r\n              (1 - pen.operationalRect.width) * bfW) /\r\n            pen.calculative.worldRect.width;\r\n          pen.onBeforeValue?.(pen, {\r\n            operationalRect: pen.operationalRect,\r\n          } as any);\r\n          pen.onResize?.(pen);\r\n        }\r\n      })\r\n    }\r\n    //高度拉伸\r\n    if (Math.abs(hGap) > 10) {\r\n      this.store.data.fits?.forEach((fit)=>{\r\n        let pens = [];\r\n        fit.children.forEach((id)=>{\r\n          this.store.pens[id].locked = LockState.None;\r\n          pens.push(this.store.pens[id]);\r\n        });\r\n        let r = hGap/2;\r\n        if(fit.top&&fit.bottom){\r\n          let top = fit.topValue;\r\n          let bottom = fit.bottomValue;\r\n          if(top){\r\n            top = Math.abs(top)<1?top*this.canvas.height:top;\r\n          }else{\r\n            top = 0;\r\n          }\r\n          if(bottom){\r\n            bottom = Math.abs(bottom)<1?bottom*this.canvas.height:bottom;\r\n          }else{\r\n            bottom = 0;\r\n          }\r\n\r\n          let ratio = (this.canvas.height - top - bottom)/(rect.height- top - bottom);\r\n          pens.forEach((pen)=>{  \r\n            if(pen.image && pen.imageRatio){\r\n              if(pen.calculative.worldRect.height/this.canvas.height>0.1){\r\n                pen.imageRatio = false;\r\n              }\r\n            }\r\n            pen.calculative.worldRect.y  = rect.y - hGap/2 + top + (pen.calculative.worldRect.y-rect.y)*ratio;//(fit.leftValue || 0)+ (pen.calculative.worldRect.x + pen.calculative.worldRect.width/2)-( pen.calculative.worldRect.width*ratio)*(range/2- (fit.rightValue || 0))/(range- (fit.leftValue || 0)-(fit.rightValue || 0));\r\n            pen.calculative.worldRect.height *= ratio\r\n            pen.calculative.worldRect.ey = pen.calculative.worldRect.y + pen.calculative.worldRect.height;\r\n            pen.calculative.height = pen.calculative.worldRect.height;\r\n            pen.calculative.y = pen.calculative.worldRect.y;\r\n            pen.height = pen.calculative.worldRect.height;\r\n            pen.y = pen.calculative.worldRect.y;\r\n            this.canvas.updatePenRect(pen, { worldRectIsReady: false });\r\n            if(pen.externElement){\r\n              pen.onResize?.(pen);\r\n            }\r\n          });\r\n        \r\n        }else if(fit.top){\r\n          r = -r\r\n          if(fit.topValue){\r\n            r += (Math.abs(fit.topValue)<1?fit.topValue*this.canvas.height:fit.topValue);\r\n          }\r\n          this.translatePens(pens, 0, r); \r\n        }else if(fit.bottom){\r\n          if(fit.bottomValue){\r\n            r = r - (Math.abs(fit.bottomValue)<1?fit.bottomValue*this.canvas.height:fit.bottomValue);\r\n          }\r\n          this.translatePens(pens, 0, r); \r\n        }\r\n      });\r\n      const iframePens = this.store.data.pens.filter((pen) => pen.name === 'iframe');\r\n      iframePens?.forEach((pen)=>{\r\n        const worldRect = pen.calculative.worldRect;\r\n        if(worldRect.height/this.store.data.scale>rect.height*0.8){\r\n          let bfH = worldRect.height;\r\n          pen.calculative.worldRect.y = worldRect.y - hGap/2;\r\n          pen.calculative.worldRect.height =\r\n            worldRect.height + hGap;\r\n          pen.calculative.worldRect.ey = worldRect.ey + hGap;\r\n          pen.operationalRect.y =\r\n            (pen.operationalRect.y * bfH) / pen.calculative.worldRect.width;\r\n          pen.operationalRect.height =\r\n            (pen.calculative.worldRect.height -\r\n              (1 - pen.operationalRect.height) * bfH) /\r\n            pen.calculative.worldRect.height;\r\n          pen.onBeforeValue?.(pen, {\r\n            operationalRect: pen.operationalRect,\r\n          } as any);\r\n          pen.onResize?.(pen);\r\n        }\r\n      })\r\n    }\r\n    this.canvas.canvasTemplate.init();\r\n    this.canvas.canvasImage.init();\r\n    this.canvas.canvasImageBottom.init();\r\n    this.render(true);\r\n  }\r\n\r\n  trimPens() {\r\n    //去除空连线\r\n    let pens = this.store.data.pens.filter(\r\n      (pen) => pen.name === 'line' && pen.anchors.length < 2\r\n    );\r\n    this.delete(pens);\r\n  }\r\n\r\n  /**\r\n   * 放大到屏幕尺寸，并居中\r\n   * @param fit true，填满但完整展示；false，填满，但长边可能截取（即显示不完整）\r\n   */\r\n  fitTemplateView(fit: boolean = true, viewPadding: Padding = 10) {\r\n    //  默认垂直填充，两边留白\r\n    if (!this.hasView()) return;\r\n    // 1. 重置画布尺寸为容器尺寸\r\n    const { canvas } = this.canvas;\r\n    const { offsetWidth: width, offsetHeight: height } = canvas;\r\n    // 2. 获取设置的留白值\r\n    const padding = formatPadding(viewPadding);\r\n\r\n    // 3. 获取图形尺寸\r\n    const rect = this.getRect();\r\n\r\n    // 4. 计算缩放比例\r\n    const w = (width - padding[1] - padding[3]) / rect.width;\r\n    const h = (height - padding[0] - padding[2]) / rect.height;\r\n    let ratio = w;\r\n    if (fit) {\r\n      // 完整显示取小的\r\n      ratio = w > h ? h : w;\r\n    } else {\r\n      ratio = w > h ? w : h;\r\n    }\r\n\r\n    // 该方法直接更改画布的 scale 属性，所以比率应该乘以当前 scale\r\n    this.canvas.templateScale(ratio * this.store.data.scale);\r\n    let _rect = this.getRect();\r\n\r\n    let pens = this.store.data.pens.filter((pen) => !pen.parentId);\r\n    this.canvas.templateTranslatePens(pens, -_rect.x, -_rect.y);\r\n    // 5. 居中\r\n    this.store.data.pens.forEach((pen) => {\r\n      if (!pen.type) {\r\n        this.canvas.updateLines(pen);\r\n      } else {\r\n        this.canvas.initLineRect(pen);\r\n      }\r\n    });\r\n    this.centerView();\r\n  }\r\n\r\n  fitSizeView(fit: boolean | string = true, viewPadding: Padding = 10) {\r\n    // 默认垂直填充，两边留白\r\n    // if (!this.hasView()) return;\r\n    // 1. 重置画布尺寸为容器尺寸\r\n    const { canvas } = this.canvas;\r\n    const { offsetWidth: width, offsetHeight: height } = canvas;\r\n    this.resize(width, height);\r\n    // 2. 获取设置的留白值\r\n    const padding = formatPadding(viewPadding);\r\n\r\n    const _width =\r\n      (this.store.data.width || this.store.options.width) *\r\n      this.store.data.scale;\r\n    const _height =\r\n      (this.store.data.height || this.store.options.height) *\r\n      this.store.data.scale;\r\n    // 4. 计算缩放比例\r\n    const w = (width - padding[1] - padding[3]) / _width;\r\n    const h = (height - padding[0] - padding[2]) / _height;\r\n    let ratio = w;\r\n    if (fit === 'width') {\r\n      ratio = w;\r\n    } else if (fit === 'height') {\r\n      ratio = h;\r\n    } else {\r\n      if (fit) {\r\n        // 完整显示取小的\r\n        ratio = w > h ? h : w;\r\n      } else {\r\n        ratio = w > h ? w : h;\r\n      }\r\n    }\r\n    if(this.store.data.fits?.length){\r\n      this.canvas.opening = true;\r\n    }\r\n    // 该方法直接更改画布的 scale 属性，所以比率应该乘以当前 scale\r\n    this.scale(ratio * this.store.data.scale);\r\n\r\n    // 5. 居中\r\n    this.centerSizeView();\r\n    if(this.store.data.fits?.length){\r\n      this.fillView();\r\n    }\r\n  }\r\n\r\n  centerSizeView() {\r\n    // if (!this.hasView()) return;\r\n    const viewCenter = this.getViewCenter();\r\n    //根据画布尺寸居中对齐\r\n    const _width = this.store.data.width || this.store.options.width;\r\n    const _height = this.store.data.height || this.store.options.height;\r\n    const pensRect: any = {\r\n      x: 0,\r\n      y: 0,\r\n      width: _width,\r\n      height: _height,\r\n    };\r\n    calcCenter(pensRect);\r\n    const { center } = pensRect;\r\n    const { scale, origin, x: dataX, y: dataY } = this.store.data;\r\n    this.translate(\r\n      (viewCenter.x - origin.x) / scale - center.x - dataX / scale,\r\n      (viewCenter.y - origin.y) / scale - center.y - dataY / scale\r\n    );\r\n    const { canvas } = this.canvas;\r\n    const x = (canvas.scrollWidth - canvas.offsetWidth) / 2;\r\n    const y = (canvas.scrollHeight - canvas.offsetHeight) / 2;\r\n    canvas.scrollTo(x, y);\r\n  }\r\n\r\n  /**\r\n   * 宽度放大到屏幕尺寸，并滚动到最顶部\r\n   *\r\n   */\r\n  scrollView(viewPadding: Padding = 10, pageMode: boolean = false) {\r\n    if (!this.hasView()) return;\r\n    //滚动状态下\r\n    if (!this.canvas.scroll) {\r\n      return;\r\n    }\r\n    const { canvas } = this.canvas;\r\n    const { offsetWidth: width, offsetHeight: height } = canvas;\r\n    this.resize(width, height);\r\n    const padding = formatPadding(viewPadding);\r\n    const rect = this.getRect();\r\n    const ratio = (width - padding[1] - padding[3]) / rect.width;\r\n    this.scale(ratio * this.store.data.scale);\r\n\r\n    this.topView(padding[0]);\r\n    if (pageMode) {\r\n      this.canvas.scroll.changeMode();\r\n    }\r\n  }\r\n\r\n  screenView(viewPadding: Padding = 10, WorH: boolean = true) {\r\n    if (!this.hasView()) return;\r\n    const { canvas } = this.canvas;\r\n    const { offsetWidth: width, offsetHeight: height } = canvas;\r\n    this.resize(width, height);\r\n    const padding = formatPadding(viewPadding);\r\n    const rect = this.getRect();\r\n    //默认宽度充满\r\n    let ratio = (width - padding[1] - padding[3]) / rect.width;\r\n    if (!WorH) {\r\n      ratio = (height - padding[0] - padding[2]) / rect.height;\r\n    }\r\n    this.scale(ratio * this.store.data.scale);\r\n    //height充满时是居中\r\n    this.topView(padding[0]);\r\n  }\r\n\r\n  topView(paddingTop: number = 10) {\r\n    if (!this.hasView()) return;\r\n    const rect = this.getRect();\r\n    const viewCenter = this.getViewCenter();\r\n    const pensRect: Rect = this.getPenRect(rect);\r\n    calcCenter(pensRect);\r\n    const { center } = pensRect;\r\n    const { scale, origin, x: dataX, y: dataY } = this.store.data;\r\n\r\n    this.translate(\r\n      (viewCenter.x - origin.x) / scale - center.x - dataX / scale,\r\n      (paddingTop - origin.y) / scale - pensRect.y - dataY / scale\r\n    );\r\n    const { canvas } = this.canvas;\r\n    const x = (canvas.scrollWidth - canvas.offsetWidth) / 2;\r\n    const y = (canvas.scrollHeight - canvas.offsetHeight) / 2;\r\n    canvas.scrollTo(x, y);\r\n  }\r\n\r\n  centerView() {\r\n    if (!this.hasView()) return;\r\n    const rect = this.getRect();\r\n    const viewCenter = this.getViewCenter();\r\n    const pensRect: Rect = this.getPenRect(rect);\r\n    calcCenter(pensRect);\r\n    const { center } = pensRect;\r\n    const { scale, origin, x: dataX, y: dataY } = this.store.data;\r\n    // center 的值，在缩放和拖拽画布过程中不发生变化，是相对值\r\n    // viewCenter 是一个绝对值，需要根据 origin 的值，来计算出相对的值\r\n    // store.data.x 是画布偏移值，在 translate 方法中与 scale 相关，这里也需要计算\r\n    this.translate(\r\n      (viewCenter.x - origin.x) / scale - center.x - dataX / scale,\r\n      (viewCenter.y - origin.y) / scale - center.y - dataY / scale\r\n    );\r\n    const { canvas } = this.canvas;\r\n    const x = (canvas.scrollWidth - canvas.offsetWidth) / 2;\r\n    const y = (canvas.scrollHeight - canvas.offsetHeight) / 2;\r\n    canvas.scrollTo(x, y);\r\n  }\r\n\r\n  /**\r\n   * 画布是否有 画笔\r\n   * RuleLine 不算\r\n   */\r\n  hasView(): boolean {\r\n    return !!this.store.data.pens.filter((pen) => !pen.isRuleLine).length;\r\n  }\r\n\r\n  private getViewCenter() {\r\n    const { width, height } = this.canvas;\r\n    return {\r\n      x: width / 2,\r\n      y: height / 2,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 大小相同\r\n   * @param pens 画笔们\r\n   */\r\n  beSameByFirst(pens: Pen[] = this.store.data.pens, attribute?: string) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n\r\n    // 1. 得到第一个画笔的 宽高\r\n    const firstPen = pens[0];\r\n    const { width, height } = this.getPenRect(firstPen);\r\n    for (let i = 1; i < pens.length; i++) {\r\n      const pen = pens[i];\r\n      if (attribute === 'width') {\r\n        this.setValue({ id: pen.id, width }, { render: false, doEvent: false });\r\n      } else if (attribute === 'height') {\r\n        this.setValue(\r\n          { id: pen.id, height },\r\n          { render: false, doEvent: false }\r\n        );\r\n      } else {\r\n        this.setValue(\r\n          { id: pen.id, width, height },\r\n          { render: false, doEvent: false }\r\n        );\r\n      }\r\n    }\r\n    this.render();\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 大小相同\r\n   * @param pens 画笔们\r\n   */\r\n  beSameByLast(pens: Pen[] = this.store.data.pens, attribute?: string) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n\r\n    // 1. 得到最后一个画笔的 宽高\r\n    const lastPen = pens[pens.length - 1];\r\n    const { width, height } = this.getPenRect(lastPen);\r\n    for (let i = 0; i < pens.length - 1; i++) {\r\n      const pen = pens[i];\r\n      if (attribute === 'width') {\r\n        this.setValue({ id: pen.id, width }, { render: false, doEvent: false });\r\n      } else if (attribute === 'height') {\r\n        this.setValue(\r\n          { id: pen.id, height },\r\n          { render: false, doEvent: false }\r\n        );\r\n      } else {\r\n        this.setValue(\r\n          { id: pen.id, width, height },\r\n          { render: false, doEvent: false }\r\n        );\r\n      }\r\n    }\r\n    this.render();\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n  /**\r\n   * 格式刷（样式相同，大小无需一致。）\r\n   * @param pens 画笔们\r\n   */\r\n  formatPainterByFirst(pens: Pen[] = this.store.data.pens) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    const firstPen = pens[0];\r\n    // 格式刷修改的属性，除开宽高\r\n    const attrs = {};\r\n    formatAttrs.forEach((attr) => {\r\n      attrs[attr] = firstPen[attr];\r\n    });\r\n\r\n    for (let i = 1; i < pens.length; i++) {\r\n      const pen = pens[i];\r\n      this.setValue(\r\n        { id: pen.id, ...attrs },\r\n        { render: false, doEvent: false }\r\n      );\r\n    }\r\n    this.render();\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n  /**\r\n   * 格式刷（样式相同，大小无需一致。）\r\n   * @param pens 画笔们\r\n   */\r\n  formatPainterByLast(pens: Pen[] = this.store.data.pens) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    const firstPen = pens[pens.length - 1];\r\n    // 格式刷修改的属性，除开宽高\r\n    const attrs = {};\r\n    formatAttrs.forEach((attr) => {\r\n      attrs[attr] = firstPen[attr];\r\n    });\r\n\r\n    for (let i = 0; i < pens.length - 1; i++) {\r\n      const pen = pens[i];\r\n      this.setValue(\r\n        { id: pen.id, ...attrs },\r\n        { render: false, doEvent: false }\r\n      );\r\n    }\r\n    this.render();\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n  setFormatPainter() {\r\n    const pens = this.store.active;\r\n    const attrs = {};\r\n    if (pens.length > 0) {\r\n      const firstPen = pens[0];\r\n      formatAttrs.forEach((attr) => {\r\n        attrs[attr] =\r\n          firstPen[attr] !== undefined ? firstPen[attr] :\r\n          (this.store.options.defaultFormat[attr] || \r\n          this.store.data[attr] ||\r\n          this.store.options[attr]);\r\n      });\r\n    } else {\r\n      //默认值\r\n      const attrs = {};\r\n      formatAttrs.forEach((attr) => {\r\n        attrs[attr] =\r\n          this.store.options.defaultFormat[attr] ||\r\n          this.store.data[attr] ||\r\n          this.store.options[attr] ||\r\n          undefined;\r\n      });\r\n    }\r\n    localStorage.setItem('meta2d-formatPainter', JSON.stringify(attrs));\r\n  }\r\n\r\n  formatPainter() {\r\n    const pens = this.store.active;\r\n    const initPens = deepClone(pens);\r\n    const attrs = JSON.parse(localStorage.getItem('meta2d-formatPainter'));\r\n    for (let i = 0; i < pens.length; i++) {\r\n      const pen = pens[i];\r\n      this.setValue(\r\n        { id: pen.id, ...attrs },\r\n        { render: false, doEvent: false }\r\n      );\r\n    }\r\n    this.render();\r\n\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  clearFormatPainter() {\r\n    const pens = this.store.active;\r\n    const initPens = deepClone(pens);\r\n    formatAttrs.forEach((attr) => {\r\n      for (let i = 0; i < pens.length; i++) {\r\n        const pen = pens[i];\r\n        const { fontSize, lineHeight } = this.store.options;\r\n        if (attr === 'lineWidth') {\r\n          pen.lineWidth = 1;\r\n          pen.calculative.lineWidth = 1;\r\n        } else if (attr === 'fontSize') {\r\n          pen.fontSize = fontSize;\r\n          pen.calculative.fontSize = fontSize;\r\n        } else if (attr === 'lineHeight') {\r\n          pen.lineHeight = lineHeight;\r\n          pen.calculative.lineHeight = lineHeight;\r\n        } else {\r\n          delete pen[attr];\r\n          delete pen.calculative[attr];\r\n        }\r\n      }\r\n    });\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  alignNodes(align: string, pens: Pen[] = this.store.data.pens, rect?: Rect) {\r\n    !rect && (rect = this.getPenRect(this.getRect(pens)));\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    for (const item of pens) {\r\n      this.alignPen(align, item, rect);\r\n    }\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  //对齐大屏\r\n  alignNodesV(align: string, pens: Pen[] = this.store.data.pens, whole:boolean=false) {\r\n    const width = this.store.data.width || this.store.options.width;\r\n    const height = this.store.data.height || this.store.options.height;\r\n    let rect = {\r\n      x: 0,\r\n      y: 0,\r\n      width,\r\n      height,\r\n    };\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    if(whole){\r\n      const scale = this.store.data.scale;\r\n      const rect = this.getRect(pens);\r\n      const x  = (rect.x-this.store.data.origin.x) / scale;\r\n      const y = (rect.y-this.store.data.origin.y) / scale;\r\n      const w = rect.width / scale;\r\n      const h = rect.height / scale;\r\n      let moveX = 0;\r\n      let moveY = 0;\r\n      switch (align) {\r\n        case 'left':\r\n          moveX =-x;\r\n          break;\r\n        case 'right':\r\n          moveX = width - (x+w);\r\n          break;\r\n        case 'top':\r\n          moveY = -y;\r\n          break;\r\n        case 'bottom':\r\n          moveY = height - (y+h);\r\n          break;\r\n        case 'center':\r\n          moveX = width/2 - (x+w/2);\r\n          break;\r\n        case 'middle':\r\n          moveY = height/2 - (y+h/2);\r\n          break;\r\n      }      \r\n      this.translatePens(pens, moveX*scale, moveY*scale);\r\n    }else{\r\n      for (const item of pens) {\r\n        this.alignPen(align, item, rect);\r\n      }\r\n    }\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 对齐画笔，基于第一个画笔\r\n   * @param align 左对齐，右对齐，上对齐，下对齐，居中对齐\r\n   * @param pens\r\n   */\r\n  alignNodesByFirst(align: string, pens: Pen[] = this.store.data.pens) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    const firstPen = pens[0];\r\n    const rect = this.getPenRect(firstPen);\r\n    for (let i = 1; i < pens.length; i++) {\r\n      const pen = pens[i];\r\n      this.alignPen(align, pen, rect);\r\n    }\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 对齐画笔，基于最后选中的画笔\r\n   * @param align 左对齐，右对齐，上对齐，下对齐，居中对齐\r\n   * @param pens\r\n   */\r\n  alignNodesByLast(align: string, pens: Pen[] = this.store.data.pens) {\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    const lastPen = pens[pens.length - 1];\r\n    const rect = this.getPenRect(lastPen);\r\n    for (let i = 0; i < pens.length - 1; i++) {\r\n      const pen = pens[i];\r\n      this.alignPen(align, pen, rect);\r\n    }\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 将画笔参照 rect 进行 align 对齐\r\n   * @param align 左对齐，右对齐，上对齐，下对齐，居中对齐\r\n   * @param pen 当前需要对齐的画笔\r\n   * @param rect 参照矩形\r\n   * @returns\r\n   */\r\n  private alignPen(align: string, pen: Pen, rect: Rect) {\r\n    const penRect = this.getPenRect(pen);\r\n    switch (align) {\r\n      case 'left':\r\n        penRect.x = rect.x;\r\n        break;\r\n      case 'right':\r\n        penRect.x = rect.x + rect.width - penRect.width;\r\n        break;\r\n      case 'top':\r\n        penRect.y = rect.y;\r\n        break;\r\n      case 'bottom':\r\n        penRect.y = rect.y + rect.height - penRect.height;\r\n        break;\r\n      case 'center':\r\n        penRect.x = rect.x + rect.width / 2 - penRect.width / 2;\r\n        break;\r\n      case 'middle':\r\n        penRect.y = rect.y + rect.height / 2 - penRect.height / 2;\r\n        break;\r\n    }\r\n    this.setValue(\r\n      { id: pen.id, ...penRect },\r\n      { render: false, doEvent: false }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 水平或垂直方向的均分\r\n   * @param direction 方向，width 说明水平方向间距相同\r\n   * @param pens 节点们，默认全部的\r\n   * @param distance 总的宽 or 高\r\n   */\r\n  private spaceBetweenByDirection(\r\n    direction: 'width' | 'height',\r\n    pens: Pen[] = this.store.data.pens,\r\n    distance?: number\r\n  ) {\r\n    //TODO 暂时修复，待优化\r\n    // !distance && (distance = this.getPenRect(this.getRect(pens))[direction]);\r\n    if(!distance) {\r\n      let start = Infinity, end = -Infinity, key = direction === 'width' ? 'x' : 'y';\r\n      pens.forEach((item) => {\r\n        start = Math.min(start, item.calculative.worldRect[key]);\r\n        end = Math.max(end, item.calculative.worldRect['e'+key]);\r\n      });\r\n      distance = (end - start) / this.store.data.scale;\r\n    }\r\n    // 过滤出非父节点\r\n    pens = pens.filter((item) => !item.parentId);\r\n    if (pens.length <= 2) {\r\n      return;\r\n    }\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    // 计算间距\r\n    const allDistance = pens.reduce((distance: number, currentPen: Pen) => {\r\n      const currentPenRect = this.getPenRect(currentPen);\r\n      return distance + currentPenRect[direction];\r\n    }, 0);\r\n    const space = (distance - allDistance) / (pens.length - 1);\r\n\r\n    // 按照大小顺序排列画笔\r\n    pens = pens.sort((a: Pen, b: Pen) => {\r\n      if (direction === 'width') {\r\n        return a.x - b.x;\r\n      }\r\n      return a.y - b.y;\r\n    });\r\n\r\n    const pen0Rect = this.getPenRect(pens[0]);\r\n    let left = direction === 'width' ? pen0Rect.x : pen0Rect.y;\r\n    for (const pen of pens) {\r\n      const penRect = this.getPenRect(pen);\r\n      direction === 'width' ? (penRect.x = left) : (penRect.y = left);\r\n      left += penRect[direction] + space;\r\n      this.setValue(\r\n        { id: pen.id, ...penRect },\r\n        { render: false, doEvent: false }\r\n      );\r\n    }\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  spaceBetween(pens?: Pen[], width?: number) {\r\n    this.spaceBetweenByDirection('width', pens, width);\r\n  }\r\n\r\n  spaceBetweenColumn(pens?: Pen[], height?: number) {\r\n    this.spaceBetweenByDirection('height', pens, height);\r\n  }\r\n\r\n  layout(\r\n    pens: Pen[] = this.store.data.pens,\r\n    width?: number,\r\n    space: number = 30\r\n  ) {\r\n    const rect = this.getPenRect(getRect(pens));\r\n    !width && (width = rect.width);\r\n\r\n    // 1. 拿到全部节点中最大的高\r\n    pens = pens.filter((item) => !item.type && !item.parentId);\r\n    const initPens = deepClone(pens); // 原 pens ，深拷贝一下\r\n    let maxHeight = 0;\r\n\r\n    pens.forEach((pen: Pen) => {\r\n      const penRect = this.getPenRect(pen);\r\n      penRect.height > maxHeight && (maxHeight = penRect.height);\r\n    });\r\n\r\n    // 2. 遍历节点调整位置\r\n    let currentX = rect.x;\r\n    let currentY = rect.y;\r\n    pens.forEach((pen: Pen, index: number) => {\r\n      const penRect = this.getPenRect(pen);\r\n      penRect.x = currentX;\r\n      penRect.y = currentY + maxHeight / 2 - penRect.height / 2;\r\n\r\n      this.setValue(\r\n        { id: pen.id, ...penRect },\r\n        { render: false, doEvent: false }\r\n      );\r\n\r\n      if (index === pens.length - 1) {\r\n        return;\r\n      }\r\n      const currentWidth = currentX + penRect.width - rect.x;\r\n      const nextPenRect = this.getPenRect(pens[index + 1]);\r\n      if (\r\n        Math.round(width - currentWidth) >=\r\n        Math.round(nextPenRect.width + space)\r\n      )\r\n        // 当前行\r\n        currentX += penRect.width + space;\r\n      else {\r\n        // 换行\r\n        currentX = rect.x;\r\n        currentY += maxHeight + space;\r\n      }\r\n    });\r\n    this.initImageCanvas(pens);\r\n    this.initTemplateCanvas(pens);\r\n    this.render();\r\n    this.pushHistory({\r\n      type: EditType.Update,\r\n      initPens,\r\n      pens,\r\n    });\r\n  }\r\n\r\n  gotoView(pen: Pen) {\r\n    const center = this.getViewCenter();\r\n    const x =\r\n      center.x -\r\n      pen.calculative.worldRect.x -\r\n      pen.calculative.worldRect.width / 2;\r\n    const y =\r\n      center.y -\r\n      pen.calculative.worldRect.y -\r\n      pen.calculative.worldRect.height / 2;\r\n\r\n    if (this.canvas.scroll && this.canvas.scroll.isShow) {\r\n      this.canvas.scroll.translate(\r\n        x - this.store.data.x,\r\n        y - this.store.data.y\r\n      );\r\n    }\r\n\r\n    this.store.data.x = x;\r\n    this.store.data.y = y;\r\n\r\n    for (const pen of this.store.data.pens) {\r\n      calcInView(pen);\r\n    }\r\n    this.canvas.canvasImage.init();\r\n    this.canvas.canvasImageBottom.init();\r\n    this.render();\r\n  }\r\n\r\n  showMap() {\r\n    if (!this.map) {\r\n      this.map = new ViewMap(this.canvas);\r\n    }\r\n    this.map.show();\r\n  }\r\n\r\n  hideMap() {\r\n    this.map.hide();\r\n  }\r\n\r\n  onSizeUpdate() {\r\n    if (this.mapTimer) {\r\n      clearTimeout(this.mapTimer);\r\n      this.mapTimer = undefined;\r\n    }\r\n\r\n    this.mapTimer = setTimeout(() => {\r\n      if (this.map && this.map.isShow) {\r\n        this.map.show();\r\n      }\r\n      if (this.canvas.scroll && this.canvas.scroll.isShow) {\r\n        this.canvas.scroll.resize();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  toggleAnchorMode() {\r\n    this.canvas.toggleAnchorMode();\r\n  }\r\n\r\n  addAnchorHand() {\r\n    this.canvas.addAnchorHand();\r\n  }\r\n\r\n  removeAnchorHand() {\r\n    this.canvas.removeAnchorHand();\r\n  }\r\n\r\n  toggleAnchorHand() {\r\n    this.canvas.toggleAnchorHand();\r\n  }\r\n\r\n  /**\r\n   * 将该画笔置顶，即放到数组最后，最后绘制即在顶部\r\n   * @param pens pen 置顶的画笔\r\n   */\r\n  top(pens?: Pen | Pen[]) {\r\n    if (!pens) pens = this.store.active;\r\n    if (!Array.isArray(pens)) pens = [pens]; // 兼容\r\n    for (const pen of pens as Pen[]) {\r\n      const _pens = this.store.data.pens;\r\n      // 获取它包含它的子节点\r\n      const allIds = [...getAllChildren(pen, this.store), pen].map((p) => p.id);\r\n      const allPens = _pens.filter((p) => allIds.includes(p.id));\r\n      allPens.forEach((pen) => {\r\n        const index = _pens.findIndex((p: Pen) => p.id === pen.id);\r\n        if (index > -1) {\r\n          _pens.push(_pens[index]);\r\n          _pens.splice(index, 1);\r\n          this.initTemplateCanvas([pen]);\r\n          this.initImageCanvas([pen]);\r\n        }\r\n        this.specificLayerMove(pen, 'top');\r\n      });\r\n    }\r\n    this.store.emitter.emit('layer', { type: 'top', pens });\r\n  }\r\n\r\n  /**\r\n   * 若本次改变的画笔存在图片，并且在上层 or 下层，需要擦除上层 or 下层\r\n   * 子节点中包含图片，也需要重绘\r\n   * @param pens 本次改变的 pens\r\n   */\r\n  initImageCanvas(pens: Pen[]) {\r\n    this.canvas.initImageCanvas(pens);\r\n  }\r\n\r\n  /**\r\n   * 模版图元图层改变\r\n   * @param pens 本次改变的 pens\r\n   */\r\n  initTemplateCanvas(pens: Pen[]) {\r\n    this.canvas.initTemplateCanvas(pens);\r\n  }\r\n\r\n  /**\r\n   * 该画笔置底，即放到数组最前，最后绘制即在底部\r\n   * @param pens 画笔们，注意 pen 必须在该数组内才有效\r\n   */\r\n  bottom(pens?: Pen | Pen[]) {\r\n    if (!pens) pens = this.store.active;\r\n    if (!Array.isArray(pens)) pens = [pens]; // 兼容\r\n    for (const pen of pens as Pen[]) {\r\n      const _pens = this.store.data.pens;\r\n      const allIds = [...getAllChildren(pen, this.store), pen].map((p) => p.id);\r\n      const allPens = _pens.filter((p) => allIds.includes(p.id));\r\n      // 从后往前，保证 allPens 顺序不变\r\n      for (let i = allPens.length - 1; i >= 0; i--) {\r\n        const pen = allPens[i];\r\n        const index = _pens.findIndex((p: Pen) => p.id === pen.id);\r\n        if (index > -1) {\r\n          _pens.unshift(_pens[index]);\r\n          _pens.splice(index + 1, 1);\r\n          this.initTemplateCanvas([pen]);\r\n          this.initImageCanvas([pen]);\r\n        }\r\n        this.specificLayerMove(pen, 'bottom');\r\n      }\r\n    }\r\n    this.store.emitter.emit('layer', { type: 'bottom', pens });\r\n  }\r\n\r\n  /**\r\n   * data.pens 决定了绘制顺序，即越后面的越在上层\r\n   * 该方法通过区域重叠计算，找出该画笔之后第一个与其重叠的画笔，然后把该画笔放到找出的画笔之后\r\n   * @param pen 画笔\r\n   */\r\n  upByArea(pen: Pen) {\r\n    const index = this.store.data.pens.findIndex((p) => p.id === pen.id);\r\n    if (index === -1) {\r\n      // 画笔不在画布上，不处理\r\n      console.warn('upByArea: pen not in canvas');\r\n      return;\r\n    }\r\n    const allPens = [pen, ...getAllChildren(pen, this.store)];\r\n    let allIndexs = allPens.map((p) =>\r\n      this.store.data.pens.findIndex((p2) => p2.id === p.id)\r\n    );\r\n\r\n    if (allIndexs.includes(-1)) {\r\n      // 画笔不在画布上，脏数据\r\n      console.warn('upByArea: pen children not in canvas');\r\n      allIndexs = allIndexs.filter((i) => i !== -1);\r\n    }\r\n\r\n    const minIndex = Math.min(...allIndexs);\r\n    const penRect = pen.calculative.worldRect;\r\n    const nextHitIndex = this.store.data.pens.findIndex((p, i) => {\r\n      if (i <= minIndex) {\r\n        // 不考虑前面的\r\n        return false;\r\n      }\r\n      if (p.id === pen.id || isAncestor(p, pen)) {\r\n        // 不考虑后代和自身\r\n        return false;\r\n      }\r\n      const currentRect = p.calculative.worldRect;\r\n      return rectInRect(penRect, currentRect);\r\n    });\r\n\r\n    if (nextHitIndex === -1) {\r\n      this.up(pen);\r\n      return;\r\n    }\r\n\r\n    this.store.data.pens.splice(nextHitIndex + 1, 0, ...allPens);\r\n\r\n    // 删除靠前的 allPens\r\n    for (const pen of allPens) {\r\n      const index = this.store.data.pens.findIndex((p) => p.id === pen.id);\r\n      if (index > -1) {\r\n        this.store.data.pens.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    this.initImageCanvas([pen]);\r\n  }\r\n\r\n  //特殊图元层级处理\r\n  specificLayerMove(pen: Pen, type: string) {\r\n    //image\r\n    if (pen.image && pen.name !== 'gif') {\r\n      // let isBottom = false;\r\n      // if (type === 'bottom' || type === 'down') {\r\n      //   isBottom = true;\r\n      // }\r\n      // this.setValue(\r\n      //   { id: pen.id, isBottom },\r\n      //   { render: false, doEvent: false, history: false }\r\n      // );\r\n      let layer = CanvasLayer.CanvasImageBottom;\r\n      if (type === 'top') {\r\n        layer = CanvasLayer.CanvasImage;\r\n      } else if (type === 'up' || type === 'down') {\r\n        layer = CanvasLayer.CanvasMain;\r\n      }\r\n      this.setValue(\r\n        { id: pen.id, canvasLayer: layer },\r\n        { render: false, doEvent: false, history: false }\r\n      );\r\n    } else if (pen.externElement || pen.name === 'gif') {\r\n      let zIndex = 0;\r\n      // let zIndex = pen.calculative.zIndex === undefined ? 5 : pen.calculative.zIndex + 1;\r\n      if (type === 'top') {\r\n        pen.calculative.canvas.maxZindex += 1;\r\n        zIndex = pen.calculative.canvas.maxZindex;\r\n      } else if (type === 'up') {\r\n        zIndex =\r\n          pen.calculative.zIndex === undefined ? 6 : pen.calculative.zIndex + 1;\r\n      } else if (type === 'down') {\r\n        zIndex =\r\n          pen.calculative.zIndex === undefined ? 3 : pen.calculative.zIndex - 1;\r\n        if (zIndex < 0) {\r\n          zIndex = 0;\r\n        }\r\n      }\r\n      this.setValue(\r\n        { id: pen.id, zIndex },\r\n        { render: false, doEvent: false, history: false }\r\n      );\r\n      pen.calculative.singleton?.div &&\r\n        setElemPosition(pen, pen.calculative.singleton.div);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 该画笔上移，即把该画笔在数组中的位置向后移动一个\r\n   * @param pens 画笔\r\n   */\r\n  up(pens?: Pen | Pen[]) {\r\n    if (!pens) pens = this.store.active;\r\n    if (!Array.isArray(pens)) pens = [pens]; // 兼容\r\n    for (const pen of pens as Pen[]) {\r\n      const _pens = this.store.data.pens;\r\n      if (pen.children && pen.children.length) {\r\n        //组合图元\r\n        const preMovePens = [...getAllChildren(pen, this.store), pen];\r\n        //先保证组合图元的顺序正确。\r\n        const orderPens = [];\r\n        for (let index = 0; index < _pens.length; index++) {\r\n          const _pen: any = _pens[index];\r\n          if (preMovePens.findIndex((p: Pen) => p.id === _pen.id) !== -1) {\r\n            _pen.temIndex = index;\r\n            orderPens.push(_pen);\r\n          }\r\n        }\r\n        let lastIndex = -1;\r\n        let offset = 0;\r\n        orderPens.forEach((_pen: any) => {\r\n          _pen.temIndex -= offset;\r\n          _pens.splice(_pen.temIndex, 1);\r\n          offset += 1;\r\n          lastIndex = _pen.temIndex;\r\n          delete _pen.temIndex;\r\n          this.specificLayerMove(_pen, 'up');\r\n        });\r\n        _pens.splice(lastIndex + 1, 0, ...orderPens);\r\n        this.initTemplateCanvas(orderPens);\r\n        this.initImageCanvas(orderPens);\r\n      } else {\r\n        const index = _pens.findIndex((p: Pen) => p.id === pen.id);\r\n        if (index > -1 && index !== _pens.length - 1) {\r\n          _pens.splice(index + 2, 0, _pens[index]);\r\n          _pens.splice(index, 1);\r\n          this.initTemplateCanvas([pen]);\r\n          this.initImageCanvas([pen]);\r\n        }\r\n        this.specificLayerMove(pen, 'up');\r\n      }\r\n    }\r\n    this.store.emitter.emit('layer', { type: 'up' , pens});\r\n  }\r\n\r\n  /**\r\n   * 该画笔下移，即把该画笔在该数组中的位置前移一个\r\n   * @param pen 画笔\r\n   */\r\n  down(pens?: Pen | Pen[]) {\r\n    if (!pens) pens = this.store.active;\r\n    if (!Array.isArray(pens)) pens = [pens]; // 兼容\r\n    for (const pen of pens as Pen[]) {\r\n      const _pens = this.store.data.pens;\r\n      if (pen.children && pen.children.length) {\r\n        //组合图元\r\n        const preMovePens = [...getAllChildren(pen, this.store), pen];\r\n        //先保证组合图元的顺序正确。\r\n        const orderPens = [];\r\n        for (let index = 0; index < _pens.length; index++) {\r\n          const _pen: any = _pens[index];\r\n          if (preMovePens.findIndex((p: Pen) => p.id === _pen.id) !== -1) {\r\n            _pen.temIndex = index;\r\n            orderPens.push(_pen);\r\n          }\r\n        }\r\n        let firstIndex = -1;\r\n        let offset = 0;\r\n        orderPens.forEach((_pen: any, index) => {\r\n          _pen.temIndex -= offset;\r\n          _pens.splice(_pen.temIndex, 1);\r\n          offset += 1;\r\n          if (index === 0) {\r\n            firstIndex = _pen.temIndex;\r\n          }\r\n          delete _pen.temIndex;\r\n          this.specificLayerMove(_pen, 'down');\r\n        });\r\n        _pens.splice(firstIndex - 1, 0, ...orderPens);\r\n        this.initTemplateCanvas(orderPens);\r\n        this.initImageCanvas(orderPens);\r\n      } else {\r\n        const index = _pens.findIndex((p: Pen) => p.id === pen.id);\r\n        if (index > -1 && index !== 0) {\r\n          _pens.splice(index - 1, 0, _pens[index]);\r\n          _pens.splice(index + 1, 1);\r\n          this.initTemplateCanvas([pen]);\r\n          this.initImageCanvas([pen]);\r\n        }\r\n        this.specificLayerMove(pen, 'down');\r\n      }\r\n    }\r\n    this.store.emitter.emit('layer', { type: 'down', pens });\r\n  }\r\n\r\n  setLayer(pen: Pen, toIndex: number, pens = this.store.data.pens) {\r\n    const index = pens.findIndex((p: Pen) => p.id === pen.id);\r\n    if (index > -1) {\r\n      if (index > toIndex) {\r\n        // 原位置在后，新位置在前\r\n        pens.splice(toIndex, 0, pens[index]);\r\n        pens.splice(index + 1, 1);\r\n      } else if (index < toIndex) {\r\n        // 新位置在后\r\n        pens.splice(toIndex, 0, pens[index]);\r\n        pens.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  changePenId(oldId: string, newId: string): void {\r\n    this.canvas.changePenId(oldId, newId);\r\n  }\r\n\r\n  /**\r\n   * 得到与当前节点连接的线\r\n   * @param node 节点，非连线\r\n   * @param type 类型，全部的连接线/入线/出线\r\n   */\r\n  getLines(node: Pen, type: 'all' | 'in' | 'out' = 'all'): Pen[] {\r\n    if (node.type === PenType.Line) {\r\n      return [];\r\n    }\r\n    const lines: Pen[] = [];\r\n    node.connectedLines?.forEach(({ lineId }) => {\r\n      const line = this.store.pens[lineId];\r\n      if (!line) {\r\n        console.warn(node, 'node contain a error connectedLine');\r\n        return;\r\n      }\r\n      if (lines.find((_line) => _line.id === line.id)) {\r\n        //去重\r\n        return;\r\n      }\r\n      switch (type) {\r\n        case 'all':\r\n          lines.push(line);\r\n          break;\r\n        case 'in':\r\n          // 进入该节点的线，即 线锚点的最后一个 connectTo 对应该节点\r\n          getToAnchor(line).connectTo === node.id && lines.push(line);\r\n          break;\r\n        case 'out':\r\n          // 从该节点出去的线，即 线锚点的第一个 connectTo 对应该节点\r\n          getFromAnchor(line).connectTo === node.id && lines.push(line);\r\n          break;\r\n      }\r\n    });\r\n\r\n    return lines;\r\n  }\r\n\r\n  /**\r\n   * 得到当前节点的下一个节点，即出口节点数组\r\n   * 得到当前连线的出口节点\r\n   * @param pen 节点或连线\r\n   */\r\n  nextNode(pen: Pen): Pen[] {\r\n    if (pen.type === PenType.Line) {\r\n      const nextNode = this.store.pens[getToAnchor(pen).connectTo];\r\n      return nextNode ? [nextNode] : [];\r\n    } else {\r\n      // 1. 得到所有的出线\r\n      const lines = this.getLines(pen, 'out');\r\n      const nextNodes: Pen[] = [];\r\n      // 2. 遍历出线的 nextNode\r\n      lines.forEach((line) => {\r\n        const lineNextNode = this.nextNode(line);\r\n        for (const node of lineNextNode) {\r\n          const have = nextNodes.find((next) => next.id === node.id);\r\n          // 3. 不重复的才加进去\r\n          !have && nextNodes.push(node);\r\n        }\r\n      });\r\n      return nextNodes;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 得到当前节点的上一个节点，即入口节点数组\r\n   * 得到当前连线的入口节点\r\n   * @param pen 节点或连线\r\n   */\r\n  previousNode(pen: Pen): Pen[] {\r\n    if (pen.type === PenType.Line) {\r\n      const preNode = this.store.pens[getFromAnchor(pen).connectTo];\r\n      return preNode ? [preNode] : [];\r\n    } else {\r\n      // 1. 得到所有的入线\r\n      const lines = this.getLines(pen, 'in');\r\n      const preNodes: Pen[] = [];\r\n      // 2. 遍历入线的 preNode\r\n      lines.forEach((line) => {\r\n        const linePreNode = this.previousNode(line);\r\n        for (const node of linePreNode) {\r\n          const have = preNodes.find((pre) => pre.id === node.id);\r\n          // 3. 不重复的才加进去\r\n          !have && preNodes.push(node);\r\n        }\r\n      });\r\n      return preNodes;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取节点所有的下一个连接关系\r\n   * @param pen\r\n   *\r\n   */\r\n  getNext(pen: Pen): any[] {\r\n    if (pen.type === PenType.Line) {\r\n      console.warn('非连线节点');\r\n      return;\r\n    }\r\n    const next: any[] = [];\r\n    pen.connectedLines?.forEach(({ lineId, anchor }) => {\r\n      const fromAnchor = pen.anchors?.filter(\r\n        (_anchor) => _anchor.id === anchor\r\n      )[0];\r\n      const line = this.findOne(lineId);\r\n      if (line.anchors[0].connectTo == pen.id) {\r\n        //from\r\n        const connectTo = line.anchors[line.anchors.length - 1].connectTo;\r\n        if (connectTo) {\r\n          const _next: Pen = this.findOne(connectTo);\r\n          const connectedLine = _next.connectedLines?.filter(\r\n            (item) => item.lineId === line.id\r\n          )[0];\r\n          const penAnchor = _next.anchors.filter(\r\n            (_anchor) => _anchor.id === connectedLine.anchor\r\n          )[0];\r\n          next.push({\r\n            from: pen,\r\n            fromAnchor,\r\n            line,\r\n            to: _next,\r\n            toAnchor: penAnchor,\r\n          });\r\n        }\r\n      }\r\n    });\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * 为画布添加锚点\r\n   * @param pen 画笔\r\n   * @param anchor 待添加锚点\r\n   * @param index 连线类型 添加锚点到哪个位置\r\n   */\r\n  addAnchor(pen: Pen, anchor: Point, index?: number) {\r\n    if (!pen) {\r\n      return;\r\n    }\r\n    if (!pen.anchors) {\r\n      pen.anchors = [];\r\n    }\r\n    if (!pen.calculative.worldAnchors) {\r\n      pen.calculative.worldAnchors = [];\r\n    }\r\n    if (pen.type === PenType.Line) {\r\n      if (index < 0) {\r\n        index = pen.anchors.length + 1 + index;\r\n      }\r\n      if (index > pen.anchors.length) {\r\n        index = pen.anchors.length;\r\n      }\r\n      if (index < 0) {\r\n        index = 0;\r\n      }\r\n      if (\r\n        (index == 0 && pen.anchors[0].connectTo) ||\r\n        (index == pen.anchors.length && pen.anchors[index - 1].connectTo)\r\n      ) {\r\n        console.warn('端点存在连接关系');\r\n        return;\r\n      }\r\n    }\r\n    let _anchor = null;\r\n    let _worldAnchor = null;\r\n    if (anchor.x <= 1 && anchor.x >= 0 && anchor.y <= 1 && anchor.y >= 0) {\r\n      //relative\r\n      _worldAnchor = {\r\n        id: anchor.id || s8(),\r\n        penId: pen.id,\r\n        x:\r\n          pen.calculative.worldRect.x +\r\n          pen.calculative.worldRect.width * anchor.x,\r\n        y:\r\n          pen.calculative.worldRect.y +\r\n          pen.calculative.worldRect.height * anchor.y,\r\n      };\r\n      if (pen.calculative.worldRect) {\r\n        if (pen.rotate % 360) {\r\n          rotatePoint(\r\n            _worldAnchor,\r\n            pen.rotate,\r\n            pen.calculative.worldRect.center\r\n          );\r\n        }\r\n      }\r\n      _anchor = {\r\n        id: _worldAnchor.id,\r\n        penId: pen.id,\r\n        x: anchor.x,\r\n        y: anchor.y,\r\n      };\r\n    } else {\r\n      //absolute\r\n      _worldAnchor = {\r\n        id: anchor.id || s8(),\r\n        penId: pen.id,\r\n        x: anchor.x,\r\n        y: anchor.y,\r\n      };\r\n      if (pen.calculative.worldRect) {\r\n        if (pen.rotate % 360) {\r\n          rotatePoint(anchor, -pen.rotate, pen.calculative.worldRect.center);\r\n        }\r\n        _anchor = {\r\n          id: _worldAnchor.id,\r\n          penId: pen.id,\r\n          x:\r\n            (anchor.x - pen.calculative.worldRect.x) /\r\n            pen.calculative.worldRect.width,\r\n          y:\r\n            (anchor.y - pen.calculative.worldRect.y) /\r\n            pen.calculative.worldRect.height,\r\n        };\r\n      }\r\n    }\r\n\r\n    if (pen.type === PenType.Line) {\r\n      //Line\r\n      pen.calculative.worldAnchors.splice(index, 0, _worldAnchor);\r\n      pen.anchors.splice(index, 0, _anchor);\r\n      this.canvas.updateLines(pen);\r\n      this.canvas.initLineRect(pen);\r\n      this.render();\r\n    } else {\r\n      //Node\r\n      pen.calculative.worldAnchors.push(_worldAnchor);\r\n      pen.anchors.push(_anchor);\r\n    }\r\n  }\r\n  /**\r\n   *\r\n   * @param from 连接节点\r\n   * @param fromAnchor 连接节点锚点\r\n   * @param to 被连接节点\r\n   * @param toAnchor 被连接节点锚点\r\n   */\r\n  connectLine(\r\n    from: Pen,\r\n    to: Pen,\r\n    fromAnchor?: Point,\r\n    toAnchor?: Point,\r\n    render: boolean = true\r\n  ): Pen {\r\n    if (!fromAnchor) {\r\n      const _worldRect = to.calculative.worldRect;\r\n      fromAnchor = nearestAnchor(from, {\r\n        x: _worldRect.x + _worldRect.width / 2,\r\n        y: _worldRect.y + _worldRect.height / 2,\r\n      });\r\n    }\r\n    if (!toAnchor) {\r\n      const _worldRect = from.calculative.worldRect;\r\n      toAnchor = nearestAnchor(to, {\r\n        x: _worldRect.x + _worldRect.width / 2,\r\n        y: _worldRect.y + _worldRect.height / 2,\r\n      });\r\n    }\r\n    const absWidth = Math.abs(fromAnchor.x - toAnchor.x);\r\n    const absHeight = Math.abs(fromAnchor.y - toAnchor.y);\r\n    const line: Pen = {\r\n      height: absHeight,\r\n      lineName: 'line',\r\n      lineWidth: 1,\r\n      name: 'line',\r\n      type: 1,\r\n      width: absWidth,\r\n      x: Math.min(fromAnchor.x, toAnchor.x),\r\n      y: Math.min(fromAnchor.y, toAnchor.y),\r\n      anchors: [\r\n        {\r\n          x: fromAnchor.x > toAnchor.x ? 1 : 0,\r\n          y: fromAnchor.y > toAnchor.y ? 1 : 0,\r\n          id: s8(),\r\n        },\r\n        {\r\n          x: fromAnchor.x > toAnchor.x ? 0 : 1,\r\n          y: fromAnchor.x > toAnchor.x ? 0 : 1,\r\n          id: s8(),\r\n        },\r\n      ],\r\n    };\r\n    this.addPens([line]);\r\n\r\n    connectLine(from, fromAnchor, line, line.calculative.worldAnchors[0]);\r\n    connectLine(to, toAnchor, line, line.calculative.worldAnchors[1]);\r\n    line.calculative.active = false;\r\n    this.canvas.updateLines(line);\r\n    this.canvas.updateLines(from);\r\n    this.canvas.updateLines(to);\r\n    this.canvas.initLineRect(line);\r\n    if (render) {\r\n      this.render();\r\n    }\r\n    return line;\r\n  }\r\n  /**\r\n   * 生成一个拷贝组合后的 画笔数组（组合图形），不影响原画布画笔，常用作 二次复用的组件\r\n   * @param pens 画笔数组\r\n   * @param showChild 是否作为状态复用（参考 combine showChild）\r\n   * @param anchor 是否产生默认的锚点\r\n   * @returns 组合图形\r\n   */\r\n  toComponent(\r\n    pens = this.store.data.pens,\r\n    showChild?: number,\r\n    anchor?: boolean\r\n  ): Pen[] {\r\n    if (pens.length === 1) {\r\n      const pen: Pen = deepClone(pens[0]);\r\n      pen.type = PenType.Node;\r\n      pen.id = undefined;\r\n      return [pen];\r\n    }\r\n\r\n    const components = deepClone(pens, true);\r\n    const rect = getRect(components);\r\n    let parent: Pen = {\r\n      id: s8(),\r\n      name: 'combine',\r\n      ...rect,\r\n      children: [],\r\n      showChild,\r\n    };\r\n\r\n    if (anchor) {\r\n      parent.anchors = [\r\n        {\r\n          id: '0',\r\n          penId: parent.id,\r\n          x: 0.5,\r\n          y: 0,\r\n        },\r\n        {\r\n          id: '1',\r\n          penId: parent.id,\r\n          x: 1,\r\n          y: 0.5,\r\n        },\r\n        {\r\n          id: '2',\r\n          penId: parent.id,\r\n          x: 0.5,\r\n          y: 1,\r\n        },\r\n        {\r\n          id: '3',\r\n          penId: parent.id,\r\n          x: 0,\r\n          y: 0.5,\r\n        },\r\n      ];\r\n    }\r\n    //如果本身就是 一个 组合图元\r\n    const parents = components.filter((pen)=>!pen.parentId);\r\n    const p = components.find((pen) => {\r\n      return pen.width === rect.width && pen.height === rect.height;\r\n    });\r\n    const oneIsParent = p && showChild === undefined;\r\n    if(parents.length===1){\r\n      parent =parents[0];\r\n    }else if (oneIsParent) {\r\n      if (!p.children) {\r\n        p.children = [];\r\n      }\r\n      parent = p;\r\n    } else {\r\n      // 不影响画布数据，生成一个组合图形便于二次复用\r\n      // this.canvas.makePen(parent);\r\n    }\r\n\r\n    components.forEach((pen) => {\r\n      if (pen === parent || pen.parentId === parent.id) {\r\n        return;\r\n      }\r\n      if (pen.parentId) {\r\n        // 已经是其它节点的子节点，x,y,w,h 已经是百分比了\r\n        return;\r\n      }\r\n      parent.children.push(pen.id);\r\n      pen.parentId = parent.id;\r\n      const childRect = calcRelativeRect(pen.calculative.worldRect, rect);\r\n      Object.assign(pen, childRect);\r\n      pen.locked = pen.lockedOnCombine ?? LockState.DisableMove;\r\n      // pen.type = PenType.Node;\r\n    });\r\n\r\n    return (oneIsParent||parents.length===1)\r\n      ? deepClone(components)\r\n      : deepClone([parent, ...components]);\r\n  }\r\n// TODO 安装pen插件 此处是否应当进行相关的适配？不再让插件内部处理install的目标逻辑？\r\n  /**\r\n   * @description 安装插件方法\r\n   * @param plugins 插件列表及其配置项\r\n   * @param pen {string | Pen} 接受tag、name、或者Pen对象*/\r\n  installPenPlugins(pen: {tag?:string,name?:string,id?:string},plugins: PluginOptions[] ){\r\n    if(!pen.tag && !pen.name && !pen.id)return;\r\n    let type;\r\n    pen.id?type = 'id':\r\n      pen.tag?type = 'tag':\r\n        pen.name?type = 'name':'';\r\n    plugins.forEach(pluginConfig=>{\r\n      let plugin = pluginConfig.plugin;\r\n      let option = pluginConfig.options;\r\n      if(!plugin)return;\r\n      // 插件校验\r\n      if(validationPlugin(plugin) && type){\r\n        plugin.install(pen,option);\r\n        // 若当前不存在此插件\r\n        if(!this.penPluginMap.has(plugin)){\r\n          this.penPluginMap.set(plugin,[{[type]:pen[type],option}]);\r\n        }else {\r\n          let op = this.penPluginMap.get(plugin).find((i)=>{\r\n            return i[type] === pen[type];\r\n          });\r\n          // 存在替换\r\n          if(op){\r\n            op.option = option;\r\n          }else{\r\n            this.penPluginMap.get(plugin).push({\r\n              [type]:pen[type],\r\n              option\r\n            });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  uninstallPenPlugins(pen: {tag?:string,name?:string,id?:string},plugins: PluginOptions[] ) {\r\n    let type;\r\n    pen.id?type = 'id':\r\n      pen.tag?type = 'tag':\r\n        pen.name?type = 'name':'';\r\n    if(!type)return;\r\n    plugins.forEach(pluginConfig=>{\r\n      let plugin = pluginConfig.plugin;\r\n      plugin.uninstall(pen,pluginConfig.options);\r\n      let mapList = this.penPluginMap.get(plugin);\r\n      let op = mapList.findIndex(i=>i[type] === pen[type]);\r\n      if(op!==-1){\r\n        mapList.splice(op,1);\r\n        // TODO 在运行时 插件卸载后是否需要移除？\r\n        if(mapList.length === 0){\r\n          this.penPluginMap.delete(plugin);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  setVisible(pen: Pen, visible: boolean, render = true) {\r\n    this.onSizeUpdate();\r\n    this.setValue({ id: pen.id, visible }, { render: false, doEvent: false });\r\n    if (pen.children) {\r\n      for (const childId of pen.children) {\r\n        const child = this.store.pens[childId];\r\n        child && this.setVisible(child, visible, false);\r\n      }\r\n    }\r\n    let allPens = getAllChildren(pen,this.store);\r\n    allPens.push(pen)\r\n    this.initImageCanvas(allPens);\r\n    render && this.render();\r\n  }\r\n\r\n  clearHover(): void {\r\n    this.canvas.clearHover();\r\n  }\r\n\r\n  closeSocket() {\r\n    this.closeWebsocket();\r\n    this.closeMqtt();\r\n    this.closeHttp();\r\n  }\r\n\r\n  setElemPosition = setElemPosition;\r\n\r\n  setLifeCycleFunc = setLifeCycleFunc;\r\n  destroy(onlyData?: boolean) {\r\n    this.clear(false);\r\n    this.stopDataMock();\r\n    this.closeSocket();\r\n    this.closeNetwork();\r\n    this.closeAll();\r\n    this.store.emitter.all.clear(); // 内存释放\r\n    this.canvas.destroy();\r\n    this.canvas = undefined;\r\n    globalStore[this.store.id] = undefined;\r\n    if (!onlyData) {\r\n      for (const k in globalStore) {\r\n        delete globalStore[k];\r\n      }\r\n      globalStore.path2dDraws = {};\r\n      globalStore.canvasDraws = {};\r\n      globalStore.anchors = {};\r\n      globalStore.htmlElements = {};\r\n    }\r\n  }\r\n}\r\n","export const electricSvgList = [\r\n  {\r\n    name: '二极管',\r\n    icon: 'svg/二极管.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/二极管.svg',\r\n      tags: ['Diode'],\r\n      electricTypeCode: 'Diode',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '半圆-封口',\r\n    icon: 'svg/半圆-封口.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/半圆-封口.svg',\r\n      tags: [],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '半圆-开口',\r\n    icon: 'svg/半圆-开口.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/半圆-开口.svg',\r\n      tags: [],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '声音-扬声器',\r\n    icon: 'svg/声音-扬声器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/声音-扬声器.svg',\r\n      tags: [],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '声音-蜂鸣器',\r\n    icon: 'svg/声音-蜂鸣器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/声音-蜂鸣器.svg',\r\n      tags: [],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-三位置-1位',\r\n    icon: 'svg/开关-三位置-1位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-三位置-1位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-三位置-2位',\r\n    icon: 'svg/开关-三位置-2位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-三位置-2位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-三位置-3位',\r\n    icon: 'svg/开关-三位置-3位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-三位置-3位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-单刀双掷-中间位',\r\n    icon: 'svg/开关-单刀双掷-中间位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-单刀双掷-中间位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-单刀双掷-右位',\r\n    icon: 'svg/开关-单刀双掷-右位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-单刀双掷-右位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-单刀双掷-左位',\r\n    icon: 'svg/开关-单刀双掷-左位.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-单刀双掷-左位.svg',\r\n      tags: ['MultipleContact'],\r\n      electricTypeCode: 'MultipleContact',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-惯性开关-断开',\r\n    icon: 'svg/开关-惯性开关-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-惯性开关-断开.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-惯性开关-闭合',\r\n    icon: 'svg/开关-惯性开关-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-惯性开关-闭合.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-按钮-断开',\r\n    icon: 'svg/开关-按钮-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-按钮-断开.svg',\r\n      tags: ['Btn_SelfReset'],\r\n      electricTypeCode: 'Btn_SelfReset',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-按钮-闭合',\r\n    icon: 'svg/开关-按钮-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-按钮-闭合.svg',\r\n      tags: ['Btn_SelfReset'],\r\n      electricTypeCode: 'Btn_SelfReset',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-断路器-断开',\r\n    icon: 'svg/开关-断路器-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-断路器-断开.svg',\r\n      tags: ['duanluqi_wx'],\r\n      electricTypeCode: 'duanluqi_wx',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-断路器-闭合',\r\n    icon: 'svg/开关-断路器-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-断路器-闭合.svg',\r\n      tags: ['duanluqi_wx'],\r\n      electricTypeCode: 'duanluqi_wx',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自复旋转开关-断开',\r\n    icon: 'svg/开关-自复旋转开关-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自复旋转开关-断开.svg',\r\n      tags: ['Knob_SelfReset'],\r\n      electricTypeCode: 'Knob_SelfReset',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自复旋转开关-闭合',\r\n    icon: 'svg/开关-自复旋转开关-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自复旋转开关-闭合.svg',\r\n      tags: ['Knob_SelfReset'],\r\n      electricTypeCode: 'Knob_SelfReset',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自锁按钮-断开',\r\n    icon: 'svg/开关-自锁按钮-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自锁按钮-断开.svg',\r\n      tags: ['Btn_SelfLock'],\r\n      electricTypeCode: 'Btn_SelfLock',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自锁按钮-闭合',\r\n    icon: 'svg/开关-自锁按钮-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自锁按钮-闭合.svg',\r\n      tags: ['Btn_SelfLock'],\r\n      electricTypeCode: 'Btn_SelfLock',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自锁旋转开关-断开',\r\n    icon: 'svg/开关-自锁旋转开关-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自锁旋转开关-断开.svg',\r\n      tags: ['Knob_SelfLock'],\r\n      electricTypeCode: 'Knob_SelfLock',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-自锁旋转开关-闭合',\r\n    icon: 'svg/开关-自锁旋转开关-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-自锁旋转开关-闭合.svg',\r\n      tags: ['Knob_SelfLock'],\r\n      electricTypeCode: 'Knob_SelfLock',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-通用开关-断开',\r\n    icon: 'svg/开关-通用开关-断开.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-通用开关-断开.svg',\r\n      tags: ['Switch', 'Contactk'],\r\n      electricTypeCode: 'Switch',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '开关-通用开关-闭合',\r\n    icon: 'svg/开关-通用开关-闭合.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/开关-通用开关-闭合.svg',\r\n      tags: ['Switch', 'Contact'],\r\n      electricTypeCode: 'Switch',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '指示灯',\r\n    icon: 'svg/指示灯.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/指示灯.svg',\r\n      tags: ['Lamp'],\r\n      electricTypeCode: 'Lamp',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '测量-电压表',\r\n    icon: 'svg/测量-电压表.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/测量-电压表.svg',\r\n      tags: ['VProbe'],\r\n      electricTypeCode: 'VProbe',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '测量-电流表',\r\n    icon: 'svg/测量-电流表.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/测量-电流表.svg',\r\n      tags: ['IProbe'],\r\n      electricTypeCode: 'IProbe',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电动机-三相',\r\n    icon: 'svg/电动机-三相.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电动机-三相.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电容器',\r\n    icon: 'svg/电容器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电容器.svg',\r\n      tags: ['C'],\r\n      electricTypeCode: 'C',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电感-变压器',\r\n    icon: 'svg/电感-变压器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电感-变压器.svg',\r\n      tags: ['TransformerNew'],\r\n      electricTypeCode: 'TransformerNew',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电感-绕组-短',\r\n    icon: 'svg/电感-绕组-短.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电感-绕组-短.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电感-绕组-长',\r\n    icon: 'svg/电感-绕组-长.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电感-绕组-长.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电源-接地',\r\n    icon: 'svg/电源-接地.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电源-接地.svg',\r\n      tags: ['GND'],\r\n      electricTypeCode: 'GND',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电源-电池组',\r\n    icon: 'svg/电源-电池组.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电源-电池组.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电源-直流电源',\r\n    icon: 'svg/电源-直流电源.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电源-直流电源.svg',\r\n      tags: ['Vdc'],\r\n      electricTypeCode: 'Vdc',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电磁阀',\r\n    icon: 'svg/电磁阀.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电磁阀.svg',\r\n      tags: ['ElectromagneticValve'],\r\n      electricTypeCode: 'ElectromagneticValve',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '电阻',\r\n    icon: 'svg/电阻.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/电阻.svg',\r\n      tags: ['R'],\r\n      electricTypeCode: 'R',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '端子-环形',\r\n    icon: 'svg/端子-环形.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/端子-环形.svg',\r\n      tags: ['TerminalsXT'],\r\n      electricTypeCode: 'TerminalsXT',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '端子-实心',\r\n    icon: 'svg/端子-实心.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/端子-实心.svg',\r\n      tags: ['TerminalsXT'],\r\n      electricTypeCode: 'TerminalsXT',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-中间继电器-折线连接二极管',\r\n    icon: 'svg/继电器-中间继电器-折线连接二极管.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-中间继电器-折线连接二极管.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-中间继电器-折线连接电阻',\r\n    icon: 'svg/继电器-中间继电器-折线连接电阻.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-中间继电器-折线连接电阻.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-中间继电器',\r\n    icon: 'svg/继电器-中间继电器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-中间继电器.svg',\r\n      tags: ['Coil'],\r\n      electricTypeCode: 'Coil',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-双位置',\r\n    icon: 'svg/继电器-双位置.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-双位置.svg',\r\n      tags: ['DoubleCoil'],\r\n      electricTypeCode: 'DoubleCoil',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-失电延时',\r\n    icon: 'svg/继电器-失电延时.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-失电延时.svg',\r\n      tags: ['CoilOffDelay'],\r\n      electricTypeCode: 'CoilOffDelay',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '继电器-得电延时',\r\n    icon: 'svg/继电器-得电延时.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/继电器-得电延时.svg',\r\n      tags: ['CoilOnDelay'],\r\n      electricTypeCode: 'CoilOnDelay',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '跨接线',\r\n    icon: 'svg/跨接线.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/跨接线.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '输出',\r\n    icon: 'svg/输入输出.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/输入输出.svg',\r\n      tags: ['Output'],\r\n      anchors: [\r\n        {\r\n          x: 0,\r\n          y: 0.5,\r\n        }\r\n      ],\r\n      electricTypeCode: 'Output',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '输入',\r\n    icon: 'svg/输入输出.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/输入输出.svg',\r\n      tags: ['Input'],\r\n      anchors: [\r\n        {\r\n          x: 1,\r\n          y: 0.5,\r\n        }\r\n      ],\r\n      electricTypeCode: 'Input',\r\n      electricName: '',\r\n    },\r\n  },\r\n\r\n  {\r\n    name: '连接端子-插针针孔',\r\n    icon: 'svg/连接端子-插针针孔.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/连接端子-插针针孔.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n  {\r\n    name: '避雷器',\r\n    icon: 'svg/避雷器.svg',\r\n    data: {\r\n      text: '',\r\n      // width: 100,\r\n      // height: 100,\r\n      name: 'image',\r\n      image: 'svg/避雷器.svg',\r\n      tags: [''],\r\n      electricTypeCode: '',\r\n      electricName: '',\r\n    },\r\n  },\r\n];\r\n\r\nexport const electricCombineList = [\r\n  {\r\n    name: '开关',\r\n    children: [\r\n      {\r\n        name: '开关-三位置',\r\n        icon: 'svg/开关-三位置-1位.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-三位置-1位.svg',\r\n          tags: ['MultipleContact'],\r\n          electricTypeCode: 'MultipleContact',\r\n          electricName: '',\r\n          showChild: 0,\r\n        },\r\n      },\r\n      {\r\n        name: '开关-单刀双掷',\r\n        icon: 'svg/开关-单刀双掷-中间位.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-单刀双掷-中间位.svg',\r\n          tags: ['MultipleContact'],\r\n          electricTypeCode: 'MultipleContact',\r\n          electricName: '',\r\n        },\r\n      },\r\n\r\n      {\r\n        name: '开关-惯性开关',\r\n        icon: 'svg/开关-惯性开关-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-惯性开关-断开.svg',\r\n          tags: [''],\r\n          electricTypeCode: '',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-按钮',\r\n        icon: 'svg/开关-按钮-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-按钮-断开.svg',\r\n          tags: ['Btn_SelfReset'],\r\n          electricTypeCode: 'Btn_SelfReset',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-断路器',\r\n        icon: 'svg/开关-断路器-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-断路器-断开.svg',\r\n          tags: ['duanluqi_wx'],\r\n          electricTypeCode: 'duanluqi_wx',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-自复旋转开关',\r\n        icon: 'svg/开关-自复旋转开关-闭合.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-自复旋转开关-闭合.svg',\r\n          tags: ['Knob_SelfReset'],\r\n          electricTypeCode: 'Knob_SelfReset',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-自锁按钮',\r\n        icon: 'svg/开关-自锁按钮-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-自锁按钮-断开.svg',\r\n          tags: ['Btn_SelfLock'],\r\n          electricTypeCode: 'Btn_SelfLock',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-自锁旋转开关',\r\n        icon: 'svg/开关-自锁旋转开关-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-自锁旋转开关-断开.svg',\r\n          tags: ['Knob_SelfLock'],\r\n          electricTypeCode: 'Knob_SelfLock',\r\n          electricName: '',\r\n        },\r\n      },\r\n      {\r\n        name: '开关-通用开关',\r\n        icon: 'svg/开关-通用开关-断开.svg',\r\n        type: 'combine-json',\r\n        data: {\r\n          text: '',\r\n          // width: 100,\r\n          // height: 100,\r\n          name: 'image',\r\n          image: 'svg/开关-通用开关-断开.svg',\r\n          tags: ['Switch'],\r\n          electricTypeCode: 'Switch',\r\n          electricName: '',\r\n        },\r\n      },\r\n    ],\r\n  },\r\n];\r\n","'use strict';\n\nconst nameStartChar = ':A-Za-z_\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02FF\\\\u0370-\\\\u037D\\\\u037F-\\\\u1FFF\\\\u200C-\\\\u200D\\\\u2070-\\\\u218F\\\\u2C00-\\\\u2FEF\\\\u3001-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFFD';\nconst nameChar = nameStartChar + '\\\\-.\\\\d\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040';\nconst nameRegexp = '[' + nameStartChar + '][' + nameChar + ']*'\nconst regexName = new RegExp('^' + nameRegexp + '$');\n\nconst getAllMatches = function(string, regex) {\n  const matches = [];\n  let match = regex.exec(string);\n  while (match) {\n    const allmatches = [];\n    allmatches.startIndex = regex.lastIndex - match[0].length;\n    const len = match.length;\n    for (let index = 0; index < len; index++) {\n      allmatches.push(match[index]);\n    }\n    matches.push(allmatches);\n    match = regex.exec(string);\n  }\n  return matches;\n};\n\nconst isName = function(string) {\n  const match = regexName.exec(string);\n  return !(match === null || typeof match === 'undefined');\n};\n\nexports.isExist = function(v) {\n  return typeof v !== 'undefined';\n};\n\nexports.isEmptyObject = function(obj) {\n  return Object.keys(obj).length === 0;\n};\n\n/**\n * Copy all the properties of a into b.\n * @param {*} target\n * @param {*} a\n */\nexports.merge = function(target, a, arrayMode) {\n  if (a) {\n    const keys = Object.keys(a); // will return an array of own properties\n    const len = keys.length; //don't make it inline\n    for (let i = 0; i < len; i++) {\n      if (arrayMode === 'strict') {\n        target[keys[i]] = [ a[keys[i]] ];\n      } else {\n        target[keys[i]] = a[keys[i]];\n      }\n    }\n  }\n};\n/* exports.merge =function (b,a){\n  return Object.assign(b,a);\n} */\n\nexports.getValue = function(v) {\n  if (exports.isExist(v)) {\n    return v;\n  } else {\n    return '';\n  }\n};\n\n// const fakeCall = function(a) {return a;};\n// const fakeCallNoReturn = function() {};\n\nexports.isName = isName;\nexports.getAllMatches = getAllMatches;\nexports.nameRegexp = nameRegexp;\n","'use strict';\n\nconst util = require('./util');\n\nconst defaultOptions = {\n  allowBooleanAttributes: false, //A tag can have attributes without any value\n  unpairedTags: []\n};\n\n//const tagsPattern = new RegExp(\"<\\\\/?([\\\\w:\\\\-_\\.]+)\\\\s*\\/?>\",\"g\");\nexports.validate = function (xmlData, options) {\n  options = Object.assign({}, defaultOptions, options);\n\n  //xmlData = xmlData.replace(/(\\r\\n|\\n|\\r)/gm,\"\");//make it single line\n  //xmlData = xmlData.replace(/(^\\s*<\\?xml.*?\\?>)/g,\"\");//Remove XML starting tag\n  //xmlData = xmlData.replace(/(<!DOCTYPE[\\s\\w\\\"\\.\\/\\-\\:]+(\\[.*\\])*\\s*>)/g,\"\");//Remove DOCTYPE\n  const tags = [];\n  let tagFound = false;\n\n  //indicates that the root tag has been closed (aka. depth 0 has been reached)\n  let reachedRoot = false;\n\n  if (xmlData[0] === '\\ufeff') {\n    // check for byte order mark (BOM)\n    xmlData = xmlData.substr(1);\n  }\n  \n  for (let i = 0; i < xmlData.length; i++) {\n\n    if (xmlData[i] === '<' && xmlData[i+1] === '?') {\n      i+=2;\n      i = readPI(xmlData,i);\n      if (i.err) return i;\n    }else if (xmlData[i] === '<') {\n      //starting of tag\n      //read until you reach to '>' avoiding any '>' in attribute value\n      let tagStartPos = i;\n      i++;\n      \n      if (xmlData[i] === '!') {\n        i = readCommentAndCDATA(xmlData, i);\n        continue;\n      } else {\n        let closingTag = false;\n        if (xmlData[i] === '/') {\n          //closing tag\n          closingTag = true;\n          i++;\n        }\n        //read tagname\n        let tagName = '';\n        for (; i < xmlData.length &&\n          xmlData[i] !== '>' &&\n          xmlData[i] !== ' ' &&\n          xmlData[i] !== '\\t' &&\n          xmlData[i] !== '\\n' &&\n          xmlData[i] !== '\\r'; i++\n        ) {\n          tagName += xmlData[i];\n        }\n        tagName = tagName.trim();\n        //console.log(tagName);\n\n        if (tagName[tagName.length - 1] === '/') {\n          //self closing tag without attributes\n          tagName = tagName.substring(0, tagName.length - 1);\n          //continue;\n          i--;\n        }\n        if (!validateTagName(tagName)) {\n          let msg;\n          if (tagName.trim().length === 0) {\n            msg = \"Invalid space after '<'.\";\n          } else {\n            msg = \"Tag '\"+tagName+\"' is an invalid name.\";\n          }\n          return getErrorObject('InvalidTag', msg, getLineNumberForPosition(xmlData, i));\n        }\n\n        const result = readAttributeStr(xmlData, i);\n        if (result === false) {\n          return getErrorObject('InvalidAttr', \"Attributes for '\"+tagName+\"' have open quote.\", getLineNumberForPosition(xmlData, i));\n        }\n        let attrStr = result.value;\n        i = result.index;\n\n        if (attrStr[attrStr.length - 1] === '/') {\n          //self closing tag\n          const attrStrStart = i - attrStr.length;\n          attrStr = attrStr.substring(0, attrStr.length - 1);\n          const isValid = validateAttributeString(attrStr, options);\n          if (isValid === true) {\n            tagFound = true;\n            //continue; //text may presents after self closing tag\n          } else {\n            //the result from the nested function returns the position of the error within the attribute\n            //in order to get the 'true' error line, we need to calculate the position where the attribute begins (i - attrStr.length) and then add the position within the attribute\n            //this gives us the absolute index in the entire xml, which we can use to find the line at last\n            return getErrorObject(isValid.err.code, isValid.err.msg, getLineNumberForPosition(xmlData, attrStrStart + isValid.err.line));\n          }\n        } else if (closingTag) {\n          if (!result.tagClosed) {\n            return getErrorObject('InvalidTag', \"Closing tag '\"+tagName+\"' doesn't have proper closing.\", getLineNumberForPosition(xmlData, i));\n          } else if (attrStr.trim().length > 0) {\n            return getErrorObject('InvalidTag', \"Closing tag '\"+tagName+\"' can't have attributes or invalid starting.\", getLineNumberForPosition(xmlData, tagStartPos));\n          } else if (tags.length === 0) {\n            return getErrorObject('InvalidTag', \"Closing tag '\"+tagName+\"' has not been opened.\", getLineNumberForPosition(xmlData, tagStartPos));\n          } else {\n            const otg = tags.pop();\n            if (tagName !== otg.tagName) {\n              let openPos = getLineNumberForPosition(xmlData, otg.tagStartPos);\n              return getErrorObject('InvalidTag',\n                \"Expected closing tag '\"+otg.tagName+\"' (opened in line \"+openPos.line+\", col \"+openPos.col+\") instead of closing tag '\"+tagName+\"'.\",\n                getLineNumberForPosition(xmlData, tagStartPos));\n            }\n\n            //when there are no more tags, we reached the root level.\n            if (tags.length == 0) {\n              reachedRoot = true;\n            }\n          }\n        } else {\n          const isValid = validateAttributeString(attrStr, options);\n          if (isValid !== true) {\n            //the result from the nested function returns the position of the error within the attribute\n            //in order to get the 'true' error line, we need to calculate the position where the attribute begins (i - attrStr.length) and then add the position within the attribute\n            //this gives us the absolute index in the entire xml, which we can use to find the line at last\n            return getErrorObject(isValid.err.code, isValid.err.msg, getLineNumberForPosition(xmlData, i - attrStr.length + isValid.err.line));\n          }\n\n          //if the root level has been reached before ...\n          if (reachedRoot === true) {\n            return getErrorObject('InvalidXml', 'Multiple possible root nodes found.', getLineNumberForPosition(xmlData, i));\n          } else if(options.unpairedTags.indexOf(tagName) !== -1){\n            //don't push into stack\n          } else {\n            tags.push({tagName, tagStartPos});\n          }\n          tagFound = true;\n        }\n\n        //skip tag text value\n        //It may include comments and CDATA value\n        for (i++; i < xmlData.length; i++) {\n          if (xmlData[i] === '<') {\n            if (xmlData[i + 1] === '!') {\n              //comment or CADATA\n              i++;\n              i = readCommentAndCDATA(xmlData, i);\n              continue;\n            } else if (xmlData[i+1] === '?') {\n              i = readPI(xmlData, ++i);\n              if (i.err) return i;\n            } else{\n              break;\n            }\n          } else if (xmlData[i] === '&') {\n            const afterAmp = validateAmpersand(xmlData, i);\n            if (afterAmp == -1)\n              return getErrorObject('InvalidChar', \"char '&' is not expected.\", getLineNumberForPosition(xmlData, i));\n            i = afterAmp;\n          }else{\n            if (reachedRoot === true && !isWhiteSpace(xmlData[i])) {\n              return getErrorObject('InvalidXml', \"Extra text at the end\", getLineNumberForPosition(xmlData, i));\n            }\n          }\n        } //end of reading tag text value\n        if (xmlData[i] === '<') {\n          i--;\n        }\n      }\n    } else {\n      if ( isWhiteSpace(xmlData[i])) {\n        continue;\n      }\n      return getErrorObject('InvalidChar', \"char '\"+xmlData[i]+\"' is not expected.\", getLineNumberForPosition(xmlData, i));\n    }\n  }\n\n  if (!tagFound) {\n    return getErrorObject('InvalidXml', 'Start tag expected.', 1);\n  }else if (tags.length == 1) {\n      return getErrorObject('InvalidTag', \"Unclosed tag '\"+tags[0].tagName+\"'.\", getLineNumberForPosition(xmlData, tags[0].tagStartPos));\n  }else if (tags.length > 0) {\n      return getErrorObject('InvalidXml', \"Invalid '\"+\n          JSON.stringify(tags.map(t => t.tagName), null, 4).replace(/\\r?\\n/g, '')+\n          \"' found.\", {line: 1, col: 1});\n  }\n\n  return true;\n};\n\nfunction isWhiteSpace(char){\n  return char === ' ' || char === '\\t' || char === '\\n'  || char === '\\r';\n}\n/**\n * Read Processing insstructions and skip\n * @param {*} xmlData\n * @param {*} i\n */\nfunction readPI(xmlData, i) {\n  const start = i;\n  for (; i < xmlData.length; i++) {\n    if (xmlData[i] == '?' || xmlData[i] == ' ') {\n      //tagname\n      const tagname = xmlData.substr(start, i - start);\n      if (i > 5 && tagname === 'xml') {\n        return getErrorObject('InvalidXml', 'XML declaration allowed only at the start of the document.', getLineNumberForPosition(xmlData, i));\n      } else if (xmlData[i] == '?' && xmlData[i + 1] == '>') {\n        //check if valid attribut string\n        i++;\n        break;\n      } else {\n        continue;\n      }\n    }\n  }\n  return i;\n}\n\nfunction readCommentAndCDATA(xmlData, i) {\n  if (xmlData.length > i + 5 && xmlData[i + 1] === '-' && xmlData[i + 2] === '-') {\n    //comment\n    for (i += 3; i < xmlData.length; i++) {\n      if (xmlData[i] === '-' && xmlData[i + 1] === '-' && xmlData[i + 2] === '>') {\n        i += 2;\n        break;\n      }\n    }\n  } else if (\n    xmlData.length > i + 8 &&\n    xmlData[i + 1] === 'D' &&\n    xmlData[i + 2] === 'O' &&\n    xmlData[i + 3] === 'C' &&\n    xmlData[i + 4] === 'T' &&\n    xmlData[i + 5] === 'Y' &&\n    xmlData[i + 6] === 'P' &&\n    xmlData[i + 7] === 'E'\n  ) {\n    let angleBracketsCount = 1;\n    for (i += 8; i < xmlData.length; i++) {\n      if (xmlData[i] === '<') {\n        angleBracketsCount++;\n      } else if (xmlData[i] === '>') {\n        angleBracketsCount--;\n        if (angleBracketsCount === 0) {\n          break;\n        }\n      }\n    }\n  } else if (\n    xmlData.length > i + 9 &&\n    xmlData[i + 1] === '[' &&\n    xmlData[i + 2] === 'C' &&\n    xmlData[i + 3] === 'D' &&\n    xmlData[i + 4] === 'A' &&\n    xmlData[i + 5] === 'T' &&\n    xmlData[i + 6] === 'A' &&\n    xmlData[i + 7] === '['\n  ) {\n    for (i += 8; i < xmlData.length; i++) {\n      if (xmlData[i] === ']' && xmlData[i + 1] === ']' && xmlData[i + 2] === '>') {\n        i += 2;\n        break;\n      }\n    }\n  }\n\n  return i;\n}\n\nconst doubleQuote = '\"';\nconst singleQuote = \"'\";\n\n/**\n * Keep reading xmlData until '<' is found outside the attribute value.\n * @param {string} xmlData\n * @param {number} i\n */\nfunction readAttributeStr(xmlData, i) {\n  let attrStr = '';\n  let startChar = '';\n  let tagClosed = false;\n  for (; i < xmlData.length; i++) {\n    if (xmlData[i] === doubleQuote || xmlData[i] === singleQuote) {\n      if (startChar === '') {\n        startChar = xmlData[i];\n      } else if (startChar !== xmlData[i]) {\n        //if vaue is enclosed with double quote then single quotes are allowed inside the value and vice versa\n      } else {\n        startChar = '';\n      }\n    } else if (xmlData[i] === '>') {\n      if (startChar === '') {\n        tagClosed = true;\n        break;\n      }\n    }\n    attrStr += xmlData[i];\n  }\n  if (startChar !== '') {\n    return false;\n  }\n\n  return {\n    value: attrStr,\n    index: i,\n    tagClosed: tagClosed\n  };\n}\n\n/**\n * Select all the attributes whether valid or invalid.\n */\nconst validAttrStrRegxp = new RegExp('(\\\\s*)([^\\\\s=]+)(\\\\s*=)?(\\\\s*([\\'\"])(([\\\\s\\\\S])*?)\\\\5)?', 'g');\n\n//attr, =\"sd\", a=\"amit's\", a=\"sd\"b=\"saf\", ab  cd=\"\"\n\nfunction validateAttributeString(attrStr, options) {\n  //console.log(\"start:\"+attrStr+\":end\");\n\n  //if(attrStr.trim().length === 0) return true; //empty string\n\n  const matches = util.getAllMatches(attrStr, validAttrStrRegxp);\n  const attrNames = {};\n\n  for (let i = 0; i < matches.length; i++) {\n    if (matches[i][1].length === 0) {\n      //nospace before attribute name: a=\"sd\"b=\"saf\"\n      return getErrorObject('InvalidAttr', \"Attribute '\"+matches[i][2]+\"' has no space in starting.\", getPositionFromMatch(matches[i]))\n    } else if (matches[i][3] !== undefined && matches[i][4] === undefined) {\n      return getErrorObject('InvalidAttr', \"Attribute '\"+matches[i][2]+\"' is without value.\", getPositionFromMatch(matches[i]));\n    } else if (matches[i][3] === undefined && !options.allowBooleanAttributes) {\n      //independent attribute: ab\n      return getErrorObject('InvalidAttr', \"boolean attribute '\"+matches[i][2]+\"' is not allowed.\", getPositionFromMatch(matches[i]));\n    }\n    /* else if(matches[i][6] === undefined){//attribute without value: ab=\n                    return { err: { code:\"InvalidAttr\",msg:\"attribute \" + matches[i][2] + \" has no value assigned.\"}};\n                } */\n    const attrName = matches[i][2];\n    if (!validateAttrName(attrName)) {\n      return getErrorObject('InvalidAttr', \"Attribute '\"+attrName+\"' is an invalid name.\", getPositionFromMatch(matches[i]));\n    }\n    if (!attrNames.hasOwnProperty(attrName)) {\n      //check for duplicate attribute.\n      attrNames[attrName] = 1;\n    } else {\n      return getErrorObject('InvalidAttr', \"Attribute '\"+attrName+\"' is repeated.\", getPositionFromMatch(matches[i]));\n    }\n  }\n\n  return true;\n}\n\nfunction validateNumberAmpersand(xmlData, i) {\n  let re = /\\d/;\n  if (xmlData[i] === 'x') {\n    i++;\n    re = /[\\da-fA-F]/;\n  }\n  for (; i < xmlData.length; i++) {\n    if (xmlData[i] === ';')\n      return i;\n    if (!xmlData[i].match(re))\n      break;\n  }\n  return -1;\n}\n\nfunction validateAmpersand(xmlData, i) {\n  // https://www.w3.org/TR/xml/#dt-charref\n  i++;\n  if (xmlData[i] === ';')\n    return -1;\n  if (xmlData[i] === '#') {\n    i++;\n    return validateNumberAmpersand(xmlData, i);\n  }\n  let count = 0;\n  for (; i < xmlData.length; i++, count++) {\n    if (xmlData[i].match(/\\w/) && count < 20)\n      continue;\n    if (xmlData[i] === ';')\n      break;\n    return -1;\n  }\n  return i;\n}\n\nfunction getErrorObject(code, message, lineNumber) {\n  return {\n    err: {\n      code: code,\n      msg: message,\n      line: lineNumber.line || lineNumber,\n      col: lineNumber.col,\n    },\n  };\n}\n\nfunction validateAttrName(attrName) {\n  return util.isName(attrName);\n}\n\n// const startsWithXML = /^xml/i;\n\nfunction validateTagName(tagname) {\n  return util.isName(tagname) /* && !tagname.match(startsWithXML) */;\n}\n\n//this function returns the line number for the character at the given index\nfunction getLineNumberForPosition(xmlData, index) {\n  const lines = xmlData.substring(0, index).split(/\\r?\\n/);\n  return {\n    line: lines.length,\n\n    // column number is last line's length + 1, because column numbering starts at 1:\n    col: lines[lines.length - 1].length + 1\n  };\n}\n\n//this function returns the position of the first character of match within attrStr\nfunction getPositionFromMatch(match) {\n  return match.startIndex + match[1].length;\n}\n","\nconst defaultOptions = {\n    preserveOrder: false,\n    attributeNamePrefix: '@_',\n    attributesGroupName: false,\n    textNodeName: '#text',\n    ignoreAttributes: true,\n    removeNSPrefix: false, // remove NS from tag name or attribute name if true\n    allowBooleanAttributes: false, //a tag can have attributes without any value\n    //ignoreRootElement : false,\n    parseTagValue: true,\n    parseAttributeValue: false,\n    trimValues: true, //Trim string values of tag and attributes\n    cdataPropName: false,\n    numberParseOptions: {\n      hex: true,\n      leadingZeros: true,\n      eNotation: true\n    },\n    tagValueProcessor: function(tagName, val) {\n      return val;\n    },\n    attributeValueProcessor: function(attrName, val) {\n      return val;\n    },\n    stopNodes: [], //nested tags will not be parsed even for errors\n    alwaysCreateTextNode: false,\n    isArray: () => false,\n    commentPropName: false,\n    unpairedTags: [],\n    processEntities: true,\n    htmlEntities: false,\n    ignoreDeclaration: false,\n    ignorePiTags: false,\n    transformTagName: false,\n    transformAttributeName: false,\n    updateTag: function(tagName, jPath, attrs){\n      return tagName\n    },\n    // skipEmptyListItem: false\n};\n   \nconst buildOptions = function(options) {\n    return Object.assign({}, defaultOptions, options);\n};\n\nexports.buildOptions = buildOptions;\nexports.defaultOptions = defaultOptions;","'use strict';\n\nclass XmlNode{\n  constructor(tagname) {\n    this.tagname = tagname;\n    this.child = []; //nested tags, text, cdata, comments in order\n    this[\":@\"] = {}; //attributes map\n  }\n  add(key,val){\n    // this.child.push( {name : key, val: val, isCdata: isCdata });\n    if(key === \"__proto__\") key = \"#__proto__\";\n    this.child.push( {[key]: val });\n  }\n  addChild(node) {\n    if(node.tagname === \"__proto__\") node.tagname = \"#__proto__\";\n    if(node[\":@\"] && Object.keys(node[\":@\"]).length > 0){\n      this.child.push( { [node.tagname]: node.child, [\":@\"]: node[\":@\"] });\n    }else{\n      this.child.push( { [node.tagname]: node.child });\n    }\n  };\n};\n\n\nmodule.exports = XmlNode;","const util = require('../util');\n\n//TODO: handle comments\nfunction readDocType(xmlData, i){\n    \n    const entities = {};\n    if( xmlData[i + 3] === 'O' &&\n         xmlData[i + 4] === 'C' &&\n         xmlData[i + 5] === 'T' &&\n         xmlData[i + 6] === 'Y' &&\n         xmlData[i + 7] === 'P' &&\n         xmlData[i + 8] === 'E')\n    {    \n        i = i+9;\n        let angleBracketsCount = 1;\n        let hasBody = false, comment = false;\n        let exp = \"\";\n        for(;i<xmlData.length;i++){\n            if (xmlData[i] === '<' && !comment) { //Determine the tag type\n                if( hasBody && isEntity(xmlData, i)){\n                    i += 7; \n                    let entityName, val;\n                    [entityName, val,i] = readEntityExp(xmlData,i+1);\n                    if(val.indexOf(\"&\") === -1) //Parameter entities are not supported\n                        entities[ validateEntityName(entityName) ] = {\n                            regx : RegExp( `&${entityName};`,\"g\"),\n                            val: val\n                        };\n                }\n                else if( hasBody && isElement(xmlData, i))  i += 8;//Not supported\n                else if( hasBody && isAttlist(xmlData, i))  i += 8;//Not supported\n                else if( hasBody && isNotation(xmlData, i)) i += 9;//Not supported\n                else if( isComment)                         comment = true;\n                else                                        throw new Error(\"Invalid DOCTYPE\");\n\n                angleBracketsCount++;\n                exp = \"\";\n            } else if (xmlData[i] === '>') { //Read tag content\n                if(comment){\n                    if( xmlData[i - 1] === \"-\" && xmlData[i - 2] === \"-\"){\n                        comment = false;\n                        angleBracketsCount--;\n                    }\n                }else{\n                    angleBracketsCount--;\n                }\n                if (angleBracketsCount === 0) {\n                  break;\n                }\n            }else if( xmlData[i] === '['){\n                hasBody = true;\n            }else{\n                exp += xmlData[i];\n            }\n        }\n        if(angleBracketsCount !== 0){\n            throw new Error(`Unclosed DOCTYPE`);\n        }\n    }else{\n        throw new Error(`Invalid Tag instead of DOCTYPE`);\n    }\n    return {entities, i};\n}\n\nfunction readEntityExp(xmlData,i){\n    //External entities are not supported\n    //    <!ENTITY ext SYSTEM \"http://normal-website.com\" >\n\n    //Parameter entities are not supported\n    //    <!ENTITY entityname \"&anotherElement;\">\n\n    //Internal entities are supported\n    //    <!ENTITY entityname \"replacement text\">\n    \n    //read EntityName\n    let entityName = \"\";\n    for (; i < xmlData.length && (xmlData[i] !== \"'\" && xmlData[i] !== '\"' ); i++) {\n        // if(xmlData[i] === \" \") continue;\n        // else \n        entityName += xmlData[i];\n    }\n    entityName = entityName.trim();\n    if(entityName.indexOf(\" \") !== -1) throw new Error(\"External entites are not supported\");\n\n    //read Entity Value\n    const startChar = xmlData[i++];\n    let val = \"\"\n    for (; i < xmlData.length && xmlData[i] !== startChar ; i++) {\n        val += xmlData[i];\n    }\n    return [entityName, val, i];\n}\n\nfunction isComment(xmlData, i){\n    if(xmlData[i+1] === '!' &&\n    xmlData[i+2] === '-' &&\n    xmlData[i+3] === '-') return true\n    return false\n}\nfunction isEntity(xmlData, i){\n    if(xmlData[i+1] === '!' &&\n    xmlData[i+2] === 'E' &&\n    xmlData[i+3] === 'N' &&\n    xmlData[i+4] === 'T' &&\n    xmlData[i+5] === 'I' &&\n    xmlData[i+6] === 'T' &&\n    xmlData[i+7] === 'Y') return true\n    return false\n}\nfunction isElement(xmlData, i){\n    if(xmlData[i+1] === '!' &&\n    xmlData[i+2] === 'E' &&\n    xmlData[i+3] === 'L' &&\n    xmlData[i+4] === 'E' &&\n    xmlData[i+5] === 'M' &&\n    xmlData[i+6] === 'E' &&\n    xmlData[i+7] === 'N' &&\n    xmlData[i+8] === 'T') return true\n    return false\n}\n\nfunction isAttlist(xmlData, i){\n    if(xmlData[i+1] === '!' &&\n    xmlData[i+2] === 'A' &&\n    xmlData[i+3] === 'T' &&\n    xmlData[i+4] === 'T' &&\n    xmlData[i+5] === 'L' &&\n    xmlData[i+6] === 'I' &&\n    xmlData[i+7] === 'S' &&\n    xmlData[i+8] === 'T') return true\n    return false\n}\nfunction isNotation(xmlData, i){\n    if(xmlData[i+1] === '!' &&\n    xmlData[i+2] === 'N' &&\n    xmlData[i+3] === 'O' &&\n    xmlData[i+4] === 'T' &&\n    xmlData[i+5] === 'A' &&\n    xmlData[i+6] === 'T' &&\n    xmlData[i+7] === 'I' &&\n    xmlData[i+8] === 'O' &&\n    xmlData[i+9] === 'N') return true\n    return false\n}\n\nfunction validateEntityName(name){\n    if (util.isName(name))\n\treturn name;\n    else\n        throw new Error(`Invalid entity name ${name}`);\n}\n\nmodule.exports = readDocType;\n","const hexRegex = /^[-+]?0x[a-fA-F0-9]+$/;\nconst numRegex = /^([\\-\\+])?(0*)(\\.[0-9]+([eE]\\-?[0-9]+)?|[0-9]+(\\.[0-9]+([eE]\\-?[0-9]+)?)?)$/;\n// const octRegex = /0x[a-z0-9]+/;\n// const binRegex = /0x[a-z0-9]+/;\n\n\n//polyfill\nif (!Number.parseInt && window.parseInt) {\n    Number.parseInt = window.parseInt;\n}\nif (!Number.parseFloat && window.parseFloat) {\n    Number.parseFloat = window.parseFloat;\n}\n\n  \nconst consider = {\n    hex :  true,\n    leadingZeros: true,\n    decimalPoint: \"\\.\",\n    eNotation: true\n    //skipLike: /regex/\n};\n\nfunction toNumber(str, options = {}){\n    // const options = Object.assign({}, consider);\n    // if(opt.leadingZeros === false){\n    //     options.leadingZeros = false;\n    // }else if(opt.hex === false){\n    //     options.hex = false;\n    // }\n\n    options = Object.assign({}, consider, options );\n    if(!str || typeof str !== \"string\" ) return str;\n    \n    let trimmedStr  = str.trim();\n    // if(trimmedStr === \"0.0\") return 0;\n    // else if(trimmedStr === \"+0.0\") return 0;\n    // else if(trimmedStr === \"-0.0\") return -0;\n\n    if(options.skipLike !== undefined && options.skipLike.test(trimmedStr)) return str;\n    else if (options.hex && hexRegex.test(trimmedStr)) {\n        return Number.parseInt(trimmedStr, 16);\n    // } else if (options.parseOct && octRegex.test(str)) {\n    //     return Number.parseInt(val, 8);\n    // }else if (options.parseBin && binRegex.test(str)) {\n    //     return Number.parseInt(val, 2);\n    }else{\n        //separate negative sign, leading zeros, and rest number\n        const match = numRegex.exec(trimmedStr);\n        if(match){\n            const sign = match[1];\n            const leadingZeros = match[2];\n            let numTrimmedByZeros = trimZeros(match[3]); //complete num without leading zeros\n            //trim ending zeros for floating number\n            \n            const eNotation = match[4] || match[6];\n            if(!options.leadingZeros && leadingZeros.length > 0 && sign && trimmedStr[2] !== \".\") return str; //-0123\n            else if(!options.leadingZeros && leadingZeros.length > 0 && !sign && trimmedStr[1] !== \".\") return str; //0123\n            else{//no leading zeros or leading zeros are allowed\n                const num = Number(trimmedStr);\n                const numStr = \"\" + num;\n                if(numStr.search(/[eE]/) !== -1){ //given number is long and parsed to eNotation\n                    if(options.eNotation) return num;\n                    else return str;\n                }else if(eNotation){ //given number has enotation\n                    if(options.eNotation) return num;\n                    else return str;\n                }else if(trimmedStr.indexOf(\".\") !== -1){ //floating number\n                    // const decimalPart = match[5].substr(1);\n                    // const intPart = trimmedStr.substr(0,trimmedStr.indexOf(\".\"));\n\n                    \n                    // const p = numStr.indexOf(\".\");\n                    // const givenIntPart = numStr.substr(0,p);\n                    // const givenDecPart = numStr.substr(p+1);\n                    if(numStr === \"0\" && (numTrimmedByZeros === \"\") ) return num; //0.0\n                    else if(numStr === numTrimmedByZeros) return num; //0.456. 0.79000\n                    else if( sign && numStr === \"-\"+numTrimmedByZeros) return num;\n                    else return str;\n                }\n                \n                if(leadingZeros){\n                    // if(numTrimmedByZeros === numStr){\n                    //     if(options.leadingZeros) return num;\n                    //     else return str;\n                    // }else return str;\n                    if(numTrimmedByZeros === numStr) return num;\n                    else if(sign+numTrimmedByZeros === numStr) return num;\n                    else return str;\n                }\n\n                if(trimmedStr === numStr) return num;\n                else if(trimmedStr === sign+numStr) return num;\n                // else{\n                //     //number with +/- sign\n                //     trimmedStr.test(/[-+][0-9]);\n\n                // }\n                return str;\n            }\n            // else if(!eNotation && trimmedStr && trimmedStr !== Number(trimmedStr) ) return str;\n            \n        }else{ //non-numeric string\n            return str;\n        }\n    }\n}\n\n/**\n * \n * @param {string} numStr without leading zeros\n * @returns \n */\nfunction trimZeros(numStr){\n    if(numStr && numStr.indexOf(\".\") !== -1){//float\n        numStr = numStr.replace(/0+$/, \"\"); //remove ending zeros\n        if(numStr === \".\")  numStr = \"0\";\n        else if(numStr[0] === \".\")  numStr = \"0\"+numStr;\n        else if(numStr[numStr.length-1] === \".\")  numStr = numStr.substr(0,numStr.length-1);\n        return numStr;\n    }\n    return numStr;\n}\nmodule.exports = toNumber\n","function getIgnoreAttributesFn(ignoreAttributes) {\n    if (typeof ignoreAttributes === 'function') {\n        return ignoreAttributes\n    }\n    if (Array.isArray(ignoreAttributes)) {\n        return (attrName) => {\n            for (const pattern of ignoreAttributes) {\n                if (typeof pattern === 'string' && attrName === pattern) {\n                    return true\n                }\n                if (pattern instanceof RegExp && pattern.test(attrName)) {\n                    return true\n                }\n            }\n        }\n    }\n    return () => false\n}\n\nmodule.exports = getIgnoreAttributesFn","'use strict';\n///@ts-check\n\nconst util = require('../util');\nconst xmlNode = require('./xmlNode');\nconst readDocType = require(\"./DocTypeReader\");\nconst toNumber = require(\"strnum\");\nconst getIgnoreAttributesFn = require('../ignoreAttributes')\n\n// const regx =\n//   '<((!\\\\[CDATA\\\\[([\\\\s\\\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\\\/)(NAME)\\\\s*>))([^<]*)'\n//   .replace(/NAME/g, util.nameRegexp);\n\n//const tagsRegx = new RegExp(\"<(\\\\/?[\\\\w:\\\\-\\._]+)([^>]*)>(\\\\s*\"+cdataRegx+\")*([^<]+)?\",\"g\");\n//const tagsRegx = new RegExp(\"<(\\\\/?)((\\\\w*:)?([\\\\w:\\\\-\\._]+))([^>]*)>([^<]*)(\"+cdataRegx+\"([^<]*))*([^<]+)?\",\"g\");\n\nclass OrderedObjParser{\n  constructor(options){\n    this.options = options;\n    this.currentNode = null;\n    this.tagsNodeStack = [];\n    this.docTypeEntities = {};\n    this.lastEntities = {\n      \"apos\" : { regex: /&(apos|#39|#x27);/g, val : \"'\"},\n      \"gt\" : { regex: /&(gt|#62|#x3E);/g, val : \">\"},\n      \"lt\" : { regex: /&(lt|#60|#x3C);/g, val : \"<\"},\n      \"quot\" : { regex: /&(quot|#34|#x22);/g, val : \"\\\"\"},\n    };\n    this.ampEntity = { regex: /&(amp|#38|#x26);/g, val : \"&\"};\n    this.htmlEntities = {\n      \"space\": { regex: /&(nbsp|#160);/g, val: \" \" },\n      // \"lt\" : { regex: /&(lt|#60);/g, val: \"<\" },\n      // \"gt\" : { regex: /&(gt|#62);/g, val: \">\" },\n      // \"amp\" : { regex: /&(amp|#38);/g, val: \"&\" },\n      // \"quot\" : { regex: /&(quot|#34);/g, val: \"\\\"\" },\n      // \"apos\" : { regex: /&(apos|#39);/g, val: \"'\" },\n      \"cent\" : { regex: /&(cent|#162);/g, val: \"¢\" },\n      \"pound\" : { regex: /&(pound|#163);/g, val: \"£\" },\n      \"yen\" : { regex: /&(yen|#165);/g, val: \"¥\" },\n      \"euro\" : { regex: /&(euro|#8364);/g, val: \"€\" },\n      \"copyright\" : { regex: /&(copy|#169);/g, val: \"©\" },\n      \"reg\" : { regex: /&(reg|#174);/g, val: \"®\" },\n      \"inr\" : { regex: /&(inr|#8377);/g, val: \"₹\" },\n      \"num_dec\": { regex: /&#([0-9]{1,7});/g, val : (_, str) => String.fromCharCode(Number.parseInt(str, 10)) },\n      \"num_hex\": { regex: /&#x([0-9a-fA-F]{1,6});/g, val : (_, str) => String.fromCharCode(Number.parseInt(str, 16)) },\n    };\n    this.addExternalEntities = addExternalEntities;\n    this.parseXml = parseXml;\n    this.parseTextData = parseTextData;\n    this.resolveNameSpace = resolveNameSpace;\n    this.buildAttributesMap = buildAttributesMap;\n    this.isItStopNode = isItStopNode;\n    this.replaceEntitiesValue = replaceEntitiesValue;\n    this.readStopNodeData = readStopNodeData;\n    this.saveTextToParentTag = saveTextToParentTag;\n    this.addChild = addChild;\n    this.ignoreAttributesFn = getIgnoreAttributesFn(this.options.ignoreAttributes)\n  }\n\n}\n\nfunction addExternalEntities(externalEntities){\n  const entKeys = Object.keys(externalEntities);\n  for (let i = 0; i < entKeys.length; i++) {\n    const ent = entKeys[i];\n    this.lastEntities[ent] = {\n       regex: new RegExp(\"&\"+ent+\";\",\"g\"),\n       val : externalEntities[ent]\n    }\n  }\n}\n\n/**\n * @param {string} val\n * @param {string} tagName\n * @param {string} jPath\n * @param {boolean} dontTrim\n * @param {boolean} hasAttributes\n * @param {boolean} isLeafNode\n * @param {boolean} escapeEntities\n */\nfunction parseTextData(val, tagName, jPath, dontTrim, hasAttributes, isLeafNode, escapeEntities) {\n  if (val !== undefined) {\n    if (this.options.trimValues && !dontTrim) {\n      val = val.trim();\n    }\n    if(val.length > 0){\n      if(!escapeEntities) val = this.replaceEntitiesValue(val);\n      \n      const newval = this.options.tagValueProcessor(tagName, val, jPath, hasAttributes, isLeafNode);\n      if(newval === null || newval === undefined){\n        //don't parse\n        return val;\n      }else if(typeof newval !== typeof val || newval !== val){\n        //overwrite\n        return newval;\n      }else if(this.options.trimValues){\n        return parseValue(val, this.options.parseTagValue, this.options.numberParseOptions);\n      }else{\n        const trimmedVal = val.trim();\n        if(trimmedVal === val){\n          return parseValue(val, this.options.parseTagValue, this.options.numberParseOptions);\n        }else{\n          return val;\n        }\n      }\n    }\n  }\n}\n\nfunction resolveNameSpace(tagname) {\n  if (this.options.removeNSPrefix) {\n    const tags = tagname.split(':');\n    const prefix = tagname.charAt(0) === '/' ? '/' : '';\n    if (tags[0] === 'xmlns') {\n      return '';\n    }\n    if (tags.length === 2) {\n      tagname = prefix + tags[1];\n    }\n  }\n  return tagname;\n}\n\n//TODO: change regex to capture NS\n//const attrsRegx = new RegExp(\"([\\\\w\\\\-\\\\.\\\\:]+)\\\\s*=\\\\s*(['\\\"])((.|\\n)*?)\\\\2\",\"gm\");\nconst attrsRegx = new RegExp('([^\\\\s=]+)\\\\s*(=\\\\s*([\\'\"])([\\\\s\\\\S]*?)\\\\3)?', 'gm');\n\nfunction buildAttributesMap(attrStr, jPath, tagName) {\n  if (this.options.ignoreAttributes !== true && typeof attrStr === 'string') {\n    // attrStr = attrStr.replace(/\\r?\\n/g, ' ');\n    //attrStr = attrStr || attrStr.trim();\n\n    const matches = util.getAllMatches(attrStr, attrsRegx);\n    const len = matches.length; //don't make it inline\n    const attrs = {};\n    for (let i = 0; i < len; i++) {\n      const attrName = this.resolveNameSpace(matches[i][1]);\n      if (this.ignoreAttributesFn(attrName, jPath)) {\n        continue\n      }\n      let oldVal = matches[i][4];\n      let aName = this.options.attributeNamePrefix + attrName;\n      if (attrName.length) {\n        if (this.options.transformAttributeName) {\n          aName = this.options.transformAttributeName(aName);\n        }\n        if(aName === \"__proto__\") aName  = \"#__proto__\";\n        if (oldVal !== undefined) {\n          if (this.options.trimValues) {\n            oldVal = oldVal.trim();\n          }\n          oldVal = this.replaceEntitiesValue(oldVal);\n          const newVal = this.options.attributeValueProcessor(attrName, oldVal, jPath);\n          if(newVal === null || newVal === undefined){\n            //don't parse\n            attrs[aName] = oldVal;\n          }else if(typeof newVal !== typeof oldVal || newVal !== oldVal){\n            //overwrite\n            attrs[aName] = newVal;\n          }else{\n            //parse\n            attrs[aName] = parseValue(\n              oldVal,\n              this.options.parseAttributeValue,\n              this.options.numberParseOptions\n            );\n          }\n        } else if (this.options.allowBooleanAttributes) {\n          attrs[aName] = true;\n        }\n      }\n    }\n    if (!Object.keys(attrs).length) {\n      return;\n    }\n    if (this.options.attributesGroupName) {\n      const attrCollection = {};\n      attrCollection[this.options.attributesGroupName] = attrs;\n      return attrCollection;\n    }\n    return attrs\n  }\n}\n\nconst parseXml = function(xmlData) {\n  xmlData = xmlData.replace(/\\r\\n?/g, \"\\n\"); //TODO: remove this line\n  const xmlObj = new xmlNode('!xml');\n  let currentNode = xmlObj;\n  let textData = \"\";\n  let jPath = \"\";\n  for(let i=0; i< xmlData.length; i++){//for each char in XML data\n    const ch = xmlData[i];\n    if(ch === '<'){\n      // const nextIndex = i+1;\n      // const _2ndChar = xmlData[nextIndex];\n      if( xmlData[i+1] === '/') {//Closing Tag\n        const closeIndex = findClosingIndex(xmlData, \">\", i, \"Closing Tag is not closed.\")\n        let tagName = xmlData.substring(i+2,closeIndex).trim();\n\n        if(this.options.removeNSPrefix){\n          const colonIndex = tagName.indexOf(\":\");\n          if(colonIndex !== -1){\n            tagName = tagName.substr(colonIndex+1);\n          }\n        }\n\n        if(this.options.transformTagName) {\n          tagName = this.options.transformTagName(tagName);\n        }\n\n        if(currentNode){\n          textData = this.saveTextToParentTag(textData, currentNode, jPath);\n        }\n\n        //check if last tag of nested tag was unpaired tag\n        const lastTagName = jPath.substring(jPath.lastIndexOf(\".\")+1);\n        if(tagName && this.options.unpairedTags.indexOf(tagName) !== -1 ){\n          throw new Error(`Unpaired tag can not be used as closing tag: </${tagName}>`);\n        }\n        let propIndex = 0\n        if(lastTagName && this.options.unpairedTags.indexOf(lastTagName) !== -1 ){\n          propIndex = jPath.lastIndexOf('.', jPath.lastIndexOf('.')-1)\n          this.tagsNodeStack.pop();\n        }else{\n          propIndex = jPath.lastIndexOf(\".\");\n        }\n        jPath = jPath.substring(0, propIndex);\n\n        currentNode = this.tagsNodeStack.pop();//avoid recursion, set the parent tag scope\n        textData = \"\";\n        i = closeIndex;\n      } else if( xmlData[i+1] === '?') {\n\n        let tagData = readTagExp(xmlData,i, false, \"?>\");\n        if(!tagData) throw new Error(\"Pi Tag is not closed.\");\n\n        textData = this.saveTextToParentTag(textData, currentNode, jPath);\n        if( (this.options.ignoreDeclaration && tagData.tagName === \"?xml\") || this.options.ignorePiTags){\n\n        }else{\n  \n          const childNode = new xmlNode(tagData.tagName);\n          childNode.add(this.options.textNodeName, \"\");\n          \n          if(tagData.tagName !== tagData.tagExp && tagData.attrExpPresent){\n            childNode[\":@\"] = this.buildAttributesMap(tagData.tagExp, jPath, tagData.tagName);\n          }\n          this.addChild(currentNode, childNode, jPath)\n\n        }\n\n\n        i = tagData.closeIndex + 1;\n      } else if(xmlData.substr(i + 1, 3) === '!--') {\n        const endIndex = findClosingIndex(xmlData, \"-->\", i+4, \"Comment is not closed.\")\n        if(this.options.commentPropName){\n          const comment = xmlData.substring(i + 4, endIndex - 2);\n\n          textData = this.saveTextToParentTag(textData, currentNode, jPath);\n\n          currentNode.add(this.options.commentPropName, [ { [this.options.textNodeName] : comment } ]);\n        }\n        i = endIndex;\n      } else if( xmlData.substr(i + 1, 2) === '!D') {\n        const result = readDocType(xmlData, i);\n        this.docTypeEntities = result.entities;\n        i = result.i;\n      }else if(xmlData.substr(i + 1, 2) === '![') {\n        const closeIndex = findClosingIndex(xmlData, \"]]>\", i, \"CDATA is not closed.\") - 2;\n        const tagExp = xmlData.substring(i + 9,closeIndex);\n\n        textData = this.saveTextToParentTag(textData, currentNode, jPath);\n\n        let val = this.parseTextData(tagExp, currentNode.tagname, jPath, true, false, true, true);\n        if(val == undefined) val = \"\";\n\n        //cdata should be set even if it is 0 length string\n        if(this.options.cdataPropName){\n          currentNode.add(this.options.cdataPropName, [ { [this.options.textNodeName] : tagExp } ]);\n        }else{\n          currentNode.add(this.options.textNodeName, val);\n        }\n        \n        i = closeIndex + 2;\n      }else {//Opening tag\n        let result = readTagExp(xmlData,i, this.options.removeNSPrefix);\n        let tagName= result.tagName;\n        const rawTagName = result.rawTagName;\n        let tagExp = result.tagExp;\n        let attrExpPresent = result.attrExpPresent;\n        let closeIndex = result.closeIndex;\n\n        if (this.options.transformTagName) {\n          tagName = this.options.transformTagName(tagName);\n        }\n        \n        //save text as child node\n        if (currentNode && textData) {\n          if(currentNode.tagname !== '!xml'){\n            //when nested tag is found\n            textData = this.saveTextToParentTag(textData, currentNode, jPath, false);\n          }\n        }\n\n        //check if last tag was unpaired tag\n        const lastTag = currentNode;\n        if(lastTag && this.options.unpairedTags.indexOf(lastTag.tagname) !== -1 ){\n          currentNode = this.tagsNodeStack.pop();\n          jPath = jPath.substring(0, jPath.lastIndexOf(\".\"));\n        }\n        if(tagName !== xmlObj.tagname){\n          jPath += jPath ? \".\" + tagName : tagName;\n        }\n        if (this.isItStopNode(this.options.stopNodes, jPath, tagName)) {\n          let tagContent = \"\";\n          //self-closing tag\n          if(tagExp.length > 0 && tagExp.lastIndexOf(\"/\") === tagExp.length - 1){\n            if(tagName[tagName.length - 1] === \"/\"){ //remove trailing '/'\n              tagName = tagName.substr(0, tagName.length - 1);\n              jPath = jPath.substr(0, jPath.length - 1);\n              tagExp = tagName;\n            }else{\n              tagExp = tagExp.substr(0, tagExp.length - 1);\n            }\n            i = result.closeIndex;\n          }\n          //unpaired tag\n          else if(this.options.unpairedTags.indexOf(tagName) !== -1){\n            \n            i = result.closeIndex;\n          }\n          //normal tag\n          else{\n            //read until closing tag is found\n            const result = this.readStopNodeData(xmlData, rawTagName, closeIndex + 1);\n            if(!result) throw new Error(`Unexpected end of ${rawTagName}`);\n            i = result.i;\n            tagContent = result.tagContent;\n          }\n\n          const childNode = new xmlNode(tagName);\n          if(tagName !== tagExp && attrExpPresent){\n            childNode[\":@\"] = this.buildAttributesMap(tagExp, jPath, tagName);\n          }\n          if(tagContent) {\n            tagContent = this.parseTextData(tagContent, tagName, jPath, true, attrExpPresent, true, true);\n          }\n          \n          jPath = jPath.substr(0, jPath.lastIndexOf(\".\"));\n          childNode.add(this.options.textNodeName, tagContent);\n          \n          this.addChild(currentNode, childNode, jPath)\n        }else{\n  //selfClosing tag\n          if(tagExp.length > 0 && tagExp.lastIndexOf(\"/\") === tagExp.length - 1){\n            if(tagName[tagName.length - 1] === \"/\"){ //remove trailing '/'\n              tagName = tagName.substr(0, tagName.length - 1);\n              jPath = jPath.substr(0, jPath.length - 1);\n              tagExp = tagName;\n            }else{\n              tagExp = tagExp.substr(0, tagExp.length - 1);\n            }\n            \n            if(this.options.transformTagName) {\n              tagName = this.options.transformTagName(tagName);\n            }\n\n            const childNode = new xmlNode(tagName);\n            if(tagName !== tagExp && attrExpPresent){\n              childNode[\":@\"] = this.buildAttributesMap(tagExp, jPath, tagName);\n            }\n            this.addChild(currentNode, childNode, jPath)\n            jPath = jPath.substr(0, jPath.lastIndexOf(\".\"));\n          }\n    //opening tag\n          else{\n            const childNode = new xmlNode( tagName);\n            this.tagsNodeStack.push(currentNode);\n            \n            if(tagName !== tagExp && attrExpPresent){\n              childNode[\":@\"] = this.buildAttributesMap(tagExp, jPath, tagName);\n            }\n            this.addChild(currentNode, childNode, jPath)\n            currentNode = childNode;\n          }\n          textData = \"\";\n          i = closeIndex;\n        }\n      }\n    }else{\n      textData += xmlData[i];\n    }\n  }\n  return xmlObj.child;\n}\n\nfunction addChild(currentNode, childNode, jPath){\n  const result = this.options.updateTag(childNode.tagname, jPath, childNode[\":@\"])\n  if(result === false){\n  }else if(typeof result === \"string\"){\n    childNode.tagname = result\n    currentNode.addChild(childNode);\n  }else{\n    currentNode.addChild(childNode);\n  }\n}\n\nconst replaceEntitiesValue = function(val){\n\n  if(this.options.processEntities){\n    for(let entityName in this.docTypeEntities){\n      const entity = this.docTypeEntities[entityName];\n      val = val.replace( entity.regx, entity.val);\n    }\n    for(let entityName in this.lastEntities){\n      const entity = this.lastEntities[entityName];\n      val = val.replace( entity.regex, entity.val);\n    }\n    if(this.options.htmlEntities){\n      for(let entityName in this.htmlEntities){\n        const entity = this.htmlEntities[entityName];\n        val = val.replace( entity.regex, entity.val);\n      }\n    }\n    val = val.replace( this.ampEntity.regex, this.ampEntity.val);\n  }\n  return val;\n}\nfunction saveTextToParentTag(textData, currentNode, jPath, isLeafNode) {\n  if (textData) { //store previously collected data as textNode\n    if(isLeafNode === undefined) isLeafNode = Object.keys(currentNode.child).length === 0\n    \n    textData = this.parseTextData(textData,\n      currentNode.tagname,\n      jPath,\n      false,\n      currentNode[\":@\"] ? Object.keys(currentNode[\":@\"]).length !== 0 : false,\n      isLeafNode);\n\n    if (textData !== undefined && textData !== \"\")\n      currentNode.add(this.options.textNodeName, textData);\n    textData = \"\";\n  }\n  return textData;\n}\n\n//TODO: use jPath to simplify the logic\n/**\n * \n * @param {string[]} stopNodes \n * @param {string} jPath\n * @param {string} currentTagName \n */\nfunction isItStopNode(stopNodes, jPath, currentTagName){\n  const allNodesExp = \"*.\" + currentTagName;\n  for (const stopNodePath in stopNodes) {\n    const stopNodeExp = stopNodes[stopNodePath];\n    if( allNodesExp === stopNodeExp || jPath === stopNodeExp  ) return true;\n  }\n  return false;\n}\n\n/**\n * Returns the tag Expression and where it is ending handling single-double quotes situation\n * @param {string} xmlData \n * @param {number} i starting index\n * @returns \n */\nfunction tagExpWithClosingIndex(xmlData, i, closingChar = \">\"){\n  let attrBoundary;\n  let tagExp = \"\";\n  for (let index = i; index < xmlData.length; index++) {\n    let ch = xmlData[index];\n    if (attrBoundary) {\n        if (ch === attrBoundary) attrBoundary = \"\";//reset\n    } else if (ch === '\"' || ch === \"'\") {\n        attrBoundary = ch;\n    } else if (ch === closingChar[0]) {\n      if(closingChar[1]){\n        if(xmlData[index + 1] === closingChar[1]){\n          return {\n            data: tagExp,\n            index: index\n          }\n        }\n      }else{\n        return {\n          data: tagExp,\n          index: index\n        }\n      }\n    } else if (ch === '\\t') {\n      ch = \" \"\n    }\n    tagExp += ch;\n  }\n}\n\nfunction findClosingIndex(xmlData, str, i, errMsg){\n  const closingIndex = xmlData.indexOf(str, i);\n  if(closingIndex === -1){\n    throw new Error(errMsg)\n  }else{\n    return closingIndex + str.length - 1;\n  }\n}\n\nfunction readTagExp(xmlData,i, removeNSPrefix, closingChar = \">\"){\n  const result = tagExpWithClosingIndex(xmlData, i+1, closingChar);\n  if(!result) return;\n  let tagExp = result.data;\n  const closeIndex = result.index;\n  const separatorIndex = tagExp.search(/\\s/);\n  let tagName = tagExp;\n  let attrExpPresent = true;\n  if(separatorIndex !== -1){//separate tag name and attributes expression\n    tagName = tagExp.substring(0, separatorIndex);\n    tagExp = tagExp.substring(separatorIndex + 1).trimStart();\n  }\n\n  const rawTagName = tagName;\n  if(removeNSPrefix){\n    const colonIndex = tagName.indexOf(\":\");\n    if(colonIndex !== -1){\n      tagName = tagName.substr(colonIndex+1);\n      attrExpPresent = tagName !== result.data.substr(colonIndex + 1);\n    }\n  }\n\n  return {\n    tagName: tagName,\n    tagExp: tagExp,\n    closeIndex: closeIndex,\n    attrExpPresent: attrExpPresent,\n    rawTagName: rawTagName,\n  }\n}\n/**\n * find paired tag for a stop node\n * @param {string} xmlData \n * @param {string} tagName \n * @param {number} i \n */\nfunction readStopNodeData(xmlData, tagName, i){\n  const startIndex = i;\n  // Starting at 1 since we already have an open tag\n  let openTagCount = 1;\n\n  for (; i < xmlData.length; i++) {\n    if( xmlData[i] === \"<\"){ \n      if (xmlData[i+1] === \"/\") {//close tag\n          const closeIndex = findClosingIndex(xmlData, \">\", i, `${tagName} is not closed`);\n          let closeTagName = xmlData.substring(i+2,closeIndex).trim();\n          if(closeTagName === tagName){\n            openTagCount--;\n            if (openTagCount === 0) {\n              return {\n                tagContent: xmlData.substring(startIndex, i),\n                i : closeIndex\n              }\n            }\n          }\n          i=closeIndex;\n        } else if(xmlData[i+1] === '?') { \n          const closeIndex = findClosingIndex(xmlData, \"?>\", i+1, \"StopNode is not closed.\")\n          i=closeIndex;\n        } else if(xmlData.substr(i + 1, 3) === '!--') { \n          const closeIndex = findClosingIndex(xmlData, \"-->\", i+3, \"StopNode is not closed.\")\n          i=closeIndex;\n        } else if(xmlData.substr(i + 1, 2) === '![') { \n          const closeIndex = findClosingIndex(xmlData, \"]]>\", i, \"StopNode is not closed.\") - 2;\n          i=closeIndex;\n        } else {\n          const tagData = readTagExp(xmlData, i, '>')\n\n          if (tagData) {\n            const openTagName = tagData && tagData.tagName;\n            if (openTagName === tagName && tagData.tagExp[tagData.tagExp.length-1] !== \"/\") {\n              openTagCount++;\n            }\n            i=tagData.closeIndex;\n          }\n        }\n      }\n  }//end for loop\n}\n\nfunction parseValue(val, shouldParse, options) {\n  if (shouldParse && typeof val === 'string') {\n    //console.log(options)\n    const newval = val.trim();\n    if(newval === 'true' ) return true;\n    else if(newval === 'false' ) return false;\n    else return toNumber(val, options);\n  } else {\n    if (util.isExist(val)) {\n      return val;\n    } else {\n      return '';\n    }\n  }\n}\n\n\nmodule.exports = OrderedObjParser;\n","'use strict';\n\n/**\n * \n * @param {array} node \n * @param {any} options \n * @returns \n */\nfunction prettify(node, options){\n  return compress( node, options);\n}\n\n/**\n * \n * @param {array} arr \n * @param {object} options \n * @param {string} jPath \n * @returns object\n */\nfunction compress(arr, options, jPath){\n  let text;\n  const compressedObj = {};\n  for (let i = 0; i < arr.length; i++) {\n    const tagObj = arr[i];\n    const property = propName(tagObj);\n    let newJpath = \"\";\n    if(jPath === undefined) newJpath = property;\n    else newJpath = jPath + \".\" + property;\n\n    if(property === options.textNodeName){\n      if(text === undefined) text = tagObj[property];\n      else text += \"\" + tagObj[property];\n    }else if(property === undefined){\n      continue;\n    }else if(tagObj[property]){\n      \n      let val = compress(tagObj[property], options, newJpath);\n      const isLeaf = isLeafTag(val, options);\n\n      if(tagObj[\":@\"]){\n        assignAttributes( val, tagObj[\":@\"], newJpath, options);\n      }else if(Object.keys(val).length === 1 && val[options.textNodeName] !== undefined && !options.alwaysCreateTextNode){\n        val = val[options.textNodeName];\n      }else if(Object.keys(val).length === 0){\n        if(options.alwaysCreateTextNode) val[options.textNodeName] = \"\";\n        else val = \"\";\n      }\n\n      if(compressedObj[property] !== undefined && compressedObj.hasOwnProperty(property)) {\n        if(!Array.isArray(compressedObj[property])) {\n            compressedObj[property] = [ compressedObj[property] ];\n        }\n        compressedObj[property].push(val);\n      }else{\n        //TODO: if a node is not an array, then check if it should be an array\n        //also determine if it is a leaf node\n        if (options.isArray(property, newJpath, isLeaf )) {\n          compressedObj[property] = [val];\n        }else{\n          compressedObj[property] = val;\n        }\n      }\n    }\n    \n  }\n  // if(text && text.length > 0) compressedObj[options.textNodeName] = text;\n  if(typeof text === \"string\"){\n    if(text.length > 0) compressedObj[options.textNodeName] = text;\n  }else if(text !== undefined) compressedObj[options.textNodeName] = text;\n  return compressedObj;\n}\n\nfunction propName(obj){\n  const keys = Object.keys(obj);\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    if(key !== \":@\") return key;\n  }\n}\n\nfunction assignAttributes(obj, attrMap, jpath, options){\n  if (attrMap) {\n    const keys = Object.keys(attrMap);\n    const len = keys.length; //don't make it inline\n    for (let i = 0; i < len; i++) {\n      const atrrName = keys[i];\n      if (options.isArray(atrrName, jpath + \".\" + atrrName, true, true)) {\n        obj[atrrName] = [ attrMap[atrrName] ];\n      } else {\n        obj[atrrName] = attrMap[atrrName];\n      }\n    }\n  }\n}\n\nfunction isLeafTag(obj, options){\n  const { textNodeName } = options;\n  const propCount = Object.keys(obj).length;\n  \n  if (propCount === 0) {\n    return true;\n  }\n\n  if (\n    propCount === 1 &&\n    (obj[textNodeName] || typeof obj[textNodeName] === \"boolean\" || obj[textNodeName] === 0)\n  ) {\n    return true;\n  }\n\n  return false;\n}\nexports.prettify = prettify;\n","const { buildOptions} = require(\"./OptionsBuilder\");\nconst OrderedObjParser = require(\"./OrderedObjParser\");\nconst { prettify} = require(\"./node2json\");\nconst validator = require('../validator');\n\nclass XMLParser{\n    \n    constructor(options){\n        this.externalEntities = {};\n        this.options = buildOptions(options);\n        \n    }\n    /**\n     * Parse XML dats to JS object \n     * @param {string|Buffer} xmlData \n     * @param {boolean|Object} validationOption \n     */\n    parse(xmlData,validationOption){\n        if(typeof xmlData === \"string\"){\n        }else if( xmlData.toString){\n            xmlData = xmlData.toString();\n        }else{\n            throw new Error(\"XML data is accepted in String or Bytes[] form.\")\n        }\n        if( validationOption){\n            if(validationOption === true) validationOption = {}; //validate with default options\n            \n            const result = validator.validate(xmlData, validationOption);\n            if (result !== true) {\n              throw Error( `${result.err.msg}:${result.err.line}:${result.err.col}` )\n            }\n          }\n        const orderedObjParser = new OrderedObjParser(this.options);\n        orderedObjParser.addExternalEntities(this.externalEntities);\n        const orderedResult = orderedObjParser.parseXml(xmlData);\n        if(this.options.preserveOrder || orderedResult === undefined) return orderedResult;\n        else return prettify(orderedResult, this.options);\n    }\n\n    /**\n     * Add Entity which is not by default supported by this library\n     * @param {string} key \n     * @param {string} value \n     */\n    addEntity(key, value){\n        if(value.indexOf(\"&\") !== -1){\n            throw new Error(\"Entity value can't have '&'\")\n        }else if(key.indexOf(\"&\") !== -1 || key.indexOf(\";\") !== -1){\n            throw new Error(\"An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'\")\n        }else if(value === \"&\"){\n            throw new Error(\"An entity with value '&' is not permitted\");\n        }else{\n            this.externalEntities[key] = value;\n        }\n    }\n}\n\nmodule.exports = XMLParser;","const EOL = \"\\n\";\n\n/**\n * \n * @param {array} jArray \n * @param {any} options \n * @returns \n */\nfunction toXml(jArray, options) {\n    let indentation = \"\";\n    if (options.format && options.indentBy.length > 0) {\n        indentation = EOL;\n    }\n    return arrToStr(jArray, options, \"\", indentation);\n}\n\nfunction arrToStr(arr, options, jPath, indentation) {\n    let xmlStr = \"\";\n    let isPreviousElementTag = false;\n\n    for (let i = 0; i < arr.length; i++) {\n        const tagObj = arr[i];\n        const tagName = propName(tagObj);\n        if(tagName === undefined) continue;\n\n        let newJPath = \"\";\n        if (jPath.length === 0) newJPath = tagName\n        else newJPath = `${jPath}.${tagName}`;\n\n        if (tagName === options.textNodeName) {\n            let tagText = tagObj[tagName];\n            if (!isStopNode(newJPath, options)) {\n                tagText = options.tagValueProcessor(tagName, tagText);\n                tagText = replaceEntitiesValue(tagText, options);\n            }\n            if (isPreviousElementTag) {\n                xmlStr += indentation;\n            }\n            xmlStr += tagText;\n            isPreviousElementTag = false;\n            continue;\n        } else if (tagName === options.cdataPropName) {\n            if (isPreviousElementTag) {\n                xmlStr += indentation;\n            }\n            xmlStr += `<![CDATA[${tagObj[tagName][0][options.textNodeName]}]]>`;\n            isPreviousElementTag = false;\n            continue;\n        } else if (tagName === options.commentPropName) {\n            xmlStr += indentation + `<!--${tagObj[tagName][0][options.textNodeName]}-->`;\n            isPreviousElementTag = true;\n            continue;\n        } else if (tagName[0] === \"?\") {\n            const attStr = attr_to_str(tagObj[\":@\"], options);\n            const tempInd = tagName === \"?xml\" ? \"\" : indentation;\n            let piTextNodeName = tagObj[tagName][0][options.textNodeName];\n            piTextNodeName = piTextNodeName.length !== 0 ? \" \" + piTextNodeName : \"\"; //remove extra spacing\n            xmlStr += tempInd + `<${tagName}${piTextNodeName}${attStr}?>`;\n            isPreviousElementTag = true;\n            continue;\n        }\n        let newIdentation = indentation;\n        if (newIdentation !== \"\") {\n            newIdentation += options.indentBy;\n        }\n        const attStr = attr_to_str(tagObj[\":@\"], options);\n        const tagStart = indentation + `<${tagName}${attStr}`;\n        const tagValue = arrToStr(tagObj[tagName], options, newJPath, newIdentation);\n        if (options.unpairedTags.indexOf(tagName) !== -1) {\n            if (options.suppressUnpairedNode) xmlStr += tagStart + \">\";\n            else xmlStr += tagStart + \"/>\";\n        } else if ((!tagValue || tagValue.length === 0) && options.suppressEmptyNode) {\n            xmlStr += tagStart + \"/>\";\n        } else if (tagValue && tagValue.endsWith(\">\")) {\n            xmlStr += tagStart + `>${tagValue}${indentation}</${tagName}>`;\n        } else {\n            xmlStr += tagStart + \">\";\n            if (tagValue && indentation !== \"\" && (tagValue.includes(\"/>\") || tagValue.includes(\"</\"))) {\n                xmlStr += indentation + options.indentBy + tagValue + indentation;\n            } else {\n                xmlStr += tagValue;\n            }\n            xmlStr += `</${tagName}>`;\n        }\n        isPreviousElementTag = true;\n    }\n\n    return xmlStr;\n}\n\nfunction propName(obj) {\n    const keys = Object.keys(obj);\n    for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n        if(!obj.hasOwnProperty(key)) continue;\n        if (key !== \":@\") return key;\n    }\n}\n\nfunction attr_to_str(attrMap, options) {\n    let attrStr = \"\";\n    if (attrMap && !options.ignoreAttributes) {\n        for (let attr in attrMap) {\n            if(!attrMap.hasOwnProperty(attr)) continue;\n            let attrVal = options.attributeValueProcessor(attr, attrMap[attr]);\n            attrVal = replaceEntitiesValue(attrVal, options);\n            if (attrVal === true && options.suppressBooleanAttributes) {\n                attrStr += ` ${attr.substr(options.attributeNamePrefix.length)}`;\n            } else {\n                attrStr += ` ${attr.substr(options.attributeNamePrefix.length)}=\"${attrVal}\"`;\n            }\n        }\n    }\n    return attrStr;\n}\n\nfunction isStopNode(jPath, options) {\n    jPath = jPath.substr(0, jPath.length - options.textNodeName.length - 1);\n    let tagName = jPath.substr(jPath.lastIndexOf(\".\") + 1);\n    for (let index in options.stopNodes) {\n        if (options.stopNodes[index] === jPath || options.stopNodes[index] === \"*.\" + tagName) return true;\n    }\n    return false;\n}\n\nfunction replaceEntitiesValue(textValue, options) {\n    if (textValue && textValue.length > 0 && options.processEntities) {\n        for (let i = 0; i < options.entities.length; i++) {\n            const entity = options.entities[i];\n            textValue = textValue.replace(entity.regex, entity.val);\n        }\n    }\n    return textValue;\n}\nmodule.exports = toXml;\n","'use strict';\n//parse Empty Node as self closing node\nconst buildFromOrderedJs = require('./orderedJs2Xml');\nconst getIgnoreAttributesFn = require('../ignoreAttributes')\n\nconst defaultOptions = {\n  attributeNamePrefix: '@_',\n  attributesGroupName: false,\n  textNodeName: '#text',\n  ignoreAttributes: true,\n  cdataPropName: false,\n  format: false,\n  indentBy: '  ',\n  suppressEmptyNode: false,\n  suppressUnpairedNode: true,\n  suppressBooleanAttributes: true,\n  tagValueProcessor: function(key, a) {\n    return a;\n  },\n  attributeValueProcessor: function(attrName, a) {\n    return a;\n  },\n  preserveOrder: false,\n  commentPropName: false,\n  unpairedTags: [],\n  entities: [\n    { regex: new RegExp(\"&\", \"g\"), val: \"&amp;\" },//it must be on top\n    { regex: new RegExp(\">\", \"g\"), val: \"&gt;\" },\n    { regex: new RegExp(\"<\", \"g\"), val: \"&lt;\" },\n    { regex: new RegExp(\"\\'\", \"g\"), val: \"&apos;\" },\n    { regex: new RegExp(\"\\\"\", \"g\"), val: \"&quot;\" }\n  ],\n  processEntities: true,\n  stopNodes: [],\n  // transformTagName: false,\n  // transformAttributeName: false,\n  oneListGroup: false\n};\n\nfunction Builder(options) {\n  this.options = Object.assign({}, defaultOptions, options);\n  if (this.options.ignoreAttributes === true || this.options.attributesGroupName) {\n    this.isAttribute = function(/*a*/) {\n      return false;\n    };\n  } else {\n    this.ignoreAttributesFn = getIgnoreAttributesFn(this.options.ignoreAttributes)\n    this.attrPrefixLen = this.options.attributeNamePrefix.length;\n    this.isAttribute = isAttribute;\n  }\n\n  this.processTextOrObjNode = processTextOrObjNode\n\n  if (this.options.format) {\n    this.indentate = indentate;\n    this.tagEndChar = '>\\n';\n    this.newLine = '\\n';\n  } else {\n    this.indentate = function() {\n      return '';\n    };\n    this.tagEndChar = '>';\n    this.newLine = '';\n  }\n}\n\nBuilder.prototype.build = function(jObj) {\n  if(this.options.preserveOrder){\n    return buildFromOrderedJs(jObj, this.options);\n  }else {\n    if(Array.isArray(jObj) && this.options.arrayNodeName && this.options.arrayNodeName.length > 1){\n      jObj = {\n        [this.options.arrayNodeName] : jObj\n      }\n    }\n    return this.j2x(jObj, 0, []).val;\n  }\n};\n\nBuilder.prototype.j2x = function(jObj, level, ajPath) {\n  let attrStr = '';\n  let val = '';\n  const jPath = ajPath.join('.')\n  for (let key in jObj) {\n    if(!Object.prototype.hasOwnProperty.call(jObj, key)) continue;\n    if (typeof jObj[key] === 'undefined') {\n      // supress undefined node only if it is not an attribute\n      if (this.isAttribute(key)) {\n        val += '';\n      }\n    } else if (jObj[key] === null) {\n      // null attribute should be ignored by the attribute list, but should not cause the tag closing\n      if (this.isAttribute(key)) {\n        val += '';\n      } else if (key[0] === '?') {\n        val += this.indentate(level) + '<' + key + '?' + this.tagEndChar;\n      } else {\n        val += this.indentate(level) + '<' + key + '/' + this.tagEndChar;\n      }\n      // val += this.indentate(level) + '<' + key + '/' + this.tagEndChar;\n    } else if (jObj[key] instanceof Date) {\n      val += this.buildTextValNode(jObj[key], key, '', level);\n    } else if (typeof jObj[key] !== 'object') {\n      //premitive type\n      const attr = this.isAttribute(key);\n      if (attr && !this.ignoreAttributesFn(attr, jPath)) {\n        attrStr += this.buildAttrPairStr(attr, '' + jObj[key]);\n      } else if (!attr) {\n        //tag value\n        if (key === this.options.textNodeName) {\n          let newval = this.options.tagValueProcessor(key, '' + jObj[key]);\n          val += this.replaceEntitiesValue(newval);\n        } else {\n          val += this.buildTextValNode(jObj[key], key, '', level);\n        }\n      }\n    } else if (Array.isArray(jObj[key])) {\n      //repeated nodes\n      const arrLen = jObj[key].length;\n      let listTagVal = \"\";\n      let listTagAttr = \"\";\n      for (let j = 0; j < arrLen; j++) {\n        const item = jObj[key][j];\n        if (typeof item === 'undefined') {\n          // supress undefined node\n        } else if (item === null) {\n          if(key[0] === \"?\") val += this.indentate(level) + '<' + key + '?' + this.tagEndChar;\n          else val += this.indentate(level) + '<' + key + '/' + this.tagEndChar;\n          // val += this.indentate(level) + '<' + key + '/' + this.tagEndChar;\n        } else if (typeof item === 'object') {\n          if(this.options.oneListGroup){\n            const result = this.j2x(item, level + 1, ajPath.concat(key));\n            listTagVal += result.val;\n            if (this.options.attributesGroupName && item.hasOwnProperty(this.options.attributesGroupName)) {\n              listTagAttr += result.attrStr\n            }\n          }else{\n            listTagVal += this.processTextOrObjNode(item, key, level, ajPath)\n          }\n        } else {\n          if (this.options.oneListGroup) {\n            let textValue = this.options.tagValueProcessor(key, item);\n            textValue = this.replaceEntitiesValue(textValue);\n            listTagVal += textValue;\n          } else {\n            listTagVal += this.buildTextValNode(item, key, '', level);\n          }\n        }\n      }\n      if(this.options.oneListGroup){\n        listTagVal = this.buildObjectNode(listTagVal, key, listTagAttr, level);\n      }\n      val += listTagVal;\n    } else {\n      //nested node\n      if (this.options.attributesGroupName && key === this.options.attributesGroupName) {\n        const Ks = Object.keys(jObj[key]);\n        const L = Ks.length;\n        for (let j = 0; j < L; j++) {\n          attrStr += this.buildAttrPairStr(Ks[j], '' + jObj[key][Ks[j]]);\n        }\n      } else {\n        val += this.processTextOrObjNode(jObj[key], key, level, ajPath)\n      }\n    }\n  }\n  return {attrStr: attrStr, val: val};\n};\n\nBuilder.prototype.buildAttrPairStr = function(attrName, val){\n  val = this.options.attributeValueProcessor(attrName, '' + val);\n  val = this.replaceEntitiesValue(val);\n  if (this.options.suppressBooleanAttributes && val === \"true\") {\n    return ' ' + attrName;\n  } else return ' ' + attrName + '=\"' + val + '\"';\n}\n\nfunction processTextOrObjNode (object, key, level, ajPath) {\n  const result = this.j2x(object, level + 1, ajPath.concat(key));\n  if (object[this.options.textNodeName] !== undefined && Object.keys(object).length === 1) {\n    return this.buildTextValNode(object[this.options.textNodeName], key, result.attrStr, level);\n  } else {\n    return this.buildObjectNode(result.val, key, result.attrStr, level);\n  }\n}\n\nBuilder.prototype.buildObjectNode = function(val, key, attrStr, level) {\n  if(val === \"\"){\n    if(key[0] === \"?\") return  this.indentate(level) + '<' + key + attrStr+ '?' + this.tagEndChar;\n    else {\n      return this.indentate(level) + '<' + key + attrStr + this.closeTag(key) + this.tagEndChar;\n    }\n  }else{\n\n    let tagEndExp = '</' + key + this.tagEndChar;\n    let piClosingChar = \"\";\n    \n    if(key[0] === \"?\") {\n      piClosingChar = \"?\";\n      tagEndExp = \"\";\n    }\n  \n    // attrStr is an empty string in case the attribute came as undefined or null\n    if ((attrStr || attrStr === '') && val.indexOf('<') === -1) {\n      return ( this.indentate(level) + '<' +  key + attrStr + piClosingChar + '>' + val + tagEndExp );\n    } else if (this.options.commentPropName !== false && key === this.options.commentPropName && piClosingChar.length === 0) {\n      return this.indentate(level) + `<!--${val}-->` + this.newLine;\n    }else {\n      return (\n        this.indentate(level) + '<' + key + attrStr + piClosingChar + this.tagEndChar +\n        val +\n        this.indentate(level) + tagEndExp    );\n    }\n  }\n}\n\nBuilder.prototype.closeTag = function(key){\n  let closeTag = \"\";\n  if(this.options.unpairedTags.indexOf(key) !== -1){ //unpaired\n    if(!this.options.suppressUnpairedNode) closeTag = \"/\"\n  }else if(this.options.suppressEmptyNode){ //empty\n    closeTag = \"/\";\n  }else{\n    closeTag = `></${key}`\n  }\n  return closeTag;\n}\n\nfunction buildEmptyObjNode(val, key, attrStr, level) {\n  if (val !== '') {\n    return this.buildObjectNode(val, key, attrStr, level);\n  } else {\n    if(key[0] === \"?\") return  this.indentate(level) + '<' + key + attrStr+ '?' + this.tagEndChar;\n    else {\n      return  this.indentate(level) + '<' + key + attrStr + '/' + this.tagEndChar;\n      // return this.buildTagStr(level,key, attrStr);\n    }\n  }\n}\n\nBuilder.prototype.buildTextValNode = function(val, key, attrStr, level) {\n  if (this.options.cdataPropName !== false && key === this.options.cdataPropName) {\n    return this.indentate(level) + `<![CDATA[${val}]]>` +  this.newLine;\n  }else if (this.options.commentPropName !== false && key === this.options.commentPropName) {\n    return this.indentate(level) + `<!--${val}-->` +  this.newLine;\n  }else if(key[0] === \"?\") {//PI tag\n    return  this.indentate(level) + '<' + key + attrStr+ '?' + this.tagEndChar; \n  }else{\n    let textValue = this.options.tagValueProcessor(key, val);\n    textValue = this.replaceEntitiesValue(textValue);\n  \n    if( textValue === ''){\n      return this.indentate(level) + '<' + key + attrStr + this.closeTag(key) + this.tagEndChar;\n    }else{\n      return this.indentate(level) + '<' + key + attrStr + '>' +\n         textValue +\n        '</' + key + this.tagEndChar;\n    }\n  }\n}\n\nBuilder.prototype.replaceEntitiesValue = function(textValue){\n  if(textValue && textValue.length > 0 && this.options.processEntities){\n    for (let i=0; i<this.options.entities.length; i++) {\n      const entity = this.options.entities[i];\n      textValue = textValue.replace(entity.regex, entity.val);\n    }\n  }\n  return textValue;\n}\n\nfunction indentate(level) {\n  return this.options.indentBy.repeat(level);\n}\n\nfunction isAttribute(name /*, options*/) {\n  if (name.startsWith(this.options.attributeNamePrefix) && name !== this.options.textNodeName) {\n    return name.substr(this.attrPrefixLen);\n  } else {\n    return false;\n  }\n}\n\nmodule.exports = Builder;\n","'use strict';\n\nconst validator = require('./validator');\nconst XMLParser = require('./xmlparser/XMLParser');\nconst XMLBuilder = require('./xmlbuilder/json2xml');\n\nmodule.exports = {\n  XMLParser: XMLParser,\n  XMLValidator: validator,\n  XMLBuilder: XMLBuilder\n}","import { getRectOfPoints, Pen, Rect, s8 } from '@meta2d/core';\r\nimport { getRect, parseSvgPath } from '@meta2d/core/src/diagrams/svg/parse';\r\nimport { XMLParser } from 'fast-xml-parser/src/fxp';\r\n\r\nconst selfName = ':@';\r\n\r\nlet allRect: Rect;\r\nlet shapeScale: number; // 图形缩小比例\r\nlet anchorsArr = [];\r\n// globalThis.parseSvg = parseSvg; //  测试\r\nexport function parseSvg(svg: string): Pen[] {\r\n  const parser = new XMLParser({\r\n    ignoreAttributes: false,\r\n    attributeNamePrefix: '',\r\n    preserveOrder: true,\r\n  });\r\n\r\n  const xmlJson: any[] = parser.parse(svg);\r\n  const svgs = xmlJson.filter((item) => item.svg);\r\n  const pens: Pen[] = [];\r\n  anchorsArr = [];\r\n  svgs.forEach((svg) => {\r\n    const selfProperty = svg[selfName];\r\n    allRect = transformContainerRect(selfProperty);\r\n    const isWidthLitter = allRect.width < allRect.height; // 宽小于高\r\n    // 长边等于 40\r\n    if (!isWidthLitter) {\r\n      if (!selfProperty.width) {\r\n        selfProperty.width = 40;\r\n      }\r\n      shapeScale = selfProperty.width / allRect.width;\r\n      !selfProperty.height &&\r\n        (selfProperty.height = shapeScale * allRect.height);\r\n    } else {\r\n      // 高小于宽\r\n      if (!selfProperty.height) {\r\n        selfProperty.height = 40;\r\n      }\r\n      shapeScale = selfProperty.height / allRect.height;\r\n      !selfProperty.width && (selfProperty.width = shapeScale * allRect.width);\r\n    }\r\n\r\n    const children: any[] = svg.svg;\r\n    const replaceMap:any = {};// 暂时存储改动，避免对遍历产生影响\r\n    for(let i = 0; i < children.length; i++) {\r\n      if(children[i].g) {\r\n        replaceMap[i] = flatSvg(children[i]);\r\n      }\r\n    }\r\n    for(let i in replaceMap) {// 替换children中的对应数据\r\n      children.splice(Number(i),1,...replaceMap[i]);\r\n    }\r\n    const combinePens: Pen[] = transformCombines(selfProperty, children);\r\n\r\n    pens.push(...combinePens);\r\n  });\r\n  setAnchor(pens[0]);\r\n  return pens;\r\n}\r\nfunction flatSvg(children) {\r\n  if (children.g && children.g.length == 1 && children.g[0][selfName]){\r\n    const childKeys = Object.keys(children.g[0][selfName]);\r\n    if(childKeys.length == 2 && childKeys[0] == 'id' && childKeys[1] == 'data-name') {\r\n      return flatSvg(children.g[0]);\r\n    }\r\n  } \r\n  return children.g;\r\n}\r\nfunction setAnchor(pen: Pen) {\r\n  anchorsArr = anchorsArr.map((item, index) => {\r\n    return {\r\n      id: index + '',\r\n      penId: pen.id,\r\n      x: item.x,\r\n      y: item.y,\r\n    };\r\n  });\r\n  pen.anchors = anchorsArr;\r\n}\r\n\r\nfunction transformCombines(selfProperty, children: any[]): Pen[] {\r\n  const pens: Pen[] = [];\r\n  const [width, height] = dealUnit(selfProperty);\r\n  const combinePen: Pen = {\r\n    id: s8(),\r\n    name: 'combine',\r\n    x: selfProperty.x, // 最外层的 conbine 用不到该属性\r\n    y: selfProperty.y,\r\n    locked: selfProperty.locked,\r\n    width,\r\n    height,\r\n    children: [],\r\n  };\r\n  pens.push(combinePen);\r\n  children.forEach((child) => {\r\n    let pen: Pen | Pen[] = undefined;\r\n    const childProperty = child[selfName];\r\n    if (childProperty && childProperty.transform) {\r\n      child.g &&\r\n        child.g.forEach((item) => {\r\n          if (!item[selfName]) {\r\n            item[selfName] = {\r\n              transform: childProperty.transform,\r\n            };\r\n          } else {\r\n            item[selfName].transform = childProperty.transform;\r\n          }\r\n        });\r\n    }\r\n    if (child.g) {\r\n      // g 类型\r\n      pen = transformCombines(\r\n        {\r\n          // TODO: g 暂时认为是与父元素一样大\r\n          x: 0,\r\n          y: 0,\r\n          width: 1,\r\n          height: 1,\r\n          locked: 10, // 内层的 combine locked 10\r\n          ...childProperty,\r\n        },\r\n        child.g\r\n      );\r\n    } else if (child.defs) {\r\n      setStyle(child.defs.filter((item) => item.style));\r\n      setLinearGradient(child.defs.filter((item) => item.linearGradient));\r\n    } else if (child.style) {\r\n      setStyle([{ style: child.style }]);\r\n    } else if (childProperty) {\r\n      pen = transformNormalShape(childProperty, selfProperty, combinePen.id);\r\n      if (child.path) {\r\n        // path 类型\r\n        pen = transformPath(childProperty, pen);\r\n      } else if (child.rect) {\r\n        // rect 类型\r\n        pen = transformRect(childProperty, pen);\r\n        const rectangle: Pen = pen;\r\n        //获取圆上右下左坐标\r\n        let circleAnchors = [\r\n          {\r\n            x: rectangle.x + rectangle.width * 0.5,\r\n            y: rectangle.y,\r\n          },\r\n          {\r\n            x: rectangle.x + rectangle.width * 1,\r\n            y: rectangle.y + rectangle.height * 0.5,\r\n          },\r\n          {\r\n            x: rectangle.x + rectangle.width * 0.5,\r\n            y: rectangle.y + rectangle.height * 1,\r\n          },\r\n          {\r\n            x: rectangle.x,\r\n            y: rectangle.y + rectangle.height * 0.5,\r\n          },\r\n        ];\r\n        circleAnchors.forEach((item) => {\r\n          if (\r\n            item.x <= 0.01 ||\r\n            item.x >= 0.99 ||\r\n            item.y <= 0.01 ||\r\n            item.y >= 0.99\r\n          ) {\r\n            anchorsArr.push(item);\r\n          }\r\n        });\r\n      } else if (child.circle) {\r\n        // circle 类型\r\n        pen = transformCircle(childProperty, pen);\r\n        const circle: Pen = pen;\r\n        //获取圆上右下左坐标\r\n        let circleAnchors = [\r\n          {\r\n            x: circle.x + circle.width * 0.5,\r\n            y: circle.y,\r\n          },\r\n          {\r\n            x: circle.x + circle.width * 1,\r\n            y: circle.y + circle.height * 0.5,\r\n          },\r\n          {\r\n            x: circle.x + circle.width * 0.5,\r\n            y: circle.y + circle.height * 1,\r\n          },\r\n          {\r\n            x: circle.x,\r\n            y: circle.y + circle.height * 0.5,\r\n          },\r\n        ];\r\n        circleAnchors.forEach((item) => {\r\n          if (\r\n            item.x <= 0.01 ||\r\n            item.x >= 0.99 ||\r\n            item.y <= 0.01 ||\r\n            item.y >= 0.99\r\n          ) {\r\n            anchorsArr.push(item);\r\n          }\r\n        });\r\n      } else if (child.ellipse) {\r\n        // ellipse 类型\r\n        pen = transformCircle(childProperty, pen);\r\n      } else if (child.line) {\r\n        // line 类型\r\n        pen = transformLine(childProperty, pen);\r\n        const line: Pen = pen;\r\n        line.anchors.forEach((item) => {\r\n          const x = line.x + item.x * line.width;\r\n          const y = line.y + item.y * line.height;\r\n          if (x < 0.01 || x > 0.99 || y < 0.01 || y > 0.99) {\r\n            //TODO 连线太多的问题\r\n            anchorsArr.push({\r\n              x,\r\n              y,\r\n            });\r\n          }\r\n        });\r\n      } else if (child.polygon) {\r\n        // polygon 类型\r\n        pen = transformPolygon(childProperty, pen);\r\n      } else if (child.polyline) {\r\n        // polyline 类型\r\n        pen = transformPolyline(childProperty, pen);\r\n        const polyline: Pen = pen;\r\n        polyline.anchors.forEach((item) => {\r\n          const x = polyline.x + item.x * polyline.width;\r\n          const y = polyline.y + item.y * polyline.height;\r\n          if (x < 0.01 || x > 0.99 || y < 0.01 || y > 0.99) {\r\n            anchorsArr.push({\r\n              x,\r\n              y,\r\n            });\r\n          }\r\n        });\r\n      } else if (child.text) {\r\n        // text 类型\r\n        pen = transformText(childProperty, child.text, pen);\r\n      } else if (child.image) {\r\n        // image 类型\r\n        pen = transformImage(childProperty, pen);\r\n        // TODO: use 类型节点暂不考虑\r\n      } else {\r\n        pen = undefined;\r\n      }\r\n    }\r\n    if (pen) {\r\n      // 此处 pen 在 g 的 情况下可能是个数组\r\n      if (Array.isArray(pen)) {\r\n        for (const iPen of pen) {\r\n          if (!iPen.parentId) {\r\n            iPen.parentId = combinePen.id;\r\n            combinePen.children.push(iPen.id);\r\n          }\r\n        }\r\n        pens.push(...pen);\r\n      } else {\r\n        combinePen.children.push(pen.id);\r\n        pens.push(pen);\r\n      }\r\n    }\r\n  });\r\n  return pens;\r\n}\r\n\r\nfunction getTranslate(transform: string) {\r\n  let offsetX = 0;\r\n  let offsetY = 0;\r\n  if (transform) {\r\n    let matchArr = transform\r\n      .replace('translate(', '')\r\n      .replace(')', '')\r\n      .split(',');\r\n    offsetX = parseFloat(matchArr[0]);\r\n    offsetY = parseFloat(matchArr[1]);\r\n  }\r\n  return {\r\n    offsetX,\r\n    offsetY,\r\n  };\r\n}\r\nfunction transformPath(path: any, pen: any): any {\r\n  let d = path.d;\r\n  if (!d) {\r\n    return;\r\n  }\r\n  let commands = parseSvgPath(d);\r\n  let rect = getRect(commands);\r\n  let { offsetX, offsetY } = getTranslate(path.transform);\r\n  rect.x += offsetX;\r\n  rect.ex += offsetX;\r\n  rect.y += offsetY;\r\n  rect.ey += offsetY;\r\n  const x = (rect.x + pen.x - allRect.x) / allRect.width;\r\n  const y = (rect.y + pen.y - allRect.y) / allRect.height;\r\n  const width =\r\n    rect.width / allRect.width <= 1 ? rect.width / allRect.width : 1;\r\n  const height =\r\n    rect.height / allRect.height <= 1 ? rect.height / allRect.height : 1;\r\n\r\n  const pathPen = {\r\n    ...pen,\r\n    name: 'svgPath',\r\n    pathId: s8(), // 同样的 pathId ，避免重复存储 path\r\n    path: d,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    disableAnchor: true,\r\n  };\r\n\r\n  return pathPen;\r\n}\r\n\r\nfunction transformRect(rect: any, pen: any): any {\r\n  const x = (rect.x || 0 - allRect.x + pen.x) / allRect.width;\r\n  const y = (rect.y || 0 - allRect.y + pen.y) / allRect.height;\r\n  const width =\r\n    rect.width / allRect.width <= 1 ? rect.width / allRect.width : 1;\r\n  const height =\r\n    rect.height / allRect.height <= 1 ? rect.height / allRect.height : 1;\r\n  const borderRadius = rect.rx / rect.width || rect.ry / rect.height || 0;\r\n  const rectPen = {\r\n    ...pen,\r\n    name: 'rectangle',\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    borderRadius,\r\n  };\r\n  return rectPen;\r\n}\r\n\r\n/**\r\n * 转换圆形或者椭圆标签成为 circle\r\n * @param circle 圆形或者椭圆\r\n * @returns\r\n */\r\nfunction transformCircle(circle: any, pen: any): any {\r\n  const rx = circle.rx || circle.r;\r\n  const ry = circle.ry || circle.r;\r\n  const x = (circle.cx - rx - allRect.x + pen.x) / allRect.width;\r\n  const y = (circle.cy - ry - allRect.y + pen.y) / allRect.height;\r\n  const width = (2 * rx) / allRect.width;\r\n  const height = (2 * ry) / allRect.height;\r\n  return {\r\n    ...pen,\r\n    name: 'circle',\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n  };\r\n}\r\n\r\nfunction transformContainerRect(mySelf: any): Rect {\r\n  if (mySelf.viewBox) {\r\n    const viewBox = mySelf.viewBox.split(' ');\r\n    return {\r\n      x: Number(viewBox[0]),\r\n      y: Number(viewBox[1]),\r\n      width: Number(viewBox[2]),\r\n      height: Number(viewBox[3]),\r\n    };\r\n  } else {\r\n    return {\r\n      x: 0,\r\n      y: 0,\r\n      width: parseFloat(mySelf.width),\r\n      height: parseFloat(mySelf.height),\r\n    };\r\n  }\r\n}\r\nfunction transformNormalShape(\r\n  childProperty: any,\r\n  parentProperty,\r\n  parentId: string\r\n): any {\r\n  // style > class > self\r\n  const childClassJs = getClassStyle(childProperty.class);\r\n  const parentClassJs = getClassStyle(parentProperty.class);\r\n  // childProperty 的优先级更高\r\n  // style 的优先级更高\r\n  const chileStyleJs = styleToJson(childProperty.style);\r\n  const parentStyleJs = styleToJson(parentProperty.style);\r\n\r\n  const finalProperty = {\r\n    ...parentProperty,\r\n    ...parentClassJs,\r\n    ...parentStyleJs,\r\n    ...childProperty,\r\n    ...childClassJs,\r\n    ...chileStyleJs,\r\n  };\r\n\r\n  let background;\r\n  if (finalProperty.fill === 'none') {\r\n  } else if (finalProperty.fill?.includes('url')) {\r\n    const id: string = finalProperty.fill.replace('url(#', '').replace(')', '');\r\n    let gradientColor = linearGradient.find((item) => item.id === id);\r\n    if (gradientColor && !gradientColor.color) {\r\n      // 颜色不存在，则查找父级\r\n      gradientColor = linearGradient.find(\r\n        (item) => gradientColor.from === `#${item.id}`\r\n      );\r\n    }\r\n    background = gradientColor?.color;\r\n  } else {\r\n    background = finalProperty.fill;\r\n    // fill 属性不是 none ，是 undefined ，用默认黑色\r\n    !background && (background = '#000');\r\n  }\r\n\r\n  let x = 0,\r\n    y = 0;\r\n  let rotate = 0;\r\n  let matrix = null;\r\n  if (finalProperty.transform) {\r\n    const transforms = finalProperty.transform.split(') ');\r\n    transforms.forEach((transform: string) => {\r\n      const [type, value] = transform.split('(');\r\n      const [offsetX, offsetY] = value.split(' ');\r\n      if (type === 'translate') {\r\n        // 平移\r\n        x = Number(offsetX) || 0;\r\n        y = Number(offsetY) || 0;\r\n      } else if (type === 'rotate') {\r\n        // TODO: transform 中的 rotate 圆心与 meta2d.js 圆心不一致，处理过程中默认把 translate 干掉\r\n        // 旋转\r\n        rotate = parseFloat(value);\r\n        x = 0;\r\n        y = 0;\r\n      } else if (type === 'matrix') {\r\n        // 矩阵变换\r\n        // TODO: 是否有 , 分隔的？如果有 ，getTranslate 的代码是否重复了？直接挂到这个里面？\r\n        matrix = value.split(' ').map((item) => parseFloat(item));\r\n      }\r\n    });\r\n  }\r\n\r\n  return {\r\n    id: s8(),\r\n    locked: 10,\r\n    parentId,\r\n    x,\r\n    y,\r\n    rotate,\r\n    // TODO: background 可以为空\r\n    background: background,\r\n    color: finalProperty.stroke,\r\n    lineWidth: finalProperty['stroke-width']\r\n      ? parseFloat(finalProperty['stroke-width']) * shapeScale\r\n      : finalProperty.stroke\r\n      ? 1\r\n      : 0,\r\n    lineCap: finalProperty.strokeLinecap,\r\n    lineJoin: finalProperty.strokeLinejoin,\r\n    lineDash: finalProperty.strokeDasharray, // TODO: 可能不是数组类型\r\n    lineDashOffset: finalProperty.strokeDashoffset,\r\n    // strokeMiterlimit: path.strokeMiterlimit,\r\n    globalAlpha: Number(finalProperty.opacity),\r\n    // transform: path.transform,\r\n    fontSize: finalProperty['font-size']\r\n      ? parseFloat(finalProperty['font-size']) * shapeScale\r\n      : 16,\r\n    fontFamily: finalProperty['font-family'],\r\n    fontWeight: finalProperty['font-weight'],\r\n    fontStyle: finalProperty['font-style'],\r\n    matrix,\r\n  };\r\n}\r\n\r\n/**\r\n * 由于 points 存在 不使用 , 分割的特例（全部使用 ' '）\r\n * @param points 字符串 points\r\n * @returns\r\n */\r\nfunction polygonPointsToXY(points: string) {\r\n  const _points = points.replace(/[\\'\\\"\\\\\\/\\b\\f\\n\\r\\t]/g, '');\r\n  const pointsArr = _points.split(/\\s|,/);\r\n  const resPoints = [];\r\n  pointsArr.forEach((item: string, index: number) => {\r\n    if (index % 2 === 0) {\r\n      resPoints.push({\r\n        x: Number(item),\r\n        y: Number(pointsArr[index + 1]),\r\n      });\r\n    }\r\n  });\r\n  return resPoints;\r\n}\r\n\r\nfunction transformPolygon(childProperty: any, pen: any): any {\r\n  const pointsStr = childProperty.points;\r\n\r\n  const points = polygonPointsToXY(pointsStr);\r\n\r\n  const rect = getRectOfPoints(points);\r\n  const anchors = points.map((point) => {\r\n    return {\r\n      x: (point.x - rect.x) / rect.width,\r\n      y: (point.y - rect.y) / rect.height,\r\n      id: s8(),\r\n    };\r\n  });\r\n\r\n  return {\r\n    ...pen,\r\n    name: 'line',\r\n    lineName: 'line',\r\n    type: 0,\r\n    close: true,\r\n    anchors,\r\n    x: (rect.x - allRect.x + pen.x) / allRect.width,\r\n    y: (rect.y - allRect.y + pen.y) / allRect.height,\r\n    width: rect.width / allRect.width,\r\n    height: rect.height / allRect.height,\r\n  };\r\n}\r\n\r\n/**\r\n * 根据矩阵计算点的坐标\r\n */\r\nfunction calcPointByMatrix(point: { x: number; y: number }, matrix: number[]) {\r\n  const [a, b, c, d, e, f] = matrix;\r\n  const oldX = point.x;\r\n  const oldY = point.y;\r\n\r\n  const x = a * oldX + c * oldY + e;\r\n  const y = b * oldX + d * oldY + f;\r\n\r\n  return [x, y];\r\n}\r\n\r\nfunction transformLine(childProperty: any, pen: any) {\r\n  let x1 = Number(childProperty.x1) || 0;\r\n  let x2 = Number(childProperty.x2) || 0;\r\n  let y1 = Number(childProperty.y1) || 0;\r\n  let y2 = Number(childProperty.y2) || 0;\r\n\r\n  if (Array.isArray(pen.matrix)) {\r\n    [x1, y1] = calcPointByMatrix({ x: x1, y: y1 }, pen.matrix);\r\n    [x2, y2] = calcPointByMatrix({ x: x2, y: y2 }, pen.matrix);\r\n  }\r\n\r\n  const minX = Math.min(x1, x2);\r\n  const maxX = Math.max(x1, x2);\r\n  const minY = Math.min(y1, y2);\r\n  const maxY = Math.max(y1, y2);\r\n\r\n  const x = (minX - allRect.x + pen.x) / allRect.width;\r\n  const y = (minY - allRect.y + pen.y) / allRect.height;\r\n  const width = (maxX - minX) / allRect.width;\r\n  const height = (maxY - minY) / allRect.height;\r\n\r\n  return {\r\n    ...pen,\r\n    name: 'line',\r\n    lineName: 'line',\r\n    type: 0,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    anchors: [\r\n      {\r\n        x: x1 < x2 ? 0 : 1,\r\n        y: y1 < y2 ? 0 : 1,\r\n        hidden: true,\r\n        id: s8(),\r\n      },\r\n      {\r\n        x: x1 < x2 ? 1 : 0,\r\n        y: y1 < y2 ? 1 : 0,\r\n        hidden: true,\r\n        id: s8(),\r\n      },\r\n    ],\r\n  };\r\n}\r\n\r\nfunction transformPolyline(childProperty: any, pen: any) {\r\n  // 多段直线\r\n  const polyline = transformPolygon(childProperty, pen);\r\n  return Object.assign(polyline, {\r\n    close: false,\r\n    type: 1,\r\n    anchors: polyline.anchors.map((anchor) => {\r\n      anchor.hidden = true;\r\n      return anchor;\r\n    }),\r\n  });\r\n}\r\n\r\nfunction transformText(childProperty, textContent, pen: any) {\r\n  // 文字\r\n  const text = textContent[0]?.[contentProp];\r\n  const width = measureText(text, pen);\r\n  const height = 0; // pen.fontSize / shapeScale;\r\n  //TODO 这里为什么需要减去height\r\n  let { offsetX, offsetY } = getTranslate(childProperty.transform);\r\n  return {\r\n    ...pen,\r\n    name: 'text',\r\n    textAlign: 'left',\r\n    text,\r\n    x:\r\n      (parseFloat(childProperty.x) + (offsetX || 0) - allRect.x + pen.x) /\r\n      allRect.width,\r\n    y:\r\n      (parseFloat(childProperty.y) +\r\n        (offsetY || 0) -\r\n        allRect.y +\r\n        pen.y -\r\n        height) /\r\n      allRect.height,\r\n    width: width / allRect.width,\r\n    height: height / allRect.height,\r\n  };\r\n}\r\n\r\nfunction transformImage(childProperty, pen: any) {\r\n  const { x, y, width, height } = childProperty;\r\n  return {\r\n    ...pen,\r\n    name: 'image',\r\n    x: (x - allRect.x + pen.x) / allRect.width,\r\n    y: (y - allRect.y + pen.y) / allRect.height,\r\n    width: width / allRect.width,\r\n    height: height / allRect.height,\r\n    image: childProperty['xlink:href'],\r\n  };\r\n}\r\n\r\n// TODO: 粗糙计算文字宽度\r\nfunction measureText(text: string, pen: any) {\r\n  const fontSize = pen.fontSize || 16;\r\n  return (fontSize / shapeScale) * String(text).length;\r\n}\r\n\r\nfunction styleToJson(style?: string) {\r\n  if (!style) {\r\n    return {};\r\n  }\r\n  const styleArr = style.split(';');\r\n  const json = {};\r\n  styleArr.forEach((item) => {\r\n    const [key, value] = item.split(':');\r\n    key && (json[key] = value);\r\n  });\r\n  return json;\r\n}\r\n\r\nconst contentProp = '#text';\r\nlet style = undefined;\r\nfunction setStyle(defs: any[]) {\r\n  defs.forEach((def) => {\r\n    if (def.style && def.style[0]) {\r\n      // TODO: 暂时只支持一个 style 的情况\r\n      style = cssToJson(def.style[0][contentProp]);\r\n    }\r\n  });\r\n}\r\n\r\n// TODO: 渐变中目前只存储一个颜色 渐变\r\nlet linearGradient: Gradient[] = [];\r\n\r\ninterface Gradient {\r\n  id: string; // 当前的 id 值\r\n  from: string; // 该渐变来自于哪个渐变 即 xlink:href 属性， 比 id 多一个 #\r\n  color: string; // 颜色，from 存在时，该值应该不存在\r\n}\r\nfunction setLinearGradient(defs: any[]) {\r\n  // 此处的 defs 数组是只包含 linearGradient 属性的\r\n  defs.forEach((def) => {\r\n    if (def.linearGradient) {\r\n      const linearGradientItem: Gradient = {\r\n        id: def[selfName].id,\r\n        from: def[selfName]['xlink:href'],\r\n        color: undefined,\r\n      };\r\n      if (def.linearGradient.length > 0) {\r\n        linearGradientItem.color =\r\n          def.linearGradient[0][selfName]['stop-color'];\r\n      }\r\n      linearGradient.push(linearGradientItem);\r\n    }\r\n  });\r\n}\r\n\r\nfunction cssToJson(text: string) {\r\n  const json = {};\r\n  const styleArr = text.split('}');\r\n  styleArr.forEach((item) => {\r\n    const [key, value] = item.split('{');\r\n    key && (json[key.trim()] = styleToJson(value));\r\n  });\r\n  return json;\r\n}\r\n\r\nfunction getClassStyle(className: string) {\r\n  const classStyle = {};\r\n  for (const key in style) {\r\n    if (Object.prototype.hasOwnProperty.call(style, key)) {\r\n      const value = style[key];\r\n      if (\r\n        key === '.' + className ||\r\n        key.includes('.' + className + ',') ||\r\n        key.includes(',.' + className)\r\n      ) {\r\n        Object.assign(classStyle, value);\r\n      }\r\n    }\r\n  }\r\n  return classStyle;\r\n}\r\n/**\r\n * 处理单位，目前只考虑到 in 英寸 ，其它的返回原值\r\n * @param selfProperty 当前元素的属性\r\n * @returns\r\n */\r\nfunction dealUnit(selfProperty: any): [number, number] {\r\n  if (String(selfProperty.width)?.endsWith('in')) {\r\n    // 英寸\r\n    const width = parseFloat(selfProperty.width) * 96;\r\n    const height = parseFloat(selfProperty.height) * 96;\r\n    return [width, height];\r\n  }\r\n  const width = parseFloat(selfProperty.width) || 0;\r\n  const height = parseFloat(selfProperty.height) || 0;\r\n  return [width, height];\r\n}\r\n","import { parseSvg } from '@meta2d/svg';\r\nimport { deepClone } from '@meta2d/core';\r\n\r\nexport function parseSvgStr(svgString: string, penConfig: any, manual = true) {\r\n  if (!svgString) return [];\r\n  // 若是文件，可通过 ajax 请求得到字符串\r\n  // 得到一个组合后的 combine 画笔们，但父节点未拥有 x, y\r\n  const pens = parseSvg(svgString);\r\n  pens.forEach((pen) => {\r\n    if (!pen.x) {\r\n      pen.x = 0;\r\n    }\r\n    if (!pen.y) {\r\n      pen.y = 0;\r\n    }\r\n    // 处理svg数据父节点\r\n    if (pen.name == 'combine' && !pen.parentId) {\r\n      pen.description = penConfig?.name;\r\n      if (penConfig?.data?.anchors && manual) {\r\n        penConfig.data.anchors.forEach((anchor) => {\r\n          //! 报错\r\n          // meta2d.addAnchor(pen, anchor);\r\n          if (pen.anchors) {\r\n            const newId = pen.anchors.length;\r\n            anchor.id = newId;\r\n            pen.anchors.push(anchor);\r\n          } else {\r\n            pen.anchors = [anchor]\r\n          }\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  //console.log('svg to pens: ', pens, penConfig);\r\n  // 可使用 dragStart or meta2d.canvas.addCaches\r\n  if (manual) {\r\n    meta2d.canvas.addCaches = deepClone(pens);\r\n  }\r\n  return pens;\r\n}\r\n// 处理导入svg的数据\r\nexport function parseSvgStr1(svgString: string, penConfig: any, manual = true) {\r\n  if (!svgString) return [];\r\n  // 若是文件，可通过 ajax 请求得到字符串\r\n  // 得到一个组合后的 combine 画笔们，但父节点未拥有 x, y\r\n  \r\n  const pens = parseSvg(svgString);\r\n  console.log('传入的SVG===== ', pens, '以前的图元数据=====',penConfig);\r\n  // 拿到之前的图元父节点进行组装吧\r\n  const parent = pens.find(\r\n    (v) => v.name == 'combine' && !v.parentId,\r\n  );\r\n  Object.assign(parent, {\r\n    id:penConfig?.id,\r\n    x: penConfig?.x,\r\n    y: penConfig?.y,\r\n    description: penConfig?.description,\r\n    text: penConfig?.text,\r\n    withh: penConfig?.width,\r\n    height: penConfig?.height,\r\n    showChild: penConfig?.showChild,\r\n    //rotate: rotateAngelMap[item.rotateAngel] || 0, // 跟预期不一致\r\n    tags: penConfig?.tags,\r\n  });\r\n  //处理子节点数据\r\n  pens.forEach((pen) => {\r\n    if(pen.name !=='combine'){\r\n      pen.parentId = penConfig?.id;\r\n    }\r\n    // if (pen.anchors?.length > 0) {\r\n    //   parent.anchors = pen.anchors;\r\n    // }\r\n  });\r\n\r\n  //console.log('svg to pens: ', pens, penConfig);\r\n  // 可使用 dragStart or meta2d.canvas.addCaches\r\n  console.log('重新组装的图元数据=====' , pens, '以前的图元数据=====',penConfig);\r\n  \r\n  if (manual) {\r\n    meta2d.canvas.addCaches = deepClone(pens);\r\n  }\r\n  return pens;\r\n}\r\nexport const loadSvg = (svgUrl: string, penConfig: any, manual = true) => {\r\n  return fetch(svgUrl).then((res) => {\r\n    const text = res.text();\r\n    // 解析 svg 文本\r\n    return text.then((svgString) => {\r\n      // console.log(\"parseSvgStr: \", svgString);\r\n      return parseSvgStr(svgString, penConfig, manual);\r\n    });\r\n  });\r\n};\r\n","import ConfigList from './electric-config.json';\r\nimport { Pen, deepClone, s8 } from '@meta2d/core';\r\nimport { electricSvgList } from './svgConfigList.ts';\r\nimport { loadSvg } from './svgParser.ts';\r\nimport SwitchCombinesData from './switch-combines.json';\r\n\r\n// 旋转角度映射表\r\nconst rotateAngelMap: {\r\n  [key: string]: number;\r\n} = {\r\n  0: 0,\r\n  1: 90,\r\n  2: 180,\r\n  3: 270,\r\n};\r\n\r\n// 非对称元件列表\r\nconst asymmetries = [\r\n  'Vdc',\r\n  'MultipleContact',\r\n  'Coil',\r\n  'Lamp',\r\n  'Diode',\r\n  'TerminalsXT',\r\n  'CoilOnDelay',\r\n  'R',\r\n  'VProbe',\r\n  'IProbe',\r\n  'CoilOffDelay',\r\n  'CoilOnDelay',\r\n  'DoubleCoil',\r\n  'TransformerNew',\r\n];\r\n\r\n// 初始位置在右边的图形列表\r\nconst sideRightShapes = [\r\n  'Btn_SelfReset',\r\n  'Btn_SelfLock',\r\n  'Knob_SelfReset',\r\n  'Knob_SelfLock',\r\n];\r\n\r\n/**\r\n * 修正元件位置\r\n * @param pen 画笔对象\r\n * @param config 配置信息\r\n * @param item 元件项\r\n */\r\nfunction patchPosition(pen: Pen, config: any, item: any) {\r\n  let rotate = rotateAngelMap[item.rotateAngel] || 0;\r\n  // 特殊处理，和电路编辑器默认角度保持一致\r\n  if (['Switch', 'MultipleContact'].includes(item.type)) {\r\n    if (pen.width > pen.height) {\r\n      // svg 是纵向，需要交互\r\n      const h = pen.height;\r\n      pen.height = pen.width;\r\n      pen.width = h;\r\n    }\r\n    rotate -= 90;\r\n  }\r\n\r\n  // 补丁\r\n  if (rotate) {\r\n    setTimeout(() => {\r\n      meta2d.setValue({\r\n        id: pen.id,\r\n        rotate: -rotate, // 电路编辑器默认是逆时针旋转\r\n      });\r\n    }, 100);\r\n  }\r\n\r\n  const penType = config?.['元件类型'] || item.type;\r\n  // 对称元件\r\n  if (asymmetries.includes(penType)) {\r\n    pen.y -= pen.height / 2;\r\n    pen.x -= pen.width / 2;\r\n    return;\r\n  } else if (sideRightShapes.includes(penType)) {\r\n    if (!rotate) {\r\n      pen.x -= pen.width / 1.5;\r\n      pen.y -= pen.height / 2;\r\n    } else if (item.rotateAngel == '1') {\r\n      pen.y -= pen.height / 2 - 10;\r\n      pen.x -= pen.width / 2;\r\n    } else if (item.rotateAngel == '2') {\r\n      pen.y -= pen.height / 2;\r\n      pen.x -= pen.width / 2 - 10;\r\n    } else if (item.rotateAngel == '3') {\r\n      pen.x -= pen.width / 2;\r\n      pen.y -= pen.height / 2 + 10;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  switch (penType) {\r\n    case 'Input':\r\n      // 输入连接点在右侧\r\n\r\n      if (!rotate) {\r\n        pen.x -= pen.width;\r\n        pen.y -= pen.height / 2;\r\n      } else if (rotate === 90) {\r\n        pen.x -= pen.width / 2;\r\n        //pen.y += pen.height /2;\r\n        pen.y += 5;\r\n      } else if (rotate === 180) {\r\n        pen.y -= pen.height / 2;\r\n      } else if (rotate === 270) {\r\n        // 连接点朝下\r\n        pen.y -= pen.height + 5;\r\n        pen.x -= pen.width / 2;\r\n      }\r\n      break;\r\n    case 'Output':\r\n      if (!rotate) {\r\n        pen.y -= pen.height / 2;\r\n        pen.x -= pen.width;\r\n      } else if (rotate === 90) {\r\n        pen.x -= pen.width / 2;\r\n        pen.y += 5;\r\n      } else if (rotate === 180) {\r\n        pen.y -= pen.height / 2;\r\n      } else if (rotate === 270) {\r\n        // 连接点朝下\r\n        pen.y -= pen.height + 5;\r\n        pen.x -= pen.width / 2;\r\n      }\r\n\r\n      break;\r\n    case 'GND':\r\n      // 位置在一边\r\n      if (!rotate) {\r\n        pen.x -= pen.width / 2;\r\n      } else if (rotate === 90) {\r\n        pen.y -= pen.height / 2;\r\n      } else if (rotate === 180) {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height;\r\n      } else if (rotate === 270) {\r\n        pen.y -= pen.height / 2;\r\n        pen.x -= pen.width;\r\n      }\r\n      break;\r\n\r\n    case 'ElectromagneticValve':\r\n      if (!rotate) {\r\n        pen.y -= pen.height / 2;\r\n        pen.x -= pen.width / 2;\r\n      } else if (item.rotateAngel == '1') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '2') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '3') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 2;\r\n      }\r\n      break;\r\n    case 'duanluqi_wx':\r\n      if (!rotate) {\r\n        pen.x -= pen.width / 4;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '1') {\r\n        pen.y -= pen.height / 2 + 10;\r\n        pen.x -= pen.width / 2;\r\n      } else if (item.rotateAngel == '2') {\r\n        pen.x -= pen.width / 2 + 10;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '3') {\r\n        pen.y -= (pen.width -6);\r\n        pen.x -= pen.width / 2;\r\n      }\r\n      break;\r\n    case 'Switch':\r\n      if (item.rotateAngel == '0') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 1.5;\r\n      } else if (item.rotateAngel == '1') {\r\n        pen.x -= pen.width;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '2') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 3;\r\n      } else if (item.rotateAngel == '3') {\r\n        pen.y -= pen.height / 2;\r\n      }\r\n      break;\r\n    case 'Contact':\r\n      if (item.rotateAngel == '0') {\r\n        pen.x -= pen.width - 3;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '1') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 4 + 2;\r\n      } else if (item.rotateAngel == '2') {\r\n        pen.y -= pen.height / 2;\r\n        pen.x -= 2;\r\n      } else if (item.rotateAngel == '3') {\r\n        pen.y -= pen.height / 1.5 + 2;\r\n        pen.x -= pen.width / 2;\r\n      }\r\n      break;\r\n    case 'Contactk':\r\n      if (item.rotateAngel == '0') {\r\n        pen.x -= pen.width - 3;\r\n        pen.y -= pen.height / 2;\r\n      } else if (item.rotateAngel == '1') {\r\n        pen.x -= pen.width / 2;\r\n        pen.y -= pen.height / 4 + 2;\r\n      } else if (item.rotateAngel == '2') {\r\n        pen.y -= pen.height / 2;\r\n        pen.x -= 2;\r\n      } else if (item.rotateAngel == '3') {\r\n        pen.y -= pen.height / 1.5 + 2;\r\n        pen.x -= pen.width / 2;\r\n      }\r\n\r\n      break;\r\n  }\r\n}\r\n\r\n// 需要特殊状态处理的元件类型\r\nconst StatusTypes = [\r\n  'Btn_SelfLock',\r\n  'Knob_SelfReset',\r\n  'Switch',\r\n  'Knob_SelfLock',\r\n  'duanluqi_wx',\r\n  'MultipleContact',\r\n  'Btn_SelfReset',\r\n];\r\n\r\n/**\r\n * 获取子元素索引\r\n * @param item 元件项\r\n * @returns 子元素索引\r\n */\r\nfunction getChildIndex(item: any) {\r\n  if (item.type == 'MultipleContact') {\r\n    if (item.v10 > '3') {\r\n      // ! 暂无四路以上的开关\r\n      return 0;\r\n    } else {\r\n      if (item.v10 == '2') {\r\n        return item.v16 == '0' ? 1 : 2;\r\n      } else if (item.v10 == '3') {\r\n        return Number(item.v18);\r\n      }\r\n    }\r\n  } else {\r\n    // ! 约定，制作组合时 0 是端口 1 是闭合\r\n    if (item.v10 == 'off') {\r\n      return 0;\r\n    } else if (item.v10 == 'on') {\r\n      return 1;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 查找所有子元素\r\n * @param parent 父元素\r\n * @param list 元素列表\r\n * @returns 包含父元素和所有子元素的数组\r\n */\r\nfunction findChildren(parent: any, list: any[]) {\r\n  if (!parent) return;\r\n  if (!list) return;\r\n  const result = [];\r\n  const queue = [parent];\r\n  while (queue.length) {\r\n    const current = queue.shift();\r\n    result.push(current);\r\n    for (const data of list) {\r\n      if (data.parentId == current.id) {\r\n        queue.push(data);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * 克隆画笔对象列表\r\n * @param list 画笔对象列表\r\n * @returns 克隆后的新画笔对象列表\r\n */\r\nfunction clonePens(list: any[]) {\r\n  const uuid = '-' + s8();\r\n  const copy = deepClone(list);\r\n  copy.forEach((item) => {\r\n    item.id = item.id + uuid;\r\n    if (item.children) {\r\n      item.children = item.children.map((id: string) => {\r\n        return id + uuid;\r\n      });\r\n    }\r\n    if (item.parentId) {\r\n      item.parentId = item.parentId + uuid;\r\n    }\r\n\r\n    if (item.anchors) {\r\n      item.anchors.forEach((anchor: any) => {\r\n        anchor.penId = anchor.penId + uuid;\r\n      });\r\n    }\r\n  });\r\n  return copy;\r\n}\r\n\r\n/**\r\n * 加载电路图JSON数据\r\n * @param data JSON数据\r\n */\r\nexport const loadElectricJson = (data: any) => {\r\n  readJSONFile((res: any) => {\r\n    console.log('readJSONFile: ', res, SwitchCombinesData);\r\n    if (res?.data) {\r\n      meta2d.clear();\r\n      if (SwitchCombinesData.paths) {\r\n        // [svgPathId]: pathString\r\n        // 写入到当前 data\r\n        const paths = meta2d.data().paths || {};\r\n        Object.assign(paths, SwitchCombinesData.paths);\r\n        Object.assign(meta2d.store.data, {\r\n          paths,\r\n        });\r\n      }\r\n      const { Components, Paintings, Wires } = res.data;\r\n      const penList: Pen[] = [];\r\n\r\n      // 导入的电路图json 读取的components\\paintings\\wires\r\n      // 添加元件\r\n      if (Components) {\r\n        Components.forEach((item: any) => {\r\n          // configList自己定义的JSON  根据原件类型查找元件名称 中文信息\r\n          const config = ConfigList.find((config) => {\r\n            return (\r\n              config['元件类型']?.toLocaleLowerCase() ==\r\n              item.type?.toLocaleLowerCase()\r\n            );\r\n          });\r\n          const has = meta2d.findOne(item.uuid);\r\n          if (has) {\r\n            // TODO: 可能更新\r\n            return;\r\n          }\r\n\r\n        // ----------- 特殊图元的处理 多路开关处理 ------------\r\n\r\n          // 判断是否有三路或者四路开关 StatusTypes数组'Btn_SelfLock','Knob_SelfReset','Switch','Knob_SelfLock','duanluqi_wx','MultipleContact','Btn_SelfReset',\r\n          if (StatusTypes.includes(item.type)) {\r\n            \r\n            // 查找是否有组合开关 处理组合开关\r\n            let parent = deepClone(\r\n              SwitchCombinesData.pens.find((v) => {\r\n                //传入的电路JSON里是否有三路  item.type和v.type相等并且item.v10大于等于3 返回自己定义的组合开关JSON里tags包含'MultipleContact-3'并且没有父级\r\n                if (item.type == 'MultipleContact' && item.v10 >= '3') {\r\n                  // 目前只有三路开关\r\n                  return v.tags?.includes('MultipleContact-3') && !v.parentId;\r\n                } else if (v.tags?.includes(item.type) && !v.parentId) {\r\n                  // parent\r\n                  return true;\r\n                }\r\n              }),\r\n            );\r\n            // 查找item中带v开头的参数 \r\n            const vParams = Object.keys(item).filter(key => key.startsWith('v'));\r\n            if (vParams.length > 0) {\r\n              parent.Ecomponents = vParams.map(key => item[key]);\r\n            }\r\n            console.log('Ecomponents=====: ', parent.Ecomponents);\r\n            //查看自己的组合开关JSON 根据父节点查找自己的组合开关的子节点\r\n            //返回的三路开关的父节点和子节点\r\n            const list = clonePens(\r\n              findChildren(parent, SwitchCombinesData.pens),\r\n            );\r\n            //console.log('状态组合：', item.type, item, config);\r\n            //自己的组合开关JSON 根据找到的子节点进行处理\r\n            if (list) {\r\n              //console.log('svg pen list: ', item.type, list);\r\n              // 拿到第一个三路开关的父节点\r\n              parent = list[0];\r\n              // 获取父节点的位置信息\r\n              const rect = meta2d.getPenRect(parent);\r\n              const rWidth = rect.width / SwitchCombinesData.scale;\r\n              const rHeight = rect.height / SwitchCombinesData.scale;\r\n              // 判断中间json中是否包含了三路开关的配置信息\r\n              const width = Number(config?.['宽度(X向)'] || rWidth);\r\n              const height = Number(config?.['高度(Y向)'] || rHeight);\r\n              // 组装父节点 自己本地的组合开关JSON 配置了组合开关里的宽高或者是计算出来来的宽高\r\n              Object.assign(parent, {\r\n                text: item.name,\r\n                x: Number(item.posX),\r\n                y: Number(item.posY),\r\n                width,\r\n                height,\r\n                fault:0,\r\n                titleFnJs: 'return `${pen.text}  ${pen.description}`;',\r\n                color:'rgba(0, 0, 128, 1)',\r\n              });\r\n              // 添加tag\r\n              if (parent.tags && !parent.tags?.includes(item.name)) {\r\n                parent.tags.push(item.name);\r\n              }\r\n              // 特殊处理，和电路编辑器默认角度保持一致  ！！！！！！\r\n              patchPosition(parent, config, item);\r\n              // 组合开关给默认状态值 \r\n              parent.showChild = getChildIndex(item);\r\n\r\n              meta2d.addPens(list);\r\n              return;\r\n            }\r\n          }\r\n          // ----------- SVG处理 ------------\r\n          const svgItem = electricSvgList.find((v) => {\r\n            return (\r\n              v.data.electricTypeCode == item.type ||\r\n              v.data.tags?.includes(item.type)\r\n            );\r\n          });\r\n          if (svgItem) {\r\n            const cWidth = Number(config?.['宽度(X向)']);\r\n            const cHeight = Number(config?.['高度(Y向)']);\r\n            // 读取本地的svg文件 返回数组列表\r\n            loadSvg(svgItem.data.image, svgItem, false).then((list) => {\r\n              const parent = list.find(\r\n                (v) => v.name == 'combine' && !v.parentId,\r\n              );\r\n              \r\n              Object.assign(parent, {\r\n                text: item.name,\r\n                x: Number(item.posX),\r\n                y: Number(item.posY),\r\n                //rotate: rotateAngelMap[item.rotateAngel] || 0, // 跟预期不一致\r\n                tags: [item.type, item.name],\r\n                width: cWidth || parent.width,\r\n                height: cHeight || parent.height,\r\n                color:'rgba(0, 0, 128, 1)',\r\n                fault:0,\r\n                titleFnJs: 'return `${pen.text}  ${pen.description}`;'\r\n              });\r\n              console.log(\r\n                '单一 svg: ',\r\n                svgItem.name,\r\n                svgItem,\r\n                parent,\r\n                cWidth,\r\n                cHeight,\r\n              );\r\n              patchPosition(parent, config, item);\r\n              if (svgItem.data.anchors) {\r\n                parent.anchors = svgItem.data.anchors;\r\n              }\r\n              // 更新位置\r\n              meta2d.addPens(list);\r\n            });\r\n          } else {\r\n            // 处理本地不存在svg的处理图元 目前是rectangle矩形\r\n            const pen = {\r\n              id: item.uuid,\r\n              name: 'rectangle',\r\n              text: item.name,\r\n              //   title: item.name,\r\n              x: Number(item.posX),\r\n              y: Number(item.posY),\r\n              width: Number(config?.['宽度(X向)'] || 100),\r\n              height: Number(config?.['高度(Y向)'] || 100),\r\n              rotate: rotateAngelMap[item.rotateAngel] || 0,\r\n              tags: [item.type, item.name],\r\n              color:'rgba(0, 0, 128, 1)',\r\n              // fontSize: 10,\r\n            };\r\n            // 特殊处理，和电路编辑器默认角度保持一致 ！！！！！！！！！！！！！！！\r\n            patchPosition(pen, config, item);\r\n\r\n            penList.push(pen);\r\n          }\r\n        });\r\n      }\r\n\r\n      // 设置连接线  暂时先不看了\r\n      if (Wires) {\r\n        // 连线 name 必须为 line。不同类型连线用 lineName 属性描述。例如： lineName:'curve'\r\n        Wires.forEach((item: any) => {\r\n          const has = meta2d.findOne(item.uuid);\r\n          if (has) {\r\n            // TODO: 可能更新\r\n            return;\r\n          }\r\n          const { length = 0, anchors = [] } = calcLinePos(item);\r\n          let extractname; // 提取前缀\r\n          if (item.name.includes(\"CenterLineName\")) {\r\n             extractname = extractPrefixOrEmpty(item.name);\r\n          }else{\r\n            extractname = item.name;\r\n          }\r\n          const pen = {\r\n            type: 1,\r\n            id: item.uuid,\r\n            name: 'line',\r\n            lineName: 'curve',\r\n            text: extractname,\r\n            //   title: item.name,\r\n            x: Number(item.startX),\r\n            y: Number(item.startY),\r\n            width: length,\r\n            height: length,\r\n            anchors,\r\n            tags: [item.name],\r\n            fontSize: 14,\r\n            color:'rgb(0, 0, 128)',\r\n            textColor:\"#000\",\r\n            lineAnimateType:1,\r\n            animateColor:'rgb(255, 0, 0)',\r\n            textBaseline:'bottom'\r\n          };\r\n          console.log('连线: ', pen);\r\n          penList.push(pen);\r\n        });\r\n      }\r\n\r\n      if (Paintings) {\r\n        // 文本\r\n        Paintings.forEach((item: any) => {\r\n          const has = meta2d.findOne(item.uuid);\r\n          if (has) {\r\n            // TODO: 可能更新\r\n            return;\r\n          }\r\n          const pen = {\r\n            id: item.uuid,\r\n            name: 'rectangle',\r\n            text: item.text,\r\n            //   title: item.name,\r\n            x: Number(item.posX),\r\n            y: Number(item.posY),\r\n            width: 100,\r\n            height: 50,\r\n            color: item.color,\r\n            textAutoAdjust: true,\r\n            borderWidth: 0,\r\n          };\r\n          penList.push(pen);\r\n        });\r\n      }\r\n\r\n      meta2d.addPens(penList);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * 从字符串中提取前缀\r\n * @param name 包含\"CenterLineName\"的字符串\r\n * @returns 提取的前缀或空字符串\r\n */\r\nfunction extractPrefixOrEmpty(name: string) {\r\n  if (name.includes(\"CenterLineName\")) {\r\n    const parts = name.split(\"_\");\r\n    return parts[0]; // 返回第一个部分作为前缀\r\n  } else {\r\n    // 如果不包含，则返回空字符串\r\n    return \"\";\r\n  }\r\n}\r\n\r\n/**\r\n * 计算连接线位置信息\r\n * @param item 连接线数据\r\n * @returns 包含长度和锚点信息的对象\r\n */\r\nfunction calcLinePos(item: any) {\r\n  const { startX, startY, endX, endY } = item;\r\n  const length = Math.sqrt(\r\n    Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2),\r\n  );\r\n  const anchors = [\r\n    { x: 0, y: 0 },\r\n    { x: 1, y: 1 },\r\n  ];\r\n  if (startX === endX) {\r\n    anchors[1].x = 0;\r\n  } else {\r\n    anchors[1].y = 0;\r\n  }\r\n  // console.log('calcLinePos: ', item, length, anchors);\r\n  return { length, anchors };\r\n}\r\n\r\n/**\r\n * 读取JSON文件\r\n * @param callback 回调函数\r\n */\r\nexport const readJSONFile = (callback: Function | null = null) => {\r\n  const input = document.createElement('input');\r\n  input.type = 'file';\r\n  input.accept = '.json';\r\n  input.onchange = async () => {\r\n    if (!input.files || !input.files.length) return;\r\n    const file = input.files[0];\r\n    const { name, size, type } = file;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      try {\r\n        const data = JSON.parse(reader.result as string);\r\n        const eventObj = { fileName: name, data };\r\n        callback && callback(eventObj);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n  input.click();\r\n};\r\n\r\n/**\r\n * 读取SVG文件\r\n * @param callback 回调函数\r\n */\r\nexport const readSVGFile = (callback: Function | null = null) => {\r\n  const input = document.createElement('input');\r\n  input.type = 'file';\r\n  input.accept = '.svg';\r\n  input.onchange = async () => {\r\n    if (!input.files || !input.files.length) return;\r\n    const file = input.files[0];\r\n    const { name } = file;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      try {\r\n        const data = reader.result as string;\r\n        const eventObj = { fileName: name, data };\r\n        callback && callback(eventObj);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n  input.click();\r\n};\r\n\r\n/**\r\n * 复制文本到剪贴板\r\n * @param text 要复制的文本\r\n * @returns Promise\r\n */\r\nexport function copyToClipboard(text: string) {\r\n  if (navigator.clipboard && window.isSecureContext) {\r\n    // 使用现代API\r\n    return navigator.clipboard\r\n      .writeText(text)\r\n      .then(() => {\r\n        return true;\r\n      })\r\n      .catch((err) => {\r\n        console.error('复制失败：', err);\r\n      });\r\n  } else {\r\n    // 兼容旧版方法\r\n    const el = document.createElement('textarea');\r\n    el.value = text;\r\n    document.body.appendChild(el);\r\n    el.select();\r\n\r\n    const successful = document.execCommand('copy');\r\n    document.body.removeChild(el);\r\n    return new Promise((resolve, reject) => {\r\n      if (successful) {\r\n        resolve(true);\r\n      } else {\r\n        reject(false);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 切换全屏显示\r\n */\r\nexport const toggleFullScreen = () => {\r\n  // 检查当前是否已经在全屏模式\r\n  if (\r\n    !document.fullscreenElement && // 没有处于全屏模式\r\n    !document.mozFullScreenElement && // Firefox\r\n    !document.webkitFullscreenElement && // Chrome, Safari, Opera\r\n    !document.msFullscreenElement\r\n  ) {\r\n    // IE/Edge\r\n    // 进入全屏\r\n    if (document.documentElement.requestFullscreen) {\r\n      document.documentElement.requestFullscreen();\r\n    } else if (document.documentElement.mozRequestFullScreen) {\r\n      // Firefox\r\n      document.documentElement.mozRequestFullScreen();\r\n    } else if (document.documentElement.webkitRequestFullscreen) {\r\n      // Chrome, Safari, Opera\r\n      document.documentElement.webkitRequestFullscreen();\r\n    } else if (document.documentElement.msRequestFullscreen) {\r\n      // IE/Edge\r\n      document.documentElement.msRequestFullscreen();\r\n    }\r\n  } else {\r\n    // 退出全屏\r\n    if (document.exitFullscreen) {\r\n      document.exitFullscreen();\r\n    } else if (document.mozCancelFullScreen) {\r\n      // Firefox\r\n      document.mozCancelFullScreen();\r\n    } else if (document.webkitExitFullscreen) {\r\n      // Chrome, Safari, Opera\r\n      document.webkitExitFullscreen();\r\n    } else if (document.msExitFullscreen) {\r\n      // IE/Edge\r\n      document.msExitFullscreen();\r\n    }\r\n  }\r\n};\r\n","import { ref, useAttrs } from 'vue';\r\n\r\nexport const useUpload = () => {\r\n  const uploadValue = ref([]);\r\n  const sizeLimit = {\r\n    limit: 1024 * 1,\r\n    unit: 'KB',\r\n  };\r\n\r\n  const attrs = useAttrs();\r\n  const headers = {\r\n    Authorization: attrs.token,\r\n  };\r\n\r\n  const handleFail = (e: any) => {\r\n    console.log('upload fail: ', e);\r\n  };\r\n\r\n  const uploadFileFn = (file: File) => {\r\n    if (!attrs.uploadUrl) return Promise.reject('文件上传地址不存在！');\r\n    const formData = new FormData();\r\n    formData.append('object', file);\r\n    return fetch(attrs.uploadUrl, {\r\n      method: 'POST',\r\n      headers,\r\n      body: formData,\r\n    })\r\n      .then((res) => {\r\n        return res.json();\r\n      })\r\n      .then((res) => {\r\n        // console.log('res: ', res);\r\n        return res;\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  };\r\n  return {\r\n    uploadValue,\r\n    sizeLimit,\r\n    headers,\r\n    handleFail,\r\n    uploadFileFn,\r\n  };\r\n};\r\n","import { reactive, ref } from 'vue';\r\nimport { proxyApi } from './apiManager';\r\nimport { deepClone } from '@meta2d/core';\r\nimport { useUpload } from './useUpload.ts';\r\n\r\nlet cache: any = null;\r\n\r\nfunction base64ToFile(base64, fileName) {\r\n  let arr = base64.split(',');\r\n  let mime = arr[0].match(/:(.*\\/*?);/)?.[1] || 'image/png';\r\n  let bstr = atob(arr[1]);\r\n  let n = bstr.length;\r\n  let u8arr = new Uint8Array(n);\r\n  while (n--) {\r\n    u8arr[n] = bstr.charCodeAt(n);\r\n  }\r\n  return new File([u8arr], fileName, { type: mime });\r\n}\r\nfunction activePenToPng(name: string, paper?: boolean) {\r\n  const blob = paper ? meta2d.toPng() : meta2d.activeToPng();\r\n  if (!name?.endsWith('.png')) {\r\n    name += '.png';\r\n  }\r\n  // blob 转 formData\r\n  if (blob) {\r\n    const file = base64ToFile(blob, name);\r\n    return file;\r\n  }\r\n}\r\n\r\nfunction getJsonString(data: any) {\r\n  console.log('getJsonString: ', data);\r\n  if (!data) return;\r\n  let pen;\r\n  if (data.mode == 1) {\r\n    // 单选\r\n    if (data.pen.name == 'combine') {\r\n      const children = data.pen.children.map((id: string) => {\r\n        return meta2d.findOne(id);\r\n      });\r\n      pen = [...children, data.pen];\r\n    } else {\r\n      pen = data.pen;\r\n    }\r\n  } else if (data.mode == 2) {\r\n    // 多选\r\n    // 创建一个组合\r\n    // TODO: pens 中不含 combine 的 children\r\n    const pens = data.pens;\r\n    meta2d.combine(pens);\r\n    const newPen = meta2d.store.active?.[0];\r\n    pen = [...pens, newPen];\r\n  }\r\n\r\n  let result = '';\r\n  try {\r\n    const copy = deepClone(pen);\r\n    if (Array.isArray(copy)) {\r\n      copy.forEach((v: any) => {\r\n        v.calculative = undefined;\r\n      });\r\n    } else {\r\n      copy.calculative = undefined;\r\n    }\r\n    result = JSON.stringify(copy);\r\n  } catch (error) {\r\n    console.log('error: ', error);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport const useData = (useSingle?: boolean) => {\r\n  const blueprintList = ref([]);\r\n  const componentList = ref([]);\r\n  const visible = ref(false);\r\n  const folderName = ref('');\r\n  const selectMode = ref(false);\r\n  const selectType = ref('');\r\n  const apiManager = proxyApi();\r\n  const fileName = ref(''); // 图纸名称或组件名称\r\n  let tempData: any = null;\r\n  let tempCode: string = '';\r\n\r\n  const showAddFolder = (code: string) => {\r\n    selectMode.value = false;\r\n    visible.value = true;\r\n    tempCode = code;\r\n  };\r\n\r\n  const { uploadFileFn } = useUpload();\r\n  const confirm = () => {\r\n    console.log('confirm: ', folderName.value, tempData);\r\n    visible.value = false;\r\n    if (!folderName.value) return;\r\n    if (selectMode.value) {\r\n      let data;\r\n      if (tempCode != 'paper') {\r\n        // 保存组件\r\n        data = getJsonString(tempData);\r\n      } else {\r\n        data = JSON.stringify(tempData);\r\n      }\r\n      // *: get png file\r\n      const png = activePenToPng(\r\n        fileName.value || 'image.png',\r\n        tempCode == 'paper',\r\n      );\r\n      const saveFn = (cover?: string) =>\r\n        apiManager\r\n          .saveComponent({\r\n            nodeId: folderName.value,\r\n            data,\r\n            type: tempCode, // image, component, paper,\r\n            name: fileName.value,\r\n            label: tempCode == 'paper' ? 'paper' : 'component',\r\n            cover,\r\n          })\r\n          .then((res: any) => {\r\n            if (res?.code == 200) {\r\n              getTree(tempCode);\r\n            }\r\n          });\r\n      console.log('png file: ', png);\r\n      if (png) {\r\n        uploadFileFn(png).then((res) => {\r\n          console.log('upload file: ', res);\r\n          if (res?.code == 200) {\r\n            const cover = res.data.fileurl;\r\n            saveFn(cover);\r\n          }\r\n        });\r\n        return;\r\n      }\r\n      // png 不存在\r\n      saveFn();\r\n    } else {\r\n      // 新增目录\r\n      apiManager\r\n        .createFolder({\r\n          dictName: folderName.value,\r\n          type: tempCode,\r\n        })\r\n        .then((res: any) => {\r\n          if (res?.code == 200) {\r\n            getTree(tempCode);\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  const saveImageComponent = (folder: any, data: any) => {\r\n    apiManager\r\n      .saveComponent({\r\n        nodeId: folder.id,\r\n        data: JSON.stringify(data),\r\n        type: 'component',\r\n        name: data.fileName,\r\n        cover: data.image,\r\n        label: 'iamge',\r\n      })\r\n      .then((res: any) => {\r\n        if (res?.code == 200) {\r\n          getTree('component');\r\n        }\r\n      });\r\n  };\r\n\r\n  const close = () => {\r\n    folderName.value = '';\r\n    fileName.value = '';\r\n  };\r\n\r\n  const deleteMyPen = (item: any, code: string) => {\r\n    apiManager.deleteComponent(item.id).then((res: any) => {\r\n      if (res?.code == 200) {\r\n        getTree(code);\r\n      }\r\n    });\r\n  };\r\n\r\n  // 右键菜单--保存组件\r\n  const saveComponentShow = (data: any) => {\r\n    selectMode.value = true;\r\n    visible.value = true;\r\n    tempData = data;\r\n    tempCode = 'component';\r\n    selectType.value = tempCode;\r\n  };\r\n\r\n  const saveBlueprintShow = () => {\r\n    selectMode.value = true;\r\n    visible.value = true;\r\n    tempData = meta2d.data();\r\n    tempCode = 'paper';\r\n    selectType.value = tempCode;\r\n  };\r\n\r\n  const deleteFolder = (item: any, code: string) => {\r\n    apiManager.deleteFolder(item.id).then((res: any) => {\r\n      if (res?.code == 200) {\r\n        getTree(code);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getTree = (code: string) => {\r\n    return apiManager.getTree(code).then((res: any) => {\r\n      if (Array.isArray(res.data)) {\r\n        if (code == 'paper') {\r\n          blueprintList.value = res.data;\r\n        } else {\r\n          componentList.value = res.data;\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  if (useSingle && cache) return cache;\r\n\r\n  return (cache = {\r\n    blueprintList,\r\n    componentList,\r\n    saveComponentShow,\r\n    showAddFolder,\r\n    deleteMyPen,\r\n    visible,\r\n    folderName,\r\n    confirm,\r\n    close,\r\n    selectMode,\r\n    selectType,\r\n    deleteFolder,\r\n    getTree,\r\n    fileName,\r\n    saveImageComponent,\r\n    saveBlueprintShow,\r\n  });\r\n};\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowComment(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ey } = pen.calculative.worldRect;\r\n  const offsetX = width / 4;\r\n  path.moveTo(x + offsetX, y);\r\n  path.lineTo(x, y);\r\n  path.lineTo(x, ey);\r\n  path.lineTo(x + offsetX, ey);\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function flowCommentAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.25,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.25,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 0.5,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: index + '',\r\n      x,\r\n      y,\r\n      penId: pen.id,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowData(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  const penOffsetX: number = (pen as any).offsetX;\r\n  let offsetX = width / 7;\r\n  if (penOffsetX > 1) {\r\n    offsetX = penOffsetX;\r\n  } else if (penOffsetX > 0) {\r\n    offsetX = width * penOffsetX;\r\n  }\r\n  path.moveTo(x + offsetX, y);\r\n  path.lineTo(ex, y);\r\n  path.lineTo(x + width - offsetX, ey);\r\n  path.lineTo(x, ey);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function flowDataAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 13/14,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 1/14,\r\n      y: 0.5,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowDisplay(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex, ey } = pen.calculative.worldRect;\r\n  const offsetX = width / 8;\r\n  path.moveTo(x + offsetX, y);\r\n  path.lineTo(ex - offsetX, y);\r\n  path.bezierCurveTo(\r\n    ex + offsetX / 3,\r\n    y,\r\n    ex + offsetX / 3,\r\n    ey,\r\n    ex - offsetX,\r\n    ey\r\n  );\r\n  path.lineTo(x + offsetX, ey);\r\n  path.lineTo(x, y + height / 2);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowDocument(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex, center } = pen.calculative.worldRect;\r\n  const centerX = center.x;\r\n  const rightBottomY = y + (height * 6) / 7;\r\n  const offsetY = height / 6;\r\n  path.moveTo(x, y);\r\n  path.lineTo(ex, y);\r\n  path.lineTo(ex, rightBottomY);\r\n  path.bezierCurveTo(\r\n    ex - 20,\r\n    rightBottomY - offsetY,\r\n    centerX + width / 5,\r\n    rightBottomY - offsetY,\r\n    centerX,\r\n    rightBottomY\r\n  );\r\n  path.bezierCurveTo(\r\n    centerX - width / 5,\r\n    rightBottomY + offsetY,\r\n    x,\r\n    rightBottomY + offsetY,\r\n    x,\r\n    rightBottomY\r\n  );\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function flowDocumentAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 6 / 7,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 0.5,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowExternStorage(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  const offsetX = width / 10;\r\n  path.moveTo(x + offsetX * 2, y);\r\n  path.bezierCurveTo(\r\n    x - (offsetX * 2) / 3,\r\n    y,\r\n    x - (offsetX * 2) / 3,\r\n    ey,\r\n    x + offsetX * 2,\r\n    ey\r\n  );\r\n  path.lineTo(ex, ey);\r\n  path.bezierCurveTo(ex - offsetX, ey, ex - offsetX, y, ex, y);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowInternalStorage(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n  path.moveTo(x, y);\r\n  path.lineTo(ex, y);\r\n  path.lineTo(ex, ey);\r\n  path.lineTo(x, ey);\r\n  path.closePath();\r\n\r\n  const offset = width / 7;\r\n  path.moveTo(x, y + offset);\r\n  path.lineTo(ex, y + offset);\r\n\r\n  path.moveTo(x + offset, y);\r\n  path.lineTo(x + offset, ey);\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowManually(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, height, ex, ey } = pen.calculative.worldRect;\r\n  const offsetY = height / 4;\r\n  path.moveTo(x, y + offsetY);\r\n  path.lineTo(ex, y);\r\n  path.lineTo(ex, ey);\r\n  path.lineTo(x, ey);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function flowManuallyAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0.125,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 0.5,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowParallel(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, ex, ey } = pen.calculative.worldRect;\r\n\r\n  path.moveTo(x, y);\r\n  path.lineTo(ex, y);\r\n  path.moveTo(x, ey);\r\n  path.lineTo(ex, ey);\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function flowParallelAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: index + '',\r\n      x,\r\n      y,\r\n      penId: pen.id,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowQueue(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex, ey } = pen.calculative.worldRect;\r\n  path.ellipse(\r\n    x + width / 2,\r\n    y + height / 2,\r\n    width / 2,\r\n    height / 2,\r\n    0,\r\n    0,\r\n    Math.PI * 2\r\n  );\r\n\r\n  path.moveTo(x + width / 2, ey);\r\n  path.lineTo(ex, ey);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowSubprocess(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, ex, ey } = pen.calculative.worldRect;\r\n\r\n  const offsetX = width / 7;\r\n  path.moveTo(x, y);\r\n  path.lineTo(ex, y);\r\n  path.lineTo(ex, ey);\r\n  path.lineTo(x, ey);\r\n  path.closePath();\r\n\r\n  path.moveTo(x + offsetX, y);\r\n  path.lineTo(x + offsetX, ey);\r\n\r\n  path.moveTo(ex - offsetX, y);\r\n  path.lineTo(ex - offsetX, ey);\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function flowDb(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, height, ex, ey } = pen.calculative.worldRect;\r\n  const offsetY = height / 7;\r\n  path.moveTo(x, y + offsetY);\r\n  path.bezierCurveTo(\r\n    x,\r\n    (y - offsetY / 2) | 0,\r\n    ex,\r\n    (y - offsetY / 2) | 0,\r\n    ex,\r\n    y + offsetY\r\n  );\r\n  path.lineTo(ex, ey - offsetY);\r\n  path.bezierCurveTo(\r\n    ex,\r\n    (ey + offsetY / 2) | 0,\r\n    x,\r\n    (ey + offsetY / 2) | 0,\r\n    x,\r\n    ey - offsetY\r\n  );\r\n  path.closePath();\r\n  path.moveTo(x, ey - offsetY);\r\n  path.bezierCurveTo(\r\n    x,\r\n    (ey - offsetY * 2) | 0,\r\n    ex,\r\n    (ey - offsetY * 2) | 0,\r\n    ex,\r\n    ey - offsetY\r\n  );\r\n  //   path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { flowComment, flowCommentAnchors } from './comment';\r\nimport { flowData, flowDataAnchors } from './data';\r\nimport { flowDb } from './db';\r\nimport { flowDisplay } from './display';\r\nimport { flowDocument, flowDocumentAnchors } from './document';\r\nimport { flowExternStorage } from './externStorage';\r\nimport { flowInternalStorage } from './internalStorage';\r\nimport { flowManually, flowManuallyAnchors } from './manually';\r\nimport { flowParallel, flowParallelAnchors } from './parallel';\r\nimport { flowQueue } from './queue';\r\nimport { flowSubprocess } from './subprocess';\r\n\r\nexport function flowPens(): Record<\r\n  string,\r\n  (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D\r\n> {\r\n  return {\r\n    flowComment,\r\n    flowData,\r\n    flowDb,\r\n    flowDisplay,\r\n    flowDocument,\r\n    flowExternStorage,\r\n    flowInternalStorage,\r\n    flowManually,\r\n    flowParallel,\r\n    flowQueue,\r\n    flowSubprocess,\r\n  };\r\n}\r\n\r\nexport function flowAnchors() {\r\n  return {\r\n    flowDocument: flowDocumentAnchors,\r\n    flowManually: flowManuallyAnchors,\r\n    flowParallel: flowParallelAnchors,\r\n    flowComment: flowCommentAnchors,\r\n    flowData: flowDataAnchors,\r\n  };\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\n// 此方法只能绘制路径，在该图形不适用\r\n// export function activityFinal(pen: Pen): Path2D {\r\n//   const path1 = new Path2D();\r\n\r\n//   const worldRect = pen.calculative.worldRect;\r\n//   path1.ellipse(\r\n//     worldRect.x + worldRect.width / 2,\r\n//     worldRect.y + worldRect.height / 2,\r\n//     worldRect.width / 2,\r\n//     worldRect.height / 2,\r\n//     0,\r\n//     0,\r\n//     Math.PI * 2\r\n//   );\r\n\r\n//   const path2 = new Path2D();\r\n\r\n//   path2.ellipse(\r\n//     worldRect.x + worldRect.width / 2,\r\n//     worldRect.y + worldRect.height / 2,\r\n//     worldRect.width / 4,\r\n//     worldRect.height / 4,\r\n//     0,\r\n//     0,\r\n//     Math.PI * 2\r\n//   );\r\n\r\n//   path1.addPath(path2);\r\n//   return path1;\r\n// }\r\n\r\nexport function activityFinal(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  ctx.beginPath();\r\n  ctx.ellipse(\r\n    x + width / 2,\r\n    y + height / 2,\r\n    width / 2,\r\n    height / 2,\r\n    0,\r\n    0,\r\n    Math.PI * 2\r\n  );\r\n  ctx.stroke();\r\n\r\n  ctx.beginPath();\r\n  ctx.fillStyle = ctx.strokeStyle;\r\n  ctx.ellipse(\r\n    x + width / 2,\r\n    y + height / 2,\r\n    width / 4,\r\n    height / 4,\r\n    0,\r\n    0,\r\n    Math.PI * 2\r\n  );\r\n  ctx.fill();\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function swimlaneH(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ey } = pen.calculative.worldRect;\r\n  const lineLeft = (pen.calculative as any).lineLeft || 0.08;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * wr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n\r\n  path.moveTo(x + r, y);\r\n  path.arcTo(x + width, y, x + width, y + height, r);\r\n  path.arcTo(x + width, y + height, x, y + height, r);\r\n  path.arcTo(x, y + height, x, y, r);\r\n  path.arcTo(x, y, x + width, y, r);\r\n  path.closePath();\r\n\r\n  //   40 肯定是不合理的，TODO: 该处用宽度的部分值\r\n  // TODO: 算上圆角后，该线可能超出在范围外\r\n  path.moveTo(x + lineLeft * width, y);\r\n  path.lineTo(x + lineLeft * width, ey);\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function swimlaneV(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex } = pen.calculative.worldRect;\r\n  const lineTop = (pen.calculative as any).lineTop || 0.08;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * hr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n\r\n  path.moveTo(x + r, y);\r\n  path.arcTo(x + width, y, x + width, y + height, r);\r\n  path.arcTo(x + width, y + height, x, y + height, r);\r\n  path.arcTo(x, y + height, x, y, r);\r\n  path.arcTo(x, y, x + width, y, r);\r\n  path.closePath();\r\n\r\n  //   40 肯定是不合理的，TODO: 该处用高度的部分值\r\n  path.moveTo(x, y + lineTop * height);\r\n  path.lineTo(ex, y + lineTop * height);\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { rectangle } from '@meta2d/core/src/diagrams';\r\nimport { activityFinal } from './final';\r\nimport { swimlaneH } from './swimlaneH';\r\nimport { swimlaneV } from './swimlaneV';\r\n\r\nexport function activityDiagram(): Record<\r\n  string,\r\n  (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D\r\n> {\r\n  return {\r\n    forkV: rectangle,\r\n    forkH: rectangle,\r\n    swimlaneH,\r\n    swimlaneV,\r\n  };\r\n}\r\n\r\nexport function activityDiagramByCtx() {\r\n  return {\r\n    activityFinal,\r\n  };\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function interfaceClass(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = onDestroy;\r\n    pen.onAdd = onAdd;\r\n  }\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex } = pen.calculative.worldRect;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (wr < 1) {\r\n    wr *= width;\r\n    hr *= height;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  path.moveTo(x + r, y);\r\n  path.arcTo(x + width, y, x + width, y + height, r);\r\n  path.arcTo(x + width, y + height, x, y + height, r);\r\n  path.arcTo(x, y + height, x, y, r);\r\n  path.arcTo(x, y, x + width, y, r);\r\n  const topHeight = 0.2 * height;\r\n  path.moveTo(x, y + topHeight);\r\n  path.lineTo(ex, y + topHeight);\r\n\r\n  const secondHeight = y + topHeight + (height - topHeight) / 2;\r\n  path.moveTo(x, secondHeight);\r\n  path.lineTo(ex, secondHeight);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\nfunction onAdd(pen: Pen) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const list: { text: string }[] = (pen as any).list;\r\n  const childPen: Pen = {\r\n    name: 'text',\r\n    x: x,\r\n    y: y + 0.2 * height,\r\n    width,\r\n    height: 0.4 * height,\r\n    // text: list[0].text,\r\n    textAlign: 'left',\r\n    textBaseline: 'top',\r\n    textLeft: 10,\r\n    textTop: 10,\r\n  };\r\n  const childPen1: Pen = {\r\n    name: 'text',\r\n    x: x,\r\n    y: y + 0.6 * height,\r\n    width,\r\n    height: 0.4 * height,\r\n    // text: list[1].text,\r\n    textAlign: 'left',\r\n    textBaseline: 'top',\r\n    textLeft: 10,\r\n    textTop: 10,\r\n  };\r\n  Object.assign(childPen, list[0]);\r\n  Object.assign(childPen1, list[1]);\r\n  pen.calculative.canvas.makePen(childPen);\r\n  pen.calculative.canvas.makePen(childPen1);\r\n  pen.calculative.canvas.parent.pushChildren(pen, [childPen]);\r\n  pen.calculative.canvas.parent.pushChildren(pen, [childPen1]);\r\n}\r\n\r\nfunction onDestroy(pen: Pen) {\r\n  const store = pen.calculative.canvas.store;\r\n  pen.children.forEach((p) => {\r\n    const i = store.data.pens.findIndex((item) => item.id === p);\r\n    if (i > -1) {\r\n      store.data.pens.splice(i, 1);\r\n      store.pens[p] = undefined;\r\n    }\r\n  });\r\n  pen.children = undefined;\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function simpleClass(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = onDestroy;\r\n    pen.onAdd = onAdd;\r\n  }\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height, ex } = pen.calculative.worldRect;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * hr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  path.moveTo(x + r, y);\r\n  path.arcTo(x + width, y, x + width, y + height, r);\r\n  path.lineTo(x + width, y + height - r);\r\n  path.arcTo(x + width, y + height, x, y + height, r);\r\n  path.arcTo(x, y + height, x, y, r);\r\n  path.arcTo(x, y, x + width, y, r);\r\n  const topHeight = 0.2 * height;\r\n  path.moveTo(x, y + topHeight);\r\n  path.lineTo(ex, y + topHeight);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nfunction onAdd(pen: Pen) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const list: { text: string }[] = (pen as any).list;\r\n  let childPen: Pen = {\r\n    name: 'text',\r\n    x: x,\r\n    y: y + 0.2 * height,\r\n    width,\r\n    height: 0.8 * height,\r\n    // text: list[0].text,\r\n    textAlign: 'left',\r\n    textBaseline: 'top',\r\n    textLeft: 10,\r\n    textTop: 10,\r\n  };\r\n  Object.assign(childPen, list[0]);\r\n  pen.calculative.canvas.makePen(childPen);\r\n  pen.calculative.canvas.parent.pushChildren(pen, [childPen]);\r\n}\r\nfunction onDestroy(pen: Pen) {\r\n  const store = pen.calculative.canvas.store;\r\n  pen.children.forEach((p) => {\r\n    const i = store.data.pens.findIndex((item) => item.id === p);\r\n    if (i > -1) {\r\n      store.data.pens.splice(i, 1);\r\n      store.pens[p] = undefined;\r\n    }\r\n  });\r\n  pen.children = [];\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { interfaceClass } from './interfaceClass';\r\nimport { simpleClass } from './simpleClass';\r\n\r\nexport function classPens(): Record<\r\n  string,\r\n  (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D\r\n> {\r\n  return {\r\n    interfaceClass,\r\n    simpleClass,\r\n  };\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\nexport function focus(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  path.rect(x, y, width, height);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function lifeline(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const headHeight = (pen as any).headHeight ?? 50;\r\n  const { x, y, width, height, ey } = pen.calculative.worldRect;\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (pen.calculative.borderRadius < 1) {\r\n    wr *= width;\r\n    hr *= height;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (headHeight < 2 * r) {\r\n    r = headHeight / 2;\r\n  }\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + width, y, x + width, y + headHeight, r);\r\n  ctx.arcTo(x + width, y + headHeight, x, y + headHeight, r);\r\n  ctx.arcTo(x, y + headHeight, x, y, r);\r\n  ctx.arcTo(x, y, x + width, y, r);\r\n  ctx.closePath();\r\n  ctx.stroke();\r\n\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.lineWidth = 1;\r\n  ctx.setLineDash([7, 7]);\r\n  const middle = x + width / 2;\r\n  ctx.moveTo(middle, y + headHeight + 1);\r\n  ctx.lineTo(middle, ey);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { focus } from './focus';\r\nimport { lifeline } from './lifeline';\r\n\r\nexport function sequencePens(): Record<\r\n  string,\r\n  (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D\r\n> {\r\n  return {\r\n    sequenceFocus: focus,\r\n  };\r\n}\r\nexport function sequencePensbyCtx() {\r\n  return {\r\n    lifeline,\r\n  };\r\n}\r\n","import {\r\n  BindId,\r\n  deepClone,\r\n  FormItem,\r\n  IValue,\r\n  Pen,\r\n  deepSetValue,\r\n  setElemPosition,\r\n  getter,\r\n  formatTime,\r\n  setter,\r\n} from '@meta2d/core';\r\nimport type { EChartOption } from 'echarts';\r\n\r\nexport enum ReplaceMode {\r\n  Add,\r\n  Replace,\r\n  ReplaceAll,\r\n}\r\nlet keyWords = [\r\n  'fontSize',\r\n  'nameGap',\r\n  'margin',\r\n  'width' /*线条宽度*/,\r\n  'symbolSize' /*结点大小*/,\r\n  'itemWidth', // 图例宽度\r\n  'itemHeight', // 图例高度\r\n  'fontWeight',\r\n  'top',\r\n  'left',\r\n  'right',\r\n  'bottom',\r\n  'zoom',\r\n  'edgeSymbolSize',\r\n  'nodeWidth',\r\n  'nodeGap',\r\n  'distance',\r\n  'length',\r\n  'length2',\r\n  'offsetCenter',\r\n  'size',\r\n  'symbolOffset',\r\n  'padding',\r\n  'barWidth',\r\n  'symbolOffset',\r\n  'shadowOffsetY',\r\n  'shadowOffsetX',\r\n];\r\n\r\nexport interface ChartPen extends Pen {\r\n  echarts: {\r\n    option: EChartOption; // echarts 参数\r\n    max: number; // 最大数据量\r\n    replaceMode: ReplaceMode; // 替换模式\r\n    theme: string; // 主题\r\n    timeFormat: string; //格式化\r\n    geoName?: string;\r\n    geoJson?: any;\r\n    geoUrl?: string;\r\n  };\r\n  calculative?: {\r\n    partialOption?: any; // 部分更新的 option\r\n  } & Pen['calculative'];\r\n  // beforeScale: number;\r\n}\r\n\r\nexport function echarts(pen: ChartPen): Path2D {\r\n  let echarts = globalThis.echarts;\r\n  if (!pen.echarts || !echarts) {\r\n    return;\r\n  }\r\n\r\n  if (typeof pen.echarts === 'string') {\r\n    try {\r\n      pen.echarts = JSON.parse(pen.echarts);\r\n    } catch (e) {}\r\n  }\r\n  keyWords =\r\n    pen.calculative.canvas.store.options.diagramOptions['chart']?.keyWords ||\r\n    keyWords;\r\n  if (!pen.onDestroy) {\r\n    pen.onDestroy = destory;\r\n    pen.onMove = move;\r\n    pen.onResize = resize;\r\n    pen.onRotate = move;\r\n    pen.onValue = value;\r\n    pen.onBeforeValue = beforeValue;\r\n    pen.onBinds = binds;\r\n    pen.onMouseEnter = move;\r\n    // pen.onAdd = onAdd;\r\n    pen.onRenderPenRaw = onRenderPenRaw;\r\n  }\r\n\r\n  if (!pen.calculative.singleton) {\r\n    pen.calculative.singleton = {};\r\n  }\r\n\r\n  const path = new Path2D();\r\n  const worldRect = pen.calculative.worldRect;\r\n\r\n  if (!pen.calculative.singleton.div) {\r\n    // 1. 创建父容器\r\n    const div = document.createElement('div');\r\n    div.style.position = 'absolute';\r\n    div.style.outline = 'none';\r\n    div.style.left = '-9999px';\r\n    div.style.top = '-9999px';\r\n    div.style.width = worldRect.width + 'px';\r\n    div.style.height = worldRect.height + 'px';\r\n    document.body.appendChild(div);\r\n    // 2. 加载到div layer\r\n    pen.calculative.canvas.externalElements?.parentElement.appendChild(div);\r\n    setElemPosition(pen, div);\r\n\r\n    // 3. 解析echarts数据\r\n    pen.calculative.singleton.div = div;\r\n    pen.calculative.singleton.echart = echarts.init(div, pen.echarts.theme);\r\n    initEvent(pen);\r\n    pen.calculative.singleton.echartsReady = true;\r\n    if (pen.echarts.geoName && !echarts.getMap(pen.echarts.geoName)) {\r\n      if (pen.echarts.geoJson) {\r\n        echarts.registerMap(pen.echarts.geoName, pen.echarts.geoJson);\r\n      } else if (pen.echarts.geoUrl) {\r\n        pen.calculative.singleton.echartsReady = false;\r\n        fetch(pen.echarts.geoUrl).then((e) => {\r\n          e.text().then((data: any) => {\r\n            if (typeof data === 'string') {\r\n              try {\r\n                data = JSON.parse(data);\r\n              } catch {}\r\n            }\r\n            if (data.constructor !== Object && data.constructor !== Array) {\r\n              console.warn('Invalid data:', data);\r\n              return;\r\n            }\r\n            echarts.registerMap(pen.echarts.geoName, data);\r\n            pen.calculative.singleton.echartsReady = true;\r\n            pen.calculative.singleton.echart.setOption(\r\n              updateOption(\r\n                pen.echarts.option,\r\n                pen.calculative.canvas.store.data.scale\r\n              ),\r\n              true\r\n            );\r\n            pen.calculative.singleton.echart.resize();\r\n            setTimeout(() => {\r\n              onRenderPenRaw(pen);\r\n            }, 300);\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    // 4. 加载echarts\r\n    if (pen.calculative.singleton.echartsReady) {\r\n      // 初始化时，等待父div先渲染完成，避免初始图表控件太大。\r\n      setTimeout(() => {\r\n        pen.calculative.singleton.echart.setOption(\r\n          updateOption(\r\n            pen.echarts.option,\r\n            pen.calculative.canvas.store.data.scale\r\n          ),\r\n          true\r\n        );\r\n        setTimeout(() => onRenderPenRaw(pen), 300);\r\n      });\r\n    }\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\n\r\nexport function initEvent(pen: Pen) {\r\n  const _chart = pen.calculative.singleton.echart;\r\n  const eventNames = ['click', 'dblclick', 'mousedown', 'mousemove', 'mouseup', 'mouseover', 'mouseout', 'globalout', 'contextmenu'];\r\n  eventNames.forEach((eventName) => {\r\n    _chart.off(eventName);\r\n  });\r\n  pen.events?.forEach((event)=>{\r\n    if (event.actions && event.actions.length) {\r\n      if(eventNames.includes(event.name)){\r\n        _chart.on(event.name, (params) => {\r\n          let flag = false;\r\n          if (event.conditions && event.conditions.length) {\r\n            if (event.conditionType === 'and') {\r\n              flag = event.conditions.every((condition) => {\r\n                return  pen.calculative.canvas.parent.judgeCondition(pen, condition.key, condition);\r\n              });\r\n            } else if (event.conditionType === 'or') {\r\n              flag = event.conditions.some((condition) => {\r\n                return  pen.calculative.canvas.parent.judgeCondition(pen, condition.key, condition);\r\n              });\r\n            }\r\n          } else {\r\n            flag = true;\r\n          }\r\n          if (flag) {\r\n            event.actions.forEach((action) => {\r\n              if(action.timeout){\r\n                let timer = setTimeout(()=>{\r\n                  if ( pen.calculative.canvas.parent.events[action.action]) {\r\n                    pen.calculative.canvas.parent.events[action.action](pen, action, params);\r\n                    clearTimeout(timer);\r\n                    timer = null;\r\n                  }\r\n                },action.timeout);\r\n              }else{\r\n                if (pen.calculative.canvas.parent.events[action.action]) {\r\n                  pen.calculative.canvas.parent.events[action.action](pen, action, params);\r\n                }\r\n              }\r\n            });\r\n          }\r\n        });\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// function onAdd(pen: ChartPen) {\r\n//   // pen.beforeScale = pen.calculative.canvas.store.data.scale;\r\n// }\r\n\r\nfunction destory(pen: Pen) {\r\n  if (pen.calculative.singleton && pen.calculative.singleton.div) {\r\n    pen.calculative.singleton.div.remove();\r\n    let echarts = globalThis.echarts;\r\n    echarts && echarts.dispose(pen.calculative.singleton.echart);\r\n\r\n    delete pen.calculative.singleton.div;\r\n    delete pen.calculative.singleton.echart;\r\n  }\r\n}\r\n\r\nfunction move(pen: Pen) {\r\n  pen.calculative.singleton.div &&\r\n    setElemPosition(pen, pen.calculative.singleton.div);\r\n}\r\n\r\nfunction resize(pen: ChartPen) {\r\n  if (!pen.calculative.singleton.echart) {\r\n    return;\r\n  }\r\n  let echarts = globalThis.echarts;\r\n  setElemPosition(pen, pen.calculative.singleton.div);\r\n  // let option = pen.echarts.option;\r\n  // if (!pen.beforeScale) {\r\n  //   pen.beforeScale = pen.calculative.canvas.store.data.scale;\r\n  // }\r\n  // let ratio: number = pen.calculative.canvas.store.data.scale / pen.beforeScale;\r\n  // updateOption(option, ratio);\r\n  if (pen.echarts.geoName && !echarts.getMap(pen.echarts.geoName)) return;\r\n  pen.calculative.singleton.echart.setOption(\r\n    updateOption(pen.echarts.option, pen.calculative.canvas.store.data.scale),\r\n    true\r\n  );\r\n  // pen.beforeScale = pen.calculative.canvas.store.data.scale;\r\n  pen.calculative.singleton.echart.resize();\r\n}\r\n\r\nfunction value(pen: ChartPen) {\r\n  if (!pen.calculative.singleton.echart) {\r\n    return;\r\n  }\r\n  setElemPosition(pen, pen.calculative.singleton.div);\r\n  if (pen.calculative.singleton.echartsReady) {\r\n    if (pen.calculative.partialOption) {\r\n      //部分更新\r\n      const option = pen.calculative.partialOption.echarts.option;\r\n      pen.calculative.singleton.echart.setOption(deepClone(option));\r\n    } else {\r\n      pen.calculative.singleton.echart.setOption(\r\n        updateOption(\r\n          pen.echarts.option,\r\n          pen.calculative.canvas.store.data.scale\r\n        ),\r\n        true\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction beforeValue(pen: ChartPen, value: any) {\r\n  pen.calculative.partialOption = null;\r\n  if ((value as any).echarts) {\r\n    let echarts = globalThis.echarts;\r\n    if (value.echarts.geoName && !echarts.getMap(value.echarts.geoName)) {\r\n      if (value.echarts.geoJson) {\r\n        echarts.registerMap(value.echarts.geoName, value.echarts.geoJson);\r\n      } else if (value.echarts.geoUrl) {\r\n        pen.calculative.singleton.echartsReady = false;\r\n        fetch(value.echarts.geoUrl).then((e) => {\r\n          e.text().then((data: any) => {\r\n            if (typeof data === 'string') {\r\n              try {\r\n                data = JSON.parse(data);\r\n              } catch {}\r\n            }\r\n            if (data.constructor !== Object && data.constructor !== Array) {\r\n              console.warn('Invalid data:', data);\r\n              return;\r\n            }\r\n            echarts.registerMap(value.echarts.geoName, data);\r\n            pen.calculative.singleton.echartsReady = true;\r\n            // @ts-ignore\r\n            pen.onValue(pen);\r\n            return false;\r\n          });\r\n        });\r\n      }\r\n    }\r\n    // 整体传参，不做处理\r\n    return value;\r\n  }\r\n  if (pen.realTimes && pen.realTimes.length) {\r\n    let keys = Object.keys(value);\r\n    const { xAxis, yAxis } = pen.echarts.option;\r\n    const { max, replaceMode, timeFormat } = pen.echarts;\r\n    let dataDotArr = []; //记录只更新一个点的数据\r\n    let chartFlag = false;\r\n    for (let key in value) {\r\n      if (key.includes('echarts.option')) {\r\n        chartFlag = true;\r\n        let beforeV = getter(pen, key);\r\n        if (Array.isArray(beforeV) && replaceMode === ReplaceMode.Add) {\r\n          //追加\r\n          beforeV.push(value[key]);\r\n          if (max) {\r\n            beforeV.splice(0, beforeV.length - max);\r\n          }\r\n          value[key] = beforeV;\r\n          if(!keys.includes('echarts.option.xAxis.data')){\r\n            //x轴时间  避免影响x轴历史趋势\r\n            let _key = 'echarts.option.xAxis.data';\r\n            if (Array.isArray(xAxis) && xAxis.length) {\r\n              _key = 'echarts.option.xAxis.0.data';\r\n            }\r\n            let _value = getter(pen, _key);\r\n            let _time = formatTime(\r\n              timeFormat || '`${hours}:${minutes}:${seconds}`'\r\n            );\r\n            _value.push(_time);\r\n            if (max) {\r\n              _value.splice(0, _value.length - max);\r\n            }\r\n            value[_key] = _value;\r\n          }\r\n        }\r\n        if (key.includes('.data.')) {\r\n          //例如data.1 需要更新 data\r\n          let _key = key.substring(0, key.indexOf('.data.') + 5);\r\n          if (!dataDotArr.includes(_key)) {\r\n            dataDotArr.push(_key);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (chartFlag) {\r\n      const _value = deepClone(value);\r\n      pen.calculative.partialOption = dotNotationToObject(_value);\r\n      dataDotArr.forEach((key) => {\r\n        let value = getter(pen, key);\r\n        setter(pen.calculative.partialOption, key, value);\r\n      });\r\n    }\r\n    return value;\r\n  }\r\n  if (!value.dataX && !value.dataY) {\r\n    return value;\r\n  }\r\n  // 1. 拿到老的 echarts\r\n  const echarts = pen.echarts;\r\n  const { max, replaceMode } = echarts;\r\n  // 2. 特殊处理\r\n  // x，y 需要判空, 此处不转换数组\r\n  let x = value.dataX;\r\n  let y = value.dataY;\r\n  let dataArr = []; //记录只更新数据\r\n  if (y) {\r\n    dataArr.push('echarts.option.series');\r\n  }\r\n  const series = echarts.option.series;\r\n  // 确认有几条线，即多折线的场景\r\n  const length = series.length;\r\n  const { xAxis, yAxis } = echarts.option;\r\n  if (Array.isArray(xAxis) && xAxis.length > 1) {\r\n    // 多 x 轴不考虑\r\n    console.warn('echarts 只支持单 x 轴，多 x 轴将被忽略');\r\n  }\r\n  // 单 x 轴\r\n  const oneXAxis = Array.isArray(xAxis) ? xAxis[0] : xAxis;\r\n  const oneYAxis = Array.isArray(yAxis) ? yAxis[0] : yAxis;\r\n  if (!replaceMode) {\r\n    // 追加数据\r\n    if (x) {\r\n      // x 轴考虑只有一条\r\n      !Array.isArray(x) && (x = [x]);\r\n      // TODO: Y 轴是分类，x 轴是值，追加不考虑\r\n      const xData = oneXAxis.data;\r\n      xData.push(...x);\r\n      // 删除开头的多余数据\r\n      xData.splice(0, xData.length - max);\r\n      dataArr.push('echarts.option.xAxis');\r\n    }\r\n\r\n    if (y) {\r\n      if (length === 1) {\r\n        !Array.isArray(y) && (y = [y]);\r\n        const yData = series[0].data;\r\n        yData.push(...y);\r\n        // 删除开头的多余数据\r\n        yData.splice(0, yData.length - max);\r\n      } else {\r\n        // 多条线\r\n        series.forEach((serie, index: number) => {\r\n          if (!Array.isArray(y[index])) {\r\n            y[index] = [y[index]];\r\n          }\r\n          const yData = serie.data;\r\n          yData.push(...y[index]);\r\n          // 删除开头的多余数据\r\n          yData.splice(0, yData.length - max);\r\n        });\r\n      }\r\n    }\r\n  } else if (replaceMode === ReplaceMode.Replace) {\r\n    // 替换部分数据\r\n    if (!oneXAxis && !oneYAxis) {\r\n      /**\r\n       * 饼图、仪表盘等\r\n       */\r\n      if (y) {\r\n        if (length === 1) {\r\n          !Array.isArray(y) && (y = [y]);\r\n          // 单饼\r\n          y.forEach((yItem, index: number) => {\r\n            const part = (\r\n              series[0].data as EChartOption.SeriesSunburst.DataObject[]\r\n            ).find((part) => part.name === yItem.name);\r\n            part && (part.value = yItem.value);\r\n          });\r\n        } else {\r\n          // 多饼图\r\n          series.forEach((serie, index: number) => {\r\n            if (!Array.isArray(y[index])) {\r\n              y[index] = [y[index]];\r\n            }\r\n            y[index].forEach((yItem, index: number) => {\r\n              const part = (\r\n                serie.data as EChartOption.SeriesSunburst.DataObject[]\r\n              ).find((part) => part.name === yItem.name);\r\n              part && (part.value = yItem.value);\r\n            });\r\n          });\r\n        }\r\n      }\r\n    } else if (oneXAxis.type === 'category' || oneYAxis.type === 'category') {\r\n      /**\r\n       * dataX 中传的值用来找到对应的 y 轴值\r\n       */\r\n      if (x && y) {\r\n        const categoryData =\r\n          oneXAxis.type === 'category' ? oneXAxis.data : oneYAxis.data;\r\n        !Array.isArray(x) && (x = [x]);\r\n        !Array.isArray(y) && (y = [y]);\r\n        if (oneXAxis.type === 'category') {\r\n          dataArr.push('echarts.option.xAxis');\r\n        } else {\r\n          dataArr.push('echarts.option.yAxis');\r\n        }\r\n        if (length === 1) {\r\n          y.forEach((yItem, index: number) => {\r\n            const xIndex = categoryData.indexOf(x[index]);\r\n            series[0].data[xIndex] = yItem;\r\n          });\r\n        } else {\r\n          // 多条线\r\n          series.forEach((serie, index: number) => {\r\n            y[index].forEach((yItem, index: number) => {\r\n              const xIndex = categoryData.indexOf(x[index]);\r\n              serie.data[xIndex] = yItem;\r\n            });\r\n          });\r\n        }\r\n      }\r\n    }\r\n  } else if (replaceMode === ReplaceMode.ReplaceAll) {\r\n    // 替换数据\r\n    if (x) {\r\n      // TODO: Y 轴是分类，x 轴是值，替换全部不考虑\r\n      oneXAxis.data = x;\r\n      oneXAxis.data.splice(0, oneXAxis.data.length - max);\r\n      dataArr.push('echarts.option.xAxis');\r\n    }\r\n    if (y) {\r\n      if (length === 1) {\r\n        series[0].data = y;\r\n        series[0].data.splice(0, series[0].data.length - max);\r\n      } else {\r\n        // 多条线\r\n        series.forEach((serie, index: number) => {\r\n          serie.data = y[index];\r\n          serie.data.splice(0, serie.data.length - max);\r\n        });\r\n      }\r\n    }\r\n  }\r\n  pen.calculative.partialOption = {};\r\n  dataArr.forEach((key) => {\r\n    let value = getter(pen, key);\r\n    setter(pen.calculative.partialOption, key, value);\r\n  });\r\n  delete value.dataX;\r\n  delete value.dataY;\r\n  return Object.assign(value, { echarts });\r\n}\r\n\r\nfunction binds(pen: ChartPen, values: IValue[], formItem: FormItem): IValue {\r\n  if (formItem.key !== 'dataY') {\r\n    return;\r\n  }\r\n  // 1. 拿到老的 echarts\r\n  const echarts = pen.echarts;\r\n  const { xAxis, yAxis } = echarts.option;\r\n  if (Array.isArray(xAxis) && xAxis.length > 1) {\r\n    // 多 x 轴不考虑\r\n    console.warn('echarts 只支持单 x 轴，多 x 轴将被忽略');\r\n  }\r\n  // 单 x 轴\r\n  const oneXAxis = Array.isArray(xAxis) ? xAxis[0] : xAxis;\r\n  const oneYAxis = Array.isArray(yAxis) ? yAxis[0] : yAxis;\r\n  const series = echarts.option.series;\r\n  if (!oneXAxis && !oneYAxis) {\r\n    /**\r\n     * 饼图、仪表盘等\r\n     */\r\n    const dataY = [];\r\n    // 单个饼\r\n    if (Array.isArray(series) && series.length === 1) {\r\n      series[0].data.forEach((item) => {\r\n        const { dataId: id } = (formItem.dataIds as BindId[]).find(\r\n          (dataId) => dataId.name === item.name\r\n        );\r\n        if (id) {\r\n          const value = values.find((value) => value.dataId === id);\r\n          if (value) {\r\n            dataY.push({\r\n              name: item.name,\r\n              value: value.value,\r\n            });\r\n          }\r\n        }\r\n      });\r\n      return {\r\n        id: pen.id,\r\n        dataY,\r\n      };\r\n    } else {\r\n      // TODO: 多个饼待考虑\r\n    }\r\n  } else if (oneXAxis.type === 'category' || oneYAxis.type === 'category') {\r\n    // 根据 x 轴的类型排序 dataY\r\n    const dataY: number[] = [],\r\n      dataX = [];\r\n    const categoryData =\r\n      oneXAxis.type === 'category' ? oneXAxis.data : oneYAxis.data;\r\n    categoryData?.forEach((category: string) => {\r\n      const { dataId: id } = (formItem.dataIds as BindId[]).find(\r\n        (dataId) => dataId.name === category\r\n      );\r\n      if (id) {\r\n        const value = values.find((value) => value.dataId === id);\r\n        if (value) {\r\n          dataX.push(category);\r\n          dataY.push(value.value);\r\n        }\r\n      }\r\n    });\r\n    return {\r\n      id: pen.id,\r\n      dataY,\r\n      dataX,\r\n    };\r\n  } else if (oneXAxis.type === 'time') {\r\n    // TODO: Y 轴时间不考虑\r\n    // x 轴时间\r\n    const dataY: any[][] = [];\r\n    const now = +new Date();\r\n    let hasValue = false;\r\n    series.forEach((serie, index: number) => {\r\n      const oneDataY = [];\r\n      const { dataId: id } = (formItem.dataIds as BindId[]).find(\r\n        (dataId) => dataId.name === serie.name\r\n      );\r\n      if (id) {\r\n        const value = values.find((value) => value.dataId === id);\r\n        if (value) {\r\n          oneDataY.push([now, value.value]);\r\n          hasValue = true;\r\n        }\r\n      }\r\n      dataY[index] = oneDataY;\r\n    });\r\n    if (hasValue) {\r\n      // 说明有线有值，无值的线补充一个原值，保证每条线每个时间点都有值\r\n      dataY.forEach((oneDataY, index: number) => {\r\n        if (!oneDataY || oneDataY.length === 0) {\r\n          const last = series[index].data[series[index].data.length - 1];\r\n          // series[index].data.at(-1) 92 版本 chrome 才支持\r\n          // 0 时间， 1 值\r\n          dataY[index] = [[now, last[1]]];\r\n        }\r\n      });\r\n    } else {\r\n      return;\r\n    }\r\n    return {\r\n      id: pen.id,\r\n      dataY: dataY.length === 1 ? dataY[0] : dataY,\r\n    };\r\n  }\r\n  return;\r\n}\r\n\r\n/**\r\n * 配置 echarts option, 并修改 replaceMode\r\n * @param pen 当前画笔\r\n * @param ids 绑定 id 数组\r\n * @param isTime 是否实时，用于折线图与柱状图，若实时多条线\r\n * @param isYCategory 是否 Y 轴为 category，用于折线图与柱状图\r\n */\r\nexport function setEchartsOption(\r\n  pen: ChartPen,\r\n  ids: BindId[],\r\n  isTime: boolean = false,\r\n  isYCategory: boolean = false\r\n) {\r\n  if (pen.name !== 'echarts') {\r\n    console.warn('当前画笔不是 echarts');\r\n    return;\r\n  }\r\n  // 该画笔类型是 echarts\r\n  const echarts = pen.echarts;\r\n  const { xAxis, yAxis } = echarts.option;\r\n  // 单 x 轴\r\n  const oneXAxis = Array.isArray(xAxis) ? xAxis[0] : xAxis;\r\n  const oneYAxis = Array.isArray(yAxis) ? yAxis[0] : yAxis;\r\n  const series = echarts.option.series;\r\n  if (!oneXAxis && !oneYAxis) {\r\n    /**\r\n     * 饼图、仪表盘等\r\n     */\r\n    // 单饼图\r\n    echarts.option.legend = {};\r\n    series[0].data = ids.map((id) => {\r\n      return {\r\n        name: id.name,\r\n        value: 100, // TODO: 该值为初始值\r\n      };\r\n    });\r\n  } else {\r\n    if (isTime) {\r\n      // TODO: 时间类型，只可以 x 轴是时间\r\n      // x 轴时间\r\n      const yType = series[0].type; // 类型，折线或柱状\r\n      const now = +new Date();\r\n      // x 轴时间，若选择多个，即为多线图\r\n      oneXAxis.type = 'time';\r\n      oneXAxis.data = [];\r\n      oneYAxis.type = 'value';\r\n      oneYAxis.data = [];\r\n      echarts.option.legend = {};\r\n      echarts.option.series = ids.map((id) => {\r\n        return {\r\n          name: id.name,\r\n          type: yType,\r\n          data: [[now, 0]], // TODO: 初始值\r\n        };\r\n      });\r\n      echarts.replaceMode = ReplaceMode.Add; // 追加\r\n    } else {\r\n      // x 轴分类，或 y 轴分类\r\n      const [categoryAxis, valueAxis] = isYCategory\r\n        ? [oneYAxis, oneXAxis]\r\n        : [oneXAxis, oneYAxis];\r\n      categoryAxis.type = 'category';\r\n      categoryAxis.data = ids.map((id) => id.name);\r\n      valueAxis.type = 'value';\r\n      valueAxis.data = [];\r\n      series.length = 1;\r\n      series[0].data.length = ids.length;\r\n      echarts.replaceMode = ReplaceMode.Replace; // 替换\r\n    }\r\n  }\r\n  const meta2d = pen.calculative.canvas.parent;\r\n  meta2d.setValue({ id: pen.id, echarts }, { render: false, doEvent: false });\r\n}\r\n\r\nfunction onRenderPenRaw(pen: Pen) {\r\n  const img = new Image();\r\n  img.src = pen.calculative.singleton?.echart?.getDataURL({\r\n    pixelRatio: 2,\r\n  });\r\n  pen.calculative.img = img;\r\n}\r\n\r\nfunction updateOption(_option, ratio) {\r\n  const option = deepClone(_option);\r\n  // if (option.grid) {\r\n  //   let props = ['top', 'bottom', 'left', 'right'];\r\n  //   for (let i = 0; i < props.length; i++) {\r\n  //     if (Array.isArray(option.grid)) {\r\n  //       option.grid.forEach((item) => {\r\n  //         if (!isNaN(item[props[i]])) {\r\n  //           item[props[i]] *= ratio;\r\n  //         }\r\n  //       });\r\n  //     } else {\r\n  //       if (!isNaN(option.grid[props[i]])) {\r\n  //         option.grid[props[i]] *= ratio;\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  if (option.dataZoom) {\r\n    let props = ['right', 'top', 'width', 'height', 'left', 'bottom'];\r\n    for (let i = 0; i < props.length; i++) {\r\n      option.dataZoom.forEach((item) => {\r\n        if (!isNaN(item[props[i]])) {\r\n          item[props[i]] *= ratio;\r\n        }\r\n      });\r\n    }\r\n  }\r\n  deepSetValue(option, keyWords, ratio);\r\n  return option;\r\n}\r\n\r\nfunction dotNotationToObject(dotNotationObj) {\r\n  const result = {};\r\n  Object.keys(dotNotationObj).forEach((dotNotationStr) => {\r\n    const keys = dotNotationStr.split('.');\r\n    let current = result;\r\n    keys.forEach((key, index) => {\r\n      const isArrayIndex = !isNaN(parseInt(key));\r\n      // 如果是最后一个 key，直接赋值\r\n      if (index === keys.length - 1) {\r\n        if (isArrayIndex) {\r\n          if (!Array.isArray(current)) {\r\n            current = [];\r\n          }\r\n          current[parseInt(key)] = dotNotationObj[dotNotationStr];\r\n        } else {\r\n          current[key] = dotNotationObj[dotNotationStr];\r\n        }\r\n      } else {\r\n        if (isArrayIndex) {\r\n          const arrayIndex = parseInt(key);\r\n          if (!Array.isArray(current)) {\r\n            if (!current[keys[index - 1]]) {\r\n            }\r\n          }\r\n          if (!current[arrayIndex]) {\r\n            current[arrayIndex] = {};\r\n          }\r\n          if (Array.isArray(current)) {\r\n            //series 空数组问题\r\n            for (let i = 0; i < parseInt(key); i++) {\r\n              if (!current[i]) {\r\n                current[i] = {};\r\n              }\r\n            }\r\n          }\r\n          current = current[arrayIndex];\r\n        } else {\r\n          if (!current[key]) {\r\n            if (key === 'series') {\r\n              current[key] = [];\r\n            } else {\r\n              current[key] = {};\r\n            }\r\n          }\r\n          current = current[key];\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  return result;\r\n}\r\n","import { register as meta2dRegister } from '@meta2d/core';\r\n\r\nimport { echarts } from './echarts';\r\nimport { highcharts } from './highcharts';\r\nimport { lightningCharts } from './LightningChart';\r\n\r\nexport function register(_echarts?: any) {\r\n  _echarts && (globalThis.echarts = _echarts);\r\n  meta2dRegister({ echarts });\r\n}\r\n\r\nexport function registerHighcharts(_highcharts?: any) {\r\n  _highcharts && (globalThis.Highcharts = _highcharts);\r\n  meta2dRegister({ highcharts });\r\n}\r\n\r\nexport function registerLightningChart(_lightningCharts?: any) {\r\n  _lightningCharts && (globalThis.lcjs = _lightningCharts);\r\n  meta2dRegister({ lightningCharts });\r\n}\r\n","import { calcRightBottom, Rect, ChartData, Pen } from '@meta2d/core';\r\n\r\nexport interface Pos {\r\n  row: number;\r\n  col: number;\r\n  lineRow?: number;\r\n  lineCol?: number;\r\n  allRow?:number;\r\n  allCol?:number;\r\n}\r\n\r\nexport enum ReplaceMode {\r\n  Add,\r\n  Replace,\r\n  ReplaceAll,\r\n}\r\nexport interface formPen extends Pen {\r\n  optionPos?: number[];\r\n  direction?: string;\r\n  checkboxWidth?: number;\r\n  isForbidden?: boolean;\r\n  options?: {\r\n    isForbidden?: boolean;\r\n    isChecked?: boolean;\r\n    background?: string;\r\n    text?: string;\r\n  }[];\r\n  optionHeight?: number;\r\n  checkboxHeight?: number;\r\n  calculative?: {\r\n    barRect?: Rect;\r\n    ballRect?: Rect;\r\n    texts?: any[];\r\n    activeCell?: Pos;\r\n    hoverCell?: Pos;\r\n    inputCell?: Pos;\r\n    isUpdateData?: boolean;\r\n    isHover?: boolean;\r\n    isInput?: boolean;\r\n    maxOffsetY?:number;\r\n    stap?:number;\r\n  } & Pen['calculative'];\r\n  checked?: any;\r\n  onColor?: string;\r\n  disable?: boolean;\r\n  disableOnColor?: string;\r\n  offColor?: string;\r\n  offStrokeColor?: string;\r\n  onStrokeColor?: string;\r\n  disableOffColor?: string;\r\n  _textWidth?: number;\r\n  _fontSize?: number;\r\n  unit?: string;\r\n  sliderWidth?: number;\r\n  sliderHeight?: number;\r\n  barHeight?: number;\r\n  value?: number | string;\r\n  min?: number;\r\n  max?: number;\r\n  table?: {\r\n    rowHeight?: number;\r\n    colWidth?: number;\r\n    header?: {\r\n      data?: any;\r\n      show?: boolean;\r\n      height?: number;\r\n      fontWeight?: number;\r\n    };\r\n    data?: any[];\r\n  };\r\n  colPos?: number[];\r\n  rowPos?: number[];\r\n  tableWidth?: number;\r\n  tableHeight?: number;\r\n  isInit?: boolean;\r\n  rowHeight?: number;\r\n  colWidth?: number;\r\n  styles?: {\r\n    row?: number;\r\n    col?: number;\r\n    color?: string;\r\n    background?: string;\r\n    width?: number;\r\n    height?: number;\r\n    wheres?: { comparison?: string; key?: string; value?: string }[];\r\n    pens?: formPen[];\r\n  }[];\r\n  data?: any;\r\n  isFirstTime?: boolean;\r\n  replaceMode?: ReplaceMode;\r\n  timer?: any;\r\n  bordered?: boolean;\r\n  vLine?: boolean;\r\n  hLine?: boolean;\r\n  stripe?: boolean; //是否显示斑马纹\r\n  stripeColor?: string; //斑马纹颜色\r\n  hasHeader?: boolean; //是否显示表头\r\n  btnBackground?: string;\r\n  colStyle?: any;\r\n  maxNum?:number; //最大展示数量\r\n  offsetY?:number;\r\n  interval?:any;\r\n  oldY?:number;\r\n  row?:number;\r\n  col?:number;\r\n  swiper?:boolean; //是否轮播\r\n  initScale?:number;\r\n  initWorldRect?:Rect;\r\n}\r\n\r\nexport interface cellData extends ChartData {\r\n  row: number;\r\n  col: number;\r\n  value: string;\r\n}\r\n\r\nexport function getTextLength(text: string, pen: any) {\r\n  const textScale = (pen.calculative.worldRect.height * 14) / 16;\r\n  const chinese = text.match(/[\\u4e00-\\u9fa5]/g) || '';\r\n  const chineseLen = chinese.length;\r\n  const width =\r\n    (text.length - chineseLen) * textScale * 0.6 + chineseLen * textScale;\r\n  return width;\r\n}\r\n\r\nexport function initOptions(pen: any) {\r\n  if (pen.direction == 'horizontal') {\r\n    const optionPos = [];\r\n    let textLength = 0;\r\n    const h = pen.height;\r\n    pen.checkboxHeight = h;\r\n    pen.options.forEach((item: any, index: number) => {\r\n      optionPos.push(index * (40 + h) + textLength);\r\n      textLength += getTextLength(item.text, pen);\r\n    });\r\n    pen.optionPos = optionPos;\r\n    const width = optionPos.length * (40 + h) + textLength;\r\n    pen.checkboxWidth = width;\r\n    pen.width = width;\r\n    pen.calculative.width = width;\r\n    pen.calculative.worldRect = {\r\n      x: pen.x,\r\n      y: pen.y,\r\n      height: pen.height,\r\n      width: pen.width,\r\n      center: {\r\n        x: pen.x + pen.width / 2,\r\n        y: pen.y + pen.height / 2,\r\n      },\r\n    };\r\n    calcRightBottom(pen.calculative.worldRect);\r\n  } else if (pen.direction == 'vertical') {\r\n    if (pen.optionInterval == undefined) {\r\n      pen.optionInterval = 20;\r\n    }\r\n    if (!pen.optionHeight) {\r\n      pen.optionHeight = 20;\r\n    }\r\n    const optionPos = [];\r\n    pen.options.forEach((item: any, index: number) => {\r\n      optionPos.push(index * (pen.optionInterval + pen.optionHeight));\r\n    });\r\n    pen.optionPos = optionPos;\r\n    const height = optionPos[optionPos.length - 1] + pen.optionHeight;\r\n    pen.checkboxHeight = height;\r\n    if (!pen.width) {\r\n      pen.height = height;\r\n      pen.calculative.height = height;\r\n      pen.calculative.worldRect = {\r\n        x: pen.x,\r\n        y: pen.y,\r\n        height: pen.height,\r\n        width: pen.width,\r\n        center: {\r\n          x: pen.x + pen.width / 2,\r\n          y: pen.y + pen.height / 2,\r\n        },\r\n      };\r\n      calcRightBottom(pen.calculative.worldRect);\r\n    }\r\n  }\r\n}\r\n","import { formPen, cellData, Pos, ReplaceMode } from './common';\r\nimport { Point } from '@meta2d/core/src/point';\r\nimport { Rect } from '@meta2d/core/src/rect';\r\nimport { calcRightBottom, calcTextLines, deepClone } from '@meta2d/core';\r\n\r\nexport function table2(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.onAdd) {\r\n    pen.onAdd = onAdd;\r\n    if (!pen.rowPos || !pen.colPos || !pen.calculative.maxOffsetY) {\r\n      pen.onAdd(pen);\r\n    }\r\n    pen.onMouseMove = onMouseMove;\r\n    pen.onMouseLeave = onMouseLeave;\r\n    pen.onMouseDown = onMouseDown;\r\n    pen.onShowInput = onShowInput;\r\n    pen.onInput = onInput;\r\n    pen.onValue = onValue;\r\n    pen.onBeforeValue = beforeValue;\r\n    pen.onMouseEnter = onMouseEnter;\r\n    pen.onWheel = onWheel;\r\n    pen.onDestroy = onDestroy;\r\n  }\r\n  if(pen.data.length !== pen.rowPos.length){\r\n    pen.initWorldRect = null;\r\n    pen.calculative.isUpdateData = true;\r\n    pen.onValue(pen);\r\n  }\r\n  if(pen.data[0].length !== pen.colPos.length){\r\n    pen.initWorldRect = null;\r\n    pen.calculative.isUpdateData = true;\r\n    pen.onValue(pen);\r\n  }\r\n\r\n  const data = pen.calculative.canvas.store.data;\r\n  const options = pen.calculative.canvas.store.options;\r\n\r\n  pen.color = pen.color || data.color || options.color;\r\n  pen.textColor =\r\n    pen.textColor || pen.color || data.textColor || options.textColor;\r\n  pen.activeColor = pen.activeColor || options.activeColor;\r\n  pen.hoverColor = pen.hoverColor || options.hoverColor;\r\n  pen.activeBackground = pen.activeBackground || options.activeBackground;\r\n  pen.hoverBackground = pen.hoverBackground || options.hoverBackground;\r\n  if (!pen.hasHeader) {\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    const { x, y, width, height } = pen.calculative.worldRect;\r\n    ctx.fillStyle = '#fff0';\r\n    ctx.rect(x-1, y-1, width+2, height+2);\r\n    ctx.fill();\r\n    ctx.clip();\r\n  }\r\n  // 画网格线\r\n  drawGridLine(ctx, pen);\r\n\r\n  // 画单元格\r\n  drawCell(ctx, pen);\r\n\r\n  // 画title\r\n  drawNote(ctx, pen);\r\n  ctx.restore();\r\n  pen.isFirstTime = false;\r\n}\r\n\r\nfunction drawNote(ctx: CanvasRenderingContext2D, pen: any) {\r\n  if (!pen.calculative.hover) {\r\n    return;\r\n  }\r\n  if (!pen.calculative.hoverCell) {\r\n    return;\r\n  }\r\n  if (pen.calculative.isInput) {\r\n    return;\r\n  }\r\n  if (!pen.calculative.isHover) {\r\n    return;\r\n  }\r\n  let rect = pen.calculative.worldRect;\r\n  let mousePos = pen.calculative.canvas.mousePos;\r\n  if (\r\n    !(\r\n      mousePos.x > rect.x &&\r\n      mousePos.x < rect.x + rect.width &&\r\n      mousePos.y > rect.y &&\r\n      mousePos.y < rect.y + rect.height\r\n    )\r\n  ) {\r\n    pen.calculative.hover = false;\r\n    pen.calculative.isHover = false;\r\n    pen.calculative.hoverCell = undefined;\r\n    return;\r\n  }\r\n\r\n  const { row, col } = pen.calculative.hoverCell;\r\n  const { x, y } = pen.calculative.canvas.mousePos;\r\n  if (!pen.data[row]) {\r\n    return;\r\n  }\r\n  let text = pen.data[row][col];\r\n  if (typeof text === 'object' || !text) {\r\n    return;\r\n  }\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.textAlign = 'start';\r\n  ctx.textBaseline = 'middle';\r\n  ctx.font = ctx.font =\r\n    (pen.calculative.fontStyle || '') +\r\n    ' normal ' +\r\n    (pen.calculative.fontWeight || '') +\r\n    ' ' +\r\n    (pen.calculative.fontSize || 12) +\r\n    'px ' +\r\n    pen.calculative.fontFamily;\r\n\r\n  const noteWidth = ctx.measureText(text).width;\r\n  ctx.beginPath();\r\n  ctx.fillStyle = '#fff';\r\n  ctx.strokeStyle = '#000';\r\n  ctx.moveTo(x, y);\r\n  ctx.rect(x - 10, y, noteWidth + 20, 20);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n\r\n  ctx.beginPath();\r\n  ctx.fillStyle = '#000';\r\n  ctx.fillText(text, x, y + 10);\r\n  ctx.restore();\r\n}\r\n\r\nfunction initRect(pen: formPen) {\r\n  const colPos = [];\r\n  const rowPos = [];\r\n  const colStyle = {};\r\n\r\n  if (!pen.rowHeight) {\r\n    pen.rowHeight = 40;\r\n  }\r\n  if (!pen.colWidth) {\r\n    pen.colWidth = 150;\r\n  }\r\n  let width = 0;\r\n  //获取所有col width\r\n  const _col =\r\n    pen.styles &&\r\n    pen.styles.filter((item) => {\r\n      return item.col !== undefined && item.row === undefined && item.width;\r\n    });\r\n  let _colWidthMap = {};\r\n  _col &&\r\n    _col.forEach((_c) => {\r\n      _colWidthMap[_c.col] = _c.width;\r\n    });\r\n  for (let i = 0; i < pen.data[0].length; i++) {\r\n    width +=\r\n      (_colWidthMap[i] || pen.colWidth) *\r\n      pen.calculative.canvas.store.data.scale;\r\n    colPos.push(width);\r\n\r\n    let style =\r\n      pen.styles &&\r\n      pen.styles.filter((item) => {\r\n        return item.col === i && item.row === undefined;\r\n      });\r\n    if (style) {\r\n      colStyle[i] = style[0];\r\n    }\r\n  }\r\n\r\n  let height = 0;\r\n\r\n  //获取所有row height\r\n  const _row =\r\n    pen.styles &&\r\n    pen.styles.filter((item) => {\r\n      return item.col === undefined && item.row !== undefined && item.height;\r\n    });\r\n  let _rowHeightMap = {};\r\n  _row &&\r\n    _row.forEach((_r) => {\r\n      _rowHeightMap[_r.row] = _r.height;\r\n    });\r\n  // 显示表头\r\n  let finalHight = height;\r\n  for (let j = 0; j < pen.data.length; j++) {\r\n    height +=\r\n      (_rowHeightMap[j] || pen.rowHeight) *\r\n      pen.calculative.canvas.store.data.scale;\r\n    rowPos.push(height);\r\n    if (j < pen.maxNum) {\r\n      finalHight = height;\r\n    }\r\n  }\r\n  pen.calculative.maxOffsetY =\r\n  (height - finalHight) / pen.calculative.canvas.store.data.scale;\r\n  if(pen.initWorldRect){\r\n    return;\r\n  }\r\n  pen.colPos = colPos;\r\n  pen.rowPos = rowPos;\r\n  pen.colStyle = colStyle;\r\n  pen.initScale = pen.calculative.canvas.store.data.scale;\r\n  pen.tableWidth = width;\r\n  pen.tableHeight = finalHight || height;\r\n  //   if (!pen.width) {\r\n  pen.calculative.width = width;\r\n  pen.calculative.height = finalHight || height;\r\n  pen.calculative.width = width;\r\n  pen.calculative.height = finalHight || height;\r\n \r\n  if (!pen.height) {\r\n    pen.height = pen.calculative.height;\r\n  }\r\n  if (!pen.width) {\r\n    pen.width = pen.calculative.width;\r\n  }\r\n  let x = pen.x;\r\n  let y = pen.y;\r\n  if (pen.parentId) {\r\n    let parentPen = pen.calculative.canvas.store.pens[pen.parentId];\r\n    x =\r\n      parentPen.calculative.worldRect.x +\r\n      parentPen.calculative.worldRect.width * pen.x;\r\n    y =\r\n      parentPen.calculative.worldRect.y +\r\n      parentPen.calculative.worldRect.height * pen.y;\r\n  }\r\n  pen.calculative.worldRect = {\r\n    x,\r\n    y,\r\n    height: pen.calculative.height,\r\n    width: pen.calculative.width,\r\n    center: {\r\n      x: pen.x + pen.calculative.width / 2,\r\n      y: pen.y + pen.calculative.height / 2,\r\n    },\r\n  };\r\n  pen.width = pen.calculative.width;\r\n  pen.height = pen.calculative.height;\r\n  if(!pen.initWorldRect){\r\n    pen.initWorldRect = {\r\n      width: pen.calculative.worldRect.width,\r\n      height: pen.calculative.worldRect.height,\r\n    }\r\n  }\r\n  calcRightBottom(pen.calculative.worldRect);\r\n  //   }\r\n}\r\n\r\nfunction drawGridLine(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.colPos) {\r\n    return;\r\n  }\r\n  // const worldRect = pen.calculative.worldRect;\r\n  const { x, y, width, height, ex, ey } = pen.calculative.worldRect;\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = pen.color;\r\n\r\n  // 绘画最外框\r\n  // ctx.beginPath();\r\n  // ctx.rect(worldRect.x, worldRect.y, worldRect.width, worldRect.height);\r\n  let wr = pen.calculative.borderRadius || 0,\r\n    hr = wr;\r\n  if (wr < 1) {\r\n    wr = width * wr;\r\n    hr = height * hr;\r\n  }\r\n  let r = wr < hr ? wr : hr;\r\n  if (width < 2 * r) {\r\n    r = width / 2;\r\n  }\r\n  if (height < 2 * r) {\r\n    r = height / 2;\r\n  }\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(ex, y, ex, ey, r);\r\n  ctx.arcTo(ex, ey, x, ey, r);\r\n  ctx.arcTo(x, ey, x, y, r);\r\n  ctx.arcTo(x, y, ex, y, r);\r\n\r\n  if (pen.background) {\r\n    ctx.fillStyle = pen.background;\r\n    ctx.fill();\r\n  }\r\n  if (pen.bordered !== false) {\r\n    ctx.strokeStyle = pen.borderColor || '#424B61';\r\n    ctx.stroke();\r\n  }\r\n  if (pen.hLine !== false) {\r\n    // 绘画行的线\r\n    let last = pen.rowPos[pen.rowPos.length - 1];\r\n    if (pen.hasHeader) {\r\n      ctx.beginPath();\r\n      ctx.moveTo(\r\n        pen.calculative.worldRect.x,\r\n        pen.calculative.worldRect.y +\r\n          (pen.rowPos[0] * pen.calculative.worldRect.height) / pen.tableHeight\r\n      );\r\n      ctx.lineTo(\r\n        pen.calculative.worldRect.ex,\r\n        pen.calculative.worldRect.y +\r\n          (pen.rowPos[0] * pen.calculative.worldRect.height) / pen.tableHeight\r\n      );\r\n      ctx.strokeStyle = pen.borderColor || '#424B61';\r\n      ctx.stroke();\r\n    }\r\n    for (const item of pen.rowPos) {\r\n      if (item === last) {\r\n        continue;\r\n      }\r\n      const y =\r\n        (item * pen.calculative.worldRect.height) / pen.tableHeight -\r\n        pen.offsetY * pen.calculative.canvas.store.data.scale;\r\n      if (pen.hasHeader) {\r\n        if (y < 0 + pen.rowPos[0] || y > pen.calculative.worldRect.height) {\r\n          continue;\r\n        }\r\n      } else {\r\n        if (y < 0 || y > pen.calculative.worldRect.height) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo(pen.calculative.worldRect.x, pen.calculative.worldRect.y + y);\r\n      ctx.lineTo(pen.calculative.worldRect.ex, pen.calculative.worldRect.y + y);\r\n      ctx.strokeStyle = pen.borderColor || '#424B61';\r\n      ctx.stroke();\r\n    }\r\n  }\r\n  if (pen.vLine !== false) {\r\n    // 绘画列的线\r\n    let last = pen.colPos[pen.colPos.length - 1];\r\n    pen.colPos.forEach((item: number, i: number) => {\r\n      if (item === last) {\r\n        return;\r\n      }\r\n      const x = (item * pen.calculative.worldRect.width) / pen.tableWidth;\r\n      ctx.beginPath();\r\n      ctx.moveTo(pen.calculative.worldRect.x + x, pen.calculative.worldRect.y);\r\n      ctx.lineTo(pen.calculative.worldRect.x + x, pen.calculative.worldRect.ey);\r\n      ctx.strokeStyle = pen.borderColor || '#424B61';\r\n      ctx.stroke();\r\n    });\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawCell(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.colPos) {\r\n    return;\r\n  }\r\n\r\n  if (!pen.calculative.texts) {\r\n    pen.calculative.texts = [];\r\n  }\r\n\r\n  const textScale = 1;\r\n\r\n  for (let i = 0; i < pen.rowPos.length; i++) {\r\n    if (pen.hasHeader && i === 1) {\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      const { x, y, width, height } = pen.calculative.worldRect;\r\n      ctx.fillStyle = '#fff0';\r\n      ctx.rect(\r\n        x-1,\r\n        y +\r\n          (pen.rowPos[0] * pen.calculative.worldRect.height) / pen.tableHeight-1,\r\n        width+2,\r\n        height -\r\n          (pen.rowPos[0] * pen.calculative.worldRect.height) / pen.tableHeight+2\r\n      );\r\n      ctx.fill();\r\n      ctx.clip();\r\n    }\r\n    let { style: rowStyle } = getRow(pen, i);\r\n    for (let j = 0; j < pen.colPos.length; j++) {\r\n      let { value: cell, style: cellStyle } = getCell(pen, i, j);\r\n      let isSuccess = true;\r\n      //样式条件成立\r\n      if(Array.isArray(cellStyle) && cellStyle.length > 0){\r\n        let successIdx = 0;\r\n        cellStyle.forEach((item: any, idx: number) => {\r\n          if(item.wheres){\r\n            let success = item.wheres.every((where: any) => {\r\n              const fn = new Function(\r\n                'attr',\r\n                `return attr ${where.comparison} ${where.value}`\r\n              );\r\n              return fn(cell);\r\n            });\r\n            if(success){\r\n              successIdx = idx;\r\n            }\r\n          }\r\n        });\r\n        cellStyle = cellStyle[successIdx];\r\n      }else{\r\n        if (\r\n          (cellStyle as any).wheres &&\r\n          Array.isArray((cellStyle as any).wheres)\r\n        ) {\r\n          isSuccess = false;\r\n          isSuccess = (cellStyle as any).wheres.every(function (where: any) {\r\n            const fn = new Function(\r\n              'attr',\r\n              `return attr ${where.comparison} ${where.value}`\r\n            );\r\n            return fn(cell);\r\n          });\r\n        }\r\n      }\r\n      let color = pen.color;\r\n      let textColor = pen.textColor || pen.color;\r\n      let background = null;\r\n      let fontSize = null;\r\n      let fontWeight = null;\r\n      let fontStyle = null;\r\n      if (isSuccess) {\r\n        color =\r\n          (cellStyle as any).color || (rowStyle as any).color || pen.color;\r\n        textColor =\r\n          (cellStyle as any).textColor ||\r\n          (rowStyle as any).textColor ||\r\n          pen.textColor;\r\n        background =\r\n          (cellStyle as any).background || (rowStyle as any).background;\r\n        fontSize =\r\n          ((cellStyle as any).fontSize || (rowStyle as any).fontSize || 0) *\r\n          pen.calculative.canvas.store.data.scale;\r\n        fontWeight =\r\n          (cellStyle as any).fontWeight || (rowStyle as any).fontWeight;\r\n        fontStyle = (cellStyle as any).fontStyle || (rowStyle as any).fontStyle;\r\n      }\r\n      let activeColor: any;\r\n      if (pen.stripe) {\r\n        if (pen.hasHeader !== false) {\r\n          if (i % 2 === 1) {\r\n            background = background || pen.stripeColor || '#407FFF1F';\r\n          }\r\n        } else {\r\n          if (i % 2 === 0) {\r\n            background = background || pen.stripeColor || '#407FFF1F';\r\n          }\r\n        }\r\n      }\r\n      // 选中\r\n      if (\r\n        pen.calculative.active &&\r\n        pen.calculative.activeCell?.row === i &&\r\n        pen.calculative.activeCell?.col === j\r\n      ) {\r\n        color = pen.activeColor;\r\n        background = pen.activeBackground;\r\n        activeColor = color;\r\n        textColor = pen.activeTextColor || pen.activeColor;\r\n      }\r\n      // hover\r\n      if (\r\n        pen.calculative.hover &&\r\n        pen.calculative.hoverCell?.row === i &&\r\n        pen.calculative.hoverCell?.col === j\r\n      ) {\r\n        color = pen.hoverColor;\r\n        background = pen.hoverBackground;\r\n        textColor = pen.hoverTextColor || pen.hoverColor;\r\n        activeColor = color;\r\n      }\r\n\r\n      const rect = getCellRect(pen, i, j);\r\n      if (\r\n        rect.y + rect.height < pen.calculative.worldRect.y ||\r\n        rect.y > pen.calculative.worldRect.height + pen.calculative.worldRect.y\r\n      ) {\r\n        continue;\r\n      }\r\n      // 有背景\r\n      if (background) {\r\n        ctx.save();\r\n        ctx.beginPath();\r\n        ctx.fillStyle = background;\r\n        ctx.fillRect(\r\n          rect.x,\r\n          rect.y,\r\n          rect.width + 0.25 * pen.calculative.canvas.store.data.scale,\r\n          rect.height\r\n        );\r\n        ctx.restore();\r\n      }\r\n\r\n      // 选中或hover\r\n      if (activeColor) {\r\n        ctx.save();\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = activeColor;\r\n        ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n        ctx.restore();\r\n      }\r\n\r\n      // 绘画文本\r\n      pen.calculative.worldTextRect = rect;\r\n\r\n      let rowText = pen.calculative.texts[i];\r\n      if (!pen.calculative.texts[i]) {\r\n        rowText = [];\r\n        pen.calculative.texts.push(rowText);\r\n      }\r\n\r\n      if (rowText[j] == null) {\r\n        if (typeof cell === 'object') {\r\n          // TODO 配置 {} 代表添加节点 考虑是否有表头\r\n          const _colPen =\r\n            pen.styles &&\r\n            pen.styles.filter((item) => {\r\n              return item.col === j && item.row === undefined && item.pens;\r\n            });\r\n          if (_colPen.length > 0) {\r\n            rowText[j] = '';\r\n            if (pen.isFirstTime) {\r\n              if (pen.maxNum) {\r\n                if (pen.hasHeader && i >= pen.maxNum) {\r\n                  cell.visible = false;\r\n                }\r\n              }\r\n              let childrenPen = JSON.parse(JSON.stringify(_colPen[0].pens));\r\n              childrenPen.forEach((item: formPen) => {\r\n                Object.assign(item, { row: i, col: j }, cell);\r\n                item.activeBackground = item.background;\r\n                item.hoverBackground = item.background;\r\n                item.activeColor = item.color;\r\n                item.hoverColor = item.color;\r\n                item.activeTextColor = item.textColor;\r\n                item.hoverTextColor = item.textColor;\r\n                item.height *= pen.calculative.canvas.store.data.scale;\r\n                item.width *= pen.calculative.canvas.store.data.scale;\r\n              });\r\n              calcChildrenRect(pen, rect, childrenPen);\r\n              pen.calculative.canvas.parent.pushChildren(pen, childrenPen);\r\n            }\r\n            continue;\r\n          }\r\n        } else if (cell === undefined) {\r\n          rowText[j] = '';\r\n        } else {\r\n          rowText[j] = cell.text || cell + '';\r\n        }\r\n\r\n        if (!rowText[j]) {\r\n          continue;\r\n        }\r\n        // 计算换行和省略号\r\n        rowText[j] = calcTextLines(pen, rowText[j]);\r\n      }\r\n\r\n      if (!rowText[j]) {\r\n        continue;\r\n      }\r\n\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      ctx.fillStyle = textColor;\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.font =\r\n        (fontStyle || pen.calculative.fontStyle || '') +\r\n        ' normal ' +\r\n        (fontWeight || pen.calculative.fontWeight || '') +\r\n        ' ' +\r\n        (fontSize || pen.calculative.fontSize || 12) * textScale +\r\n        'px ' +\r\n        pen.calculative.fontFamily;\r\n      let textAlign = pen.colStyle && pen.colStyle[j]?.textAlign;\r\n      if (textAlign) {\r\n        ctx.textAlign = textAlign;\r\n      }\r\n      if (rowText[j].length === 1) {\r\n        if (textAlign === 'left') {\r\n          ctx.fillText(rowText[j][0], rect.x, rect.y + rect.height / 2);\r\n        } else if (textAlign === 'right') {\r\n          ctx.fillText(\r\n            rowText[j][0],\r\n            rect.x + rect.width,\r\n            rect.y + rect.height / 2\r\n          );\r\n        } else {\r\n          ctx.fillText(\r\n            rowText[j][0],\r\n            rect.x + rect.width / 2,\r\n            rect.y + rect.height / 2\r\n          );\r\n        }\r\n      } else {\r\n        const y = 0.55;\r\n        const lineHeight =\r\n          (fontSize || pen.calculative.fontSize) *\r\n          pen.calculative.lineHeight *\r\n          textScale;\r\n\r\n        const h = rowText[j].length * lineHeight;\r\n        let top = (rect.height - h) / 2;\r\n        if (textAlign === 'left') {\r\n          rowText[j].forEach((text, i) => {\r\n            ctx.fillText(text, rect.x, rect.y + top + (i + y) * lineHeight);\r\n          });\r\n        } else if (textAlign === 'right') {\r\n          rowText[j].forEach((text, i) => {\r\n            ctx.fillText(\r\n              text,\r\n              rect.x + rect.width,\r\n              rect.y + top + (i + y) * lineHeight\r\n            );\r\n          });\r\n        } else {\r\n          rowText[j].forEach((text, i) => {\r\n            ctx.fillText(\r\n              text,\r\n              rect.x + rect.width / 2,\r\n              rect.y + top + (i + y) * lineHeight\r\n            );\r\n          });\r\n        }\r\n      }\r\n      ctx.restore();\r\n    }\r\n  }\r\n}\r\n\r\n// 添加table节点回调\r\nfunction onAdd(pen: formPen) {\r\n  createInterval(pen);\r\n  if (!pen.children?.length) {\r\n    pen.isFirstTime = true;\r\n  }\r\n  if (!pen.offsetY) {\r\n    pen.offsetY = 0;\r\n  }\r\n  initRect(pen);\r\n}\r\n\r\nfunction onShowInput(pen: any, e: Point) {\r\n  // 没有活动单元格\r\n  if (!pen.calculative.hoverCell) {\r\n    return;\r\n  }\r\n\r\n  const { value: cell } = getCell(\r\n    pen,\r\n    pen.calculative.hoverCell.row,\r\n    pen.calculative.hoverCell.col\r\n  );\r\n  // 子节点，非文本\r\n  if (typeof cell === 'object') {\r\n    return;\r\n  }\r\n  pen.calculative.isHover = false;\r\n  pen.calculative.isInput = true;\r\n  pen.calculative.canvas.render();\r\n  pen.calculative.inputCell = pen.calculative.hoverCell;\r\n\r\n  const rect = getCellRect(\r\n    pen,\r\n    pen.calculative.hoverCell.row,\r\n    pen.calculative.hoverCell.col\r\n  );\r\n  pen.calculative.tempText = cell.text || cell + '';\r\n  pen.calculative.canvas.showInput(pen, rect, '#ffffff');\r\n}\r\n\r\n//将输入的数据写入到对应的data中\r\nfunction onInput(pen: formPen, text: string) {\r\n  if (!pen.calculative.inputCell) {\r\n    return;\r\n  }\r\n\r\n  setCellText(\r\n    pen,\r\n    pen.calculative.inputCell.row,\r\n    pen.calculative.inputCell.col,\r\n    text\r\n  );\r\n  pen.calculative.isInput = false;\r\n  pen.calculative.isHover = true;\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction onMouseMove(pen: formPen, e: Point) {\r\n  if (pen.timer) {\r\n    pen.calculative.isHover = false;\r\n    clearTimeout(pen.timer);\r\n  }\r\n  pen.timer = setTimeout(() => {\r\n    pen.calculative.isHover = true;\r\n    pen.calculative.canvas.render();\r\n  }, 500);\r\n  pen.calculative.hoverCell = getCellIndex(pen, e);\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction onMouseLeave(pen: formPen, e: Point) {\r\n  createInterval(pen);\r\n  pen.calculative.hoverCell = undefined;\r\n  //   pen.calculative.activeCell = undefined;\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction onMouseDown(pen: formPen, e: Point) {\r\n  pen.calculative.activeCell = getCellIndex(pen, e);\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\n// 根据坐标，计算在哪个cell\r\nfunction getCellIndex(pen: formPen, e: Point): Pos {\r\n  const scaleX = pen.calculative.worldRect.width / pen.tableWidth;\r\n  const scaleY = pen.calculative.worldRect.height / pen.tableHeight;\r\n\r\n  const pos: Pos = { row: 0, col: 0 };\r\n\r\n  for (let i = 0; i < pen.colPos.length; i++) {\r\n    if (e.x > pen.calculative.worldRect.x + pen.colPos[i] * scaleX) {\r\n      pos.col = i + 1;\r\n    }\r\n  }\r\n  for (let i = 0; i < pen.rowPos.length; i++) {\r\n    if (\r\n      e.y >\r\n      pen.calculative.worldRect.y +\r\n        pen.rowPos[i] * scaleY -\r\n        pen.offsetY * pen.calculative.canvas.store.data.scale\r\n    ) {\r\n      pos.row = i + 1;\r\n    }\r\n  }\r\n\r\n  return pos;\r\n}\r\n\r\n// 根据index获取cell\r\nfunction getCell(pen: formPen, rowIndex: number, colIndex: number) {\r\n  if (!pen.data || !Array.isArray(pen.data)) {\r\n    return;\r\n  }\r\n\r\n  const row = pen.data[rowIndex];\r\n  //TODO 没有获取单独设置 某行 某列 的样式\r\n  const style =\r\n    pen.styles &&\r\n    pen.styles.filter((item) => {\r\n      return item.row === rowIndex && item.col === colIndex;\r\n    });\r\n  if (Array.isArray(row)) {\r\n    return { value: row[colIndex], style: style?.length > 0 ? (style.length>1?style : style[0]) : {} };\r\n  } else if (!row.data || !Array.isArray(row.data)) {\r\n    return;\r\n  }\r\n}\r\n\r\n// 根据index获取getRow\r\nfunction getRow(pen: formPen, rowIndex: number) {\r\n  if (!pen.data || !Array.isArray(pen.data)) {\r\n    return;\r\n  }\r\n\r\n  const row = pen.data[rowIndex];\r\n  //TODO 没有获取单独设置 某行 某列 的样式\r\n  const style =\r\n    pen.styles &&\r\n    pen.styles.filter((item) => {\r\n      return item.row === rowIndex && item.col === undefined;\r\n    });\r\n  if (Array.isArray(row)) {\r\n    return { value: row, style: style?.length > 0 ? style[0] : {} };\r\n  } else if (!row.data || !Array.isArray(row.data)) {\r\n    return;\r\n  }\r\n}\r\n\r\n// 设置cell的文本\r\nfunction setCellText(\r\n  pen: formPen,\r\n  rowIndex: number,\r\n  colIndex: number,\r\n  text: string\r\n) {\r\n  if (!pen.data || !Array.isArray(pen.data)) {\r\n    return;\r\n  }\r\n  pen.isFirstTime = false;\r\n  pen.calculative.texts = undefined;\r\n  let rowData: any = pen.data[rowIndex];\r\n  if (!rowData) {\r\n    return;\r\n  }\r\n\r\n  if (rowData[colIndex] instanceof Object) {\r\n  } else {\r\n    rowData[colIndex] = text;\r\n  }\r\n\r\n  pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n}\r\n\r\n// 计算cell世界坐标区域\r\nfunction getCellRect(pen: formPen, rowIndex: number, colIndex: number) {\r\n  const scaleX = pen.calculative.worldRect.width / pen.tableWidth;\r\n  const scaleY = pen.calculative.worldRect.height / pen.tableHeight;\r\n\r\n  let x = 0;\r\n  let ex = pen.colPos[colIndex] * scaleX;\r\n  if (colIndex > 0) {\r\n    x = pen.colPos[colIndex - 1] * scaleX;\r\n  }\r\n\r\n  let y = 0;\r\n  let ey = pen.rowPos[rowIndex] * scaleY;\r\n  if (rowIndex > 0) {\r\n    y = pen.rowPos[rowIndex - 1] * scaleY;\r\n  }\r\n  let offset = pen.offsetY * pen.calculative.canvas.store.data.scale;\r\n  if (rowIndex === 0 && pen.hasHeader) {\r\n    offset = 0;\r\n  }\r\n  return {\r\n    x: pen.calculative.worldRect.x + x,\r\n    y: pen.calculative.worldRect.y + y - offset,\r\n    ex: pen.calculative.worldRect.x + ex,\r\n    ey: pen.calculative.worldRect.y + ey - offset,\r\n    width: ex - x,\r\n    height: ey - y,\r\n  };\r\n}\r\n\r\n// 计算cell子节点的世界坐标区域\r\nfunction calcChildrenRect(pen: formPen, rect: Rect, children: formPen[]) {\r\n  if(!(children&&children.length)){\r\n    return;\r\n  }\r\n  const scaleX = pen.calculative.worldRect.width / pen.tableWidth;\r\n  const scaleY = pen.calculative.worldRect.height / pen.tableHeight;\r\n  let resizeX = 1;\r\n  let resizeY = 1;\r\n  if(pen.initWorldRect){\r\n    if(pen.calculative.worldRect.width !== pen.initWorldRect.width){\r\n      resizeX = pen.calculative.worldRect.width / pen.initWorldRect.width;\r\n    }\r\n    if(pen.calculative.worldRect.height !== pen.initWorldRect.height){\r\n      resizeY = pen.calculative.worldRect.height / pen.initWorldRect.height;\r\n    }\r\n  }\r\n  // 计算子节点需要的宽高\r\n  let height = 0;\r\n  let lastX = 0;\r\n  let lastY = 0;\r\n  const scale = pen.calculative.canvas.store.data.scale;\r\n  if (children.length > 1) {\r\n    for (const item of children) {\r\n      if (lastX + item.width * scaleX + 20 * scale * scaleX < rect.width) {\r\n        item.x = rect.x + lastX + 10 * scale * scaleX;\r\n        item.y = rect.y + lastY + 10 * scale * scaleY;\r\n\r\n        lastX += (item.width + 10 * scale) * scaleX;\r\n        height = Math.max(height, lastY + (item.height + 10 * scale) * scaleY);\r\n      } else {\r\n        // 超出需要换行\r\n        lastX = 0;\r\n        lastY = height;\r\n        item.x = rect.x + lastX + 10 * scale * scaleX;\r\n        item.y = rect.y + lastY + 10 * scale * scaleY;\r\n\r\n        height += (item.height + 10 * scale) * scaleY;\r\n      }\r\n    }\r\n\r\n    // 垂直居中\r\n    if (height + 20 * scale * scaleY < rect.height) {\r\n      const top = (rect.height - height - 10 * scale * scaleY) / 2;\r\n      for (const item of children) {\r\n        item.y += top;\r\n      }\r\n    }\r\n  } else {\r\n    //一个子图元默认水平垂直居中\r\n    children[0].x = rect.x + (rect.width - children[0].width) / 2;\r\n    children[0].y = rect.y + (rect.height - children[0].height) / 2;\r\n  }\r\n  children.forEach((item: formPen) => {\r\n    item.width = item.width * resizeX;\r\n    item.height = item.height * resizeY;\r\n  });\r\n}\r\n\r\nfunction onValue(pen: formPen) {\r\n  if (pen.calculative.isUpdateData) {\r\n    delete pen.calculative.isUpdateData;\r\n    let temChildren = deepClone(pen.children);\r\n    pen.children = [];\r\n    onAdd(pen);\r\n    temChildren &&\r\n      temChildren.forEach((child: string) => {\r\n        pen.calculative.canvas.delForce(pen.calculative.canvas.findOne(child));\r\n      });\r\n    pen.calculative.texts = undefined;\r\n    // pen.calculative.canvas.active([pen]);\r\n  }\r\n}\r\n\r\nfunction beforeValue(pen: formPen, value: any) {\r\n  pen.calculative.isUpdateData = false;\r\n  if (pen.swiper !== undefined) {\r\n    if (pen.swiper) {\r\n      createInterval(pen);\r\n    } else {\r\n      delInterval(pen);\r\n    }\r\n  }\r\n  if(value.styles){\r\n    pen.initWorldRect = undefined;\r\n  }\r\n  if (\r\n    (value as any).table ||\r\n    (value.col == undefined && value.row == undefined)\r\n  ) {\r\n    if (value.dataY) {\r\n      const replaceMode = pen.replaceMode;\r\n      let data = [];\r\n      if (!replaceMode) {\r\n        //追加\r\n        data = pen.data.concat(value.dataY);\r\n      } else if (replaceMode === ReplaceMode.Replace) {\r\n        //替换\r\n        data = pen.data;\r\n        value.dataX &&\r\n          value.dataX.forEach((item: number, index: number) => {\r\n            data[item] = value.dataY[index];\r\n          });\r\n      } else if (replaceMode === ReplaceMode.ReplaceAll) {\r\n        //替换指定\r\n        if (value.dataX) {\r\n          data[0] = value.dataX;\r\n        } else {\r\n          data[0] = pen.data[0];\r\n        }\r\n        data = data.concat(value.dataY);\r\n      }\r\n      delete value.dataX;\r\n      delete value.dataY;\r\n      pen.calculative.isUpdateData = true;\r\n      return Object.assign(value, { data });\r\n    }\r\n\r\n    if (value.data || value.styles || value.maxNum || value.rowHeight || value.colWidth) {\r\n      pen.calculative.isUpdateData = true;\r\n      pen.initWorldRect = null;\r\n    }\r\n    for (let key of Object.keys(value)) {\r\n      if (key.includes('data.')) {\r\n        pen.calculative.isUpdateData = true;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n  let rowData = pen.data[value.row];\r\n  if (!rowData) {\r\n    return value;\r\n  }\r\n  if (rowData[value.col] instanceof Object) {\r\n  } else {\r\n    rowData[value.col] = value.value;\r\n  }\r\n  setCellText(pen, value.row, value.col, value.value);\r\n  pen.calculative.canvas.render();\r\n  delete value.col;\r\n  delete value.row;\r\n  return value;\r\n}\r\n\r\n//鼠标滚动\r\nfunction onWheel(pen: formPen, e: WheelEvent) {\r\n  if (!pen.locked && !pen.calculative.canvas.store.data.locked) {\r\n    return;\r\n  }\r\n  if (!pen.maxNum) {\r\n    return;\r\n  }\r\n  let offset = 0;\r\n  if (e.deltaY > 0) {\r\n    offset = 4;\r\n  } else {\r\n    offset = -4;\r\n  }\r\n  scroll(pen, offset);\r\n}\r\n\r\n//滚动处理\r\nfunction scroll(pen: formPen, offset: number) {\r\n  if (!pen.offsetY) {\r\n    pen.offsetY = 0;\r\n  }\r\n  pen.offsetY += offset;\r\n  //滚动的最大偏移值\r\n  if (pen.offsetY > pen.calculative.maxOffsetY) {\r\n    pen.offsetY = pen.calculative.maxOffsetY;\r\n  }\r\n  if (pen.offsetY < 0) {\r\n    pen.offsetY = 0;\r\n  }\r\n  //子节点\r\n\r\n  pen.children?.forEach((item) => {\r\n    const _pen: formPen = pen.calculative.canvas.store.pens[item];\r\n    changeChildVisible(pen, _pen);\r\n  });\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\n//控制子节点\r\nfunction changeChildVisible(pen: formPen, _pen: formPen) {\r\n  if (!_pen) {\r\n    return;\r\n  }\r\n  if (!_pen.oldY) {\r\n    _pen.oldY = _pen.y;\r\n  }\r\n  const { y, height } = _pen.calculative.worldRect;\r\n  const { y: penY, height: penH } = pen.calculative.worldRect;\r\n  const scale = pen.calculative.canvas.store.data.scale;\r\n  const scaleY = pen.calculative.worldRect.height / pen.tableHeight;\r\n  const rowHeight = pen.rowHeight; //*scale;\r\n\r\n  //y值更新\r\n  _pen.y = _pen.oldY - (pen.offsetY * scale) / pen.calculative.worldRect.height;\r\n  const oldOffset =\r\n    ((rowHeight * (pen.initScale || 1)) / pen.tableHeight) * pen.maxNum;\r\n  pen.calculative.canvas.updatePenRect(_pen);\r\n\r\n  if (pen.hasHeader) {\r\n    if (_pen.y < pen.rowPos[0] / pen.tableHeight) {\r\n      //显示/隐藏\r\n      _pen.calculative.visible = false;\r\n      _pen.visible = false;\r\n      //颜色及位置更新\r\n      if (_pen.y < pen.rowPos[0] / pen.tableHeight / 2) {\r\n        _pen.oldY += oldOffset;\r\n\r\n        let row = _pen.row + pen.maxNum;\r\n        if (!pen.data[row]) {\r\n          return;\r\n        }\r\n        let rowStyle = deepClone(pen.data[row][_pen.col]);\r\n        if (rowStyle.background) {\r\n          rowStyle.activeBackground = rowStyle.background;\r\n          rowStyle.hoverBackground = rowStyle.background;\r\n        }\r\n        if (rowStyle.color) {\r\n          rowStyle.hoverColor = rowStyle.color;\r\n          rowStyle.activeColor = rowStyle.color;\r\n        }\r\n        if (rowStyle.textColor) {\r\n          rowStyle.activeTextColor = rowStyle.textColor;\r\n          rowStyle.hoverTextColor = rowStyle.textColor;\r\n        }\r\n        Object.assign(_pen, rowStyle, { row: row });\r\n        Object.assign(_pen.calculative, rowStyle, { row: row });\r\n      }\r\n    } else if (_pen.y + _pen.height > 1) {\r\n      //显示/隐藏\r\n      _pen.calculative.visible = false;\r\n      _pen.visible = false;\r\n\r\n      //颜色及位置更新\r\n      if (_pen.y + _pen.height / 2 > 1) {\r\n        _pen.oldY -= oldOffset;\r\n        let row = _pen.row - pen.maxNum;\r\n        if (!pen.data[row]) {\r\n          return;\r\n        }\r\n        let rowStyle = deepClone(pen.data[row][_pen.col]);\r\n        if (rowStyle.background) {\r\n          rowStyle.activeBackground = rowStyle.background;\r\n          rowStyle.hoverBackground = rowStyle.background;\r\n        }\r\n        if (rowStyle.color) {\r\n          rowStyle.hoverColor = rowStyle.color;\r\n          rowStyle.activeColor = rowStyle.color;\r\n        }\r\n        if (rowStyle.textColor) {\r\n          rowStyle.activeTextColor = rowStyle.textColor;\r\n          rowStyle.hoverTextColor = rowStyle.textColor;\r\n        }\r\n        Object.assign(_pen, rowStyle, { row: row });\r\n        Object.assign(_pen.calculative, rowStyle, { row: row });\r\n      }\r\n    } else {\r\n      _pen.visible = true;\r\n      _pen.calculative.visible = true;\r\n    }\r\n  } else {\r\n    if (_pen.y < 0) {\r\n      _pen.calculative.visible = false;\r\n      _pen.visible = false;\r\n\r\n      if (_pen.y < -rowHeight / pen.tableHeight / 2) {\r\n        _pen.oldY += oldOffset;\r\n\r\n        let row = _pen.row + pen.maxNum;\r\n        if (!pen.data[row]) {\r\n          return;\r\n        }\r\n        let rowStyle = deepClone(pen.data[row][_pen.col]);\r\n        if (rowStyle.background) {\r\n          rowStyle.activeBackground = rowStyle.background;\r\n          rowStyle.hoverBackground = rowStyle.background;\r\n        }\r\n        if (rowStyle.color) {\r\n          rowStyle.hoverColor = rowStyle.color;\r\n          rowStyle.activeColor = rowStyle.color;\r\n        }\r\n        if (rowStyle.textColor) {\r\n          rowStyle.activeTextColor = rowStyle.textColor;\r\n          rowStyle.hoverTextColor = rowStyle.textColor;\r\n        }\r\n\r\n        Object.assign(_pen, rowStyle, { row: row });\r\n        Object.assign(_pen.calculative, rowStyle, { row: row });\r\n      }\r\n    } else if (_pen.y + _pen.height > 1) {\r\n      _pen.calculative.visible = false;\r\n      _pen.visible = false;\r\n\r\n      if (_pen.y + _pen.height / 2 > 1) {\r\n        _pen.oldY -= oldOffset;\r\n        let row = _pen.row - pen.maxNum;\r\n        if (!pen.data[row]) {\r\n          return;\r\n        }\r\n        let rowStyle = deepClone(pen.data[row][_pen.col]);\r\n        if (rowStyle.background) {\r\n          rowStyle.activeBackground = rowStyle.background;\r\n          rowStyle.hoverBackground = rowStyle.background;\r\n        }\r\n        if (rowStyle.color) {\r\n          rowStyle.hoverColor = rowStyle.color;\r\n          rowStyle.activeColor = rowStyle.color;\r\n        }\r\n        if (rowStyle.textColor) {\r\n          rowStyle.activeTextColor = rowStyle.textColor;\r\n          rowStyle.hoverTextColor = rowStyle.textColor;\r\n        }\r\n        Object.assign(_pen, rowStyle, { row: row });\r\n        Object.assign(_pen.calculative, rowStyle, { row: row });\r\n      }\r\n    } else {\r\n      _pen.calculative.visible = true;\r\n      _pen.visible = true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction onDestroy(pen: any) {\r\n  delInterval(pen);\r\n}\r\n\r\nfunction delInterval(pen: formPen) {\r\n  if (pen.interval) {\r\n    globalThis.clearInterval(pen.interval);\r\n    pen.interval = null;\r\n  }\r\n}\r\n\r\nfunction createInterval(pen: formPen) {\r\n  if (pen.maxNum && pen.swiper) {\r\n    if (pen.interval) {\r\n      return;\r\n    }\r\n\r\n    pen.interval = globalThis.setInterval(() => {\r\n      if (pen.offsetY >= pen.calculative.maxOffsetY) {\r\n        pen.offsetY = 0;\r\n        initChildrenStyle(pen);\r\n      } else {\r\n        if (!(pen.offsetY % pen.rowHeight)) {\r\n          //完整一行 停顿\r\n          if (!pen.calculative.stap) {\r\n            pen.calculative.stap = 0;\r\n          }\r\n          pen.calculative.stap += 1;\r\n          if (pen.calculative.stap == 12) {\r\n            pen.calculative.stap = 0;\r\n            scroll(pen, 1);\r\n          }\r\n        } else {\r\n          scroll(pen, 1);\r\n        }\r\n      }\r\n    }, 50);\r\n  }\r\n}\r\n\r\nfunction initChildrenStyle(pen: formPen) {\r\n  pen.children?.forEach((item) => {\r\n    const rowHeight = pen.rowHeight; //*scale;\r\n    const _pen: formPen = pen.calculative.canvas.store.pens[item];\r\n    if (!_pen) {\r\n      return;\r\n    }\r\n    const oldOffset =\r\n      ((rowHeight * (pen.initScale || 1)) / pen.tableHeight) * pen.maxNum;\r\n    _pen.oldY -= oldOffset;\r\n    const row = _pen.row - pen.maxNum;\r\n    if (!pen.data[row]) {\r\n      return;\r\n    }\r\n    let rowStyle = deepClone(pen.data[row][_pen.col]);\r\n    if (rowStyle.background) {\r\n      rowStyle.activeBackground = rowStyle.background;\r\n      rowStyle.hoverBackground = rowStyle.background;\r\n    }\r\n    if (rowStyle.color) {\r\n      rowStyle.hoverColor = rowStyle.color;\r\n      rowStyle.activeColor = rowStyle.color;\r\n    }\r\n    if (rowStyle.textColor) {\r\n      rowStyle.activeTextColor = rowStyle.textColor;\r\n      rowStyle.hoverTextColor = rowStyle.textColor;\r\n    }\r\n    _pen.calculative.visible = true;\r\n    _pen.visible = true;\r\n    Object.assign(_pen, rowStyle, { row: row });\r\n    Object.assign(_pen.calculative, rowStyle, { row: row });\r\n  });\r\n\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction onMouseEnter(pen: formPen) {\r\n  delInterval(pen);\r\n}\r\n","import { formPen } from './common';\r\nimport { pSBC } from '@meta2d/core';\r\n\r\nexport function le5leSwitch(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.onClick) {\r\n    pen.onClick = click;\r\n  }\r\n  let x = pen.calculative.worldRect.x;\r\n  let y = pen.calculative.worldRect.y;\r\n  let w = pen.calculative.worldRect.width;\r\n  let h = pen.calculative.worldRect.height;\r\n  if (w < h * 1.5) {\r\n    w = 1.5 * h;\r\n  }\r\n  ctx.beginPath();\r\n  ctx.arc(x + h / 2, y + h / 2, h / 2, Math.PI / 2, (Math.PI * 3) / 2);\r\n  ctx.lineTo(x + w - h / 2, y);\r\n  ctx.arc(x + w - h / 2, y + h / 2, h / 2, -Math.PI / 2, Math.PI / 2);\r\n  ctx.lineTo(x + h / 2, y + h);\r\n  if (pen.checked) {\r\n    ctx.fillStyle = pen.onColor;\r\n    if (pen.disabled || pen.disable) {\r\n      ctx.fillStyle = pen.disableOnColor || pSBC(0.6,pen.onColor);\r\n    }\r\n    if(pen.lineWidth){\r\n      ctx.strokeStyle = pen.onStrokeColor;\r\n      ctx.stroke();\r\n    }\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    ctx.beginPath();\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.moveTo(x + h * 2, y + h / 2);\r\n    ctx.arc(\r\n      x + w - h / 2,\r\n      y + h / 2,\r\n      h / 2 > 2 ? h / 2 - 2 : 1,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n\r\n    ctx.fill();\r\n  } else {\r\n    ctx.fillStyle = pen.offColor;\r\n    if (pen.disabled || pen.disable) {\r\n      ctx.fillStyle = pen.disableOffColor || pSBC(0.6,pen.offColor);\r\n    }\r\n    if(pen.lineWidth){\r\n      ctx.strokeStyle = pen.offStrokeColor;\r\n      ctx.stroke();\r\n    }\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    ctx.beginPath();\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.moveTo(x + h, y + h / 2);\r\n    ctx.arc(x + h / 2, y + h / 2, h / 2 > 2 ? h / 2 - 2 : 1, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n  ctx.closePath();\r\n}\r\n\r\nfunction click(pen: formPen) {\r\n  if (pen.disabled || pen.disable) {\r\n    return;\r\n  }\r\n  pen.checked = !pen.checked;\r\n  pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n  pen.calculative.canvas.render();\r\n}\r\n","import { formPen } from './common';\r\nimport { Point, pSBC, calcRightBottom, calcTextRect } from '@meta2d/core';\r\n\r\nexport function slider(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.onAdd) {\r\n    pen.onAdd = initRect;\r\n    pen.onResize = initRect;\r\n    pen.onMove = initRect;\r\n    pen.onMouseMove = mouseMove;\r\n    pen.onMouseDown = mouseDown;\r\n    pen.onValue = onValue;\r\n    pen.onBeforeValue = beforeValue;\r\n  }\r\n\r\n  if (!pen.calculative.barRect) {\r\n    initRect(pen);\r\n    // return;\r\n  }\r\n\r\n  const data = pen.calculative.canvas.store.data;\r\n  const options = pen.calculative.canvas.store.options;\r\n  // calcBallRect(pen);\r\n\r\n  // draw bar\r\n  let background = pen.background;\r\n  if(pen.disabled){\r\n    background = pen.disabledBackground || pSBC(0.6,background);\r\n  }\r\n  ctx.fillStyle = background;\r\n  ctx.beginPath();\r\n  let x = pen.calculative.worldRect.x + pen.calculative.barRect.x;\r\n  let y = pen.calculative.worldRect.y + pen.calculative.barRect.y;\r\n  let w = pen.calculative.barRect.width;\r\n  let h = pen.calculative.barRect.height;\r\n  let r = h / 2;\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + w, y, x + w, y + h, r);\r\n  ctx.arcTo(x + w, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, pen.x, pen.y, r);\r\n  ctx.arcTo(x, y, x + w, y, r);\r\n  ctx.fill();\r\n\r\n  // draw active bar\r\n  // ctx.fillStyle = pen.activeColor || data.activeColor || options.activeColor;\r\n  let activeColor =  pen.activeColor || options.activeColor;\r\n  if(pen.disabled){\r\n    activeColor = pen.disabledColor || pSBC(0.6,activeColor);\r\n  }\r\n  ctx.fillStyle = activeColor;\r\n  ctx.beginPath();\r\n  w = pen.calculative.ballRect.x;\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + w, y, x + w, y + h, r);\r\n  ctx.arcTo(x + w, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, pen.x, pen.y, r);\r\n  ctx.arcTo(x, y, x + w, y, r);\r\n  ctx.fill();\r\n\r\n  // draw ball\r\n  ctx.fillStyle = pen.btnBackground || '#fff';\r\n  ctx.strokeStyle = activeColor;\r\n  ctx.lineWidth = 2;\r\n  ctx.beginPath();\r\n  x = pen.calculative.worldRect.x + pen.calculative.ballRect.x;\r\n  y =\r\n    pen.calculative.worldRect.y +\r\n    pen.calculative.ballRect.y +\r\n    pen.calculative.ballRect.height / 2;\r\n  ctx.lineWidth = pen.calculative.ballRect.width / 10;\r\n  ctx.arc(x, y, pen.calculative.ballRect.width / 2, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n}\r\n\r\nfunction initRect(pen: formPen) {\r\n  if (!pen._textWidth) {\r\n    pen._textWidth = pen.textWidth || 50;\r\n    pen._fontSize = pen.fontSize || 12;\r\n  }\r\n  pen.textWidth = pen.calculative.worldRect.width;\r\n  pen.calculative.textWidth = pen.textWidth;\r\n  if (!pen.unit) {\r\n    pen.unit = '%';\r\n  }\r\n  if (!pen.sliderWidth) {\r\n    pen.sliderWidth = pen.width;\r\n  }\r\n  if (!pen.sliderHeight) {\r\n    pen.sliderHeight = pen.height;\r\n  }\r\n\r\n  if (!pen.calculative.worldRect) {\r\n    return;\r\n  }\r\n\r\n  const scaleX = pen.calculative.worldRect.width / pen.sliderWidth;\r\n  const scaleY = pen.calculative.worldRect.height / pen.sliderHeight;\r\n  const textScale = Math.min(scaleX, scaleY);\r\n  pen.fontSize = pen._fontSize * textScale;\r\n\r\n  const barWidth = pen.calculative.worldRect.width - pen._textWidth * textScale;\r\n  pen.textLeft = barWidth + 10 * textScale;\r\n  pen.calculative.textLeft = pen.textLeft;\r\n\r\n  pen.calculative.barRect = {\r\n    x: 0,\r\n    y: (pen.calculative.worldRect.height - pen.barHeight * scaleY) / 2,\r\n    width: barWidth,\r\n    height: pen.barHeight * scaleY,\r\n  };\r\n  calcRightBottom(pen.calculative.barRect);\r\n\r\n  calcBallRect(pen);\r\n}\r\n\r\nfunction calcBallRect(pen: formPen) {\r\n  const height = pen.calculative.barRect.height * 3.5;\r\n  const progress =\r\n    (pen.calculative.barRect.width * (pen.value as number)) / 100;\r\n  pen.calculative.ballRect = {\r\n    x: progress,\r\n    y: (pen.calculative.worldRect.height - height) / 2,\r\n    width: height,\r\n    height,\r\n  };\r\n  calcRightBottom(pen.calculative.ballRect);\r\n\r\n  pen.calculative.text = pen.value + pen.unit;\r\n  calcTextRect(pen);\r\n}\r\n\r\nfunction mouseDown(pen: formPen, e: Point) {\r\n  if(pen.disabled){\r\n    return;\r\n  }\r\n  const pos = e.x - pen.calculative.worldRect.x;\r\n  if (pos > pen.calculative.barRect.width) {\r\n    return;\r\n  }\r\n\r\n  let value = Math.round((pos / pen.calculative.barRect.width) * 100);\r\n  if (value < pen.min || value > pen.max) {\r\n    return;\r\n  }\r\n  if (value < 0 || value > 100) {\r\n    return;\r\n  }\r\n  pen.value = value;\r\n  calcBallRect(pen);\r\n  pen.calculative.text = pen.value + pen.unit;\r\n  calcTextRect(pen);\r\n  pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction mouseMove(pen: formPen, e: Point) {\r\n  if (pen.calculative.canvas.mouseDown) {\r\n    mouseDown(pen, e);\r\n  }\r\n}\r\n\r\nfunction onValue(pen: formPen) {\r\n  if (pen.calculative.isUpdateData) {\r\n    delete pen.calculative.isUpdateData;\r\n    initRect(pen);\r\n  }\r\n  calcBallRect(pen);\r\n}\r\n\r\nfunction beforeValue(pen: formPen, value: any) {\r\n  pen.calculative.isUpdateData = false;\r\n\r\n  if (value.textWidth || value.barHeight) {\r\n    if (value.textWidth) {\r\n      pen._textWidth = 0;\r\n    }\r\n    pen.calculative.isUpdateData = true;\r\n  }\r\n\r\n  return value;\r\n}\r\n","import { formPen } from './common';\r\nimport { Point } from '@meta2d/core/src/point';\r\nimport { getTextColor, getFont } from '@meta2d/core';\r\nimport { pSBC } from '@meta2d/core';\r\n\r\nexport function checkbox(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if (!pen.onMouseDown) {\r\n    pen.onMouseDown = onMousedown;\r\n  }\r\n  if(!pen.options){\r\n    pen.options = pen.data;\r\n  }\r\n  let x = pen.calculative.worldRect.x;\r\n  let y = pen.calculative.worldRect.y;\r\n  let h = pen.calculative.worldRect.height;\r\n  let w = pen.calculative.worldRect.width;\r\n  const { fontStyle, fontWeight, fontSize, fontFamily, lineHeight } =\r\n    pen.calculative;\r\n  let r = 2;\r\n  ctx.beginPath();\r\n  ctx.moveTo(x, y);\r\n  ctx.arcTo(x + h, y, x + h, y + h, r);\r\n  ctx.arcTo(x + h, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, x, y, r);\r\n  ctx.arcTo(x, y, x + h, y, r);\r\n\r\n  ctx.strokeStyle = '#d9d9d9';\r\n  ctx.fillStyle = '#ffffff00';\r\n  if (pen.checked) {\r\n    ctx.fillStyle = pen.background || '#1890ff';\r\n    ctx.strokeStyle = pen.background || '#1890ff';\r\n  }\r\n\r\n  if (pen.isForbidden || pen.disabled) {\r\n    ctx.fillStyle = pen.disabledBackground || pSBC(0.6 ,pen.background)|| '#ebebeb';\r\n    ctx.strokeStyle = pen.disabledColor || pSBC(0.6 ,pen.color)||'#d9d9d9';\r\n  }\r\n  ctx.closePath();\r\n  ctx.fill();\r\n  ctx.stroke();\r\n  ctx.save();\r\n  if (pen.checked) {\r\n    ctx.beginPath();\r\n    ctx.lineWidth = h / 10;\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.moveTo(x + (102 / 506) * h, y + h / 2);\r\n    ctx.lineTo(x + (220 / 506) * h, y + (346 / 460) * h);\r\n    ctx.lineTo(x + (404 / 506) * h, y + (142 / 460) * h);\r\n    ctx.stroke();\r\n  }\r\n  ctx.restore();\r\n\r\n  //文字\r\n  ctx.save();\r\n  ctx.fillStyle = (pen.disabled || pen.isForbidden)\r\n    ? pen.disabledTextColor || pSBC(0.6,pen.textColor||pen.color)||'#00000040'\r\n    : getTextColor(pen, pen.calculative.canvas.parent.store) || '#000000d9';\r\n  ctx.textAlign = 'start';\r\n  ctx.textBaseline = 'middle';\r\n  // ctx.font =\r\n  //   (pen.calculative.fontStyle || '') +\r\n  //   ' normal ' +\r\n  //   (pen.calculative.fontWeight || '') +\r\n  //   ' ' +\r\n  //   pen.fontSize +\r\n  //   'px ' +\r\n  //   pen.calculative.fontFamily;\r\n\r\n  ctx.font = getFont({\r\n    fontStyle,\r\n    fontWeight,\r\n    fontFamily:\r\n      fontFamily || pen.calculative.canvas.parent.store.options.fontFamily,\r\n    fontSize,\r\n    lineHeight,\r\n  });\r\n  ctx.fillText(pen.value + '', x + h + 10, y + h / 2);\r\n  ctx.restore();\r\n}\r\n\r\nfunction onMousedown(pen: formPen, e: Point) {\r\n  if (!pen.isForbidden) {\r\n    pen.checked = !pen.checked;\r\n    pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n    pen.calculative.canvas.render();\r\n  }\r\n}\r\n","import { getTextLength, initOptions } from './common';\r\nimport { formPen } from './common';\r\nimport { Point } from '@meta2d/core/src/point';\r\nimport { getTextColor, getFont } from '@meta2d/core';\r\nimport { pSBC } from '@meta2d/core';\r\n\r\nexport function radio(ctx: CanvasRenderingContext2D, pen: formPen) {\r\n  if(!pen.options){\r\n    pen.options = pen.data;\r\n  }\r\n  if (!pen.onAdd) {\r\n    pen.onAdd = onAdd;\r\n    if (!pen.optionPos) {\r\n      pen.onAdd(pen);\r\n      pen.calculative.canvas.parent.active([pen]);\r\n    }\r\n    pen.onMouseDown = onMousedown;\r\n    pen.onValue = onValue;\r\n  }\r\n  let x = pen.calculative.worldRect.x;\r\n  let y = pen.calculative.worldRect.y;\r\n  let h = pen.calculative.worldRect.height;\r\n  let w = pen.calculative.worldRect.width;\r\n  if (!pen.optionPos) {\r\n    return;\r\n  }\r\n  const { fontStyle, fontWeight, fontSize, fontFamily, lineHeight } =\r\n    pen.calculative;\r\n\r\n  if (pen.direction == 'horizontal') {\r\n    // const optionHeight = (pen.optionHeight * h) / pen.checkboxHeight;\r\n    for (let i = 0; i < pen.optionPos.length; i++) {\r\n      const gap = (pen.optionPos[i] * w) / pen.checkboxWidth;\r\n      const isForbidden = pen.options[i].isForbidden || pen.disabled;\r\n      ctx.beginPath();\r\n      ctx.arc(x + gap + h / 2, y + h / 2, h / 2, 0, Math.PI * 2);\r\n      ctx.strokeStyle = '#d9d9d9';\r\n      ctx.fillStyle = '#ffffff00';\r\n      if (pen.options[i].text === pen.checked) {\r\n        ctx.strokeStyle =\r\n          pen.options[i].background || pen.background || '#1890ff';\r\n      }\r\n      if (isForbidden) {\r\n        ctx.fillStyle = pen.disabledBackground || pSBC(0.6 ,pen.background)|| '#ebebeb';\r\n        ctx.strokeStyle = pen.disabledColor || pSBC(0.6 ,pen.color)||'#d9d9d9';\r\n        if (pen.options[i].text === pen.checked) {\r\n           ctx.fillStyle = '#ffffff00';\r\n        }\r\n      }\r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      ctx.save();\r\n      if (pen.options[i].text === pen.checked) {\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = pen.options[i].background\r\n          ? pen.options[i].background + '20'\r\n          : pen.background || '#1890ff20';\r\n        if(isForbidden){\r\n          ctx.strokeStyle =pen.disabledBackground || pSBC(0.6 ,pen.background)|| '#ebebeb';\r\n        }\r\n        ctx.arc(x + h / 2 + gap, y + h / 2, h / 2 + 1.5, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n        ctx.beginPath();\r\n        ctx.fillStyle =\r\n          pen.options[i].background || pen.background || '#1890ff';\r\n        if(isForbidden){\r\n          ctx.fillStyle =pen.disabledBackground || pSBC(0.6 ,pen.background)|| '#ebebeb';\r\n        }\r\n        ctx.arc(x + h / 2 + gap, y + h / 2, h / 4, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.closePath();\r\n      }\r\n      ctx.restore();\r\n\r\n      //文字\r\n      ctx.save();\r\n      ctx.fillStyle = isForbidden\r\n        ? (pen.disabledTextColor||'#00000040')\r\n        : getTextColor(pen, pen.calculative.canvas.parent.store) || '#000000d9';\r\n      const textScale = (pen.calculative.worldRect.height * 14) / 16;\r\n\r\n      ctx.textAlign = 'start';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.font = getFont({\r\n        fontStyle,\r\n        fontWeight,\r\n        fontFamily:\r\n          fontFamily || pen.calculative.canvas.parent.store.options.fontFamily,\r\n        fontSize: textScale,\r\n        lineHeight,\r\n      });\r\n      ctx.fillText(\r\n        pen.options[i].text,\r\n        x + h + gap + (10 / pen.checkboxWidth) * w,\r\n        y + h / 2\r\n      );\r\n      ctx.restore();\r\n    }\r\n  } else if (pen.direction == 'vertical') {\r\n    const optionHeight = (pen.optionHeight * h) / pen.checkboxHeight;\r\n    for (let i = 0; i < pen.optionPos.length; i++) {\r\n      const gap = (pen.optionPos[i] * h) / pen.checkboxHeight;\r\n      const isForbidden = pen.options[i].isForbidden;\r\n      ctx.beginPath();\r\n      ctx.arc(\r\n        x + optionHeight / 2,\r\n        y + optionHeight / 2 + gap,\r\n        optionHeight / 2,\r\n        0,\r\n        Math.PI * 2\r\n      );\r\n      ctx.strokeStyle = '#d9d9d9';\r\n      ctx.fillStyle = '#ffffff00';\r\n      if (pen.options[i].text === pen.checked) {\r\n        ctx.strokeStyle = pen.options[i].background || '#1890ff';\r\n      }\r\n      if (isForbidden) {\r\n        ctx.fillStyle = '#ebebeb';\r\n        ctx.strokeStyle = '#d9d9d9';\r\n      }\r\n      ctx.closePath();\r\n      ctx.fill();\r\n      ctx.stroke();\r\n      ctx.save();\r\n      if (!isForbidden && pen.options[i].text === pen.checked) {\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = pen.options[i].background\r\n          ? pen.options[i].background + '20'\r\n          : '#1890ff20';\r\n        ctx.arc(\r\n          x + optionHeight / 2,\r\n          y + optionHeight / 2 + gap,\r\n          optionHeight / 2 + 1.5,\r\n          0,\r\n          Math.PI * 2\r\n        );\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n        ctx.beginPath();\r\n        ctx.fillStyle = pen.options[i].background || '#1890ff';\r\n        ctx.arc(\r\n          x + optionHeight / 2,\r\n          y + optionHeight / 2 + gap,\r\n          optionHeight / 4,\r\n          0,\r\n          Math.PI * 2\r\n        );\r\n        ctx.fill();\r\n        ctx.closePath();\r\n      }\r\n      ctx.restore();\r\n\r\n      //文字\r\n      ctx.save();\r\n      ctx.fillStyle = isForbidden\r\n        ? '#00000040'\r\n        : getTextColor(pen, pen.calculative.canvas.parent.store) || '#000000d9';\r\n      const textScale =\r\n        (14 * pen.calculative.worldRect.height) / pen.checkboxHeight;\r\n      ctx.textAlign = 'start';\r\n      ctx.textBaseline = 'middle';\r\n      // ctx.font =\r\n      //   (pen.calculative.fontStyle || '') +\r\n      //   ' normal ' +\r\n      //   (pen.calculative.fontWeight || '') +\r\n      //   ' ' +\r\n      //   textScale +\r\n      //   'px ' +\r\n      //   pen.calculative.fontFamily;\r\n      ctx.font = getFont({\r\n        fontStyle,\r\n        fontWeight,\r\n        fontFamily:\r\n          fontFamily || pen.calculative.canvas.parent.store.options.fontFamily,\r\n        fontSize: textScale,\r\n        lineHeight,\r\n      });\r\n      ctx.fillText(\r\n        pen.options[i].text,\r\n        x + optionHeight + 10,\r\n        y + optionHeight / 2 + gap\r\n      );\r\n      ctx.restore();\r\n    }\r\n  }\r\n}\r\n\r\nfunction onAdd(pen: formPen) {\r\n  initOptions(pen);\r\n}\r\n\r\nfunction onMousedown(pen: formPen, e: Point) {\r\n  if (pen.direction == 'horizontal') {\r\n    // let checkedIndex = -1;\r\n    for (let i = 0; i < pen.optionPos.length; i++) {\r\n      if (\r\n        !pen.options[i].isForbidden &&\r\n        e.x >\r\n          pen.calculative.worldRect.x +\r\n            (pen.optionPos[i] * pen.calculative.worldRect.width) /\r\n              pen.checkboxWidth &&\r\n        e.x <\r\n          pen.calculative.worldRect.x +\r\n            ((pen.optionPos[i] + pen.height) / pen.checkboxWidth) *\r\n              pen.calculative.worldRect.width +\r\n            getTextLength(pen.options[i].text, pen) +\r\n            (10 / pen.checkboxWidth) * pen.calculative.worldRect.width\r\n      ) {\r\n        // pen.options[i].isChecked = true;\r\n        pen.checked = pen.options[i].text;\r\n        // checkedIndex = i;\r\n        pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n      }\r\n    }\r\n    // if (checkedIndex !== -1) {\r\n    //   pen.options.forEach((item: any, index: number) => {\r\n    //     if (index !== checkedIndex) {\r\n    //       item.isChecked = false;\r\n    //     }\r\n    //   });\r\n    // }\r\n  } else if (pen.direction == 'vertical') {\r\n    const scaleY = pen.calculative.worldRect.height / pen.checkboxHeight;\r\n    // let checkedIndex = -1;\r\n    for (let i = 0; i < pen.optionPos.length; i++) {\r\n      if (\r\n        !pen.options[i].isForbidden &&\r\n        e.y > pen.calculative.worldRect.y + pen.optionPos[i] * scaleY &&\r\n        e.y <\r\n          pen.calculative.worldRect.y +\r\n            (pen.optionPos[i] + pen.optionHeight) * scaleY\r\n      ) {\r\n        // pen.options[i].isChecked = true;\r\n        pen.checked = pen.options[i].text;\r\n        // checkedIndex = i;\r\n        pen.calculative.canvas.store.emitter.emit('valueUpdate', pen);\r\n      }\r\n    }\r\n\r\n    // if (checkedIndex !== -1) {\r\n    //   pen.options.forEach((item: any, index: number) => {\r\n    //     if (index !== checkedIndex) {\r\n    //       item.isChecked = false;\r\n    //     }\r\n    //   });\r\n    // }\r\n  }\r\n  pen.calculative.canvas.render();\r\n}\r\n\r\nfunction onValue(pen: formPen) {\r\n  initOptions(pen);\r\n}\r\n","import { table } from './table';\r\nimport { le5leSwitch } from './switch';\r\nimport { slider } from './slider';\r\nimport { checkbox } from './checkbox';\r\nimport { radio } from './radio';\r\nimport { table2 } from './table2';\r\nimport { time } from './time';\r\n\r\nexport function formPens() {\r\n  return {\r\n    radio,\r\n    switch: le5leSwitch,\r\n    slider,\r\n    checkbox,\r\n    table:table2,\r\n    table2:table2,\r\n  };\r\n}\r\n\r\nexport function formPath2DPens() {\r\n  return {\r\n    time,\r\n  };\r\n}\r\n","//用于规范化纵坐标的坐标值\r\nexport interface ScaleOption {\r\n  /**\r\n   * 数据最大值\r\n   *\r\n   * @type {(number | null)}\r\n   * @memberof ScaleOption\r\n   */\r\n  max: number | null;\r\n  /**\r\n   * 数据最小值\r\n   *\r\n   * @type {(number | null)}\r\n   * @memberof ScaleOption\r\n   */\r\n  min: number | null;\r\n  /**\r\n   * 预期分成几个区间\r\n   *\r\n   * @type {number}\r\n   * @memberof ScaleOption\r\n   */\r\n  splitNumber?: number;\r\n  /**\r\n   * 存在异号数据时正负区间是否需要对称\r\n   *\r\n   * @type {boolean}\r\n   * @memberof ScaleOption\r\n   */\r\n  symmetrical?: boolean;\r\n  /**\r\n   * 是否允许实际分成的区间数有误差\r\n   *\r\n   * @type {boolean}\r\n   * @memberof ScaleOption\r\n   */\r\n  deviation?: boolean;\r\n  /**\r\n   * 是否优先取到0刻度\r\n   *\r\n   * @type {boolean}\r\n   * @memberof ScaleOption\r\n   */\r\n  preferZero?: boolean;\r\n}\r\nexport interface ScaleResult {\r\n  max?: number;\r\n  min?: number;\r\n  interval?: number;\r\n  splitNumber?: number;\r\n}\r\n\r\n// 双精度浮点数有效数字为15位\r\nconst maxDecimal = 15;\r\n/**\r\n * 解决js的浮点数存在精度问题，在计算出最后结果时可以四舍五入一次，刻度太小也没有意义\r\n *\r\n * @export\r\n * @param {(number | string)} num\r\n * @param {number} [decimal=8]\r\n * @returns {number}\r\n */\r\nexport function fixedNum(\r\n  num: number | string,\r\n  decimal: number = maxDecimal\r\n): number {\r\n  let str: string = '' + num;\r\n  if (str.indexOf('.') >= 0) str = Number.parseFloat(str).toFixed(decimal);\r\n  return Number.parseFloat(str);\r\n}\r\n\r\n/**\r\n * 判断非Infinity非NaN的number\r\n *\r\n * @export\r\n * @param {*} num\r\n * @returns {num is number}\r\n */\r\nexport function numberValid(num: any): num is number {\r\n  return typeof num === 'number' && Number.isFinite(num);\r\n}\r\n\r\n/**\r\n * 计算理想的刻度值，刻度区间大小一般是[10, 15, 20, 25, 30, 40, 50, 60, 70, 80, 90, 100]中某个数字的整10倍\r\n *\r\n * @export\r\n * @param {ScaleOption} option\r\n * @returns {ScaleResult}\r\n */\r\nexport function scaleCompute(option: ScaleOption): ScaleResult {\r\n  option = {\r\n    max: null,\r\n    min: null,\r\n    splitNumber: 4, // splitNumber建议取4或者5等这种容易被整除的数字\r\n    symmetrical: false,\r\n    deviation: false,\r\n    preferZero: false,\r\n    ...option,\r\n  };\r\n  const magics: number[] = [\r\n    10, 15, 20, 25, 30, 40, 50, 60, 70, 80, 90, 100, 150,\r\n  ]; // 加入150形成闭环\r\n  // tslint:disable-next-line: prefer-const\r\n  let {\r\n    max: dataMax,\r\n    min: dataMin,\r\n    splitNumber,\r\n    symmetrical,\r\n    deviation,\r\n    preferZero,\r\n  } = option;\r\n  if (!numberValid(dataMax) || !numberValid(dataMin) || dataMax < dataMin) {\r\n    return { splitNumber };\r\n  } else if (dataMax === dataMin && dataMax === 0) {\r\n    return {\r\n      max: fixedNum(magics[0] * splitNumber),\r\n      min: dataMin,\r\n      interval: magics[0],\r\n      splitNumber,\r\n    };\r\n  } else if (dataMax === dataMin) {\r\n    preferZero = true;\r\n  }\r\n  if (!numberValid(splitNumber) || splitNumber <= 0) splitNumber = 4;\r\n  if (preferZero && dataMax * dataMin > 0) {\r\n    if (dataMax < 0) dataMax = 0;\r\n    else dataMin = 0;\r\n  }\r\n  const tempGap: number = (dataMax - dataMin) / splitNumber;\r\n  let multiple: number = Math.floor(Math.log10(tempGap) - 1); // 指数\r\n  multiple = Math.pow(10, multiple);\r\n  const tempStep: number = tempGap / multiple;\r\n  let expectedStep: number = magics[0] * multiple;\r\n  let storedMagicsIndex: number = -1;\r\n  let index: number; // 当前魔数下标\r\n  for (index = 0; index < magics.length; index++) {\r\n    if (magics[index] > tempStep) {\r\n      expectedStep = magics[index] * multiple; // 取出第一个大于tempStep的魔数，并乘以multiple作为期望得到的最佳间隔\r\n      break;\r\n    }\r\n  }\r\n  let axisMax: number = dataMax;\r\n  let axisMin: number = dataMin;\r\n  function countDegree(step: number): void {\r\n    axisMax = parseInt('' + (dataMax / step + 1)) * step; // parseInt令小数去尾 -1.8 -> -1\r\n    axisMin = parseInt('' + (dataMin / step - 1)) * step;\r\n    if (dataMax === 0) axisMax = 0; // 优先0刻度\r\n    if (dataMin === 0) axisMin = 0;\r\n    if (symmetrical && axisMax * axisMin < 0) {\r\n      const tm: number = Math.max(Math.abs(axisMax), Math.abs(axisMin));\r\n      axisMax = tm;\r\n      axisMin = -tm;\r\n    }\r\n  }\r\n  countDegree(expectedStep);\r\n  if (deviation) {\r\n    return {\r\n      max: fixedNum(axisMax),\r\n      min: fixedNum(axisMin),\r\n      interval: fixedNum(expectedStep),\r\n      splitNumber: Math.round((axisMax - axisMin) / expectedStep),\r\n    };\r\n  } else if (!symmetrical || axisMax * axisMin > 0) {\r\n    let tempSplitNumber: number;\r\n    out: do {\r\n      tempSplitNumber = Math.round((axisMax - axisMin) / expectedStep);\r\n      if ((index - storedMagicsIndex) * (tempSplitNumber - splitNumber) < 0) {\r\n        // 出现死循环\r\n        while (tempSplitNumber < splitNumber) {\r\n          if (\r\n            (axisMin - dataMin <= axisMax - dataMax && axisMin !== 0) ||\r\n            axisMax === 0\r\n          ) {\r\n            axisMin -= expectedStep;\r\n          } else {\r\n            axisMax += expectedStep;\r\n          }\r\n          tempSplitNumber++;\r\n          if (tempSplitNumber === splitNumber) break out;\r\n        }\r\n      }\r\n      if (\r\n        index >= magics.length - 1 ||\r\n        index <= 0 ||\r\n        tempSplitNumber === splitNumber\r\n      )\r\n        break;\r\n      storedMagicsIndex = index;\r\n      if (tempSplitNumber > splitNumber)\r\n        expectedStep = magics[++index] * multiple;\r\n      else expectedStep = magics[--index] * multiple;\r\n      countDegree(expectedStep);\r\n    } while (tempSplitNumber !== splitNumber);\r\n  }\r\n  axisMax = fixedNum(axisMax);\r\n  axisMin = fixedNum(axisMin);\r\n  const interval: number = fixedNum((axisMax - axisMin) / splitNumber);\r\n  return {\r\n    max: axisMax,\r\n    min: axisMin,\r\n    interval,\r\n    splitNumber,\r\n  };\r\n}\r\n","import { scaleCompute, ScaleOption } from './normalizedAxis';\r\nimport { leChartPen } from './common';\r\nimport {getFont} from \"@meta2d/core\";\r\n\r\n//用于绘制坐标轴\r\nexport function coordinateAxis(ctx: CanvasRenderingContext2D, pen: leChartPen) {\r\n  const x = pen.calculative.worldRect.x;\r\n  const y = pen.calculative.worldRect.y;\r\n  const w = pen.calculative.worldRect.width;\r\n  const h = pen.calculative.worldRect.height;\r\n\r\n  // 缩放比例\r\n  let r = w / 2;\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n\r\n  let series = [];\r\n\r\n  if (pen.echarts) {\r\n    for (let i = 0; i < pen.echarts.option.series.length; i++) {\r\n      series.push(pen.echarts.option.series[i].data);\r\n    }\r\n  } else {\r\n    series = pen.data;\r\n  }\r\n  let collection_data = [];\r\n  for (let i = 0; i < series.length; i++) {\r\n    collection_data = collection_data.concat(series[i]);\r\n  }\r\n  let initOption: ScaleOption = {\r\n    max: Math.max.apply(null, collection_data),\r\n    min: Math.min.apply(null, collection_data),\r\n    splitNumber: 5,\r\n  };\r\n  let normalizedOption = scaleCompute(initOption);\r\n  let num = pen.echarts\r\n    ? pen.echarts.option.xAxis.data.length\r\n    : pen.xAxisData.length;\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = '#BFBFBF';\r\n  ctx.lineWidth = 6 * scale;\r\n  ctx.lineCap = 'butt';\r\n  let dash = (w - 1 * (num + 1)) / num;\r\n  ctx.setLineDash([1, dash]);\r\n  ctx.moveTo(x, y + h + 3*scale);\r\n  ctx.lineTo(x + w, y + h + 3*scale);\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n\r\n  //x轴绘制\r\n  ctx.beginPath();\r\n  ctx.lineWidth = 1 * scale;\r\n  ctx.setLineDash([]);\r\n  ctx.moveTo(x, y + h);\r\n  ctx.lineTo(x + w, y + h);\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n  //y轴绘制\r\n  ctx.beginPath();\r\n  ctx.fillStyle = '#BFBFBF';\r\n  ctx.strokeStyle = '#E9E9E9';\r\n  ctx.setLineDash([2, 2]);\r\n  let fontOptions = {\r\n    fontStyle: pen.yAxis?.axisLabel?.fontStyle || pen.fontStyle,\r\n    textDecoration: pen.yAxis?.axisLabel?.textDecoration,\r\n    fontWeight: pen.yAxis?.axisLabel?.fontWeight || pen.fontWeight,\r\n    fontFamily: pen.yAxis?.axisLabel?.fontFamily || pen.fontFamily,\r\n    fontSize: pen.yAxis?.axisLabel?.fontSize || pen.fontSize,\r\n    lineHeight: pen.yAxis?.axisLabel?.lineHeight || pen.lineHeight,\r\n  };\r\n  ctx.fillStyle = pen.yAxis?.axisLabel?.fontColor || pen.color;\r\n  for (let i = 0; i < normalizedOption.splitNumber + 1; i++) {\r\n    let temH = (i * h) / normalizedOption.splitNumber;\r\n    ctx.textAlign = 'right';\r\n    ctx.textBaseline = 'middle';\r\n    ctx.font = getFont(fontOptions);    //r / 10 +'px AlibabaPuHuiTi-Regular, Alibaba PuHuiTi';\r\n    ctx.fillText(\r\n      normalizedOption.max - i * normalizedOption.interval + '',\r\n      x - 10 * scale,\r\n      y + temH\r\n    );\r\n    ctx.fill();\r\n    if (i < normalizedOption.splitNumber) {\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, y + temH);\r\n      ctx.lineTo(x + w, y + temH);\r\n      ctx.stroke();\r\n    }\r\n  }\r\n  ctx.closePath();\r\n\r\n  //x轴下标绘制\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = '#BFBFBF';\r\n  let xData = pen.echarts ? pen.echarts.option.xAxis.data : pen.xAxisData;\r\n  let xdataX = 0;\r\n  for (let i = 0; i < xData.length; i++) {\r\n    xdataX = x + (1 + dash / 2) + (dash + 1) * i;\r\n\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'top';\r\n    let fontOptions = {\r\n      fontStyle: pen.xAxis?.axisLabel?.fontStyle || pen.calculative.fontStyle,\r\n      textDecoration: pen.xAxis?.axisLabel?.textDecoration,\r\n      fontWeight: pen.xAxis?.axisLabel?.fontWeight || pen.calculative.fontWeight,\r\n      fontFamily: pen.xAxis?.axisLabel?.fontFamily || pen.calculative.fontFamily,\r\n      fontSize: pen.xAxis?.axisLabel?.fontSize || pen.calculative.fontSize,\r\n      lineHeight: pen.xAxis?.axisLabel?.lineHeight || pen.calculative.lineHeight,\r\n    };\r\n    ctx.font = getFont(fontOptions);    //r / 10 +'px AlibabaPuHuiTi-Regular, Alibaba PuHuiTi';\r\n    ctx.fillStyle = pen.xAxis?.axisLabel?.fontColor || pen.calculative.color;\r\n    ctx.fillText(xData[i], xdataX, (y + h + 10*scale));\r\n    ctx.fill();\r\n  }\r\n  ctx.closePath();\r\n  ctx.setLineDash([]);\r\n\r\n  return { dash: dash, normalizedOption: normalizedOption };\r\n}\r\n","import { Pen } from '@meta2d/core/src/pen';\r\n\r\n// 坐标轴样式配置\r\ninterface Axis {\r\n  lineStyle?: {};\r\n  axisLabel?: {\r\n    fontSize?: number;\r\n    fontColor?: string;\r\n    fontStyle?: string;\r\n    textDecoration?: string;\r\n    fontWeight?: string;\r\n    fontFamily?: string;\r\n    lineHeight?: number;\r\n  };\r\n}\r\n\r\nexport function getValidValue(num: any, value: number) {\r\n  if (isNaN(num)) {\r\n    return;\r\n  }\r\n  if (value === -1) {\r\n    return num;\r\n  }\r\n  // return num - parseInt(num) == 0 ? num : Number(num).toFixed(value);\r\n  // return Number(num).toFixed(value);\r\n  return Math.round(Number(num) * 1000) / 1000;\r\n}\r\n\r\nexport enum ReplaceMode {\r\n  Add,\r\n  Replace,\r\n  ReplaceAll,\r\n}\r\n\r\nexport interface leChartPen extends Pen {\r\n  // echarts?: any;\r\n  echarts?: {\r\n    option: {\r\n      xAxis: {\r\n        data: any[];\r\n      };\r\n      series: any[];\r\n      color: string[];\r\n    };\r\n  };\r\n  tickLabel?: {\r\n    show?: boolean;\r\n    labelLine?: {\r\n      show?: boolean;\r\n    };\r\n    color?: string;\r\n    fontSize?: number;\r\n    fontFamily?: string;\r\n    fontWeight?: string;\r\n    lineHeight?: number;\r\n    fontStyle?: string;\r\n    textDecoration?: string;\r\n  };\r\n  titleLabel?: {\r\n    fontSize?: number;\r\n    fontFamily?: string;\r\n    fontWeight?: string;\r\n    lineHeight?: number;\r\n    fontStyle?: string;\r\n    textDecoration?: string;\r\n    color?: string;\r\n  };\r\n  xAxis?: Axis;\r\n  yAxis?: Axis;\r\n  startAngle?: number;\r\n  endAngle?: number;\r\n  min?: number;\r\n  max?: number;\r\n  axisLine?: [number, string];\r\n  unit?: string;\r\n  value?: number;\r\n  splitNumber?: number;\r\n  isClock?: boolean;\r\n  hourvalue?: string;\r\n  minutevalue?: string;\r\n  secondvalue?: string;\r\n  data?: any[]; // (number[] | { name: string; value: number }...)[];\r\n  chartsColor?: string[];\r\n  smooth?: boolean;\r\n  chartsRadius?: string[][];\r\n  frames?: leChartPen[];\r\n  xAxisData?: string[];\r\n  replaceMode?: ReplaceMode;\r\n  clockInterval?: NodeJS.Timer;\r\n}\r\n","import { coordinateAxis } from './coordinateAxis';\r\nimport { leChartPen, ReplaceMode } from './common';\r\n\r\n//折线图\r\nexport function lineChart(ctx: CanvasRenderingContext2D, pen: leChartPen) {\r\n  if (!pen.onBeforeValue) {\r\n    pen.onBeforeValue = beforeValue;\r\n  }\r\n  const x = pen.calculative.worldRect.x;\r\n  const y = pen.calculative.worldRect.y;\r\n  const w = pen.calculative.worldRect.width;\r\n  const h = pen.calculative.worldRect.height;\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n  let series = [];\r\n  if (pen.echarts && !pen.echarts.option.color) {\r\n    pen.echarts.option.color = [\r\n      '#1890ff',\r\n      '#2FC25B',\r\n      '#FACC14',\r\n      '#c23531',\r\n      '#2f4554',\r\n      '#61a0a8',\r\n      '#d48265',\r\n    ];\r\n  }\r\n  let coordinate = coordinateAxis(ctx, pen);\r\n  let dash = coordinate.dash;\r\n  let normalizedOption = coordinate.normalizedOption;\r\n  //数据值绘制\r\n  const smooth = (\r\n    pen.echarts ? pen.echarts.option.series[0].smooth : pen.smooth\r\n  )\r\n    ? true\r\n    : false;\r\n  let coordinateValue = [];\r\n  if (pen.echarts) {\r\n    for (let i = 0; i < pen.echarts.option.series.length; i++) {\r\n      series.push(pen.echarts.option.series[i].data);\r\n    }\r\n  } else {\r\n    series = pen.data;\r\n  }\r\n  for (let j = 0; j < series.length; j++) {\r\n    ctx.beginPath();\r\n    let data = series[j];\r\n    ctx.strokeStyle = pen.echarts\r\n      ? pen.echarts.option.color[j]\r\n      : pen.chartsColor[j];\r\n    ctx.fillStyle = pen.echarts\r\n      ? pen.echarts.option.color[j]\r\n      : pen.chartsColor[j];\r\n    let currentX = x + (1 + dash / 2);\r\n    let currentY =\r\n      y +\r\n      h -\r\n      ((data[0] - normalizedOption.min) /\r\n        (normalizedOption.max - normalizedOption.min)) *\r\n        h;\r\n    ctx.moveTo(currentX, currentY);\r\n    coordinateValue.push({ x: currentX, y: currentY });\r\n\r\n    if (smooth) {\r\n      //平滑的曲线\r\n      if (data.length <= 2) {\r\n        //小于两个点的情况无法构成贝塞尔\r\n        for (let i = 1; i < data.length; i++) {\r\n          currentX = x + (1 + dash / 2) + (dash + 1) * i;\r\n          currentY =\r\n            y +\r\n            h -\r\n            ((data[i] - normalizedOption.min) /\r\n              (normalizedOption.max - normalizedOption.min)) *\r\n              h;\r\n          ctx.lineTo(currentX, currentY);\r\n          coordinateValue.push({ x: currentX, y: currentY });\r\n        }\r\n      } else {\r\n        let cAx: number, cAy: number, cBx: number, cBy: number;\r\n        data.forEach((item: number, index: number) => {\r\n          currentX = x + (1 + dash / 2) + (dash + 1) * index;\r\n          currentY =\r\n            y +\r\n            h -\r\n            ((data[index] - normalizedOption.min) /\r\n              (normalizedOption.max - normalizedOption.min)) *\r\n              h;\r\n          let last1x = x + (1 + dash / 2) + (dash + 1) * (index + 1);\r\n          let last1y =\r\n            y +\r\n            h -\r\n            ((data[index + 1] - normalizedOption.min) /\r\n              (normalizedOption.max - normalizedOption.min)) *\r\n              h;\r\n          let before1x = x + (1 + dash / 2) + (dash + 1) * (index - 1);\r\n          let before1y =\r\n            y +\r\n            h -\r\n            ((data[index - 1] - normalizedOption.min) /\r\n              (normalizedOption.max - normalizedOption.min)) *\r\n              h;\r\n          let last2x = x + (1 + dash / 2) + (dash + 1) * (index + 2);\r\n          let last2y =\r\n            y +\r\n            h -\r\n            ((data[index + 2] - normalizedOption.min) /\r\n              (normalizedOption.max - normalizedOption.min)) *\r\n              h;\r\n          if (index === 0) {\r\n            //第一个节点 用自己代替前一个节点\r\n            before1x = x + (1 + dash / 2) + (dash + 1) * index;\r\n            before1y =\r\n              y +\r\n              h -\r\n              ((data[index] - normalizedOption.min) /\r\n                (normalizedOption.max - normalizedOption.min)) *\r\n                h;\r\n          } else if (index === data.length - 2) {\r\n            //倒数第二个节点 用下一个节点替代下下个节点\r\n            last2x = x + (1 + dash / 2) + (dash + 1) * (index + 1);\r\n            last2y =\r\n              y +\r\n              h -\r\n              ((data[index + 1] - normalizedOption.min) /\r\n                (normalizedOption.max - normalizedOption.min)) *\r\n                h;\r\n          }\r\n          coordinateValue.push({ x: currentX, y: currentY });\r\n          cAx = currentX + (last1x - before1x) / 4;\r\n          cAy = currentY + (last1y - before1y) / 4;\r\n          cBx = last1x - (last2x - currentX) / 4;\r\n          cBy = last1y - (last2y - currentY) / 4;\r\n          ctx.bezierCurveTo(cAx, cAy, cBx, cBy, last1x, last1y);\r\n          //绘制到下一个节点的贝塞尔曲线\r\n        });\r\n      }\r\n    } else {\r\n      for (let i = 1; i < data.length; i++) {\r\n        currentX = x + (1 + dash / 2) + (dash + 1) * i;\r\n        currentY =\r\n          y +\r\n          h -\r\n          ((data[i] - normalizedOption.min) /\r\n            (normalizedOption.max - normalizedOption.min)) *\r\n            h;\r\n        ctx.lineTo(currentX, currentY);\r\n        coordinateValue.push({ x: currentX, y: currentY });\r\n      }\r\n    }\r\n    ctx.stroke();\r\n    ctx.closePath();\r\n    ctx.save();\r\n    coordinateValue.forEach((item, index) => {\r\n      ctx.beginPath();\r\n      ctx.strokeStyle = '#fff';\r\n      ctx.lineWidth = 2 * scale;\r\n      ctx.arc(item.x, item.y, 4 * scale, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n      ctx.fill();\r\n      ctx.closePath();\r\n    });\r\n    ctx.restore();\r\n    coordinateValue = [];\r\n  }\r\n}\r\n\r\nexport function beforeValue(pen: leChartPen, value: any) {\r\n  if (value.xAxisData || value.data || (!value.dataX && !value.dataY)) {\r\n    // 整体传参，不做处理\r\n    return value;\r\n  }\r\n\r\n  const _xAxisData = pen.xAxisData;\r\n  const _data = pen.data;\r\n  const replaceMode = pen.replaceMode;\r\n  let xAxisData = [];\r\n  let data = [];\r\n  if (!replaceMode) {\r\n    //追加\r\n    xAxisData = [..._xAxisData, ...value.dataX];\r\n    _data.forEach((item: any, index: number) => {\r\n      let _item = [...item, ...value.dataY[index]];\r\n      data.push(_item);\r\n    });\r\n  } else if (replaceMode === ReplaceMode.Replace) {\r\n    //替换部分\r\n    value.dataX.forEach((item: any, i: number) => {\r\n      let _index = _xAxisData.indexOf(item);\r\n      _data.forEach((d: any, index: number) => {\r\n        d[_index] = value.dataY[index][i];\r\n      });\r\n    });\r\n    xAxisData = _xAxisData;\r\n    data = _data;\r\n  } else if (replaceMode === ReplaceMode.ReplaceAll) {\r\n    //全部替换\r\n    xAxisData = value.dataX;\r\n    data = value.dataY;\r\n  }\r\n  delete value.dataX;\r\n  delete value.dataY;\r\n  return Object.assign(value, { xAxisData, data });\r\n}\r\n","import { leChartPen, ReplaceMode } from './common';\r\nimport {getFont} from \"@meta2d/core\";\r\n//饼状图\r\nexport function pieChart(ctx: CanvasRenderingContext2D, pen: leChartPen) {\r\n  if (!pen.onBeforeValue) {\r\n    pen.onBeforeValue = beforeValue;\r\n  }\r\n  // 缩放模式\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n  const x = pen.calculative.worldRect.x;\r\n  const y = pen.calculative.worldRect.y;\r\n  const w = pen.calculative.worldRect.width;\r\n  const h = pen.calculative.worldRect.height;\r\n\r\n  const isEcharts = pen.echarts ? true : false;\r\n  // if (pen.echarts && !pen.echarts.option.color) {\r\n  //   pen.echarts.option.color = [\r\n  //     '#1890ff',\r\n  //     '#2FC25B',\r\n  //     '#FACC14',\r\n  //     '#c23531',\r\n  //     '#2f4554',\r\n  //     '#61a0a8',\r\n  //     '#d48265',\r\n  //   ];\r\n  // } else {\r\n  //   pen.chartsColor = [\r\n  //     '#1890ff',\r\n  //     '#2FC25B',\r\n  //     '#FACC14',\r\n  //     '#c23531',\r\n  //     '#2f4554',\r\n  //     '#61a0a8',\r\n  //     '#d48265',\r\n  //   ];\r\n  // }\r\n  if (pen.echarts) {\r\n    if (!pen.echarts.option.color) {\r\n      pen.echarts.option.color = [\r\n        '#1890ff',\r\n        '#2FC25B',\r\n        '#FACC14',\r\n        '#c23531',\r\n        '#2f4554',\r\n        '#61a0a8',\r\n        '#d48265',\r\n      ];\r\n    }\r\n    pen.chartsColor = pen.echarts.option.color;\r\n  } else {\r\n    if (!pen.chartsColor) {\r\n      pen.chartsColor = [\r\n        '#1890ff',\r\n        '#2FC25B',\r\n        '#FACC14',\r\n        '#c23531',\r\n        '#2f4554',\r\n        '#61a0a8',\r\n        '#d48265',\r\n      ];\r\n    }\r\n  }\r\n  const seriesArray = isEcharts ? pen.echarts.option.series : pen.data;\r\n  let beforeSeriesLength = 0;\r\n  for (let ser = 0; ser < seriesArray.length; ser++) {\r\n    let series = seriesArray[ser];\r\n    let r = w / 2;\r\n    if (h < w) {\r\n      r = h / 2;\r\n    }\r\n    const centerX = x + w / 2;\r\n    const centerY = y + h / 2;\r\n    let sum = 0;\r\n    if (isEcharts) {\r\n      sum = series.data.reduce((prev: number, curr: any) => {\r\n        return prev + curr.value;\r\n      }, 0);\r\n    } else {\r\n      sum = series.reduce((prev: number, curr: any) => {\r\n        return prev + curr.value;\r\n      }, 0);\r\n    }\r\n    const fromR =\r\n      (r *\r\n        parseFloat(isEcharts ? series.radius[0] : pen.chartsRadius[ser][0])) /\r\n      100;\r\n    const toR =\r\n      (r *\r\n        parseFloat(isEcharts ? series.radius[1] : pen.chartsRadius[ser][1])) /\r\n      100;\r\n    if (fromR > toR) {\r\n      return;\r\n    }\r\n    let beforeAngle = 0;\r\n    let afterAngle = 0;\r\n    ctx.strokeStyle = isEcharts\r\n      ? series.itemStyle?.borderColor || '#fff'\r\n      : '#fff';\r\n    ctx.lineWidth = (isEcharts ? series.itemStyle?.borderWidth || 2 : 2) * scale;\r\n    const data = isEcharts ? series.data : series;\r\n    data.forEach((item: any, index: number) => {\r\n      afterAngle += (Math.PI * 2 * item.value) / sum;\r\n      ctx.beginPath();\r\n      let colorLength = beforeSeriesLength + index;\r\n      if (colorLength >= pen.chartsColor.length) {\r\n        colorLength = colorLength % pen.chartsColor.length;\r\n      }\r\n      ctx.fillStyle = isEcharts\r\n        ? pen.echarts.option.color[colorLength]\r\n        : pen.chartsColor[colorLength];\r\n      ctx.moveTo(\r\n        centerX + fromR * Math.sin(afterAngle),\r\n        centerY - fromR * Math.cos(afterAngle)\r\n      );\r\n      ctx.arc(\r\n        centerX,\r\n        centerY,\r\n        fromR,\r\n        -Math.PI / 2 + afterAngle,\r\n        -Math.PI / 2 + beforeAngle,\r\n        true\r\n      );\r\n      ctx.lineTo(\r\n        centerX + toR * Math.sin(beforeAngle),\r\n        centerY - toR * Math.cos(beforeAngle)\r\n      );\r\n      ctx.arc(\r\n        centerX,\r\n        centerY,\r\n        toR,\r\n        -Math.PI / 2 + beforeAngle,\r\n        -Math.PI / 2 + afterAngle\r\n      );\r\n      ctx.lineTo(\r\n        centerX + fromR * Math.sin(afterAngle),\r\n        centerY - fromR * Math.cos(afterAngle)\r\n      );\r\n      ctx.stroke();\r\n      ctx.fill();\r\n      ctx.closePath();\r\n      //绘制label\r\n      let centerAngle = (beforeAngle + afterAngle) / 2;\r\n      let temX = centerX + (toR + 10*scale) * Math.sin(centerAngle);\r\n      let temY = centerY - (toR + 10*scale) * Math.cos(centerAngle);\r\n      let temFillStyle = ctx.fillStyle;\r\n      if (!series.label) {\r\n        series.label = { position: 'outside', show: true };\r\n      }\r\n      if (isEcharts && ['inner', 'inside'].includes(series.label.position)) {\r\n        ctx.fillStyle = '#ffffff';\r\n        temX = centerX + ((toR - fromR) / 2) * Math.sin(centerAngle);\r\n        temY = centerY - ((toR - fromR) / 2) * Math.cos(centerAngle);\r\n      } else if (isEcharts && series.label.position == 'outside') {\r\n      }\r\n      if (!series.labelLine) {\r\n        series.labelLine = { show: true };\r\n      }\r\n      if ((isEcharts && series.labelLine.show !== false) || !isEcharts) {\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = isEcharts\r\n          ? pen.echarts.option.color[beforeSeriesLength + index]\r\n          : pen.chartsColor[beforeSeriesLength + index];\r\n        ctx.moveTo(\r\n          centerX + toR * Math.sin(centerAngle),\r\n          centerY - toR * Math.cos(centerAngle)\r\n        );\r\n\r\n        ctx.lineTo(temX, temY);\r\n      }\r\n      let fontOption = {\r\n        fontStyle: pen.tickLabel?.fontStyle || pen.calculative.fontStyle,\r\n        fontWeight:pen.tickLabel?.fontWeight || pen.calculative.fontWeight,\r\n        fontFamily:pen.tickLabel?.fontFamily || pen.calculative.fontFamily,\r\n        lineHeight: pen.tickLabel?.lineHeight || pen.calculative.lineHeight,\r\n        fontSize: (pen.tickLabel?.fontSize || pen.calculative.fontSize) * scale\r\n      };\r\n      ctx.font = getFont(fontOption);  // r / 10 + 'px AlibabaPuHuiTi-Regular, Alibaba PuHuiTi';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.textAlign = 'center';\r\n      // 写入文字\r\n      if (centerAngle > Math.PI) {\r\n        if ((isEcharts && series.label.position === 'outside') || !isEcharts) {\r\n          ctx.textAlign = 'end';\r\n        }\r\n        if ((isEcharts && series.labelLine.show !== false) || (!isEcharts && (pen.tickLabel?.labelLine?.show??true))) {\r\n          ctx.lineTo(temX - 5*scale, temY);\r\n        }\r\n        if ((isEcharts && series.label.show !== false) || (!isEcharts && (pen.tickLabel?.show??true))) {\r\n          ctx.fillText(item.name, temX - 5*scale, temY);\r\n        }\r\n      } else {\r\n        if ((isEcharts && series.label.position === 'outside') || !isEcharts) {\r\n          ctx.textAlign = 'start';\r\n        }\r\n        if ((isEcharts && series.labelLine.show !== false) || !isEcharts) {\r\n          ctx.lineTo(temX + 5*scale, temY);\r\n        }\r\n        if ((isEcharts && series.label.show !== false) || (!isEcharts && (pen.tickLabel?.show??true))) {\r\n          ctx.fillText(item.name, temX + 5*scale, temY);\r\n        }\r\n      }\r\n      ctx.stroke();\r\n      ctx.closePath();\r\n      ctx.fillStyle = temFillStyle;\r\n      ctx.strokeStyle = isEcharts\r\n        ? series.itemStyle?.borderColor || '#fff'\r\n        : '#fff';\r\n      beforeAngle = afterAngle;\r\n    });\r\n\r\n    beforeSeriesLength += data.length;\r\n  }\r\n}\r\n\r\nfunction beforeValue(pen: leChartPen, value: any) {\r\n  if (value.data || (!value.dataX && !value.dataY)) {\r\n    // 整体传参，不做处理\r\n    return value;\r\n  }\r\n\r\n  const _data = pen.data;\r\n  const replaceMode = pen.replaceMode;\r\n  let data = [];\r\n  if (!replaceMode) {\r\n    //追加\r\n    _data.forEach((item: any, index: number) => {\r\n      let _item = [...item, ...value.dataY[index]];\r\n      data.push(_item);\r\n    });\r\n  } else if (replaceMode === ReplaceMode.Replace) {\r\n    //替换部分\r\n    value.dataY.forEach((item: any, index: number) => {\r\n      item.forEach((_innerItem: any, _innderIndex: number) => {\r\n        let _filterItem = _data[index].filter(\r\n          (_i: any) => _i.name === _innerItem.name\r\n        );\r\n        if (_filterItem.length > 0) {\r\n          _filterItem[0].value = _innerItem.value;\r\n        }\r\n      });\r\n    });\r\n    data = _data;\r\n  } else if (replaceMode === ReplaceMode.ReplaceAll) {\r\n    //全部替换\r\n    data = value.dataY;\r\n  }\r\n  delete value.dataX;\r\n  delete value.dataY;\r\n  return Object.assign(value, { data });\r\n}\r\n","import { coordinateAxis } from './coordinateAxis';\r\nimport { leChartPen } from './common';\r\nimport { beforeValue } from './lineChart';\r\n\r\n//柱状图\r\nexport function histogram(ctx: CanvasRenderingContext2D, pen: leChartPen) {\r\n  if (!pen.onBeforeValue) {\r\n    pen.onBeforeValue = beforeValue;\r\n  }\r\n\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n  const x = pen.calculative.worldRect.x;\r\n  const y = pen.calculative.worldRect.y;\r\n  const w = pen.calculative.worldRect.width;\r\n  const h = pen.calculative.worldRect.height;\r\n  let series = [];\r\n  if (pen.echarts && !pen.echarts.option.color) {\r\n    pen.echarts.option.color = [\r\n      '#1890ff',\r\n      '#2FC25B',\r\n      '#FACC14',\r\n      '#c23531',\r\n      '#2f4554',\r\n      '#61a0a8',\r\n      '#d48265',\r\n    ];\r\n  }\r\n  if (pen.echarts) {\r\n    for (let i = 0; i < pen.echarts.option.series.length; i++) {\r\n      series.push(pen.echarts.option.series[i].data);\r\n    }\r\n  } else {\r\n    series = pen.data;\r\n  }\r\n  let coordinate = coordinateAxis(ctx, pen);\r\n  let dash = coordinate.dash;\r\n  let normalizedOption = coordinate.normalizedOption;\r\n\r\n  let itemWidth = (dash * 4) / 5 / series.length;\r\n  // ctx.strokeStyle = '#ffffff';\r\n  for (let j = 0; j < series.length; j++) {\r\n    ctx.beginPath();\r\n    let data = series[j];\r\n    ctx.fillStyle = pen.echarts\r\n      ? pen.echarts.option.color[j]\r\n      : pen.chartsColor[j];\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineWidth = 1 * scale;\r\n    let currentX = 0;\r\n    let currentY = 0;\r\n    let currentH = 0;\r\n    for (let i = 0; i < data.length; i++) {\r\n      currentX = x + (1 + 0.1 * dash) + (dash + 1) * i + itemWidth * j;\r\n      currentH =\r\n        ((data[i] - normalizedOption.min) /\r\n          (normalizedOption.max - normalizedOption.min)) *\r\n        h;\r\n      currentY = y + h - currentH;\r\n      //宽度-1是为了数据之间的间距 高度-1是为了坐标轴不被覆盖\r\n      ctx.rect(currentX, currentY, itemWidth - 1, currentH - 1);\r\n      ctx.stroke();\r\n      ctx.fill();\r\n    }\r\n    ctx.closePath();\r\n  }\r\n\r\n  // let;\r\n}\r\n","import { getValidValue, leChartPen } from './common';\r\nimport {getFont} from \"@meta2d/core\";\r\n\r\n//仪表全盘\r\nexport function gauge(ctx: CanvasRenderingContext2D, pen: leChartPen): void {\r\n  if (!pen.onAdd) {\r\n    pen.onAdd = onAdd;\r\n    pen.onDestroy = onDestroy;\r\n    pen.onClick = onclick;\r\n    if (pen.clockInterval) {\r\n      pen.onDestroy(pen);\r\n      pen.onAdd(pen);\r\n    }\r\n  }\r\n  const x = pen.calculative.worldRect.x;\r\n  const y = pen.calculative.worldRect.y;\r\n  const w = pen.calculative.worldRect.width;\r\n  const h = pen.calculative.worldRect.height;\r\n  let scale = pen.calculative.canvas.store.data.scale;\r\n\r\n  let basicConfigure = {\r\n    startAngle: 225,\r\n    endAngle: -45,\r\n    min: 0,\r\n    max: 100,\r\n    splitNumber: 10,\r\n  };\r\n  //对echarts写法做兼容性处理\r\n  if (pen.echarts && pen.echarts.option) {\r\n    let series = pen.echarts.option.series[0];\r\n    pen.startAngle = series.startAngle || basicConfigure.startAngle;\r\n    pen.endAngle = series.endAngle || basicConfigure.endAngle;\r\n    pen.min = series.min || basicConfigure.min;\r\n    pen.max = series.max || basicConfigure.max;\r\n    pen.axisLine = series.axisLine.lineStyle.color;\r\n    pen.unit = series.detail.formatter.replace('{value}', '');\r\n    pen.value = series.data[0].value;\r\n    pen.splitNumber = series.splitNumber || basicConfigure.splitNumber;\r\n  }\r\n\r\n  pen = { ...basicConfigure, ...pen };\r\n  let r = w > h ? ((h / 2) * 9) / 10 : ((w / 2) * 9) / 10;\r\n  let centerX = x + w / 2;\r\n  let centerY = y + h / 2;\r\n  let value = pen.echarts\r\n    ? pen.echarts.option.series[0].data[0].value\r\n    : pen.value;\r\n  let pointColor: string;\r\n  let gap = pen.startAngle - pen.endAngle;\r\n  let bgColor = pen.background || '#E6EBF8';\r\n\r\n  //绘制背景\r\n  ctx.strokeStyle = bgColor;\r\n  let bgLineWidth = r / 10;\r\n  ctx.lineWidth = bgLineWidth;\r\n  ctx.beginPath();\r\n  ctx.lineCap = 'round';\r\n  ctx.arc(\r\n    centerX,\r\n    centerY,\r\n    r,\r\n    (-pen.startAngle / 180) * Math.PI,\r\n    (-pen.endAngle / 180) * Math.PI\r\n  );\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n\r\n  let bili = 0;\r\n  if (pen.axisLine && !pen.isClock) {\r\n    for (let i = pen.axisLine.length - 1; i >= 0; i--) {\r\n      if (pen.axisLine[i][0] * (pen.max - pen.min) < value) {\r\n        bili = pen.axisLine[i][0];\r\n      } else {\r\n        bili = (value - pen.min) / (pen.max - pen.min);\r\n        pointColor = pen.axisLine[i][1];\r\n      }\r\n      ctx.beginPath();\r\n      ctx.strokeStyle = pen.axisLine[i][1];\r\n      ctx.arc(\r\n        centerX,\r\n        centerY,\r\n        r,\r\n        (-pen.startAngle / 180) * Math.PI,\r\n        ((-pen.startAngle + bili * gap) / 180) * Math.PI\r\n      );\r\n      ctx.stroke();\r\n      ctx.closePath();\r\n    }\r\n  }\r\n  ctx.lineCap = 'butt';\r\n  //主刻度线\r\n  let dashWidth = 2 * scale;\r\n  let mainR = r - bgLineWidth;\r\n  if (mainR < 0) {\r\n    mainR = 0;\r\n  }\r\n  let arcLength = (gap / 180) * Math.PI * mainR;\r\n\r\n  let dash = (arcLength - dashWidth * pen.splitNumber) / pen.splitNumber;\r\n  let offsetAngle = ((gap / 180) * Math.PI * dashWidth) / 2 / arcLength;\r\n\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = pen.color || '#999999';\r\n  ctx.lineWidth = r / 20;\r\n  ctx.setLineDash([dashWidth, dash]);\r\n  ctx.arc(\r\n    centerX,\r\n    centerY,\r\n    mainR,\r\n    (-pen.startAngle / 180) * Math.PI - offsetAngle,\r\n    (-pen.endAngle / 180) * Math.PI + offsetAngle\r\n  );\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n\r\n  //从刻度线\r\n  let fromDashWidth = 1 * scale;\r\n  let fromR = r - bgLineWidth;\r\n  if (fromR < 0) {\r\n    fromR = 0;\r\n  }\r\n  let fromArcLength = (gap / 180) * Math.PI * fromR;\r\n\r\n  let fromDash =\r\n    (fromArcLength - fromDashWidth * 5 * pen.splitNumber) / 5 / pen.splitNumber;\r\n  let fromOffsetAngle =\r\n    ((gap / 180) * Math.PI * fromDashWidth) / 2 / fromArcLength;\r\n\r\n  ctx.beginPath();\r\n  ctx.strokeStyle = pen.color || '#999999';\r\n  ctx.lineWidth = r / 40;\r\n  ctx.setLineDash([fromDashWidth, fromDash]);\r\n  ctx.arc(\r\n    centerX,\r\n    centerY,\r\n    fromR,\r\n    (-pen.startAngle / 180) * Math.PI - fromOffsetAngle,\r\n    (-pen.endAngle / 180) * Math.PI + fromOffsetAngle\r\n  );\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n\r\n  //绘制文字\r\n  ctx.beginPath();\r\n  let valueGap = pen.max - pen.min;\r\n  let interval = valueGap / pen.splitNumber;\r\n  let fontOption = {\r\n    fontStyle: pen.tickLabel?.fontStyle || pen.calculative.fontStyle,\r\n    textDecoration: pen.tickLabel?.textDecoration || pen.textDecoration,\r\n    fontWeight: pen.tickLabel?.fontWeight || pen.calculative.fontWeight,\r\n    fontFamily: pen.tickLabel?.fontFamily || pen.calculative.fontFamily,\r\n    fontSize: (pen.tickLabel?.fontSize || pen.calculative.fontSize) * scale,\r\n    lineHeight: pen.tickLabel?.lineHeight || pen.calculative.lineHeight,\r\n  };\r\n  ctx.font = getFont(fontOption);\r\n  let textR = r - bgLineWidth - r / 20;\r\n  for (let i = 0; i <= pen.splitNumber; i++) {\r\n    if (Math.abs(pen.startAngle) + Math.abs(pen.endAngle) === 360) {\r\n      //形成一个圆形\r\n      if (i == 0) continue;\r\n    }\r\n    let angle = pen.startAngle - ((interval * i) / valueGap) * gap;\r\n    let width = Math.cos((angle / 180) * Math.PI);\r\n    let height = Math.sin((angle / 180) * Math.PI);\r\n    ctx.fillStyle = pen.tickLabel?.color || '#999999';\r\n    if (width > 0.02) {\r\n      ctx.textAlign = 'end';\r\n    } else if (width < -0.02) {\r\n      ctx.textAlign = 'start';\r\n    } else {\r\n      ctx.textAlign = 'center';\r\n    }\r\n    if (height > 0.02) {\r\n      ctx.textBaseline = 'top';\r\n    } else if (height < -0.02) {\r\n      ctx.textBaseline = 'bottom';\r\n    } else {\r\n      ctx.textBaseline = 'middle';\r\n    }\r\n    ctx.fillText(\r\n      getValidValue(interval * i + pen.min, 1),\r\n      centerX + textR * width,\r\n      centerY - textR * height\r\n    );\r\n    ctx.fill();\r\n  }\r\n  ctx.closePath();\r\n\r\n  //绘制指针\r\n\r\n  let pointNum = 1;\r\n  let valueArray = ['value'];\r\n  if (pen.isClock) {\r\n    pointNum = 3;\r\n    valueArray = ['hourvalue', 'minutevalue', 'secondvalue'];\r\n  }\r\n  if (pen.isClock) {\r\n    for (let i = 0; i < pointNum; i++) {\r\n      let currentAngle =\r\n        ((pen.startAngle -\r\n          ((pen[valueArray[i]] - pen.min) / (pen.max - pen.min)) * gap) /\r\n          180) *\r\n        Math.PI;\r\n      if (i > 0) {\r\n        currentAngle =\r\n          ((pen.startAngle -\r\n            ((pen[valueArray[i]] - pen.min) / (pen.max * 5 - pen.min)) * gap) /\r\n            180) *\r\n          Math.PI;\r\n      }\r\n      let pointerR = (4 / 5) * r;\r\n      if (valueArray[i] === 'hourvalue') {\r\n        pointerR = (3 / 5) * r;\r\n      }\r\n      if (valueArray[i] === 'minutevalue') {\r\n        pointerR = (3.5 / 5) * r;\r\n      }\r\n      let pointerHalfW = (r * 1) / 40;\r\n      ctx.beginPath();\r\n      ctx.setLineDash([]);\r\n      ctx.lineWidth = r / (i + 1) / 20;\r\n      ctx.strokeStyle = pen.color || '#999999';\r\n      ctx.moveTo(\r\n        centerX - pointerHalfW * 3 * Math.cos(currentAngle),\r\n        centerY + pointerHalfW * 3 * Math.sin(currentAngle)\r\n      );\r\n      ctx.lineTo(\r\n        centerX + pointerR * Math.cos(currentAngle),\r\n        centerY - pointerR * Math.sin(currentAngle)\r\n      );\r\n      ctx.stroke();\r\n    }\r\n  } else {\r\n    let currentAngle =\r\n      ((pen.startAngle - ((value - pen.min) / (pen.max - pen.min)) * gap) /\r\n        180) *\r\n      Math.PI;\r\n    let pointerR = (4 / 5) * r;\r\n    let pointerHalfW = (r * 1) / 40;\r\n    ctx.beginPath();\r\n    ctx.setLineDash([]);\r\n    ctx.lineWidth = 2;\r\n    ctx.fillStyle = pointColor;\r\n    ctx.moveTo(\r\n      centerX - pointerHalfW * 3 * Math.cos(currentAngle),\r\n      centerY + pointerHalfW * 3 * Math.sin(currentAngle)\r\n    );\r\n    ctx.lineTo(\r\n      centerX + pointerHalfW * Math.cos(currentAngle - Math.PI / 2),\r\n      centerY - pointerHalfW * Math.sin(currentAngle - Math.PI / 2)\r\n    );\r\n    ctx.lineTo(\r\n      centerX + pointerR * Math.cos(currentAngle),\r\n      centerY - pointerR * Math.sin(currentAngle)\r\n    );\r\n    ctx.lineTo(\r\n      centerX + pointerHalfW * Math.cos(currentAngle + Math.PI / 2),\r\n      centerY - pointerHalfW * Math.sin(currentAngle + Math.PI / 2)\r\n    );\r\n    ctx.lineTo(\r\n      centerX - pointerHalfW * 3 * Math.cos(currentAngle),\r\n      centerY + pointerHalfW * 3 * Math.sin(currentAngle)\r\n    );\r\n    ctx.fill();\r\n  }\r\n  //文字描述\r\n\r\n  ctx.beginPath();\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  let titleOption = {\r\n    fontStyle: pen.titleLabel?.fontStyle || pen.calculative.fontStyle,\r\n    textDecoration: pen.titleLabel?.textDecoration || pen.textDecoration,\r\n    fontWeight: pen.titleLabel?.fontWeight || pen.calculative.fontWeight,\r\n    fontFamily: pen.titleLabel?.fontFamily || pen.calculative.fontFamily,\r\n    fontSize: (pen.titleLabel?.fontSize || pen.calculative.fontSize) * scale,\r\n    lineHeight: pen.titleLabel?.lineHeight || pen.calculative.lineHeight,\r\n  };\r\n  ctx.font = getFont(titleOption);\r\n  ctx.fillStyle = pen.titleLabel?.color || pointColor;\r\n  if (pen.isClock) {\r\n    ctx.fillText(\r\n      ('0' + parseInt(pen.hourvalue)).slice(-2) +\r\n        ':' +\r\n        ('0' + parseInt(pen.minutevalue)).slice(-2) +\r\n        ':' +\r\n        ('0' + parseInt(pen.secondvalue)).slice(-2),\r\n      centerX,\r\n      centerY + r / 2\r\n    );\r\n  } else {\r\n    ctx.fillText(value + ' ' + (pen.unit || ''), centerX, centerY + r / 2);\r\n  }\r\n  ctx.fill();\r\n\r\n  if (pen.isClock) {\r\n    ctx.beginPath();\r\n    ctx.fillStyle = pen.color || '#999999';\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.arc(centerX, centerY, r / 20, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n    ctx.fill();\r\n    ctx.closePath();\r\n  }\r\n}\r\n\r\nfunction onAdd(pen: leChartPen) {\r\n  if (pen.isClock) {\r\n    pen.clockInterval = setInterval(() => {\r\n      let date = new Date();\r\n      let second = date.getSeconds();\r\n      let minute = date.getMinutes() + second / 60;\r\n      let hour = (date.getHours() % 12) + minute / 60;\r\n      pen.calculative.canvas.parent.setValue(\r\n        {\r\n          id: pen.id,\r\n          hourvalue: hour,\r\n          minutevalue: minute,\r\n          secondvalue: second,\r\n        },\r\n        {\r\n          render: true,\r\n          doEvent: false,\r\n        }\r\n      );\r\n    }, 1000);\r\n  } else {\r\n    const tem = pen.value;\r\n    pen.value = 0;\r\n    pen.frames = [\r\n      {\r\n        duration: 2000,\r\n        value: tem,\r\n      },\r\n    ];\r\n    pen.calculative.canvas.parent.startAnimate(pen.id);\r\n    setTimeout(() => {\r\n      pen.value = tem;\r\n    }, 1000);\r\n  }\r\n}\r\n\r\nfunction onDestroy(pen: any) {\r\n  if (pen.clockInterval) {\r\n    clearInterval(pen.clockInterval);\r\n    pen.clockInterval = undefined;\r\n  }\r\n}\r\n\r\nfunction onclick(pen: any) {\r\n  if (pen.isClock) {\r\n    pen.onDestroy(pen);\r\n    pen.onAdd(pen);\r\n  }\r\n}\r\n","import { lineChart } from './lineChart';\r\nimport { histogram } from './histogram';\r\nimport { pieChart } from './pieChart';\r\nimport { gauge } from './gauge';\r\n\r\nexport function chartsPens() {\r\n  return {\r\n    lineChart,\r\n    histogram,\r\n    pieChart,\r\n    gauge,\r\n  };\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function andGate(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 6;\r\n  const myw = width / 4;\r\n  path.moveTo(x + myw * 2, y + 0);\r\n  path.lineTo(x + myw * 2, y + myh);\r\n  path.moveTo(x, y + myh + myw * 2);\r\n  path.arc(\r\n    x + myw * 2,\r\n    y + myh + myw * 2,\r\n    myw * 2,\r\n    Math.PI * 1,\r\n    Math.PI * 2,\r\n    false\r\n  );\r\n  path.lineTo(x + myw * 4, y + myh * 5);\r\n  path.lineTo(x, y + myh * 5);\r\n  path.lineTo(x, y + myh + myw * 2);\r\n  path.moveTo(x + myw, y + myh * 5);\r\n  path.lineTo(x + myw, y + myh * 6);\r\n  path.moveTo(x + myw * 2, y + myh * 5);\r\n  path.lineTo(x + myw * 2, y + myh * 6);\r\n  path.moveTo(x + myw * 3, y + myh * 5);\r\n  path.lineTo(x + myw * 3, y + myh * 6);\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function andGateAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.25,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.75,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function basicEvent(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const vlineL = height - width;\r\n  const radius = 0.5 * width;\r\n  path.moveTo(x + width / 2, y);\r\n  path.lineTo(x + width / 2, y + vlineL);\r\n  path.moveTo(x + width, y + radius + vlineL);\r\n  path.arc(x + width / 2, y + radius + vlineL, radius, 0, Math.PI * 2, false);\r\n\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function basicEventAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function conditionalEvent(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 2;\r\n  const myw = width / 5;\r\n  path.moveTo(x, y + myh);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.moveTo(x + myw * 5, y + myh);\r\n  path.ellipse(x + myw * 3, y + myh, 2 * myw, myh, 0, 0, Math.PI * 2);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function conditionalEventAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.6,\r\n      y: 0,\r\n    },\r\n    { x: 1, y: 0.5 },\r\n    { x: 0.6, y: 1 },\r\n    { x: 0, y: 0.5 },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function event(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 4;\r\n  const myw = 0.5 * width;\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.moveTo(x, y + myh);\r\n  path.rect(x, y + myh, myw * 2, myh * 2);\r\n  path.moveTo(x + myw, y + 3 * myh);\r\n  path.lineTo(x + myw, y + 4 * myh);\r\n\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function forbiddenGate(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 8;\r\n  const myw = 0.25 * width;\r\n  path.moveTo(x + myw * 2, y);\r\n  path.lineTo(x + myw * 2, y + myh * 2);\r\n  path.lineTo(x + myw * 3, y + myh * 3);\r\n  path.lineTo(x + myw * 3, y + myh * 5);\r\n  path.lineTo(x + myw * 2, y + myh * 6);\r\n  path.lineTo(x + myw * 1, y + myh * 5);\r\n  path.lineTo(x + myw * 1, y + myh * 3);\r\n  path.lineTo(x + myw * 2, y + myh * 2);\r\n  path.moveTo(x + myw * 3, y + myh * 4);\r\n  path.lineTo(x + myw * 4, y + myh * 4);\r\n  path.moveTo(x + myw * 2, y + myh * 6);\r\n  path.lineTo(x + myw * 2, y + myh * 8);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function forbiddenGateAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 0.5,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function orGate(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const myw = width / 2;\r\n  const myh = height / 10;\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.moveTo(x + myw, y + myh);\r\n  path.quadraticCurveTo(x + myw * 2, y + myh, x + myw * 2, y + myh * 9);\r\n  path.moveTo(x + myw, y + myh);\r\n  path.quadraticCurveTo(x, y + myh, x, y + myh * 9);\r\n  path.quadraticCurveTo(x + myw, y + myh * 6, x + myw * 2, y + myh * 9);\r\n  path.moveTo(x + myw, y + (height * 3) / 4);\r\n  path.lineTo(x + myw, y + height);\r\n  path.moveTo(x + (myw * 2) / 5, y + (height * 201) / 250);\r\n  path.lineTo(x + (myw * 2) / 5, y + height);\r\n  path.moveTo(x + (myw * 8) / 5, y + (height * 201) / 250);\r\n  path.lineTo(x + (myw * 8) / 5, y + height);\r\n\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function orGateAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 0.2,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0.8,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function priorityAndGate(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 6;\r\n  const myw = width / 4;\r\n  path.moveTo(x + myw * 2, y + 0);\r\n  path.lineTo(x + myw * 2, y + myh);\r\n  path.moveTo(x, y + myh + myw * 2);\r\n  path.arc(\r\n    x + myw * 2,\r\n    y + myh + myw * 2,\r\n    myw * 2,\r\n    Math.PI * 1,\r\n    Math.PI * 2,\r\n    false\r\n  );\r\n  path.lineTo(x + myw * 4, y + myh * 5);\r\n  path.lineTo(x, y + myh * 5);\r\n  path.lineTo(x, y + myh + myw * 2);\r\n  path.moveTo(x, y + myh * 5 - myh / 3);\r\n  path.lineTo(x + myw * 4, y + myh * 5 - myh / 3);\r\n  path.moveTo(x + myw, y + myh * 5);\r\n  path.lineTo(x + myw, y + myh * 6);\r\n  path.moveTo(x + myw * 2, y + myh * 5);\r\n  path.lineTo(x + myw * 2, y + myh * 6);\r\n  path.moveTo(x + myw * 3, y + myh * 5);\r\n  path.lineTo(x + myw * 3, y + myh * 6);\r\n\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function switchEvent(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const myh = height / 4;\r\n  const myw = 0.5 * width;\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.lineTo(x + myw * 2, y + myh * 2);\r\n  path.lineTo(x + myw * 2, y + myh * 4);\r\n  path.lineTo(x, y + myh * 4);\r\n  path.lineTo(x, y + myh * 2);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function transferSymbol(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 4;\r\n  const myw = width / 2;\r\n\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.lineTo(x + myw * 2, y + myh * 4);\r\n  path.lineTo(x, y + myh * 4);\r\n  path.lineTo(x + myw, y + myh);\r\n\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function unexpandedEvent(\r\n  pen: Pen,\r\n  ctx?: CanvasRenderingContext2D\r\n): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  const myh = height / 3;\r\n  const myw = 0.5 * width;\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.lineTo(x + width, y + 2 * myh);\r\n  path.lineTo(x + myw, y + height);\r\n  path.lineTo(x, y + 2 * myh);\r\n  path.lineTo(x + myw, y + myh);\r\n\r\n  path.closePath();\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function unexpandedEventAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1,\r\n      y: 2 / 3,\r\n    },\r\n    {\r\n      x: 0.5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 0,\r\n      y: 2 / 3,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen, Point } from '@meta2d/core';\r\n\r\nexport function xorGate(pen: Pen, ctx?: CanvasRenderingContext2D): Path2D {\r\n  const path = !ctx ? new Path2D() : ctx;\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n\r\n  let myw = width / 2;\r\n  let myh = height / 10;\r\n  path.moveTo(x + myw, y);\r\n  path.lineTo(x + myw, y + myh);\r\n  path.moveTo(x + myw, y + myh);\r\n  path.quadraticCurveTo(x + myw * 2, y + myh, x + myw * 2, y + myh * 9);\r\n  path.moveTo(x + myw, y + myh);\r\n  path.quadraticCurveTo(x, y + myh, x, y + myh * 9);\r\n  path.quadraticCurveTo(x + myw, y + myh * 6, x + myw * 2, y + myh * 9);\r\n  path.moveTo(x, y + myh * 10);\r\n  path.quadraticCurveTo(x + myw, y + myh * 7, x + myw * 2, y + myh * 10);\r\n  path.moveTo(x + (myw * 2) / 5, y + (height * 201) / 250 + myh);\r\n  path.lineTo(x + (myw * 2) / 5, y + height);\r\n  path.moveTo(x + (myw * 8) / 5, y + (height * 201) / 250 + myh);\r\n  path.lineTo(x + (myw * 8) / 5, y + height);\r\n  path.closePath();\r\n\r\n  if (path instanceof Path2D) return path;\r\n}\r\n\r\nexport function xorGateAnchors(pen: Pen) {\r\n  const points = [\r\n    {\r\n      x: 0.5,\r\n      y: 0,\r\n    },\r\n    {\r\n      x: 1 / 5,\r\n      y: 1,\r\n    },\r\n    {\r\n      x: 4 / 5,\r\n      y: 1,\r\n    },\r\n  ] as const;\r\n  pen.anchors = points.map(({ x, y }, index) => {\r\n    return {\r\n      id: `${index}`,\r\n      penId: pen.id,\r\n      x,\r\n      y,\r\n    };\r\n  });\r\n}\r\n","import { Pen } from '@meta2d/core';\r\n\r\nexport function votingGate(ctx: CanvasRenderingContext2D, pen: Pen) {\r\n  const { x, y, width, height } = pen.calculative.worldRect;\r\n  const myw = width / 2;\r\n  const myh = height / 10;\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + myw, y);\r\n  ctx.lineTo(x + myw, y + myh);\r\n  ctx.moveTo(x + myw, y + myh);\r\n  ctx.quadraticCurveTo(x + myw * 2, y + myh, x + myw * 2, y + myh * 9);\r\n  ctx.moveTo(x + myw, y + myh);\r\n  ctx.quadraticCurveTo(x, y + myh, x, y + myh * 9);\r\n  ctx.quadraticCurveTo(x + myw, y + myh * 6, x + myw * 2, y + myh * 9);\r\n  ctx.moveTo(x + myw, y + (height * 3) / 4);\r\n  ctx.lineTo(x + myw, y + (height * 9) / 10);\r\n  ctx.moveTo(x + (myw * 2) / 5, y + (height * 201) / 250);\r\n  ctx.lineTo(x + (myw * 2) / 5, y + (height * 9) / 10);\r\n  ctx.moveTo(x + (myw * 8) / 5, y + (height * 201) / 250);\r\n  ctx.lineTo(x + (myw * 8) / 5, y + (height * 9) / 10);\r\n  ctx.stroke();\r\n  ctx.closePath();\r\n\r\n  ctx.beginPath();\r\n  const fontSize = myw * 2 > myh * 10 ? myh : myw / 5;\r\n  ctx.fillStyle = '#333333';\r\n  ctx.font = fontSize + 'px Arial';\r\n  ctx.textBaseline = 'bottom';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText('o', x + myw, y + height);\r\n  ctx.fillText('m', x + (myw * 2) / 5, y + height);\r\n  ctx.fillText('o', x + (myw * 8) / 5, y + height);\r\n  ctx.closePath();\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { andGate, andGateAnchors } from './andGate';\r\nimport { basicEvent, basicEventAnchors } from './basicEvent';\r\nimport { conditionalEvent, conditionalEventAnchors } from './conditionalEvent';\r\nimport { event } from './event';\r\nimport { forbiddenGate, forbiddenGateAnchors } from './forbiddenGate';\r\nimport { orGate, orGateAnchors } from './orGate';\r\nimport { priorityAndGate } from './priorityAndGate';\r\nimport { switchEvent } from './switchEvent';\r\nimport { transferSymbol } from './transferSymbol';\r\nimport { unexpandedEvent, unexpandedEventAnchors } from './unexpandedEvent';\r\nimport { votingGate } from './votingGate';\r\nimport { xorGate, xorGateAnchors } from './xorGate';\r\n\r\nexport function ftaPens(): Record<\r\n  string,\r\n  (pen: Pen, ctx?: CanvasRenderingContext2D) => Path2D\r\n> {\r\n  return {\r\n    andGate,\r\n    basicEvent,\r\n    conditionalEvent,\r\n    event,\r\n    forbiddenGate,\r\n    orGate,\r\n    priorityAndGate,\r\n    switchEvent,\r\n    transferSymbol,\r\n    unexpandedEvent,\r\n    xorGate,\r\n  };\r\n}\r\n\r\nexport function ftaPensbyCtx() {\r\n  return {\r\n    votingGate,\r\n  };\r\n}\r\n\r\nexport function ftaAnchors() {\r\n  return {\r\n    andGate: andGateAnchors,\r\n    orGate: orGateAnchors,\r\n    priorityAndGate: andGateAnchors,\r\n    votingGate: orGateAnchors,\r\n    xorGate: xorGateAnchors,\r\n    forbiddenGate: forbiddenGateAnchors,\r\n    basicEvent: basicEventAnchors,\r\n    unexpandedEvent: unexpandedEventAnchors,\r\n    conditionalEvent: conditionalEventAnchors,\r\n    transferSymbol: basicEventAnchors,\r\n  };\r\n}\r\n","import { Pen } from '@meta2d/core';\r\nimport { reactive } from 'vue';\r\n\r\nexport enum SelectionMode {\r\n  File,\r\n  Pen,\r\n  Pens\r\n}\r\n\r\nconst selections = reactive<{\r\n  mode: SelectionMode;\r\n  pen?: Pen;\r\n  pens?: Pen[];\r\n}>({\r\n  // 选中对象类型：0 - 画布；1 - 单个图元\r\n  mode: SelectionMode.File,\r\n  pen: undefined,\r\n});\r\n\r\nexport const useSelection = () => {\r\n  const select = (pens?: Pen[]) => {\r\n    if (!pens || pens.length < 1) {\r\n      selections.mode = SelectionMode.File;\r\n      selections.pen = undefined;\r\n      return;\r\n    }\r\n\r\n    console.log('select pens: ', pens);\r\n    if (pens.length === 1) {\r\n      selections.mode = SelectionMode.Pen;\r\n      selections.pen = pens[0];\r\n      return \r\n    }\r\n\r\n    selections.mode = SelectionMode.Pens;\r\n    selections.pens = [...pens];\r\n  };\r\n  return {\r\n    selections,\r\n    select,\r\n  };\r\n};\r\n","<template>\r\n  <t-card\r\n    v-show=\"visible\"\r\n    bordered\r\n    hoverShadow\r\n    class=\"context-menu\"\r\n    :style=\"style\"\r\n  >\r\n    <t-list>\r\n      <t-list-item\r\n        v-for=\"item in (isPreview?menuOptions1:menuOptions)\"\r\n        v-show=\"item.show ? item.show() : true\"\r\n      >\r\n        <t-button\r\n          theme=\"default\"\r\n          block\r\n          variant=\"outline\"\r\n          @click=\"item.action()\"\r\n          >{{ item.label }}</t-button\r\n        >\r\n      </t-list-item>\r\n    </t-list>\r\n  </t-card>\r\n</template>\r\n<script setup lang=\"ts\">\r\nimport { defineProps, computed } from \"vue\";\r\nimport { useSelection } from \"../services/selections\";\r\nimport { useData } from \"../services/useGraphics\";\r\nimport { parseSvgStr, parseSvgStr1 } from \"../utils/svgParser\";\r\nimport { readSVGFile } from \"../utils\";\r\nimport { NotifyPlugin } from \"tdesign-vue-next\";\r\nimport { deepClone, getAllChildren } from \"@meta2d/core\";\r\nconst props = defineProps({\r\n  x: {\r\n    type: Number,\r\n    default: 0,\r\n  },\r\n  y: {\r\n    type: Number,\r\n    default: 0,\r\n  },\r\n  visible: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  isPreview: {\r\n    type: Boolean,\r\n    default: false,\r\n  }\r\n});\r\n\r\nconst style = computed(() => {\r\n  return {\r\n    left: props.x + \"px\",\r\n    top: props.y + \"px\",\r\n  };\r\n});\r\n\r\nconst emit = defineEmits([\"hide\",\"send\"]);\r\n\r\nconst { selections } = useSelection();\r\nconst { saveComponentShow } = useData(true);\r\n\r\nconst menuOptions = [\r\n  {\r\n    label: \"锁定\",\r\n    icon: \"lock\",\r\n    action: () => {\r\n      console.log(\"lock\", selections);\r\n      if (selections.pen) {\r\n        const v = { id: selections.pen.id, locked: 2 };\r\n        meta2d.setValue(v, { render: true });\r\n      } else if (selections.pens) {\r\n        selections.pens.forEach((pen: any) => {\r\n          const v = { id: pen.id, locked: 2 };\r\n          meta2d.setValue(v, { render: true });\r\n        });\r\n      }\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      if (selections.pen) {\r\n        return !selections.pen.locked;\r\n      }\r\n      if (selections.pens) {\r\n        return !selections.pens.some((pen: any) => pen.locked > 0);\r\n      }\r\n    },\r\n  },\r\n  {\r\n    label: \"解锁\",\r\n    icon: \"lock\",\r\n    action: () => {\r\n      console.log(\"unlock\", selections);\r\n      if (selections.pen) {\r\n        const v = { id: selections.pen.id, locked: 0 };\r\n        meta2d.setValue(v, { render: true });\r\n      } else if (selections.pens) {\r\n        selections.pens.forEach((pen: any) => {\r\n          const v = { id: pen.id, locked: 0 };\r\n          meta2d.setValue(v, { render: true });\r\n        });\r\n      }\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      if (selections.pen) {\r\n        return selections.pen.locked;\r\n      }\r\n      if (selections.pens) {\r\n        return selections.pens.some((pen: any) => pen.locked > 0);\r\n      }\r\n    },\r\n  },\r\n\r\n  {\r\n    label: \"删除\",\r\n    icon: \"delete\",\r\n    action: () => {\r\n      if (selections.pen) {\r\n        meta2d.delete([selections.pen]);\r\n      } else if (selections.pens) {\r\n        meta2d.delete(selections.pens);\r\n      }\r\n      emit(\"hide\", false);\r\n    },\r\n  },\r\n\r\n  // 组合\r\n  {\r\n    label: \"组合\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      if (selections.pens) {\r\n        meta2d.combine(selections.pens);\r\n      }\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return selections.mode == 2;\r\n    },\r\n  },\r\n\r\n  {\r\n    label: \"组合为状态\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      console.log(\"group\", selections);\r\n      if (selections.pens) {\r\n        meta2d.combine(selections.pens, 0);\r\n      }\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return selections.mode == 2;\r\n    },\r\n  },\r\n  // 取消组合\r\n  {\r\n    label: \"取消组合\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      console.log(\"ungroup\", selections);\r\n      meta2d.uncombine(selections.pen);\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return selections.mode == 1 && selections.pen?.name == \"combine\";\r\n    },\r\n  },\r\n\r\n  {\r\n    label: \"保存为组件\",\r\n    icon: \"save\",\r\n    action: () => {\r\n      // console.log(\"save as component \", selections);\r\n      saveComponentShow(selections);\r\n      emit(\"hide\", false);\r\n    },\r\n  },\r\n\r\n  {\r\n    label: \"替换svg\",\r\n    icon: \"save\",\r\n    action: () => {\r\n      customToolbarClick(\"svg\");\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return selections.mode == 1 && selections.pen?.name == \"combine\";\r\n    },\r\n  },\r\n  {\r\n    label: \"标记\",\r\n    icon: \"mark\",\r\n    action: () => {\r\n      markHandle(true);\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      // 只能标记一个组合\r\n      return (\r\n        selections.mode == 1 &&\r\n        selections.pen?.name == \"combine\" &&\r\n        selections.pen?.showChild != undefined &&\r\n        !selections.pen?.tags?.includes(\"mark\")\r\n      );\r\n    },\r\n  },\r\n  {\r\n    label: \"取消标记\",\r\n    icon: \"mark\",\r\n    action: () => {\r\n      markHandle(false);\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return (\r\n        selections.mode == 1 &&\r\n        selections.pen?.name == \"combine\" &&\r\n        selections.pen?.showChild != undefined &&\r\n        selections.pen?.tags?.includes(\"mark\")\r\n      );\r\n    },\r\n  },\r\n  {\r\n    label: \"替换为标记的图元\",\r\n    icon: \"save\",\r\n    action: () => {\r\n      customToolbarClick(\"svgs\");\r\n      emit(\"hide\", false);\r\n    },\r\n    show: () => {\r\n      return (\r\n        selections.mode == 1 &&\r\n        selections.pen?.name == \"combine\" &&\r\n        selections.pen?.showChild != undefined &&\r\n        !selections.pen?.tags?.includes(\"mark\")\r\n      );\r\n    },\r\n  },\r\n];\r\nconst menuOptions1 =[\r\n  {\r\n    label: \"设置\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      if (selections.pen) {\r\n        // 弹窗\r\n        emit(\"send\", selections.pen, 'setting');\r\n        emit(\"hide\", false);\r\n      }\r\n    },\r\n    show: () => {\r\n      return selections.mode == 1 && selections.pen?.name == \"combine\" && props.isPreview;\r\n    },\r\n  },{\r\n    label: \"设置故障\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      if (selections.pen) {\r\n        const v = { id: selections.pen.id, fault: 1 };\r\n        meta2d.setValue(v, { render: true });\r\n        emit(\"send\", selections.pen,'fault');\r\n        emit(\"hide\", false);\r\n      }\r\n    },\r\n    show: () => {\r\n      return selections.mode == 1 && selections.pen?.name == \"combine\" && props.isPreview && selections.pen?.fault == 0;\r\n    },\r\n  },{\r\n    label: \"取消故障\",\r\n    icon: \"group\",\r\n    action: () => {\r\n      if (selections.pen) {\r\n        const v = { id: selections.pen.id, fault: 0 };\r\n        meta2d.setValue(v, { render: true });\r\n        emit(\"send\", selections.pen,'fault');\r\n        emit(\"hide\", false);\r\n      }\r\n    },\r\n    show: () => {\r\n      return selections.mode == 1 && selections.pen?.name == \"combine\" && props.isPreview && selections.pen?.fault == 1;\r\n    },\r\n  }\r\n]\r\n// 添加标记\r\nconst markHandle = (type: any) => {\r\n  console.log(\"meta2d\", meta2d.data());\r\n  if (type) {\r\n    let mark = false;\r\n    meta2d.data().pens.forEach((item) => {\r\n      if (item.tags?.includes(\"mark\")) {\r\n        NotifyPlugin.error({\r\n          title: \"只能标记一个组合，请先取消标记\",\r\n        });\r\n        mark = true;\r\n      }\r\n    });\r\n    if (mark) return;\r\n    selections.pen?.tags?.push(\"mark\");\r\n  } else {\r\n    let arr = selections.pen?.tags || [];\r\n    selections.pen.tags = arr.filter((item) => item !== \"mark\");\r\n  }\r\n};\r\n// 替换svg方法 需要拿到之前的pen数据放到上传的svg数据里 删除之前的元素\r\nconst customToolbarClick = (code?: string) => {\r\n  if (code == \"svg\") {\r\n    // 读取svg文件\r\n    readSVGFile((res: { data: string }) => {\r\n      // 读到一堆XML信息\r\n      let list = parseSvgStr1(res.data, selections.pen, false);\r\n      console.log(\"看看新的长啥样pens=====\", list);\r\n      //先删除原来的图元\r\n      meta2d.delete([selections.pen]);\r\n      // 更新位置\r\n      meta2d.addPens(list);\r\n    });\r\n    return;\r\n  }\r\n  if (code == \"svgs\") {\r\n    let mark = false;\r\n    meta2d.data().pens.forEach((item) => {\r\n      if (item.tags?.includes(\"mark\")) {\r\n        mark = true;\r\n      }\r\n    });\r\n    if (!mark) {\r\n      NotifyPlugin.error({\r\n        title: \"请先标记一个组合\",\r\n      });\r\n      return;\r\n    }\r\n    // // 1.获取当前选中的图元 要把这个数据做更改\r\n    let penConfig: any = selections.pen;\r\n    meta2d.delete([penConfig]); // 删除当前图元\r\n    // // 2.获取被标记的图元 只有一个\r\n    let pens =[];\r\n    meta2d.data().pens.forEach((item) => {\r\n      if (item.tags?.includes(\"mark\")) {\r\n        // toPen = item;\r\n        let parent = item;\r\n        // 获取被标记的图元下的子节点\r\n        let children = findChildren(parent, meta2d.data().pens);\r\n        // console.log(\"children=====\", children);\r\n        // 组装数据\r\n        children.forEach((item) => {\r\n          if (parent.children.includes(item.id)) {\r\n            item.parentId = penConfig?.id;\r\n          }\r\n\r\n        });\r\n        pens = [...children];\r\n      }\r\n    });\r\n    console.log(\"传入的SVG===== \", pens, \"以前的图元数据=====\", penConfig);\r\n    // 拿到之前的图元父节点进行组装吧\r\n    const parent = pens.find((v) => v.name == \"combine\" && !v.parentId);\r\n    let del = getAllChildren(parent,meta2d.store);\r\n    // 获取所有的paths\r\n    let paths = meta2d.data().paths;\r\n    meta2d.delete([...del,parent]);\r\n    Object.assign(parent, {\r\n      id: penConfig?.id,\r\n      x: penConfig?.x,\r\n      y: penConfig?.y,\r\n      description: penConfig?.description,\r\n      text: penConfig?.text,\r\n      withh: penConfig?.width,\r\n      height: penConfig?.height,\r\n      showChild: penConfig?.showChild,\r\n      //rotate: rotateAngelMap[item.rotateAngel] || 0, // 跟预期不一致\r\n      tags: penConfig?.tags,\r\n    });\r\n    meta2d.store.data.paths = paths;\r\n    // //处理子节点数据\r\n    meta2d.addPens(pens);\r\n  }\r\n};\r\nfunction findChildren(parent: any, list: any[]) {\r\n  if (!parent) return;\r\n  if (!list) return;\r\n  const result = [];\r\n  const queue = [parent];\r\n  while (queue.length) {\r\n    const current = queue.shift();\r\n    result.push(current);\r\n    for (const data of list) {\r\n      if (data.parentId == current.id) {\r\n        queue.push(data);\r\n      }\r\n    }\r\n  }\r\n  return result;\r\n}\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n.context-menu {\r\n  position: absolute;\r\n  z-index: 99;\r\n  text-align: left;\r\n\r\n  :deep(.t-card__body) {\r\n    padding: 0;\r\n  }\r\n\r\n  .t-button {\r\n    justify-content: start;\r\n  }\r\n}\r\n</style>\r\n","export enum MsgType {\r\n    MSG_FAMILY_SUBSCRIBE = 1,        // 消息订阅\r\n    MSG_FAMILY_UNSUBSCRIBE,          // 取消消息订阅\r\n    MSG_FAMILY_TRANSMIT,             // 消息转发\r\n    MSG_FAMILY_HEARTBEAT,            // 心跳消息\r\n    MSG_FAMILY_HEARTBEAT_FEEDBACK,   // 心跳反馈消息\r\n    MSG_FAMILY_REGISTER                // 网络消息注册\r\n}","import { MsgType } from './type';\r\ntype Callback = (data: any) => void;\r\n\r\nfunction createWsData(type: MsgType, busName: string, msgTypes: number[]) {\r\n  return {\r\n    interMsgType: type,\r\n    data: {\r\n      busName,\r\n      msgTypes,\r\n    },\r\n  };\r\n}\r\n\r\nexport class WebSocketClient {\r\n  private static InstanceMap: Map<string, WebSocketClient> = new Map();\r\n  private ws: WebSocket | null = null;\r\n  private url: string;\r\n  private messageHandlers: Map<string, Callback[]> = new Map();\r\n  private cache: Map<string, any> = new Map(); // 消息缓存\r\n  private heartbeatInterval: number;\r\n  private heartbeatTimer: NodeJS.Timeout | null = null;\r\n  // 客户端主动发送心跳\r\n  private enableHeartbeat = false;\r\n  private reconnectTimer: NodeJS.Timeout | null = null;\r\n  private isConnected = false;\r\n  // 最大重连次数\r\n  private maxReconnectTimes = 30;\r\n  // 重连间隔\r\n  private reconnectInterval = 3000;\r\n  private wsOptions = null;\r\n  private enableLog = true;\r\n  private _subscribeTasks: any[] = [];\r\n  private manualClosed = false;\r\n\r\n  private constructor(url: string, options: any = {}) {\r\n    const { heartbeatInterval = 30e3 } = options;\r\n    this.url = url;\r\n    this.heartbeatInterval = heartbeatInterval;\r\n    this.maxReconnectTimes = options.maxReconnectTimes || 30;\r\n    this.reconnectInterval = options.reconnectInterval || 3000;\r\n    this.wsOptions = options;\r\n    this.enableLog = options.enableLog;\r\n    this.enableHeartbeat = options.enableHeartbeat;\r\n  }\r\n\r\n  // 获取 WebSocketClient 单例实例\r\n  static getInstance(\r\n    url: string,\r\n    options?: any,\r\n  ): WebSocketClient {\r\n    if (!url.startsWith('ws://') && !url.startsWith('wss://')) {\r\n      url = 'ws://' + url;\r\n    }\r\n    console.log('getInstance: ', url, options)\r\n    let instance = WebSocketClient.InstanceMap.get(url);\r\n    if (!instance) {     \r\n      instance = new WebSocketClient(url, options);\r\n      WebSocketClient.InstanceMap.set(url, instance);\r\n    } else {\r\n      console.log('Using existing WebSocketClient instance.');\r\n    }\r\n    instance.connect();\r\n    return instance;\r\n  }\r\n\r\n\r\n  // 1. 初始化 WebSocket 连接并处理事件\r\n  connect() {\r\n    if (!this.url) {\r\n      // throw new Error('ws url is required');\r\n      console.error('ws url is required');\r\n      return\r\n    }\r\n    if (this.isConnected) {\r\n      this.wsOptions.onReady && this.wsOptions.onReady();\r\n      return;\r\n    }; // 避免重复连接\r\n\r\n    // 避免重复创建 ws\r\n    if (!this.ws) {\r\n      this.ws = new WebSocket(this.url);\r\n      this.ws.onopen = () => {\r\n        this.isConnected = true;\r\n        this.register();\r\n        this.startHeartbeat();\r\n        this.subscribe(this.wsOptions.busName, this.wsOptions.msgTypes);\r\n        // 清空队列\r\n        this._subscribeTasks.forEach((task) => {\r\n          task();\r\n        });\r\n        this._subscribeTasks = [];\r\n        this.wsOptions.onReady && this.wsOptions.onReady();\r\n      };\r\n  \r\n      this.ws.onmessage = (event) => {\r\n        this.handleMessage(event.data);\r\n      };\r\n  \r\n      this.ws.onclose = () => {\r\n        this.isConnected = false;\r\n        if (!this.manualClosed) {  // 只有非手动关闭时才重连和停止心跳\r\n          this.stopHeartbeat();\r\n          this.reconnect();\r\n        }\r\n        console.log('WebSocket connection closed.');\r\n      };\r\n  \r\n      this.ws.onerror = (error) => {\r\n        console.error('WebSocket error:', error);\r\n        this.isConnected = false;\r\n        this.stopHeartbeat();\r\n        this.reconnect();\r\n      };\r\n    } else if (this.ws.readyState === WebSocket.OPEN) {\r\n      this.wsOptions.onReady && this.wsOptions.onReady();\r\n    } else if ([WebSocket.CLOSING, WebSocket.CLOSED].includes(this.ws.readyState as any)) {\r\n      console.error('连接已断开：', this.url)\r\n      this.ws = new WebSocket(this.url);\r\n      this.ws.onopen = () => {\r\n        this.isConnected = true;\r\n        this.register();\r\n        this.startHeartbeat();\r\n        this.subscribe(this.wsOptions.busName, this.wsOptions.msgTypes);\r\n        // 清空队列\r\n        this._subscribeTasks.forEach((task) => {\r\n          task();\r\n        });\r\n        this._subscribeTasks = [];\r\n        this.wsOptions.onReady && this.wsOptions.onReady();\r\n      };\r\n  \r\n      this.ws.onmessage = (event) => {\r\n        this.handleMessage(event.data);\r\n      };\r\n  \r\n      this.ws.onclose = () => {\r\n        this.isConnected = false;\r\n        if (!this.manualClosed) {  // 只有非手动关闭时才重连和停止心跳\r\n          this.stopHeartbeat();\r\n          this.reconnect();\r\n        }\r\n        console.log('WebSocket connection closed.');\r\n      };\r\n  \r\n      this.ws.onerror = (error) => {\r\n        console.error('WebSocket error:', error);\r\n        this.isConnected = false;\r\n        this.stopHeartbeat();\r\n        this.reconnect();\r\n      };\r\n    } else {\r\n      console.log('WebSocket connecting:', this.ws.readyState);\r\n    }\r\n    \r\n  }\r\n\r\n  /**\r\n   * @description websocket通信建立后，应立刻发送此消息进行注册\r\n   * @param appName 应用名称\r\n   */\r\n  private register(appName?: string) {\r\n    const registerData = {\r\n      interMsgType: MsgType.MSG_FAMILY_REGISTER,\r\n      data: {\r\n        name: appName || this.wsOptions.appName || 'WebSocket Client',\r\n      },\r\n    };\r\n    this.ws.send(JSON.stringify(registerData));\r\n  }\r\n\r\n  /**\r\n   * @description TODO\r\n   * @param appName\r\n   */\r\n  private unRegister(appName?: string) {\r\n    // const registerData = createWsData(\r\n    //   MsgType.MSG_FAMILY_UNSUBSCRIBE,\r\n    //   busName || this.wsOptions.busName,\r\n    //   msgTypes || this.wsOptions.msgTypes\r\n    // );\r\n    // this.ws.send(JSON.stringify(registerData));\r\n  }\r\n\r\n  // 2. 处理 WebSocket 消息\r\n  private handleMessage(message: string) {\r\n    const parsedMessage = JSON.parse(message);\r\n    if (this.enableLog) {\r\n      console.log('Received message:', parsedMessage);\r\n    }\r\n    const { interMsgType, data } = parsedMessage;\r\n\r\n    // 处理心跳反馈消息\r\n    if (interMsgType === MsgType.MSG_FAMILY_HEARTBEAT) {\r\n      const feedbackMsg = {\r\n        interMsgType: MsgType.MSG_FAMILY_HEARTBEAT_FEEDBACK,\r\n        data,\r\n      };\r\n      this.ws.send(JSON.stringify(feedbackMsg));\r\n      return;\r\n    }\r\n\r\n    // 更新缓存\r\n    const type = data?.busName;\r\n    if (type) {\r\n      this.cache.set(type, data);\r\n    }\r\n\r\n    // 转发消息到对应的订阅者\r\n    const handlers = this.messageHandlers.get(type) || [];\r\n    handlers.forEach((handler) => handler && handler(data));\r\n  }\r\n\r\n  /**\r\n   * @description 客户端如果需要收到消息，需先订阅消息，订阅后BusServer会将对应的消息转发给对应的连接\r\n   *  当websocket通信断开了，当重新连接成功后，SDK中应再重新自动发送订阅消息。\r\n   * @param busName\r\n   * @param msgTypes\r\n   * @param callback\r\n   */\r\n  subscribe(busName: string, msgTypes: number[], callback?: Callback) {\r\n    const _busName = busName || this.wsOptions.busName;\r\n    const _msgTypes = msgTypes || this.wsOptions.msgTypes;\r\n    if (!_busName) {\r\n      console.error('订阅消息需要指定 [busName] 参数！');\r\n    }\r\n\r\n    const registerData = createWsData(\r\n      MsgType.MSG_FAMILY_SUBSCRIBE,\r\n      _busName,\r\n      _msgTypes\r\n    );\r\n    if (this.ws?.readyState !== WebSocket.OPEN) {\r\n      console.log('WebSocket 连接尚未建立，订阅任务加入队列');\r\n      this._subscribeTasks.push(() => {\r\n        this.ws.send(JSON.stringify(registerData));\r\n      });\r\n    } else {\r\n      this.ws.send(JSON.stringify(registerData));\r\n    }\r\n\r\n    // 如果有缓存的消息，直接调用回调\r\n    if (this.cache.has(_busName) && callback) {\r\n      callback(this.cache.get(_busName));\r\n    }\r\n\r\n    if (!callback) {\r\n      console.error(`请使用 subscribe() 方法订阅消息： ${_busName} `);\r\n      return;\r\n    }\r\n\r\n    // 注册新的消息处理器\r\n    if (!this.messageHandlers.has(_busName)) {\r\n      this.messageHandlers.set(_busName, []);\r\n    }\r\n    this.messageHandlers.get(_busName)!.push(callback);\r\n  }\r\n\r\n  /**\r\n   * @description 取消订阅后，BusServer 不再将对应消息转发给对应的连接\r\n   * @param busName\r\n   * @param msgTypes\r\n   * @param callback\r\n   */\r\n  unSubscribe(busName: string, msgTypes: number[], callback?: Callback) {\r\n    const _busName = busName || this.wsOptions.busName;\r\n    const _msgTypes = msgTypes || this.wsOptions.msgTypes;\r\n    const registerData = createWsData(\r\n      MsgType.MSG_FAMILY_UNSUBSCRIBE,\r\n      _busName,\r\n      _msgTypes\r\n    );\r\n    this.ws.send(JSON.stringify(registerData));\r\n    const handlers = this.messageHandlers.get(_busName);\r\n    if (handlers) {\r\n      this.messageHandlers.set(\r\n        _busName,\r\n        handlers.filter((handler) => handler !== callback)\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description 针对客户端订阅的消息，如果某个客户端发送了对应的消息，则会转发给其他所有订阅此消息的客户端\r\n   * @param busName\r\n   * @param data\r\n   */\r\n  sendMessage(busName: string, msgType: number, msg: any) {\r\n    const _busName = busName || this.wsOptions.busName;\r\n    const message = {\r\n      interMsgType: MsgType.MSG_FAMILY_TRANSMIT,\r\n      data: {\r\n        busName: _busName,\r\n        msgType,\r\n        msg,\r\n      },\r\n    };\r\n    if (this.ws?.readyState !== WebSocket.OPEN) {\r\n      console.warn('WebSocket 连接尚未建立，sendMessage 任务加入队列');\r\n      this._subscribeTasks.push(() => {\r\n        this.ws.send(JSON.stringify(message));\r\n      });\r\n    } else {\r\n      this.ws?.send(JSON.stringify(message));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @description BusServer会定时1秒对所有连接发送心跳消息，客户端收到后立刻返回心跳反馈消息\r\n   * 当websocket通信处于连接状态时，客户端超过设定时间没有接收到心跳消息，主动断开websocket通信，然后重新连接，设定时间默认为30s。\r\n   * BusServer内部的机制为：如果超过设定时间没有接收到连接反馈，亦会主动断开websocket连接。\r\n   * @returns\r\n   */\r\n  private startHeartbeat() {\r\n    if (!this.enableHeartbeat) return;\r\n    if (this.heartbeatTimer) return;\r\n\r\n    this.heartbeatTimer = setInterval(() => {\r\n      if (this.ws && this.ws.readyState === WebSocket.OPEN) {\r\n        this.ws.send(\r\n          JSON.stringify({\r\n            interMsgType: MsgType.MSG_FAMILY_HEARTBEAT,\r\n            data: {\r\n              version: '1.0',\r\n              ackId: Date.now(),\r\n            },\r\n          })\r\n        );\r\n      }\r\n    }, this.heartbeatInterval);\r\n  }\r\n\r\n  // 停止心跳\r\n  private stopHeartbeat() {\r\n    if (this.heartbeatTimer) {\r\n      clearInterval(this.heartbeatTimer);\r\n      this.heartbeatTimer = null;\r\n    }\r\n  }\r\n\r\n  // 7. 尝试重新连接\r\n  private reconnect() {\r\n    if (this.reconnectTimer) return;\r\n\r\n    if (this.maxReconnectTimes <= 0) {\r\n      console.log('Max reconnect times reached.');\r\n      return;\r\n    }\r\n\r\n    this.reconnectTimer = setTimeout(() => {\r\n      console.log('Reconnecting...', this.maxReconnectTimes);\r\n      this.maxReconnectTimes--;\r\n      this.connect();\r\n      this.reconnectTimer = null;\r\n    }, this.reconnectInterval);\r\n  }\r\n\r\n  // 8. 清除缓存\r\n  clearCache(type: string) {\r\n    if (type) {\r\n      this.cache.delete(type);\r\n    } else {\r\n      this.cache.clear();\r\n    }\r\n  }\r\n\r\n  // 9. 关闭 WebSocket 连接并清除单例\r\n  close() {\r\n    this.manualClosed = true; // 设置手动关闭标识\r\n    this.stopHeartbeat();\r\n    this.ws?.close();\r\n    this.ws = null;\r\n    WebSocketClient.InstanceMap.delete(this.url);\r\n    this.isConnected = false;\r\n    console.log('WebSocketClient instance closed and cleared.');\r\n  }\r\n}\r\n","// where数据属性结构如下：\r\n// ● type - 任意值，推荐使用条件的功能名称方便阅读。为空时，表示没有触发条件。\r\n// ● fn - 条件函数，返回一个bool值。最高优先级。\r\n// ● fnJs - 条件的js代码文本，可获取'pen'和 'context'参数，返回一个bool值。高优先级。\r\n// ● key - 通过属性名进行条件比较。低优先级。\r\n// ● comparison - 属性比较条件，配合key使用。\r\n//   ○ “>” - 大于\r\n//   ○ “>=” - 大于等于\r\n//   ○ “<” - 小于\r\n//   ○ “<=” - 小于等于\r\n//   ○ “=” - 等于\r\n//   ○ “!=” - 不等于\r\n//   ○ “[)” - 介于，与数学上相同，例如：[0, 100) 0~100，包含0不包含100； [0,100] 0~100,包含0和100\r\n//   ○ “![)” - 不介于，“介于”以外的\r\n//   ○ “[]” - 属于,集合，例如：[1,20,30..50,65] ，1.0.48版本后支持字符串，例如 [1,20,aaa,值1]\r\n//   ○ “![]” - 不属于，上述集合以外的\r\n// ● value - 属性比较值，配合key使用。\r\n\r\ntype ComparisonType = \">\" | \">=\" | \"<\" | \"<=\" | \"=\" | \"!=\" | \"[)\" | \"![)\" | \"[]\" | \"![]\"\r\n\r\nexport type WhereType = {\r\n  type?: string;\r\n  fn?: (pen: Pen) => boolean;\r\n  fnJs?: string;\r\n  key?: string;\r\n  comparison?: ComparisonType;\r\n  value?: any;\r\n};\r\n\r\n// events对象说明\r\n// ● name - 事件类型\r\n// ● action - 事件行为\r\n// ● value - 事件附属数据\r\n// ● params - 事件参数\r\n// ● where - 触发条件\r\nexport type EventConfig = {\r\n  name: string;\r\n  action: EventAction;\r\n  value: any;\r\n  params: any;\r\n  where: object;\r\n  extend: object;\r\n};\r\n\r\nexport enum EventAction {\r\n  Link, // 打开链接\r\n  SetProps, // 更改属性\r\n  StartAnimate, // 执行动画\r\n  PauseAnimate, // 暂停动画\r\n  StopAnimate, // 停止动画\r\n  JS, // 执行JS代码\r\n  GlobalFn, // 执行全局函数\r\n  Emit, // 发送消息\r\n  StartVideo, // 播放视频\r\n  PauseVideo, // 暂停视频\r\n  StopVideo, // 停止视频\r\n  SendPropData, // 发送图元数据\r\n  SendVarData, // 发送绑定变量\r\n  Dialog = 14, //对话框 14\r\n}\r\n\r\n\r\nexport type HandlerType = {\r\n  id: string\r\n  action: EventAction\r\n  params: {\r\n    tags: string[],\r\n    ids: string[],\r\n  },\r\n  value: any\r\n  where: {\r\n    key: string,\r\n    value: string | number,\r\n    comparison: ComparisonType,\r\n  }\r\n}\r\n\r\nexport enum ExtendAction {\r\n  DialogClose = -14,\r\n  // 连线动画反向\r\n  AnimateReverse,\r\n  // 弹窗播放视频\r\n  Video,\r\n  ScriptEnd,\r\n  ShowMeta2D,\r\n  GoToView,\r\n  // 弹窗展示文字\r\n  ShowText, \r\n  // TODO:\r\n}\r\n\r\nexport const ExtendEventNameKey = \"__extend_event__\"\r\n\r\n\r\nexport const ExtendActionJsCodeMap: Record<ExtendAction, string> = {\r\n  [ExtendAction.DialogClose]: '',\r\n  [ExtendAction.AnimateReverse]: '',\r\n  [ExtendAction.ScriptEnd]: '',\r\n  [ExtendAction.ShowMeta2D]: '',\r\n  [ExtendAction.GoToView]: '',\r\n  [ExtendAction.Video]: `\r\nconst fn = globalThis.$_callExtendAction;\r\nif (fn) {\r\n  fn(0, {\r\npen,\r\nparams,\r\ncontext,\r\n})\r\n}\r\n`,\r\n\r\n  [ExtendAction.ShowText]: `\r\nconst fn = globalThis.$_callExtendAction;\r\nif (fn) {\r\n  fn(0, {\r\npen,\r\nparams,\r\ncontext,\r\n})\r\n}\r\n`,\r\n}\r\n\r\n\r\nexport enum ExtendEventSource {\r\n  // 基于 meta2d 内部事件 js 代码调用\r\n  ReservedEvents,\r\n  // 自行扩展的逻辑代码调用\r\n  ExternalCall,\r\n}\r\n\r\nexport enum ExtendActionEventNameMap {\r\n  Dialog = \"__extend_event_dialog__\",\r\n  CustomMessage = \"__extend_event_custom_message__\",\r\n}\r\n\r\nexport enum ExtendActionMessageTypeMap {\r\n  VideoEnded,\r\n  ScriptEnded,\r\n}","import { Where } from '@meta2d/core';\r\nimport {\r\n  HandlerType,\r\n  EventAction,\r\n  ExtendEventNameKey,\r\n  ExtendAction,\r\n  ExtendEventSource,\r\n  ExtendActionEventNameMap,\r\n} from '../types/Event';\r\n\r\n/**\r\n * 根据 where 推断是否执行 handler\r\n * @param where\r\n * @param msg\r\n */\r\nfunction executeWhere(where: Where, msg: any) {\r\n  // console.log('executeWhere: ', where, msg)\r\n  if (!where) return true;\r\n  const { key, value, comparison } = where;\r\n  if (!key) return true;\r\n  if (!comparison) return true;\r\n  const v = value as number | string;\r\n  switch (comparison) {\r\n    case '==':\r\n      return msg[key] == value;\r\n    case '!=':\r\n      return msg[key] != value;\r\n    case '>':\r\n      return msg[key] > v;\r\n    case '<':\r\n      return msg[key] < v;\r\n    case '>=':\r\n      return msg[key] >= v;\r\n    case '<=':\r\n      return msg[key] <= v;\r\n    // case '[)':\r\n    //   return msg[key] >= v && msg[key] <= v\r\n    // case '![)':\r\n    //   return msg[key] < v || msg[key] > v\r\n    // case '[]':\r\n    //   return msg[key] >= v && msg[key] <= v\r\n    // case '![]':\r\n    //   return msg[key] < v || msg[key] > v\r\n    default:\r\n      return true;\r\n  }\r\n}\r\nfunction executeAnimate(type: string, ids: string[], tags: string[]) {\r\n  const fnMap = {\r\n    0: 'startAnimate',\r\n    1: 'pauseAnimate',\r\n    2: 'stopAnimate',\r\n  };\r\n  const pens = [];\r\n  if (ids?.length) {\r\n    ids.forEach((id) => {\r\n      pens.push(meta2d.findOne(id));\r\n    });\r\n  } else if (tags?.length) {\r\n    tags.forEach((tag) => {\r\n      pens.push(...meta2d.find(tag));\r\n    });\r\n  }\r\n  const fnName = fnMap[type];\r\n  if (fnName) {\r\n    meta2d[fnName](pens);\r\n  }\r\n}\r\n\r\nexport const useWsHandlers = (data: any) => {\r\n  const resolver = (response: any) => {\r\n    // ? 如何判断是更新图元的消息\r\n    if (response?.msg) {\r\n      const handlers = data.wsMsgHandlers || [];\r\n      const msg = response.msg;\r\n      handlers.forEach((handler: HandlerType) => {\r\n        const { action, params, value, where } = handler;\r\n        if (!executeWhere(where, msg)) return;\r\n        // ! 性能测试 4600+\r\n        // if (msg.CurrentInfo) {\r\n        //   const colors = ['rgba(54, 85, 207, 1)', 'rgba(214, 30, 195, 1)', 'rgba(209, 13, 46, 1)', 'rgba(29, 209, 97, 1)', 'rgba(224, 191, 61, 1)']\r\n        //   msg.CurrentInfo.pens.forEach((pen: any) => {\r\n        //     // 随机取 colors\r\n        //     pen.color = colors[Math.floor(Math.random() * colors.length)];\r\n        //     meta2d.setValue({\r\n        //       ...pen,\r\n        //     }, {\r\n        //       render: false,\r\n        //     })\r\n        //   })\r\n        //   meta2d.render()\r\n        //   console.log('update: ', msg.CurrentInfo)\r\n        //   return\r\n        // }\r\n        // ! 性能测试结束\r\n\r\n        const { tags, ids } = params;\r\n        //console.log('resolver: ', handlers);\r\n        //console.log('process action: ', action, ids, tags);\r\n        switch (action) {\r\n          case EventAction.SetProps:\r\n            // ! id 保存时进行了过滤，理论上都存在\r\n            if (ids?.length) {\r\n              ids.forEach((id) => {\r\n                meta2d.setValue(\r\n                  {\r\n                    id,\r\n                    ...value,\r\n                  },\r\n                  {\r\n                    render: false,\r\n                  }\r\n                );\r\n              });\r\n              meta2d.render();\r\n            } else if (tags?.length) {\r\n              tags.forEach((tag) => {\r\n                meta2d.setValue(\r\n                  {\r\n                    tag,\r\n                    ...value,\r\n                  },\r\n                  {\r\n                    render: false,\r\n                  }\r\n                );\r\n              });\r\n              meta2d.render();\r\n            }\r\n            break;\r\n          case EventAction.StartAnimate:\r\n            executeAnimate('0', ids, tags);\r\n            break;\r\n          case EventAction.PauseAnimate:\r\n            executeAnimate('1', ids, tags);\r\n            break;\r\n          case EventAction.StopAnimate:\r\n            executeAnimate('2', ids, tags);\r\n            break;\r\n\r\n          default:\r\n            console.log('unknown action: ', action);\r\n            break;\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  return {\r\n    resolver,\r\n  };\r\n};\r\n\r\n/**\r\n * @description 可供全局使用的扩展能力调用函数\r\n * @param sourceType\r\n * @param eventOptions\r\n * @returns\r\n */\r\nexport const callExtendAction = (\r\n  sourceType: ExtendEventSource,\r\n  eventOptions: any\r\n) => {\r\n  console.log('callExtendAction  ------------> ', sourceType, eventOptions);\r\n  if (!eventOptions) {\r\n    console.error('自定义消息参数不存在！');\r\n    return;\r\n  }\r\n  const { params, ...rest } = eventOptions;\r\n\r\n  if (sourceType == ExtendEventSource.ExternalCall) {\r\n    if (params && typeof params == 'object') {\r\n      params.action = eventOptions.action;\r\n    }\r\n  } else if (sourceType == ExtendEventSource.ReservedEvents) {\r\n    // sourceType == 0: rest = { pen, context, }\r\n    eventOptions.action = params?.action\r\n  }\r\n\r\n  switch (eventOptions.action) {\r\n    case ExtendAction.Video:\r\n      // 弹窗播放视频\r\n      meta2d.emit(ExtendActionEventNameMap.Dialog, eventOptions);\r\n      break;\r\n    case ExtendAction.DialogClose:\r\n      meta2d.emit(ExtendActionEventNameMap.Dialog, eventOptions);\r\n      break;\r\n\r\n    case ExtendAction.ShowMeta2D:\r\n      meta2d.emit(ExtendActionEventNameMap.Dialog, eventOptions);\r\n      break;\r\n    case ExtendAction.ShowText:\r\n      meta2d.emit(ExtendActionEventNameMap.Dialog, eventOptions);\r\n      break;\r\n    default:\r\n      console.error('未知扩展能力调用: ', eventOptions.action);\r\n      break;\r\n  }\r\n};\r\n\r\nglobalThis.$_callExtendAction = callExtendAction;\r\n\r\nexport const useExtendEvent = () => {\r\n  const extendOn = () => {\r\n    if (meta2d) {\r\n      meta2d.on(ExtendEventNameKey, (...args) => {\r\n        console.log('--------------', args);\r\n      });\r\n    } else {\r\n      console.error('meta2d is not ready');\r\n    }\r\n  };\r\n\r\n  const extendOff = (fn: any) => {\r\n    if (meta2d) {\r\n      meta2d.off(ExtendEventNameKey, fn);\r\n    }\r\n  };\r\n\r\n  return {\r\n    extendOn,\r\n    extendOff,\r\n  };\r\n};\r\n","<template>\r\n  <div id=\"meta2d\" :class=\"{ 'is--preview': preview, 'is--opener': isOpener }\"></div>\r\n  <ContextMenu\r\n    v-bind=\"contextMenuParams\"\r\n    @hide=\"hideContextMenu\"\r\n    @send=\"modelHandle\"\r\n  />\r\n  <t-dialog\r\n    :visible=\"visible\"\r\n    :close-btn=\"true\"\r\n    :on-confirm=\"onConfirmAnother\"\r\n    cancel-btn=\"取消\"\r\n    :on-close=\"close\"\r\n  >\r\n    <template #header>设置</template>\r\n    <template #body>\r\n      <t-form ref=\"form\" :data=\"formData\">\r\n        <t-form-item label=\"ID\" name=\"id\" disabled>\r\n          <t-input placeholder=\"请输入内容\" v-model=\"formData.id\" disabled />\r\n        </t-form-item>\r\n        <t-form-item label=\"名称\" name=\"Name\">\r\n          <t-input placeholder=\"请输入内容\" v-model=\"formData.Name\" disabled />\r\n        </t-form-item>\r\n        <t-form-item\r\n          label=\"设置状态值\"\r\n          name=\"State\"\r\n          v-if=\"formData.State != -1\"\r\n        >\r\n          <t-input\r\n            placeholder=\"请输入\"\r\n            v-model=\"formData.State\"\r\n            :disabled=\"formData.fault == 1\"\r\n          />\r\n        </t-form-item>\r\n        <!-- <t-form-item label=\"设置故障\" name=\"fault\">\r\n          <t-select v-model=\"formData.fault\" class=\"demo-select-base\">\r\n            <t-option\r\n              v-for=\"(item, index) in faultOptions\"\r\n              :key=\"index\"\r\n              :value=\"item.value\"\r\n              :label=\"item.label\"\r\n            >\r\n              {{ item.label }}\r\n            </t-option>\r\n          </t-select>\r\n        </t-form-item> -->\r\n      </t-form>\r\n    </template>\r\n  </t-dialog>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { onMounted, onUnmounted, reactive, ref } from \"vue\";\r\nimport {\r\n  Meta2d,\r\n  Pen,\r\n  register,\r\n  registerAnchors,\r\n  registerCanvasDraw,\r\n} from \"@meta2d/core\";\r\nimport { flowPens, flowAnchors } from \"@meta2d/flow-diagram\";\r\nimport {\r\n  activityDiagram,\r\n  activityDiagramByCtx,\r\n} from \"@meta2d/activity-diagram\";\r\nimport { classPens } from \"@meta2d/class-diagram\";\r\nimport { sequencePens, sequencePensbyCtx } from \"@meta2d/sequence-diagram\";\r\nimport { register as registerEcharts } from \"@meta2d/chart-diagram\";\r\nimport { formPens } from \"@meta2d/form-diagram\";\r\nimport { chartsPens } from \"@meta2d/le5le-charts\";\r\nimport { ftaPens, ftaPensbyCtx, ftaAnchors } from \"@meta2d/fta-diagram\";\r\nimport ContextMenu from \"./ContextMenu.vue\";\r\nimport { useSelection } from \"../services/selections\";\r\nimport { WebSocketClient } from \"@qs/websocket-client\";\r\nimport { useWsHandlers } from \"../services/useHandlers\";\r\n\r\nconst props = defineProps({\r\n  preview: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  data: {\r\n    type: Object,\r\n  },\r\n  customWsHandler: {\r\n    type: Function,\r\n  },\r\n\r\n  isOpener: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  \r\n});\r\n\r\nconst { select, selections } = useSelection();\r\n\r\nconst meta2dOptions: any = {\r\n  rule: false,\r\n  drawingLineName: \"line\",\r\n  rotateCursor: \"rotate.cur\",\r\n};\r\n\r\nconst contextMenuParams = reactive({\r\n  x: 0,\r\n  y: 0,\r\n  visible: false,\r\n  isPreview: false,\r\n});\r\nconst visible = ref(false);\r\nlet formData = reactive({\r\n  id: \"\",\r\n  Name: \"\",\r\n  fault: 0,\r\n  State: 0,\r\n});\r\nconst options = [\r\n  { label: \"断开\", value: 0 },\r\n  { label: \"闭合\", value: 1 },\r\n];\r\nconst faultOptions = [\r\n  { label: \"正常\", value: 0 },\r\n  { label: \"有故障\", value: 1 },\r\n];\r\nconst showContextMenu = (event: any) => {\r\n  // if (props.preview) return;\r\n  if (selections.mode === 0) return;\r\n  contextMenuParams.x = event.e.clientX;\r\n  contextMenuParams.y = event.e.clientY;\r\n  contextMenuParams.visible = true;\r\n  contextMenuParams.isPreview = props.preview;\r\n};\r\nconst hideContextMenu = () => {\r\n  contextMenuParams.visible = false;\r\n};\r\n\r\nconst emit = defineEmits([\"ready\"]);\r\n\r\nlet wsClient: any;\r\nonMounted(() => {\r\n  // 创建实例\r\n  new Meta2d(\"meta2d\", meta2dOptions);\r\n  // meta2d.store.options.grid = true; // 开启网格\r\n  // 按需注册图形库\r\n  // 以下为自带基础图形库\r\n  register(flowPens());\r\n  registerAnchors(flowAnchors());\r\n  register(activityDiagram());\r\n  registerCanvasDraw(activityDiagramByCtx());\r\n  register(classPens());\r\n  register(sequencePens());\r\n  registerCanvasDraw(sequencePensbyCtx());\r\n  registerEcharts();\r\n  registerCanvasDraw(formPens());\r\n  registerCanvasDraw(chartsPens());\r\n  register(ftaPens());\r\n  registerCanvasDraw(ftaPensbyCtx());\r\n  registerAnchors(ftaAnchors());\r\n  // 注册其他自定义图形库\r\n  // ...\r\n  emit(\"ready\", meta2d);\r\n\r\n  // 读取本地存储\r\n  let data: any = localStorage.getItem(\"meta2d\");\r\n  if (props.data || data) {\r\n    data = props.data || JSON.parse(data);\r\n    const { resolver } = useWsHandlers(data);\r\n\r\n    // 判断是否为运行查看，是-设置为预览模式\r\n    if (location.pathname === \"/preview\" || props.preview) {\r\n      data.locked = 1;\r\n      if (data.lockState) {\r\n        data.locked = data.lockState;\r\n      }\r\n      const msgTypes = (data.msgTypes || [])\r\n        .map((item: string) => {\r\n          return Number(item);\r\n        })\r\n        .filter((item: number) => {\r\n          return !isNaN(item);\r\n        });\r\n\r\n      const jsStr = data.onMessageJsCode;\r\n      if (data.wsUrl) {\r\n        wsClient = WebSocketClient.getInstance(data.wsUrl, {\r\n          busName: data.busName,\r\n          msgTypes,\r\n          enableLog: false,\r\n          onReady: () => {\r\n            console.log(\"%c连接成功！\", \"color: green; font-weight: bold;\");\r\n            wsClient.subscribe(data.busName, msgTypes, (response: any) => {\r\n              console.log(\"response: \", response);\r\n              try {\r\n                if (jsStr) {\r\n                  const fn = new Function(\"data\", jsStr);\r\n                  fn(response);\r\n                } else {\r\n                  if (props.customWsHandler) {\r\n                    // 自定义处理，如电路消息需要考虑更新不显示的，对消息进行缓存等等\r\n                    props.customWsHandler(response, meta2d);\r\n                  } else {\r\n                    // TODO：需要根据 msg 中的实际字段信息，转换为具体的 meta2d 执行逻辑\r\n                    resolver(response);\r\n                  }\r\n                }\r\n              } catch (error) {\r\n                console.log(\"error: \", error);\r\n              }\r\n            });\r\n          },\r\n        });\r\n        wsClient.connect();\r\n\r\n        // test: 模拟修改状态\r\n        // setTimeout(() => {\r\n        //   wsClient.sendMessage(data.busName, 3000, {\r\n        //     Name: \"xxx\",\r\n        //     Type: 28,\r\n        //     State: 0,\r\n        //   });\r\n        // }, 10000);\r\n      }\r\n    } else {\r\n      data.locked = 0;\r\n    }\r\n    meta2d.open(data);\r\n    // meta2d.fitView(); // ! 别直接加，所见即所得，初始视角自行设计\r\n  }\r\n\r\n  meta2d.on(\"active\", active);\r\n  meta2d.on(\"inactive\", inactive);\r\n  // 右键菜单\r\n  meta2d.on(\"contextmenu\", showContextMenu);\r\n  // 点击画布\r\n  meta2d.on(\"click\", hideContextMenu);\r\n});\r\n// WebSocket重新连接的方法\r\nconst reconnectWebSocket = (data: any) => {\r\n  console.log(\"reconnectWebSocket======== \", data);\r\n  const { resolver } = useWsHandlers(data);\r\n  if (data.wsUrl) {\r\n    data.locked = 1;\r\n    const msgTypes = (data.msgTypes || [])\r\n      .map((item: string) => {\r\n        return Number(item);\r\n      })\r\n      .filter((item: number) => {\r\n        return !isNaN(item);\r\n      });\r\n\r\n    const jsStr = data.onMessageJsCode;\r\n    console.log(\"reconnectWebSocket======== \", jsStr);\r\n    wsClient = WebSocketClient.getInstance(data.wsUrl, {\r\n      busName: data.busName,\r\n      msgTypes,\r\n      enableLog: false,\r\n      onReady: () => {\r\n        console.log(\"%c连接成功！\", \"color: green; font-weight: bold;\");\r\n        wsClient.subscribe(data.busName, msgTypes, (response: any) => {\r\n          try {\r\n            if (jsStr) {\r\n              const fn = new Function(\"data\", jsStr);\r\n              fn(response);\r\n            } else {\r\n              if (props.customWsHandler) {\r\n                // 自定义处理，如电路消息需要考虑更新不显示的，对消息进行缓存等等\r\n                props.customWsHandler(response, meta2d);\r\n              } else {\r\n                // TODO：需要根据 msg 中的实际字段信息，转换为具体的 meta2d 执行逻辑\r\n                resolver(response);\r\n              }\r\n            }\r\n          } catch (error) {\r\n            console.log(\"error: \", error);\r\n          }\r\n        });\r\n      },\r\n    });\r\n    wsClient.connect();\r\n  }\r\n};\r\n// 发送消息设置  1设置元器件属性  2设置元器件故障分别发送消息\r\nconst sendMessageSocket = (pen: any, type: any) => {\r\n  let data: any = localStorage.getItem(\"meta2d\");\r\n  if (props.data || data) {\r\n    data = props.data || JSON.parse(data);\r\n  }\r\n  console.log(\"sendMessageSocket======== \", data);\r\n  console.log(\"sendMessageSocketpen======== \", pen);\r\n  // 发送故障\r\n  if (data.wsUrl && type === \"fault\") {\r\n    wsClient.sendMessage(data.busName, 7000, {\r\n      Name: pen.Name,\r\n      Type: 28,\r\n      Code: pen.fault,\r\n    });\r\n    let color = pen.fault == 0 ? \"\" : \"#FF0000\";\r\n    meta2d.setValue(\r\n      { id: pen.id, color: color, fault: pen.fault },\r\n      { render: false }\r\n    );\r\n  }\r\n  // 发送开关状态\r\n  if (data.wsUrl && type === \"setting\") {\r\n    wsClient.sendMessage(data.busName, 3000, {\r\n      Name: pen.Name,\r\n      Type: 28,\r\n      State: pen.State,\r\n    });\r\n    meta2d.setValue({ id: pen.id, showChild: pen.State }, { render: false });\r\n  }\r\n};\r\n// 发送请求同步电路\r\nconst Sendrequestsyn = () => {\r\n  let data: any = localStorage.getItem(\"meta2d\");\r\n  if (props.data || data) {\r\n    data = props.data || JSON.parse(data);\r\n  }\r\n  if (data.wsUrl) {\r\n    wsClient.sendMessage(data.busName, 1002, {});\r\n  }\r\n};\r\nconst modelHandle = (data: any, type: string) => {\r\n  console.log(\"modelHandletype======== \", type);\r\n  console.log(\"modelHandle======== \", data);\r\n  formData.id = data.id;\r\n  formData.Name = data.text;\r\n  // Ecomponents 需要做处理\r\n  if (data.Ecomponents) {\r\n    // 目前处理开关\r\n    if (data.tags.includes(\"Switch\")) {\r\n      const [switchState, switchValue] = data.Ecomponents;\r\n      if (switchState === \"off\" || switchState === \"on\") {\r\n        const needReverse =\r\n          (switchState === \"off\" && switchValue === \"1\") ||\r\n          (switchState === \"on\" && switchValue === \"0\");\r\n        // 根据是否需要反转来设置showChild\r\n        if (needReverse) {\r\n          formData.State = +data?.showChild;\r\n        } else {\r\n          formData.State = +data?.showChild == 0 ? 1 : 0;\r\n        }\r\n      }\r\n    } else {\r\n      // 没有showChild为-1\r\n      formData.State = +(data?.showChild ?? -1);\r\n    }\r\n  }else{\r\n    formData.State = +(data?.showChild ?? -1);\r\n  }\r\n  formData.fault = data.fault; // 故障\r\n  if (type === \"setting\") {\r\n    // 设置属性\r\n    visible.value = true;\r\n  } else if (type === \"fault\") {\r\n    sendMessageSocket(formData, type);\r\n  }\r\n};\r\nconst close = () => {\r\n  visible.value = false;\r\n};\r\nconst onConfirmAnother = (context: any) => {\r\n  visible.value = false;\r\n  sendMessageSocket(formData, \"setting\");\r\n  // sendMessageSocket 点击确定后发送消息\r\n};\r\ndefineExpose({\r\n  reconnectWebSocket,\r\n  Sendrequestsyn,\r\n});\r\n\r\nconst active = (pens?: Pen[]) => {\r\n  select(pens);\r\n};\r\n\r\nconst inactive = () => {\r\n  select();\r\n};\r\n\r\nonUnmounted(() => {\r\n  meta2d.destroy();\r\n  wsClient && wsClient.close();\r\n\r\n});\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n#meta2d {\r\n  height: calc(100vh - 80px);\r\n  z-index: 1;\r\n  overflow: hidden;\r\n\r\n  &.is--preview {\r\n    height: 100%;\r\n    flex: 1;\r\n    overflow-x: hidden;\r\n  }\r\n\r\n  &.is--opener {\r\n    min-height: 400px;\r\n  }\r\n}\r\n</style>\r\n","import { reactive, ref } from 'vue';\r\n\r\n/**\r\n * 根据路径数组生成轨迹动画\r\n * @param {HTMLElement} element - 要进行动画的元素\r\n * @param {Array} paths - 路径数组，每个元素包含 x, y 和 duration\r\n */\r\nexport function createPathAnimation(element: any, paths: any[]) {\r\n  const rect = meta2d.getPenRect(element);\r\n\r\n  let originalX = rect.x;\r\n  let originalY = rect.y;\r\n\r\n  let startTime: number | null = 0;\r\n  let currentPathIndex = 0;\r\n  let startX = originalX;\r\n  let startY = originalY;\r\n\r\n  let animationFrameId: number | null = null;\r\n  let isPaused = ref(false);\r\n  let isStopped = ref(false);\r\n\r\n  let elapsed = 0;\r\n  \r\n  function animatePath(timestamp) {\r\n    if (isStopped.value) {\r\n      cancelAnimationFrame(animationFrameId);\r\n      return;\r\n    }\r\n\r\n    if (isPaused.value) {\r\n      // * 暂停期间，timestamp 会一直增加，所以需要减去已经执行的时间\r\n      startTime = timestamp - elapsed;\r\n      animationFrameId = requestAnimationFrame(animatePath);\r\n      return;\r\n    }\r\n\r\n    if (!startTime) startTime = timestamp;\r\n    elapsed = (timestamp - startTime);\r\n    const path = paths[currentPathIndex];\r\n    \r\n    const progress = Math.min(elapsed / path.duration, 1);\r\n    // console.log('animatePath >>>>>>>>>>>>>>>>>>>>>> : ', startTime, '|', elapsed, '|', progress);\r\n    const currentX = startX + (path.x || 0) * progress;\r\n    const currentY = startY + (path.y || 0) * progress;\r\n\r\n    meta2d.setValue({\r\n      id: element.id,\r\n      x: currentX,\r\n      y: currentY,\r\n    });\r\n\r\n    if (progress < 1) {\r\n      animationFrameId = requestAnimationFrame(animatePath);\r\n    } else {\r\n      // Path animation completed, move to the next path\r\n      currentPathIndex++;\r\n      if (currentPathIndex < paths.length) {\r\n        startX = currentX;\r\n        startY = currentY;\r\n        startTime = null;\r\n        animationFrameId = requestAnimationFrame(animatePath);\r\n      } else {\r\n        stop();\r\n      }\r\n    }\r\n  }\r\n\r\n  function play() {\r\n    isPaused.value = false;\r\n    isStopped.value = false;\r\n    startTime = null;\r\n    currentPathIndex = 0;\r\n    animationFrameId = requestAnimationFrame(animatePath);\r\n  }\r\n\r\n  function pause() {\r\n    isPaused.value = true;\r\n  }\r\n\r\n  function resume() {\r\n    if (isPaused.value) {\r\n      isPaused.value = false;\r\n\r\n      if (animationFrameId) {\r\n        cancelAnimationFrame(animationFrameId);\r\n      }\r\n      animationFrameId = requestAnimationFrame(animatePath);\r\n    }\r\n  }\r\n\r\n  function stop() {\r\n    isStopped.value = true;\r\n    startX = originalX;\r\n    startY = originalY;\r\n\r\n    // 实际业务中不需要重置\r\n    // meta2d.setValue({\r\n    //   id: element.id,\r\n    //   x: originalX,\r\n    //   y: originalY,\r\n    // });\r\n  }\r\n\r\n  return { play, pause, resume, stop, isPaused, isStopped };\r\n}\r\n"],"names":["NavigationType","NavigationDirection","NavigationFailureType","routerKey","routeLocationKey","useRouter","inject","useRoute","_name","rectangle","pen","ctx","path","wr","hr","x","y","width","height","ex","ey","r","square","circle","PenType","PenType2","LockState","LockState2","Gradient","Gradient2","CanvasLayer","CanvasLayer2","needCalcTextRectProps","needSetPenProps","needPatchFlagsPenRectProps","needCalcIconRectProps","LineAnimateType","LineAnimateType2","isDomShapes","isInteraction","formatAttrs","clearLifeCycle","HoverType","HoverType2","HotkeyType","HotkeyType2","MouseRight","MouseRight2","Direction","Direction2","defaultCursors","rotatedCursors","defaultDrawLineFns","inheritanceProps","PrevNextType","PrevNextType2","TwoWay","TwoWay2","PointType","PointType2","rotatePoint","pt","angle","center","a","hitPoint","target","radius","_rotate","rotate","pointInRect","scalePoint","scale","calcRotate","distance","pt1","pt2","facePoint","targetPt","d","disX","disY","translatePoint","samePoint","getDistance","form","to","store","dis","globalStore","pkg","register","path2dFns","registerCanvasDraw","drawFns","registerAnchors","anchorsFns","mitt","n","t","e","i","KeydownType","KeydownType2","defaultOptions","defaultTheme","EditType","EditType2","createStore","useStore","id","clearStore","template","isSame","calcTextRect","paddingTop","paddingBottom","paddingLeft","paddingRight","worldRect","canvas","textLeft","textTop","textWidth","textHeight","textAlign","textBaseline","rect","calcRightBottom","calcTextLines","calcTextDrawRect","lineHeight","h","calcTextAdaptionWidth","options","text","lines","oneRowHeight","calcRows","maxRows","allLines","wrapLines","setEllipsisOnLastLine","paragraphs","currentRow","outer","paragraph","words","getWords","items","l","keepDecimal","textNum","txt","word","ch","fontStyle","fontWeight","fontSize","fontFamily","currentLine","currentWidth","getFont","chinese","chineseWidth","spaces","spaceWidth","otherWidth","maxWidth","calcTextAutoWidth","arr","deepClone","o","keepCalc","item","_o","key","deepSetValue","keyWords","value","index","arrows","renderFromArrow","from","getFromAnchor","p","fromArrowColor","renderToArrow","getToAnchor","toArrowColor","point","fromX","pSBCr","m","g","b","pSBC","c0","c1","P","f","rgba","c","valueInRange","realValue","collection","start","end","nums","startNum","endNum","valueInArray","numStrs","numStr","s4","s8","s12","formatPadding","padding","top","left","right","bottom","isNil","fileToBase64","file","resolve","reject","reader","uploadFile","url","params","headers","formData","loadCss","success","error","link","queryURLParams","urlSearchParams","getter","object","setter","formatTime","format","weeks","now","year","month","day","week","hours","minutes","seconds","isAncestor","ancestor","parent","getParent","root","getAllChildren","children","child","getAllFollowers","followers","follower","drawBkLinearGradient","gradientFromColor","gradientToColor","gradientAngle","linearGradient","drawBkRadialGradient","gradientRadius","centerX","centerY","grd","getLinearGradientPoints","x1","y1","x2","y2","slantAngle","originX","originY","perpX1","perpY1","perpX2","perpY2","getBkRadialGradient","gradientColors","color","colors","formatGradient","stop","getBkGradient","points","getGradientR","getLinearGradient","getTextRadialGradient","textGradientColors","getTextGradient","dividAngle","calculateAngle","_arr","stap","rgbaToHex","array","colorAHex","getLineGradient","gradient","drawLinearGradientLine","ctxDrawLinearGradientPath","anchors","smoothLenth","lastCurvePoints","smoothTransition","next","getSmoothAdjacent","len","j","last","_next","_last","flag","_y","_x","p1","p2","nexLength","p3","contrlPoint","getBezierPoints","k","smoothAnimateTransition","getGradientAnimatePath","_path","num","p4","func","twoBezier","oneBezier","cp","cx","cy","strokeLinearGradient","lineGradientFromColor","lineGradientToColor","lineGradientAngle","fromColor","toColor","getImagePosition","iconWidth","iconHeight","imgNaturalWidth","imgNaturalHeight","w","scaleW","scaleH","scaleMin","wDivideH","drawImage","worldIconRect","iconRotate","img","getTextColor","textColor","data","drawText","hiddenText","textHasShadow","textBackground","textType","fill","drawRectX","drawRectY","textLineWidth","textDecorationColor","textDecorationDash","textDecoration","drawUnderLine","textStrickoutColor","textStrickoutDash","textStrickout","drawStrickout","location","config","drawFillText","prev","anchor","drawIcon","iconRect","drawDropdown","inputPenId","ctxFlip","ctxRotate","noFlip","renderPen","download","textFlip","textRotate","inspectRect","lineGradientFlag","_stroke","getGlobalColor","strokeImg","stroke","backgroundImg","back","setLineCap","setLineJoin","setGlobalAlpha","ctxDrawLinePath","ctxDrawPath","ctxDrawCanvas","lineCap","lineJoin","renderPenRaw","_a","canUsePath","path_from","path_to","lineWidth","progress","setCtxLineAnimate","drawArrow","renderLineAnchors","dash","renderAnchor","active","calcWorldRects","calcCenter","calcPivot","parentRect","calcPadding","calcPenRect","calcRelativeRect","calcWorldAnchors","_anchors","calcWorldPointOfPen","calcChildrenInitRect","calcIconRect","pens","iconLeft","iconTop","parentPen","scalePen","scaleRect","scaleChildrenInitRect","pushPenAnchor","worldAnchor","addLineAnchor","getSplitAnchor","calcRelativePoint","removePenAnchor","facePen","_anchor","nearestAnchor","translateLine","deleteTempAnchor","connectLine","line","lineAnchor","disconnectLine","getAnchor","fromPen","_b","fromAnchor","_c","_e","_d","_f","anchorId","setNodeAnimate","frameIndex","cycleIndex","setNodeAnimateProcess","pos","frame","frameChanged","cycleChanged","prevFrame","initPrevFrame","process","newScale","lastVal","getFrameValue","translateRect","offsetRotate","isLinear","current","childs","v","setChildValue","noLinear","setLineAnimate","setChildrenActive","setHover","hover","setElemPosition","elem","getPensLock","getPensDisableRotate","rotatePen","initLineRect","getLineRect","getPensDisableResize","prop","isShowChild","selfPen","oldPen","showChildIndex","calcInView","calcChild","canvasRect","penRect","rectInRect","globalAlpha","canvasDraw","drawFuncGenerator","drawCommand","command","calculate","step","cs","commandTransfer","csKey","startX","startY","dealWithVisio","dealWithDXF","originWidth","originHeight","centerX1","centerY1","longAxis","shortAxis","endX","endY","ctrlX","ctrlY","axisRatio","crossProduct","calculateEllipseParameters","calculateAngleInRadians","endX3","endY3","ctrlX3","ctrlY3","axisRatio3","crossProduct2","params2","endX2","endY2","xm","ym","R","ux","uy","xc1","yc1","xc","yc","startAngle","endAngle","cloneCommand","childId","_data","x3","y3","D","numeratorX0","denominatorX0","x0","numeratorY0","denominatorY0","y0","dx","dy","angleRadians","calcAnchorDock","curAnchor","xDock","yDock","size","getPointsByPen","calcMoveDock","offset","activePoints","rectToPoints","calcDockByPoints","outerPoints","calcResizeDock","resizeIndex","calcActive","minCloseX","minCloseY","closeSize","paddingRect","expandRect","inView","rectInFourAngRect","isConnectLine","activePoint","stepX","stepY","absStepX","absStepY","cline","isEqual","source","randomId","rewritePenLifeCycle","funcMap","funcPenMap","lifeCycle","del","funcListSet","originFuncMap","originLifeCycle","rewriteFunc","args","setLifeCycleFunc","validationPlugin","plugin","pts","pointInVertices","pointInSimpleRect","pivot","vertices","isIn","getRect","getRectOfPoints","allIn","retRect","getIntersectPoint","line1","line2","k1","k2","getIntersectPointByK","b1","pointsToRect","resizeRect","offsetX","offsetY","calcOffsetY","noChangePoint","relRect","penId","connectTo","pointInPolygon","inside","xi","yi","xj","yj","commandRegex","flagRegex","numberRegex","commaWsp","grammar","parseSvgPath","cursor","commands","match","parser","parseCommands","calcWorldPositions","translatePath","val","scalePath","cos","sin","A","B","C","F","det","val1","pathToString","type","expectedRegexList","regex","ws","calcWorldPoints","previous","worldPoints","svgPath","pathText","pathStr","diamond","triangle","triangleAnchors","pentagon","pentagonAnchors","pentagram","resize","centerx","centery","basey","baseyi","lx","ly","pentagramAnchors","manualPoints","hexagon","leftArrow","rightArrow","twowayArrow","message","cloud","cube","z","face","fillStyle","strokeStyle","people","middle","curve","mousedwon","fromFace","calcCurveCP","toFace","getQuadraticPoint","getBezierPoint","cp1","cp2","cx1","cy1","cx2","cy2","lerp","p0","p5","p6","p7","p8","mind","worldAnchors","draw","lineSegment","getLineLength","getLinePoints","getPoints","getLineR","pointInLine","pointInLineSegment","minX","maxX","minY","maxY","pointToLine","lineLen","lineInRect","isLineIntersectRectangle","isBezierIntersectRectangle","linePointX1","linePointY1","linePointX2","linePointY2","rectangleLeftTopX","rectangleLeftTopY","rectangleRightBottomX","rectangleRightBottomY","temp","temp1","faceSpace","polyline","dragFrom","connected","toPen","getFacePoint","corner","_faceSpace","getNextPointsOfUp","getNextPointsOfRight","getNextPointsOfBottom","getNextPointsOfLeft","getNextPoints","anchorInHorizontal","anchorInVertical","translatePolylineAnchor","simplify","length","newPoints","maxDist","xx","yy","ddx","ddy","dist","dist1","smoothLine","cornerThres","dist2","aLen","nx1","nx2","ny1","ny2","dot","arrowLength","lastLength","getAngle","newP","newPTFrom","ptTFrom","arrow","waterDrop","getRotatePoint","rp","_angle","pr","pl","pr1","pr2","pl1","pl2","reverse","pE","rAngle","iframe","destory","move","mouseMove","beforeValue","div","generateAroundDiv","updatePointerEvents","_value","initOperationalRect","operationalRect","mouseEnter","videos","mutedIcons","video","click","changeId","player","muted","media","resizeProcessWidth","oldId","newId","currentSrc","createOffscreen","offscreen","context","Tooltip","parentElement","__publicField","sheet","style","oldElemRect","marked","title","oldRect","newRect","elemRect","Scroll","up","CanvasImage","isBottom","patchFlags","patchFlagsAnimate","patchFlagsBackground","patchFlagsTop","ctxCanvas","rule","ruleColor","origin","span","finalRuleColor","b_y","_g","_h","MagnifierCanvas","parentCanvas","domCtx","lockedError","Dialog","header","Title","CanvasTemplate","background","grid","gridRotate","gridColor","gridSize","ratio","cW","cH","newX","newY","status","Popconfirm","movingSuffix","Canvas","event","hasImages","blob","name","base64_str","image","scaleOff","vRect","json","obj","files","isGif","touches","_pt","shake","activePen","isHoverFrom","isHoverTo","isActiveFrom","isActiveTo","hoverAnchors","xPenId","yPenId","xPen","yPen","containerPens","movingPen","hoverType","activeLine","activePensLock","activePensDisableRotate","activePensDisableResize","rotatePt","firstFour","cursors","ruleH","tempx","offscreenCtx","hoverAnchorColor","parentId","initRect","newChildren","childPen","range","textRect","finalText","_width","div_style","font_scale","tem","_textWidth","contentWidth","initPens","search","none","li","dropdown","fit","initLine","newLine","preAnchors","laterAnchors","lastH","lastW","beforeIds","history","abs","list","lineX","lineY","otherPX","otherPY","readyConnect","movedPens","autoAlignGrid","dockPen","drawing","emit","connectPen","connectAnchor","action","found","before","undo","aPen","unPens","unPen","paths","mouse","penFrom","penTo","request","inlineSVG","image64","worldRectIsReady","playingAnimate","map","minScale","maxScale","s","lineScale","lineCenter","resizeDock","scaleX","scaleY","vFlag","moveDock","containChildPens","copyContainChildPens","keyOptions","connectedLine","relativePt","prevRotate","nextRotate","hoverPen","doing","penConnection","newAnchor","originStatus","change","penAnchor","canMovePens","animate","autoIndex","initProps","dels","page","copyPens","clipboard","clipboardText","rootPens","retPens","deep","ids","lastPen","pastePens","lineId","nodeId","node","cl","canDelLocked","deletePens","delPens","_index","delPen","str","arrEntities","all","inputDivStyle","numericValue","idOrTag","oldName","isChangedName","willUpdatePath","willCalcTextRect","willPatchFlagsPenRect","willCalcIconRect","willSetPenRect","containIsBottom","oldRotate","willRenderImage","currentRotate","chlidId","render","callback","containBkImg","_scale","storeData","isDrawBkImg","isRight","mergeArea","isV","allPens","_rect","gap","downX","downY","idx","lastActiveIdx","panel","mouseLeave","mouseUp","input","textX","getTextWidth","activePens","inRect","gifsList","gif","setImagePosition","mindNode","mindNodeAnchors","rectX","rectY","borderRadius","topN","getYByCircle","rightN","getXByCircle","bottomN","leftN","ox","oy","sqrt","mindLine","mindLineAnchors","commonPens","commonAnchors","EventAction","EventAction2","ViewMap","vW","vH","space","module","require","u","_","E","S","global","q","L","U","T","N","I","O","M","V","H","W","messageList","Message","placement","Meta2d","opts","eventName","old","indexArr","condition","can","fn","fnJs","comparison","err","pValue","timer","realTime","trigger","state","_i","_j","datas","accumulator","dataId","theme","activeColor","activeBackground","fromArrow","toArrow","_pen","oneForm","_item","keys","netWork","res","topics","topic","network","clients","client","mqttClient","mqtt.connect","websockets","socket","websocket","that","loadImage","cacheDatas","formItem","dataIds","productId","deviceId","propertyId","initJs","binds","lineName","lock","fnName","handler","dock","idOrTagOrPens","animation","showChild","initParent","minIndex","childRect","pIdx","cid","cPen","pathId","socketFn","socketCbJs","mqttOptions","username","password","https","http","httpTimeInterval","httpHeaders","_req","req","_httpTimer","networks","mqttIndex","websocketIndex","sqlIndex","net","token","mess","devices","dbid","sql","rai","max","min","penNetwork","reg","_updateTimer","_sqlTimer","_message","doEvent","penValues","penValue","bindArr","afterData","total","_pens","operator","valueType","compareValue","initUpdatePens","addPens","updatePens","oldParent","evt","mySerializedSVG","urlObject","export_blob","viewPadding","wGap","hGap","iframePens","bfW","bfH","_height","viewCenter","pensRect","dataX","dataY","pageMode","WorH","attribute","firstPen","attrs","attr","align","whole","moveX","moveY","direction","allDistance","currentPen","currentPenRect","pen0Rect","maxHeight","currentX","currentY","nextPenRect","allIds","allIndexs","nextHitIndex","currentRect","layer","zIndex","preMovePens","orderPens","lastIndex","firstIndex","toIndex","_line","nextNode","nextNodes","lineNextNode","preNode","preNodes","linePreNode","pre","_worldAnchor","toAnchor","_worldRect","absWidth","components","parents","oneIsParent","plugins","pluginConfig","option","op","mapList","visible","onlyData","electricSvgList","electricCombineList","nameStartChar","nameChar","nameRegexp","regexName","getAllMatches","string","matches","allmatches","isName","exports","arrayMode","util","require$$0","validator","xmlData","tags","tagFound","reachedRoot","readPI","tagStartPos","readCommentAndCDATA","closingTag","tagName","validateTagName","msg","getErrorObject","getLineNumberForPosition","result","readAttributeStr","attrStr","attrStrStart","isValid","validateAttributeString","otg","openPos","afterAmp","validateAmpersand","isWhiteSpace","char","tagname","angleBracketsCount","doubleQuote","singleQuote","startChar","tagClosed","validAttrStrRegxp","attrNames","getPositionFromMatch","attrName","validateAttrName","validateNumberAmpersand","re","count","code","lineNumber","jPath","buildOptions","OptionsBuilder","XmlNode","xmlNode","readDocType","entities","hasBody","comment","exp","isEntity","entityName","readEntityExp","validateEntityName","isElement","isAttlist","isNotation","isComment","DocTypeReader","hexRegex","numRegex","consider","toNumber","trimmedStr","sign","leadingZeros","numTrimmedByZeros","trimZeros","eNotation","strnum","getIgnoreAttributesFn","ignoreAttributes","pattern","require$$1","require$$2","require$$3","require$$4","OrderedObjParser$1","addExternalEntities","parseXml","parseTextData","resolveNameSpace","buildAttributesMap","isItStopNode","replaceEntitiesValue","readStopNodeData","saveTextToParentTag","addChild","externalEntities","entKeys","ent","dontTrim","hasAttributes","isLeafNode","escapeEntities","newval","parseValue","prefix","attrsRegx","oldVal","aName","newVal","attrCollection","xmlObj","currentNode","textData","closeIndex","findClosingIndex","colonIndex","lastTagName","propIndex","tagData","readTagExp","childNode","endIndex","tagExp","rawTagName","attrExpPresent","lastTag","tagContent","entity","stopNodes","currentTagName","allNodesExp","stopNodePath","stopNodeExp","tagExpWithClosingIndex","closingChar","attrBoundary","errMsg","closingIndex","removeNSPrefix","separatorIndex","startIndex","openTagCount","shouldParse","OrderedObjParser_1","OrderedObjParser","prettify","compress","compressedObj","tagObj","property","propName","newJpath","isLeaf","isLeafTag","assignAttributes","attrMap","jpath","atrrName","textNodeName","propCount","node2json","XMLParser$1","validationOption","orderedObjParser","orderedResult","XMLParser_1","XMLParser","EOL","toXml","jArray","indentation","arrToStr","xmlStr","isPreviousElementTag","newJPath","tagText","isStopNode","attStr","attr_to_str","tempInd","piTextNodeName","newIdentation","tagStart","tagValue","attrVal","textValue","orderedJs2Xml","buildFromOrderedJs","Builder","isAttribute","processTextOrObjNode","indentate","jObj","level","ajPath","arrLen","listTagVal","listTagAttr","Ks","tagEndExp","piClosingChar","closeTag","json2xml","XMLBuilder","fxp","selfName","allRect","shapeScale","anchorsArr","parseSvg","svg","svgs","selfProperty","transformContainerRect","replaceMap","flatSvg","combinePens","transformCombines","setAnchor","childKeys","dealUnit","combinePen","childProperty","setStyle","setLinearGradient","transformNormalShape","transformPath","transformRect","transformCircle","transformLine","transformPolygon","transformPolyline","transformText","transformImage","iPen","getTranslate","transform","matchArr","rx","ry","mySelf","viewBox","parentProperty","childClassJs","getClassStyle","parentClassJs","chileStyleJs","styleToJson","parentStyleJs","finalProperty","gradientColor","matrix","polygonPointsToXY","pointsArr","resPoints","pointsStr","calcPointByMatrix","oldX","oldY","textContent","contentProp","measureText","styleArr","defs","def","cssToJson","linearGradientItem","className","classStyle","parseSvgStr","svgString","penConfig","manual","parseSvgStr1","loadSvg","svgUrl","rotateAngelMap","asymmetries","sideRightShapes","patchPosition","penType","StatusTypes","getChildIndex","findChildren","queue","clonePens","uuid","copy","loadElectricJson","readJSONFile","SwitchCombinesData","Components","Paintings","Wires","penList","ConfigList","vParams","rWidth","rHeight","svgItem","cWidth","cHeight","calcLinePos","extractname","extractPrefixOrEmpty","readSVGFile","copyToClipboard","el","successful","toggleFullScreen","useUpload","uploadValue","ref","sizeLimit","useAttrs","cache","base64ToFile","base64","fileName","mime","bstr","u8arr","activePenToPng","paper","getJsonString","newPen","useData","useSingle","blueprintList","componentList","folderName","selectMode","selectType","apiManager","proxyApi","tempData","tempCode","showAddFolder","uploadFileFn","confirm","png","saveFn","cover","getTree","saveImageComponent","folder","close","deleteMyPen","saveComponentShow","saveBlueprintShow","deleteFolder","flowComment","flowCommentAnchors","flowData","penOffsetX","flowDataAnchors","flowDisplay","flowDocument","rightBottomY","flowDocumentAnchors","flowExternStorage","flowInternalStorage","flowManually","flowManuallyAnchors","flowParallel","flowParallelAnchors","flowQueue","flowSubprocess","flowDb","flowPens","flowAnchors","activityFinal","swimlaneH","lineLeft","swimlaneV","lineTop","activityDiagram","activityDiagramByCtx","interfaceClass","onDestroy","onAdd","topHeight","secondHeight","childPen1","simpleClass","classPens","focus","lifeline","headHeight","sequencePens","sequencePensbyCtx","echarts","onRenderPenRaw","initEvent","updateOption","_chart","eventNames","xAxis","yAxis","replaceMode","timeFormat","dataDotArr","chartFlag","beforeV","_key","_time","dotNotationToObject","dataArr","series","oneXAxis","oneYAxis","yItem","part","serie","categoryData","xIndex","xData","yData","values","category","hasValue","oneDataY","_option","props","dotNotationObj","dotNotationStr","isArrayIndex","arrayIndex","_echarts","meta2dRegister","ReplaceMode","ReplaceMode2","getTextLength","textScale","chineseLen","initOptions","optionPos","textLength","table2","onMouseMove","onMouseLeave","onMouseDown","onShowInput","onInput","onValue","onMouseEnter","onWheel","drawGridLine","drawCell","drawNote","mousePos","row","col","noteWidth","colPos","rowPos","colStyle","_col","_colWidthMap","_row","_rowHeightMap","_r","finalHight","rowStyle","getRow","cell","cellStyle","getCell","isSuccess","successIdx","where","getCellRect","rowText","_colPen","childrenPen","calcChildrenRect","createInterval","setCellText","getCellIndex","rowIndex","colIndex","rowData","resizeX","resizeY","lastX","lastY","temChildren","delInterval","scroll","changeChildVisible","penY","penH","rowHeight","oldOffset","initChildrenStyle","le5leSwitch","slider","mouseDown","barWidth","calcBallRect","checkbox","onMousedown","radio","isForbidden","optionHeight","formPens","maxDecimal","fixedNum","decimal","numberValid","scaleCompute","magics","dataMax","dataMin","splitNumber","symmetrical","deviation","preferZero","tempGap","multiple","tempStep","expectedStep","storedMagicsIndex","axisMax","axisMin","countDegree","tm","tempSplitNumber","out","interval","coordinateAxis","collection_data","initOption","normalizedOption","fontOptions","_l","_k","_n","_m","temH","xdataX","_p","_q","_t","_s","_v","_u","_w","_z","_B","_A","getValidValue","lineChart","coordinate","smooth","coordinateValue","cAx","cAy","cBx","cBy","last1x","last1y","before1x","before1y","last2x","last2y","_xAxisData","xAxisData","pieChart","isEcharts","seriesArray","beforeSeriesLength","ser","sum","curr","fromR","toR","beforeAngle","afterAngle","colorLength","centerAngle","temX","temY","temFillStyle","fontOption","_innerItem","_innderIndex","_filterItem","histogram","itemWidth","currentH","gauge","onclick","basicConfigure","pointColor","bgColor","bgLineWidth","bili","dashWidth","mainR","arcLength","offsetAngle","fromDashWidth","fromArcLength","fromDash","fromOffsetAngle","valueGap","textR","pointNum","valueArray","currentAngle","pointerR","pointerHalfW","titleOption","date","second","minute","hour","chartsPens","andGate","myh","myw","andGateAnchors","basicEvent","vlineL","basicEventAnchors","conditionalEvent","conditionalEventAnchors","forbiddenGate","forbiddenGateAnchors","orGate","orGateAnchors","priorityAndGate","switchEvent","transferSymbol","unexpandedEvent","unexpandedEventAnchors","xorGate","xorGateAnchors","votingGate","ftaPens","ftaPensbyCtx","ftaAnchors","SelectionMode","SelectionMode2","selections","reactive","useSelection","__props","computed","__emit","menuOptions","customToolbarClick","markHandle","menuOptions1","mark","NotifyPlugin","MsgType","MsgType2","createWsData","busName","msgTypes","_WebSocketClient","heartbeatInterval","instance","task","appName","registerData","parsedMessage","interMsgType","feedbackMsg","_busName","_msgTypes","handlers","msgType","WebSocketClient","ExtendAction","ExtendAction2","ExtendEventNameKey","ExtendActionJsCodeMap","ExtendEventSource","ExtendEventSource2","ExtendActionEventNameMap","ExtendActionMessageTypeMap","ExtendActionMessageTypeMap2","executeWhere","executeAnimate","fnMap","tag","useWsHandlers","response","callExtendAction","sourceType","eventOptions","rest","useExtendEvent","select","meta2dOptions","contextMenuParams","showContextMenu","hideContextMenu","wsClient","onMounted","registerEcharts","resolver","jsStr","inactive","reconnectWebSocket","sendMessageSocket","Sendrequestsyn","modelHandle","switchState","switchValue","onConfirmAnother","__expose","onUnmounted","createPathAnimation","element","originalX","originalY","startTime","currentPathIndex","animationFrameId","isPaused","isStopped","elapsed","animatePath","timestamp","play","pause","resume"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","x_google_ignoreList":[0,7,65,69,70,71,72,73,74,75,76,77,78,79,80,81]}